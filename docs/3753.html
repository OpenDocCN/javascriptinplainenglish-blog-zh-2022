<html>
<head>
<title>Understanding WebRTC — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解WebRTC —第1部分</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/understanding-webrtc-api-46948337dc7?source=collection_archive---------11-----------------------#2022-09-22">https://javascript.plainenglish.io/understanding-webrtc-api-46948337dc7?source=collection_archive---------11-----------------------#2022-09-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="4d78" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">燃烧网络的尖端技术之一</h2></div><p id="4b78" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在过去的十年中，WebRTC在web开发社区中获得了很大的人气。感谢疫情(虽然是积极的方式),因为许多公司开始采用在家永久工作👨‍💻，像Atlassian，Shopify，Spotify，Twitter……(OMG名单还在继续)。这种远程工作的采用导致大多数公司购买实时通信工具，如MS Teams和Gmeet，它们将WebRTC作为主要组件。</p><p id="53eb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">根据PayScale的数据，2022年美国WebRTC开发人员的平均工资约为74136美元/年。相当不错的报酬，好吧，让我们直接进入主题。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi kz"><img src="../Images/b478cacbcf8b56167a2ebbaca5a7adf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YHYSDkzlmDwTn8s1yXx4IQ.jpeg"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk">Photo by <a class="ae ky" href="https://pixabay.com/users/brian_cragun-19680916/" rel="noopener ugc nofollow" target="_blank">Brian_Cragun</a> on <a class="ae ky" href="https://pixabay.com/" rel="noopener ugc nofollow" target="_blank">Pixabay</a></figcaption></figure><h1 id="b297" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">什么是WebRTC？</h1><blockquote class="mh mi mj"><p id="a37e" class="kc kd mk ke b kf kg jo kh ki kj jr kk ml km kn ko mm kq kr ks mn ku kv kw kx ig bi translated">WebRTC是一个开源框架，允许使用可靠的协议和加密技术进行实时数据传输。</p></blockquote><p id="d653" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这些实时数据可以是音频、视频，或者可能是一个简单的字符串消息，只需几行代码就可以以一种非常快速、更加安全的方式进行交换！💆</p><h1 id="b318" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">如何开始🤔</h1><p id="c9c2" class="pw-post-body-paragraph kc kd in ke b kf mo jo kh ki mp jr kk kl mq kn ko kp mr kr ks kt ms kv kw kx ig bi translated">作为开发人员，当我们遇到一项新技术时，我们经常会陷入如何开始的困境。最好的方法是直接进入实用的方法。</p><p id="2d5f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们从跟随亲吻写一个简单的要点开始😘原则。打开代码编辑器，复制粘贴下面的代码。</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="9dfa" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">普通的javascript很无聊，让我们给它添加一些html和css的点缀吧，🥳</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="492c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">厉害！🤩我们做到了！😎我们已经创建了一个WebRTC支持的聊天应用程序，现在让我们更好地理解代码。</p><p id="0aa0" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">HTML和CSS部分是不言自明的，所以我们可以只关注javascript。在这个例子中，我们创建了一个简单的聊天应用程序，它使用WebRTC的集成<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Using_data_channels" rel="noopener ugc nofollow" target="_blank"> dataChannelAPI </a>来发送和接收聊天消息。</p><h1 id="8220" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">那么什么是数据通道呢？</h1><blockquote class="mh mi mj"><p id="b2df" class="kc kd mk ke b kf kg jo kh ki kj jr kk ml km kn ko mm kq kr ks mn ku kv kw kx ig bi translated">WebRTC数据通道是一种媒介，通过它，对等方可以通过对等连接发送和接收消息。</p></blockquote><p id="6b8d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以数据通道就像一座桥🌉用于发送和接收消息。</p><h1 id="5f12" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">那么什么是对等连接呢？</h1><blockquote class="mh mi mj"><p id="4143" class="kc kd mk ke b kf kg jo kh ki kj jr kk ml km kn ko mm kq kr ks mn ku kv kw kx ig bi translated">WebRTC对等连接连接不同会话中的对等方，以便它们可以使用对等协议进行通信。</p></blockquote><p id="822b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">简单地说，对等连接处理一组协议，通过这些协议，不同计算机之间可以进行数据传输。它处理诸如将消息发送到哪里以及哪条消息应该发送到哪台计算机之类的细节。一旦我们完成了对等连接，我们需要理解对等连接的主要组件。</p><ul class=""><li id="1fd3" class="mv mw in ke b kf kg ki kj kl mx kp my kt mz kx na nb nc nd bi translated">RTCIceCandidate</li><li id="f102" class="mv mw in ke b kf ne ki nf kl ng kp nh kt ni kx na nb nc nd bi translated">会话描述协议(sdp)</li></ul><h2 id="2ee8" class="nj lq in bd lr nk nl dn lv nm nn dp lz kl no np mb kp nq nr md kt ns nt mf nu bi translated">冰什么？</h2><blockquote class="mh mi mj"><p id="37a1" class="kc kd mk ke b kf kg jo kh ki kj jr kk ml km kn ko mm kq kr ks mn ku kv kw kx ig bi translated">交互式连接建立(ICE)是一个框架，充当对等体使用RTCPeerConnection进行通信的协议和路由机制。</p></blockquote><p id="8c42" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用ICE协议，将生成候选人。iceCandidate是包含网络路由信息的字符串，数据包使用该信息在对等连接中流动。</p><h2 id="33ff" class="nj lq in bd lr nk nl dn lv nm nn dp lz kl no np mb kp nq nr md kt ns nt mf nu bi translated">好吧，那SDP呢？</h2><blockquote class="mh mi mj"><p id="7439" class="kc kd mk ke b kf kg jo kh ki kj jr kk ml km kn ko mm kq kr ks mn ku kv kw kx ig bi translated">SDP是另一种保存特定于会话的信息的协议，例如支持的音频或视频编解码器、加密算法以及其他与设备相关的详细信息。</p></blockquote><p id="e178" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">SDP是WebRTC的主要组件之一。此外，在两个对等体之间创建WebRTC连接的第一步是创建和交换sdp(提供和应答)。</p><p id="c3a1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了创建一个WebRTC连接，我们要经过一个<strong class="ke io">信令阶段</strong>🚥。让我们通过听一个💞故事。</p><h1 id="67ad" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">一个罗密欧🤵—朱丽叶👩‍💼故事</h1><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi kz"><img src="../Images/836e170e2267dfd2c25abdabeec92a88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*470r4LE_txS09IMmaWp5YA.jpeg"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@oscarmucyo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Oscar Mucyo</a> on <a class="ae ky" href="https://unsplash.com/s/photos/mobile-chat?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ffa9" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">罗密欧想要给朱丽叶发送一个消息，所以他决定使用WebRTC。Romeo从他的本地RTCPeerConnection创建一个offer sdp，并将其设置为本地描述。现在罗密欧向朱丽叶发出了邀请💌通过某种通信协议(可能是套接字连接)。</p><pre class="la lb lc ld gt nv nw nx ny aw nz bi"><span id="1482" class="nj lq in nw b gy oa ob l oc od">localConnection = new RTCPeerConnection();<br/>localConnection.createOffer().then((offer) =&gt; {<br/>    localConnection.setLocalDescription(offer);<br/>    // send offer to Juliet👩‍💼<br/>}</span></pre><p id="cbcd" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Juliet收到该提议，将其设置为远程描述，并创建一个应答sdp来本地设置它，将其发送回Romeo💌。</p><pre class="la lb lc ld gt nv nw nx ny aw nz bi"><span id="e157" class="nj lq in nw b gy oa ob l oc od">remoteConnection = new RTCPeerConnection();<br/>remoteConnection.setRemoteDescription(offer).then(() =&gt; {<br/>    remoteConnection.createAnswer().then((answer) =&gt; {<br/>        remoteConnection.setLocalDescription(answer)<br/>        // send answer to Romeo🤵<br/>    })<br/>})</span></pre><p id="c82c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">收到答案-sdp罗密欧很高兴，并将其设置为他的远程描述。结果，ice候选者开始在两端生成，然后交换💌实时地。</p><pre class="la lb lc ld gt nv nw nx ny aw nz bi"><span id="187f" class="nj lq in nw b gy oa ob l oc od">localConnection.setRemoteDescription(answer)</span><span id="717d" class="nj lq in nw b gy oe ob l oc od">localConnection.onicecandidate = (event) =&gt; {<br/>    remoteConnection.addIceCandidate(event.candidate);<br/>    // send candidate to Juliet👩‍💼<br/>}</span><span id="b2f9" class="nj lq in nw b gy oe ob l oc od">remoteConnection.onicecandidate = (event) =&gt; {<br/>    localConnection.addIceCandidate(event.candidate);<br/>    // send candidate to Romeo🤵<br/>}</span></pre><p id="e815" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在连接已经准备好发送和接收数据，但是Romeo需要一个秘密的数据通道来发送和接收消息，所以他创建了一个通道并发送了他的第一条消息。</p><pre class="la lb lc ld gt nv nw nx ny aw nz bi"><span id="a8f6" class="nj lq in nw b gy oa ob l oc od">sendChannel = localConnection.createDataChannel("romeo-juliet");<br/>sendChannel.send("Hey my love ❤️");</span></pre><p id="921a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">另一方面，Juliet正在侦听新创建的数据通道并接收消息。</p><pre class="la lb lc ld gt nv nw nx ny aw nz bi"><span id="1347" class="nj lq in nw b gy oa ob l oc od">receiveChannel.onmessage = (event) =&gt; {<br/>    message = event.data; //Hey my love ❤️<br/>}</span></pre><p id="5ad6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这样一个幸福的结局不是吗😊，这怎么可能？</p><p id="2efa" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">嘣！！！无法发送消息。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi of"><img src="../Images/11bffa973d03ce461b0779710e56184b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Is7bNRo4g_PEIhDQ8aM77w.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk">Unable to send message 🙁</figcaption></figure><p id="bada" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个错误的原因可能是什么？罗密欧应该如何解决这个问题？在评论区等你的回答。</p><h1 id="2642" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">结论</h1><p id="eebc" class="pw-post-body-paragraph kc kd in ke b kf mo jo kh ki mp jr kk kl mq kn ko kp mr kr ks kt ms kv kw kx ig bi translated">我知道这将是势不可挡的，因为我们已经在这个快速博客中讨论了许多概念。学习新技术的最好方法是培养好奇心，尝试新事物。最重要的是，一个专业的建议是阅读<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/connectionState#failed" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io">文档</strong> </a> <strong class="ke io">。是的，阅读文档是更好地理解事物的最好方法之一。你可能也会找到上述问题的答案💡😉一定要去看看。</strong></p><p id="f94f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mk">更多内容请看</em><a class="ae ky" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="mk">plain English . io</em></strong></a><em class="mk">。报名参加我们的</em> <a class="ae ky" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="mk">免费周报</em> </strong> </a> <em class="mk">。关注我们上</em><a class="ae ky" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="mk">Twitter</em></strong></a><a class="ae ky" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="mk">LinkedIn</em></strong></a><strong class="ke io"><em class="mk"/></strong><a class="ae ky" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="mk">YouTube</em></strong></a><strong class="ke io"><em class="mk"/></strong><em class="mk">和</em> <a class="ae ky" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="mk">不和</em> </strong> </a>  <em class="mk">对成长黑客感兴趣？检查</em> <a class="ae ky" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="mk">电路</em> </strong> </a> <strong class="ke io"> <em class="mk">。</em> </strong></p></div></div>    
</body>
</html>