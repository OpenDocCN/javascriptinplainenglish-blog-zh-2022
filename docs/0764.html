<html>
<head>
<title>Build a Web Scraper with Me</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">和我一起做一个网络刮刀</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-a-web-scraper-with-me-beginner-friendly-19d2d98ac8d1?source=collection_archive---------3-----------------------#2022-02-12">https://javascript.plainenglish.io/build-a-web-scraper-with-me-beginner-friendly-19d2d98ac8d1?source=collection_archive---------3-----------------------#2022-02-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="bc20" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">关于如何使用Node.js &amp; Cheerio构建web scraper的初学者友好指南。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/66e5135b6a4582b98359abdb84c1b662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c99WLIGNYm50VTE6"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo By <a class="ae ks" href="https://www.instagram.com/lebuzz_magazine/" rel="noopener ugc nofollow" target="_blank">Le Buzz</a></figcaption></figure><p id="8edc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">朋友们好，</p><p id="f36d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">今天，我们要做一些很酷(也很容易——所以不要离开)的事情。我们将使用Javascript构建一个web scraper。我将向您展示一个非常简单、易于理解的例子，从这个例子中，您将能够构建它，将其应用到其他项目中，并有望构建出很酷的东西。</p><h1 id="0bbf" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">什么是Web Scraper？</h1><p id="40d5" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">web scraper基本上是一种从web中提取数据并以有意义的方式使用它的工具。</p><p id="d0a5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">今天，对于我们的项目，我们将从维基百科的页面“<a class="ae ks" href="https://en.wikipedia.org/wiki/List_of_most-streamed_artists_on_Spotify" rel="noopener ugc nofollow" target="_blank">Spotify</a>上流量最大的艺术家列表”中提取数据。</p><p id="9970" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">更具体地说，我们将从该表中获取数据:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/2ef5603615def26ce787cee0a41a10b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*iZRAXdy3h6FzNx4wcN361w.png"/></div></figure><p id="487c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这张表显示了Spotify每月听众最多的顶级艺术家(显然是过去30天)。随着时间的推移，数据会发生变化。我们将得到艺术家的名字，他们的排名，和他们每月的听众。</p><p id="a232" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们收集完这些数据后，你可以做任何你想做的事情。例如，你可以在你的网站上展示它。就我个人而言，我用它创建了一个API——但这超出了本教程的范围。跟着我，也许你会在不久的将来看到那个教程。</p><p id="49e8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以让我们开始吧。</p><h1 id="a840" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">准备</h1><p id="1c2b" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">首先，我们需要一些工具。</p><p id="cfe9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">通常情况下，如我的<a class="ae ks" href="https://blog.bitsrc.io/the-beginners-guide-to-get-started-with-axios-85a5e8caa2dd" rel="noopener ugc nofollow" target="_blank"> Axios教程</a>或<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/say-hello-world-in-reactjs-63018c533d5e"> React教程</a>所示，我推荐安装Node.js和VS代码。<em class="mn">如果你不知道什么NodeJS，我鼓励你去看看我的</em><a class="ae ks" href="https://medium.com/bitsrc/nodejs-learn-nodejs-and-npm-d7ebdc235f" rel="noopener"><em class="mn">NodeJS简介</em> </a>。</p><p id="7267" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是对于这个项目，我想我们会走一条更容易的路线，这样这个过程就不会那么漫长和令人生畏。</p><p id="bc6a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您已经安装了NodeJS和VS代码，请随意使用。这很容易理解。否则，如果你是初学者，请前往<a class="ae ks" href="https://replit.com/" rel="noopener ugc nofollow" target="_blank">回复</a>。</p><h2 id="0307" class="mo lq in bd lr mp mq dn lv mr ms dp lz lc mt mu mb lg mv mw md lk mx my mf mz bi translated">回复说明</h2><p id="94bd" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">Replit是一个可以编译NodeJS的在线IDE。你不需要在电脑上安装任何东西。所以很容易上手。</p><p id="1c75" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，创建一个新帐户。</p><p id="832c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后创建一个项目，如下所示:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi na"><img src="../Images/0e99cb7146ca4b09546ddd51047b4701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BLPWMTbmoZijJf1SfMy7fw.png"/></div></div></figure><p id="2d17" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">将出现一个弹出窗口，如下所示:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/d8aeee792feb6c70702aa3321b898425.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*d64D3hAL_ukGP9Gacnml-A.png"/></div></figure><p id="3ded" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">对于模板，<strong class="kv io">选择Node.js </strong>。然后，您可以随意命名您的项目。我将把我的命名为“网络刮刀”。完成后，创建您的项目。跳过下一节“VS代码准备”，直接进入“安装包”开始。</p><h2 id="4b49" class="mo lq in bd lr mp mq dn lv mr ms dp lz lc mt mu mb lg mv mw md lk mx my mf mz bi translated">VS代码准备</h2><p id="6e4d" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">如果你用的是VS代码，这就是指令集。如果你正在使用VS代码，我假设你知道你在做什么，所以我不会深入研究。</p><p id="9b1d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">创建您的项目，在您的终端中运行<code class="fe nc nd ne nf b">npm init</code>，并创建一个index.js文件。</p><h1 id="4b44" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">安装软件包</h1><p id="58d0" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">首先，我们需要安装两个包:Request和Cheerio。</p><p id="80ab" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><a class="ae ks" href="https://www.npmjs.com/package/request" rel="noopener ugc nofollow" target="_blank">请求</a>是一个npm包，允许我们发送HTTP请求。我们使用<strong class="kv io">请求</strong>，这样我们就可以得到一个页面的HTML。如果我们想从网页上收集数据，我们需要访问网页的HTML。</p><p id="bc24" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">例如:</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="5303" class="mo lq in nf b gy nk nl l nm nn">&lt;body&gt;<br/>    &lt;h1&gt;Hello World&lt;/h1&gt;<br/>&lt;/body&gt;</span></pre><p id="3248" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果我们想得到一个页面的标题——在这个例子中是“Hello World”——你可以清楚地看到我们将从HTML中提取它。希望这一点很清楚。</p><p id="60f4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">继续，我们需要啦啦队。因此<strong class="kv io">请求</strong>给了我们HTML，但是我们需要<strong class="kv io"> Cheerio </strong>以便我们可以挑选HTML。我们只需要HTML的某些部分。我们不需要全部。Cheerio帮助我们提取我们确实需要的零碎信息。因此，使用cheerio，我们可以将“Hello World”从整个HTML代码中分离出来，并以有意义的方式使用它。</p><p id="0e82" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">希望这是有意义的。如果没有，这里有另一种思考方式。</p><p id="c2d0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">对于这个项目，我们从维基百科文章页面“<a class="ae ks" href="https://en.wikipedia.org/wiki/List_of_most-streamed_artists_on_Spotify" rel="noopener ugc nofollow" target="_blank">Spotify上流量最大的艺术家列表</a>”获取Spotify的月度流量数据。</p><p id="ca35" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">请求</strong>将发送整个网页的HTML。我们不需要这些。因此，为了获得我们确实需要的信息，比如艺术家姓名和每月听众人数，我们将使用<strong class="kv io"> cheerio </strong>。</p><h2 id="d7ba" class="mo lq in bd lr mp mq dn lv mr ms dp lz lc mt mu mb lg mv mw md lk mx my mf mz bi translated">如何安装软件包</h2><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi no"><img src="../Images/ec99f457ed631b014149d6f9e84df5a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*OKDCJ1OlboSHt6zIuLFUzw.png"/></div></figure><p id="fac9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在Replit中安装包非常容易，对初学者也很友好。在左侧边栏中，单击如上所示的按钮。它会展开一个菜单，你可以在里面输入你想要安装的软件包。</p><p id="8bad" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">输入“cheerio”。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi np"><img src="../Images/76821f88ef0b33a6d8e8d22348a3ea40.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*18BErTo5jkjPwx7Nr2PR9A.png"/></div></figure><p id="25d0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们想要只写着“cheerio”的。点击+按钮进行安装。</p><p id="09e4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">接下来，我们要安装<strong class="kv io">请求</strong>。虽然您可以使用我们刚刚使用的过程来安装请求包，但是我想向您展示我们可以安装包的另一种方法。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi na"><img src="../Images/47ffd986ed06d6a911f197f12cf2085a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rn70hrlNya_XLkr4gR7gzw.png"/></div></div></figure><p id="3807" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你的屏幕应该看起来像这样。在右边，打开你的外壳。我用红色圈了起来。这将打开您的终端。</p><p id="57c4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在您的终端中，编写以下命令来请求安装。</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="6ba5" class="mo lq in nf b gy nk nl l nm nn">npm install request</span></pre><p id="5f3c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">上面也显示了该过程。它应该安装成功。</p><p id="e36a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一旦安装了这两个包，我们就可以继续了。</p><h1 id="5748" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">需要我们的包裹</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nq"><img src="../Images/0a8d8663f843a138ded590db5c6c6b9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZNEm6kjPdBw32uunZeUTjg.png"/></div></div></figure><p id="fc7c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在我们的包已经安装好了，我们终于可以从index.js文件开始了。要访问该文件，请转到侧边栏并单击顶部的文档图标。我给你圈出来了，在上面的截图里。</p><p id="81ef" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果(出于某种原因)您没有index.js文件，那么就创建一个。</p><p id="2e98" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以我们要做的第一件事是让我们的包在Javascript文件中可用。在index.js文件的顶部编写以下内容:</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="8325" class="mo lq in nf b gy nk nl l nm nn">const request = require("request");</span><span id="d763" class="mo lq in nf b gy nr nl l nm nn">const cheerio = require("cheerio");</span></pre><p id="5770" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">发生什么事了？</p><p id="bad2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">require("package-name ")基本上是让包在我们的脚本中可用。注意，包名是区分大小写的。不要写<code class="fe nc nd ne nf b">require('Request')</code>举例。</p><p id="d043" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你可以看到我们将它们存储在一个常量变量中。这个常量变量就是我们如何访问这些包提供的功能。为了清楚起见，您可以将这些包视为库。包有使我们的编码体验更容易的函数/方法。</p><p id="9571" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以，如果我们想使用cheerio的load函数，我们应该写<code class="fe nc nd ne nf b">cheerio.load()</code>。</p><h1 id="a064" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">获取HTML</h1><p id="3bba" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">现在，我们将获得我们想要抓取的网页的HTML。如果你想浏览《华尔街日报》、斯坦福的主页或迪士尼的招聘页面，你可以这么做。</p><p id="9278" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这个项目中，我们在网上搜集维基百科的文章<a class="ae ks" href="https://en.wikipedia.org/wiki/List_of_most-streamed_artists_on_Spotify" rel="noopener ugc nofollow" target="_blank">Spotify</a>上流量最大的艺术家名单。</p><p id="dfcf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以网络抓取的第一步是获取你想要抓取的网页的URL。网址是:</p><div class="ns nt gp gr nu nv"><a href="https://en.wikipedia.org/wiki/List_of_most-streamed_artists_on_Spotify" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd io gy z fp oa fr fs ob fu fw im bi translated">Spotify - Wikipedia上流量最大的艺术家列表</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">该列表包含音频流媒体平台Spotify上播放量最大的艺术家。截至2022年2月，威肯…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">en.wikipedia.org</p></div></div><div class="oe l"><div class="of l og oh oi oe oj km nv"/></div></div></a></div><p id="f6de" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下一步是输入URL作为<strong class="kv io">请求</strong>函数的参数。</p><p id="4b00" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请求函数看起来像这样:</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="60d5" class="mo lq in nf b gy nk nl l nm nn">request("URL-here", function());</span></pre><p id="bba9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">第一个参数是您想要抓取的网页的URL。</p><p id="9c73" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">第二个参数是一个函数，它提供了在发出HTTP请求后您希望发生什么的指令。</p><p id="fcb7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">到目前为止，我们的请求函数是这样的:</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="adeb" class="mo lq in nf b gy nk nl l nm nn">request("<a class="ae ks" href="https://en.wikipedia.org/wiki/List_of_most-streamed_artists_on_Spotify" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/List_of_most-streamed_artists_on_Spotify</a>", function(<strong class="nf io">error, response, html</strong>){</span><span id="4470" class="mo lq in nf b gy nr nl l nm nn">   ...code here</span><span id="67d8" class="mo lq in nf b gy nr nl l nm nn">});</span></pre><p id="d7f5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你看到函数有参数了吗:错误、响应和HTML？所以HTTP请求发出后，会有HTTP响应。响应将包括是否发生错误、响应状态代码(表明响应是否成功)和HTML代码。</p><p id="c7c4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">函数中的这些参数允许我们在HTTP响应中使用信息——是的，顺序很重要。</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="6ae5" class="mo lq in nf b gy nk nl l nm nn">request("https://en.wikipedia.org/wiki/List_of_most-streamed_artists_on_Spotify", function(error, response, html){</span><span id="17c1" class="mo lq in nf b gy nr nl l nm nn">   if(!error &amp;&amp; response.statusCode == 200){</span><span id="671a" class="mo lq in nf b gy nr nl l nm nn">   }</span><span id="68b9" class="mo lq in nf b gy nr nl l nm nn">});</span></pre><p id="0192" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因此，在我们的函数中，我们将添加一个if语句，如下所示。它基本上是说，“如果没有错误，并且响应是成功的，让我们继续。</p><p id="f4c8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">对吗？因为如果有错误并且HTML没有被检索到，那么我们什么也做不了。</p><h2 id="98e7" class="mo lq in bd lr mp mq dn lv mr ms dp lz lc mt mu mb lg mv mw md lk mx my mf mz bi translated">打印HTML</h2><p id="2532" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">所以让我们做一个小小的检查。在if语句中，让我们将HTML打印到控制台。我们这样做只是为了看看我们是否成功地检索到了HTML。</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="e7c1" class="mo lq in nf b gy nk nl l nm nn">const request = require("request");</span><span id="804c" class="mo lq in nf b gy nr nl l nm nn">const cheerio = require("cheerio");</span><span id="1918" class="mo lq in nf b gy nr nl l nm nn">request("https://en.wikipedia.org/wiki/List_of_most-streamed_artists_on_Spotify", function(error, response, html){</span><span id="bf25" class="mo lq in nf b gy nr nl l nm nn">   if(!error &amp;&amp; response.statusCode == 200){</span><span id="3b15" class="mo lq in nf b gy nr nl l nm nn">      console.log(html)</span><span id="a9df" class="mo lq in nf b gy nr nl l nm nn">   }</span><span id="623e" class="mo lq in nf b gy nr nl l nm nn">});</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ok"><img src="../Images/7d97068c7b26ae797195088c6001a196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WCyUA1FoWZk9BCKRNTGCeA.png"/></div></div></figure><p id="555e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您运行它，您将看到我们成功地检索了HTML。HTML是在我们的控制台中打印出来的(显示在右边)。</p><p id="cfda" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在我们有了HTML，我们可以使用Cheerio来收集我们确实需要的零碎信息。</p><h1 id="3c43" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">DOM操作</h1><p id="cebc" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">在我们深入研究cheerio之前，您需要了解选择器。如果您有使用jQuery、DOM操作甚至CSS选择器的经验，可以跳过这一节。否则，请花时间了解它们。</p><p id="3e54" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">W3 Schools有一个很棒的<a class="ae ks" href="https://www.w3schools.com/cssref/css_selectors.asp" rel="noopener ugc nofollow" target="_blank">选择器参考</a>页面。看看这个。和他们一起玩，看看他们是如何工作的。</p><p id="a500" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这里有一个例子:</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="2cef" class="mo lq in nf b gy nk nl l nm nn">&lt;div&gt;<br/>   &lt;h2&gt; Kyle &lt;/h2&gt;<br/>   &lt;p&gt; is a developer &lt;/p&gt;<br/>&lt;/div&gt;</span></pre><p id="0d7b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要选择h2，我们可以使用以下选择器:</p><p id="128f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe nc nd ne nf b">div h2</code>或者仅仅是<code class="fe nc nd ne nf b">h2</code></p><p id="b9b2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">显然，随着HTML文档变得越来越长、越来越庞大，选择器就不那么容易了。但是如果你明白这一点，请继续。否则，了解更多信息，</p><h1 id="6e7b" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">Cheerio负载</h1><p id="6118" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">所以我们有了HTML。现在我们需要给Cheerio那个HTML。</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="4548" class="mo lq in nf b gy nk nl l nm nn">const $ = cheerio.load(html);</span></pre><p id="b79a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是如何做到的。这是标准的做法。现在，我们可以使用$作为从HTML中选择元素的方法。例如，如果我们想从HTML中选择元素，我们可以写<code class="fe nc nd ne nf b">$("body")</code>。</p><p id="8fe9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果我们想从HTML中选择h1元素，我们可以写<code class="fe nc nd ne nf b">$("h1")</code></p><p id="32a3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果我们想选择一个id为<code class="fe nc nd ne nf b">img-container</code>的元素，我们可以写<code class="fe nc nd ne nf b">$("#img-container")</code>等等。这就是啦啦队的全部。它允许我们提取东西。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ol"><img src="../Images/77920749f04acb0332483060ec81f8e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*80_B3EpcgWRQ5knVjFbZzw.png"/></div></div></figure><p id="912f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">不幸的是，维基百科的HTML非常复杂。在上面的截图中，我在左边显示维基百科页面，右边显示HTML代码。</p><p id="9530" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">(要访问任何网页的HTML代码，只需右键单击并点击Inspect。)</p><p id="0272" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如截图所示，要获得83.95的数据点，HTML很复杂。数字实际上嵌套在十亿个不同的元素中。因此，我将把选择器给你。本教程的重点是cheerio，而不是选择器；所以让我们把注意力放在啦啦队上。</p><h1 id="1eb1" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">收集艺术家数据</h1><p id="cf4d" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">我们的第一个任务是收集一组艺术家的名字。</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="e55b" class="mo lq in nf b gy nk nl l nm nn">const request = require("request");</span><span id="06c9" class="mo lq in nf b gy nr nl l nm nn">const cheerio = require("cheerio");</span><span id="5b7a" class="mo lq in nf b gy nr nl l nm nn">request("https://en.wikipedia.org/wiki/List_of_most-streamed_artists_on_Spotify", function(error, response, html){</span><span id="312b" class="mo lq in nf b gy nr nl l nm nn">   if(!error &amp;&amp; response.statusCode == 200){</span><span id="ac52" class="mo lq in nf b gy nr nl l nm nn">      const $ = cheerio.load(html);</span><span id="87e8" class="mo lq in nf b gy nr nl l nm nn">      let names = [];</span><span id="64b2" class="mo lq in nf b gy nr nl l nm nn">      $(".mw-body .mw-body-content .mw-parser-output .wikitable tbody td a").each((i,el) =&gt; {</span><span id="93b4" class="mo lq in nf b gy nr nl l nm nn">         const item = $(el).text().replace(/[0-9]/g, '').replace(/[\[\]']+/g,'');</span><span id="0f84" class="mo lq in nf b gy nr nl l nm nn">         if(names.length &lt; 20 &amp;&amp; item != ""){</span><span id="00ef" class="mo lq in nf b gy nr nl l nm nn">            names.push(item);</span><span id="fde9" class="mo lq in nf b gy nr nl l nm nn">          }</span><span id="9a22" class="mo lq in nf b gy nr nl l nm nn">      })</span><span id="a55d" class="mo lq in nf b gy nr nl l nm nn">       console.log(names)</span><span id="8372" class="mo lq in nf b gy nr nl l nm nn">      }//end if statement</span><span id="a5fe" class="mo lq in nf b gy nr nl l nm nn">});</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi om"><img src="../Images/3e00fd4c268d23a6bfa4570049f62a20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h-zq709foXzZ-huigD1opg.png"/></div></div></figure><p id="6e99" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">运行它，你应该会看到艺术家的名字数组。</p><p id="c838" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们来分解一下，这样你就明白了。</p><p id="a01b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi">#1</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="ac10" class="mo lq in nf b gy nk nl l nm nn">const $ = cheerio.load(html);</span><span id="6c56" class="mo lq in nf b gy nr nl l nm nn">let names = [];</span></pre><p id="4685" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们首先将HTML加载到cheerio中，并创建一个名为names的空数组。数组名是我们存储歌手名字的地方。</p><p id="1c41" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi">#2</p><p id="6cca" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">接下来，我们使用cheerio的选择器:</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="b585" class="mo lq in nf b gy nk nl l nm nn">$(".mw-body .mw-body-content .mw-parser-output .wikitable tbody td a")</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi on"><img src="../Images/0a4c29f3627357bd524bc2a0fb209784.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*z4TN8ItwVECuuDKccMIcGQ.png"/></div></figure><p id="dcb0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">被选择的项目是表中艺术家的名字。你看到我们在选择器的最后写了<code class="fe nc nd ne nf b">td a</code>吗？所以a是锚定标签。而锚文本就是艺人的名字。</p><p id="abc9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi">#3</p><p id="4179" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">连接到选择器，您可以看到每个功能:</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="842b" class="mo lq in nf b gy nk nl l nm nn">$(".mw-body .mw-body-content .mw-parser-output .wikitable tbody td a")<strong class="nf io">.each((i,el) =&gt; {</strong></span><span id="995f" class="mo lq in nf b gy nr nl l nm nn"><strong class="nf io">   const item = $(el).text().replace(/[0-9]/g, '').replace(/[\[\]']+/g,'');</strong></span><span id="6967" class="mo lq in nf b gy nr nl l nm nn"><strong class="nf io">   if(names.length &lt; 20 &amp;&amp; item != ""){</strong></span><span id="d0a8" class="mo lq in nf b gy nr nl l nm nn"><strong class="nf io">      names.push(item);</strong></span><span id="bb60" class="mo lq in nf b gy nr nl l nm nn"><strong class="nf io">   }</strong></span><span id="abcf" class="mo lq in nf b gy nr nl l nm nn"><strong class="nf io">})</strong></span></pre><p id="647a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">它在做什么？看上面的维基百科表格。你看到那张桌子上有多位艺术家了吗？所以我们提供的选择器(“<code class="fe nc nd ne nf b">.mw-body .mw-body-content .mw-parser-output .wikitable tbody td a</code>”)可以描述该表中的所有条目。选择器可以用来获取所有艺术家的名字。</p><p id="1bdb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你不明白这一点，想想选择器<code class="fe nc nd ne nf b">h2</code>。选择器可用于选择文档中的所有h2元素。对吗？或者想想<code class="fe nc nd ne nf b">.img-container</code>是哪一个阶层。该类选择器可用于选择使用该类的所有元素。对吗？</p><p id="f150" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">类似地，我们的选择器可以用来选择所有这些艺术家。所以每个函数基本上都要选择选择器可以选择的所有元素。换句话说，它将收集所有艺术家的名字。</p><p id="e173" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi">#4</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="1aa4" class="mo lq in nf b gy nk nl l nm nn">$(".mw-body .mw-body-content .mw-parser-output .wikitable tbody td a").each((i,el) =&gt; {</span><span id="22de" class="mo lq in nf b gy nr nl l nm nn"><strong class="nf io">const item = $(el).text().replace(/[0-9]/g, '').replace(/[\[\]']+/g,'');</strong></span><span id="e884" class="mo lq in nf b gy nr nl l nm nn">if(names.length &lt; 20 &amp;&amp; item != ""){</span><span id="8340" class="mo lq in nf b gy nr nl l nm nn">names.push(item);</span><span id="9148" class="mo lq in nf b gy nr nl l nm nn">}</span><span id="ac1c" class="mo lq in nf b gy nr nl l nm nn">})</span></pre><p id="a87b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这里我们看到的是一条粗粗的线。发生了很多事。</p><p id="5e5a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以在这里，变量<code class="fe nc nd ne nf b">el</code>代表一个艺人的名字。你可以看到我们做了$(el)。文本()。</p><p id="ddfe" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果我们不添加<code class="fe nc nd ne nf b">text()</code>，那么您将会收到一个HTTP响应。它看起来像这样:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/bde32b5124d65cff2a3d887bad768481.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*pOEMj2Flkt6FYhbEJMARvg.png"/></div></figure><p id="7b0d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是一大堆什么都没有。但是如果我们添加<code class="fe nc nd ne nf b">text()</code>，我们将得到嵌入元素中的实际文本。</p><p id="418e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">例如，从<code class="fe nc nd ne nf b"> &lt;a href=””&gt; text &lt;/a&gt;</code>或<code class="fe nc nd ne nf b"> &lt;div&gt; text&lt;/div&gt;</code>我们只能得到文本。这就是我们想要的。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi op"><img src="../Images/8684f331f04d617fd8405a8b63282115.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*zQLIOZPyhwVnumcNxRBhZg.png"/></div></figure><p id="8d87" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你看到所有的数字和方括号了吗？我们不想要那些数字。</p><p id="2f77" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了消除这一点，我们添加了<code class="fe nc nd ne nf b">.replace(/[0–9]/g, ‘’).replace(/[\[\]’]+/g,’’)</code></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/98ef86bfff3eaa9ec846728db3d56e77.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*MvVdi9UHlP0kVBri17YGpA.png"/></div></figure><p id="d31c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你看到所有的空弦了吗？上面写着“还有84个项目”？</p><p id="e2af" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们只想要前20名的艺人，不要空弦。为了解决这个问题，我们添加了以下内容:</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="1cd4" class="mo lq in nf b gy nk nl l nm nn">if(names.length &lt; 20 &amp;&amp; item != ""){</span><span id="d4fb" class="mo lq in nf b gy nr nl l nm nn">   names.push(item);<br/>}</span></pre><p id="90b2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">基本上，如果数组少于20位艺术家&amp;字符串不为空，那么将字符串添加到数组中。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi or"><img src="../Images/516690f32453592dc9f4576c43c2b3cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*jr-9HPlNSSqiM9KG0PqHVA.png"/></div></figure><p id="6e9b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">太美了。</p><p id="51ca" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后我们重复这个过程来计算每月的听众人数。</p><h1 id="6158" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">收集每月听众计数</h1><p id="883b" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">我们创建了一个新的空数组来保存每月的侦听器计数。</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="9c96" class="mo lq in nf b gy nk nl l nm nn">let numbers = [];</span></pre><p id="a77d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后我们添加我们的选择器:</p><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="8541" class="mo lq in nf b gy nk nl l nm nn">$(".mw-body .mw-body-content .mw-parser-output .wikitable tbody tr td").each((i,el) =&gt; {</span><span id="acab" class="mo lq in nf b gy nr nl l nm nn">const item = $(el).html();</span><span id="b3f7" class="mo lq in nf b gy nr nl l nm nn">if(numbers.length &lt; 20 &amp;&amp; !isNaN(parseFloat(item))){</span><span id="c230" class="mo lq in nf b gy nr nl l nm nn">numbers.push(item);</span><span id="8311" class="mo lq in nf b gy nr nl l nm nn">}</span><span id="66b9" class="mo lq in nf b gy nr nl l nm nn">})</span></pre><p id="4777" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">上一节中的逻辑同样适用。我们的选择器可以用来选择许多不同的元素。这就是我们使用每项功能的原因。</p><p id="7f45" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">注意，在这个例子中，我们使用了<code class="fe nc nd ne nf b"> $(el).html()</code>，这与之前我们使用<code class="fe nc nd ne nf b">text()</code>的部分不同。这是因为维基百科的DOM设置方式。<code class="fe nc nd ne nf b">html()</code>将返回一个HTML字符串——这正是我们能够提取数字的方式。使用text()是不可能的。</p><p id="f213" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了了解更多，我认为最好的学习方法就是通过实验。自己测试一下吧。</p><h1 id="6168" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">运行代码</h1><pre class="kd ke kf kg gt ng nf nh ni aw nj bi"><span id="3c72" class="mo lq in nf b gy nk nl l nm nn">const request = require("request");</span><span id="f389" class="mo lq in nf b gy nr nl l nm nn">const cheerio = require("cheerio");</span><span id="92f5" class="mo lq in nf b gy nr nl l nm nn">request("https://en.wikipedia.org/wiki/List_of_most-streamed_artists_on_Spotify", function(error, response, html){</span><span id="8f94" class="mo lq in nf b gy nr nl l nm nn">if(!error &amp;&amp; response.statusCode == 200){</span><span id="87f7" class="mo lq in nf b gy nr nl l nm nn">const $ = cheerio.load(html);</span><span id="822d" class="mo lq in nf b gy nr nl l nm nn">let names = [];</span><span id="f859" class="mo lq in nf b gy nr nl l nm nn">let numbers = [];</span><span id="a3b1" class="mo lq in nf b gy nr nl l nm nn">$(".mw-body .mw-body-content .mw-parser-output .wikitable tbody td a").each((i,el) =&gt; {</span><span id="b87f" class="mo lq in nf b gy nr nl l nm nn">const item = $(el).text().replace(/[0-9]/g, '').replace(/[\[\]']+/g,'');;</span><span id="f325" class="mo lq in nf b gy nr nl l nm nn">if(names.length &lt; 20 &amp;&amp; item != ""){</span><span id="0aea" class="mo lq in nf b gy nr nl l nm nn">names.push(item);</span><span id="0256" class="mo lq in nf b gy nr nl l nm nn">}</span><span id="9ce5" class="mo lq in nf b gy nr nl l nm nn">})</span><span id="5508" class="mo lq in nf b gy nr nl l nm nn">console.log(names)</span><span id="0d37" class="mo lq in nf b gy nr nl l nm nn">$(".mw-body .mw-body-content .mw-parser-output .wikitable tbody tr td").each((i,el) =&gt; {</span><span id="0fcc" class="mo lq in nf b gy nr nl l nm nn">const item = $(el).html();</span><span id="d951" class="mo lq in nf b gy nr nl l nm nn">if(numbers.length &lt; 20 &amp;&amp; !isNaN(parseFloat(item))){</span><span id="7682" class="mo lq in nf b gy nr nl l nm nn">numbers.push(item);</span><span id="f53a" class="mo lq in nf b gy nr nl l nm nn">}</span><span id="e9f2" class="mo lq in nf b gy nr nl l nm nn">})</span><span id="0d1d" class="mo lq in nf b gy nr nl l nm nn">console.log(numbers)</span><span id="b2ef" class="mo lq in nf b gy nr nl l nm nn">}//end if statement</span><span id="4265" class="mo lq in nf b gy nr nl l nm nn">});</span></pre><p id="8574" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是完整的代码。</p><p id="074b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">它也可以在我的GitHub库<a class="ae ks" href="https://github.com/kyledeguzmanx/fDev-API-SpotifyMonthlyStreams" rel="noopener ugc nofollow" target="_blank">spotifymonthystreams</a>中找到。看看这个。</p></div><div class="ab cl os ot hr ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="ig ih ii ij ik"><p id="3a0f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">希望这篇教程有所帮助。在我写的时候，选择器确实变得越来越复杂。或许在不久的将来，我会制作一个更基础的教程。</p><p id="660d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">感谢您的阅读。</p><h2 id="1e4c" class="mo lq in bd lr mp mq dn lv mr ms dp lz lc mt mu mb lg mv mw md lk mx my mf mz bi translated">进一步阅读</h2><div class="ns nt gp gr nu nv"><a rel="noopener  ugc nofollow" target="_blank" href="/overcoming-3-major-web-scraping-challenges-that-developers-face-1e664ffe4783"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd io gy z fp oa fr fs ob fu fw im bi translated">克服开发者面临的3大网络抓取挑战</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">如何克服3个主要的网络抓取限制—动态网站、网站交互和指纹管理…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="oe l"><div class="oz l og oh oi oe oj km nv"/></div></div></a></div><div class="ns nt gp gr nu nv"><a rel="noopener  ugc nofollow" target="_blank" href="/automate-web-scraping-with-an-easy-to-use-browser-extension-cb6073f1e61d"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd io gy z fp oa fr fs ob fu fw im bi translated">使用易于使用的浏览器扩展自动抓取网页</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">如何使用Listly，一个初学者友好的无代码工具，轻松实现web抓取过程的自动化。</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="oe l"><div class="pa l og oh oi oe oj km nv"/></div></div></a></div><p id="8276" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="mn">更多内容看</em> <a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="mn">说白了。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="mn">免费周报</em> </strong> </a> <em class="mn">。关注我们关于</em> <a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="mn">推特</em></strong></a><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mn">LinkedIn</em></strong></a><em class="mn"/><a class="ae ks" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mn">YouTube</em></strong></a><em class="mn"/><a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mn">不和</em> </strong> </a> <em class="mn">。</em></strong></a></p></div></div>    
</body>
</html>