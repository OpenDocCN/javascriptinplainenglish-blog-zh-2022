<html>
<head>
<title>Angular Change Detection is No Longer a Black Box</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度变化检测不再是一个黑匣子</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/angular-change-detection-is-no-longer-a-black-box-6c45b1f8e65f?source=collection_archive---------3-----------------------#2022-04-12">https://javascript.plainenglish.io/angular-change-detection-is-no-longer-a-black-box-6c45b1f8e65f?source=collection_archive---------3-----------------------#2022-04-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/a9ef32c699d70373bd7b5c0ecc9c37fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kEI-iURpxtwEv3o_HxqHLA.jpeg"/></div></div></figure><p id="afd0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你好啊，小白脸！我将负责更新商业模式，而你将负责改变观点。</p><p id="6782" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">听起来很棒？没有吗？为什么不把CD(变化检测)当作一个黑盒，依靠Angular来为我们做这件事呢？</p><p id="e421" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">1.事情并不总是像你期望的那样发展。有时，组件中的数据会更新，但视图不会更新。如果你明白光盘是如何工作的，你就会知道如何解决这个问题。</p><p id="818b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">2.你必须意识到CD如何影响应用程序的性能。</p><p id="e001" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这篇文章是一个瞥见CD世界的好地方。</p><h2 id="5db2" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated"><strong class="ak">什么是变更检测(CD)？</strong></h2><p id="61eb" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">当数据发生变化时更新视图(DOM)的过程。</p><p id="1f86" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">模型的数据(组件)可以包括对象、数组和基本类型，它们都将作为表单、输入或用户可以查看和交互的任何其他内容显示在dom上。</p><p id="3ac4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">每当我们对组件数据进行更改时，模板会立即呈现出来</p><p id="4fb1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">作为开发人员，我们的工作是保持模型的业务逻辑是最新的，Angular通过其CD机制负责视图渲染。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lr"><img src="../Images/870d5d7661ce88c2485335fe784bea45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Dnx7CMkF_p3-Z-eILcUhQ.jpeg"/></div></div></figure><h2 id="1501" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated"><strong class="ak">它是如何工作的？</strong></h2><p id="169d" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">对于每个组件，将创建变化检测器并将其排列在树中。</p><p id="a69b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">CD从上到下检查树中的每个组件，查看模型中的数据是否发生了变化，如果发生了变化，它将呈现并更新DOM。</p><p id="3d45" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">角度从上到下运行CD。这里没有循环！如果在完成更改检测后更改了某个值，将出现以下错误:“ExpressionChangedAfterItHasBeenCheckedError”。</p><p id="d98d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">我肯定你以前见过那个错误。</strong></p><h2 id="252b" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated"><strong class="ak">CD什么时候运行？</strong></h2><p id="96c3" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">每当发生以下情况之一时，它都会运行更改检测器:</p><ol class=""><li id="f570" class="lw lx in jx b jy jz kc kd kg ly kk lz ko ma ks mb mc md me bi translated">事件，如点击<em class="mf">或</em>提交</li><li id="b05a" class="lw lx in jx b jy mg kc mh kg mi kk mj ko mk ks mb mc md me bi translated">HTTP呼叫</li><li id="1257" class="lw lx in jx b jy mg kc mh kg mi kk mj ko mk ks mb mc md me bi translated">SetTimeOut()或setInterval()</li></ol><p id="0383" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然而，Angular如何知道一个异步操作刚刚发生了呢？它怎么知道用户只是点击或者数据被更新了呢？</p><p id="62dd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">嗯，它不知道，所以，谁是那个说“嘿Angular，现在是渲染用户的最佳时机，只需提交一个表单！”</p><p id="4e4e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> Zone.js </strong></p><p id="c482" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">区域是一个执行上下文，或者你可以说它保存了关于当前代码运行的环境的信息，就好像区域是一个老大哥，知道关于异步/同步任务的一切，包括它何时开始和结束。</p><p id="3112" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Angular使用NgZone(区域的分支)通知Angular运行cd。</p><h2 id="fad3" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated"><strong class="ak">听起来很神奇，但是要多少钱呢？</strong></h2><p id="036c" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">性能就是价格。</p><p id="ce56" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Angular在每次事件触发变化检测(Dom event，HTTP，timer)时，从上到下检查组件树中的每个组件。例如，如果父组件有一个输入并且用户输入，那么CD将在该组件及其所有子组件上运行，即使它们都不需要更新。</p><p id="f92f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果我们有一个复杂的应用程序，它会降低速度，用户体验可能会受到影响</p><p id="e835" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">那么，如果我们的应用程序极其庞大和复杂，我们能做什么呢？</p><p id="fd24" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">好消息是，我们不必接受如此糟糕的性能，通过使用onPush方法或“ngZonengZone.runOutsideAngula”，您可能会显著减少CD调用的数量并优化性能。但这是另一篇博客文章的主题。</p><p id="75c4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mf">更多内容请看</em><a class="ae ml" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="mf">plain English . io</em></strong></a><em class="mf">。报名参加我们的</em> <a class="ae ml" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="mf">免费周报</em> </strong> </a> <em class="mf">。关注我们关于</em><a class="ae ml" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="mf">Twitter</em></strong></a><em class="mf">和</em><a class="ae ml" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="mf">LinkedIn</em></strong></a><em class="mf">。加入我们的</em> <a class="ae ml" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="mf">社区不和谐</em> </strong> </a> <em class="mf">。</em></p></div></div>    
</body>
</html>