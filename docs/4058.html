<html>
<head>
<title>Angular: Create a Custom RXJS Operator for Reusing Multiple Other Repetitive RXJS Operators</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular:创建一个自定义RXJS操作符，用于重用多个其他重复的RXJS操作符</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/angular-creating-a-custom-rxjs-operator-for-reusing-multiple-other-repetitive-rxjs-operators-d5c459fe0c0f?source=collection_archive---------3-----------------------#2022-10-21">https://javascript.plainenglish.io/angular-creating-a-custom-rxjs-operator-for-reusing-multiple-other-repetitive-rxjs-operators-d5c459fe0c0f?source=collection_archive---------3-----------------------#2022-10-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="46c8" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何创建一个定制的RXJS操作符来代替在多个方法中使用的重复操作符。</h2></div><p id="7f7d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">作为Angular/Typescript开发人员，您可能经常遇到这种情况，在这种情况下，相同的几行代码在多个方法中重复。</p><p id="c47e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果那几行代码是RXJS操作符，并且您希望避免每次都在多个方法中编写它们，该怎么办？</p><p id="27e0" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这个故事中，我的重点是如何创建一个定制的RXJS操作符，它可以代替在多个方法中使用的重复操作符。我创建了一个简单的angular项目，只有一个<strong class="ke io"> AppComponent </strong>和一个<strong class="ke io"> TestService </strong>来演示这一点。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/d5e4ae9ef97ebee4f055a9a67efe5482.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wFvaRTXKY5F9OGuwGJypVw.png"/></div></div></figure><p id="d7fc" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将获取虚拟用户数据，并使用上面截图中的按钮发布数据。在请求开始后，我们有3个动作是2个任务共有的。</p><p id="52f9" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">1.如果请求成功= &gt;隐藏微调器并显示数据。</p><p id="41a7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2.如果请求失败= &gt;隐藏微调器并显示错误消息。</p><p id="7b33" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.最后，每当组件被销毁时，清理所有的订阅。</p><p id="323c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">目标是将这3个常见的操作合并到一个定制的RXJS操作符中，该操作符可以在这两个任务中重用。</p><p id="5bdd" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从<strong class="ke io">测试服务</strong>开始。我定义了两个方法<strong class="ke io"> getUsers() </strong>和<strong class="ke io"> getPosts() </strong>来获取userId为10的用户的用户和发布数据。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="lk ll l"/></div></figure><p id="1436" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> AppComponent </strong> <strong class="ke io">模板</strong></p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="lk ll l"/></div></figure><p id="8d0a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">1.我们已经使用<strong class="ke io"> Primeng NPM模块</strong>在项目中添加了一个装载旋转器。甚至一个简单的旋转图像就足够了。该微调器的可见性由<strong class="ke io"> canSpin </strong>属性控制。</p><p id="ef50" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2.我们订阅了<strong class="ke io"> errorListObsv$ </strong>,使用<strong class="ke io">异步管道</strong>来显示2个任务中遇到的所有错误。</p><p id="ca8a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.我们使用<strong class="ke io">异步管道</strong>订阅可观察到的<strong class="ke io">用户$ </strong>和<strong class="ke io">帖子$ </strong>，以分别显示用户和帖子数据。</p><p id="b4d7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> AppComponent类</strong></p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="lk ll l"/></div></figure><ol class=""><li id="1a50" class="lm ln in ke b kf kg ki kj kl lo kp lp kt lq kx lr ls lt lu bi translated">点击<strong class="ke io">获取用户</strong>按钮将调用组件类中的<strong class="ke io">获取用户()</strong>。如下图所示，<strong class="ke io"> canSpin </strong>属性被设置为true。这意味着将显示加载微调器。</li></ol><pre class="kz la lb lc gt lv lw lx ly aw lz bi"><span id="8533" class="ma mb in lw b gy mc md l me mf"><strong class="lw io">getUsers()</strong> {<br/><strong class="lw io">this.canSpin</strong> = true;<br/><strong class="lw io">this.users$</strong> = <strong class="lw io">this.service.getUsers()</strong>.pipe(<strong class="lw io">this.handle().bind(this)</strong>);</span><span id="0603" class="ma mb in lw b gy mg md l me mf">}</span></pre><p id="e5cd" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">测试服务</strong>中的【getUsers()】被调用。该方法返回一个可观察对象，我们通过管道将由<strong class="ke io">句柄()返回的自定义RXJS操作符传递给该可观察对象。</strong>我们使用异步管道在模板中订阅这个可观察的<strong class="ke io">用户$ </strong>。</p><p id="fe47" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2.点击<strong class="ke io"> Get Posts </strong>按钮将调用组件类中的<strong class="ke io"> getPosts() </strong>。如下所示，<strong class="ke io"> canSpin </strong>属性被设置为true。这意味着将显示加载微调器。</p><pre class="kz la lb lc gt lv lw lx ly aw lz bi"><span id="cb10" class="ma mb in lw b gy mc md l me mf"><strong class="lw io">getPosts()</strong> {<br/><strong class="lw io">this.canSpin</strong> = true;<br/><strong class="lw io">this.posts$</strong> = <strong class="lw io">this.service.getPosts()</strong>.pipe(<strong class="lw io">this.handle().bind(this)</strong>);</span><span id="dc2a" class="ma mb in lw b gy mg md l me mf">}</span></pre><p id="6f53" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">测试服务</strong>中的<strong class="ke io"> getPosts() </strong>被调用。该方法返回一个可观察对象，我们通过管道将由<strong class="ke io">句柄()返回的自定义RXJS操作符传递给该可观察对象。</strong>我们正在使用异步管道订阅模板中的这个可观察的<strong class="ke io">帖子$ </strong>。</p><p id="c7cd" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.最后，我们到达<strong class="ke io"> handle() </strong>，在这里我们创建自定义操作符。</p><p id="ef7d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了创建操作符，我们首先返回一个<strong class="ke io">函数</strong>，它将源可观察值作为参数。源可观察对象就是<strong class="ke io">测试服务</strong>中的<strong class="ke io"> getUsers()/getPosts() </strong>返回的可观察对象。</p><p id="24f2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这个函数中，我们在给它输送了一些操作符后，返回了这个相同的可观察对象。</p><p id="c2ab" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">映射操作符将把响应连接成一个空数组。这样做是为了不管响应是对象还是数组，我们最终都有一个数组。</p><p id="24be" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> = &gt; catchError操作符</strong>将处理任何由可观察源抛出的错误。在这个操作符中，<strong class="ke io"> errorList$ </strong>主题将发出错误对象。我们订阅了模板中的<strong class="ke io"> errorListObsv$ </strong>来显示错误。</p><p id="2917" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> = &gt;完成操作符</strong>将会执行，不管观察值是成功还是出错。因此，在该操作符内部，<strong class="ke io"> canSpin </strong>将被设置为true，以隐藏加载微调器。</p><p id="018b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">=&gt; <strong class="ke io"> takeUntil操作符，</strong>将在<strong class="ke io"> destroy$ </strong>主题发出一个值时清除对源可观察的所有订阅。请注意，当<strong class="ke io"> ngOnDestroy </strong>生命周期挂钩执行如下时，<strong class="ke io"> destroy$ </strong>主题发出一个值。</p><pre class="kz la lb lc gt lv lw lx ly aw lz bi"><span id="7ccf" class="ma mb in lw b gy mc md l me mf"><strong class="lw io">ngOnDestroy()</strong> {<br/>this.destroy$.next(true);<br/>this.destroy$.complete();<br/>}</span></pre><p id="cd85" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，我们没有在<strong class="ke io"> getUsers() </strong>和<strong class="ke io"> getPosts() </strong>的<strong class="ke io"> AppComponent </strong>类中重复这4个操作符，而是将它添加到一个自定义操作符中，只要需要执行一组类似的操作，就可以重用这个操作符。</p><p id="1cf1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是我点击2个按钮时数据的显示方式。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi mh"><img src="../Images/333ae5f37468198afa3c9babe4c8426f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ImCBeY5VJHYsNlU3_uFcw.png"/></div></div></figure><p id="bd9c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了检查错误场景，您可以如下修改<strong class="ke io"> TestService </strong>以在单击按钮时抛出错误。</p><pre class="kz la lb lc gt lv lw lx ly aw lz bi"><span id="7bd5" class="ma mb in lw b gy mc md l me mf"><strong class="lw io">getUsers()</strong> {<br/>return this.http.get(‘https://jsonplaceholder.typicode.com/users/<strong class="lw io">12</strong>');<br/>}</span><span id="b914" class="ma mb in lw b gy mg md l me mf"><strong class="lw io">getPosts()</strong> {<br/>return this.http.get(<br/>‘https://jsonplaceholder.typicode.com/post'<br/>);<br/>}</span></pre><p id="4ec1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> getUsers() </strong>将尝试获取不存在的<strong class="ke io"> userId 12 </strong>的数据，而<strong class="ke io"> getPosts() </strong>正在尝试访问不存在的API。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi mi"><img src="../Images/c20cd58d316ffa7ad4f6662d0b64a7da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ytLElE3FTiqidshpHHr9vA.png"/></div></div></figure><p id="e04b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以在下面找到完整的工作示例。</p><div class="mj mk gp gr ml mm"><a href="https://stackblitz.com/edit/angular-cpvcff?file=src/app/app.component.ts" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd io gy z fp mr fr fs ms fu fw im bi translated">角形(叉形)堆叠</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">一个基于rxjs，tslib，core-js，zone.js，@angular/core，@angular/forms，@angular/common的angular-cli项目…</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">stackblitz.com</p></div></div><div class="mv l"><div class="mw l mx my mz mv na li mm"/></div></div></a></div><p id="2929" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nb">更多内容看</em> <a class="ae nc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nb">说白了就是io </em> </strong> </a> <em class="nb">。报名参加我们的</em> <a class="ae nc" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nb">免费周报</em> </strong> </a> <em class="nb">。关注我们关于</em> <a class="ae nc" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nb">推特</em> </strong> </a>，<a class="ae nc" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nb">领英</em> </strong> </a> <em class="nb">，</em><a class="ae nc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="nb">YouTube</em></strong></a><em class="nb"/><a class="ae nc" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="nb">不和</em> </strong> </a> <em class="nb">。对增长黑客感兴趣？检查</em> <a class="ae nc" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nb">电路</em> </strong> </a> <em class="nb">。</em></p></div></div>    
</body>
</html>