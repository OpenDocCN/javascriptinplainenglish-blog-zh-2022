<html>
<head>
<title>Parallax Effect to Scroll View Items in React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React Native中滚动视图项目的视差效果</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/parallax-effect-to-scroll-view-items-in-react-native-a2265ce81cba?source=collection_archive---------0-----------------------#2022-01-02">https://javascript.plainenglish.io/parallax-effect-to-scroll-view-items-in-react-native-a2265ce81cba?source=collection_archive---------0-----------------------#2022-01-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="6c83" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">在React Native中创建视差滚动效果。</h2></div><p id="af8c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如今，动画是用户体验的一个非常重要的部分，它们允许你在你的界面中传达真实可信的动作，并且极大地提高了用户界面的质量。</p><p id="1ec5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在过去的几天里，我在React Native中搜索一个包来创建这种视差滚动效果，(这里有一个用flutter<a class="ae ky" href="https://docs.flutter.dev/assets/images/docs/cookbook/effects/ParallaxScrolling.gif" rel="noopener ugc nofollow" target="_blank">https://docs . flutter . dev/assets/images/docs/cookbook/effects/parallax scrolling . gif</a>做的例子)，但我没有好的库来帮助我，所以我决定自己动手，使用<a class="kz la ep" href="https://medium.com/u/23d9a033fed2?source=post_page-----a2265ce81cba--------------------------------" rel="noopener" target="_blank">软件大厦</a>提供给我们的Reanimated 2从头开始创建它。</p><p id="ed39" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">至于今天，这是我们将要得到的结果:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/0f0aece140060b53f5e5c27b7819e1d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wRk9WoFrn4PCWrYLSyvs-Q.gif"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Final Outcome</figcaption></figure><p id="6f4c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们深入研究一下。首先，我们必须创建我们的项目:</p><pre class="lc ld le lf gt lr ls lt lu aw lv bi"><span id="ca83" class="lw lx in ls b gy ly lz l ma mb">npx react-native init parallaxAnimation</span></pre><p id="3c1b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">初始化我们的项目后，我们需要使用我们的<code class="fe mc md me ls b">Reanimated Library</code>。</p><pre class="lc ld le lf gt lr ls lt lu aw lv bi"><span id="0391" class="lw lx in ls b gy ly lz l ma mb">yarn add react-native-reanimated</span></pre><p id="89b5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后我们就要按照安装指南来了，这里都列出来了:<a class="ae ky" href="https://docs.swmansion.com/react-native-reanimated/docs/fundamentals/installation" rel="noopener ugc nofollow" target="_blank">https://docs . SW mansion . com/react-native-reanimated/docs/fundamentals/installation</a></p><p id="725c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如我们所知，Reactived是一个react本地库，允许创建流畅的动画和交互，在UI线程上运行，并帮助我们做神奇的🪄</p><p id="5677" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">与react-native动画API一样，它提供动画。视图、滚动视图等等…它还提供了布局动画。</p></div><div class="ab cl mf mg hr mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ig ih ii ij ik"><p id="18c2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们动手做一些代码。</p><p id="88de" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是我们的基本代码:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mm mn l"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Basic code gist</figcaption></figure><p id="4650" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，我们必须将我们的视图、ScrollView等转换成一些动画组件。</p><p id="8ce9" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，我们将把滚动视图转换成动画视图:</p><pre class="lc ld le lf gt lr ls lt lu aw lv bi"><span id="ecf9" class="lw lx in ls b gy ly lz l ma mb">import Animated from 'react-native-reanimated'</span><span id="a661" class="lw lx in ls b gy mo lz l ma mb">&lt;FlatList&gt;&lt;/FlatList&gt; =&gt; &lt;Animated.FlatList&gt;&lt;/Animated.FlatList&gt;</span></pre><p id="df89" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注意:如果您的建议列表中没有显示平面列表，我们可以通过执行以下操作来创建它:</p><pre class="lc ld le lf gt lr ls lt lu aw lv bi"><span id="a300" class="lw lx in ls b gy ly lz l ma mb">const AnimatedFlatList = Animated.createAnimatedComponent(FlatList)</span><span id="742f" class="lw lx in ls b gy mo lz l ma mb">then we use it as :</span><span id="0da3" class="lw lx in ls b gy mo lz l ma mb">&lt;AnimatedFlatList&gt;&lt;/AnimatedFlatList&gt;</span></pre><p id="caed" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在将我们的平面列表转换成动画组件后，只要我们滚动，我们就必须检索我们的滚动位置，这里我们将使用useSharedValue来存储scrollY，并使用AnimatedscrollHandler来处理滚动事件(Scroll、Momentum等)。):</p><pre class="lc ld le lf gt lr ls lt lu aw lv bi"><span id="a10b" class="lw lx in ls b gy ly lz l ma mb">const scrollPosition = useSharedValue(0);</span></pre><p id="a8b2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，</p><pre class="lc ld le lf gt lr ls lt lu aw lv bi"><span id="a245" class="lw lx in ls b gy ly lz l ma mb">const handleScroll = useAnimatedScrollHandler(<br/>    {<br/>      onScroll: event =&gt; {<br/>        scrollPosition.value = event.contentOffset.y;<br/>      }<br/>    }<br/>);</span></pre><p id="e339" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">之后，我们将它绑定到我们的FlatList，并将scrollEventThrottle设置为16，以捕获所有滚动事件:</p><pre class="lc ld le lf gt lr ls lt lu aw lv bi"><span id="f0b7" class="lw lx in ls b gy ly lz l ma mb">&lt;AnimatedFlatList<br/>    onScroll={handleScroll} <br/>    scrollEventThrottle={16}<br/>   ...<br/>/&gt;</span></pre><p id="d330" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们已经保存了滚动位置，我们需要将它作为一个道具传递给组件。</p><p id="aa4b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们必须为动画设置输入范围，这样我们就可以在这个范围内<code class="fe mc md me ls b">Interpolate</code>值。</p><p id="ebfa" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，我们必须将项目组件转换为动画组件，我们只制作图像动画(我们将使其在Y轴上平移，因此图像将成为动画组件:</p><pre class="lc ld le lf gt lr ls lt lu aw lv bi"><span id="eb44" class="lw lx in ls b gy ly lz l ma mb">const Item=({index, scrollPosition})=&gt;{<br/>  return (<br/>      &lt;View key={index} style={styles.scrollContent}&gt;<br/>        &lt;Animated.Image<br/>          style={[{<br/>           height: <strong class="ls io"><em class="mp">Dimensions</em></strong>.get('screen').height*2,<br/>           width: <strong class="ls io"><em class="mp">Dimensions</em></strong>.get('window').width,<br/>           resizeMode:'cover',<br/>        }]} <br/>          source={{uri:'https://random.imagecdn.app/1920/1080'}}/&gt;<br/>      &lt;Text <br/>        style={[<br/>          {color: 'white', position: 'absolute',zIndex:99, <br/>          fontSize: 50, bottom: 10}]}<br/>        &gt;<br/>         hehehehhehe<br/>        &lt;/Text&gt;<br/>      &lt;/View&gt;<br/>  )<br/>}</span></pre><p id="59c4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们必须添加我们的动画样式，这可以通过使用动画样式钩子来完成，我们的组件应该看起来像这样:</p><pre class="lc ld le lf gt lr ls lt lu aw lv bi"><span id="4082" class="lw lx in ls b gy ly lz l ma mb">const Item=({index, scrollPosition})=&gt;{</span><span id="c9b4" class="lw lx in ls b gy mo lz l ma mb"><br/>const {height, width} = useWindowDimensions()  </span><span id="187e" class="lw lx in ls b gy mo lz l ma mb">const imageAnimatedStyle = useAnimatedStyle(() =&gt; {<br/>    const translateY = interpolate(<br/>        scrollPosition.value,<br/>        [(index-1)* height/2, index*height/2, (index+1)*height/2],<br/>        [-100, 0, 100],<br/>    );<br/>    return {<br/>      transform: [{translateY}],<br/>    };<br/>  }, []);</span><span id="11ee" class="lw lx in ls b gy mo lz l ma mb">  return (<br/>      &lt;View key={index} style={styles.scrollContent}&gt;<br/>        &lt;Animated.Image<br/>          style={[{<br/>           height: <strong class="ls io"><em class="mp">height</em></strong>*1.5,<br/>           width: <strong class="ls io"><em class="mp">width</em></strong>,<br/>           resizeMode:'cover',<br/>         },<br/>         <strong class="ls io"><em class="mp">imageAnimatedStyle</em></strong>             <br/>        ]} <br/>          source={{uri:'https://random.imagecdn.app/1920/1080'}}/&gt;<br/>      &lt;Text <br/>        style={[<br/>          {color: 'white', position: 'absolute',zIndex:99, <br/>          fontSize: 50, bottom: 10}]}<br/>        &gt;<br/>         hehehehhehe<br/>        &lt;/Text&gt;<br/>      &lt;/View&gt;<br/>  )<br/>}</span></pre><p id="d1c1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在让我们一步一步地解释代码:</p><p id="1f3f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，我们从props中检索我们的滚动位置，然后我们通过滚动位置进行插值，这样我们的范围将是我们的项目、上一个和下一个，这样我们就可以知道我们是向上滚动还是向下滚动，然后我们将动画样式附加到图像样式的其余部分。</p><p id="122c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们就像在玩Y轴上图像的位置，我们将上下移动一点点来获得这个漂亮的视差效果。</p><p id="6369" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面是最终的代码:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mm mn l"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Final code</figcaption></figure></div><div class="ab cl mf mg hr mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ig ih ii ij ik"><p id="05f3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">编码快乐！</p><p id="8c82" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mp">更多内容看</em> <a class="ae ky" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="mp">说白了。报名参加我们的</em> </a><a class="ae ky" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="mp">免费每周简讯</em> </a> <em class="mp">。在我们的</em> <a class="ae ky" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <em class="mp">社区</em> </a> <em class="mp">获得独家写作机会和建议。</em></p></div></div>    
</body>
</html>