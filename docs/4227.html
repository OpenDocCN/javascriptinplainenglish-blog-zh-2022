<html>
<head>
<title>The “detached HEAD” State in Git: What It Is and How to Fix It</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Git中的“分离头”状态:它是什么以及如何修复它</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-detached-head-state-in-git-what-it-is-and-how-to-fix-it-6329bd1dbb7e?source=collection_archive---------8-----------------------#2022-11-10">https://javascript.plainenglish.io/the-detached-head-state-in-git-what-it-is-and-how-to-fix-it-6329bd1dbb7e?source=collection_archive---------8-----------------------#2022-11-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/58f27a17eae5acc8922a33cd7473dd86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S6BCCM7BaUVLtNpq0B7xZA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Illustration by the author</figcaption></figure><p id="43f5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用Git时，一个常见的困惑是当您看到如下输出时，不知道它的全部含义:</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="b386" class="lj lk iq lf b gy ll lm l ln lo">You are in 'detached HEAD' state. You can look around, make experimental changes and commit them, and you can discard any commits you make in thisstate without impacting any branches by switching back to a branch.</span></pre><h1 id="f4b1" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">这一切意味着什么？</h1><p id="ed23" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">为了真正理解发生了什么，我们需要看看Git的内部。</p><p id="7172" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Git提交是不可变的——这意味着您可以创建新的提交，但是已经提交的内容永远不会改变。这就是我们的存储库为我们保护数据安全的方式。对存储库进行更改的唯一方法是创建新的提交。</p><p id="3dc2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Git提交为我们提供了一个稳定、完整的存储库变更历史。在这个稳定的基础之上，我们有一个动态的部分:分支。首先令人惊讶的是，分支只是标签。它们指向一个提交。除了名字和它的位置，它们没有其他数据。</p><p id="3bbc" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">除此之外的任何事情，例如，</p><ul class=""><li id="fefd" class="mr ms iq ke b kf kg kj kk kn mt kr mu kv mv kz mw mx my mz bi translated">主或主的特殊含义，</li><li id="0334" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">像<code class="fe nf ng nh lf b">feature/&lt;info&gt;</code>或<code class="fe nf ng nh lf b">&lt;branch-owner&gt;/&lt;description&gt;</code>这样的模式只是团队使用的惯例。从Git的角度来看，你的<code class="fe nf ng nh lf b">main</code>或者<code class="fe nf ng nh lf b">master</code>分支和<code class="fe nf ng nh lf b">lorem-ipsum</code>没什么区别。</li></ul><h1 id="eefa" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">当前提交</h1><p id="b8d1" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">HEAD是一个指向当前提交的指针——您现在在存储库中的位置。它被用作:</p><ul class=""><li id="82d1" class="mr ms iq ke b kf kg kj kk kn mt kr mu kv mv kz mw mx my mz bi translated">当您想通过<code class="fe nf ng nh lf b">git diff</code>查看工作副本的最后更改时的参考点</li><li id="b8f3" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">创建新提交时将用作父提交的提交</li></ul><p id="f6f4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">你的头脑是你的仓库状态的核心部分。</p><h1 id="5f2b" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">正规状态</h1><p id="2be2" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">Git的典型工作流程如下:</p><ul class=""><li id="b765" class="mr ms iq ke b kf kg kj kk kn mt kr mu kv mv kz mw mx my mz bi translated">你在某个树枝上，</li><li id="3ee4" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">您创建新的提交，然后</li><li id="2746" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">Git将您的分支移动到这个新的提交。</li></ul><p id="9643" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你只限于检查分支，你将永远不会离开这种状态。当你运行<code class="fe nf ng nh lf b">git status</code>时，它会告诉你你在哪个分支上:</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="fb35" class="lj lk iq lf b gy ll lm l ln lo">$ git status<br/>On branch main<br/>Your branch is up to date with 'origin/main'.<br/><br/>nothing to commit, working tree clean</span></pre><h1 id="608c" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">分离头</h1><p id="a9d3" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">到目前为止，HEAD(当前提交)和branch处于正常的对齐状态。当您签出不是分支的东西时，事情就变得复杂了——例如，当您根据ID切换到commit:</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="0db3" class="lj lk iq lf b gy ll lm l ln lo">$ git checkout abc01e7</span></pre><p id="328d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">其中<code class="fe nf ng nh lf b">abc01e7</code>是存储库中任何提交的ID——它可以在任何分支内部，在其中一个分支之上，或者在存储库历史的另一个地方。</p><p id="0554" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因为您不再在分支上，所以<code class="fe nf ng nh lf b">git status</code>变为:</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="9b5c" class="lj lk iq lf b gy ll lm l ln lo">$ git status<br/>HEAD detached at abc01e7<br/>nothing to commit, working tree clean</span></pre><p id="3e93" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了引起您对这种情况的注意，将颜色<code class="fe nf ng nh lf b">HEAD detached</code>设置为红色。</p><h1 id="366a" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">为什么要切换到commit而不是branch？</h1><p id="7212" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">因为你可以，而且它有时会很有用。一个常见的场景是查看应用程序在几次提交之前是如何工作的——例如，用于故障排除。我们注意到了一些错误，比如一个特性没有像预期的那样工作，我们检查了最后一次提交，我们期望它工作正常。通过这种方式，我们可以准确地确定问题是何时出现的。</p><h1 id="6e99" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">它对工作有什么影响？</h1><p id="378a" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">因为您不在分支上，所以当您创建新的提交时，Git没有分支可以更新。因此，您在那里创建的所有提交都被<strong class="ke ir">存储在</strong>中，但却悬而未决:没有办法轻松地到达它们，因此，它们被认为是不重要的。在某个时候，垃圾收集器会将它们从存储库中永久删除。</p><h1 id="d2fc" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">怎么发生的？</h1><p id="4bb6" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">你离开了树枝，把头移到了别处。有可能发生:</p><ul class=""><li id="3ba9" class="mr ms iq ke b kf kg kj kk kn mt kr mu kv mv kz mw mx my mz bi translated">通过检验非分支引用:</li><li id="16ba" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated"><code class="fe nf ng nh lf b">git checkout &lt;commit ID&gt;</code>——同上</li><li id="535f" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated"><code class="fe nf ng nh lf b">git checkout HEAD^</code>-最后一次提交</li><li id="366e" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated"><code class="fe nf ng nh lf b">git checkout &lt;tag&gt;</code>-标签类似于分支，但是它们是不可变的，不能作为分支更新</li><li id="14b9" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">当您的<code class="fe nf ng nh lf b">git rebase</code>中途停止时——由于冲突或者为了让您对提交进行更改，</li><li id="8b10" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">期间<code class="fe nf ng nh lf b">git bisect</code></li></ul><h1 id="c722" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">怎么修</h1><p id="e17f" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">幸运的是，当您检查非分支引用时，您可以直接在CLI中获得一些指令:</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="b06b" class="lj lk iq lf b gy ll lm l ln lo">$ git checkout abc01e7<br/>Note: switching to 'abc01e7'.<br/><br/>You are in 'detached HEAD' state. You can look around, make <br/>experimental changes and commit them, and you can discard any <br/>commits you make in this state without impacting any branches <br/>by switching back to a branch.<br/><br/>If you want to create a new branch to retain commits you <br/>create, you may do so (now or later) by using -c with the <br/>switch command. Example:<br/><br/>  git switch -c &lt;new-branch-name&gt;<br/><br/>Or undo this operation with:<br/><br/>  git switch -<br/><br/>Turn off this advice by setting config variable <br/>advice.detachedHead to false</span></pre><h1 id="69f6" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">创建新分支</h1><p id="42a1" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">您可以创建一个新的分支，就在您所在的地方——包括您可能从那里创建的所有提交。您可以使用以下语法创建分支:</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="ce97" class="lj lk iq lf b gy ll lm l ln lo">git switch -c &lt;new-branch-name&gt;</span></pre><p id="e3f5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">或者命令格式Git 2.23之前的版本:</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="5c78" class="lj lk iq lf b gy ll lm l ln lo">git checkout -b &lt;new-branch-name&gt;</span></pre><p id="bca3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这些命令<strong class="ke ir">创建</strong>一个新的分支，并将其设置为当前分支。</p><p id="7b4b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">或者，您可以在当前提交上创建一个新的分支，并保持在分离的头状态:</p><h1 id="02de" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">切换到一个分支并合并您的提交</h1><p id="03fc" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">或者，您可以选择一个现有的分支，或者合并您的悬空提交，或者精选它们。如果你不确定这些术语的意思，那么坚持创建一个新的分支，因为它将允许你做同样的事情，但是在一个不那么混乱的设置中。</p><h1 id="56e3" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">它在工具中看起来怎么样</h1><p id="ed13" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">除了<code class="fe nf ng nh lf b">git status</code>，你怎么能看到这种状态？</p><h1 id="8a78" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">您可以在Git树形图中看到它</h1><p id="0848" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">如果你使用<code class="fe nf ng nh lf b">git log --oneline --graph --decorate --all</code>(我推荐用<a class="ae ni" href="https://how-to.dev/how-to-display-git-branches-as-a-tree-in-cli" rel="noopener ugc nofollow" target="_blank">定义为<code class="fe nf ng nh lf b">git tree</code>别名的东西)它会以不同的方式显示你的头部。当它在分支上时，输出看起来像这样:</a></p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="8c94" class="lj lk iq lf b gy ll lm l ln lo">$ git tree<br/>* abc01e7 (HEAD -&gt; main, origin/main) Add lorem ipsum to readme<br/>* edd3504 Add readme</span></pre><p id="b89e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe nf ng nh lf b">HEAD</code>用箭头指向你所在的树枝。当处于“分离头”状态时，<code class="fe nf ng nh lf b">main</code>和<code class="fe nf ng nh lf b">HEAD</code>分别显示，作为不相关的参考:</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="5d83" class="lj lk iq lf b gy ll lm l ln lo">$ git tree<br/>* abc01e7 (HEAD, origin/main, main) Add lorem ipsum to readme<br/>* edd3504 Add readme</span></pre><p id="8913" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当你知道你为什么要关注它时，这种差异是微妙而明显的。</p><h1 id="3310" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">GitHub桌面</h1><p id="14ab" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">在<code class="fe nf ng nh lf b">main</code>分支机构:</p><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/1597550567421b9dbbbb89a860e27045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3MsVXITqK3J3wlhW"/></div></div></figure><p id="b39e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">“分离头”状态:</p><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/e754e7186013f91506fca5254e2ce7f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*x_vludQZjDSUvUfD"/></div></div></figure><p id="d841" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">你能看出页眉中间部分的区别吗？一个是显示“当前分支”；而另一个“分离的头”。</p><h1 id="0a25" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">源树</h1><p id="3628" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">在<code class="fe nf ng nh lf b">main</code>分公司:</p><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/3df8434e8b7b70d0cf9a697b15559b76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aD9L-MCMgbADH5CH"/></div></div></figure><p id="81e9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">“分离头”状态:</p><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/29a4457f360836b3a13603b59457af5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9VS8fv5SEYSgBI09"/></div></div></figure><p id="b956" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">它显示为当前的分支负责人。</p><h1 id="9fc4" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">想了解更多？</h1><p id="9fe0" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">当你开始使用Git时，它有许多令人困惑的地方，但是一旦你更好地理解了它存储数据的方式，它就会变得简单得多。如果你有兴趣了解更多关于Git的知识，请在这里注册<a class="ae ni" href="https://how-to-dev.ck.page/e45bdb4d9b" rel="noopener ugc nofollow" target="_blank">来获取我的Git相关内容的更新。</a></p></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="c391" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="ns">最初发布于</em><a class="ae ni" href="https://how-to.dev/the-detached-head-state-in-git-what-it-is-and-how-to-fix-it" rel="noopener ugc nofollow" target="_blank"><em class="ns">https://how-to . dev</em></a><em class="ns">。</em></p><p id="5379" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="ns">更多内容看</em> <a class="ae ni" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> <em class="ns">说白了就是</em> </strong> </a> <em class="ns">。报名参加我们的</em> <a class="ae ni" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> <em class="ns">免费每周简讯</em> </strong> </a> <em class="ns">。关注我们</em> <a class="ae ni" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> <em class="ns">推特</em> </strong> </a>，<a class="ae ni" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> <em class="ns">领英</em> </strong> </a> <em class="ns">，</em><a class="ae ni" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir"><em class="ns">YouTube</em></strong></a><em class="ns">，</em> <a class="ae ni" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> <em class="ns">不和</em> </strong> </a> <em class="ns">。对增长黑客感兴趣？检查出</em> <a class="ae ni" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> <em class="ns">电路</em> </strong> </a> <em class="ns">。</em></p></div></div>    
</body>
</html>