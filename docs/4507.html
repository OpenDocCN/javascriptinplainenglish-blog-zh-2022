<html>
<head>
<title>How to Make API Calls in React Using RTK Query</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用RTK查询在React中进行API调用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-make-api-calls-using-rtk-query-in-react-apps-b0713d4c7411?source=collection_archive---------6-----------------------#2022-12-09">https://javascript.plainenglish.io/how-to-make-api-calls-using-rtk-query-in-react-apps-b0713d4c7411?source=collection_archive---------6-----------------------#2022-12-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="2aca" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">RTK Query是一个强大的数据获取和缓存工具。它旨在简化在web应用程序中加载数据的常见情况，消除自己编写数据获取和缓存逻辑的需要。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/8d35362b25d2946dc752dea9082fbb90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WCDia_pScg9AVUJCeuQ99Q.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">React + Redux (<a class="ae ks" href="https://miro.medium.com/max/1200/1*meCFnZ5MK_7Fu1ogYfBvNQ.png" rel="noopener">Source</a>)</figcaption></figure><p id="5799" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">作为开发人员，您必须知道，除了进行API调用来构建应用程序之外，您还需要注意各种其他行为，同样:</p><ul class=""><li id="6112" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">跟踪加载状态以显示UI微调器。</li><li id="3c3a" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">避免对相同数据的重复请求。</li><li id="37c2" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">乐观的更新让UI感觉更快。</li><li id="b144" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">在用户与UI交互时管理缓存生存期。</li></ul><p id="42f3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">RTK Query可用于处理所有这些行为以及进行API调用。它在Redux Toolkit的API上有内置的数据获取和缓存逻辑。</p><h1 id="8730" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">为什么要RTK查询？</h1><p id="8272" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">虽然有其他工具可用于解决上述问题，但您应该使用RTK Query，原因如下:</p><ul class=""><li id="9a97" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">您已经有一个现有的Redux应用程序，并希望简化您的API处理逻辑。</li><li id="fcf8" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">您希望能够利用流行的Redux Dev工具扩展来跟踪状态随时间的变化，因为一旦处理了请求，RTK Query就会分派标准的Redux操作。</li><li id="4697" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">它为您提供了在一个地方定义所有端点的能力，并为API调用提供了内置的钩子。</li></ul><h1 id="3649" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">装置</h1><p id="42a0" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">RTK查询与Redux工具包捆绑在一起。所以为了设置它，您需要首先配置redux工具包。请注意，在本文的过程中，我们将使用一个预定义的模板来设置使用Vite的React应用程序。说到这里，让我们开始设置RTK查询。</p><div class="na nb gp gr nc nd"><a href="https://github.com/eshankvaish/react-ts-linting" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd io gy z fp ni fr fs nj fu fw im bi translated">GitHub-eshankvaish/react-ts-林挺:为React类型脚本项目设置的ESLint和更漂亮的</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">github.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr km nd"/></div></div></a></div><h2 id="f016" class="ns me in bd mf nt nu dn mj nv nw dp mn lc nx ny mp lg nz oa mr lk ob oc mt od bi translated">1.设置Redux工具包</h2><p id="20c0" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">通过纱线将<code class="fe oe of og oh b">@reduxjs/toolkit</code>与<code class="fe oe of og oh b">react-redux</code>一起安装；</p><pre class="kd ke kf kg gt oi oh oj bn ok ol bi"><span id="84cf" class="om me in oh b be on oo l op oq">yarn add react-redux@8.0.4<br/>yarn add @reduxjs/toolkit@1.9.0</span></pre><h2 id="a6e3" class="ns me in bd mf nt nu dn mj nv nw dp mn lc nx ny mp lg nz oa mr lk ob oc mt od bi translated">2.为RTK查询添加基本服务</h2><p id="206c" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">现在让我们为RTK查询添加一个基本服务，它将为API端点定义基本URL，并为API调用定义默认超时。默认情况下，<code class="fe oe of og oh b">baseApi</code>使用构建在fetch之上的RTK Query内置<code class="fe oe of og oh b">fetchBaseQuery</code>包装器进行API调用。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="or os l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">RTK Query Base Service</figcaption></figure><h2 id="e9d3" class="ns me in bd mf nt nu dn mj nv nw dp mn lc nx ny mp lg nz oa mr lk ob oc mt od bi translated">3.配置Redux存储</h2><p id="319d" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">既然我们已经完成了基本服务的定义，我们可以用<code class="fe oe of og oh b">baseApi</code>提供的缩减器和中间件来配置redux store。这是为了管理订阅生存期。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="or os l"/></div></figure><h2 id="b6ec" class="ns me in bd mf nt nu dn mj nv nw dp mn lc nx ny mp lg nz oa mr lk ob oc mt od bi translated">4.添加React Redux提供程序</h2><p id="7904" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">让我们在项目的<code class="fe oe of og oh b">main.tsx</code>或<code class="fe oe of og oh b">index.tsx</code>文件中添加React Redux提供程序，以便Redux上下文在整个应用程序中都可用。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="or os l"/></div></figure><h2 id="e4a5" class="ns me in bd mf nt nu dn mj nv nw dp mn lc nx ny mp lg nz oa mr lk ob oc mt od bi translated">5.添加API切片</h2><p id="99bf" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">现在，让我们配置API片段来调用基本URL的<code class="fe oe of og oh b">/users</code>端点，以获取用户列表。我们将动态注入端点，而不是在单个文件中定义所有端点，以便更好地管理我们的API服务。RTK Query通过定义和失效标签来支持自动重新获取数据。如果一个API查询端点提供了一个API标签，而同一个标签由于另一个突变而无效，那么RTK Query会自动为提供该标签的查询触发一个新的请求。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="557a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这差不多是我们在React中进行API调用所需的设置。现在让我们来看看<code class="fe oe of og oh b">useUsersQuery</code>的行动。</p><h2 id="c17e" class="ns me in bd mf nt nu dn mj nv nw dp mn lc nx ny mp lg nz oa mr lk ob oc mt od bi translated">6.使用API钩子获取数据</h2><p id="e22d" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">要使用上面定义的钩子进行API调用，我们只需要将它添加到下面定义的<code class="fe oe of og oh b">UserList</code>组件中，它就会返回一个带有一堆选项的对象，如<code class="fe oe of og oh b">isFetching</code>、<code class="fe oe of og oh b">data</code>和<code class="fe oe of og oh b">error</code>等。我们可以使用<code class="fe oe of og oh b">isFetching</code>变量显示加载状态，一旦<code class="fe oe of og oh b">data</code>变量可用，我们就可以迭代它，在我们的页面上显示用户列表。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="or os l"/></div></figure><h2 id="e033" class="ns me in bd mf nt nu dn mj nv nw dp mn lc nx ny mp lg nz oa mr lk ob oc mt od bi translated">7.更新应用程序文件</h2><p id="5337" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">要查看API调用的运行情况，您需要在<code class="fe oe of og oh b">App.tsx</code>文件中添加<code class="fe oe of og oh b">&lt;UserList /&gt;</code>组件并启动服务器。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="or os l"/></div></figure><h1 id="ea7c" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">结论</h1><p id="e9c0" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">我们最终对JSON占位符API进行了API调用，以获取用户列表并将其显示在UserList页面上。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/9b3ca64c6dc60f791ef81f295bcf81dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*q_QLCQceyRTVj2fuX4HSAg.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">API Call Using RTK Query in React</figcaption></figure><p id="5380" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">和往常一样，下面是Github上完整代码的链接:</p><div class="na nb gp gr nc nd"><a href="https://github.com/eshankvaish/react-rtk-query" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd io gy z fp ni fr fs nj fu fw im bi translated">GitHub-eshankvaish/react-rtk-Query:使用React设置RTK查询</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">github.com</p></div></div><div class="nm l"><div class="ou l no np nq nm nr km nd"/></div></div></a></div></div><div class="ab cl ov ow hr ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="ig ih ii ij ik"><blockquote class="pc pd pe"><p id="4a60" class="kt ku pf kv b kw kx jo ky kz la jr lb pg ld le lf ph lh li lj pi ll lm ln lo ig bi translated"><em class="in">感谢阅读。请分享您对在React应用程序中设置RTK查询进行API调用的想法。另外，如果你觉得这篇文章有用，请考虑在Medium </em>  <em class="in">上关注我，并在你的圈子里分享这篇文章。</em></p></blockquote><pre class="kd ke kf kg gt oi oh oj bn ok ol bi"><span id="da54" class="om me in oh b be on oo l pj oq">Want to connect?<br/>Reach out on <a class="ae ks" href="https://twitter.com/eshankvaish" rel="noopener ugc nofollow" target="_blank">Twitter</a>, <a class="ae ks" href="https://www.linkedin.com/in/eshankvaish/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a> or in the comments below!</span></pre><h1 id="ce7a" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">参考</h1><ul class=""><li id="8c93" class="lp lq in kv b kw mv kz mw lc pk lg pl lk pm lo lu lv lw lx bi translated"><a class="ae ks" href="https://redux-toolkit.js.org/rtk-query/overview" rel="noopener ugc nofollow" target="_blank"> RTK查询</a></li><li id="f6df" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><a class="ae ks" href="https://redux-toolkit.js.org/" rel="noopener ugc nofollow" target="_blank"> Redux工具包</a></li><li id="cae9" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><a class="ae ks" href="https://github.com/eshankvaish/react-ts-linting" rel="noopener ugc nofollow" target="_blank">React应用程序中林挺和格式设置的模板</a></li></ul><p id="6ee5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="pf">更多内容请看</em><a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="pf">plain English . io</em></strong></a><em class="pf">。</em></p><p id="e361" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="pf">报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="pf">免费周报</em> </strong> </a> <em class="pf">。关注我们关于</em><a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="pf">Twitter</em></strong></a>，<a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="pf">LinkedIn</em></strong></a><em class="pf">，</em><a class="ae ks" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="pf">YouTube</em></strong></a><em class="pf">，以及</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="pf">不和</em> </strong> </a> <strong class="kv io"> <em class="pf">。</em>T41】</strong></p><p id="2e86" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> <em class="pf">有兴趣缩放你的软件启动</em> </strong> <em class="pf">？检查</em> <a class="ae ks" href="https://circuit.ooo?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="pf">电路</em> </strong> </a> <em class="pf">。</em></p></div></div>    
</body>
</html>