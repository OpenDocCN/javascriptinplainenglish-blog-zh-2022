<html>
<head>
<title>Deploy a Node.js App with Apache on Ubuntu 22.04</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Ubuntu 22.04上使用Apache部署Node.js应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/deploy-nodejs-app-with-apache-on-ubuntu-22-04-518fa548132a?source=collection_archive---------0-----------------------#2022-09-03">https://javascript.plainenglish.io/deploy-nodejs-app-with-apache-on-ubuntu-22-04-518fa548132a?source=collection_archive---------0-----------------------#2022-09-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/2f24571e6db7afff0d554998802dbedc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z3oaCcEIT83u9YLgxfxGxw.jpeg"/></div></figure><h2 id="048f" class="jr js in bd jt ju jv dn jw jx jy dp jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">项目设置</h2><p id="0808" class="pw-post-body-paragraph kn ko in kp b kq kr ks kt ku kv kw kx ka ky kz la ke lb lc ld ki le lf lg lh ig bi translated">首先，让我们在Node.js应用程序中配置服务器主机名。更改为<strong class="kp io"> 0.0.0.0，</strong>如下图所示。</p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi li"><img src="../Images/a4287939b0ccd838c6c3f39c1a67e89e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ozwripw3hKlSJ4MgxWTz7A.png"/></div></div></figure><h2 id="c963" class="jr js in bd jt ju jv dn jw jx jy dp jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">使用代理设置Apache2，以便公开我们的Node.js应用</strong></h2><p id="5544" class="pw-post-body-paragraph kn ko in kp b kq kr ks kt ku kv kw kx ka ky kz la ke lb lc ld ki le lf lg lh ig bi translated">首先，获取最新版本的包并检查更新:</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="a755" class="jr js in ls b gy lw lx l ly lz">sudo apt update</span></pre><p id="25a8" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">安装apache2:</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="4bb8" class="jr js in ls b gy lw lx l ly lz">sudo apt install apache2</span></pre><h2 id="e002" class="jr js in bd jt ju jv dn jw jx jy dp jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">安装<strong class="ak"> Node.js </strong>和<strong class="ak"> npm </strong></h2><p id="fcc2" class="pw-post-body-paragraph kn ko in kp b kq kr ks kt ku kv kw kx ka ky kz la ke lb lc ld ki le lf lg lh ig bi translated">1.)安装curl(如果尚未安装)并通过NodeSource的官方PPA安装脚本为特定的Node.js版本添加<strong class="kp io">个人包存档(PPA) </strong>。</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="1cbb" class="jr js in ls b gy lw lx l ly lz">sudo apt install curl</span><span id="37af" class="jr js in ls b gy mf lx l ly lz">curl -sL <a class="ae mg" href="https://deb.nodesource.com/setup_16.x" rel="noopener ugc nofollow" target="_blank">https://deb.nodesource.com/setup_16.x</a> | sudo -E bash -</span></pre><blockquote class="mh mi mj"><p id="ac3c" class="kn ko mk kp b kq ma ks kt ku mb kw kx ml mc kz la mm md lc ld mn me lf lg lh ig bi translated">根据您所需的版本，用<strong class="kp io"> 17.x </strong>、<strong class="kp io"> 12.x </strong>或<strong class="kp io"> 11.x </strong>替换<strong class="kp io"> 16.x </strong></p></blockquote><p id="2e38" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">2.)从PPA安装最新的Node.js:</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="d1fa" class="jr js in ls b gy lw lx l ly lz">sudo apt install nodejs</span></pre><p id="84d4" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">npm 通常作为一个依赖项自动<strong class="kp io">安装</strong>，不需要单独安装。但是，安装它的命令是:</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="19f9" class="jr js in ls b gy lw lx l ly lz">sudo apt install npm</span></pre><blockquote class="mh mi mj"><p id="ffa8" class="kn ko mk kp b kq ma ks kt ku mb kw kx ml mc kz la mm md lc ld mn me lf lg lh ig bi translated">⚠当我们用snap安装Node.js和npm时，遇到了pm2的问题，守护进程无法启动，在我们完全卸载并重装Node.js后才修复，问题描述:<code class="fe mo mp mq ls b">[PM2] Spawning PM2 daemon with pm2_home=/home/user/.pm2</code>。所以，一般来说，我们建议不要用Snap安装Node.js，尽管我们并不讨厌Snap:)</p></blockquote><h2 id="0a0e" class="jr js in bd jt ju jv dn jw jx jy dp jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">启动您的服务器</h2><p id="a482" class="pw-post-body-paragraph kn ko in kp b kq kr ks kt ku kv kw kx ka ky kz la ke lb lc ld ki le lf lg lh ig bi translated">有两种方法可以启动服务器。您可以简单地通过在命令行上写<code class="fe mo mp mq ls b">node server.js</code>来启动它。你也可以使用一个守护进程管理器，比如PM2，它可以帮助你管理你的应用程序，并让它一直在线。</p><ul class=""><li id="730b" class="mr ms in kp b kq ma ku mb ka mt ke mu ki mv lh mw mx my mz bi translated">如果您想使用进程管理器，请跳到下一节，这一节将解释如何安装和设置pm2。</li><li id="91a3" class="mr ms in kp b kq na ku nb ka nc ke nd ki ne lh mw mx my mz bi translated">如果你<strong class="kp io">不想</strong>安装pm2，你可以<strong class="kp io">跳过</strong>下一节，从你的终端，转到你的app 的<strong class="kp io">根文件夹，运行命令:</strong></li></ul><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="5597" class="jr js in ls b gy lw lx l ly lz">node server.js ( or app.js – generally insert app name here )</span></pre><h2 id="bb82" class="jr js in bd jt ju jv dn jw jx jy dp jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">全局安装pm2(可选)</h2><p id="3440" class="pw-post-body-paragraph kn ko in kp b kq kr ks kt ku kv kw kx ka ky kz la ke lb lc ld ki le lf lg lh ig bi translated">下面是安装它的命令:</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="4a33" class="jr js in ls b gy lw lx l ly lz">sudo npm install -g pm2</span></pre><blockquote class="mh mi mj"><p id="d139" class="kn ko mk kp b kq ma ks kt ku mb kw kx ml mc kz la mm md lc ld mn me lf lg lh ig bi translated">⚠ PM2用于启动我们应用程序的守护进程，并在机器重启时自动启动我们的应用程序</p></blockquote><p id="f6f6" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">如果您安装了pm2，请执行以下4个命令</p><p id="294f" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">1.)在您的终端中，转到您的应用程序的<strong class="kp io">根文件夹并运行命令:</strong></p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="c5bb" class="jr js in ls b gy lw lx l ly lz">pm2 start server.js ( or app.js – generally insert app name here )</span></pre><p id="07b3" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">2.)然后，我们应该设置自动启动以防重启。为此，请运行以下命令:</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="bc20" class="jr js in ls b gy lw lx l ly lz">pm2 startup</span></pre><p id="f2dd" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">3.)复制打印的env并将其粘贴到终端中。在我们的案例中:</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="6bd1" class="jr js in ls b gy lw lx l ly lz">sudo env PATH=$PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup system -u george --hp /home/george</span></pre><p id="c77f" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">4.)启动所有需要的应用程序后，保存应用程序列表，以便在重新启动后可以使用以下命令恢复它:</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="8307" class="jr js in ls b gy lw lx l ly lz">pm2 save</span></pre><p id="9b0b" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">然后，我们需要启用以下两个模块:</p><ul class=""><li id="e2d2" class="mr ms in kp b kq ma ku mb ka mt ke mu ki mv lh mw mx my mz bi translated">代理人</li><li id="14be" class="mr ms in kp b kq na ku nb ka nc ke nd ki ne lh mw mx my mz bi translated">代理_http</li></ul><p id="a9e7" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">在终端中运行以下命令:</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="e4bc" class="jr js in ls b gy lw lx l ly lz">sudo a2enmod proxy</span><span id="acf6" class="jr js in ls b gy mf lx l ly lz">sudo a2enmod proxy_http</span></pre><p id="3f50" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">在下一步中，转到/etc/apache2/sites-available</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="ee0b" class="jr js in ls b gy lw lx l ly lz">cd /etc/apache2/sites-available</span></pre><p id="bc22" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">在这个目录中，你需要创建一个名为myapp.conf. <br/>的文件，你可以使用touch命令，这个命令只在文件不存在时才创建一个文件。所以运行这个命令:</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="5436" class="jr js in ls b gy lw lx l ly lz">sudo touch myapp.conf</span></pre><p id="2a45" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">用编辑器(vim、nano等)打开文件。).要使用nano打开文件，请键入:</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="d8a7" class="jr js in ls b gy lw lx l ly lz">sudo nano myapp.conf</span></pre><p id="12e8" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">最后复制并粘贴<VirtualHost>……</VirtualHost>下面的文字</p><p id="5d49" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated"><strong class="kp io"> <em class="mk"> myapp.conf </em> </strong></p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="69d9" class="jr js in ls b gy lw lx l ly lz">&lt;VirtualHost *:3000&gt;<br/>  ServerName 192.240.64.48 #fake IP, Insert your IP or domain here<br/>  ProxyPreserveHost on<br/>  ProxyPass / <a class="ae mg" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/</a><br/>  ProxyPassReverse / <a class="ae mg" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/</a><br/> &lt;/VirtualHost&gt;</span></pre><blockquote class="mh mi mj"><p id="00af" class="kn ko mk kp b kq ma ks kt ku mb kw kx ml mc kz la mm md lc ld mn me lf lg lh ig bi translated">注意，在<strong class="kp io"> ProxyPass </strong>和<strong class="kp io"> ProxyPassReverse </strong>字段中，必须键入Node.js应用程序中使用的相同端口。</p></blockquote><p id="9f99" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">在下一步中，启用虚拟主机:</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="c157" class="jr js in ls b gy lw lx l ly lz">sudo a2ensite myapp.conf</span></pre><p id="8c47" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">最后，重新启动apache2(使用以下两个命令中的任意一个)，以使您的操作生效:</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="a4eb" class="jr js in ls b gy lw lx l ly lz">sudo systemctl restart apache2.service</span><span id="5c29" class="jr js in ls b gy mf lx l ly lz">sudo service apache2 restart</span></pre><p id="9794" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">键入您的IP或域地址以查看您的应用程序正在运行！</p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/5d1ea27ce620d53aaeb7dbbf111c5384.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*rHTWS5mkSZ6bSFjYXNXcTQ.jpeg"/></div></figure><p id="e477" class="pw-post-body-paragraph kn ko in kp b kq ma ks kt ku mb kw kx ka mc kz la ke md lc ld ki me lf lg lh ig bi translated">下一步是什么？<a class="ae mg" href="https://medium.com/@gthanos" rel="noopener">在Medium上关注我</a>成为第一个阅读我的故事的人。</p></div></div>    
</body>
</html>