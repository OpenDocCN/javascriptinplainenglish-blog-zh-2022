<html>
<head>
<title>Set Up a Node.js, Express Web Server API Using TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用TypeScript设置node . js Express Web服务器API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/set-up-a-node-js-express-web-server-api-using-typescript-e2737b34157f?source=collection_archive---------10-----------------------#2022-01-07">https://javascript.plainenglish.io/set-up-a-node-js-express-web-server-api-using-typescript-e2737b34157f?source=collection_archive---------10-----------------------#2022-01-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="b02d" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用TypeScript设置node . js Express Web服务器的完美指南。</h2></div><p id="d58b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我知道时间对于我们开发人员来说是多么宝贵，所以我不会用任何不必要的细节来烦你，但是我会告诉你一些我在try/catch块中发现的关于错误类型的有趣的事情。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/c487b33034a5ee4649f70011419b5c35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WbewgIky9HBr8CHbO4KhmA.png"/></div></div></figure></div><div class="ab cl lk ll hr lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ig ih ii ij ik"><h1 id="976e" class="lr ls in bd lt lu lv lw lx ly lz ma mb jt mc ju md jw me jx mf jz mg ka mh mi bi translated">初始设置</h1><p id="60a2" class="pw-post-body-paragraph kc kd in ke b kf mj jo kh ki mk jr kk kl ml kn ko kp mm kr ks kt mn kv kw kx ig bi translated">首先，让我们在您最喜欢的IDE(我的VS代码)中打开一个新文件夹(我会给它一个非常原始的名字，比如“<strong class="ke io"> server </strong>”)，打开终端，确保路径指向您的文件夹，最后:</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="eec8" class="mt ls in mp b gy mu mv l mw mx">$ yarn init --yes</span></pre><p id="6915" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">没有Express就没有派对，所以让我们安装它:</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="4dc0" class="mt ls in mp b gy mu mv l mw mx">yarn add express</span></pre><p id="98b0" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在让我们安装我们需要的<strong class="ke io">开发</strong>依赖项:</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="889a" class="mt ls in mp b gy mu mv l mw mx">$ yarn add ts-node-dev nodemon typescript -D</span></pre><p id="9f3f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">还有<strong class="ke io">的打字稿类型:</strong></p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="c804" class="mt ls in mp b gy mu mv l mw mx">$ yarn add @types/express @types/node -D</span></pre><blockquote class="my mz na"><p id="53df" class="kc kd nb ke b kf kg jo kh ki kj jr kk nc km kn ko nd kq kr ks ne ku kv kw kx ig bi translated">为什么Typescript是一种开发依赖？</p><p id="c746" class="kc kd nb ke b kf kg jo kh ki kj jr kk nc km kn ko nd kq kr ks ne ku kv kw kx ig bi translated">基本上，typescript是一个包，它通过一个叫做transpiling的奇特过程将TypeScript代码转换成Javascript。由于任何节点环境都不理解Javascript，因此需要在应用程序运行之前将TypeScript代码转换为Javascript。因此，任何使用你的应用程序的人都不需要依赖安装typescript，因为他/她只会使用你的应用程序的运行时版本。</p></blockquote><p id="369f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们还需要添加<strong class="ke io"> tsconfig </strong>文件来告诉typescript它应该如何将我们的TypeScript代码转换成javascript:</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="aa16" class="mt ls in mp b gy mu mv l mw mx">$ npx tsc --init</span></pre><p id="cdaa" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后但同样重要的是(我保证),让我们创建一个新文件，所有神奇的事情都会在这里发生:</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="1c5f" class="mt ls in mp b gy mu mv l mw mx">$ touch server.ts</span></pre><h2 id="dcb1" class="mt ls in bd lt nf ng dn lx nh ni dp mb kl nj nk md kp nl nm mf kt nn no mh np bi translated">好吧，我撒谎了，还有一件事。</h2><p id="30cf" class="pw-post-body-paragraph kc kd in ke b kf mj jo kh ki mk jr kk kl ml kn ko kp mm kr ks kt mn kv kw kx ig bi translated">我们需要创建一个脚本来实际运行我们的代码。所以让我们把它添加到我们的<strong class="ke io">包中</strong></p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="9299" class="mt ls in mp b gy mu mv l mw mx">{...,<br/> "scripts": {<br/>  "start": "nodemon server.ts"<br/> }<br/>}</span></pre><p id="b8d3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Pfew！我知道有很多准备工作，相信我，那是最难的部分。从现在开始，它将在魔法代码的光辉之风中航行。</p></div><div class="ab cl lk ll hr lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ig ih ii ij ik"><h1 id="9545" class="lr ls in bd lt lu lv lw lx ly lz ma mb jt mc ju md jw me jx mf jz mg ka mh mi bi translated"><strong class="ak">服务器。TS </strong></h1><p id="8438" class="pw-post-body-paragraph kc kd in ke b kf mj jo kh ki mk jr kk kl ml kn ko kp mm kr ks kt mn kv kw kx ig bi translated">我们将从导入开始(是的，你没看错，我们不是‘要求’而是‘导入’,因为我们在es模块中使用typescript很酷吧？)并实例化我们的express应用程序。</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="43d3" class="mt ls in mp b gy mu mv l mw mx">import express from 'express';</span><span id="9364" class="mt ls in mp b gy nq mv l mw mx"><em class="nb">const</em> app = express();<br/><em class="nb">const</em> port = process.env.PORT || 8080;</span></pre><p id="e5a1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在让我们添加类型:</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="7cf3" class="mt ls in mp b gy mu mv l mw mx">import express, { Application } from "express";</span><span id="4de4" class="mt ls in mp b gy nq mv l mw mx"><em class="nb">const</em> app: Application = express();<br/><em class="nb">const</em> port = process.env.PORT || 8080;</span></pre><p id="0fc1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">中间件:</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="ee39" class="mt ls in mp b gy mu mv l mw mx">import express, { Application } from "express";</span><span id="a86e" class="mt ls in mp b gy nq mv l mw mx"><em class="nb">const</em> app: Application = express();<br/><em class="nb">const</em> port = process.env.PORT || 8080;</span><span id="1c41" class="mt ls in mp b gy nq mv l mw mx">app.use(express.json());<br/>app.use(express.urlencoded({ extended: true }));<br/></span></pre><p id="9641" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在让我们开始监听所提供的端口:</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="f19c" class="mt ls in mp b gy mu mv l mw mx">import express, { Application } from "express";</span><span id="6aa5" class="mt ls in mp b gy nq mv l mw mx"><em class="nb">const</em> app: Application = express();<br/><em class="nb">const</em> port = process.env.PORT || 8080;</span><span id="c62f" class="mt ls in mp b gy nq mv l mw mx">app.use(express.json());<br/>app.use(express.urlencoded({ extended: true }));<br/></span><span id="2330" class="mt ls in mp b gy nq mv l mw mx">try {<br/>app.listen(port, (): void =&gt; {<br/>   console.log(`Connected succesfully on port: ${port}`);<br/>});<br/>} catch (err) {<br/>   console.error(`Error: ${err.message}`);<br/>}</span></pre><p id="8b47" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们终于可以到终端运行:</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="5a28" class="mt ls in mp b gy mu mv l mw mx">yarn run start</span></pre><p id="9cc6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后嘣！我们做到了，我们得到了一个编译错误。似乎err属于未知类型。</p><p id="6a44" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，第一反应是将err的类型设置为Error。</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="07b9" class="mt ls in mp b gy mu mv l mw mx">...<br/>}catch(err:Error){...}</span></pre><p id="163d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但这是不可行的，因为:</p><p id="7814" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">"<em class="nb">Catch子句变量类型注释必须是' any '或' unknown '(如果指定的话)</em>。"</p><p id="3d57" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">简而言之，这意味着“err”基本上可以是任何东西，从字符串到承诺，到数字，以及介于两者之间的任何东西。</p><p id="1f08" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你可能会说，让我们给它一个“任何”类型，然后就到此为止。</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="9c0f" class="mt ls in mp b gy mu mv l mw mx">...<br/>}catch(err:any){...} </span></pre><p id="b100" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但那不太像现在的打字稿，不是吗？</p><p id="f4d1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以还是找个变通办法吧。</p><p id="3921" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果我们定义一个函数，姑且称之为<strong class="ke io"> <em class="nb"> getError </em> </strong>，它将一个类型为<strong class="ke io">未知</strong>的<strong class="ke io">错误</strong>作为参数:</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="245e" class="mt ls in mp b gy mu mv l mw mx">const getError = (error:unknown)=&gt;{...}</span></pre><p id="9f12" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它检查<em class="nb"/><em class="nb">错误</em>是否是错误的<strong class="ke io">实例，并返回<strong class="ke io">错误。消息</strong>如果是或不是，它只是以字符串形式返回错误:</strong></p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="eadf" class="mt ls in mp b gy mu mv l mw mx">const getError = (error:unknown)=&gt;{<br/> if (error instanceof Error) {<br/><em class="nb">      return</em> error.message;<br/>  }<br/><em class="nb">  return</em> String(error);<br/>}</span></pre><p id="5328" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您的server.js文件现在应该如下所示:</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="5cfe" class="mt ls in mp b gy mu mv l mw mx">import express, { Application } from "express";</span><span id="9fca" class="mt ls in mp b gy nq mv l mw mx"><em class="nb">const</em> app: Application = express();<br/><em class="nb">const</em> port = process.env.PORT || 8080;</span><span id="3065" class="mt ls in mp b gy nq mv l mw mx">app.use(express.json());<br/>app.use(express.urlencoded({ extended: true }));</span><span id="c9bf" class="mt ls in mp b gy nq mv l mw mx"><em class="nb">const</em> getErrorMessage = (error: unknown) =&gt; {<br/>  if (error instanceof Error) {<br/>    <em class="nb">return</em> error.message;<br/>  }<br/><em class="nb">  return</em> String(error);<br/>};</span><span id="91ad" class="mt ls in mp b gy nq mv l mw mx">try {<br/>  app.listen(port, (): void =&gt; {<br/>    console.log(`Connected succesfully on port: ${port}`);<br/>});</span><span id="d3c2" class="mt ls in mp b gy nq mv l mw mx">} catch (err) {<br/>    console.error(getErrorMessage(err));<br/>}</span></pre><p id="7071" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，让我们再次尝试运行启动脚本:</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="abee" class="mt ls in mp b gy mu mv l mw mx">$ yarn run start</span></pre><p id="b12c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">检查终端，你瞧，你有一个正在运行的web服务器。</p></div><div class="ab cl lk ll hr lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ig ih ii ij ik"><h1 id="3637" class="lr ls in bd lt lu lv lw lx ly lz ma mb jt mc ju md jw me jx mf jz mg ka mh mi bi translated"><strong class="ak">第一个端点</strong></h1><p id="c26b" class="pw-post-body-paragraph kc kd in ke b kf mj jo kh ki mk jr kk kl ml kn ko kp mm kr ks kt mn kv kw kx ig bi translated">现在让我们的网络服务器给我们发送一张漂亮的。每当我们向json发送请求并让它获得API标签时。</p><p id="f9ae" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，让我们导入<em class="nb">请求</em>和<em class="nb">响应</em>类型:</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="1c4f" class="mt ls in mp b gy mu mv l mw mx">import express, { Application, Request, Response } from "express";</span></pre><p id="ea41" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，让我们创建端点:</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="6833" class="mt ls in mp b gy mu mv l mw mx">app.get("/", <br/>  <em class="nb">async</em> (req: Request, res: Response): Promise&lt;Response&gt; =&gt; {<br/>     <em class="nb">return</em> res.status(200).send({ message: "Hell Yeah!" });<br/>  }<br/>);</span></pre><p id="b80e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最终的代码应该是这样的:</p><pre class="kz la lb lc gt mo mp mq mr aw ms bi"><span id="9ea6" class="mt ls in mp b gy mu mv l mw mx">import express, { Application, Request, Response } from "express";</span><span id="14a9" class="mt ls in mp b gy nq mv l mw mx"><em class="nb">const</em> app: Application = express();<br/><em class="nb">const</em> port = process.env.PORT || 8080;</span><span id="fe23" class="mt ls in mp b gy nq mv l mw mx">app.use(express.json());<br/>app.use(express.urlencoded({ extended: true }));</span><span id="425b" class="mt ls in mp b gy nq mv l mw mx"><em class="nb">const</em> getErrorMessage = (error: unknown) =&gt; {<br/>  if (error instanceof Error) {<br/>    <em class="nb">return</em> error.message;<br/>  }<br/><em class="nb">  return</em> String(error);<br/>};</span><span id="1db7" class="mt ls in mp b gy nq mv l mw mx">app.get("/", <br/>  <em class="nb">async</em> (req: Request, res: Response): Promise&lt;Response&gt; =&gt; {<br/>     <em class="nb">return</em> res.status(200).send({ message: "Hell Yeah!" });<br/>  }<br/>);</span><span id="228e" class="mt ls in mp b gy nq mv l mw mx">try {<br/>  app.listen(port, (): void =&gt; {<br/>    console.log(`Connected succesfully on port: ${port}`);<br/>});</span><span id="00b0" class="mt ls in mp b gy nq mv l mw mx">} catch (err) {<br/>    console.error(getErrorMessage(err));<br/>}</span></pre><p id="5534" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在只要打开你的浏览器，进入<em class="nb"> localhost:8080 </em>(或者你使用的任何端口)，你就会收到你想要的信息。</p><p id="0fdc" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">太好了。多酷啊！</p><p id="b475" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当然，这只是冰山一角，但是你知道那个教人如何钓鱼的家伙的谚语。</p><p id="fc6e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你猜怎么着？你现在知道如何钓鱼了！</p><p id="c184" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以，去钓鱼吧！</p><p id="ddfe" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢您的阅读！</p><p id="6702" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nb">更多内容看</em> <a class="ae nr" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="nb">说白了. io </em> </a> <em class="nb">。报名参加我们的</em> <a class="ae nr" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="nb">免费每周简讯</em> </a> <em class="nb">。在我们的</em> <a class="ae nr" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <em class="nb">社区不和谐</em> </a> <em class="nb">获得独家获得写作机会和建议。</em></p></div></div>    
</body>
</html>