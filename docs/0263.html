<html>
<head>
<title>How to Capture and Verify User’s Phone Number Using Auth0 Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Auth0操作捕获和验证用户的电话号码</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-capture-and-verify-users-phone-number-using-auth0-action-3bd48d0d6d6c?source=collection_archive---------5-----------------------#2022-01-15">https://javascript.plainenglish.io/how-to-capture-and-verify-users-phone-number-using-auth0-action-3bd48d0d6d6c?source=collection_archive---------5-----------------------#2022-01-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/09fecaec75d899a5fa6452246cede4b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rEJCWWPCPjtkvHWgamPsNg.png"/></div></div></figure><p id="5ce8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于各种场景，企业可能需要在提供服务之前记录并验证用户的电话号码。</p><p id="b097" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个例子演示了如何使用Auth0操作在注册(第一次登录)时获取并验证用户的电话号码。</p><blockquote class="kt ku kv"><p id="3d94" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated">Auth0操作是在Node.js中编写的安全、特定于租户的版本化函数，在Auth0运行时的特定时间点执行。<br/>动作用于通过自定义逻辑自定义和扩展Auth0的功能。https://auth0.com/docs/customize/actions<br/>T2</p></blockquote><p id="7fa0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面的图表显示了该解决方案的工作原理。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lb"><img src="../Images/c0529154a4d3b34b0575975830e82ea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5cbTHAveIaThVMW_IR9MQA.png"/></div></div></figure><h2 id="5733" class="lg lh in bd li lj lk dn ll lm ln dp lo kg lp lq lr kk ls lt lu ko lv lw lx ly bi translated"><strong class="ak">免责声明</strong></h2><p id="f816" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">如果您正在寻找使用SMS 的<a class="ae la" href="https://auth0.com/docs/secure/multi-factor-authentication/multi-factor-authentication-factors/configure-sms-voice-notifications-mfa" rel="noopener ugc nofollow" target="_blank">多因素认证，Auth0支持开箱即用。</a></p><p id="4997" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个解决方案只是一个解决移动验证问题的建议。<br/>我发现一些用户在Auth0论坛上询问此功能，所以我决定看看是否可以使用Auth0操作来提供解决方案。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi me"><img src="../Images/42aa6e577c92af7b2b934a3bf46c0921.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pm6E7XwbnSsnjhQPJ871Xw.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk"><a class="ae la" href="https://community.auth0.com/t/mobile-verification/65206" rel="noopener ugc nofollow" target="_blank">https://community.auth0.com/t/mobile-verification/65206</a></figcaption></figure><h1 id="6dbd" class="mj lh in bd li mk ml mm ll mn mo mp lo mq mr ms lr mt mu mv lu mw mx my lx mz bi translated">解决方案中断</h1><p id="96fc" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">我们需要以下几个部分来实现这个流程:</p><ul class=""><li id="70d8" class="na nb in jx b jy jz kc kd kg nc kk nd ko ne ks nf ng nh ni bi translated">一个Twilio账户。Twillio提供了我们发送验证短信以及在用户提交代码后验证代码所需的API。</li><li id="3646" class="na nb in jx b jy nj kc nk kg nl kk nm ko nn ks nf ng nh ni bi translated">带有额外字段的自定义注册表单，用于记录用户的电话号码。</li><li id="e2c6" class="na nb in jx b jy nj kc nk kg nl kk nm ko nn ks nf ng nh ni bi translated">将在登录时执行的Auth0操作，并利用记录的电话号码通过SMS向用户设备发送验证码。<br/>该操作还负责重定向到代码验证表单。</li><li id="dcd6" class="na nb in jx b jy nj kc nk kg nl kk nm ko nn ks nf ng nh ni bi translated">一个简单的web应用程序，它将承载表单以从用户处获取验证码，并将用户和代码一起重定向到Auth0以完成登录。</li></ul><h2 id="c36c" class="lg lh in bd li lj lk dn ll lm ln dp lo kg lp lq lr kk ls lt lu ko lv lw lx ly bi translated">1-创建Twilio帐户和验证服务</h2><p id="6a6d" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">要创建帐户，请前往<a class="ae la" href="https://www.twilio.com/try-twilio" rel="noopener ugc nofollow" target="_blank">https://www.twilio.com/try-twilio</a>并创建一个免费帐户。</p><p id="2511" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">登录后，点击侧面菜单中的验证。这是我们可以添加验证服务的地方。这项服务将帮助我们向用户电话号码发送短信，并使用短信中的代码来验证号码。</p><p id="8208" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">点击<strong class="jx io">验证- &gt;试用</strong>并创建新服务。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/abd6d0e28b11a8e0ab6091abe25f5a77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l3XQQ1hDkTFjKI2T8XO1Iw.png"/></div></div></figure><p id="904e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第二步和第三步中，您有机会在控制台中测试您新创建的服务。这有助于您验证需要调用的URL和需要为有效负载传递的参数。在您测试了您的新服务并且对它的运行感到满意之后，我们就完成了Twillio的设置。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/76f7fd0dec1789ff8ae068afe91fb7fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VEeqMyjcrWZ5V_2CoIq45w.png"/></div></div></figure><p id="cbda" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您需要在稍后阶段查看您的服务id，您可以回来进行验证，它将列在服务下。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/e45bcd97c1774116cd3703cb44e6e804.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UEMilk0SXEq9VOyS3HuAOg.png"/></div></div></figure><h2 id="21e2" class="lg lh in bd li lj lk dn ll lm ln dp lo kg lp lq lr kk ls lt lu ko lv lw lx ly bi translated">2-带有额外字段的自定义注册表单，用于记录用户的电话号码</h2><p id="e879" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">有多种方法可以定制您的登录/注册表单。<br/>在这个例子中，我使用了Auth0锁并传递了额外字段的配置。</p><p id="8344" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要了解更多关于自定义注册体验的其他方式，请查看<a class="ae la" href="https://auth0.com/docs/libraries/custom-signup" rel="noopener ugc nofollow" target="_blank">本页</a>。<br/>这是您可以传递给Auth0锁以添加额外字段的配置。</p><figure class="lc ld le lf gt jo"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="c49e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你会得到一个注册表单，如下所示:</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/a5268409b8dd9398e1168bc339c28de6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HY82fVbQQToFEDKi-yKzHg.png"/></div></div></figure><p id="6ca4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，用户注册后，电话号码将被添加到用户资料的<code class="fe nu nv nw nx b">user_metadata</code>下。在这个阶段，我们还没有核实电话号码。</p><h2 id="a13b" class="lg lh in bd li lj lk dn ll lm ln dp lo kg lp lq lr kk ls lt lu ko lv lw lx ly bi translated">3-创建一个登录操作来验证电话号码</h2><p id="71a1" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">下一步，我们需要一个登录操作来从用户配置文件中读取电话号码，并向用户的电话号码发送验证短信。</p><p id="6a81" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在Auth0动作触发器中，Login是唯一一个支持<a class="ae la" href="https://auth0.com/docs/customize/actions/triggers/post-login/redirect-with-actions" rel="noopener ugc nofollow" target="_blank">重定向</a>的触发器，这正是我们对于这个流所需要的。因为电话号码验证只发生一次，所以用户只会在第一次登录时进行验证。</p><p id="8acd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于随后的登录，该操作将检查电话号码是否存在，并针对特定用户进行了验证，如果存在，它将忽略其余部分。</p><p id="d1e0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要开始，您需要一个Auth0帐户。如果您还没有，请按照这些说明<a class="ae la" href="https://auth0.com/docs/get-started" rel="noopener ugc nofollow" target="_blank">设置一个。</a></p><p id="6fef" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要创建登录操作，单击<strong class="jx io">操作&gt;流程&gt;登录</strong></p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ny"><img src="../Images/23429e1f0af785d16149a3634db176d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8B3xqIO_aBWy6RHSl22HwA.png"/></div></div></figure><p id="81c9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这创建了一个作为登录流的一部分运行的<code class="fe nu nv nw nx b">post-login</code>触发器。<br/>在用户登录后，当请求刷新令牌时执行。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nz"><img src="../Images/11d22635d88df50244b5142afeaa9892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6CpHXYElEf12N_VySTSk4A.png"/></div></div></figure><p id="06b8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">点击添加操作中的<code class="fe nu nv nw nx b">+</code>按钮，并选择构建定制。称之为<strong class="jx io"> <em class="kw">验证电话号码</em> </strong>，其余保持原样。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oa"><img src="../Images/71437a6d9629cfd028f26afb1e00358a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gBaMdDz1Wnw4AxVitEvdew.png"/></div></div></figure><p id="1a62" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建完成后，您将进入编辑屏幕。<br/>在这里，您可以编辑代码并编写逻辑来调用Twilio APIs发送验证码并进行验证。</p><p id="9d2f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为此，我们需要编写两个独立的函数。</p><ul class=""><li id="8703" class="na nb in jx b jy jz kc kd kg nc kk nd ko ne ks nf ng nh ni bi translated"><code class="fe nu nv nw nx b">onExecutePostLogin</code> —在PostLogin流程执行期间将被调用的处理程序。</li><li id="286d" class="na nb in jx b jy nj kc nk kg nl kk nm ko nn ks nf ng nh ni bi translated"><code class="fe nu nv nw nx b">onContinuePostLogin</code> —外部重定向后恢复此操作时将调用的处理程序。</li></ul><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ob"><img src="../Images/c2b59fd8b32e29b82b0a4f7716e5f368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*izMj2YbBGvdOPd0tezrmYw.png"/></div></div></figure><p id="d97c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">1- In <code class="fe nu nv nw nx b">onExecutePostLogin</code>功能代码只是读取用户<code class="fe nu nv nw nx b">user_metadata</code>的电话号码，并使用Twilio REST API向该电话号码发送短信。<br/>成功发送短信后，该功能会将用户重定向至网络表单，以输入我们刚刚发送给他们的验证码。<br/>这个webform只是一个您需要自己创建和托管的web应用程序。<br/>不需要什么花里胡哨的东西，只要能拿到验证码，把用户重定向回Auth0就行。</p><p id="8b77" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">2-在用户被重定向回Auth0之后,<code class="fe nu nv nw nx b">onContinuePostLogin</code>开始发挥作用。此时，您将使用重定向将验证码从webform发送到函数。<br/>所以我们可以使用代码并从Twilio调用另一个REST API来验证它。<br/>如果一切顺利，并且Twillio成功回复了您的电话号码，我们会将此信息添加到用户资料中，但这次是在<code class="fe nu nv nw nx b">app_metadata</code>下。</p><p id="fb2a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kw">提示:</em> <code class="fe nu nv nw nx b"><em class="kw">user_metadata</em></code> <em class="kw">登录用户可以编辑，但是用户不能编辑</em> <code class="fe nu nv nw nx b"><em class="kw">app_metadata</em></code> <em class="kw">。</em></p><p id="cc2b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是该操作的代码。</p><figure class="lc ld le lf gt jo"><div class="bz fp l di"><div class="nr ns l"/></div></figure><h2 id="f63c" class="lg lh in bd li lj lk dn ll lm ln dp lo kg lp lq lr kk ls lt lu ko lv lw lx ly bi translated">4-获取验证码并执行重定向的示例webform</h2><p id="a383" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">代码验证表单是一个基本的HTML页面，带有一小段JavaScript来处理表单提交。(根据<a class="ae la" href="https://github.com/dylanswartz/actions-consent-form-example" rel="noopener ugc nofollow" target="_blank">迪伦·斯沃茨的例子</a>获取同意书)</p><p id="0f23" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这个例子中，我们将使用<a class="ae la" href="https://vercel.com/" rel="noopener ugc nofollow" target="_blank"> Vercel </a>来托管表单，但是您可以使用任何托管提供商。</p><ol class=""><li id="d9e1" class="na nb in jx b jy jz kc kd kg nc kk nd ko ne ks oc ng nh ni bi translated">如果您还没有这样做，请<a class="ae la" href="https://vercel.com/signup" rel="noopener ugc nofollow" target="_blank">注册一个Vercel帐户</a>并安装带有<code class="fe nu nv nw nx b">npm i -g vercel</code>的<a class="ae la" href="https://github.com/vercel/vercel/tree/main/packages/cli" rel="noopener ugc nofollow" target="_blank"> Vercel CLI </a>。</li><li id="8627" class="na nb in jx b jy nj kc nk kg nl kk nm ko nn ks oc ng nh ni bi translated">当您与<code class="fe nu nv nw nx b">index.html</code>在同一个目录中时，只需在Vercel中运行下面的命令来启动它:</li></ol><pre class="lc ld le lf gt od nx oe of aw og bi"><span id="c302" class="lg lh in nx b gy oh oi l oj ok">$ vercel</span></pre><p id="e611" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于<code class="fe nu nv nw nx b">vercel</code>命令给出的每个提示，按回车键选择默认值。此命令的输出将包含您新托管的代码验证表单的URL。</p><ol class=""><li id="f01f" class="na nb in jx b jy jz kc kd kg nc kk nd ko ne ks oc ng nh ni bi translated">在您的动作代码中，确保删除现有的<code class="fe nu nv nw nx b">VERIFY_FORM_URL</code>，并用上一步中输出的URL值替换它。</li><li id="f0e0" class="na nb in jx b jy nj kc nk kg nl kk nm ko nn ks oc ng nh ni bi translated">如果您想对代码验证表进行更改，只需运行与之前相同的<code class="fe nu nv nw nx b">vercel</code>命令即可上传新版本。</li></ol><p id="e62d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是这个web应用程序的代码。</p><div class="ol om gp gr on oo"><a href="https://github.com/pazel-io/auth0-twilio-phone-verification" rel="noopener  ugc nofollow" target="_blank"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd io gy z fp ot fr fs ou fu fw im bi translated">GitHub-pazel-io/auth 0-twilio-phone-verification:这个示例演示了一个最小的…</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">这个示例演示了“重定向”协议的最小实现。它包含一个Auth0操作…</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">github.com</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc jt oo"/></div></div></a></div><p id="174e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这里，您拥有一个端到端的解决方案来验证电话号码，作为您Auth0登录和帐户创建的一部分。</p><h2 id="9d58" class="lg lh in bd li lj lk dn ll lm ln dp lo kg lp lq lr kk ls lt lu ko lv lw lx ly bi translated">最终注释</h2><p id="1d69" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">要使这成为一个生产就绪的解决方案，还需要考虑更多的因素。</p><ul class=""><li id="1297" class="na nb in jx b jy jz kc kd kg nc kk nd ko ne ks nf ng nh ni bi translated"><strong class="jx io">错误处理</strong> <br/>你需要考虑和处理可能发生的不同错误。<br/>示例动作代码利用<code class="fe nu nv nw nx b">api.access.deny()</code>在发生错误的情况下拒绝登录。</li><li id="2656" class="na nb in jx b jy nj kc nk kg nl kk nm ko nn ks nf ng nh ni bi translated"><strong class="jx io">为不同阶段设置不同的环境(租户)。</strong> <br/>当您设置Auth0租户或Twilio服务时，您需要将您的开发和生产环境分开。</li><li id="ae88" class="na nb in jx b jy nj kc nk kg nl kk nm ko nn ks nf ng nh ni bi translated"><strong class="jx io">保证您的秘密(API)密钥的安全<br/> </strong>本解决方案中使用的所有秘密只存在于代码的服务器端(action.js和verify.js ),这使得保证它们的安全更加容易。<br/>确保不要在客户端代码中暴露敏感密钥，也不要将它们提交给repo。<br/>动作具有内置的秘密管理功能，可保护您的秘密安全，并在您的动作代码中提供便捷的访问方式。</li></ul><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi pd"><img src="../Images/6aad34de7a335754b882fedbc4a9dbd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9FDCF-ydTV9i045uCd3ZDg.png"/></div></div></figure><p id="8205" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以像这样访问它们</p><pre class="lc ld le lf gt od nx oe of aw og bi"><span id="709b" class="lg lh in nx b gy oh oi l oj ok">event.secrets.<!-- -->SESSION_TOKEN_SECRET</span></pre><ul class=""><li id="f5e2" class="na nb in jx b jy jz kc kd kg nc kk nd ko ne ks nf ng nh ni bi translated"><strong class="jx io">可信回调URL ( </strong>引自<a class="ae la" href="https://github.com/dylanswartz/actions-consent-form-example" rel="noopener ugc nofollow" target="_blank"> Dylan Swartz示例</a> <strong class="jx io"> ) <br/> </strong>为了方便起见，我们的示例操作和同意表单做出了一个安全妥协:规则将Auth0域(即<code class="fe nu nv nw nx b">your-tenant.auth0.com</code>)传递给表单网站，表单使用它来构造一个回调URL(即<code class="fe nu nv nw nx b">https://your-tenant.auth0.com/continue</code>)以返回到规则。这本质上是一个<a class="ae la" href="https://www.owasp.org/index.php/Unvalidated_Redirects_and_Forwards_Cheat_Sheet" rel="noopener ugc nofollow" target="_blank">开放重定向</a>，不应该在生产场景中使用。<br/>您可以通过将表单网站实现配置为仅返回特定的URL(即，仅您的Auth0租户),而不是从查询参数生成的URL，来锁定这一点。然后，您也可以简化规则，使其不再通过Auth0域。</li><li id="ffc0" class="na nb in jx b jy nj kc nk kg nl kk nm ko nn ks nf ng nh ni bi translated"><strong class="jx io">数据完整性(</strong>引自<a class="ae la" href="https://github.com/dylanswartz/actions-consent-form-example" rel="noopener ugc nofollow" target="_blank">迪伦·斯沃茨的例子</a> <strong class="jx io"> ) <br/> </strong>如上所述，这是一个使用动作重定向来调用同意表格的非常基本的例子。也就是说，在Auth0，我们非常重视安全性。使用共享的<code class="fe nu nv nw nx b">SESSION_TOKEN_SECRET</code>将作为签名令牌传递回auth0的<code class="fe nu nv nw nx b">confirm</code>字段(其值为<code class="fe nu nv nw nx b">yes</code>)。<br/>在生产场景中，您需要保证外部网站返回的数据的完整性(在这种情况下，在我们的托管代码验证表单中)。例如，如果您想确定数据确实来自可信的来源，那么应该对其进行签名。如果数据是敏感的，那么它应该被加密。做这件事的一个好机制是使用一个<a class="ae la" href="http://jwt.io/" rel="noopener ugc nofollow" target="_blank"> JWT </a> (JSON Web令牌)。您可以使用声明(您可以选择加密)构建JWT，然后使用与您的Auth0操作共享的秘密或私钥对其进行签名，该操作知道私钥的公钥。然后，该操作可以验证声明是否合法，并在必要时对其进行解密。</li><li id="e17d" class="na nb in jx b jy nj kc nk kg nl kk nm ko nn ks nf ng nh ni bi translated"><strong class="jx io">社交登录<br/> </strong>如果你想提供社交登录/注册，这个解决方案需要一些调整。<br/>在社交登录的情况下，用户不会使用我们的注册表单，因此我们需要在应用程序中通过一个单独的表单来获取电话号码。</li></ul><p id="394c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感谢阅读这篇文章。<br/>如果您有任何反馈或问题，请点击这里或在<a class="ae la" href="https://twitter.com/_pazel" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上联系我们。</p><p id="9859" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里是我的示例代码库的链接:<br/>【https://github.com/pazel-io/auth0-twilio-phone-verification T21】</p><p id="cad6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">参考资料:</p><ul class=""><li id="fe64" class="na nb in jx b jy jz kc kd kg nc kk nd ko ne ks nf ng nh ni bi translated"><a class="ae la" href="https://auth0.com/docs/customize/actions" rel="noopener ugc nofollow" target="_blank">授权0行动文件</a></li><li id="d17a" class="na nb in jx b jy nj kc nk kg nl kk nm ko nn ks nf ng nh ni bi translated"><a class="ae la" href="https://auth0.com/docs/customize/actions/triggers/post-login/redirect-with-actions" rel="noopener ugc nofollow" target="_blank">动作重定向</a></li><li id="5384" class="na nb in jx b jy nj kc nk kg nl kk nm ko nn ks nf ng nh ni bi translated"><a class="ae la" href="https://github.com/dylanswartz/actions-consent-form-example" rel="noopener ugc nofollow" target="_blank">迪伦·史瓦兹的例子</a>征求同意书</li><li id="d776" class="na nb in jx b jy nj kc nk kg nl kk nm ko nn ks nf ng nh ni bi translated"><a class="ae la" href="https://www.twilio.com/docs/verify" rel="noopener ugc nofollow" target="_blank"> Twilio验证服务</a></li></ul><p id="27c2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kw">更多内容请看</em><a class="ae la" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="kw">plain English . io</em></strong></a><em class="kw">。报名参加我们的</em> <a class="ae la" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="kw">免费周报</em> </strong> </a> <em class="kw">。在我们的</em> <a class="ae la" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="kw">社区</em> </strong> </a> <em class="kw">获得独家获得写作机会和建议。</em></p></div></div>    
</body>
</html>