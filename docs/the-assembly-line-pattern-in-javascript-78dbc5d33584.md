# JavaScript 中的装配线模式

> 原文：<https://javascript.plainenglish.io/the-assembly-line-pattern-in-javascript-78dbc5d33584?source=collection_archive---------21----------------------->

![](img/1716e72f5f1ddbf685e1f998fe4391fc.png)

Photo by [Medina Catering](https://unsplash.com/@medinacatering?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

装配线模式可以将一组复杂的需求转化为简单的执行。

经过十年的 node.js 编程和更长时间的 JavaScript 编程，通过应用 ***装配线模式*** (ALP)概念，许多大型复杂的项目被轻松地分解成更小的步骤。

这种模式不像其他 OOP 模式那样流行，因为它更适合 JavaScript 发挥作用的函数式编程世界。ALP 可以用来构建灵活简单的工作流引擎的开端。ALP 类似于 ***流水线模式*** ，但是流水线可以位于 ALP 之上；作为一个更大的结构，它可以代表一个装配线工厂。

ALP 由一个分配器，质量控制，精炼，装配，最后是一个调度员组成。

ALP 的快速概述:

*   分配器:获取材料
*   质量控制:过滤材料
*   精炼厂:修改材料
*   装配:添加到材料
*   调度员:运送材料

每个步骤不必应用于每个项目，每个步骤本身可以有多个步骤，包括在返回主线之前遍历子装配线。当产品通过生产线时，它也可以在任何时候被拒绝。

当使用 ALP 时，感觉就像是 ***责任链*** 模式与 ***装饰者*** 模式相匹配。您可以阅读关于 ALP 和其他地方提到的其他模式的更深入的细节和示例。现在，让我们开始用 JavaScript 编写这个练习。

下面是使用 node.js 中的 ***require*** 构造的一般框架或脚手架。

代码严格遵循上述 ALP 的大纲，使用 ***承诺*** 作为同步链，类似于装配线。额外的步骤可以很容易地插入中间或分解成多个步骤。可以更改步骤的名称，以指定它被编码来执行的实际任务，而不是一般的 ALP 任务。

让我们用一个简单的项目来看一个实现每个步骤的例子。该项目将包括读入一个 CSV 文件，生成和计算附加列，然后将输出格式化为 HTML。如果遵循这种做法，编写包含单个函数中所有步骤的东西将违反 ***关注点分离*** 规则。将它分成多个文件降低了认知的复杂性，并将它的功能隔离到一个易于管理的代码块中。

上面的搭建文件不需要修改；必须只写步骤。从分配器步骤开始需要一些参数。在这种情况下，CSV 文件的路径将启动该过程。可以发送附加参数，如配置文件。这类似于物理装配线上的控制面板设置。

与装配线一样，使用对象的外壳并添加 CSV 文件将项目传递到下一步: ***【解析({ csv })*** 。当我们向其中添加项目时，让我们称这个外壳为“盒子”。下一步是质量控制步骤，在细化(解析)之前确定 CSV 文件的格式是否正确。

我们的 CSV 文件规范要求它有一个标题行，后跟数据行:

```
Sample CSV file:header1,header2,header3,header4,header5,header6
1,2,3,4,5,6
6,5,4,3,2,1
11,22,33,44,55,66
66,55,44,33,22,11
```

本练习假设 CSV 文件很小；所以不会约束记忆。当然， ***readline*** 模块可以处理更大的文件，但是对于这个例子，让我们保持简单。下一步是提炼，它将把文件解析成一个表示行和单元格的二维数组，然后传递给下一步。

组装步骤现在将向数组中添加另一个元素。一个新的单元格将被添加到每一行，它将包含该行中数字的总和。对于标题行，我们将添加一个“ ***总计*** ”列。

组装之后，我们将把它作为一个 HTML 格式的表格发送出去。传递盒子时，使用 spread 运算符，并在单个 ***resolve*** 语句中添加附加属性。

请注意，每个步骤都被限制在它的工作空间中，并且只负责一项工作。然后，它使用 ***resolve*** 方法将项目传递到下一步。这保持了代码的整洁和灵活性，可以随时接受额外的步骤。

这种模式和技术可以被修改、扩展和增强，成为一个完全成熟的工作流引擎，以一种干净的自顶向下的方法处理无数的步骤，消除混乱的分支和条件块。

使用装配线模式构建您的下一个项目！

*更多内容请看* [***说白了就是***](http://plainenglish.io/) *。报名参加我们的* [***免费每周简讯***](http://newsletter.plainenglish.io/) *。在我们的* [***社区***](https://discord.gg/GtDtUAvyhW) *获得独家获得写作机会和建议。*