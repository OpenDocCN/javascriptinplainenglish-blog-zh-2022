<html>
<head>
<title>How to Build an Image Watermarking Tool with HTML Canvas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用HTML Canvas构建图像水印工具</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-build-an-image-watermarking-tool-with-html-canvas-9dd45bb4f13?source=collection_archive---------11-----------------------#2022-03-07">https://javascript.plainenglish.io/how-to-build-an-image-watermarking-tool-with-html-canvas-9dd45bb4f13?source=collection_archive---------11-----------------------#2022-03-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/668c656580ba454a7287ac6720ea550a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fVBwPubEojQ8fQhD"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@mihodango?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ho Hyou</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="903f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">HTML Canvas是一个非常通用的元素，可用于绘图、动画和图像处理。在这篇文章中，我们将建立一个浏览器内的工具，你可以用它来给图片添加水印。我们将使用普通的JavaScript和Bootstrap进行样式设计。</p><p id="9d73" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将介绍HTML Canvas的一些基础知识，比如绘图、定位以及保存图像。如果您是Canvas API的新手，这将是一个不错的入门教程。</p><h1 id="b362" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">我们要建造什么</h1><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/6e24d5e27be7bc160d6c6d143fe72a64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FAHaU9ZQbwNXlnMDhca3Ag.png"/></div></div></figure><p id="540d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">用户界面非常简单。我们有两个文件输入上传的基础图像(图像，我们将水印)和另一个图像将被放置在我们的第一个图像的顶部。我们还可以选择调整图像大小，改变水印的位置和透明度。看起来很简单对吧！开始编码吧。</p><blockquote class="mb mc md"><p id="7620" class="ka kb me kc b kd ke kf kg kh ki kj kk mf km kn ko mg kq kr ks mh ku kv kw kx ig bi translated">另外，如果你想看现场演示，你可以在这里找到<a class="ae jz" href="https://eyuelberga.github.io/HTMLCanvasImageWatermarker/" rel="noopener ugc nofollow" target="_blank"/>。</p></blockquote><h1 id="bf9a" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建新项目</h1><p id="80a8" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">为此我们将使用<a class="ae jz" href="https://vitejs.dev/" rel="noopener ugc nofollow" target="_blank"> Vite </a>，但是一个简单的HTML和Javascript文件也可以。如果您不想设置开发服务器，可以跳过这一步。我更喜欢使用开发服务器，从热重装等有趣的特性中获益。</p><p id="0afe" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要创建新项目，只需运行:</p><pre class="lx ly lz ma gt mn mo mp mq aw mr bi"><span id="742a" class="ms kz in mo b gy mt mu l mv mw">$ yarn create vite</span></pre><p id="9c03" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它会提示您填写项目名称和框架。你应该选择<strong class="kc io"> vanilla，</strong>我们将只使用普通的JavaScript。</p><p id="a470" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">完成后，我们可以使用以下命令启动我们的开发服务器:</p><pre class="lx ly lz ma gt mn mo mp mq aw mr bi"><span id="efa4" class="ms kz in mo b gy mt mu l mv mw">$ yarn dev</span></pre><h1 id="0b75" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">网络界面</h1><p id="71c1" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">我们将从HTML页面开始。如果您遵循上一步，文件<code class="fe mx my mz mo b">index.html</code>已经存在于项目文件夹的根目录下。</p><p id="ab2d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们需要做的第一件事是在HTML文件中添加引导样式。转到<a class="ae jz" href="https://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank">引导主页</a>，在安装部分，您将找到CSS文件的代码片段。我们需要把这个加到我们的头牌上。</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="afad" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们现在可以使用Bootstrap中的不同组件来添加HTML的主体。如果你想了解更多，可以查看<a class="ae jz" href="https://getbootstrap.com/docs/5.1/getting-started/introduction/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><h1 id="ccdc" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">JavaScript部分…</h1><p id="0394" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">我们将把所有的JavaScript代码放到一个名为<code class="fe mx my mz mo b">main.js</code>的文件中。我们将从创建执行特定任务的小函数开始，最后我们将把它们集合在一起。</p><h2 id="245c" class="ms kz in bd la nc nd dn le ne nf dp li kl ng nh lm kp ni nj lq kt nk nl lu nm bi translated">读取本地图像</h2><p id="e0b1" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">我们将定义一个函数<code class="fe mx my mz mo b">getImage</code>，它将从输入中读取所选文件，创建一个新的<code class="fe mx my mz mo b">HTMLImageElement</code>实例，并在图像加载完成时调用一个回调函数。</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="9cbe" class="ms kz in bd la nc nd dn le ne nf dp li kl ng nh lm kp ni nj lq kt nk nl lu nm bi translated">调整图像尺寸</h2><p id="3d37" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">我们在UI中有一个选项来调整图像的大小。我们还有一个复选框，用于在调整大小时保持纵横比之间切换。那么我们如何实现它呢？</p><blockquote class="mb mc md"><p id="b987" class="ka kb me kc b kd ke kf kg kh ki kj kk mf km kn ko mg kq kr ks mh ku kv kw kx ig bi translated">一张图片的<strong class="kc io">长宽比</strong>就是它的宽高比。</p></blockquote><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="ab96" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将定义三个函数:</p><ul class=""><li id="3a2a" class="nn no in kc b kd ke kh ki kl np kp nq kt nr kx ns nt nu nv bi translated"><code class="fe mx my mz mo b"><strong class="kc io">getAspectRatio</strong></code>:返回给定宽度和高度的图像的长宽比</li><li id="d269" class="nn no in kc b kd nw kh nx kl ny kp nz kt oa kx ns nt nu nv bi translated"><code class="fe mx my mz mo b"><strong class="kc io">getWidthFromRatio</strong></code>:返回宽度，给定图像的高度和纵横比</li><li id="cae4" class="nn no in kc b kd nw kh nx kl ny kp nz kt oa kx ns nt nu nv bi translated"><code class="fe mx my mz mo b"><strong class="kc io">getHeightFromRatio</strong></code>:给定图片的宽度和长宽比，返回高度</li></ul><p id="f77a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们已经定义了这些函数，我们可以再添加两个方法来改变图像的宽度和高度。</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="82d9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这两个函数有相似的参数。<code class="fe mx my mz mo b">image</code>参数将接受一个<code class="fe mx my mz mo b">HTMLImageElement</code>，它有一个<code class="fe mx my mz mo b">width</code>和<code class="fe mx my mz mo b">height</code>属性。如果<code class="fe mx my mz mo b">maintainAspectRatio</code>的值为真，那么图像也应该根据长宽比进行缩放。因此，我们将使用前面定义的函数，根据长宽比找到正确的尺寸。</p><h2 id="3f42" class="ms kz in bd la nc nd dn le ne nf dp li kl ng nh lm kp ni nj lq kt nk nl lu nm bi translated">定位水印图像</h2><p id="948b" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">要在画布上定位图像，我们首先需要了解画布坐标是如何工作的。与我们在数学中习惯的笛卡尔坐标系不同，HTML画布坐标中的原点(0，0)位于左上角。正x轴向右延伸，正y轴向下延伸。因此，在画布上绘制图像需要设置图像左上角所在的x和y坐标。</p><p id="3394" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">记住这一点，如果我们知道水印图像和画布的大小，我们计算不同位置的坐标值。这里有一个图表，可以让它更清楚一点。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/076754e54fcbe16e8104e7e1a3ac51cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*dd9ZOmsMTzYaOzRanVGLTg.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">watermark position and coordinate values</figcaption></figure><p id="6ed5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，用黄色突出显示的坐标值就是我们在这些位置绘制水印图像所需的坐标值。好，让我们写一个函数来完成这项工作。</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="7309" class="ms kz in bd la nc nd dn le ne nf dp li kl ng nh lm kp ni nj lq kt nk nl lu nm bi translated">让我们水印</h2><p id="1fac" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">到目前为止，我们还没有编写任何与Canvas API交互的代码。现在让我们开始编写将为我们做水印的函数。</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="9d46" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们做的第一件事是从画布中获取2D渲染上下文。这让我们能够画出我们的图像。然后，我们将画布的宽度和高度设置为与基本图像相同的尺寸。我们还使用了<code class="fe mx my mz mo b">clearRect</code>方法，每次调用函数时总是在一个干净的画布上绘制。</p><p id="369f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我们调用<code class="fe mx my mz mo b">drawImage</code>将我们的基本图像绘制到画布上。然后，在我们将水印图像绘制到画布上之前，我们设置一个新的<code class="fe mx my mz mo b">globalAlpha</code>值，以增加图像的透明度。我们在这里也使用了<code class="fe mx my mz mo b">getCoordinates</code>方法来根据我们想要的位置获得水印图像的x和y坐标。</p><h2 id="f90b" class="ms kz in bd la nc nd dn le ne nf dp li kl ng nh lm kp ni nj lq kt nk nl lu nm bi translated">保存图像</h2><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="829a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了保存图像，我们首先从画布中获取图像数据，然后创建一个链接，然后以编程方式单击它。为了获得图像数据，我们在画布上调用<code class="fe mx my mz mo b">toDataURL</code>方法。</p><h2 id="c4a3" class="ms kz in bd la nc nd dn le ne nf dp li kl ng nh lm kp ni nj lq kt nk nl lu nm bi translated">一些效用函数</h2><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="bc92" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mx my mz mo b">updateImageSizeValueDOM</code>方法将根据当前图像尺寸更新DOM上的宽度和高度输入值。</p><p id="b7c4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mx my mz mo b">isChecked</code>方法根据复选框的当前状态返回一个布尔值。</p><h2 id="d15c" class="ms kz in bd la nc nd dn le ne nf dp li kl ng nh lm kp ni nj lq kt nk nl lu nm bi translated">将这一切结合在一起</h2><p id="0f3b" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">因此，我们已经定义了我们需要的所有方法，下一步是基于用户交互调用这些方法。</p><p id="fd36" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，让我们从DOM中获取我们需要的所有元素的引用，并将它们存储为变量。</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="f20c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们还需要初始化一些变量来存储图像和它们的初始纵横比。</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="b445" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我们需要监听文件输入元素上的新输入事件，并更新我们的图像和纵横比变量。我们使用之前编写的<code class="fe mx my mz mo b">getImage</code>函数从输入事件中获取图像数据。我们还需要更新DOM中的宽度和高度值，所以我们将在这里使用我们的<code class="fe mx my mz mo b">updateImageSizeValueDOM</code>函数。</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="5458" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们现在向高度和宽度输入添加事件侦听器来调整图像的大小。这里我们将使用<code class="fe mx my mz mo b">changeImageHeight</code>和<code class="fe mx my mz mo b">changeImageWidth</code>方法来调整图像的尺寸。</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="b493" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，我们将在水印和保存按钮中添加点击事件处理程序。</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="na nb l"/></div></figure><h1 id="347b" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">我们完了！</h1><p id="cfa3" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">如果你想看看源代码，可以在<a class="ae jz" href="https://github.com/eyuelberga/HTMLCanvasImageWatermarker" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。希望你喜欢这篇文章。感谢您的阅读。</p><p id="561d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="me">更多内容请看</em><a class="ae jz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="me">plain English . io</em></strong></a><em class="me">。报名参加我们的</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="me">免费周报</em> </strong> </a> <em class="me">。关注我们关于</em><a class="ae jz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="me">Twitter</em></strong></a><em class="me">和</em><a class="ae jz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="me">LinkedIn</em></strong></a><em class="me">。加入我们的</em> <a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="me">社区不和谐</em> </strong> </a> <em class="me">。</em></p></div></div>    
</body>
</html>