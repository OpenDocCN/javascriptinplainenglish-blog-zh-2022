<html>
<head>
<title>Loopback 4: Super fast REST APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Loopback 4:超快速REST APIs</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/loopback-4-super-fast-rest-apis-bc29750547a3?source=collection_archive---------13-----------------------#2022-03-03">https://javascript.plainenglish.io/loopback-4-super-fast-rest-apis-bc29750547a3?source=collection_archive---------13-----------------------#2022-03-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/c4713503630dbdbb9ad6f05c0b67437c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sfs145zSbZ-xiEEd"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">ìPhoto by <a class="ae jz" href="https://unsplash.com/@tekton_tools?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Tekton</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8990" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最近，我一直在寻找一个REST API框架，以在<a class="ae jz" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>中提供健壮的API。我需要一些能让我更快地创建模型、关系、CRUD APIs控制器的东西，并附带一个内置的ORM层。</p><p id="69b8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://loopback.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io">环回4 </strong> </a>满足了我的所有需求。</p><p id="bc57" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Loopback是一个开源的<a class="ae jz" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>框架，有助于将来自API请求的数据连接到后端资源，具有开箱即用的集成。</p><p id="9cb6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以你只需要关注你的应用程序的逻辑。</p><p id="d5bf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文中，我们将深入探讨环回项目的基础知识。我们将探索架构、主要层、示例应用程序背后的部分，最终我们将看到无需编写一行代码，使用<em class="ky">模型</em>、<em class="ky">关系</em>和<em class="ky">数据库</em>集成来构建回送应用程序是多么容易和快速！</p></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><h1 id="b882" class="lg lh in bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">CLI和项目创建</h1><p id="33ea" class="pw-post-body-paragraph ka kb in kc b kd me kf kg kh mf kj kk kl mg kn ko kp mh kr ks kt mi kv kw kx ig bi translated">Loopback提供了一个非常方便的命令行界面，为我们简化、自动化和生成东西。我们可以在全球范围内安装:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="d20b" class="ms lh in mo b gy mt mu l mv mw">npm i -g @loopback/cli</span></pre><p id="492b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们可以使用的第一个命令是<code class="fe mx my mz mo b">lb4 app</code>:它将指导我们创建一个新的Loopback项目。我们将能够选择项目名称，项目描述，主要应用程序类名和许多其他功能，我们可能希望在我们的应用程序。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/a0c7b8f4a3b926bcfb2fae7c0353ec2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ayUvediDYY13ViCF7mrKog.png"/></div></div></figure><p id="1133" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一旦一切就绪，我们就可以使用<strong class="kc io"> <em class="ky"> npm </em> </strong>或(在我的例子中)<strong class="kc io"> <em class="ky"> yarn </em> </strong> : <code class="fe mx my mz mo b">yarn start</code>来运行应用程序</p><h1 id="4b1a" class="lg lh in bd li lj nb ll lm ln nc lp lq lr nd lt lu lv ne lx ly lz nf mb mc md bi translated">项目层</h1><p id="ab10" class="pw-post-body-paragraph ka kb in kc b kd me kf kg kh mf kj kk kl mg kn ko kp mh kr ks kt mi kv kw kx ig bi translated">如果我们看一下由<code class="fe mx my mz mo b">lb4 app</code>创建的项目，我们会看到不同的文件夹。它们代表了环回应用程序最重要的层:</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ng"><img src="../Images/3981fed7bc98c42c7578df7f4637a210.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JsqLwk2ysVZgI5AbF3m_1Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Project structure of a sample Loopback4 project</figcaption></figure><ul class=""><li id="9fba" class="nh ni in kc b kd ke kh ki kl nj kp nk kt nl kx nm nn no np bi translated">模型</li><li id="83c9" class="nh ni in kc b kd nq kh nr kl ns kp nt kt nu kx nm nn no np bi translated">控制器</li><li id="52ae" class="nh ni in kc b kd nq kh nr kl ns kp nt kt nu kx nm nn no np bi translated">数据源</li><li id="2164" class="nh ni in kc b kd nq kh nr kl ns kp nt kt nu kx nm nn no np bi translated">仓库</li></ul><h2 id="4e9e" class="ms lh in bd li nv nw dn lm nx ny dp lq kl nz oa lu kp ob oc ly kt od oe mc of bi translated">模型</h2><p id="978f" class="pw-post-body-paragraph ka kb in kc b kd me kf kg kh mf kj kk kl mg kn ko kp mh kr ks kt mi kv kw kx ig bi translated"><strong class="kc io"> M <em class="ky">模型</em> </strong>表示业务领域对象及其关系。我们可以用两种方式创建它们，最常见的方式是使用<code class="fe mx my mz mo b">@model</code>装饰器通过代码创建。</p><figure class="mj mk ml mm gt jo"><div class="bz fp l di"><div class="og oh l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">A simple User model</figcaption></figure><p id="01e3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但是<em class="ky">最简单快捷的方式</em>是使用CLI，用命令:<code class="fe mx my mz mo b">lb4 model</code></p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oi"><img src="../Images/4e4377efd6b0cb87a6887867ab666595.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B8z3LYSIKtYntXcQqqHl9w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">A simple User model created by the CLI</figcaption></figure><p id="d829" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">CLI将让我们定义模型名称和我们需要的所有属性。</p><p id="ed7f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一个域对象是一个<strong class="kc io"> <em class="ky">实体</em> </strong> <em class="ky"> </em>(一个有ID的域对象)如果它<em class="ky">扩展了</em><strong class="kc io"><em class="ky">实体</em>类</strong>，否则，如果它扩展了<strong class="kc io"> <em class="ky">模型</em>类</strong>，它就是一个<strong class="kc io"> <em class="ky">模型</em> </strong> <em class="ky"> </em>(一个没有ID的域对象)。</p><p id="dcef" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">注意:当处理数据库时，应用程序的持久对象将是实体。我们也可以称它们为</em> <strong class="kc io"> <em class="ky">数据库模型</em> </strong> <em class="ky">。</em></p><p id="5222" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">域对象可以通过<strong class="kc io">关系在回环中相互链接。</strong>最重要的有以下四种:</p><ul class=""><li id="3c5e" class="nh ni in kc b kd ke kh ki kl nj kp nk kt nl kx nm nn no np bi translated"><a class="ae jz" href="https://loopback.io/doc/en/lb4/HasMany-relation.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> HasMany </strong> </a>:表示一对多的连接。</li><li id="23eb" class="nh ni in kc b kd nq kh nr kl ns kp nt kt nu kx nm nn no np bi translated"><a class="ae jz" href="https://loopback.io/doc/en/lb4/HasOne-relation.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io">有一个</strong> </a>:表示一对一的连接。</li><li id="fcd3" class="nh ni in kc b kd nq kh nr kl ns kp nt kt nu kx nm nn no np bi translated"><a class="ae jz" href="https://loopback.io/doc/en/lb4/BelongsTo-relation.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io">隶属于</strong> </a>:表示多对一的连接。</li><li id="2d7a" class="nh ni in kc b kd nq kh nr kl ns kp nt kt nu kx nm nn no np bi translated"><a class="ae jz" href="https://loopback.io/doc/en/lb4/HasManyThrough-relation.html" rel="noopener ugc nofollow" target="_blank"><strong class="kc io">hasmany through</strong></a>:表示多对多的连接。</li></ul><p id="279c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们如何在Loopback4应用程序中创建上述关系？</p><p id="355a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用CLI只需几秒钟！命令是<code class="fe mx my mz mo b">lb4 relation</code></p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oj"><img src="../Images/5c0a36d6da91834ad3c70b902587caa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZvNe_0FUmb1tny46c1X9w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Create a Relation with the CLI</figcaption></figure><p id="ef07" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">CLI将建议应用程序中已经存在的模型，并为我们创建关系。</p><p id="146f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">注意</em> : <em class="ky">为了创建模型之间的关系，我们需要为这些模型创建一个</em> <strong class="kc io"> <em class="ky">存储库</em> </strong> <em class="ky">。我们将在本文中进一步看到</em> <strong class="kc io"> <em class="ky">资源库</em> </strong> <em class="ky">。</em></p><h2 id="87f9" class="ms lh in bd li nv nw dn lm nx ny dp lq kl nz oa lu kp ob oc ly kt od oe mc of bi translated">控制器</h2><p id="44e9" class="pw-post-body-paragraph ka kb in kc b kd me kf kg kh mf kj kk kl mg kn ko kp mh kr ks kt mi kv kw kx ig bi translated"><strong class="kc io"> <em class="ky">控制器</em> </strong>是包含<em class="ky"> API端点的对象。他们实现应用程序的特定业务逻辑，并将来自API请求的数据连接到域/数据库模型。</em></p><p id="c6e3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">CLI创建的空应用程序(使用<code class="fe mx my mz mo b">lb4 app</code>)包含一个名为<code class="fe mx my mz mo b">PingController</code> <em class="ky">的示例<strong class="kc io">控制器</strong>。</em>非常简单:它只提供了一个名为<code class="fe mx my mz mo b">ping</code>的<code class="fe mx my mz mo b">GET</code>端点，该端点显示一些信息作为响应(如果您的应用程序正在运行，您可以在这里找到它:<a class="ae jz" href="http://localhost:3000/ping" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/ping</a>)。</p><p id="e340" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢<em class="ky"> </em> <a class="ae jz" href="https://en.wikipedia.org/wiki/Decorator_pattern" rel="noopener ugc nofollow" target="_blank"> <em class="ky">装饰模式</em> </a>，以及Loopback对它的大量使用，我们可以以声明的方式向我们的控制器添加逻辑和内置助手。</p><p id="82e4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一个<strong class="kc io">控制器</strong>中最重要的装饰器是<a class="ae jz" href="https://loopback.io/doc/en/lb4/Decorators_openapi.html" rel="noopener ugc nofollow" target="_blank"> <em class="ky"> OpenAPI装饰器</em> </a> <em class="ky">。它们允许回送来自动路由、生成请求和响应定义以及创建文档。</em></p><p id="d812" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，让我们通过查看示例应用程序提供的<code class="fe mx my mz mo b">PingController</code>类来更深入地了解回送<strong class="kc io">控制器</strong>。</p><figure class="mj mk ml mm gt jo"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="1965" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面的代码让我们发现了三个重要的装饰者:</p><ul class=""><li id="8802" class="nh ni in kc b kd ke kh ki kl nj kp nk kt nl kx nm nn no np bi translated"><a class="ae jz" href="https://loopback.io/doc/en/lb4/Decorators_inject.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> @inject </strong> </a>:向<a class="ae jz" href="https://loopback.io/doc/en/lb4/Dependency-injection.html" rel="noopener ugc nofollow" target="_blank">回送IoC容器</a>请求之前用<em class="ky">绑定密钥绑定的特定服务或属性。<br/> </em>在上面的代码中，我们将每个<em class="ky"> HTTP请求</em>注入到<em class="ky"> req </em>私有变量中，因此我们可以在我们的逻辑中使用它。<em class="ky"> <br/> </em> Loopback提供了不同的内置服务，我们可以在类中注入这些服务。常见的可通过以下绑定访问:<br/>-<a class="ae jz" href="https://loopback.io/doc/en/lb4/apidocs.authentication.authenticationbindings.html" rel="noopener ugc nofollow" target="_blank"><strong class="kc io">AuthenticationBindings</strong></a><strong class="kc io"><br/>-</strong><a class="ae jz" href="https://loopback.io/doc/en/lb4/apidocs.boot.bootbindings.html" rel="noopener ugc nofollow" target="_blank"><strong class="kc io">boot bindings</strong></a><strong class="kc io"><br/>-</strong><a class="ae jz" href="https://loopback.io/doc/en/lb4/apidocs.core.corebindings.html" rel="noopener ugc nofollow" target="_blank"><strong class="kc io">core bindings</strong></a><strong class="kc io"><br/>-</strong><a class="ae jz" href="https://loopback.io/doc/en/lb4/apidocs.rest.restbindings.html" rel="noopener ugc nofollow" target="_blank"><strong class="kc io">rest bindings</strong></a>。</li><li id="4a09" class="nh ni in kc b kd nq kh nr kl ns kp nt kt nu kx nm nn no np bi translated"><a class="ae jz" href="https://loopback.io/doc/en/lb4/apidocs.openapi-v3.get.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> @get </strong> </a>:是<a class="ae jz" href="https://loopback.io/doc/en/lb4/Decorators_openapi.html#operation-decorator" rel="noopener ugc nofollow" target="_blank"> @operation </a> decorator的简写，用于定义端点的<em class="ky">动词、路径、参数和响应</em>。通过这种简化，我们公开了一个带有端点<code class="fe mx my mz mo b">/ping</code>的<code class="fe mx my mz mo b">GET</code>请求。当然Loopback为其他<em class="ky"> HTTP动词提供了同样的简写:<br/>-</em><a class="ae jz" href="https://loopback.io/doc/en/lb4/apidocs.openapi-v3.post.html" rel="noopener ugc nofollow" target="_blank"><strong class="kc io">Post</strong></a><br/>-<a class="ae jz" href="https://loopback.io/doc/en/lb4/apidocs.openapi-v3.put.html" rel="noopener ugc nofollow" target="_blank"><strong class="kc io">Put</strong></a><br/>-<a class="ae jz" href="https://loopback.io/doc/en/lb4/apidocs.openapi-v3.patch.html" rel="noopener ugc nofollow" target="_blank"><strong class="kc io">Patch</strong></a><br/>-<a class="ae jz" href="https://loopback.io/doc/en/lb4/apidocs.openapi-v3.del.html" rel="noopener ugc nofollow" target="_blank"><strong class="kc io">Del</strong></a></li><li id="e3a0" class="nh ni in kc b kd nq kh nr kl ns kp nt kt nu kx nm nn no np bi translated"><a class="ae jz" href="https://loopback.io/doc/en/lb4/Decorators_openapi.html#oasresponse" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> @response </strong> </a>:这是另一个用来定义你的端点如何响应的便利装饰器。我们可以手动设置响应对象(使用<code class="fe mx my mz mo b">ResponseObject</code>类型)或者使用<strong class="kc io">域对象</strong>。</li></ul><figure class="mj mk ml mm gt jo"><div class="bz fp l di"><div class="og oh l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">A response object</figcaption></figure><p id="4122" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">像往常一样，要创建一个空的<strong class="kc io">控制器</strong>，我们可以使用CLI命令:<code class="fe mx my mz mo b">lb4 controller</code>。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oi"><img src="../Images/058da89287cc02ecb29e1bb6cb8e5216.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CTyK23twBFLe4Nk6owKNFA.png"/></div></div></figure><p id="8a45" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面的命令创建了一个空的<strong class="kc io">控制器</strong>，但是使用相同的命令，我们也可以创建CRUD控制器来在<strong class="kc io">数据库模型上执行基本的CRUD操作。</strong></p><p id="f3f1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了做到这一点，我们首先需要一个<strong class="kc io">存储库</strong>和一个<strong class="kc io">数据源</strong> <em class="ky">。</em></p><p id="1f7e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以，让我们来探索它们。</p><h1 id="e303" class="lg lh in bd li lj nb ll lm ln nc lp lq lr nd lt lu lv ne lx ly lz nf mb mc md bi translated">数据源</h1><p id="bad2" class="pw-post-body-paragraph ka kb in kc b kd me kf kg kh mf kj kk kl mg kn ko kp mh kr ks kt mi kv kw kx ig bi translated">一个<strong class="kc io"> <em class="ky">数据源</em> </strong>使用一个<a class="ae jz" href="https://loopback.io/doc/en/lb4/Connectors-reference.html" rel="noopener ugc nofollow" target="_blank"> <em class="ky">连接器</em> </a>来表示外部系统中的数据。多亏了数据源，我们可以将SQL和NoSQL数据库连接器、SOAP服务或Loopback或社区提供的任何其他内置连接器附加到我们的应用程序上。</p><p id="39c5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了创建一个数据源，我们可以使用CLI命令:<code class="fe mx my mz mo b">lb4 datasource</code></p><p id="2cbd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">该命令将指导我们选择连接器类型、配置，并为我们生成所有需要的代码。<br/>有几十个内置连接器，创建一个只需几秒钟！</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oj"><img src="../Images/6864dbc5d1f95ec43a04e43cc937ff79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0CimX1mCvA5fHwpAymkx4g.png"/></div></div></figure><h1 id="141a" class="lg lh in bd li lj nb ll lm ln nc lp lq lr nd lt lu lv ne lx ly lz nf mb mc md bi translated">仓库</h1><p id="582f" class="pw-post-body-paragraph ka kb in kc b kd me kf kg kh mf kj kk kl mg kn ko kp mh kr ks kt mi kv kw kx ig bi translated">一个<strong class="kc io"> <em class="ky">存储库</em> </strong> <em class="ky"> </em>提供数据访问操作(例如，CRUD APIs)来针对数据库或服务(或更一般的<strong class="kc io">数据源</strong>)操纵域对象。</p><p id="f777" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，虽然<strong class="kc io">模型</strong>描述了域对象的形状，但是<strong class="kc io">库</strong>添加了行为，反映了对<strong class="kc io">数据源</strong>的每一个操作。</p><p id="9bbf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Loopback提供了很少的内置存储库来创建CRUD或键值操作。这些实现基本上将<strong class="kc io">数据库模型</strong> <em class="ky"> ( </em>实体<em class="ky"> ) </em> <strong class="kc io"> </strong>链接到<strong class="kc io">数据源</strong> <em class="ky"> </em>并自动生成访问数据的逻辑。</p><p id="7ee5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们如何为CRUD操作创建一个基本的存储库？</p><p id="e19a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">CLI将再次帮助我们。使用命令<code class="fe mx my mz mo b">lb4 repository</code>，我们将被引导选择<strong class="kc io">数据源</strong>和<strong class="kc io">实体</strong>，最终将为我们生成代码。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oj"><img src="../Images/5dc1eadbbdf1519433fe6dcb1b197491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aNkbWspMA9nghd7omAGwEQ.png"/></div></div></figure><p id="a3be" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，有了这个新创建的<strong class="kc io">库</strong> <em class="ky"> </em>，我们就有了API来对一个<strong class="kc io">实体</strong> <em class="ky"> </em>执行CRUD操作，这些操作将被反映到<strong class="kc io">数据源</strong>。</p><p id="8976" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">例如，可以调用这些API的地方是<strong class="kc io"> <em class="ky">控制器</em> </strong>。</p><p id="b215" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">事实上，命令<code class="fe mx my mz mo b">lb4 controller</code>和<code class="fe mx my mz mo b">lb4 relation</code>都会生成控制器，这些控制器使用存储库的API来操纵实体，并以透明的方式为数据源提供信息。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oj"><img src="../Images/01677e70dab981b77f94025e488c1821.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OEL8J4D_PRCnF23j4qjvwQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Controller with CRUD operations</figcaption></figure></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><h1 id="5256" class="lg lh in bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">一款包含5个步骤的票务管理应用</h1><p id="6d66" class="pw-post-body-paragraph ka kb in kc b kd me kf kg kh mf kj kk kl mg kn ko kp mh kr ks kt mi kv kw kx ig bi translated">现在，我们将创建一个非常简单的应用程序，允许用户以无纸化的方式收集他们的门票或购物卡。这将是超级快，我们甚至不会打开一个编辑器来做这件事。让我们看看步骤:</p><p id="c1a7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">1.用<code class="fe mx my mz mo b">lb4 app</code>启动项目。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/a0c7b8f4a3b926bcfb2fae7c0353ec2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ayUvediDYY13ViCF7mrKog.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">App creation</figcaption></figure><p id="7dab" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2.用<code class="fe mx my mz mo b">lb4 model</code>创建以下域对象:<strong class="kc io">用户</strong>和<strong class="kc io">票证。<br/> </strong>属性可以很少:一个<em class="ky">电子邮件</em>和一个<em class="ky">名称</em>用于<strong class="kc io">用户</strong>和一个<em class="ky">标题</em>和一个<em class="ky">描述</em>用于<strong class="kc io">票据。</strong>然后，<strong class="kc io"> </strong>我们希望它们在数据库中持久化，所以它们需要是<em class="ky">实体</em>并有一个<em class="ky"> id。</em></p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oi"><img src="../Images/4e4377efd6b0cb87a6887867ab666595.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B8z3LYSIKtYntXcQqqHl9w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">User entity</figcaption></figure><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oi"><img src="../Images/161185c7306bd78f135e52367c216c63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*54Acfr-tT0QwXoIa_My1lQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Ticket entity</figcaption></figure><p id="a763" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.使用<code class="fe mx my mz mo b">lb4 datasource</code>创建一个带有数据库连接器(例如MongoDB)的<strong class="kc io">数据源</strong>。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oj"><img src="../Images/6864dbc5d1f95ec43a04e43cc937ff79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0CimX1mCvA5fHwpAymkx4g.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Datasource with a MongoDB connector</figcaption></figure><p id="21ae" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">4.使用<code class="fe mx my mz mo b">lb4 repository</code>创建两个<strong class="kc io">库</strong>来为<strong class="kc io">数据库模型</strong>添加CRUD操作:<strong class="kc io">用户库</strong>和<strong class="kc io">票据库</strong>。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oj"><img src="../Images/5dc1eadbbdf1519433fe6dcb1b197491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aNkbWspMA9nghd7omAGwEQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">CRUD Repositories</figcaption></figure><p id="c28b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">5.创建<strong class="kc io">关系</strong>与<code class="fe mx my mz mo b">lb4 relation</code> : <br/> <strong class="kc io">。</strong>一个<strong class="kc io">用户</strong> <em class="ky">有很多</em> <strong class="kc io">票<br/>。</strong>一张<strong class="kc io">票</strong> <em class="ky">归属于</em> <strong class="kc io"> <em class="ky"> </em> </strong> <em class="ky">一张</em> <strong class="kc io"> <em class="ky">用户</em> </strong></p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oj"><img src="../Images/5c0a36d6da91834ad3c70b902587caa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZvNe_0FUmb1tny46c1X9w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Relation User HasMany Ticket</figcaption></figure><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oi"><img src="../Images/934964d6123a3c70e701f3c1ac41ac31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6nlLzjmIxDvYmcVeTAWNHw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Relation Ticket BelongsTo User</figcaption></figure><p id="c05c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">就是这样！正如您所看到的，所有的事情都可以用Loopback CLI来完成，而无需编写任何代码！</p><p id="83fa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在使用<code class="fe mx my mz mo b">yarn start</code>运行项目，并打开位于<a class="ae jz" href="http://localhost:3000/explorer/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/explorer/</a>的api explorer</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ok"><img src="../Images/7f77c22a587e7fe6ed88b8b72439886d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SWqTrcHhJW3pb20WlGzukA.png"/></div></div></figure><p id="bb7d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">瞧啊！创建我们的REST APIs花了5分钟和0行代码！</p><p id="df4c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当然，这个应用程序缺少一些(非常)重要的服务，比如<em class="ky">认证</em>和<em class="ky">授权</em>，但是我们将在下次用更多的代码来探索它们。😁</p><p id="eee5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">更多内容请看</em><a class="ae jz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="ky">plain English . io</em></strong></a><em class="ky">。报名参加我们的</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="ky">免费周报</em> </strong> </a> <em class="ky">。关注我们关于</em><a class="ae jz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="ky">Twitter</em></strong></a><em class="ky">和</em><a class="ae jz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="ky">LinkedIn</em></strong></a><em class="ky">。加入我们的</em> <a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="ky">社区不和谐</em> </strong> </a> <em class="ky">。</em></p></div></div>    
</body>
</html>