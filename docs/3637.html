<html>
<head>
<title>How to Communicate between Components with Custom Events</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用自定义事件在组件之间进行通信</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-communicate-between-components-with-custom-events-f92519d51271?source=collection_archive---------5-----------------------#2022-09-13">https://javascript.plainenglish.io/how-to-communicate-between-components-with-custom-events-f92519d51271?source=collection_archive---------5-----------------------#2022-09-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4e8f60fac32612d7a414074497802d9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w4f9pYVewJBO9j2YlwmJVg.png"/></div></div></figure><p id="cee9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">需要使用不同的JavaScript框架，从而在应用程序的所有组件之间进行通信？您可以使用的解决方案之一是使用浏览器自带的自定义事件。在这篇文章中找到答案。</p><h1 id="2124" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">自定义事件:是什么？</h1><p id="c71f" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">与经典事件如<strong class="ka ir">点击</strong>、<strong class="ka ir">提交</strong>、<strong class="ka ir">聚焦</strong>……相同，只是它们是手工创建的。创建一个<a class="ae lz" href="https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">客户事件</strong> </a>有两种可能，要么使用客户事件(如果需要传递数据)，要么简单地调用事件。</p><p id="1191" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在下面的示例中，函数用于创建自定义事件:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="3d01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在只需发送自定义事件:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><blockquote class="mg mh mi"><p id="3ce9" class="jy jz mj ka b kb kc kd ke kf kg kh ki mk kk kl km ml ko kp kq mm ks kt ku kv ij bi translated"><code class="fe mn mo mp mq b"><em class="iq">document</em></code> <em class="iq"> </em>用作所有自定义事件的单个事件处理程序，因为它集中了所有事件方法，并将自定义事件与页面上的特定节点分离。</p></blockquote><p id="fbc4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后一步，您必须监听这些事件并实现逻辑:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="4aa5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请记住在必要时清理和删除事件侦听器，请参见下面的示例:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="e654" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，确保事件侦听器在那里并且没有多次附加到网页的一种方法是使用Chrome开发工具检查这一点。这可能是这样的:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/9a611f15d348b41c85920c8da6324a26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FJhtVQ1awxotZcqwGCzlEA.png"/></div></div></figure><p id="5549" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了更进一步，对于前面没有提到的<a class="ae lz" href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="mj">addevent listener</em></strong></a><strong class="ka ir"><em class="mj"/></strong>方法，还有第三个参数。这是<code class="fe mn mo mp mq b">once</code>参数，它很有用，这样事件监听器只执行一次，并在调用后自动销毁。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><h1 id="9156" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">让我们以React为例</h1><p id="859c" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">这个app是用<strong class="ka ir"> Create React App </strong>和<strong class="ka ir"> Chakra UI </strong>创建的。它代表了一个关于电子商务的经典课程，也就是说，向篮子中添加一个产品，显示篮子的总量，并显示完成的篮子。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/b958fdec1552c8652a8d0dcfdfabfac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TnDyvZjpe3pe14xbXUILAw.png"/></div></div></figure><p id="e213" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是应用程序容器。在它里面有三个容器(<strong class="ka ir">ViewCartButtonContainer</strong>、<strong class="ka ir">AddToCartButtonContainer</strong>、<strong class="ka ir"> CartContainer </strong>)。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk"><code class="fe mn mo mp mq b">src/containers/App.tsx</code></figcaption></figure><p id="28fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所有这些容器都是完全独立的，通过<code class="fe mn mo mp mq b">useCart</code>钩子通过事件总线系统进行通信。</p><p id="ca02" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个挂钩公开了购物车中的产品列表及其总价，还公开了三个定制方法和事件:</p><ul class=""><li id="0071" class="mx my iq ka b kb kc kf kg kj mz kn na kr nb kv nc nd ne nf bi translated">更新购物车<code class="fe mn mo mp mq b">updateCart</code>。</li></ul><p id="2798" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为此，通过触发<code class="fe mn mo mp mq b">onUpdateCart</code>方法的useEffect监听<code class="fe mn mo mp mq b">updateCart</code>事件。该方法添加或更改购物车中产品的数量。最好记住使用useCallback的函数，以避免不必要的渲染。注意，在<strong class="ka ir"> <em class="mj"> useEffect </em> </strong>中，每次方法改变<code class="fe mn mo mp mq b">onUpdateCart</code>时，监听器都会被移除。这适用于示例中的所有useEffects。</p><ul class=""><li id="48aa" class="mx my iq ka b kb kc kf kg kj mz kn na kr nb kv nc nd ne nf bi translated">清空购物车<code class="fe mn mo mp mq b">clearCart</code>。</li><li id="e268" class="mx my iq ka b kb ng kf nh kj ni kn nj kr nk kv nc nd ne nf bi translated">而这辆大车的开口<code class="fe mn mo mp mq b">openCart</code>。</li></ul><p id="25cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于后两个事件，事件侦听器的逻辑是相似的。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk"><code class="fe mn mo mp mq b">src/hooks/useCart.ts</code></figcaption></figure><p id="14d1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于容器，其中的第一个<code class="fe mn mo mp mq b">CartButtonViewContainer</code>显示购物车的数量，并允许您进入购物车。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">src/<code class="fe mn mo mp mq b">containers</code>/CartButtonView/CartButtonView.tsx</figcaption></figure><p id="f269" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第二个容器<code class="fe mn mo mp mq b">AddToCardButtonContainer</code>允许您将产品添加到购物车并更改其数量。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk"><code class="fe mn mo mp mq b">src/containers/</code>AddToCartButton<code class="fe mn mo mp mq b">/AddToCartButton.tsx</code></figcaption></figure><p id="9b07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，最后一个容器<code class="fe mn mo mp mq b">CartContainer</code>显示购物车中的产品。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk"><code class="fe mn mo mp mq b">src/containers/Cart/Cart.tsx</code></figcaption></figure><p id="93b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此处可访问<a class="ae lz" href="https://github.com/crayOmn/react-app-with-custom-events" rel="noopener ugc nofollow" target="_blank">代码。</a></p><p id="9a76" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">定制事件非常受特性团队和微前端架构项目的欢迎，因为它们可以相互独立，也不受JavaScript框架的影响。</p></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="d4d9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mj">More content at </em><a class="ae lz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="mj">PlainEnglish.io</em></strong></a><em class="mj">. Sign up for our </em><a class="ae lz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="mj">free weekly newsletter</em></strong></a><em class="mj">. Follow us on </em><a class="ae lz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="mj">Twitter</em></strong></a>, <a class="ae lz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="mj">LinkedIn</em></strong></a><strong class="ka ir"><em class="mj">, </em></strong><a class="ae lz" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="mj">YouTube</em></strong></a><strong class="ka ir"><em class="mj">, and</em></strong><em class="mj"> </em><a class="ae lz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="mj">Discord</em></strong></a><strong class="ka ir"><em class="mj">.</em></strong><em class="mj"> Interested in Growth Hacking? Check out </em><a class="ae lz" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="mj">Circuit</em></strong></a><strong class="ka ir"><em class="mj">.</em></strong></p></div></div>    
</body>
</html>