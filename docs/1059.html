<html>
<head>
<title>JavaScript Promises: Understanding Promise.any()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript Promises:理解Promise.any()</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-promises-understanding-promise-any-d8640d4c6ae5?source=collection_archive---------14-----------------------#2022-03-01">https://javascript.plainenglish.io/javascript-promises-understanding-promise-any-d8640d4c6ae5?source=collection_archive---------14-----------------------#2022-03-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/9cda5ea26c2b01abc1c2320806f44316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Zio88-JSHV4e5WAW"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@sapegin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Artem Sapegin</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ac62" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ECMAScript 2021是最新的JavaScript版本，它为JavaScript语言引入了多个新特性。在本文中，我们将学习如何使用<code class="fe ky kz la lb b">Promise.any() </code>方法来执行我们的异步调用。</p><h1 id="0b44" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">Promise.any()方法</h1><p id="03ec" class="pw-post-body-paragraph ka kb in kc b kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx ig bi translated"><code class="fe ky kz la lb b">Promise.any()</code>将可迭代对象(如承诺数组)作为输入，并返回单个承诺，该承诺在可迭代对象中的任何承诺履行时立即解析，并返回已履行承诺的值。</p><pre class="mf mg mh mi gt mj lb mk ml aw mm bi"><span id="2e4d" class="mn ld in lb b gy mo mp l mq mr">const data = Promise.any([promise1,...]) // iterable object</span></pre><p id="366c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以使用<strong class="kc io">提取承诺解析值。然后</strong>语法:-</p><pre class="mf mg mh mi gt mj lb mk ml aw mm bi"><span id="3a0a" class="mn ld in lb b gy mo mp l mq mr">data.then((values) =&gt; {<br/>  values; // [resultOfPromise1, resultOfPromise2, ...]<br/>}).catch(error =&gt; {<br/>  console.log(error)<br/>}</span></pre><p id="17f3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">或者<strong class="kc io">异步/等待</strong>:</p><pre class="mf mg mh mi gt mj lb mk ml aw mm bi"><span id="7dd2" class="mn ld in lb b gy mo mp l mq mr">try{<br/> const result = await data;<br/> console.log(result); //[resultPromise1, resultPromise2, ...]<br/>} catch (error =&gt; {<br/> console.log(error);<br/>}</span></pre><p id="1244" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">关于<code class="fe ky kz la lb b">promise.any()</code>要记住的几点</p><ul class=""><li id="d685" class="ms mt in kc b kd ke kh ki kl mu kp mv kt mw kx mx my mz na bi translated">如果所有的承诺都实现了，那么无论哪个承诺执行得更快都将是结果。</li><li id="4e7a" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated">如果其中一个承诺被拒绝，那么<code class="fe ky kz la lb b">promise.any()</code>忽略被拒绝的承诺并返回花费<strong class="kc io">较少</strong>时间的承诺</li><li id="9826" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated">如果所有的承诺都被拒绝，那么<code class="fe ky kz la lb b">promise.any()</code>方法被一个<strong class="kc io">聚合</strong>错误对象拒绝。</li></ul><p id="f437" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了更好地理解上述观点，我将向您展示一个示例:</p><h2 id="0988" class="mn ld in bd le ng nh dn li ni nj dp lm kl nk nl lq kp nm nn lu kt no np ly nq bi translated">例1:所有承诺都兑现了</h2><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nr"><img src="../Images/c4ea885995823b513beeed19ee499766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ko756dxA0vrQ_EKM0-UjTQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">time: t1 for promise_1, t2: for promise_2</figcaption></figure><p id="7b22" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如图所示:</p><ul class=""><li id="39d8" class="ms mt in kc b kd ke kh ki kl mu kp mv kt mw kx mx my mz na bi translated"><code class="fe ky kz la lb b">promise_1</code>在时间t1解析为值<code class="fe ky kz la lb b">value_1</code>。</li><li id="e23b" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated"><code class="fe ky kz la lb b">promise_2</code>在时间t2解析为值<code class="fe ky kz la lb b">value_2</code>。</li><li id="5e9e" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated"><code class="fe ky kz la lb b">Promise.any</code>返回<code class="fe ky kz la lb b">value_2</code> as，promise_2解析速度比promise_1快，这是promise_2的结果。</li></ul><p id="8ada" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以下示例演示了所有承诺都已兑现的<code class="fe ky kz la lb b">Promise.any()</code>方法:</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ns"><img src="../Images/9d840ccab45ef35d0d8e44be87c069f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9pOdnDxdlHBL5ZA7V2FuAQ.png"/></div></div></figure><p id="9fb0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如您在上面的代码中所看到的，<code class="fe ky kz la lb b"> promise.any()</code>将返回<strong class="kc io">‘3’</strong>，因为它将查找成功履行且执行时间较短的承诺。</p><h2 id="02db" class="mn ld in bd le ng nh dn li ni nj dp lm kl nk nl lq kp nm nn lu kt no np ly nq bi translated">示例2:一个承诺被拒绝</h2><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/69fd6f0ce543f40fd99e8b5d7a1a07d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*0VCfLCX30eQbGQoWJ6TkNw.png"/></div></div></figure><p id="afa3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如图所示:</p><ul class=""><li id="8e17" class="ms mt in kc b kd ke kh ki kl mu kp mv kt mw kx mx my mz na bi translated"><code class="fe ky kz la lb b">promise1</code>在T1因出错而被拒绝。</li><li id="8824" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated"><code class="fe ky kz la lb b">promise2</code>在时间t2解析为值<code class="fe ky kz la lb b">v2</code>。</li><li id="bee7" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated"><code class="fe ky kz la lb b">Promise.any</code>返回<code class="fe ky kz la lb b">v2</code>，因为它将忽略被拒绝的承诺(promises 1)</li></ul><p id="99eb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以下示例演示了一个承诺被拒绝的<code class="fe ky kz la lb b">Promise.any()</code>方法:</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nu"><img src="../Images/d49815fccb879c1988f8f434dd3a16af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V9WsR6k1kkWd6vZ3Qrgn2g.png"/></div></div></figure><p id="95df" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在上面的代码中可以看到，这里的最后一个承诺是最快的，但是被拒绝了，所以第二个承诺就成了结果。在第一个实现的承诺获胜后，所有其他承诺都被忽略，因此这里的值为“1”</p><p id="fd39" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">示例3:拒绝所有承诺</strong></p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/83f69c1ce8716392595ec87df5ade016.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*zC-c3Bue5msQ50zCPPL5jg.png"/></div></figure><p id="a183" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如图所示:</p><ul class=""><li id="910b" class="ms mt in kc b kd ke kh ki kl mu kp mv kt mw kx mx my mz na bi translated">在t1因错误而被拒绝。</li><li id="45c2" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated"><code class="fe ky kz la lb b">promise2</code>在时间t2因出错而被拒绝。</li><li id="c0ee" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated"><code class="fe ky kz la lb b">Promise.any</code>返回一个在T2被拒绝的承诺，其汇总包含错误1和错误2</li></ul><p id="a268" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以下示例演示了拒绝所有承诺的<code class="fe ky kz la lb b">Promise.any()</code>方法:</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nw"><img src="../Images/1914fc6ea81c202a68a7685168aee2fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oBXm6iodBwmyvP-PoYcE-Q.png"/></div></div></figure><p id="34ed" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这个例子中，两个承诺都被拒绝，错误为“哎哟”和“错误”字符串。因此，<code class="fe ky kz la lb b">promise.any()</code>方法将返回一个具有这些错误属性的聚集对象。</p><h1 id="d35a" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">结论:</h1><p id="1808" class="pw-post-body-paragraph ka kb in kc b kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx ig bi translated"><code class="fe ky kz la lb b">Promise.any()</code>有助于以竞争方式并行执行独立的异步操作，以获得任何第一个成功解析的承诺的值。</p><p id="1137" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它接受一个<strong class="kc io">可迭代对象</strong>，比如一个承诺数组作为输入。</p><ul class=""><li id="0a48" class="ms mt in kc b kd ke kh ki kl mu kp mv kt mw kx mx my mz na bi translated">使用JavaScript <code class="fe ky kz la lb b">Promise.any()</code>方法获取一个承诺列表，并返回一个首先被<strong class="kc io">实现的承诺。</strong></li></ul><p id="4a88" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all#browser_compatibility" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io">浏览器兼容性</strong> </a></p><p id="0ba3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请注意，除了internet explorer和opera之外，所有现代浏览器都完全支持<code class="fe ky kz la lb b">promise.any()</code>。</p><p id="619a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> ⭐注意<em class="nx"> Node.js 15.0.0 </em>中支持Promise.any()。如果你的node.js版本比那个版本老<em class="nx">，控制台可能会显示一个<em class="nx">类型的错误:承诺。any不是函数</em>消息，需要更新后再试。</em></strong></p><blockquote class="ny nz oa"><p id="f775" class="ka kb nx kc b kd ke kf kg kh ki kj kk ob km kn ko oc kq kr ks od ku kv kw kx ig bi translated">请在评论区分享你的观点，是的，欢迎反馈。<br/>希望你会喜欢并分享这篇文章，以便更好地到达<br/>查看我的其他文章在—<a class="ae jz" href="https://medium.com/@aayushtibra1997" rel="noopener"><strong class="kc io">https://medium.com/@aayushtibra1997</strong></a><strong class="kc io"><br/>感谢阅读:)</strong></p></blockquote><p id="1e3d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nx">更多内容请看</em><a class="ae jz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="nx">plain English . io</em></strong></a><em class="nx">。报名参加我们的</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="nx">免费周报</em> </strong> </a> <em class="nx">。关注我们关于</em><a class="ae jz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="nx">Twitter</em></strong></a><em class="nx">和</em><a class="ae jz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="nx">LinkedIn</em></strong></a><em class="nx">。加入我们的</em> <a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="nx">社区不和谐</em> </strong> </a> <em class="nx">。</em></p></div></div>    
</body>
</html>