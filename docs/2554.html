<html>
<head>
<title>GraphQL Services, Nested Queries and MongoDB Connection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GraphQL服务、嵌套查询和MongoDB连接</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/graphql-services-and-mongodb-connection-b48b86289e93?source=collection_archive---------17-----------------------#2022-06-15">https://javascript.plainenglish.io/graphql-services-and-mongodb-connection-b48b86289e93?source=collection_archive---------17-----------------------#2022-06-15</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="ec69" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">如何使用<strong class="ak"> GraphQL </strong>服务写入<strong class="ak"> MongoDB </strong>。</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/3908d24e0d4df3ab6bfeedf2e8a975ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ai_2lcsoDx80VOxm"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Photo by <a class="ae kw" href="https://unsplash.com/@campaign_creators?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Campaign Creators</a> on <a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f4f9" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">你好，在今天的文章中，我将向你展示如何使用<strong class="kz is"> GraphQL </strong>服务向<strong class="kz is"> MongoDB </strong>写东西。</p><p id="cbdb" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">我们要做的第一步非常简单。然后，我将向您展示，如果您需要保存嵌套数据，您可以做些什么。</p><p id="259b" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">首先，让我们安装将要使用的软件包。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="lt lu l"/></div></figure><p id="868b" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><strong class="kz is"> nodemon </strong>包检测你的应用程序何时发生变化，并允许你运行应用程序，而不必停止/启动它。</p><p id="981d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><code class="fe lv lw lx ly b">yarn nodemon / npm nodemon</code></p><p id="2e2c" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在让我们打开我们的server.js文件。首先，让我们建立Mongo连接。</p><pre class="kh ki kj kk gu lz ly ma mb aw mc bi"><span id="8e07" class="md me ir ly b gz mf mg l mh mi">const MONGO_URI = 'your mongo url'<br/>if (!MONGO_URI) { throw new Error('') }</span></pre><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj mj"><img src="../Images/41a55a597fcb0c0a507b5e9f75666538.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vh6IQnJi_nffdJej975pbw.png"/></div></div></figure><p id="58ee" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">创建db后，您可以通过单击connect从这里访问Mongo URL。</p><pre class="kh ki kj kk gu lz ly ma mb aw mc bi"><span id="c8fa" class="md me ir ly b gz mf mg l mh mi"><strong class="ly is"><em class="mk">mongoose</em></strong>.<strong class="ly is"><em class="mk">Promise </em></strong>= <strong class="ly is"><em class="mk">global</em></strong>.Promise<br/><strong class="ly is"><em class="mk">mongoose</em></strong>.connect(MONGO_URI)<br/><strong class="ly is"><em class="mk">mongoose</em></strong>.connection<br/>    .once('open', () =&gt; <strong class="ly is"><em class="mk">console</em></strong>.log('Connected to MongoLab instance.'))<br/>    .on('error', error =&gt; <strong class="ly is"><em class="mk">console</em></strong>.log('Error connecting to MongoLab:', error))</span></pre><p id="752d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">让我们将这些代码添加到server.js文件中。然后保存并检查连接是否建立。</p><p id="1781" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><strong class="kz is">创建GraphQL查询</strong></p><p id="d43b" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">首先，我们用GraphQLObjectType为将要创建的服务创建一个模式。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="lt lu l"/></div></figure><p id="9ce6" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">fields: () =&gt; ({…})将包含我们想要保存到db的字段。</p><p id="789a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">标签和细节字段将采用列表的形式。我在另一个文件中创建了他们的模式。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="lt lu l"/></div></figure><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="lt lu l"/></div></figure><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="lt lu l"/></div></figure><p id="d7a0" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如果你看，两者是一样的。我们将使用<strong class="kz is">标签类型</strong>进行查询。在写突变的时候，我们将使用<strong class="kz is"> TagsInputType </strong>。</p><p id="9010" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在我们需要创建一个根查询类型。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="lt lu l"/></div></figure><p id="2a39" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">我们将使用我在这里创建的表单字段查询graphql。</p><p id="4a1d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在让我们创造一个突变。</p><h2 id="a1a8" class="md me ir bd ml mm mn dn mo mp mq dp mr lg ms mt mu lk mv mw mx lo my mz na nb bi translated">创造GrapghQL突变</h2><p id="f11b" class="pw-post-body-paragraph kx ky ir kz b la nc js lc ld nd jv lf lg ne li lj lk nf lm ln lo ng lq lr ls ik bi translated">突变是我们将进行添加、删除和编辑等操作的查询。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="lt lu l"/></div></figure><p id="e557" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">让我们创建schema.ts文件。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="lt lu l"/></div></figure><p id="5f7e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">让我们将创建的schema.js添加到server.js文件中</p><pre class="kh ki kj kk gu lz ly ma mb aw mc bi"><span id="18e1" class="md me ir ly b gz mf mg l mh mi">const { graphqlHTTP } = require('express-graphql')<br/>const <strong class="ly is"><em class="mk">schema </em></strong>= require('./schema/schema')<br/>.<br/>.<br/>.<br/>app.use('/graphql', graphqlHTTP({<br/>    <strong class="ly is"><em class="mk">schema</em></strong>,<br/>    graphiql: true<br/>}))</span></pre><p id="fa34" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">让我们创建要保存在Mongo中的模型。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="lt lu l"/></div></figure><p id="e42b" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在我们已经编写了代码，是时候运行我们的项目了。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nh"><img src="../Images/4d0e4576c5865c9b56f3413008758198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rqw7lCWSZ0WrRYlhmFRumQ.png"/></div></div></figure><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj ni"><img src="../Images/f4b9e639cbd267d14a1843a39f10bc67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B8Ku4__roDmVspibwfrmEw.png"/></div></div></figure><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nj"><img src="../Images/9e26591605424e929220daf38da51af4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3mn2lvfxOgTEs6YpFK6XFg.png"/></div></div></figure><p id="75b0" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">通过像这样在GraphQL上编写一个查询，您可以将数据保存到db并显示来自db的数据。</p><p id="9209" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在让我们来看看MongoDB。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nk"><img src="../Images/4dd3a86b1456e7abb7f9ffeaeb46bfac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dUBy3cV7lVEPZ3qsGxu43A.png"/></div></div></figure><p id="802f" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这是所有的交易。我在GitHub上分享代码。</p><p id="0de9" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">谢谢你。</p><div class="nl nm gq gs nn no"><a href="https://github.com/besteenurk/server" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fp"><div class="nq ab nr cl cj ns"><h2 class="bd is gz z fq nt fs ft nu fv fx iq bi translated">GitHub - besteenurk/server</h2><div class="nv l"><h3 class="bd b gz z fq nt fs ft nu fv fx dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nw l"><p class="bd b dl z fq nt fs ft nu fv fx dk translated">github.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc kq no"/></div></div></a></div><div class="nl nm gq gs nn no"><a href="https://bestte.medium.com/membership" rel="noopener follow" target="_blank"><div class="np ab fp"><div class="nq ab nr cl cj ns"><h2 class="bd is gz z fq nt fs ft nu fv fx iq bi translated">通过我的推荐链接加入Medium—Beste</h2><div class="nv l"><h3 class="bd b gz z fq nt fs ft nu fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nw l"><p class="bd b dl z fq nt fs ft nu fv fx dk translated">bestte.medium.com</p></div></div><div class="nx l"><div class="od l nz oa ob nx oc kq no"/></div></div></a></div><div class="nl nm gq gs nn no"><a rel="noopener  ugc nofollow" target="_blank" href="/various-uses-of-the-javascript-library-particles-js-with-next-js-212e630bd538"><div class="np ab fp"><div class="nq ab nr cl cj ns"><h2 class="bd is gz z fq nt fs ft nu fv fx iq bi translated">JavaScript库Particles.js与Next.js的各种用法</h2><div class="nv l"><h3 class="bd b gz z fq nt fs ft nu fv fx dk translated">用npm包给你的页面添加一些动画怎么样？</h3></div><div class="nw l"><p class="bd b dl z fq nt fs ft nu fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="nx l"><div class="oe l nz oa ob nx oc kq no"/></div></div></a></div><div class="nl nm gq gs nn no"><a rel="noopener  ugc nofollow" target="_blank" href="/create-graphql-mutations-in-react-app-and-use-them-1eeb89545033"><div class="np ab fp"><div class="nq ab nr cl cj ns"><h2 class="bd is gz z fq nt fs ft nu fv fx iq bi translated">在React App中创建GraphQL突变并使用它们</h2><div class="nv l"><h3 class="bd b gz z fq nt fs ft nu fv fx dk translated">API操作是几乎所有应用程序的构建块。GraphQL在这个阶段也帮助了我们。准备好…</h3></div><div class="nw l"><p class="bd b dl z fq nt fs ft nu fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="nx l"><div class="of l nz oa ob nx oc kq no"/></div></div></a></div><div class="nl nm gq gs nn no"><a rel="noopener  ugc nofollow" target="_blank" href="/5-things-you-should-know-about-react-router-version-6-bbf3d617c73e"><div class="np ab fp"><div class="nq ab nr cl cj ns"><h2 class="bd is gz z fq nt fs ft nu fv fx iq bi translated">关于React路由器版本6你应该知道的5件事</h2><div class="nv l"><h3 class="bd b gz z fq nt fs ft nu fv fx dk translated">了解这个最常用和最重要的React包的最新版本中的重大变化。</h3></div><div class="nw l"><p class="bd b dl z fq nt fs ft nu fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="nx l"><div class="og l nz oa ob nx oc kq no"/></div></div></a></div><p id="1bf6" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><em class="mk">更多内容请看</em><a class="ae kw" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kz is"><em class="mk">plain English . io</em></strong></a><em class="mk">。报名参加我们的</em> <a class="ae kw" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is"> <em class="mk">免费周报</em> </strong> </a> <em class="mk">。关注我们关于</em><a class="ae kw" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kz is"><em class="mk">Twitter</em></strong></a><em class="mk">和</em><a class="ae kw" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kz is"><em class="mk">LinkedIn</em></strong></a><em class="mk">。查看我们的</em> <a class="ae kw" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is"> <em class="mk">社区不和谐</em> </strong> </a> <em class="mk">加入我们的</em> <a class="ae kw" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is"> <em class="mk">人才集体</em> </strong> </a> <em class="mk">。</em></p></div></div>    
</body>
</html>