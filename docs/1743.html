<html>
<head>
<title>How to Add Firebase Push Notifications to Your React Native App for iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Firebase推送通知添加到iOS版React原生应用中</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-add-firebase-push-notifications-on-your-react-native-app-for-ios-369806ea8c04?source=collection_archive---------3-----------------------#2022-04-15">https://javascript.plainenglish.io/how-to-add-firebase-push-notifications-on-your-react-native-app-for-ios-369806ea8c04?source=collection_archive---------3-----------------------#2022-04-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/9d9e0b87db3bc29390c688fd94915267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o1YsDI3ShZ8HY49CW3aImQ.png"/></div></div></figure><p id="7a17" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">React原生应用的主要功能之一是Firebase推送通知，这将增加与最终用户的互动，并向他们更新您添加到应用中的最新功能。</p><p id="fae2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">今天，我将向您展示如何将Firebase通知功能添加到iOS版React原生应用程序中。所以让我们开始吧。</p></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><p id="5349" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，让我们处理好软件包并下载它们。</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="03f9" class="lj lk in lf b gy ll lm l ln lo"><strong class="lf io">//download the packages that are needed</strong><br/>yarn add @react-native-firebase/app<br/>npm i @react-native-firebase/app<br/>------------------------------------<br/>yarn add @react-native-firebase/messaging<br/>npm i @react-native-firebase/messaging</span></pre><p id="5ab5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在创建一个名为<strong class="jx io">的文件pushNotificationManager.ts </strong></p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="09e1" class="lj lk in lf b gy ll lm l ln lo"><strong class="lf io">//pushNotificationManager.ts</strong></span><span id="d53b" class="lj lk in lf b gy lp lm l ln lo">import messaging from ‘@react-native-firebase/messaging’;<br/>import AsyncStorage from ‘@react-native-async-storage/async-storage’;</span><span id="0d09" class="lj lk in lf b gy lp lm l ln lo">export const requestUserPermission = async () =&gt; {<br/>const authStatus = await messaging().requestPermission();<br/>const enabled =<br/>authStatus === messaging.AuthorizationStatus.AUTHORIZED ||<br/>authStatus === messaging.AuthorizationStatus.PROVISIONAL;</span><span id="16cb" class="lj lk in lf b gy lp lm l ln lo">if (enabled) {<br/>console.log(authStatus) <strong class="lf io">// you can remove the console.log later</strong><br/>GetFCMToken();<br/>}};</span><span id="f0b9" class="lj lk in lf b gy lp lm l ln lo">const GetFCMToken = async () =&gt; {<br/>let fcmtoken = AsyncStorage.getItem(‘fcmtoken’);<br/>if (!fcmtoken) {<br/>try {<br/>let fcmtoken = await messaging().getToken();<br/>if (fcmtoken) {<br/>await AsyncStorage.setItem(‘fcmtoken’, fcmtoken);<br/>}} <br/>catch (error) {console.log(error)}}};</span><span id="6b5c" class="lj lk in lf b gy lp lm l ln lo">export const NotificationListener = () =&gt; {<br/>messaging().onNotificationOpenedApp(remoteMessage =&gt; {<br/>console.log(<br/>‘Notification caused app to open from background state:’,<br/>remoteMessage.notification,<br/>);<br/>});</span><span id="4b53" class="lj lk in lf b gy lp lm l ln lo">messaging().getInitialNotification().then(remoteMessage =&gt; {<br/>if (remoteMessage) {<br/>console.log(<br/>‘Notification caused app to open from quit state:’,<br/>remoteMessage.notification,<br/>);<br/>}});<br/>messaging().onMessage(async remotemessage =&gt; {<br/>console.log(‘remote message’, JSON.stringify(remotemessage));});</span><span id="09c3" class="lj lk in lf b gy lp lm l ln lo">messaging().onNotificationOpenedApp(remotemessage =&gt; {<br/>console.log(‘remote message’, JSON.stringify(remotemessage));<br/>});};</span></pre><p id="f344" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我们创建了我们的<strong class="jx io">pushnotificationmanager . ts</strong>文件之后，我们需要在<strong class="jx io"> App.tsx </strong>和<strong class="jx io"> index.js </strong>上添加几行代码。所以我们来补充一下。</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="d782" class="lj lk in lf b gy ll lm l ln lo"><strong class="lf io"><em class="lq">App.tsx</em></strong><em class="lq"><br/>//import the function that you create on pushnotificationHelper.ts file<br/></em>import { NotificationListener, requestUserPermission } from './src/utils/pushnotificationHelper'; </span><span id="b076" class="lj lk in lf b gy lp lm l ln lo">export default function App() {</span><span id="8ab7" class="lj lk in lf b gy lp lm l ln lo">//below what you need to add<br/><strong class="lf io">useEffect(() =&gt; {<br/>requestUserPermission()<br/>NotificationListener()<br/>}, [])</strong></span><span id="de1b" class="lj lk in lf b gy lp lm l ln lo">return ()}</span></pre></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><pre class="le lf lg lh aw li bi"><span id="6a8a" class="lj lk in lf b gy lr ls lt lu lv lm l ln lo"><strong class="lf io">//index.js file<br/></strong>//you just need to add highlighted code down below</span><span id="4bd2" class="lj lk in lf b gy lp lm l ln lo">import { AppRegistry } from ‘react-native’;</span><span id="6332" class="lj lk in lf b gy lp lm l ln lo">import App from ‘./App’;</span><span id="e5b2" class="lj lk in lf b gy lp lm l ln lo">import { name as appName } from ‘./app.json’;</span><span id="b387" class="lj lk in lf b gy lp lm l ln lo"><strong class="lf io">import messaging from ‘@react-native-firebase/messaging’;</strong></span><span id="4cae" class="lj lk in lf b gy lp lm l ln lo"><strong class="lf io">messaging().setBackgroundMessageHandler(async remoteMessage =&gt; {</strong></span><span id="976a" class="lj lk in lf b gy lp lm l ln lo"><strong class="lf io">console.log(‘Message handled in the background!’, remoteMessage);</strong></span><span id="e646" class="lj lk in lf b gy lp lm l ln lo"><strong class="lf io">});</strong></span><span id="49c4" class="lj lk in lf b gy lp lm l ln lo">AppRegistry.registerComponent(appName, () =&gt; App);</span></pre><p id="af9c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们完成了代码的添加。现在让我们去完成Firebase的工作。</p><p id="efd3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">第一步:</strong>进入Firebase，在项目设置上，你需要添加一个新的iOS app。在下图中，你可以找到如何添加新的应用程序。</p><figure class="la lb lc ld gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/8869cfa08ec0eaac9f605b4d397ff176.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l6M94v2lI_L8HAJT3gYiwg.jpeg"/></div></div></figure><p id="9fac" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">第二步</strong>:你需要正确添加iOS捆绑包名称，这真的很重要。</p><figure class="la lb lc ld gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lx"><img src="../Images/a325262a88e0f90f8e6591e7060ae3ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UXwWIsDyUuxfaQTD9-ivqA.jpeg"/></div></div></figure><p id="361f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以找到包Id。如果你点击XCode上的项目文件，弹出的屏幕会显示捆绑包Id。你可以在下图中学习如何找到它。</p><figure class="la lb lc ld gt jo gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/4d589e8480872515730e0d46f0e12a71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*Fc9FcEURAkB7_5eD5UlsrQ.jpeg"/></div></figure><p id="2f8c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">成功添加捆绑包Id后，只需在同一屏幕上单击下一步。</p><p id="1cd1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">第三步</strong>:现在你已经准备好下载Firebase将为你创建的<strong class="jx io"> google.json </strong>文件了。下载后，只需将文件放在项目的根目录下。</p><figure class="la lb lc ld gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lz"><img src="../Images/97e2fec5aa0809b8512c825897c24d4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eSIuU2qjixZRjgM1mz46vA.jpeg"/></div></div></figure><figure class="la lb lc ld gt jo gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/0d259b430320d9dc2d2e3b95019fcfbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*QKB2b3Lgi15dtfgHSn6xfg.jpeg"/></div></figure><figure class="la lb lc ld gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mb"><img src="../Images/f44c8b3efe091ac6aba0cd984560b74e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tAvl44ipeqM7ROGcR83dxQ.jpeg"/></div></div></figure><p id="251b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我们正确地添加了google.json文件之后，只需返回Firebase控制台并完成注册即可。</p><figure class="la lb lc ld gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mc"><img src="../Images/e50ec190c067bb26cd1f0b361d526ceb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QdKZVevvjFbiCUJeaGKkdg.jpeg"/></div></div></figure><p id="ff57" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们差不多完成了，只剩下一步了。因此，让我们在AppDelegate.m文件中添加几行代码。要允许Firebase on iOS使用凭据，必须在应用程序的引导阶段配置Firebase iOS SDK。</p><p id="efb4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为此，打开您的<code class="fe md me mf lf b">/ios/{projectName}/AppDelegate.m</code>文件，并添加以下内容:</p><p id="6bc3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在文件的顶部，导入Firebase SDK:</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="4839" class="lj lk in lf b gy ll lm l ln lo">#import &lt;Firebase.h&gt;</span></pre><p id="3490" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在您现有的<code class="fe md me mf lf b">didFinishLaunchingWithOptions</code>方法中，将以下内容添加到该方法的顶部:</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="9f37" class="lj lk in lf b gy ll lm l ln lo">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {<br/> <em class="lq">//Add only the code below here</em><br/>  <strong class="lf io">[FIRApp configure];</strong><br/> // ...<br/>}</span></pre><p id="8a00" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为此，我们需要自动链接并重新构建我们的项目，只需在您的终端中运行命令，您就可以使用Firebase推送通知了。</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="5515" class="lj lk in lf b gy ll lm l ln lo">cd ios/<br/>pod install --repo-update<br/>cd ..<br/>npx react-native run-ios</span></pre><figure class="la lb lc ld gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mg"><img src="../Images/a375b1c735e03862965d6bee9478f879.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QV5QBsn5gA47SVymTNrQ2g.jpeg"/></div></div></figure><p id="a2fd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你有一个模拟器，它显示上述内容，这意味着你做的一切都是正确的。恭喜你！你做到了。:)</p></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><p id="115f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">希望这对你有帮助。如果是这样的话，给我一个follow之类的。:)</p><p id="e923" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我的LinkedIn:<a class="ae mh" href="https://www.linkedin.com/in/akin-karayun-ab3239bb/" rel="noopener ugc nofollow" target="_blank">AKIN Kara yun | LinkedIn</a></p><p id="104b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae mh" href="https://devakinkarayun.web.app/" rel="noopener ugc nofollow" target="_blank">阿金·卡拉云</a></p><p id="648e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="lq">更多内容请看</em><a class="ae mh" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="lq">plain English . io</em></strong></a><em class="lq">。报名参加我们的</em> <a class="ae mh" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="lq">免费周报</em> </strong> </a> <em class="lq">。关注我们关于</em><a class="ae mh" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="lq">Twitter</em></strong></a><a class="ae mh" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="lq">LinkedIn</em></strong></a><em class="lq"/><a class="ae mh" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="lq">YouTube</em></strong></a><em class="lq"/><a class="ae mh" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="lq">不和</em> </strong> </a> <em class="lq">。</em></p></div></div>    
</body>
</html>