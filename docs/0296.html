<html>
<head>
<title>Build a Server-side App with TypeScript, NestJS and MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用TypeScript，NestJS和MongoDB构建一个服务器端的App</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-a-server-side-app-with-typescript-nestjs-and-mongodb-d29d26ac1ab3?source=collection_archive---------3-----------------------#2022-01-18">https://javascript.plainenglish.io/build-a-server-side-app-with-typescript-nestjs-and-mongodb-d29d26ac1ab3?source=collection_archive---------3-----------------------#2022-01-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="390d" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">简单快速地构建高效的应用程序。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/086a1c2459ee461379a99a4252618da4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q1BmaUDsJepBdcMxRx6iRw.png"/></div></div></figure><h1 id="07ef" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">介绍</h1><p id="db44" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">使用NestJS框架构建的Node.js服务器端应用程序可能比其他一些应用程序更高效、耦合性更低。背后的一个原因是NestJS对如何开发应用程序有强烈的看法。换句话说，它是一个<a class="ae mc" href="https://stackoverflow.com/a/802064/7950893" rel="noopener ugc nofollow" target="_blank">固执己见的框架</a>。</p><h2 id="146f" class="md kp in bd kq me mf dn ku mg mh dp ky lp mi mj la lt mk ml lc lx mm mn le mo bi translated">这篇文章献给谁？</h2><p id="f920" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">因为我们将要讨论一些概念，比如ODM或依赖注入，所以我建议您在深入研究之前先熟悉这些概念。<br/>如果你不是，但仍然想构建一个基本的服务器端应用程序，你可以阅读我的另一篇关于如何使用TypeScript和Express构建应用程序的文章。</p><div class="mp mq gp gr mr ms"><a rel="noopener  ugc nofollow" target="_blank" href="/typescript-node-js-express-js-create-a-backend-application-f5110dbe5c19"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd io gy z fp mx fr fs my fu fw im bi translated">使用TypeScript、Node.js和Express构建后端应用程序</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">从头开始创建您的后端应用程序</h3></div></div><div class="na l"><div class="nb l nc nd ne na nf km ms"/></div></div></a></div><h2 id="179e" class="md kp in bd kq me mf dn ku mg mh dp ky lp mi mj la lt mk ml lc lx mm mn le mo bi translated">要求</h2><p id="47a3" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">你首先需要在你的电脑上安装<a class="ae mc" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>。</p><ul class=""><li id="bb95" class="ng nh in li b lj ni lm nj lp nk lt nl lx nm mb nn no np nq bi translated">你最喜欢的IDE</li><li id="c548" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb nn no np nq bi translated">安装<a class="ae mc" href="https://www.typescriptlang.org/download" rel="noopener ugc nofollow" target="_blank">类型脚本</a></li><li id="e979" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb nn no np nq bi translated">安装<a class="ae mc" href="https://docs.mongodb.com/manual/installation/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>或使用<a class="ae mc" href="https://www.mongodb.com/atlas/database" rel="noopener ugc nofollow" target="_blank"> MongoDB图集</a></li><li id="1a6f" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb nn no np nq bi translated">用这个<code class="fe nw nx ny nz b">npm</code>命令安装Nest CLI:</li></ul><pre class="kd ke kf kg gt oa nz ob oc aw od bi"><span id="0d5b" class="md kp in nz b gy oe of l og oh"><strong class="nz io">npm</strong> <strong class="nz io">install</strong> -g @nestjs/cli</span></pre><p id="dd53" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">您可以直接在专用的<a class="ae mc" href="https://github.com/fairyfingers/ts-nestjs-mongodb-sample" rel="noopener ugc nofollow" target="_blank">库</a>中查看代码。<br/>本教程的每一步都匹配一个特定的提交。</p><h2 id="5b24" class="md kp in bd kq me mf dn ku mg mh dp ky lp mi mj la lt mk ml lc lx mm mn le mo bi translated">摘要</h2><ol class=""><li id="4345" class="ng nh in li b lj lk lm ln lp ol lt om lx on mb oo no np nq bi translated"><strong class="li io">设置项目</strong> |快速初始化和npm包安装</li><li id="a852" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb oo no np nq bi translated"><strong class="li io">设置环境</strong> |环境变量和配置服务</li><li id="6c61" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb oo no np nq bi translated">集成mongose|在你的项目中使用ODM工具</li><li id="7030" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb oo no np nq bi translated"><strong class="li io">功能演示</strong></li></ol></div><div class="ab cl op oq hr or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="ig ih ii ij ik"><h1 id="9982" class="ko kp in bd kq kr ow kt ku kv ox kx ky jt oy ju la jw oz jx lc jz pa ka le lf bi translated">设置项目</h1><h2 id="0215" class="md kp in bd kq me mf dn ku mg mh dp ky lp mi mj la lt mk ml lc lx mm mn le mo bi translated">快速初始化</h2><p id="d4f1" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">您需要做的第一件事是初始化您的NestJS项目。为此，请使用以下Nest CLI命令:</p><pre class="kd ke kf kg gt oa nz ob oc aw od bi"><span id="5e4a" class="md kp in nz b gy oe of l og oh"><strong class="nz io">nest new</strong> ts-nestjs-mongodb-sample</span></pre><p id="1c22" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">Nest CLI将提示您选择一个<a class="ae mc" href="https://github.com/pnpm/benchmarks-of-javascript-package-managers#readme" rel="noopener ugc nofollow" target="_blank">包管理器</a>。选择一个你想用的，但要知道我们这里要用<code class="fe nw nx ny nz b">npm</code>。</p><h2 id="768d" class="md kp in bd kq me mf dn ku mg mh dp ky lp mi mj la lt mk ml lc lx mm mn le mo bi translated">软件包概述</h2><p id="449f" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">安装完成后，快速浏览一下您要添加到项目中的三个依赖项:</p><pre class="kd ke kf kg gt oa nz ob oc aw od bi"><span id="3933" class="md kp in nz b gy oe of l og oh">📦 <a class="ae mc" href="https://www.npmjs.com/package/@nestjs/config" rel="noopener ugc nofollow" target="_blank"><strong class="nz io">@nestjs/config</strong></a><br/>📦 <a class="ae mc" href="https://www.npmjs.com/package/mongoose" rel="noopener ugc nofollow" target="_blank"><strong class="nz io">mongoose</strong></a><br/>📦 <a class="ae mc" href="https://www.npmjs.com/package/@nestjs/mongoose" rel="noopener ugc nofollow" target="_blank"><strong class="nz io">@nestjs/mongoose</strong></a></span></pre><ul class=""><li id="addd" class="ng nh in li b lj ni lm nj lp nk lt nl lx nm mb nn no np nq bi translated"><code class="fe nw nx ny nz b">@nestjs/config</code>是一个NestJS包，它允许您使用环境变量来配置应用程序，就像Node.js应用程序中经常做的那样</li><li id="5928" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb nn no np nq bi translated"><code class="fe nw nx ny nz b">mongoose</code>是一个MongoDB <strong class="li io">对象文档映射</strong>工具(ODM ),用于在您的应用程序中对MongoDB数据库执行操作</li><li id="8e57" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb nn no np nq bi translated"><code class="fe nw nx ny nz b">@nestjs/mongoose</code>是一个围绕<code class="fe nw nx ny nz b">mongoose</code>包的简单包装器，用于NestJS应用程序的上下文。它包括你需要的每一个类型声明</li></ul><p id="4025" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">使用您选择的软件包管理器安装这三个软件包:</p><pre class="kd ke kf kg gt oa nz ob oc aw od bi"><span id="4e14" class="md kp in nz b gy oe of l og oh"><strong class="nz io">npm install @</strong>nestjs/config mongoose @nestjs/mongoose</span></pre></div><div class="ab cl op oq hr or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="ig ih ii ij ik"><h1 id="5329" class="ko kp in bd kq kr ow kt ku kv ox kx ky jt oy ju la jw oz jx lc jz pa ka le lf bi translated">设置环境</h1><h2 id="4062" class="md kp in bd kq me mf dn ku mg mh dp ky lp mi mj la lt mk ml lc lx mm mn le mo bi translated">环境变量</h2><p id="c700" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">将数据库与应用程序连接起来会要求您编写一些配置。例如，您可能想将数据库的<a class="ae mc" href="https://docs.mongodb.com/manual/reference/connection-string/" rel="noopener ugc nofollow" target="_blank">连接字符串</a>放在代码中的某个地方，这样您的应用程序就知道从哪里获取它，但仍然不会将其暴露给整个世界。</p><p id="1b45" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">你可能已经知道了，但是有一个地方可以存放它，它叫做<code class="fe nw nx ny nz b">.env</code>文件。在那里，你可以放置所有的<a class="ae mc" href="https://en.wikipedia.org/wiki/Environment_variable" rel="noopener ugc nofollow" target="_blank">环境变量</a>，并让你的应用程序在任何时候使用它们。</p><p id="6011" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">在项目的根目录下创建包含以下内容的<code class="fe nw nx ny nz b">.env</code>文件:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="bcc4" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">现在，记得我告诉过你不要把敏感数据暴露给全世界。如果你来提交这个<code class="fe nw nx ny nz b">.env</code>文件，那么你会做你<em class="pd">不想做的事情，也就是暴露你的连接字符串。</em></p><p id="c42d" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">因此，如果您目前正在一个存储库中工作，请将<code class="fe nw nx ny nz b">.env</code>文件添加到项目的<code class="fe nw nx ny nz b">.gitignore</code>中，这样您就不会将它推送到您的遥控器上:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="6593" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">如果您仍然想留下项目运行所需的环境变量的线索，您仍然可以在另一个文件中提交您的<code class="fe nw nx ny nz b">.env</code>文件的结构，但是永远不要<strong class="li io">提交敏感数据。</strong></p><h2 id="82e5" class="md kp in bd kq me mf dn ku mg mh dp ky lp mi mj la lt mk ml lc lx mm mn le mo bi translated">应用程序配置</h2><p id="a9d4" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated"><code class="fe nw nx ny nz b">@nestjs/config</code>包允许您从您创建的<code class="fe nw nx ny nz b">.env</code>文件中检索任何数据。你唯一需要做的就是“封装”这个包，告诉它你想要什么。</p><p id="3c93" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">为此，在<code class="fe nw nx ny nz b">src</code>文件夹中创建以下文件夹结构:</p><pre class="kd ke kf kg gt oa nz ob oc aw od bi"><span id="02d9" class="md kp in nz b gy oe of l og oh">📂src<br/>└- <!-- -->📂<!-- -->infrastructure<br/>    └- <!-- -->📂<!-- -->configuration<br/>         └- 🗒️<strong class="nz io">app-configuration.service.ts</strong></span></pre><p id="0f03" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">现在，请阅读下面的代码，并确保您理解所有代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="pb pc l"/></div></figure><ol class=""><li id="54f5" class="ng nh in li b lj ni lm nj lp nk lt nl lx nm mb oo no np nq bi translated">在这里，我们创建了自己的(可注入的)配置服务</li><li id="0b6b" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb oo no np nq bi translated">我们从<code class="fe nw nx ny nz b">@nestjs/config</code>中注入我们的类<code class="fe nw nx ny nz b">ConfigService</code></li><li id="f4c2" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb oo no np nq bi translated">我们用它从我们的<code class="fe nw nx ny nz b">.env</code>文件中检索<code class="fe nw nx ny nz b">MONGODB_DB_URI</code></li></ol><p id="dcbb" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">除了你的<code class="fe nw nx ny nz b">app-configuration.service.ts</code>文件，创建另一个文件:</p><pre class="kd ke kf kg gt oa nz ob oc aw od bi"><span id="4e86" class="md kp in nz b gy oe of l og oh">📂src<br/>└- <!-- -->📂<!-- -->infrastructure<br/>    └- <!-- -->📂<!-- -->configuration<br/>         └- 🗒️<strong class="nz io">app-configuration.module.ts</strong><br/>         └- 🗒️app-configuration.service.ts</span></pre><p id="dee0" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">同样，阅读并尝试理解下面的代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="be07" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">它基本上是一个<a class="ae mc" href="https://docs.nestjs.com/modules" rel="noopener ugc nofollow" target="_blank">模块</a>级。这就是NestJS用来组织应用程序结构的东西。</p><ul class=""><li id="bab0" class="ng nh in li b lj ni lm nj lp nk lt nl lx nm mb nn no np nq bi translated"><code class="fe nw nx ny nz b">exports</code>是您想要向任何导入这个模块的模块公开的<code class="fe nw nx ny nz b">providers</code></li><li id="cae3" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb nn no np nq bi translated"><code class="fe nw nx ny nz b">imports</code>自然是导入模块的列表，它导出您在这个模块中需要的提供者(在这种情况下是<code class="fe nw nx ny nz b">ConfigService</code>)</li><li id="9ba5" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb nn no np nq bi translated"><code class="fe nw nx ny nz b">providers</code>在本模块中共享，由嵌套注入器注入</li></ul><p id="2bcb" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">总而言之:我们导入了<code class="fe nw nx ny nz b">ConfigModule</code>，它导出了检索环境变量所需的<code class="fe nw nx ny nz b">ConfigService</code>。我们也出口我们唯一的供应商，但是为了什么？为了使其对<code class="fe nw nx ny nz b">AppModule</code>可用:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="f3db" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">这样，当启动您的应用程序时，它将知道您的连接字符串及其当前值。</p><h2 id="e427" class="md kp in bd kq me mf dn ku mg mh dp ky lp mi mj la lt mk ml lc lx mm mn le mo bi translated">数据库配置</h2><p id="b3f0" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">您已经得到了NestJS应用程序和连接字符串。将应用程序与数据库连接之前的最后一次推动。</p><p id="9b48" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">进入您的<code class="fe nw nx ny nz b">app.module.ts</code>并粘贴以下代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="7d18" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">我们导入<code class="fe nw nx ny nz b">MongooseModule</code>的方式看起来和其他的不太一样。背后的原因是因为它是一个<a class="ae mc" href="https://docs.nestjs.com/fundamentals/dynamic-modules#dynamic-module-use-case" rel="noopener ugc nofollow" target="_blank">动态模块</a>。</p><ul class=""><li id="2e70" class="ng nh in li b lj ni lm nj lp nk lt nl lx nm mb nn no np nq bi translated">给定一个连接字符串，<code class="fe nw nx ny nz b">MongooseModule</code>允许你的应用程序连接到你的数据库</li><li id="60af" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb nn no np nq bi translated">要给这个模块你的数据库的连接字符串，你必须从你的<code class="fe nw nx ny nz b">.env</code>文件中获取它，唯一的方法是使用你的<code class="fe nw nx ny nz b">AppConfigurationService</code></li><li id="e794" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb nn no np nq bi translated">因此，您需要将它注入到<code class="fe nw nx ny nz b">MongooseModule</code>中，这样您就可以配置<code class="fe nw nx ny nz b">MongooseModuleOptions</code>来使用正确的连接字符串</li></ul><p id="b8ee" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">恭喜你！🎉您的应用程序和数据库已连接。</p></div><div class="ab cl op oq hr or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="ig ih ii ij ik"><h1 id="8b01" class="ko kp in bd kq kr ow kt ku kv ox kx ky jt oy ju la jw oz jx lc jz pa ka le lf bi translated">整合猫鼬</h1><h2 id="b8a9" class="md kp in bd kq me mf dn ku mg mh dp ky lp mi mj la lt mk ml lc lx mm mn le mo bi translated">创建您的第一个模式</h2><p id="8a5c" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">现在你的应用程序和你的数据库连接上了，你终于可以使用mongoose并享受一点乐趣了(不要太多，乐趣是不好的，我讨厌乐趣)。</p><p id="3fc2" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">在您的<code class="fe nw nx ny nz b">src</code>文件夹中创建以下文件夹结构:</p><pre class="kd ke kf kg gt oa nz ob oc aw od bi"><span id="925c" class="md kp in nz b gy oe of l og oh">📂src<br/>└- <!-- -->📂<!-- -->user<br/>   └-🗒️<strong class="nz io">user.ts</strong></span></pre><p id="be2d" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated"><code class="fe nw nx ny nz b">user.ts</code>文件将包含我们用户的<a class="ae mc" href="https://mongoosejs.com/docs/guide.html#schemas" rel="noopener ugc nofollow" target="_blank">模式</a>。将以下代码粘贴到您的文件中:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="d5b9" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">这些装饰者和未知方法是什么？让我告诉你。</p><ul class=""><li id="cdde" class="ng nh in li b lj ni lm nj lp nk lt nl lx nm mb nn no np nq bi translated"><code class="fe nw nx ny nz b">UserDocument</code>类使用来自<code class="fe nw nx ny nz b">@nestjs/mongoose</code>包的<code class="fe nw nx ny nz b">@Schema()</code>装饰器。这个装饰器将我们的类标记为模式定义，并将其映射到同名的MongoDB集合</li><li id="1265" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb nn no np nq bi translated"><code class="fe nw nx ny nz b">@Prop()</code>decorator在我们的用户文档中定义属性。我们集合中这些属性的模式类型是由TypeScript元数据自动推断出来的</li><li id="8962" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb nn no np nq bi translated"><code class="fe nw nx ny nz b">userSchema</code>是使用<code class="fe nw nx ny nz b">SchemaFactory </code>从<code class="fe nw nx ny nz b">UserDocument</code>构建的，本质上是一个用于构建mongoose模式的类</li><li id="11aa" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb nn no np nq bi translated"><code class="fe nw nx ny nz b">User</code>交集类型结合了<code class="fe nw nx ny nz b">UserDocument</code>和mongose<code class="fe nw nx ny nz b">Document</code>类型来获得它需要的所有特性</li></ul><p id="9cde" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">欲了解更多详情，请阅读关于<a class="ae mc" href="https://docs.nestjs.com/techniques/mongodb#model-injection" rel="noopener ugc nofollow" target="_blank">模型注射</a>的NestJS文件。</p><h2 id="dda0" class="md kp in bd kq me mf dn ku mg mh dp ky lp mi mj la lt mk ml lc lx mm mn le mo bi translated">准备你的模块</h2><p id="7c88" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">在您的代码中，您的应用程序需要知道应该注册哪些mongoose模型。为此，您需要创建一个模块来注册您的<code class="fe nw nx ny nz b">userSchema</code>，因此除了您的<code class="fe nw nx ny nz b">user.ts</code>文件之外，还要创建另一个文件:</p><pre class="kd ke kf kg gt oa nz ob oc aw od bi"><span id="96ac" class="md kp in nz b gy oe of l og oh">📂src<br/>└- <!-- -->📂<!-- -->user<br/>   └-🗒️<strong class="nz io">user.module.ts</strong><br/>   └-🗒️user.ts</span></pre><p id="fc16" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">该模块将在以后的章节中更新，但现在，只需粘贴您需要的以下代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="e880" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">正如你所看到的，我们只是在这里的<code class="fe nw nx ny nz b">MongooseModule</code>中注册了我们的<code class="fe nw nx ny nz b">userSchema</code>，所以这个应用知道mongoose有一个用户特性。</p><h2 id="bd03" class="md kp in bd kq me mf dn ku mg mh dp ky lp mi mj la lt mk ml lc lx mm mn le mo bi translated">添加存储库</h2><p id="7a9f" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">有了用户模式，现在可以做的是添加第一个存储库。</p><p id="dde9" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">在用户文件旁边创建另一个文件:</p><pre class="kd ke kf kg gt oa nz ob oc aw od bi"><span id="8c1e" class="md kp in nz b gy oe of l og oh">📂src<br/>└- <!-- -->📂<!-- -->user<br/>   └-🗒️<strong class="nz io">user.repository.ts</strong><br/>   └-🗒️user.module.ts<br/>   └-🗒️user.ts</span></pre><p id="1b7f" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated"><code class="fe nw nx ny nz b">user.repository.ts</code>文件将包含使用mongoose与数据库交互的代码。将以下代码粘贴到您的文件中:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="4092" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">这个文件本身并不复杂。有几件事你应该看看，面团:</p><ul class=""><li id="3493" class="ng nh in li b lj ni lm nj lp nk lt nl lx nm mb nn no np nq bi translated">我们把我们的<code class="fe nw nx ny nz b">UserRepository</code>做成可注射的，这样它就可以在我们<code class="fe nw nx ny nz b">UserModule</code>的任何一个类中被注射到我们想要的任何地方</li><li id="befd" class="ng nh in li b lj nr lm ns lp nt lt nu lx nv mb nn no np nq bi translated">我们将用户mongoose模型注入到类构造函数中，这样我们就可以直接从存储库中与MongoDB集合进行交互</li></ul><p id="bb9d" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">因为我们希望这个类被注入到我们模块中的任何地方，所以我们需要将它添加到<code class="fe nw nx ny nz b">UserModule</code>提供者:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="pb pc l"/></div></figure></div><div class="ab cl op oq hr or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="ig ih ii ij ik"><h1 id="5983" class="ko kp in bd kq kr ow kt ku kv ox kx ky jt oy ju la jw oz jx lc jz pa ka le lf bi translated">功能演示</h1><h2 id="1501" class="md kp in bd kq me mf dn ku mg mh dp ky lp mi mj la lt mk ml lc lx mm mn le mo bi translated">添加您的控制器</h2><p id="43d3" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">你最终会看到你到目前为止做了多少工作。为此，创建除用户文件之外的最后一个文件:</p><pre class="kd ke kf kg gt oa nz ob oc aw od bi"><span id="3fbe" class="md kp in nz b gy oe of l og oh">📂src<br/>└- <!-- -->📂<!-- -->user<br/>   └-🗒️<strong class="nz io">user.controller.ts</strong><br/>   └-🗒️user.repository.ts<br/>   └-🗒️user.module.ts<br/>   └-🗒️user.ts</span></pre><p id="3736" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated"><code class="fe nw nx ny nz b">user.controller.ts</code>文件将包含所有的HTTP路由和逻辑。将以下代码粘贴到您的文件中:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="274f" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">正如你所看到的，我们正在控制器内部注入我们的<code class="fe nw nx ny nz b">UserRepository</code>。这允许我们在类中的任何地方使用它。</p><p id="307c" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">您可以看到的各种装饰器都记录在NestJS控制器<a class="ae mc" href="https://docs.nestjs.com/controllers" rel="noopener ugc nofollow" target="_blank">文档</a>中。我在这里没有详细说明，因为我发现它们的用法很容易理解。你不觉得吗？</p><p id="00e7" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">不要忘记在您的<code class="fe nw nx ny nz b">UserModule</code>中添加<code class="fe nw nx ny nz b">UserController</code>:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="pb pc l"/></div></figure><h2 id="eee5" class="md kp in bd kq me mf dn ku mg mh dp ky lp mi mj la lt mk ml lc lx mm mn le mo bi translated">完成你的应用模块</h2><p id="9348" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">一切都准备好了。你所要做的就是把你的<code class="fe nw nx ny nz b">UserModule</code>导入到你的<code class="fe nw nx ny nz b">AppModule</code>里面，然后用<code class="fe nw nx ny nz b">RouterModule</code>注册一条特定的路线，这样你就可以到达你的<code class="fe nw nx ny nz b">UserController</code>。</p><p id="8a38" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">我们开始吧。进入您的<code class="fe nw nx ny nz b">AppModule</code>并粘贴以下代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="9ae2" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated">然后用<code class="fe nw nx ny nz b">nest start</code>启动你的app，用<a class="ae mc" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">邮递员</a>或者<a class="ae mc" href="https://insomnia.rest/" rel="noopener ugc nofollow" target="_blank">失眠</a>甚至<a class="ae mc" href="https://curl.se/" rel="noopener ugc nofollow" target="_blank">卷毛</a>打用户路线。不要忘记使用<code class="fe nw nx ny nz b">POST</code>方法。你的应用程序应该给你一个很好的工作响应。</p></div><div class="ab cl op oq hr or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="ig ih ii ij ik"><p id="43f4" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated"><strong class="li io">搞定！🥳这是你用TypeScript、NestJS和MongoDB构建的服务器端应用程序。如果你有任何问题，请随时提问。</strong></p><p id="3811" class="pw-post-body-paragraph lg lh in li b lj ni jo ll lm nj jr lo lp oi lr ls lt oj lv lw lx ok lz ma mb ig bi translated"><em class="pd">更多内容请看</em><a class="ae mc" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="li io"><em class="pd">plain English . io</em></strong></a><em class="pd">。报名参加我们的</em> <a class="ae mc" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="li io"> <em class="pd">免费周报</em> </strong> </a> <em class="pd">。在我们的</em> <a class="ae mc" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="li io"> <em class="pd">社区</em> </strong> </a> <em class="pd">获得独家获得写作机会和建议。</em></p></div></div>    
</body>
</html>