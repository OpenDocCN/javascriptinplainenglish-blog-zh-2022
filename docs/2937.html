<html>
<head>
<title>Reduce Layout Shifts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">减少布局偏移</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/reduce-layout-shifts-5355c74eea1f?source=collection_archive---------12-----------------------#2022-07-15">https://javascript.plainenglish.io/reduce-layout-shifts-5355c74eea1f?source=collection_archive---------12-----------------------#2022-07-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e35d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如何减少你网站的布局偏移？</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/ab36020ea2fd921f8fc2d6e9ddf2f0f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*odvo35IHkBCbVjYj"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Photo by <a class="ae lc" href="https://unsplash.com/@lindsayhenwood?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Lindsay Henwood</a> on <a class="ae lc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f079" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">布局变化令人讨厌，并导致糟糕的用户体验。如果你不知道什么是布局偏移，看看这个gif，把注意力放在页眉部分。一旦它被加载，它将“推倒”其他所有东西。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ld"><img src="../Images/33b4fbe69e6689d9239f78d85ff56f1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*E6iCIpP1mls-cUBjshSa2Q.gif"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Layout Shift on <a class="ae lc" href="https://www.uni-rostock.de/" rel="noopener ugc nofollow" target="_blank">https://www.uni-rostock.de/</a></figcaption></figure><h2 id="ad27" class="le lf iq bd lg lh li dn lj lk ll dp lm jy ln lo lp kc lq lr ls kg lt lu lv lw bi translated">什么导致了布局的改变？</h2><p id="7baf" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">布局变化有一些突出的原因。当你再次看gif时，这就是所谓的动态内容(一个滑块)。文本和背景图像一加载，内容就会弹出，导致布局变化。布局变化的主要原因是</p><ul class=""><li id="3335" class="mc md iq jp b jq jr ju jv jy me kc mf kg mg kk mh mi mj mk bi translated">动态内容</li><li id="843c" class="mc md iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">图像、iFrames、广告等等</li><li id="52f2" class="mc md iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">字体</li><li id="399f" class="mc md iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">动画片</li></ul><p id="97b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">布局偏移并不总是不好的；有时，它们甚至是有意的。它们有助于表明事情已经发生了变化。然而，你应该避免不可思议地改变布局，尤其是在折叠上方。根据经验:预期的布局变化来自用户交互。</p><h2 id="205e" class="le lf iq bd lg lh li dn lj lk ll dp lm jy ln lo lp kc lq lr ls kg lt lu lv lw bi translated">如何避免动态内容的布局偏移？</h2><p id="ef2f" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">拥有动态内容意味着您最有可能等待一个获取发生。有几种方法可以解决这个问题。一种可能是使用服务器端呈现，这样就可以在将JavaScript提交给浏览器之前进行提取。解决这个问题的另一个流行方法是使用框架组件。看一看<a class="ae lc" href="https://fcbayern.com/" rel="noopener ugc nofollow" target="_blank">https://fcbayern.com/</a></p><p id="7a31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">他们正在使用占位符。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mq"><img src="../Images/b46bdcc3ab6449e1b003a27f3ad24e05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cC8tsuStkvRRaj9EP3gFgQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Placeholder at fcbayern.com</figcaption></figure><p id="239d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">直到实际内容到达，并且他们用实际内容替换框架</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mr"><img src="../Images/29eaf3bb313a8a1c49f3f40165638333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ja-9xXfl1SJ_05abwA83g.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">The actual content of fcbayern.com</figcaption></figure><p id="65b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">想法是提供一个与实际内容尺寸相同的占位符。即使它们不是相同的尺寸，这至少会减少偏移，并且不会导致硬切割。</p><p id="1595" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有时，您甚至不需要依赖外部获取就能实现转变。请注意，您正在向用户发送大量的JavaScript，尤其是在单页面应用程序(SPA)中。这也很吸引人；它是否会导致布局变化取决于您选择的架构和文件的大小。例如，如果您的模块捆绑器将base64图像字符串添加到JavaScript文件中，您可能就完蛋了。</p><h2 id="9e8f" class="le lf iq bd lg lh li dn lj lk ll dp lm jy ln lo lp kc lq lr ls kg lt lu lv lw bi translated">如何处理图像引起的布局偏移？</h2><p id="641a" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">图像是所谓的“替换元素”(像iframes、视频、对象等等)。不幸的是，浏览器很难为替换的元素保留合适的空间，因为它们的内容在呈现之前是未知的。</p><p id="5e83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">幸运的是，处理图像标签很容易。只需向元素添加宽度和高度属性。浏览器知道图像的可用宽度，并通过长宽比计算出正确的高度。</p><p id="6290" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以对背景图像使用相同的技术。CSS支持<code class="fe ms mt mu mv b">aspect-ratio</code>属性。将它与对象适合度和宽度相结合是一个好主意，因此不管设备的实际尺寸如何，图像仍然使用整个空间</p><pre class="kn ko kp kq gt mw mv mx my aw mz bi"><span id="1b90" class="le lf iq mv b gy na nb l nc nd">.my-img {<br/>  aspect-ratio: 16 / 9;<br/>  width: 100%;<br/>  object-fit: cover;<br/>}</span></pre><h2 id="492a" class="le lf iq bd lg lh li dn lj lk ll dp lm jy ln lo lp kc lq lr ls kg lt lu lv lw bi translated">如何处理字体引起的布局偏移？</h2><p id="3441" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">字体…很难。它们往往很大，会导致各种各样的UI问题。两个突出的问题是FOUT(非样式文本的闪现)和FOIT(不可见文本的闪现)。这两种情况都会导致你的布局发生变化。</p><p id="e8f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用自定web字体时，您应该采取两个操作:</p><ol class=""><li id="d733" class="mc md iq jp b jq jr ju jv jy me kc mf kg mg kk ne mi mj mk bi translated">为字体设置一个<code class="fe ms mt mu mv b">&lt;link rel="preload" ...&gt;</code>。这将增加字体更早加载的机会。</li><li id="36e8" class="mc md iq jp b jq ml ju mm jy mn kc mo kg mp kk ne mi mj mk bi translated">添加<code class="fe ms mt mu mv b">font-display: optional;</code></li></ol><p id="2ea6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">预加载可选字体将导致渲染受阻(大约100毫秒，因此您仍然应该注意字体足够小，可以在此阈值内下载)。但是，如果在阈值期间没有加载，网站将加载回退字体。因此，无论如何不会导致任何无样式或不可见字体的闪烁。</p><h2 id="53cb" class="le lf iq bd lg lh li dn lj lk ll dp lm jy ln lo lp kc lq lr ls kg lt lu lv lw bi translated">如何处理动画引起的布局偏移？</h2><p id="0db7" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">有些动画是使用像<code class="fe ms mt mu mv b">top</code>、<code class="fe ms mt mu mv b">margin</code>或<code class="fe ms mt mu mv b">background-color</code>这样的属性构建的。请注意，更改这些属性的成本很高，甚至会导致重新计算布局。然而，除了变换和不透明度<strong class="jp ir">之外的任何属性都将</strong>触发重画。</p><p id="71cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，应该通过变换来改变位置。如果你必须触发重绘，你可以通过提升<em class="kl">需要</em>改变的部分来最小化重绘的元素数量。这个提升可以用<code class="fe ms mt mu mv b">transform: translateZ(0);</code>或者<code class="fe ms mt mu mv b">will-change: transform;</code>来完成。这将使你的元素呈现在一个新的复合层上，从而导致更高性能的重画。但是，请谨慎使用这种技术，因为层也会消耗计算能力。</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><p id="710d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就这些了，伙计们！这些技术将帮助您减少项目中的布局变化！你在你的项目中遇到过这些问题吗？你是怎么解决的？</p><p id="a7cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读！如果你想要更多这样的文章，一定要留下掌声、评论或关注，让我知道！</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><p id="e1e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">更多内容请看</em><a class="ae lc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="kl">plain English . io</em></strong></a><em class="kl">。报名参加我们的</em> <a class="ae lc" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="kl">免费周报</em> </strong> </a> <em class="kl">。关注我们关于</em><a class="ae lc" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="kl">Twitter</em></strong></a><em class="kl">和</em><a class="ae lc" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="kl">LinkedIn</em></strong></a><em class="kl">。查看我们的</em> <a class="ae lc" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="kl">社区不和谐</em> </strong> </a> <em class="kl">加入我们的</em> <a class="ae lc" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="kl">人才集体</em> </strong> </a> <em class="kl">。</em></p></div></div>    
</body>
</html>