<html>
<head>
<title>JWT Token Authentication using the .NET Core 6 Web API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用JWT令牌进行身份验证。NET Core 6 Web API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/jwt-token-authentication-using-the-net-core-6-web-api-24e585ecc24a?source=collection_archive---------0-----------------------#2022-06-26">https://javascript.plainenglish.io/jwt-token-authentication-using-the-net-core-6-web-api-24e585ecc24a?source=collection_archive---------0-----------------------#2022-06-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/9df961ea5a423bf347cb39b7e549b965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*ThCDgtTVekekvPLv.jpg"/></div></figure><p id="1c3f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我们将讨论JWT令牌认证和实现。NET Core API 6</p><p id="3577" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在阅读这篇博客之前，请访问我的以下博客，了解JWT令牌身份验证和授权的基础和细节，以及使用JWT的工作原理。</p><p id="11c9" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae kp" href="https://medium.com/p/5a812e6d154c" rel="noopener">关于JWT令牌认证和授权的介绍和细节</a></p><p id="ad2f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">让我们开始实现。NET Core 6 Web API，</p><p id="a527" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">第一步:</strong></p><p id="0c02" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">创建。NET Core 6 Web API应用程序</p><p id="96c0" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">第二步:</strong></p><p id="c1fa" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">安装下面的NuGet包，我们将在整个应用程序中使用它们。</p><p id="bd4d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">微软。AspNetCore . authentic ation . jwtbearer</strong></p><p id="ee16" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">微软。EntityFrameworkCore </strong></p><p id="9f61" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">微软。实体框架工作核心设计</strong></p><p id="5ae8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">微软。EntityFrameworkCore . SQL server</strong></p><p id="036c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">微软。实体框架工作核心工具</strong></p><p id="9c80" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">牛顿软件。Json </strong></p><p id="3b7b" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io"> StackExchange。Redis </strong></p><p id="3111" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io"> Swashbuckle。AspNetCore </strong></p><p id="77e0" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">第三步:</strong></p><p id="52fc" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">接下来，在解决方案中创建新的文件夹模型，并在其中创建一个产品类。</p><figure class="kq kr ks kt gt jo"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="1ff2" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">第四步:</strong></p><p id="92e7" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在用于数据库操作的数据文件夹中创建一个DbContextClass。</p><figure class="kq kr ks kt gt jo"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="a795" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">第五步:</strong></p><p id="bf73" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">稍后，在Controllers文件夹中创建ProductController。</p><figure class="kq kr ks kt gt jo"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="91bb" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">第六步:</strong></p><p id="9508" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在，我们将在这个应用程序中使用Redis缓存。如果你明白分布式Redis缓存是如何工作的，请查看我的博客</p><p id="9f32" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae kp" href="https://medium.com/p/c8276167ef0c" rel="noopener">Redis缓存在。NET Core Web API </a></p><p id="6c65" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">第七步:</strong></p><p id="feaf" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在解决方案中创建缓存文件夹，并为Redis和Connection Helper创建几个类。所以，首先，为Redis缓存创建ICacheService和CacheService。</p><figure class="kq kr ks kt gt jo"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="510d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">接下来，为Redis缓存相关的功能创建CacheService类。</p><figure class="kq kr ks kt gt jo"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="a0fe" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">第八步:</strong></p><p id="10ee" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">创建ConfigurationManager类，我们用它来配置appsetting.json文件</p><figure class="kq kr ks kt gt jo"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="af93" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">第九步:</strong></p><p id="ef69" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">接下来，在缓存文件夹中创建ConnectionHelper类以获取RedisURL并将其配置到应用程序中。</p><figure class="kq kr ks kt gt jo"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="3722" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">第十步:</strong></p><p id="7f1a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在，我们将为JWT身份验证部分创建登录和JWTTokenResponse类</p><figure class="kq kr ks kt gt jo"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="553c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">此外，为令牌创建JWTTokenResponse类</p><figure class="kq kr ks kt gt jo"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="3c31" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">第十一步:</strong></p><p id="adcd" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">稍后，在控制器内部创建AuthenticationController，用于用户的身份验证。</p><figure class="kq kr ks kt gt jo"><div class="bz fp l di"><div class="ku kv l"/></div></figure><ul class=""><li id="073e" class="kw kx in jt b ju jv jy jz kc ky kg kz kk la ko lb lc ld le bi translated">正如你在上面的类中看到的，我们从用户那里获取用户名和密码，然后获取我们放在appsettings.json文件中的密钥</li><li id="bab3" class="kw kx in jt b ju lf jy lg kc lh kg li kk lj ko lb lc ld le bi translated">接下来，使用HMAC SHA256加密算法为编码字符串创建使用秘密密钥的签名凭证。</li><li id="cb55" class="kw kx in jt b ju lf jy lg kc lh kg li kk lj ko lb lc ld le bi translated">后来，我们在创建令牌时添加了一些属性，如签名凭证、到期时间、发布者、受众，以及根据我们的需要和要求添加不同类型的声明。</li><li id="090e" class="kw kx in jt b ju lf jy lg kc lh kg li kk lj ko lb lc ld le bi translated">最后，使用令牌处理程序创建令牌，并以编码的形式发送给最终用户。</li></ul><p id="1f15" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">第十二步:</strong></p><p id="971b" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在appsetting.json文件中添加一些环境变量</p><figure class="kq kr ks kt gt jo"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="8546" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">第十三步:</strong></p><p id="0eb7" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">接下来，在程序类中注册与JWT身份验证、用于身份验证的Swagger UI、CORS策略和缓存服务相关的所有服务器，如下所示</p><figure class="kq kr ks kt gt jo"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="ef1a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">第十四步:</strong></p><p id="fcbf" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">最后，在实体框架的包管理器控制台中执行以下命令，以进行数据迁移和数据库更新。</p><pre class="kq kr ks kt gt lk ll lm ln aw lo bi"><span id="8030" class="lp lq in ll b gy lr ls l lt lu">add-migration “First”</span><span id="ecde" class="lp lq in ll b gy lv ls l lt lu">update-database</span></pre><p id="22f8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">第十五步:</strong></p><p id="83a7" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">运行应用程序，在提供凭证后创建令牌，并将其放入swagger UI中的Authorize选项卡，如下图所示</p><figure class="kq kr ks kt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi lw"><img src="../Images/1d69d787fb1532596c4369e384da9f4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9p5oCjfFn1FAL8Ng.png"/></div></div></figure><figure class="kq kr ks kt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi lw"><img src="../Images/ec16e3f558c8821ffd82d415ffdc0744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_x_38BYFRtsvjl4O.png"/></div></div></figure><figure class="kq kr ks kt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi lw"><img src="../Images/25a4bcbc56b99c76cde60849df15ea4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Bf64bKUehXSYNfB-.png"/></div></div></figure><figure class="kq kr ks kt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi lw"><img src="../Images/8460b1b0406b802f2f1a7678dd815e3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nVhjJ8OZ4WOgJHfl.png"/></div></div></figure><figure class="kq kr ks kt gt jo gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/b9b87b77a4a71210724e9c54bf0c54fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/0*YVvw3JV5xj2CzL7g.png"/></div></figure><figure class="kq kr ks kt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi lw"><img src="../Images/f74c53e6132a15304b93155581976046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Hb4qIDXk_hAIYbQn.png"/></div></div></figure><figure class="kq kr ks kt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi lw"><img src="../Images/668e5c3e3be0618388522063c0f07033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*O_0AlTJhis8t0tJo.png"/></div></div></figure><p id="89f8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">这就是JWT认证的全部内容。NET Core 6 Web API。</p><p id="7034" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我希望你理解了这些事情，现在对事情的运作有了一个概念。</p><p id="9c22" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">编码快乐！</p><p id="48f8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><em class="mc">更多内容看</em> <a class="ae kp" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jt io"> <em class="mc">说白了。报名参加我们的</em> <a class="ae kp" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jt io"> <em class="mc">免费周报</em> </strong> </a> <em class="mc">。关注我们关于</em><a class="ae kp" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jt io"><em class="mc">Twitter</em></strong></a><em class="mc">和</em><a class="ae kp" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jt io"><em class="mc">LinkedIn</em></strong></a><em class="mc">。查看我们的</em> <a class="ae kp" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jt io"> <em class="mc">社区不和谐</em> </strong> </a> <em class="mc">加入我们的</em> <a class="ae kp" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="jt io"> <em class="mc">人才集体</em> </strong> </a> <em class="mc">。</em></strong></a></p></div></div>    
</body>
</html>