<html>
<head>
<title>How to fix the “window is not defined” error in Next.Js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何修复Next中的“窗口未定义”错误？射流研究…</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-fix-the-window-is-not-defined-error-in-next-js-d8b132f24a23?source=collection_archive---------2-----------------------#2022-12-30">https://javascript.plainenglish.io/how-to-fix-the-window-is-not-defined-error-in-next-js-d8b132f24a23?source=collection_archive---------2-----------------------#2022-12-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/a1272044fc5b573db18c1b0a43390b8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_g1Z1jRNSr-FmL36"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@martenbjork?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Marten Bjork</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3fed" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这篇简短的文章中，我将在接下来解释为什么会出现“窗口未定义错误”或“文档未定义错误”。JS以及如何修复它。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="23bc" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">为什么我会看到这个错误？</h1><p id="934e" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">我正在为餐馆构建一个订单管理系统，并认为Next是最好的框架，因为我不想担心路由问题，并且仍然希望使用React。</p><p id="de90" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我的例子中，这个错误出现了两次，原因有两个</p><ol class=""><li id="7ca3" class="mi mj in kc b kd ke kh ki kl mk kp ml kt mm kx mn mo mp mq bi translated">我需要向我正在构建的API发送一个带有有效负载的CSRF令牌，使用“document.cookie”触发了错误。</li><li id="1026" class="mi mj in kc b kd mr kh ms kl mt kp mu kt mv kx mn mo mp mq bi translated">我使用“react-apexcharts”进行数据可视化——对“window”对象进行内部调用。</li></ol><p id="11e9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">起初，我认为这是我的代码中的一个错误，或者我在我的页面挂载之前过早地引用了window对象，并试图用setTimeout将它向后推几秒钟，但没有用。</p><p id="bd5a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">基本上，我们不能访问“窗口”或“文档”对象的原因是因为Next。JS的服务器端渲染(SSR)功能。Next.js在服务器上呈现我们的页面，并分块提供这些页面。</p><p id="6471" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">“窗口”和“文档”是客户端API，因为Next在服务器端预渲染每个页面，我们不能访问这些API，因为它们还不存在(服务器端)。</p><h1 id="948f" class="lf lg in bd lh li mw lk ll lm mx lo lp lq my ls lt lu mz lw lx ly na ma mb mc bi translated">2.我如何修复这个错误</h1><p id="689e" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">延迟加载和动态导入有什么特别之处吗？</p><blockquote class="nb nc nd"><p id="d534" class="ka kb ne kc b kd ke kf kg kh ki kj kk nf km kn ko ng kq kr ks nh ku kv kw kx ig bi translated">为了防止在<strong class="kc io"> NextJS </strong>中的服务器端呈现，您必须使用动态导入来延迟加载您想要在客户端呈现的组件。</p></blockquote><p id="7541" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我在网上搜寻解决方案，在查阅了相关文档后，我发现了动态导入及其帮助。</p><figure class="ni nj nk nl gt jo"><div class="bz fp l di"><div class="nm nn l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Dynamically importing components</figcaption></figure><p id="cec7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如您可能已经注意到的，在第3行中，我将SSR选项设置为false，导致它在运行时(客户端)而不是构建时(服务器端)被导入。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="9687" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当试图直接访问窗口/文档对象(没有第三方包)时，有两种方法。</p><ol class=""><li id="60f3" class="mi mj in kc b kd ke kh ki kl mk kp ml kt mm kx mn mo mp mq bi translated">将窗口对象存储在状态变量中以备后用(不推荐)</li><li id="69ee" class="mi mj in kc b kd mr kh ms kl mt kp mu kt mv kx mn mo mp mq bi translated">使用客户端组件</li></ol><p id="ba99" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以使用useEffect钩子来解决这个问题。查看我如何使用useEffect和useState实现了一个解决方案</p><figure class="ni nj nk nl gt jo"><div class="bz fp l di"><div class="nm nn l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Accessing window from next js</figcaption></figure><p id="d226" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请注意，这是一个黑客，虽然它解决了这个错误，我不推荐这种方法。更好的方法是使用客户端组件。默认情况下，所有组件都是Next.js中的服务器组件，除非另有声明。</p><p id="865d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">那么我们如何制作一个客户端组件呢？除了一个例外，客户端组件与服务器组件没有什么不同。客户端组件在所有导入之上有一个“use-client”字符串声明，告诉Next.js将该文件视为客户端组件，而不是服务器组件。</p><pre class="ni nj nk nl gt no np nq bn nr ns bi"><span id="73a0" class="nt lg in np b be nu nv l nw nx">'use-client' <br/>// at the top of the page<br/>// before any imports<br/><br/>... // imports<br/>// you don't need to use dynamic imports in Client components<br/><br/><br/>export const MyComponent = ({ props }) =&gt;{<br/>  return(<br/>    &lt;div&gt;...&lt;/div&gt;<br/>  )<br/>}<br/><br/>export default MyComponent;</span></pre><p id="06f6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">既然我们已经确定了这个错误的原因并修复了它，那么在您自己的代码库中跟踪这个错误的原因应该没有问题，特别是当您使用任何引用“window”或“document”的第三方包时。</p><p id="42f0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我希望这篇文章对你有所帮助。感谢您的阅读，祝您编码愉快！</p><h2 id="2ce3" class="ny lg in bd lh nz oa dn ll ob oc dp lp kl od oe lt kp of og lx kt oh oi mb oj bi translated">更多内容请访问<a class="ae jz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> PlainEnglish.io </a>。</h2><p id="3aa9" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated"><em class="ne">报名参加我们的</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="ne">免费周报</em> </strong> </a> <em class="ne">。关注我们关于</em><a class="ae jz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="ne">Twitter</em></strong></a>，<a class="ae jz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="ne">LinkedIn</em></strong></a><strong class="kc io"><em class="ne">，</em></strong><a class="ae jz" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><em class="ne">YouTube</em><strong class="kc io"><em class="ne">，以及</em></strong><em class="ne"/></a><a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="ne">不和</em> </strong> </a>T49】</p><h2 id="a759" class="ny lg in bd lh nz oa dn ll ob oc dp lp kl od oe lt kp of og lx kt oh oi mb oj bi translated">希望扩大你的科技创业公司的知名度和采用率吗？检查<a class="ae jz" href="https://circuit.ooo/?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank">电路</a>。</h2></div></div>    
</body>
</html>