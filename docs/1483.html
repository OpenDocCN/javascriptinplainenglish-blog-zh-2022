<html>
<head>
<title>What Exactly is a Promise?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">承诺到底是什么？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/what-exactly-is-a-promise-601c6f39a8ad?source=collection_archive---------5-----------------------#2022-03-28">https://javascript.plainenglish.io/what-exactly-is-a-promise-601c6f39a8ad?source=collection_archive---------5-----------------------#2022-03-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="4be1" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">让我们结束困惑(希望如此)。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/2a0cb315f2bba5806e1005a1ec39773e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kpKmuYOv58e0MYOf"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@ospanali?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">OSPAN ALI</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e363" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">通常，当一个人想了解更多关于一个概念的信息时，他们可以在谷歌上搜索，点击第一个结果，几秒钟内就可以得到他们需要的信息来更好地理解它。有时候没那么容易。某些主题甚至需要挖掘多个来源才能开始理解它们。搜索JavaScript promise将会返回如下内容:</p><p id="b06b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lp">承诺是代表异步操作最终完成或失败的对象。</em></p><p id="fd44" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">并且:</p><p id="c8ee" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">承诺是一个特殊的JavaScript对象，它将生产代码和消费代码链接在一起。”</p><p id="7b0f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">嗯……好吧，我知道我不是最锋利的工具，但我愿意打赌，除了我之外，很多人都必须做更多的挖掘，以获得更好的承诺。这就是为什么我们要看一看JavaScript中的承诺，并希望在结束时对它们有一个坚定的理解，而不必浏览无数的文档和文章。</p><p id="62d0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">JavaScript通常同步执行。也就是说，它运行一行代码，当它完成执行时，它运行下一行。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="0190" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这段代码是同步的，因为<code class="fe ls lt lu lv b">knock knock</code>总是在<code class="fe ls lt lu lv b">who's there?</code>之前登录到控制台。缺点是，如果一个特定的任务语句被求值，那么程序的其余部分将被冻结，直到它被完成。由于大量的web应用程序从API获取数据，所以在做其他事情之前必须等待编译完成是不方便的。为了补救这一点，有许多Web APIs可用于异步工作的方法。</p><p id="cf07" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们快速看一下一个叫做<code class="fe ls lt lu lv b">setTimeout()</code>的异步方法。它为第一个参数接收一个回调函数，并以毫秒为单位接收一个可选的时间参数。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="06ec" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当调用该方法时，计时器根据第二个参数启动，这里是3秒。一旦定时器结束，回调函数就会执行。注意，其他代码行在<code class="fe ls lt lu lv b">setTimeout</code>完成之前执行。这就是异步JavaScript！</p><p id="49d1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当异步函数存在时，为了控制程序的流程，通常的做法是链接回调函数。回调链内的任何东西都将在异步部分执行后运行，而链外的任何东西都不会受到影响并立即执行。这改善了流动，但有一个巨大的缺点。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="5d01" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">链外的代码行将立即执行。将回调函数链接在一起可以让数字按顺序计数，彼此相隔三秒。它的作品，但哇是很难阅读。这就是所谓的“回调地狱”。这也只是一个3部分链，所以想象一个有10个或更多部分。呀，光是想想就让我头疼！</p><p id="bbdb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了更好地处理异步动作，请参见<code class="fe ls lt lu lv b">Promise</code>。像JavaScript中的其他东西一样，<code class="fe ls lt lu lv b">Promise</code>是一个对象。根据现在已知的情况，让我们再来看看之前的一个定义:</p><p id="923e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lp">“承诺是代表异步操作最终完成或失败的对象。”</em></p><p id="b577" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">通俗地说，承诺是为异步操作创建的对象。在创建时，promise对象不包含任何值，并且正在等待数据。如果异步操作成功完成，那么返回的数据将被设置为promise对象中的值。如果失败，则它保存一个错误，该错误可用于显示通知用户失败的消息。承诺有三种状态:</p><ol class=""><li id="9447" class="lw lx in kv b kw kx kz la lc ly lg lz lk ma lo mb mc md me bi translated"><strong class="kv io"> pending </strong>:承诺创建时的初始状态，等待异步操作的结果。</li><li id="2ff2" class="lw lx in kv b kw mf kz mg lc mh lg mi lk mj lo mb mc md me bi translated"><strong class="kv io">已完成</strong>:异步操作已成功完成，返回的数据现在保存在承诺中。</li><li id="be53" class="lw lx in kv b kw mf kz mg lc mh lg mi lk mj lo mb mc md me bi translated"><strong class="kv io">拒绝</strong>:异步操作失败，承诺中存在错误。</li></ol><p id="776a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Promise对象是用<code class="fe ls lt lu lv b">new</code>关键字创建的，并以两个函数作为参数。一个用于处理成功的异步操作，另一个用于处理失败。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="5af2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当新的承诺对象被创建时，它处于<code class="fe ls lt lu lv b">pending</code>状态，直到<code class="fe ls lt lu lv b">resolve</code>或<code class="fe ls lt lu lv b">reject</code>功能被调用，然后状态相应地切换到<code class="fe ls lt lu lv b">fulfilled</code>或<code class="fe ls lt lu lv b">rejected</code>。用承诺控制程序流是通过从<code class="fe ls lt lu lv b">Promise</code>原型继承的两个方法实现的:<code class="fe ls lt lu lv b">then()</code>和<code class="fe ls lt lu lv b">catch()</code>。这些方法允许将承诺链接在一起，以便在异步操作完成后可以直接采取进一步的操作。让我们看一个模拟从API获取数据的例子。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="e6c2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这个函数创建一个承诺，如果数据是真的，那么这个承诺就被实现，如果数据是假的，那么这个承诺就被拒绝。这里使用<code class="fe ls lt lu lv b">setTimeout()</code>函数来模拟类似于从API抓取数据的延迟。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="f65a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们解开这段代码。执行<code class="fe ls lt lu lv b">fetchData()</code>函数并创建一个新的承诺对象。它的状态是<code class="fe ls lt lu lv b">pending</code>，因为它在等待异步操作的结果。当<code class="fe ls lt lu lv b">setTimeout()</code>被调用时，计时器开始计数，跟随<code class="fe ls lt lu lv b">fetchData()</code>的代码将开始执行。<code class="fe ls lt lu lv b">I will not be delayed</code>被登录到控制台。一旦计时器结束，promise将检查数据是否真实。给<code class="fe ls lt lu lv b">fetchData()</code>的<code class="fe ls lt lu lv b">1</code>的自变量为真，因此承诺被解析，状态变为<code class="fe ls lt lu lv b">fulfilled</code>，承诺的值也为<code class="fe ls lt lu lv b">1</code>。使用<code class="fe ls lt lu lv b">then()</code>链接承诺。每次调用<code class="fe ls lt lu lv b">then()</code>都会创建一个全新的处理值的promise对象。首先，将原始承诺的值记录到控制台:<code class="fe ls lt lu lv b">1</code>。然后数值翻倍:<code class="fe ls lt lu lv b">2</code>。然后，再一次，值翻三倍:<code class="fe ls lt lu lv b">6</code>。承诺状态是<code class="fe ls lt lu lv b">fulfilled</code>，所以<code class="fe ls lt lu lv b">catch()</code>在这里不返回任何东西。欢迎来到所谓的“承诺链”。它控制从异步操作中获得的数据流，程序的其余部分可以无延迟地运行。它读起来也干净得多，看着它也不会让人头疼。不错！</p><p id="d986" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe ls lt lu lv b">catch()</code>方法也创建了一个<code class="fe ls lt lu lv b">Promise</code>的新实例，但是没有一个案例被解析。当异步操作失败时<code class="fe ls lt lu lv b">catch()</code>返回一个包含错误的承诺对象。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="c6cc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这里<code class="fe ls lt lu lv b">fetchData()</code>被无参数调用。由于这评估为假，承诺对象的状态改变为<code class="fe ls lt lu lv b">rejected</code>并且<code class="fe ls lt lu lv b">catch()</code>将错误信息记录到控制台。</p><p id="ff18" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这就是<code class="fe ls lt lu lv b">fetch()</code>方法的基本工作原理。它是另一个Web API异步方法，从其他API获取(natch)数据。从URL收集资源，并返回可以链接的承诺。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="995c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">承诺是处理异步请求的重要部分。它们使得在不停止应用程序其他部分工作的情况下收集天气、新闻和股票信息等数据成为可能。随着<code class="fe ls lt lu lv b">fetch()</code>成为网络应用程序的重要组成部分，了解承诺是什么以及如何使用它们来控制应用程序中的数据流是至关重要的。</p><p id="e987" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lp">更多内容尽在</em> <a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lp">说白了. io </em> </strong> </a> <em class="lp">。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lp">免费周报</em> </strong> </a> <em class="lp">。关注我们关于</em> <a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lp">推特</em> </strong> </a> <em class="lp">和</em><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="lp">LinkedIn</em></strong></a><em class="lp">。加入我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lp">社区不和谐</em> </strong> </a> <em class="lp">。</em></p></div></div>    
</body>
</html>