<html>
<head>
<title>AWS Lambda Functions (Node.js) — Unit Testing Using Sinon, Mocha and Chai</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS Lambda函数(Node.js) —使用Sinon、Mocha和Chai的单元测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/unit-testing-of-aws-lambda-functions-node-js-using-sinon-b6b3f25cc31d?source=collection_archive---------0-----------------------#2022-08-07">https://javascript.plainenglish.io/unit-testing-of-aws-lambda-functions-node-js-using-sinon-b6b3f25cc31d?source=collection_archive---------0-----------------------#2022-08-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="02d2" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">让我们学习如何使用Sinon、Mocha和Chai对AWS lambda函数进行单元测试。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/7cfdf485ca2512ba454adf7449216cfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ScO9RH-se3kBYinD9f43cA.png"/></div></div></figure><p id="c026" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在我之前的<a class="ae lk" rel="noopener ugc nofollow" target="_blank" href="/unit-testing-of-aws-lambda-functions-node-js-using-mocha-and-chai-317353f8d60">文章</a>中，我已经介绍了使用<em class="ll"> mocha </em>、<em class="ll"> chai、</em>和<em class="ll"> proxyquire </em>为AWS lambda函数编写单元测试用例。</p><p id="c55a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在本文中，我将介绍使用<strong class="kq io"> Sinon </strong>为AWS lambda函数编写单元测试用例的逐步过程。</p><p id="5c38" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">让我们学习如何使用Sinon为AWS Lambda函数编写单元测试用例。</p><h2 id="e45d" class="lm ln in bd lo lp lq dn lr ls lt dp lu kx lv lw lx lb ly lz ma lf mb mc md me bi translated">λ代码</h2><p id="9e46" class="pw-post-body-paragraph ko kp in kq b kr mf jo kt ku mg jr kw kx mh kz la lb mi ld le lf mj lh li lj ig bi translated">让我们首先来看一个样例Lambda函数，它根据搜索输入和过滤器从数据库中获取搜索结果。该函数有两个输入— <code class="fe mk ml mm mn b">searchText</code>和<code class="fe mk ml mm mn b">filterBy</code>。</p><ul class=""><li id="1198" class="mo mp in kq b kr ks ku kv kx mq lb mr lf ms lj mt mu mv mw bi translated"><code class="fe mk ml mm mn b">searchText</code> —将有我们要在数据库中搜索的文本。</li><li id="c776" class="mo mp in kq b kr mx ku my kx mz lb na lf nb lj mt mu mv mw bi translated"><code class="fe mk ml mm mn b">filterBy</code> —将具有我们希望对搜索结果进行排序所基于的字段名称。</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nc nd l"/></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk">Lambda function</figcaption></figure><h2 id="6d5d" class="lm ln in bd lo lp lq dn lr ls lt dp lu kx lv lw lx lb ly lz ma lf mb mc md me bi translated">lambda函数的单元测试</h2><p id="b98e" class="pw-post-body-paragraph ko kp in kq b kr mf jo kt ku mg jr kw kx mh kz la lb mi ld le lf mj lh li lj ig bi translated">现在让我们通过编写测试用例来测试上面的lambda代码。对于单元测试，我们将使用下面的包。</p><ul class=""><li id="93c7" class="mo mp in kq b kr ks ku kv kx mq lb mr lf ms lj mt mu mv mw bi translated"><a class="ae lk" href="https://mochajs.org/" rel="noopener ugc nofollow" target="_blank"> Mocha </a> —用于创建测试套件和运行测试用例。</li><li id="371f" class="mo mp in kq b kr mx ku my kx mz lb na lf nb lj mt mu mv mw bi translated"><a class="ae lk" href="https://www.chaijs.com/" rel="noopener ugc nofollow" target="_blank"> Chai </a> —验证给定代码是否正确运行的断言库。</li><li id="3120" class="mo mp in kq b kr mx ku my kx mz lb na lf nb lj mt mu mv mw bi translated"><a class="ae lk" href="https://sinonjs.org/" rel="noopener ugc nofollow" target="_blank"> Sinon </a> —一个可以模仿/存根依赖关系的包。</li></ul><p id="d315" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在让我们深入研究一下。</p><h2 id="0ad5" class="lm ln in bd lo lp lq dn lr ls lt dp lu kx lv lw lx lb ly lz ma lf mb mc md me bi translated">覆盖和模仿依赖关系</h2><p id="655f" class="pw-post-body-paragraph ko kp in kq b kr mf jo kt ku mg jr kw kx mh kz la lb mi ld le lf mj lh li lj ig bi translated">让我们学习如何模仿lambda函数内部的依赖关系。这些依赖项可以是任何第三方库或DB调用，甚至是API调用。为了覆盖和模仿这些依赖性，我们可以使用<strong class="kq io"> sinon </strong>包。</p><p id="43aa" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在运行每个测试用例之前，我们将创建一个<em class="ll"> sinon沙箱</em>并初始化其中所有的存根函数。稍后一旦每个测试用例被执行，我们将恢复存根函数并删除<em class="ll"> sinon沙箱</em>。</p><p id="b2cb" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在下面的例子中，我们有一个依赖项— <em class="ll">数据服务</em>(数据库函数)。我们将覆盖一个名为<strong class="kq io"> <em class="ll"> query </em> </strong>的数据库函数，并添加我们自己的逻辑来返回模拟结果。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nc nd l"/></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk">Mocking the dependencies using Sinon</figcaption></figure><h2 id="ef91" class="lm ln in bd lo lp lq dn lr ls lt dp lu kx lv lw lx lb ly lz ma lf mb mc md me bi translated">lambda函数的测试用例</h2><p id="92e4" class="pw-post-body-paragraph ko kp in kq b kr mf jo kt ku mg jr kw kx mh kz la lb mi ld le lf mj lh li lj ig bi translated">你可以在<a class="ae lk" href="https://github.com/SyedAfrozPasha/node-lambda-unit-test-sinon" rel="noopener ugc nofollow" target="_blank">这个</a> repo中找到单元测试用例的完整代码。</p><div class="ni nj gp gr nk nl"><a href="https://github.com/SyedAfrozPasha/node-lambda-unit-test-sinon" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd io gy z fp nq fr fs nr fu fw im bi translated">GitHub-SyedAfrozPasha/node-lambda-Unit-test-sinon:AWS lambda函数的单元测试(Node.js)…</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">用Mocha，Chai和Sinon - GitHub对AWS lambda函数(Node.js)进行单元测试…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">github.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz km nl"/></div></div></a></div><p id="34a7" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">要运行单元测试用例，执行项目根文件夹中的命令<code class="fe mk ml mm mn b">mocha</code>或<code class="fe mk ml mm mn b">npm run test</code>。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oa"><img src="../Images/a5f4b0036e5b474ddb37d6b3f82a2320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jmxVCF1FqkMMP0rQAJTLEw.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk">Unit test results</figcaption></figure><p id="9d5c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这就是我今天的全部内容。希望你喜欢。😉</p><p id="022c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">谢谢你的来访。如果你喜欢的内容，请支持我，并关注我更多这样的内容。</p><p id="5fec" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在<a class="ae lk" href="https://www.linkedin.com/in/syedafrozpasha/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae lk" href="https://twitter.com/SyedAfroz_Pasha" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae lk" href="https://github.com/SyedAfrozPasha" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上与我联系。</p></div><div class="ab cl ob oc hr od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ig ih ii ij ik"><p id="dadd" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="ll">更多内容看</em> <a class="ae lk" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="ll">说白了。报名参加我们的</em> <a class="ae lk" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="ll">免费周报</em> </strong> </a> <em class="ll">。关注我们关于</em><a class="ae lk" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="ll">Twitter</em></strong></a><a class="ae lk" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="ll">LinkedIn</em></strong></a><em class="ll">，以及</em> <a class="ae lk" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="ll">不和</em> </strong> </a> <em class="ll">。</em></strong></a></p></div></div>    
</body>
</html>