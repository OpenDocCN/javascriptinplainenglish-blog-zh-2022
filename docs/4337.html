<html>
<head>
<title>Caching with Redis and Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Redis和Node.js缓存</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/caching-with-redis-and-node-js-ad053a7cb26e?source=collection_archive---------3-----------------------#2022-11-22">https://javascript.plainenglish.io/caching-with-redis-and-node-js-ad053a7cb26e?source=collection_archive---------3-----------------------#2022-11-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5163" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何将Node.js后端连接到Redis并缓存数据</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/75a038d8d3b64db74b0e477768d57f6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fDPP_Vo-Th3XgnAy.png"/></div></div></figure><p id="15f6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Redis是临时存储数据的好方法，可以避免重复昂贵的操作或查询。</p><p id="8b8c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Redis使用一个键和值的系统，允许我们基于给定的键恢复结果。每个键都必须是唯一的，并且属于字符串类型。</p><p id="e2fe" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Redis中的每个条目还可以有一个以秒为单位定义的TTL(或生存时间)。一旦TTL达到0，该条目将被完全删除，并且不再可访问。</p><p id="bb7b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本文中，我们将使用agify.io open API根据姓名预测某人的年龄。这是本文的一个很好的例子，因为键是名称，值是结果！</p><h2 id="a8ee" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">设置我们的环境</h2><p id="48a1" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">在开始之前，让我们设置好我们需要的一切。从Redis开始！</p><p id="818b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于每个操作系统，设置Redis有很大的不同。在本文中，我不打算解释如何启动和运行Redis。你可以跟随<a class="ae ml" href="https://redis.io/docs/getting-started/" rel="noopener ugc nofollow" target="_blank">他们自己的文档</a>来看看怎么做。</p><p id="b841" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦Redis准备就绪，我们将快速建立一个NodeJS环境。</p><p id="7bae" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在新文件夹中，运行<code class="fe mm mn mo mp b">npm init -y</code>，然后运行<code class="fe mm mn mo mp b">npm install -S axios redis</code></p><p id="4ac3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Axios将用于API调用，因为它使用简单。</p><p id="1683" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Redis是我们用来访问Redis服务器并与之通信的库。</p><div class="mq mr gp gr ms mt"><a href="https://www.npmjs.com/package/redis" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd ir gy z fp my fr fs mz fu fw ip bi translated">雷迪斯</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">现代化的高性能Redis客户端。最新版本:4.5.0，最后发布时间:10天前。开始使用redis在您的…</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">www.npmjs.com</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh kp mt"/></div></div></a></div><h2 id="dbb9" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">连接到我们的Redis服务器</h2><p id="d411" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">首先，让我们连接到Redis实例。默认情况下，Redis将在端口6379和<code class="fe mm mn mo mp b">localhost</code>主机上运行。这些也是Redis包使用的默认值。</p><p id="d92b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在您的JS文件中，让我们从初始化我们的客户机并连接到它开始:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/0abd9f1a9743986982c5ec8c6fb7391c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FM_3nEw1r2xLtPcZEbtSnA.png"/></div></div></figure><blockquote class="nj nk nl"><p id="f9b5" class="kr ks nm kt b ku kv jr kw kx ky ju kz nn lb lc ld no lf lg lh np lj lk ll lm ij bi translated">通过运行这段代码，如果在Redis端一切正常，您应该能够在控制台中看到<code class="fe mm mn mo mp b">connected</code>。</p></blockquote><h2 id="7b56" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">从API获取数据</h2><p id="0311" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">在深入研究Redis之前，我们将快速创建一个从API获取数据的函数。</p><p id="6a9a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">网址将会是<code class="fe mm mn mo mp b">https://api.agify.io/?name={name}</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/89dd635e7dd27543dff307f042bfbf3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pYXt2CVZ4PfXDxu_A-QEcA.png"/></div></div></figure><blockquote class="nj nk nl"><p id="1afd" class="kr ks nm kt b ku kv jr kw kx ky ju kz nn lb lc ld no lf lg lh np lj lk ll lm ij bi translated">不要忘记要求axios能够使用它！</p></blockquote><h2 id="d472" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">将结果保存在Redis中，避免重新获取</h2><p id="8d56" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">既然我们能够获取数据，我们将确保只获取一次数据，并将其保存到Redis，以避免为相同的名称多次调用API。</p><p id="8a37" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我们将检查Redis值是否存在。为此，我们将创建以下函数:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/49de2e50784b211655b530f62b94537a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yMGDTuYk1Qp9P6on8e8L-Q.png"/></div></div></figure><p id="2b2c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个函数将允许我们返回结果，并且知道这个值是否存在。</p><p id="6f6d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们还将创建另一个函数，允许我们将新获取的值保存到Redis中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/da9504d1f3b74c1a2bc1fc78f95dad91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZKSiLfv5HodXI9F_ve56OA.png"/></div></div></figure><p id="23db" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">既然我们已经拥有了所需的一切，让我们一起使用一切:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/99bfbf4040a54ab6b5936e6aaf38031f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XH9DM0Kxr9n-6T6K7QI0cw.png"/></div></div></figure><p id="b910" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，如果您第一次执行整个操作，您应该会看到获取的值。然而，如果您第二次运行您的代码，您会看到现在，值被缓存！</p><h2 id="e5cf" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">设置TTL</h2><p id="a56f" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">既然我们能够保存到Redis中，我们将希望设置一个TTL，以防将来API结果发生变化。我们不想错过它！</p><p id="faf6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们稍微编辑一下我们的保存函数:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/f3f4fe660eab40622e96dd8aace3efcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*whXw4frXKP1s9-GLVW3IYg.png"/></div></div></figure><p id="63e4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，这个新函数允许我们为条目设置到期时间。这意味着它将在10000秒后到期。</p><h2 id="e610" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">通过命令行访问条目</h2><p id="7493" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">您可能希望通过命令行访问您的条目，以检查一切是否正常。为此，您可能需要使用两个命令:</p><ul class=""><li id="70fc" class="nt nu iq kt b ku kv kx ky la nv le nw li nx lm ny nz oa ob bi translated">获取<key/></li><li id="0178" class="nt nu iq kt b ku oc kx od la oe le of li og lm ny nz oa ob bi translated">TTL <key/></li></ul><p id="af7c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">第一个将返回值，而第二个将返回到期前的剩余时间！</p></div><div class="ab cl oh oi hu oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="ij ik il im in"><p id="cf22" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是如何设置NodeJS来连接Redis的方法！</p><p id="a2b7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我希望这篇文章对你有帮助！如果你做到了，不要犹豫留下掌声或关注！</p></div><div class="ab cl oh oi hu oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="ij ik il im in"><div class="kg kh ki kj gt mt"><a href="https://levelup.gitconnected.com/react-design-pattern-split-screen-layout-and-iterable-children-9de6896c5b42" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd ir gy z fp my fr fs mz fu fw ip bi translated">React设计模式:分屏布局和可迭代子元素</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">你知道孩子可以是一个数组吗？</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nc l"><div class="oo l ne nf ng nc nh kp mt"/></div></div></a></div><div class="mq mr gp gr ms mt"><a href="https://remy-villulles.medium.com/setup-opencv-for-python-on-mac-aeb898c28adf" rel="noopener follow" target="_blank"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd ir gy z fp my fr fs mz fu fw ip bi translated">在Mac上为Python设置OpenCV</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">一种对M1和英特尔都有效的特殊方法！</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">remy-villulles.medium.com</p></div></div><div class="nc l"><div class="op l ne nf ng nc nh kp mt"/></div></div></a></div><div class="mq mr gp gr ms mt"><a rel="noopener  ugc nofollow" target="_blank" href="/using-console-log-for-debugging-is-not-the-easy-way-92aca00ee2f1"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd ir gy z fp my fr fs mz fu fw ip bi translated">使用Console.log进行调试并不容易</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">让我们看看如何改进我们调试web应用程序的方式！</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="nc l"><div class="oq l ne nf ng nc nh kp mt"/></div></div></a></div><div class="mq mr gp gr ms mt"><a rel="noopener  ugc nofollow" target="_blank" href="/zip-a-folder-with-node-js-5cd940c5c4fe"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd ir gy z fp my fr fs mz fu fw ip bi translated">用Node.js压缩文件夹</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">如何用Node.js将文件夹和文件压缩成ZIP</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="nc l"><div class="or l ne nf ng nc nh kp mt"/></div></div></a></div><p id="4e57" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="nm">更多内容看</em> <a class="ae ml" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="nm">说白了。报名参加我们的</em> <a class="ae ml" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="nm">免费周报</em> </strong> </a> <em class="nm">。关注我们关于</em> <a class="ae ml" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="nm">推特</em></strong></a><a class="ae ml" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="nm">LinkedIn</em></strong></a><em class="nm"/><a class="ae ml" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="nm">YouTube</em></strong></a><em class="nm"/><a class="ae ml" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="nm">不和</em> </strong> </a> <em class="nm">。对增长黑客感兴趣？检查</em> <a class="ae ml" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="nm">电路</em> </strong> </a> <em class="nm">。</em></strong></a></p></div></div>    
</body>
</html>