<html>
<head>
<title>Here’s What I Learned When I Built a Chrome Extension for Medium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以下是我在为Medium构建Chrome扩展时学到的东西</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/heres-what-i-learned-when-i-built-a-chrome-extension-for-medium-ca228743a198?source=collection_archive---------9-----------------------#2022-12-14">https://javascript.plainenglish.io/heres-what-i-learned-when-i-built-a-chrome-extension-for-medium-ca228743a198?source=collection_archive---------9-----------------------#2022-12-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="c1ec" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">这些是我在为Medium做了Chrome扩展后学到的东西</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/6b7cb6f4f2acb2fa511f765935d54169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RDGPTyyZYT20jGi5"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@homajob?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Scott Graham</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a8c1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我为Medium做了第一个Chrome扩展。这是我第一次做那样的延伸。在构建的时候，我研究了一些媒体来构建我的特性。所以今天，我将在这篇文章中与你分享它们。</p><h1 id="7ddd" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">这个扩展是做什么的？</h1><p id="399e" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">来说说我建的扩展吧。这个扩展允许用户复制代码块中的内容，复制段落的URL并生成目录。为此，我需要回答一些问题来构建它。</p><ul class=""><li id="6cd1" class="mm mn in kv b kw kx kz la lc mo lg mp lk mq lo mr ms mt mu bi translated">第一个问题是如何检测当前网站是否中等。</li><li id="4e44" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated">第二个问题是如何列出项目来制作目录。</li></ul><p id="2fb8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在接下来的部分，我会谈谈如何回答这些问题，以及我从中学到了什么。</p><h1 id="64f3" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">如何检测一个当前网站是否中等？</h1><p id="55af" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">这是我开始构建任何扩展时首先考虑的问题。如果你想建立一个运行在任何网站上的扩展，你可能不需要关心这个。但是在这种情况下，您的扩展构建为在一个特殊的网站上运行。在我的可选中，我们应该考虑这一点。因为我们不想在其他网站上运行不必要的脚本。</p><p id="3674" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要做到这一点，我们有很多方法。我们可以使用简单的方法，在我的脚本中添加一个条件来检测当前的URL，如下所示:</p><pre class="kd ke kf kg gt na nb nc bn nd ne bi"><span id="a6fe" class="nf lq in nb b be ng nh l ni nj">if(window.location.host.startsWith('medium.com')) {<br/>  // Run your script<br/>}</span></pre><p id="40a9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是一个简单的方法。但是因为某些原因我真的不喜欢它。第一个原因是我们仍然需要运行脚本内容。这种情况可以帮助我们避免执行整个脚本。但是我们的Javascript文件中的脚本仍然被执行。</p><p id="b3e8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了解决这个问题，我们可以用<code class="fe nk nl nm nb b">manifest.json</code>尝试另一个解决方案。在<code class="fe nk nl nm nb b">content_scripts</code>中，我们可以定义<code class="fe nk nl nm nb b">matches</code>属性，让浏览器知道哪个网站将运行我们的脚本。</p><pre class="kd ke kf kg gt na nb nc bn nd ne bi"><span id="c620" class="nf lq in nb b be ng nh l ni nj">{<br/>  "content_scripts": [<br/>    {<br/>      "matches": ["https://*.medium.com/*"].<br/>      "js": ["/path/to/your/script"]<br/>    }<br/>  ]<br/>}</span></pre><p id="3fd4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我试试上面的解决方案。这是一个很好的解决方案，但我有一个问题。正如我所说的，我们可以使用“匹配”属性来定义我们想要运行脚本的网站模式。但是Medium并不只有“medium.com”这个域名。Medium允许用户将其域用作自定义域，而不是使用Medium域。这意味着除了域名“medium.com ”,我们还处理自定义域名。用户可以使用任何他们想要的域名。所以这种情况下<code class="fe nk nl nm nb b">matches</code>物业帮不了我们。他们需要将其值更改为“*://*/*”，并在我们的脚本中处理检测。</p><p id="fd45" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在我尝试了一些方法来检测网站是媒体后，我找到了一种方法。我们需要从一些元标签中获取数据，并使用这些值进行检测。有一些我从中型文章页面HTML中得到的meta标签。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nn"><img src="../Images/2b2f745bb17639bea0137c0fcfb993fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yM25iZsFpVO31xPVyyI5zA.png"/></div></div></figure><p id="cef3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这张照片中，我们有一些包含值“Medium”的数据标签。我们可以用它们来检测一个网站是否是一个中等网站。如果我们想检查当前的媒体页面是一个文章页面，我们可以对“og:type”属性再做一次检查。下面是一个示例代码:</p><pre class="kd ke kf kg gt na nb nc bn nd ne bi"><span id="f36e" class="nf lq in nb b be ng nh l ni nj">function isMedium() {<br/>  const site = document.querySelector('meta[property="og:site_name"]');<br/>  return site &amp;&amp; site.content === 'Medium';<br/>}<br/><br/>function isMediumArticlePage() {<br/>  if(!isMedium()) {<br/>    return false;<br/>  }<br/>   <br/>  const type = document.querySelector('meta[property="og:type"]');<br/>  return type &amp;&amp; type.content === 'article';<br/>}</span></pre><p id="bbf1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如您所见，我只是检查了meta标记的内容值，该标记有一个属性值“og:site_name”。为了检测文章页面，我们只需要再检查一次属性值为“article”的meta标签。</p><p id="984f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这一部分，我有一些笔记。首先要注意的是，我们检测网站是中型的方式取决于我们想要运行脚本的页面。如果你只在有固定域名的网站上运行你的脚本(中型主页，中型管理页面…)，你可以使用<code class="fe nk nl nm nb b">matches</code>属性<code class="fe nk nl nm nb b">menifest.json</code>为它定义一个模式。但是如果你想在有自定义域的页面上运行你的脚本，你需要在你的脚本中处理它。第二个注意事项是在我们的脚本中检测网站的方式。我们有很多方法可以做到这一点。我的方法是使用meta标签的内容值。它帮助我们知道网站属于媒体，即使它是一个自定义域。</p><h1 id="944c" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">在目录中列出标题的方法</h1><p id="9c77" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">在这一部分，我将谈谈我在构建两个函数TOC和Copy Code时所做的研究。</p><p id="3026" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">第一个功能是生成TOC。为此，我们需要知道那篇文章的标题是什么。换句话说，我们需要知道Medium是如何管理它的块的。在网上研究和检查文章的HTML之后，我理解了媒体块的基本规则。我将在这里展示一小段HTML代码。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi no"><img src="../Images/5f3cc99c31d0ba996398491a0b954f18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WPsG6ja9ZhxZK3THSeNcng.png"/></div></div></figure><p id="7d1a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如你所见，我们在一篇文章中有许多区块。每个块都有自己的ID。许多HTML标签可能会成为一个块，这取决于块的任务。我们用<code class="fe nk nl nm nb b">&lt;p&gt;</code>表示段落，<code class="fe nk nl nm nb b">&lt;pre&gt;</code>表示代码块，<code class="fe nk nl nm nb b">&lt;h1&gt;</code>表示标题…从这些信息中，我们可以从HTML标签中检测出一个代码块何时是标题块。我的工作只需要创建一个演示文章，并找到包含标题标题的HTML标签。之后，我只需要创建一个包含链接到id的标签的列表。</p><p id="3d39" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你想在文章发表前创建一个目录(在写作页面上)，你可以用同样的方法。您只需要将“id”属性更改为“name”属性。当本文发布时，块的“名称”将被转换为“名称”属性。</p><h1 id="39f0" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">其他注释</h1><p id="700b" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">除此之外，我还有一些其他的笔记给你。</p><p id="e7e8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">第一个注意事项与SPA有关。Medium是一个单独的页面，所以当用户点击一个链接时，它可能会通过SPA的方式重定向到这个页面。这意味着当用户转到其他页面时，你的脚本可能不会运行。如果您有一个每次页面加载时都要运行的脚本，那么您应该关心这个问题。在我的例子中，我只是用一个简单的代码通过<code class="fe nk nl nm nb b">MutationObserver</code>和<code class="fe nk nl nm nb b">location</code>来处理它。它看起来会像这样:</p><pre class="kd ke kf kg gt na nb nc bn nd ne bi"><span id="b131" class="nf lq in nb b be ng nh l ni nj">function startYourScript() {<br/>  let previousUrl = '';<br/>  const observer = new MutationObserver(function(mutations) {<br/>    if (location.href !== previousUrl) {<br/>      previousUrl = location.href; // Renew the current URL<br/>      // You can run your script here<br/>    }<br/>  });<br/>  observer.observe(document, {subtree: true, childList: true});<br/>}</span></pre><p id="eade" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是我的函数的一个简单版本。这个概念是让一个“观察者”跟随当前的URL。当这个URL改变时，我们只需要再次运行我们的脚本。</p><p id="9c2e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">第二个注意不仅仅是关于中等扩展。它适用于所有站点。如果你想为列表中的项目显示一个小部件或按钮，你不应该把它直接添加到原来的HTML中。当用户执行某些操作时，它们可能会被删除。或者更糟糕的是，它可能会使原有的功能或风格出现一些问题。</p><h1 id="39be" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">结论</h1><p id="7fb3" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">这些都是我想在这篇文章中分享的东西。我喜欢在介质上写作和阅读，所以我也喜欢做一些东西来提高我的阅读体验。为Medium构建一个Chrome扩展是一种有趣的体验。我学到了很多新东西。希望对大家有用。如果你想使用我的扩展，你可以在这里安装<a class="ae ks" href="https://chrome.google.com/webstore/detail/medium-plugin/oipiaoijoipncobppeichegfnnbcbeoa" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/8900c72fb984655398190ddb3afe5176.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FiPh_9x7jdah5-EH"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@aleskrivec?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ales Krivec</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e94d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">感谢您的阅读。如果您有任何反馈或建议，请随时通过<a class="ae ks" href="https://www.linkedin.com/in/thaisangnguyen3894/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>或<a class="ae ks" href="https://twitter.com/tasyit" rel="noopener ugc nofollow" target="_blank"> Twitter </a>联系我。</p></div><div class="ab cl np nq hr nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ig ih ii ij ik"><p id="7161" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="nw">更多内容请看</em><a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nw">plain English . io</em></strong></a><em class="nw">。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nw">免费周报</em> </strong> </a> <em class="nw">。关注我们关于</em><a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nw">Twitter</em></strong></a><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nw">LinkedIn</em></strong></a><em class="nw"/><a class="ae ks" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nw">YouTube</em></strong></a><em class="nw"/><a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nw">不和</em> </strong> </a> <strong class="kv io"> <em class="nw">。</em>T49】</strong></p><p id="6ad4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> <em class="nw">对缩放您的软件启动感兴趣</em> </strong> <em class="nw">？检查</em> <a class="ae ks" href="https://circuit.ooo/?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nw">电路</em> </strong> </a> <em class="nw">。</em></p></div></div>    
</body>
</html>