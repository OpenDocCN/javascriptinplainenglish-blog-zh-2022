<html>
<head>
<title>Explore the Architecture Behind a Typical Notification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索典型通知背后的架构</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/explore-the-architecture-behind-a-typical-notification-f7ea531b6a55?source=collection_archive---------4-----------------------#2022-05-19">https://javascript.plainenglish.io/explore-the-architecture-behind-a-typical-notification-f7ea531b6a55?source=collection_archive---------4-----------------------#2022-05-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="7723" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">让我们试着理解一个通知服务系统的设计。</h2></div><p id="3c23" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们都很清楚我们从不同的应用程序收到的通知。我们会收到各种活动/服务的通知，比如当我们在任何相关平台上从Zomato、MakeMyTrip或优步订购东西时。然而，由于这个过程已经刻在了系统中，我们从来没有费心去了解任何这样的系统的功能。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/b205ff07ef07ce4529dcf50d96bb84cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yJwOr-JgXrz--26h"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Photo by <a class="ae lo" href="https://unsplash.com/@brucemars?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">bruce mars</a> on <a class="ae lo" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="770e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">作为一个软件开发人员或技术爱好者，了解负责发送通知的系统设计会非常有趣。通知服务通常是整个产品的一部分，但很少是一个独立的应用程序，除非您为它提供SAAS产品。我们以某种方式将通知服务嵌入到我们的应用程序中。</p><h1 id="1d72" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">通知系统的要求</h1><p id="8e44" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">因此，在我们的通知服务中，我们应该知道我们想要实现的不同功能，以及通知系统应该包含的基本要求。因此，让我们讨论这样一个系统的基本能力。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi mm"><img src="../Images/049f1b9bf30a17fb3f8e310c1ae9b0c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bN_VFrrqlalTu8LT"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Photo by <a class="ae lo" href="https://unsplash.com/@corinnekutz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Corinne Kutz</a> on <a class="ae lo" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="9380" class="mn lq in bd lr mo mp dn lv mq mr dp lz kl ms mt mb kp mu mv md kt mw mx mf my bi translated">高度可扩展和可用</h2><p id="1ddb" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">至于任何系统，它应该是高度可伸缩和可用的。由于我们可以将通知系统构建为一个SASS或一个独立的服务，所以我们想要的一件事是系统应该是高度可用的。为此，我们可以使用各种概念，比如使用排队机制、自动伸缩/按需伸缩、缓存机制等。</p><h2 id="5cea" class="mn lq in bd lr mo mp dn lv mq mr dp lz kl ms mt mb kp mu mv md kt mw mx mf my bi translated">限速器</h2><p id="a3bb" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">在向最终用户发送通知时，我们应该始终有约束。客户通常会对发送给他们数以千计的通知感兴趣。因为对于最终用户来说，清除重要通知和促销通知的混乱总是一件很麻烦的事情。我们需要为基于客户端的速率限制准备一些机制。</p><h2 id="9f52" class="mn lq in bd lr mo mp dn lv mq mr dp lz kl ms mt mb kp mu mv md kt mw mx mf my bi translated">跟踪能力</h2><p id="03f3" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">此外，我们需要跟踪谁在发送消息。我们需要更好地理解我们使用系统传输的信息类型。这只会帮助我们访问网络和其他要求。我们可以根据我们将得到的统计数据进行缩放。</p><h2 id="e41c" class="mn lq in bd lr mo mp dn lv mq mr dp lz kl ms mt mb kp mu mv md kt mw mx mf my bi translated">优先</h2><p id="0e78" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">此外，拥有某种优先级机制也是必要的，因为与其他通知(如事务性消息、OTP等)相比，一些通知具有更高的优先级。</p><h1 id="cf0a" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">通知系统</h1><p id="9d79" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">通知制度是几乎每一种产品的一种强制性服务。如果你没有一个合适的通知系统，那么你很有可能会失去一些可以提供给客户的最好的用户体验。这篇文章主要是为愿意开发这样一个系统的软件开发人员准备的，也可以作为你下一次系统设计面试的一个简要的理解。</p><p id="b871" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以我们已经有了一个基本的架构。至于构建任何复杂的产品，我们需要有清晰的基础，因为罗马不是一天建成的，所以我们怎么能期望我们的产品也是如此。</p><p id="f461" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">开发人员可以在开发过程中探索许多特定于产品或服务的用例。让我们从通知服务saas模型的设计开始。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi mz"><img src="../Images/0feae684cb8315a90cc6fb57aad9fbd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pla7m3MxgJ-zBgwm2BL8Ng.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Possible system design for the notification system.</figcaption></figure><p id="0ace" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">由于我们有一个saas通知系统，我们当然会有各种各样的客户。让我们按时间顺序讨论所有的服务。</p><h2 id="b34a" class="mn lq in bd lr mo mp dn lv mq mr dp lz kl ms mt mb kp mu mv md kt mw mx mf my bi translated">前端处理程序服务。</h2><p id="239d" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">前端处理器服务将负责执行各种活动，如注册客户端和存储用户数据，如订阅的频道、设备id和其他基本元信息。此外，它会将所有消息添加到队列中，这样我们就有了一个可以支持大量通知的系统。</p><h2 id="78f2" class="mn lq in bd lr mo mp dn lv mq mr dp lz kl ms mt mb kp mu mv md kt mw mx mf my bi translated">用户管理服务和通知偏好服务</h2><p id="433a" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">我们将为用户管理和通知参考和速率限制器提供单独的服务，我们的前端处理器服务将与这些服务进行通信。用户管理服务将处理与用户相关的数据。该服务还将使用Redis进行更快的读取访问，因为它是读取密集型数据。</p><p id="2486" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">另一方面，将有一个通知偏好服务，它将维护我们在发送通知时将使用的时间偏好、优先级和速率限制等信息。我们不想给客户发送成千上万的通知而激怒他们。</p><h2 id="fbfc" class="mn lq in bd lr mo mp dn lv mq mr dp lz kl ms mt mb kp mu mv md kt mw mx mf my bi translated">排队机制(兔子MQ)。</h2><p id="79a8" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">我们需要在系统中有某种排队机制，因为我们会有各种各样的客户，他们会一次又一次地发送通知。通知有不同的优先级，我们不能失去它们。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi na"><img src="../Images/2161ce1a726cb3d1553429f99221f988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*maM1MxJTMLXDe1eZ"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Photo by <a class="ae lo" href="https://unsplash.com/@ethanhjy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ethan Hu</a> on <a class="ae lo" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f917" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果没有得到适当的通知，依赖于通知系统的各种任务关键型应用程序将会受到影响。这将有助于我们的产品处理大量的请求，因为我们不必一次处理所有的请求。该请求可以等待。</p><h2 id="db31" class="mn lq in bd lr mo mp dn lv mq mr dp lz kl ms mt mb kp mu mv md kt mw mx mf my bi translated">负载平衡器</h2><p id="d102" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">虽然我们在图中没有画出负载平衡器，但我想提醒您注意负载平衡器的功能，它将在任何服务器前使用。负载平衡器为您提供了一个可适度伸缩的应用程序。反向代理将有助于解决各种目的，如对不同服务器的请求进行负载平衡、添加适当的状态代码、为请求添加标题等。这将有助于我们消除停机时间，也就是说，如果任何一台服务器出现故障，我们都有其他服务器来处理。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/86a068b03feb10a4c2bc44e44b8ed8b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*6ftEzMz8U8hm2ZMWQf02RA.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Sample Load Balancer Design</figcaption></figure><p id="b56a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我不想在任何地方都显式地添加负载平衡器，因为我们知道负载平衡器的用途。我们可以在任何我们认为需要的地方添加它们。此外，还有一个自动伸缩的概念，它有助于在负载增加时扩展我们的应用程序。我们可以根据流量百分比、服务器利用率和各种其他因素进行配置。</p><h2 id="d77d" class="mn lq in bd lr mo mp dn lv mq mr dp lz kl ms mt mb kp mu mv md kt mw mx mf my bi translated">通知管理服务</h2><p id="6264" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">通知管理服务是我们整个应用程序的核心。我们的通知管理服务将与Rabbitmq通信，即我们的排队服务、用户管理服务、通知首选项和速率限制及服务。</p><p id="e411" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它将通过订阅特定的RabbitMq通道来接收通知。收到消息后，通知服务将与用户管理服务连接，以收集与用户相关的数据，如名称、设备id和用户提供的其他元数据。</p><p id="7fe0" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">除了获取与用户相关的数据和通知管理服务，还应该知道用户选择的通知首选项。例如，用户可能要求在上午10点到晚上10点之间在他们的电子邮件上发送通知。</p><p id="8667" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将用户相关服务的数据与通知管理服务合并。我们可以将解析后的数据最终推入另一个队列。因此，将数据放入另一个队列的原因是为不同的设备创建多个通道，如电子邮件、电话通知SMS等。</p><h2 id="09e5" class="mn lq in bd lr mo mp dn lv mq mr dp lz kl ms mt mb kp mu mv md kt mw mx mf my bi translated">通知元数据信息服务</h2><p id="e2ef" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">我想要一个通知元数据信息服务，它什么都不是，但可以被认为是一个跟踪器，将存储关键任务的信息。</p><p id="b193" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这项服务将有助于我们跟踪、维护和绘制不同类型的图表和其他统计数据，这些数据将用于升级我们的系统。</p><p id="2ba5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过统计特定服务与其他服务相比需要更多的负载，我们将能够实现功能。此外，收集元数据将帮助我们更好地设计我们的系统，了解关键信息，如通常使用的通知类型。</p><h2 id="5d9c" class="mn lq in bd lr mo mp dn lv mq mr dp lz kl ms mt mb kp mu mv md kt mw mx mf my bi translated">最后的队列</h2><p id="6a94" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">根据我们计划发送给最终用户的通知类型，队列最常用于存储最终解析的数据。我们可以直接触发来自通知管理服务的消息。这种方法的问题可能是丢失关键通知。很多时候，这些设备可能没有连接到互联网。这样很容易导致需要传递的信息丢失。</p><p id="f6ed" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通知总是至关重要的，我们不能失去它们。添加最终队列将使我们的产品具有弹性，因为我们不会丢失任何数据。</p><p id="730e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一个队列将支持确认信号，这将确保设备完全连接并且已经接收到通知。一旦我们得到确认信号，那么只有它将从队列中删除通知数据，否则它将让它等待。</p><h1 id="71c3" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">最后的想法</h1><p id="751c" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">因此，我们现在已经为我们的通知系统定义了一个基本结构。尽管这决不是一个详尽的清单。任何应用程序都会面临成千上万的用例。我们可以集成各种其他服务，如适当的缓存机制和数据库，这将帮助用户存储数据，用于其他分析等。</p><p id="3ece" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">slack最近通过流程图分享的一个非常流行的用例是当用户登录到各种设备时。但是很多时候，用户只想一次在一个设备上接收通知。所以我们需要处理这样的用例。</p><p id="8838" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是产品的不断升级，并且将一直持续下去。因此，不断探索并为您的服务添加新功能。</p><p id="8d4c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">更重要的是，有一句我最近学到的话想和大家分享。希望你会喜欢。</p><h1 id="9927" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">今日引语。</h1><blockquote class="nc"><p id="9e8a" class="nd ne in bd nf ng nh ni nj nk nl kx dk translated">一个人可能有一天会结束在这个世界上的时间，但我们分享的知识将永远存在。我们应该总是考虑分享我们学到的东西。在某个地方，有人可能从中得到好处。</p></blockquote></div><div class="ab cl nm nn hr no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ig ih ii ij ik"><p id="a2c4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">关于作者</strong></p><p id="e895" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Apoorv Tomar是一名软件开发人员，是<a class="ae lo" href="https://mindroast.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io">mind bake</strong></a>的一部分。你可以在<a class="ae lo" href="https://twitter.com/apoorvtomar_" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> Twitter </strong> </a>、<a class="ae lo" href="https://www.linkedin.com/in/apoorvtomar/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> Linkedin </strong> </a>、<a class="ae lo" href="https://t.me/ApoorvTomar" rel="noopener ugc nofollow" target="_blank"> Telegram </a>和<strong class="ke io"> Instagram </strong> 上和他连线。订阅<a class="ae lo" href="https://www.mindroast.com/newsletter" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io">简讯</strong> </a>获取最新策划内容。不要犹豫在任何平台上说“嗨”,只要说明你是在哪里找到我的资料的。</p><p id="077e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nt">更多内容请看</em><a class="ae lo" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="nt">plain English . io</em></strong></a><em class="nt">。报名参加我们的</em> <a class="ae lo" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nt">免费周报</em> </strong> </a> <em class="nt">。关注我们关于</em><a class="ae lo" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="nt">Twitter</em></strong></a><em class="nt">和</em><a class="ae lo" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="nt">LinkedIn</em></strong></a><em class="nt">。查看我们的</em> <a class="ae lo" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nt">社区不和谐</em> </strong> </a> <em class="nt">加入我们的</em> <a class="ae lo" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nt">人才集体</em> </strong> </a> <em class="nt">。</em></p></div></div>    
</body>
</html>