<html>
<head>
<title>How to Upgrade the Version of Yarn in a JavaScript Project in 60 Seconds</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在60秒内升级一个JavaScript项目中Yarn的版本</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-upgrade-the-version-of-yarn-in-a-javascript-project-in-60-seconds-5905526a00b0?source=collection_archive---------9-----------------------#2022-08-23">https://javascript.plainenglish.io/how-to-upgrade-the-version-of-yarn-in-a-javascript-project-in-60-seconds-5905526a00b0?source=collection_archive---------9-----------------------#2022-08-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="dfd7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">需要在一个JavaScript项目中将Yarn更新到最新版本？这比你想象的要简单，但是在你开始之前有一些事情你需要知道，尤其是如果升级到Yarn 3。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/40ea3b9b9b4dc63c7969f4cbea501b90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VUtRcWHJwHux3bTd"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@laarkstudio?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Laårk Boshoff</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2d54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">项目经理<code class="fe ls lt lu lv b">yarn</code>因为从《经典<code class="fe ls lt lu lv b">yarn</code>(<code class="fe ls lt lu lv b">v1</code>)到《现代<code class="fe ls lt lu lv b">yarn</code>(<code class="fe ls lt lu lv b">v2+</code>)的重大突破性变化，名声有点不好。</p><p id="cf61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管如此，我已经习惯在我所有的项目中使用现代、最新版本的<code class="fe ls lt lu lv b">yarn</code>，而不是替代版本<code class="fe ls lt lu lv b">npm</code>。</p><p id="d1c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe ls lt lu lv b">yarn</code>的一个好处是它的版本直接绑定到你的项目的CommonJS模块中(一个<code class="fe ls lt lu lv b">.cjs</code>文件)，而不是<code class="fe ls lt lu lv b">node</code>的版本。</p><p id="afc2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您实际上将当前发布版本的Yarn签入您的Git库，这意味着升级<code class="fe ls lt lu lv b">yarn</code>不同于升级<code class="fe ls lt lu lv b">npm</code>。</p><p id="69b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本教程中，您将学习如何将Yarn更新到最新版本，这只是比将<code class="fe ls lt lu lv b">npm</code>更新到最新版本稍微复杂一点。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="95bb" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">如何将<code class="fe ls lt lu lv b">npm</code>升级到最新版本</h1><p id="57b6" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">在我们谈论升级<code class="fe ls lt lu lv b">yarn</code>之前，让我们先介绍一下升级<code class="fe ls lt lu lv b">npm</code>，这样两种解决方案之间的区别会更清楚一些。</p><p id="52e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">类似于你如何用<code class="fe ls lt lu lv b">node -v</code>检查你的Node.js版本，用<code class="fe ls lt lu lv b">-v</code>简称<code class="fe ls lt lu lv b">--version</code>，你可以用<code class="fe ls lt lu lv b">npm -v</code>检查你的<code class="fe ls lt lu lv b">npm</code>版本。</p><p id="75b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，要升级<code class="fe ls lt lu lv b">npm</code>，您可以运行一个简单的<code class="fe ls lt lu lv b">npm update -g</code>命令，它将获取最新版本的<code class="fe ls lt lu lv b">npm</code>并在全球范围内安装。</p><p id="1379" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者，如果你正在升级Node.js，你将自动获得一个更新版本的<code class="fe ls lt lu lv b">npm</code>，因为它们是打包在一起的。</p><p id="eef4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们将看到的，Yarn使用了一组明显不同的命令，您需要将升级版本的<code class="fe ls lt lu lv b">yarn</code>提交到您的<code class="fe ls lt lu lv b">git</code>存储库中。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="b5cb" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">如何查看当前版本的Yarn</h1><p id="bba7" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">您可能认为<code class="fe ls lt lu lv b">yarn version</code>命令是用来检查<code class="fe ls lt lu lv b">yarn</code>的当前版本的，但它实际上是用于包版本控制的。</p><p id="fd6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">相反，要检查<code class="fe ls lt lu lv b">yarn</code>的当前版本，你只需要运行带有<code class="fe ls lt lu lv b">-v</code>标志的Yarn CLI(命令行界面)(<code class="fe ls lt lu lv b">--version</code>的简称):</p><pre class="kg kh ki kj gt na lv nb nc aw nd bi"><span id="d716" class="ne me iq lv b gy nf ng l nh ni">yarn -v</span></pre><p id="8b36" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果要么是经典纱线(指通过<code class="fe ls lt lu lv b">npm</code>安装的<code class="fe ls lt lu lv b">yarn</code>，也称为<code class="fe ls lt lu lv b">v1</code>，要么是现代纱线(通过<code class="fe ls lt lu lv b">yarn</code>、<code class="fe ls lt lu lv b">v2+</code>安装的<code class="fe ls lt lu lv b">yarn</code>)。</p><p id="c206" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">截至本文发布时，<code class="fe ls lt lu lv b">yarn</code>的最新版本是<code class="fe ls lt lu lv b">3.2.2</code>，因此我交替使用“现代纱线”和<code class="fe ls lt lu lv b">v3</code>这两个术语。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="e83c" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">但是现代纱线没有突破性的变化吗？</h1><p id="6c68" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">嗯，是的，现代<code class="fe ls lt lu lv b">yarn</code>有突破性的变化。有一本很大的迁移指南，我已经读了好几遍，你可能也需要:</p><div class="nj nk gp gr nl nm"><a href="https://yarnpkg.com/getting-started/migration" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd ir gy z fp nr fr fs ns fu fw ip bi translated">移民</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">任何主要版本都有其突破性的变化，Yarn 2也不例外。一些旧的行为被清理，修正…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">yarnpkg.com</p></div></div></div></a></div><p id="6901" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，每次我不得不这样做的时候，将一个简单的Yarn项目从<code class="fe ls lt lu lv b">v1</code>升级到<code class="fe ls lt lu lv b">@latest</code>就像运行两个命令一样简单:</p><pre class="kg kh ki kj gt na lv nb nc aw nd bi"><span id="1fd8" class="ne me iq lv b gy nf ng l nh ni">yarn set version stable<br/>yarn</span></pre><p id="af8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一个命令会将您更新到最新版本，这意味着即使您是从经典Yarn ( <code class="fe ls lt lu lv b">v1</code>)开始的，您最终也会得到现代Yarn ( <code class="fe ls lt lu lv b">v3</code>)。</p><p id="6d08" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果出于某种原因你不想更新到modern Yarn，你可以尝试获取最新版本的classic Yarn，但我不建议这样做:</p><pre class="kg kh ki kj gt na lv nb nc aw nd bi"><span id="4b12" class="ne me iq lv b gy nf ng l nh ni">yarn set version classic<br/>yarn</span></pre><p id="8281" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您正在从经典Yarn ( <code class="fe ls lt lu lv b">v1</code>)升级到现代Yarn ( <code class="fe ls lt lu lv b">v3</code>)，那么您将看到以下控制台输出，让您知道您正在升级:</p><pre class="kg kh ki kj gt na lv nb nc aw nd bi"><span id="c22d" class="ne me iq lv b gy nf ng l nh ni">➤ YN0070: Migrating from Yarn 1; automatically enabling the compatibility node-modules linker 👍</span></pre><p id="b11f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第二个命令，<code class="fe ls lt lu lv b">yarn</code>(你可能记得相当于<code class="fe ls lt lu lv b">yarn install</code>)，将重新安装你的包并完成版本升级。</p><p id="c387" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe ls lt lu lv b">yarn</code>命令完成运行后，您需要提交更改，这将包括Yarn的最新(升级)版本。</p><p id="ce38" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是在您停止阅读并提交Yarn对您的Git库所做的所有更改之前，让我们先修复您的<code class="fe ls lt lu lv b">.gitignore</code>文件。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="6150" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">为什么纱线会使我的PRs如此嘈杂？</h1><p id="b7ad" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">当我使用modern Yarn时，看到数百个文件在一个pull请求中被更改，我曾经非常恼火，但这实际上是一种额外的好处。</p><p id="ef1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当使用现代纱线默认值时，你选择了一种被称为“<a class="ae kv" href="https://yarnpkg.com/features/zero-installs" rel="noopener ugc nofollow" target="_blank">零安装</a>”的哲学，我最近成为了它的粉丝。</p><p id="4bd2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个想法是，在你的包注册表关闭的情况下，你仍然可以<code class="fe ls lt lu lv b">yarn install</code>，因为整个<code class="fe ls lt lu lv b">.yarn/cache</code>文件夹被提交给<code class="fe ls lt lu lv b">git</code>。</p><p id="f510" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这意味着<code class="fe ls lt lu lv b">npm</code>包注册表(或者你公司的AWS代码工件)的问题不会阻止你加载整个项目。</p><p id="e9cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您也可以相对安全地将<code class="fe ls lt lu lv b">.yarn/cache</code>文件夹添加到您的<code class="fe ls lt lu lv b">.gitignore</code>文件中——您的<code class="fe ls lt lu lv b">yarn install</code>只需获取整个缓存即可。</p><p id="3b14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">只是确保不要把整个<code class="fe ls lt lu lv b">.yarn</code>文件夹添加到你的<code class="fe ls lt lu lv b">.gitignore</code>或者<code class="fe ls lt lu lv b">.yarnrc.yml</code>文件中，因为这些文件决定了你的Yarn版本。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="990b" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">对于纱线，您应该在<code class="fe ls lt lu lv b">.gitignore</code>中包含什么？</h1><p id="6a9f" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">总结一下，让我们更新一下<code class="fe ls lt lu lv b">.gitignore</code>文件，因为你需要忽略的是从经典纱线(<code class="fe ls lt lu lv b">v1</code>)到现代纱线(<code class="fe ls lt lu lv b">v3</code>)的变化。</p><p id="fe8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">(<em class="nv">作者注:</em>纱的<a class="ae kv" href="https://yarnpkg.com/getting-started/qa#which-files-should-be-gitignored" rel="noopener ugc nofollow" target="_blank">对</a> <code class="fe ls lt lu lv b"><a class="ae kv" href="https://yarnpkg.com/getting-started/qa#which-files-should-be-gitignored" rel="noopener ugc nofollow" target="_blank">.gitignore</a></code>的推荐可能会有变化。我已经包含了这篇文章发表时的最新信息。)</p><p id="af11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这一点上我应该提到，无论您使用的是哪个版本的<code class="fe ls lt lu lv b">yarn</code>，提交<code class="fe ls lt lu lv b">yarn.lock</code>文件都被认为是最佳实践。</p><p id="8c44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您提交锁文件(对于<code class="fe ls lt lu lv b">npm</code>，它是<code class="fe ls lt lu lv b">package-lock.json</code>文件)的原因是为了记录所有已安装软件包的确切版本号。</p><p id="eeda" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果不提交<code class="fe ls lt lu lv b">yarn.lock</code>，您的<code class="fe ls lt lu lv b">package.json</code>文件可能会有不明确的包版本，比如<code class="fe ls lt lu lv b">^4.0.0</code>或<code class="fe ls lt lu lv b">latest</code>，它们可能会随着时间而改变。</p><p id="d75c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也就是说，当使用modern Yarn时，你需要更新<code class="fe ls lt lu lv b">.gitignore</code>,因为有新的文件，比如<code class="fe ls lt lu lv b">.yarnrc.yml</code>配置文件和<code class="fe ls lt lu lv b">yarn</code>版本。</p><p id="e2de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">如果你正在使用Yarn的“零安装”模式</strong>，就像我推荐的那样，那么你需要更新你的<code class="fe ls lt lu lv b">.gitignore</code>文件，以包含以下几行:</p><pre class="kg kh ki kj gt na lv nb nc aw nd bi"><span id="c57f" class="ne me iq lv b gy nf ng l nh ni"># We're using Yarn "Zero Installs"<br/>.yarn/*<br/>!.yarn/cache<br/>!.yarn/patches<br/>!.yarn/plugins<br/>!.yarn/releases<br/>!.yarn/sdks<br/>!.yarn/versions</span></pre><p id="8468" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">如果您没有使用“零安装”</strong>，这意味着您不想将包缓存签入您的Git库，那么将它添加到您的<code class="fe ls lt lu lv b">.gitignore</code>:</p><pre class="kg kh ki kj gt na lv nb nc aw nd bi"><span id="4e5c" class="ne me iq lv b gy nf ng l nh ni"># We're NOT using Yarn "Zero Installs"<br/>.pnp.*<br/>.yarn/*<br/>!.yarn/patches<br/>!.yarn/plugins<br/>!.yarn/releases<br/>!.yarn/sdks<br/>!.yarn/versions</span></pre><p id="2b2c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，如果你一直遵循我的非官方“纱线升级指南”，那么你需要做的最后一件事就是<code class="fe ls lt lu lv b">git commit</code>纱线升级:</p><pre class="kg kh ki kj gt na lv nb nc aw nd bi"><span id="f422" class="ne me iq lv b gy nf ng l nh ni">git commit -a -m "chore: upgrade version of Yarn to latest"</span></pre><p id="bc45" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">实际上，我更喜欢使用GitHub Desktop作为<code class="fe ls lt lu lv b">git</code>的GUI，但重点是您想要提交更改(并可能打开一个新的pull请求)。</p><p id="1f2f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">快乐编码！</strong> 🧶🙌🧑‍💻📦🐈</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/2bd8ccbdf0a5daa33d8cad8b7be594a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vzgSEJQSjd1FNVbb"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@nasimkeshmiri?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Nasim Keshmiri</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><p id="cf5b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.linkedin.com/in/derek-austin/" rel="noopener ugc nofollow" target="_blank">德里克·奥斯汀博士</a>是《职业规划:如何在6个月内成为一名成功的6位数程序员 》一书的作者，该书现已在亚马逊上架。</p></div></div>    
</body>
</html>