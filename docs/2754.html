<html>
<head>
<title>Closures in JavaScript: A Detailed Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中的闭包:详细指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/closure-in-javascript-7122f87759a?source=collection_archive---------9-----------------------#2022-07-01">https://javascript.plainenglish.io/closure-in-javascript-7122f87759a?source=collection_archive---------9-----------------------#2022-07-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/11de43635cf796278d65c17d194b043b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6FpixiYqvJzq54LTmm2HIg.jpeg"/></div></div></figure><blockquote class="jv"><p id="3a83" class="jw jx in bd jy jz ka kb kc kd ke kf dk translated">根据<a class="ae kg" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures" rel="noopener ugc nofollow" target="_blank"> MDN </a>，“一个<em class="kh">闭包是一个函数与对其周围状态(词法环境)的引用捆绑在一起(封闭)的组合。”</em></p></blockquote><p id="c705" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le kf ig bi translated">为了简化，内部函数总是可以通过<em class="lf">闭包</em>访问外部函数。这里需要注意的一件重要事情是<em class="lf">词法环境。</em>由于<em class="lf"/><em class="lf">l</em>exic环境，内部函数可以访问其父函数的所有变量。</p><p id="9139" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le kf ig bi translated">下图中的黄色矩形是父函数的词法环境，所有函数都包含父函数的词法环境及其局部变量。词法环境的链是<em class="lf">范围链</em>。</p><figure class="lm ln lo lp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ll"><img src="../Images/13f01a8e225f6eed8ebc009dbebca210.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZiwGGxFysu8DqSyez467BQ.jpeg"/></div></div></figure><p id="72d0" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le kf ig bi translated">让我们看看下图，这里我们有三个函数，一个在另一个里面。由于闭包，最里面的函数child()可以访问祖父级()的所有变量。</p><blockquote class="lq lr ls"><p id="5141" class="ki kj lf kk b kl lg kn ko kp lh kr ks lt li kv kw lu lj kz la lv lk ld le kf ig bi translated">由于封闭性，函数即使在被返回后也会记住它们的作用域。</p></blockquote><figure class="lm ln lo lp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/00318ccfdf206f4e183850a483b63920.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ws9DgJ08ggLlmxRnmv_ueg.png"/></div></div></figure></div><div class="ab cl lx ly hr lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ig ih ii ij ik"><h2 id="80f8" class="me mf in bd mg mh mi dn mj mk ml dp mm kt mn mo mp kx mq mr ms lb mt mu mv mw bi translated">闭包的用例</h2><ul class=""><li id="f174" class="mx my in kk b kl mz kp na kt nb kx nc lb nd kf ne nf ng nh bi translated">Currying</li><li id="23c7" class="mx my in kk b kl ni kp nj kt nk kx nl lb nm kf ne nf ng nh bi translated">包装</li><li id="0abd" class="mx my in kk b kl ni kp nj kt nk kx nl lb nm kf ne nf ng nh bi translated">像memoize和once这样的函数</li><li id="6ec8" class="mx my in kk b kl ni kp nj kt nk kx nl lb nm kf ne nf ng nh bi translated">设置超时</li><li id="7135" class="mx my in kk b kl ni kp nj kt nk kx nl lb nm kf ne nf ng nh bi translated">模块设计模式</li></ul></div><div class="ab cl lx ly hr lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ig ih ii ij ik"><h2 id="8991" class="me mf in bd mg mh mi dn mj mk ml dp mm kt mn mo mp kx mq mr ms lb mt mu mv mw bi translated">关于结束的常见面试问题</h2><p id="64ae" class="pw-post-body-paragraph ki kj in kk b kl mz kn ko kp na kr ks kt nn kv kw kx no kz la lb np ld le kf ig bi translated">这段代码的输出会是什么</p><pre class="lm ln lo lp gt nq nr ns nt aw nu bi"><span id="2fcc" class="me mf in nr b gy nv nw l nx ny">function a() {</span><span id="4e41" class="me mf in nr b gy nz nw l nx ny"> for (var i = 0; i &lt;= 5; i++) {</span><span id="c6de" class="me mf in nr b gy nz nw l nx ny">  setTimeout(function () {</span><span id="e0d3" class="me mf in nr b gy nz nw l nx ny">    console.log(i)</span><span id="cd2f" class="me mf in nr b gy nz nw l nx ny">  }, i * 1000)</span><span id="eefa" class="me mf in nr b gy nz nw l nx ny">}</span><span id="8f42" class="me mf in nr b gy nz nw l nx ny">}</span><span id="44a5" class="me mf in nr b gy nz nw l nx ny">a()</span></pre><figure class="lm ln lo lp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oa"><img src="../Images/12bea8bd7185feee0faf18622d77389f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BIwIgpGkn5GuIneXZ7Kcyg.png"/></div></div></figure><p id="c73f" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le kf ig bi translated">这里的输出是6乘以6。由于闭包，函数总是记住在函数诞生期间声明的变量，因此<strong class="kk io"> i </strong>总是引用相同的内存位置(因为I是使用var声明的),我们每次都得到最终值6作为输出。</p></div><div class="ab cl lx ly hr lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ig ih ii ij ik"><p id="db45" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le kf ig bi translated">让我们做一个小小的改变，用<strong class="kk io"> let </strong>替换<strong class="kk io"> var </strong></p><pre class="lm ln lo lp gt nq nr ns nt aw nu bi"><span id="3caa" class="me mf in nr b gy nv nw l nx ny">function a() {</span><span id="7a6c" class="me mf in nr b gy nz nw l nx ny">  for (let i = 0; i &lt;= 5; i++) {</span><span id="b1d3" class="me mf in nr b gy nz nw l nx ny">   setTimeout(function () {</span><span id="3900" class="me mf in nr b gy nz nw l nx ny">     console.log(i)</span><span id="5d52" class="me mf in nr b gy nz nw l nx ny">   }, i * 1000)</span><span id="1a1a" class="me mf in nr b gy nz nw l nx ny"> }</span><span id="26d3" class="me mf in nr b gy nz nw l nx ny">}</span><span id="3067" class="me mf in nr b gy nz nw l nx ny">a()</span></pre><figure class="lm ln lo lp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ob"><img src="../Images/9c89fe3d017b2ed2ebc9dcffe5488c07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dIVuKBC2jccsajfU6jn6PA.png"/></div></div></figure><p id="51ba" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le kf ig bi translated"><em class="lf">看看这两幅图像，你可以清楚地看到我说的</em> <strong class="kk io"> <em class="lf">让</em> </strong> <em class="lf">是一个遮挡范围的区别。</em></p><p id="183f" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le kf ig bi translated">我们可以通过简单地使用<strong class="kk io"> let </strong>而不是<strong class="kk io"> var来解决上述问题。let </strong>是一个块作用域，每次调用函数时，它都会创建一个新变量，因此引用不同的内存位置。</p><p id="189d" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le kf ig bi translated">正如本文所解释的，总是推荐使用<strong class="kk io"> let </strong>或<strong class="kk io"> const </strong>，因为两者都是块范围的。</p><p id="4d5c" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le kf ig bi translated">我们也可以不用let来解决上面的问题。解决方案是我们必须引用不同的内存位置，我们可以通过将setTimeout封装在不同的函数中来实现。现在，每次调用函数b()时，都会创建一个新的<strong class="kk io"> j </strong>副本。</p><pre class="lm ln lo lp gt nq nr ns nt aw nu bi"><span id="8589" class="me mf in nr b gy nv nw l nx ny">function a() {</span><span id="ede0" class="me mf in nr b gy nz nw l nx ny">for (var i = 0; i &lt;= 5; i++) {</span><span id="6ca4" class="me mf in nr b gy nz nw l nx ny">  function b(j) {</span><span id="e4cd" class="me mf in nr b gy nz nw l nx ny">    setTimeout(function () {</span><span id="886a" class="me mf in nr b gy nz nw l nx ny">      console.log(j)</span><span id="07b7" class="me mf in nr b gy nz nw l nx ny">   }, j * 1000)</span><span id="bd32" class="me mf in nr b gy nz nw l nx ny"> }</span><span id="6041" class="me mf in nr b gy nz nw l nx ny">b(i)</span><span id="9059" class="me mf in nr b gy nz nw l nx ny">}</span><span id="21ab" class="me mf in nr b gy nz nw l nx ny">}</span><span id="5a2a" class="me mf in nr b gy nz nw l nx ny">a()</span></pre><p id="b91d" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le kf ig bi translated">记住闭包只是函数的内部属性，我们不能显式地访问它。如果您想查看任何函数的作用域，请尝试下面的代码。</p><pre class="lm ln lo lp gt nq nr ns nt aw nu bi"><span id="75f0" class="me mf in nr b gy nv nw l nx ny">function  outer(){</span><span id="a232" class="me mf in nr b gy nz nw l nx ny">let count = 0;</span><span id="0118" class="me mf in nr b gy nz nw l nx ny">return function inner(){</span><span id="8ac7" class="me mf in nr b gy nz nw l nx ny">count ++;</span><span id="3fc0" class="me mf in nr b gy nz nw l nx ny">console.log(count)</span><span id="8428" class="me mf in nr b gy nz nw l nx ny">}</span><span id="60c2" class="me mf in nr b gy nz nw l nx ny">}</span><span id="f99c" class="me mf in nr b gy nz nw l nx ny">const func = outer()</span><span id="310d" class="me mf in nr b gy nz nw l nx ny">func()</span><span id="bace" class="me mf in nr b gy nz nw l nx ny">func()</span><span id="c395" class="me mf in nr b gy nz nw l nx ny">func()</span><span id="cf7c" class="me mf in nr b gy nz nw l nx ny">console.dir(func)</span></pre><figure class="lm ln lo lp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oc"><img src="../Images/c346f399ec3e78af313915f2704586d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bwcWTLCzXJfdO02QTQOmSQ.png"/></div></div></figure><p id="22de" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le kf ig bi translated">我们可以看到[[Scopes]]包含闭包。这里的[[]]表示该属性不能从外部访问，是一个内部JS属性。</p></div><div class="ab cl lx ly hr lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ig ih ii ij ik"><h1 id="84ed" class="od mf in bd mg oe of og mj oh oi oj mm ok ol om mp on oo op ms oq or os mv ot bi translated">结论</h1><p id="980d" class="pw-post-body-paragraph ki kj in kk b kl mz kn ko kp na kr ks kt nn kv kw kx no kz la lb np ld le kf ig bi translated">我希望在读完这篇文章后，闭包概念是清晰的，你将能够在面试中更好地解释它。</p><blockquote class="lq lr ls"><p id="0594" class="ki kj lf kk b kl lg kn ko kp lh kr ks lt li kv kw lu lj kz la lv lk ld le kf ig bi translated">如果我错过了什么，或者你有什么建议，请在评论区告诉我。</p><p id="ee02" class="ki kj lf kk b kl lg kn ko kp lh kr ks lt li kv kw lu lj kz la lv lk ld le kf ig bi translated"><em class="in">你也可以联系我<br/></em><a class="ae kg" href="http://linkedin/" rel="noopener ugc nofollow" target="_blank"><em class="in">https://www.linkedin.com/in/akhatun/</em></a></p><p id="00e2" class="ki kj lf kk b kl lg kn ko kp lh kr ks lt li kv kw lu lj kz la lv lk ld le kf ig bi translated"><a class="ae kg" href="https://www.instagram.com/readwithamnah/" rel="noopener ugc nofollow" target="_blank">https://www.instagram.com/readwithamnah/</a></p><p id="8251" class="ki kj lf kk b kl lg kn ko kp lh kr ks lt li kv kw lu lj kz la lv lk ld le kf ig bi translated"><a class="ae kg" href="https://github.com/amnahkhatun" rel="noopener ugc nofollow" target="_blank"><em class="in">https://github.com/amnahkhatun</em></a></p></blockquote></div><div class="ab cl lx ly hr lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ig ih ii ij ik"><p id="c04a" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le kf ig bi translated"><em class="lf">链接到更多关于JS的文章</em></p><div class="ou ov gp gr ow ox"><a href="https://medium.com/front-end-weekly/debouncing-and-throttling-in-javascript-3c8f8cf5e645" rel="noopener follow" target="_blank"><div class="oy ab fo"><div class="oz ab pa cl cj pb"><h2 class="bd io gy z fp pc fr fs pd fu fw im bi translated">Javascript中的去抖动和节流</h2><div class="pe l"><h3 class="bd b gy z fp pc fr fs pd fu fw dk translated">去抖动和节流都用于通过限制事件的次数来提高网站性能…</h3></div><div class="pf l"><p class="bd b dl z fp pc fr fs pd fu fw dk translated">medium.com</p></div></div><div class="pg l"><div class="ph l pi pj pk pg pl jt ox"/></div></div></a></div><div class="ou ov gp gr ow ox"><a href="https://medium.com/front-end-weekly/debug-like-a-pro-7749db57b4b1" rel="noopener follow" target="_blank"><div class="oy ab fo"><div class="oz ab pa cl cj pb"><h2 class="bd io gy z fp pc fr fs pd fu fw im bi translated">像专家一样调试</h2><div class="pe l"><h3 class="bd b gy z fp pc fr fs pd fu fw dk translated">作为一名web开发人员，你必须了解一些很棒的调试技术。老实说，我一直在使用…</h3></div><div class="pf l"><p class="bd b dl z fp pc fr fs pd fu fw dk translated">medium.com</p></div></div><div class="pg l"><div class="pm l pi pj pk pg pl jt ox"/></div></div></a></div><div class="ou ov gp gr ow ox"><a rel="noopener  ugc nofollow" target="_blank" href="/execution-context-understanding-javascript-9f70302c50be"><div class="oy ab fo"><div class="oz ab pa cl cj pb"><h2 class="bd io gy z fp pc fr fs pd fu fw im bi translated">执行上下文:理解JavaScript</h2><div class="pe l"><h3 class="bd b gy z fp pc fr fs pd fu fw dk translated">执行上下文是我们在使用JavaScript时需要了解的核心概念之一。了解执行力…</h3></div><div class="pf l"><p class="bd b dl z fp pc fr fs pd fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="pg l"><div class="pn l pi pj pk pg pl jt ox"/></div></div></a></div><p id="b420" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le kf ig bi translated">编码快乐！✌️</p><p id="476d" class="pw-post-body-paragraph ki kj in kk b kl lg kn ko kp lh kr ks kt li kv kw kx lj kz la lb lk ld le kf ig bi translated"><em class="lf">更多内容看</em> <a class="ae kg" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kk io"> <em class="lf">说白了就是</em> </strong> </a> <em class="lf">。报名参加我们的</em> <a class="ae kg" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kk io"> <em class="lf">免费每周简讯</em> </strong> </a> <em class="lf">。关注我们</em> <a class="ae kg" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kk io"> <em class="lf">推特</em> </strong> </a> <em class="lf">和</em><a class="ae kg" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kk io"><em class="lf">LinkedIn</em></strong></a><em class="lf">。查看我们的</em> <a class="ae kg" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kk io"> <em class="lf">社区不和谐</em> </strong> </a> <em class="lf">加入我们的</em> <a class="ae kg" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kk io"> <em class="lf">人才集体</em> </strong> </a> <em class="lf">。</em></p></div></div>    
</body>
</html>