<html>
<head>
<title>What are Closures &amp; How Does it Work in JavaScript?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是闭包&amp;它在JavaScript中是如何工作的？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/what-is-closures-how-it-works-in-javascript-step-by-step-real-life-example-eb4a97c7120d?source=collection_archive---------1-----------------------#2022-03-05">https://javascript.plainenglish.io/what-is-closures-how-it-works-in-javascript-step-by-step-real-life-example-eb4a97c7120d?source=collection_archive---------1-----------------------#2022-03-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e5af" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">带有真实例子的JavaScript闭包教程。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/116779ae495b67bd8e5aa363f5650621.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rRwjTo-dPpE5TW1GcxyVRg.png"/></div></div></figure><p id="ed74" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一个<strong class="kt ir">闭包</strong>是一个捆绑在一起(封闭)的函数的组合，并引用其周围的状态，让<strong class="kt ir">简化这个定义</strong>。</p><p id="08f6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将用下面的真实用例来说明闭包:</p><p id="eccc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="ln">让我们假设我们想要创建一个变量，我们称它为</em> <code class="fe lo lp lq lr b"><em class="ln">counter</em></code> <em class="ln">，并将其初始化为0，然后我们将在每次函数调用后给它加+1，然后，我们将在3次函数调用后将结果打印到控制台。我们期待收到数字3。</em></p><p id="e503" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们看看下面的解决方案示例:</p><pre class="kg kh ki kj gt ls lr lt lu aw lv bi"><span id="fd4c" class="lw lx iq lr b gy ly lz l ma mb">var counter = 0;</span><span id="37bf" class="lw lx iq lr b gy mc lz l ma mb">function plusOne(){<br/>  counter = counter + 1;<br/>  return counter;<br/>}</span><span id="c07b" class="lw lx iq lr b gy mc lz l ma mb">plusOne();<br/>plusOne();<br/>plusOne();</span><span id="8446" class="lw lx iq lr b gy mc lz l ma mb">console.log(counter); // Will print 3.</span></pre><h2 id="7960" class="lw lx iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">这个解决方案有什么问题？</h2><p id="ac58" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">问题是每个人都可以改变那个<code class="fe lo lp lq lr b">counter</code>变量，而这对我们没有好处，我们希望只有函数<code class="fe lo lp lq lr b">plusOne()</code>将可以做到这一点。</p><h2 id="4c03" class="lw lx iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">那么我们需要做什么呢？</h2><p id="8f59" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">为了保证只有函数<code class="fe lo lp lq lr b">plusOne()</code>可以修改<code class="fe lo lp lq lr b">counter</code>变量，我们必须将<code class="fe lo lp lq lr b">counter</code>变量设置为<code class="fe lo lp lq lr b">plusOne()</code>函数范围的局部变量。</p><pre class="kg kh ki kj gt ls lr lt lu aw lv bi"><span id="1909" class="lw lx iq lr b gy ly lz l ma mb">function plusOne(){<br/>  var counter = 0;<br/>  counter = counter + 1;</span><span id="65b8" class="lw lx iq lr b gy mc lz l ma mb">  return counter;<br/>}</span><span id="a694" class="lw lx iq lr b gy mc lz l ma mb">plusOne();<br/>plusOne();</span><span id="0739" class="lw lx iq lr b gy mc lz l ma mb">console.log(plusOne()); // Will print 1.</span></pre><h2 id="8a5d" class="lw lx iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">这个解决方案有什么问题？</h2><p id="d5c3" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">现在我们有了<code class="fe lo lp lq lr b">plusOne()</code>函数的局部变量<code class="fe lo lp lq lr b">counter</code>，<strong class="kt ir">太好了！</strong>，但这还没完，我们对<code class="fe lo lp lq lr b">plusOne()</code>函数的3次函数调用后，永远不会收到数字3，因为我们在每次函数调用后，都将局部变量<code class="fe lo lp lq lr b">counter</code>重新定义为0。</p><h2 id="2d0d" class="lw lx iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">那么我们需要做什么呢？</h2><p id="5180" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">我们需要在<code class="fe lo lp lq lr b">plusOne()</code>函数中有一个内部函数，它可以访问<code class="fe lo lp lq lr b">counter</code>变量，允许我们修改它。</p><pre class="kg kh ki kj gt ls lr lt lu aw lv bi"><span id="2737" class="lw lx iq lr b gy ly lz l ma mb">function plusOne(){<br/>  var counter = 0;<br/>  function add(){<br/>    counter = counter + 1;<br/>  }<br/>  add() //Call to the add() function to add 1 to counter.</span><span id="28bc" class="lw lx iq lr b gy mc lz l ma mb">  return counter;<br/>}</span><span id="a194" class="lw lx iq lr b gy mc lz l ma mb">plusOne();<br/>plusOne();</span><span id="5b76" class="lw lx iq lr b gy mc lz l ma mb">console.log(plusOne()); // Will print 1.</span></pre><h2 id="44c0" class="lw lx iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">这个解决方案有什么问题？</h2><p id="2233" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">这个解决方案仍然会将1而不是3打印到控制台，但是我们已经非常接近最终的解决方案了。那么，这个解决方案有什么问题呢？请注意，我们仍然为每个调用重新定义了<code class="fe lo lp lq lr b">counter</code>变量。如果我们可以只访问内部函数<code class="fe lo lp lq lr b">add()</code>而不去重定义代码，这个问题就解决了。</p><h1 id="de39" class="mz lx iq bd md na nb nc mg nd ne nf mj jw ng jx mm jz nh ka mp kc ni kd ms nj bi translated">最终解决方案</h1><pre class="kg kh ki kj gt ls lr lt lu aw lv bi"><span id="b533" class="lw lx iq lr b gy ly lz l ma mb">const plusOne = (function add(){<br/>  var counter = 0;</span><span id="73e9" class="lw lx iq lr b gy mc lz l ma mb">  return function {<br/>    counter = counter + 1;<br/>    return counter;<br/>  }<br/>})();</span><span id="3a4d" class="lw lx iq lr b gy mc lz l ma mb">plusOne();<br/>plusOne();</span><span id="ce09" class="lw lx iq lr b gy mc lz l ma mb">console.log(plusOne()); // Will print 3.</span></pre><p id="ff64" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以现在我们将打印3作为<code class="fe lo lp lq lr b">counter</code>值，但是这里实际发生了什么呢？</p><p id="5fc7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我们声明<code class="fe lo lp lq lr b">plusOne</code>变量是一个变量而不是一个函数，然后内部函数<code class="fe lo lp lq lr b">add()</code>现在包含了<code class="fe lo lp lq lr b">counter</code>变量，但是除此之外，它还返回一个函数给<code class="fe lo lp lq lr b">plusOne</code>变量，使<code class="fe lo lp lq lr b">pluseOne</code>变量成为一个函数，但是这里最重要的部分是返回给<code class="fe lo lp lq lr b">plusOne</code>变量的函数包含了父作用域，所以每次我们调用<code class="fe lo lp lq lr b">plusOne</code>函数(它是变量并变成了函数)时，返回的函数会记住计数器<code class="fe lo lp lq lr b">variable</code>的最后一个值。</p><p id="f88d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这被称为JavaScript <strong class="kt ir">闭包。</strong>它使得函数有可能拥有“<strong class="kt ir">私有</strong>变量。</p><p id="dff0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这样我们保证只有<code class="fe lo lp lq lr b">plusOne()</code>函数可以访问和修改<code class="fe lo lp lq lr b">counter</code>变量，并且不会使<code class="fe lo lp lq lr b">counter</code>变量处于<strong class="kt ir">全局作用域</strong>中。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="6ff7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">感谢您迄今为止的阅读，</strong>如果您喜欢这样的内容，并且您想支持我作为一名程序员和作家撰写更多这样的文章，<a class="ae nr" href="https://medium.com/membership/@nissimzarur" rel="noopener"> <strong class="kt ir"> <em class="ln">请使用我的链接注册Medium成为会员(每月订阅5美元)，您将可以无限制地访问Medium上的所有内容。</em> </strong> </a></p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="cc9e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你想了解更多关于作用域和每个作用域之间的区别，你可以在这里阅读:</p><div class="ns nt gp gr nu nv"><a href="https://nissimzarur.medium.com/4-types-of-javascript-scopes-all-you-need-to-know-about-207598da120e" rel="noopener follow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd ir gy z fp oa fr fs ob fu fw ip bi translated">4种类型的JavaScript作用域——您需要了解的全部内容</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">我看到许多前端开发人员不确定什么是作用域，即使他们每天在工作中使用它。我决定…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">nissimzarur.medium.com</p></div></div><div class="oe l"><div class="of l og oh oi oe oj kp nv"/></div></div></a></div></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="a496" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">谢谢，希望对你有帮助。关注我，了解更多JavaScript解释、示例和技巧。</p><p id="e6ea" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="ln">更多内容请看</em><a class="ae nr" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="ln">plain English . io</em></strong></a><em class="ln">。报名参加我们的</em> <a class="ae nr" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="ln">免费周报</em> </strong> </a> <em class="ln">。关注我们关于</em><a class="ae nr" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="ln">Twitter</em></strong></a><em class="ln">和</em><a class="ae nr" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="ln">LinkedIn</em></strong></a><em class="ln">。加入我们的</em> <a class="ae nr" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="ln">社区不和谐</em> </strong> </a> <em class="ln">。</em></p></div></div>    
</body>
</html>