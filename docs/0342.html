<html>
<head>
<title>Meet Socket League: A Flexible and Lightweight Way to Synchronize State</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">满足套接字联盟:一种灵活、轻量级的状态同步方式</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/socket-league-websockets-that-transfer-synced-state-93623d898bf5?source=collection_archive---------8-----------------------#2022-01-20">https://javascript.plainenglish.io/socket-league-websockets-that-transfer-synced-state-93623d898bf5?source=collection_archive---------8-----------------------#2022-01-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="ed63" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">Socket League现在提供了npm库，这些库通过定制的React钩子利用websockets进行同步状态管理。</h2></div></div><div class="ab cl kc kd hr ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="ig ih ii ij ik"><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/0b6d3f08e4d2bdaabf29af56e9d0e73d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1thcjjAo_beEZQoxUxUqTQ.png"/></div></div></figure></div><div class="ab cl kc kd hr ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="ig ih ii ij ik"><h1 id="8b9a" class="kv kw in bd kx ky kz la lb lc ld le lf jt lg ju lh jw li jx lj jz lk ka ll lm bi translated">有什么问题？</h1><p id="8757" class="pw-post-body-paragraph ln lo in lp b lq lr jo ls lt lu jr lv lw lx ly lz ma mb mc md me mf mg mh mi ig bi translated">如果说我们在这次疫情和在家工作中学到了什么，那就是地理位置分散的团队成员之间对实时项目协作的需求日益增长。允许这种群组参与的技术需要多个客户端之间的同步状态。</p><p id="bb75" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">开发人员有几种选择，允许他们实现这种技术来同步状态。然而，由于其专有性质，现有的选择可能是僵化和固执己见的，或者是沉重和深奥的。有时候，一个更简单的解决方案，一个本质上是<strong class="lp io"><em class="mo"/></strong><strong class="lp io"><em class="mo"/></strong>的轻量级解决方案，就足够了。</p><h1 id="45cd" class="kv kw in bd kx ky mp la lb lc mq le lf jt mr ju lh jw ms jx lj jz mt ka ll lm bi translated">介绍，插座联盟</h1><p id="c302" class="pw-post-body-paragraph ln lo in lp b lq lr jo ls lt lu jr lv lw lx ly lz ma mb mc md me mf mg mh mi ig bi translated">Socket League提供了一个<strong class="lp io"> <em class="mo">轻量级</em> </strong>和<strong class="lp io"> <em class="mo">非固执己见的</em> </strong> <a class="ae mu" href="https://www.npmjs.com/package/socket-league-client" rel="noopener ugc nofollow" target="_blank">客户端NPM库</a>，提供了一个类似于<em class="mo"> useState </em>的React hook，它依赖于<strong class="lp io"> <em class="mo"> websockets </em> </strong>到<strong class="lp io"> <em class="mo">在多个客户端之间同步状态</em> </strong>。对于任何前端开发人员来说，这个钩子就像使用熟悉的useState钩子一样。</p><p id="f573" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">此外，Socket League还提供了一个<a class="ae mu" href="https://www.npmjs.com/package/socket-league-server" rel="noopener ugc nofollow" target="_blank">服务器端npm库</a>，它与运行<strong class="lp io"> <em class="mo"> websocket服务器</em></strong><strong class="lp io"><em class="mo">持久化状态</em> </strong>并向客户端广播更改的另一个库协同工作。服务器端库的构建与数据库选择无关，并且具有为NoSQL (MongoDB)、PostgreSQL和内存中的JSON对象构建的当前功能。</p><h1 id="3b92" class="kv kw in bd kx ky mp la lb lc mq le lf jt mr ju lh jw ms jx lj jz mt ka ll lm bi translated">它是如何工作的？</h1><p id="0c9f" class="pw-post-body-paragraph ln lo in lp b lq lr jo ls lt lu jr lv lw lx ly lz ma mb mc md me mf mg mh mi ig bi translated">首先，让我们探索一下<a class="ae mu" href="https://www.npmjs.com/package/socket-league-client" rel="noopener ugc nofollow" target="_blank">前端库</a>和相关联的<strong class="lp io"> useSyncState </strong>钩子和<strong class="lp io">连接</strong>类是如何操作和使用的:</p><pre class="kk kl km kn gt mv mw mx my aw mz bi"><span id="7cc3" class="na kw in mw b gy nb nc l nd ne">const conn = new <strong class="mw io">Connection</strong> ('ws://localhost:3000');</span></pre><p id="8b01" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated"><strong class="lp io">连接</strong>类本质上包装了所有的前端逻辑来与服务器通信。一个新的<strong class="lp io">连接</strong>实例用websocket服务器的URL初始化，客户端将在该服务器上发送和接收状态更新。在上面的例子中，端口3000的本地主机被初始化。在引擎盖下，<strong class="lp io">连接</strong>类使用<a class="ae mu" href="https://www.npmjs.com/package/reconnecting-websocket" rel="noopener ugc nofollow" target="_blank">重新连接-websocket </a>库具有内置的自动重新连接特性。</p><pre class="kk kl km kn gt mv mw mx my aw mz bi"><span id="50e8" class="na kw in mw b gy nb nc l nd ne">const [socketState, setSocketState, undoSocketState] = <strong class="mw io">useSyncState</strong>(<br/>      session,<br/>      initialState,<br/>      conn,<br/>);</span></pre><p id="36b3" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">为了使用<strong class="lp io"> useSyncState </strong>钩子，需要三个参数:<strong class="lp io"> <em class="mo"> session </em> </strong>、<strong class="lp io"> <em class="mo"> initialState </em> </strong>和<strong class="lp io"> <em class="mo"> conn </em> </strong>。</p><p id="f007" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated"><strong class="lp io">会话</strong>是表示在一组客户端之间同步的状态单元的ID。第一次使用唯一的会话ID时，服务器通过在数据库中初始化一个新状态来做出响应。相反，如果客户端订阅现有状态，服务器将使用最新状态进行响应。</p><p id="3e49" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated"><strong class="lp io"> initialState </strong>有一个特定的用例，它只在客户端第一次初始化状态时使用。在这个场景中，<strong class="lp io"> initialState </strong>将表示要发送并存储在数据库中的状态对象。</p><p id="922b" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated"><strong class="lp io">连接</strong>参数<strong class="lp io"> </strong>是前述连接<strong class="lp io"> </strong>类的一个实例。</p><p id="6dc2" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">此参数表示三个功能动作之一:'<strong class="lp io"> <em class="mo">【初始】'</em> </strong>、'<strong class="lp io"> <em class="mo">更新'</em> </strong>、'<strong class="lp io"> <em class="mo">撤消'</em> </strong>。<strong class="lp io"> <em class="mo">初始</em> </strong>消息类型是联系服务器时发送的第一条消息，它告诉服务器要么初始化数据库中的新实例(如果会话ID不存在)，要么订阅并接收最新状态(如果会话ID已经存在)。每当客户端应用更改，然后向具有相关会话ID的所有客户端广播更新时，就会发送<strong class="lp io"> <em class="mo">更新</em> </strong>消息类型。虽然在默认情况下，最新的状态更新被自动给予优先权，但是更新冲突的处理可以通过在后端注册合并功能来定制。<strong class="lp io"> <em class="mo">撤销</em> </strong>消息类型通知服务器删除与所包含的会话ID相关联的最后一个状态，然后将该状态传输给其余连接的客户端。</p></div><div class="ab cl kc kd hr ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="ig ih ii ij ik"><p id="d4f2" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">接下来，让我们探索一下<a class="ae mu" href="https://www.npmjs.com/package/socket-league-server" rel="noopener ugc nofollow" target="_blank">后端库</a>，其中我们提供了一个管理状态同步服务器逻辑的<strong class="lp io"> SyncHandler </strong>类<strong class="lp io"> </strong>:</p><pre class="kk kl km kn gt mv mw mx my aw mz bi"><span id="d9c8" class="na kw in mw b gy nb nc l nd ne">const syncHandler = new SyncHandler(new PostgresDriver('DB_URI'));</span><span id="8e38" class="na kw in mw b gy nf nc l nd ne">await syncHandler.connect();</span><span id="8776" class="na kw in mw b gy nf nc l nd ne"><br/>const wsServer = new ws.Server({ noServer: true });<br/>wsServer.on("connection", syncHandler.handleWsConnection);</span></pre><p id="2fe8" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">处理程序<strong class="lp io"> SyncHandler </strong>应该用一个特定于数据库的驱动程序的新实例来实例化，该驱动程序将URI作为参数。我们的代码根据用户偏好提供了三种不同的驱动程序。每个驱动程序都有关于如何处理来自SyncHandler的请求的特定于语言的代码。到目前为止，已经为NoSQL (MongoDB)、PostgreSQL和JSON对象构建了功能，但是如果需要，开发人员可以创建他们自己的符合我们的TypeScript接口的驱动程序。如果没有提供驱动程序，它将默认为一个JSON对象。上面的例子展示了一个使用PostgresDriver的新实例。</p><p id="0345" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">然后，<strong class="lp io">。应该在SyncHandler对象上调用connect() </strong>来初始化基于所选数据库驱动程序的数据库连接。</p><p id="e9c5" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated">最后，应该在websocket服务器实现的任何连接事件期间调用SyncHandler。在上面的例子中，SyncHandler被赋予使用<a class="ae mu" href="https://www.npmjs.com/package/ws" rel="noopener ugc nofollow" target="_blank"> ws库</a>的websocket连接。</p></div><div class="ab cl kc kd hr ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="ig ih ii ij ik"><h1 id="f232" class="kv kw in bd kx ky kz la lb lc ld le lf jt lg ju lh jw li jx lj jz lk ka ll lm bi translated">探索插座联盟</h1><p id="a224" class="pw-post-body-paragraph ln lo in lp b lq lr jo ls lt lu jr lv lw lx ly lz ma mb mc md me mf mg mh mi ig bi translated">想看看Socket League是怎么做的吗？查看我们使用自己的npm库和钩子构建的<a class="ae mu" href="https://github.com/oslabs-beta/SocketLeague/tree/dev/echo-server-electron" rel="noopener ugc nofollow" target="_blank">聊天应用</a>！随便逛逛，看看这一切到底是如何组合在一起的。点击查看我们的<a class="ae mu" href="https://www.npmjs.com/package/socket-league-client" rel="noopener ugc nofollow" target="_blank">前端</a>和<a class="ae mu" href="https://www.npmjs.com/package/socket-league-server" rel="noopener ugc nofollow" target="_blank">后端</a> npm文档，点击<a class="ae mu" href="https://www.youtube.com/watch?v=iNiKbPLECRY" rel="noopener ugc nofollow" target="_blank">此处</a>观看视频教程！要了解更多关于我们的信息，请访问我们的网站！</p><p id="2412" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated"><em class="mo"> Socket League是在技术加速器</em> <a class="ae mu" href="https://opensourcelabs.io/" rel="noopener ugc nofollow" target="_blank"> <em class="mo"> OS Labs </em> </a> <em class="mo">下开发维护的开源NPM库。如果您有任何反馈或愿意投稿，请访问我们的</em> <a class="ae mu" href="https://github.com/oslabs-beta/SocketLeague" rel="noopener ugc nofollow" target="_blank"> <em class="mo"> GitHub资源库</em> </a> <em class="mo">或</em><a class="ae mu" href="https://www.socketleague.org/" rel="noopener ugc nofollow" target="_blank"><em class="mo">socketleague.org</em></a><em class="mo">。</em></p></div><div class="ab cl kc kd hr ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="ig ih ii ij ik"><h2 id="d0c3" class="na kw in bd kx ng nh dn lb ni nj dp lf lw nk nl lh ma nm nn lj me no np ll nq bi translated">这篇文章的作者之一是</h2><ul class=""><li id="e82d" class="nr ns in lp b lq lr lt lu lw nt ma nu me nv mi nw nx ny nz bi translated">亚伦·高特|<a class="ae mu" href="https://github.com/AaronJGaut" rel="noopener ugc nofollow" target="_blank">GitHub</a>|<a class="ae mu" href="https://www.linkedin.com/in/aarongaut/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a></li><li id="79c0" class="nr ns in lp b lq oa lt ob lw oc ma od me oe mi nw nx ny nz bi translated">库尔特·克兰德尔|<a class="ae mu" href="https://github.com/KCrandall6" rel="noopener ugc nofollow" target="_blank">GitHub</a>|<a class="ae mu" href="https://www.linkedin.com/in/kurtcrandall/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a></li><li id="bf52" class="nr ns in lp b lq oa lt ob lw oc ma od me oe mi nw nx ny nz bi translated">Kyle Boudewyn |<a class="ae mu" href="https://github.com/KyleBoudewyn" rel="noopener ugc nofollow" target="_blank">GitHub</a>|<a class="ae mu" href="https://www.linkedin.com/in/kyleboudewyn/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a></li><li id="49a9" class="nr ns in lp b lq oa lt ob lw oc ma od me oe mi nw nx ny nz bi translated">Trevor Mow |<a class="ae mu" href="https://github.com/tmow12" rel="noopener ugc nofollow" target="_blank">GitHub</a>|<a class="ae mu" href="https://www.linkedin.com/in/trevormow/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a></li><li id="6b01" class="nr ns in lp b lq oa lt ob lw oc ma od me oe mi nw nx ny nz bi translated">Zachary Lim |<a class="ae mu" href="https://github.com/lzzhengyi" rel="noopener ugc nofollow" target="_blank">GitHub</a>|<a class="ae mu" href="https://www.linkedin.com/in/zachary-zhengyi-lim/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a></li></ul><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi of"><img src="../Images/78cdd9b104ffeaa45a02942a24b44067.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ozy6VbC_8JnBAr2ymmruZA.png"/></div></div><figcaption class="og oh gj gh gi oi oj bd b be z dk">Socket League</figcaption></figure><p id="acc9" class="pw-post-body-paragraph ln lo in lp b lq mj jo ls lt mk jr lv lw ml ly lz ma mm mc md me mn mg mh mi ig bi translated"><em class="mo">更多内容看</em> <a class="ae mu" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lp io"> <em class="mo">说白了。报名参加我们的</em> <a class="ae mu" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lp io"> <em class="mo">免费周报</em> </strong> </a> <em class="mo">。在我们的</em> <a class="ae mu" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="lp io"> <em class="mo">社区获得独家写作机会和建议</em> </strong> </a> <em class="mo">。</em></strong></a></p></div></div>    
</body>
</html>