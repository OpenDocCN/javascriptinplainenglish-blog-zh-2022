# å¦‚ä½•ä½¿ç”¨ StepZen ä»¥æ™ºèƒ½çš„æ–¹å¼å°† REST API è¿ç§»åˆ° GraphQL

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/how-to-migrate-a-rest-api-to-graphql-the-smart-way-with-stepzen-5e60b7908291?source=collection_archive---------11----------------------->

## ä¸ºä»€ä¹ˆ GraphQL å¯èƒ½æ¯” RESTful APIs æ›´é€‚åˆæ‚¨çš„ä¸‹ä¸€ä¸ªé¡¹ç›®

![](img/905caab9ec7161efd8cfc6d1dc7b68bd.png)

Original Photo by [Ann poan](https://www.pexels.com/@ann-poan-3111643?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) from [Pexels](https://www.pexels.com/photo/laptop-on-desk-near-lush-houseplant-5797997/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)

éšç€ä»å•ä¸€åº”ç”¨ç¨‹åºçš„è½¬å˜ï¼ŒREST APIs å·²ç»æˆä¸ºæ ‡å‡†åŒ–ç³»ç»Ÿä¸­ä¸åŒç§»åŠ¨éƒ¨åˆ†å¦‚ä½•ååŒå·¥ä½œå’Œå…±äº«æ•°æ®çš„é¦–é€‰æ–¹æ³•ã€‚ç„¶è€Œï¼ŒREST ä¹Ÿæ˜¯ä¸€ä¸ªä¸çµæ´»çš„ã€é€šå¸¸ä¸æ˜ç¡®çš„æ ‡å‡†(å®ƒåªæ˜¯ä¸€ç»„æŒ‡å¯¼åŸåˆ™)ï¼Œæœ‰å‡ ä¸ªæ¶æ„å’Œå®ç°é—®é¢˜ï¼Œå¹¶ä¸”å·²ç»è¢«è¯æ˜ä¸èƒ½å¾ˆå¥½åœ°é€‚åº”ç°ä»£å®¢æˆ·çš„éœ€æ±‚â€”â€”æ•°æ®å¯†é›†å‹å’Œå¿«é€Ÿå˜åŒ–çš„éœ€æ±‚ã€‚

è¿™æ­£æ˜¯ GraphQL è¦è§£å†³çš„é—®é¢˜ï¼å¸¦æ¥çµæ´»æ€§å’Œæ•ˆç‡ï¼Œå¹¶ä½¿å¤„ç†å¤§é‡æ•°æ®å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹ GraphQL å¦‚ä½•æ¯” RESTful APIs æ›´é€‚åˆæ‚¨çš„ä¸‹ä¸€ä¸ªé¡¹ç›®ï¼Œä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œé€šè¿‡ä½¿ç”¨å…è´¹å·¥å…· [StepZen](https://stepzen.com/) ï¼Œå°†ç°æœ‰çš„ REST API è½¬æ¢ä¸º GraphQLã€‚

# GraphQL å¦‚ä½•æ”¹è¿› REST APIs

é™¤äº†æœ€ç®€å•çš„å®ç°ï¼ŒREST APIs çš„è®¾è®¡ä¼šå¯¼è‡´å®¢æˆ·ç«¯:

1.ä¸‹è½½**æ¯”å®é™…éœ€è¦æ›´å¤šçš„**æ•°æ®â€”â€”å› ä¸º API å“åº”å¯èƒ½*ä¹Ÿ*åŒ…æ‹¬å¯¹ç‰¹å®šå®¢æˆ·ç«¯æ— ç”¨çš„æ— å…³æ•°æ®ï¼Œ

2.æˆ–è€…**ä¸å¤Ÿ**â€”â€”å¯¼è‡´å®¢æˆ·ç«¯ç”¨æ›´å¤šçš„è¯·æ±‚æ¥æ•²æ‰“ API æœåŠ¡å™¨ï¼Œä»¥è·å–å®ƒéœ€è¦çš„æ•°æ®(ç¬¬ä¸€ä¸ª get è·å– N ä¸ªç»“æœ+å¯¹è¿™ N ä¸ªç»“æœä¸­çš„æ¯ä¸€ä¸ª**è¿›è¡Œä¸€æ¬¡ GETï¼Œæ€»å…± 1+N ä¸ªè¯·æ±‚)**

æ— è®ºå“ªç§æ–¹å¼ï¼Œæˆ‘ä»¬éƒ½å°†é¢ä¸´æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯çš„é«˜å¸¦å®½ä½¿ç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªåæ¶ˆæ¯ï¼Œå› ä¸ºå¤§å¤šæ•°ç½‘ç»œåº”ç”¨æ¶ˆè´¹éƒ½æ˜¯åœ¨ 4G/5G ä¸Šï¼Œå³è®¡é‡è¿æ¥ã€‚

GraphQL é€šè¿‡ä½¿ç”¨å£°æ˜æ€§æŸ¥è¯¢è¯­æ³•è§£å†³äº†è¿™äº›é—®é¢˜ã€‚ç”±äºä½¿ç”¨ GraphQL API çš„æ¯ä¸ªå®¢æˆ·ç«¯éƒ½æœ‰èƒ½åŠ›æŒ‡å®šä»–ä»¬éœ€è¦çš„ç²¾ç¡®æ•°æ®ï¼Œè¯¥ API åªæä¾›è¿™äº›æ•°æ®â€”â€”ä¸å¤šä¹Ÿä¸å°‘ **â€”** æå¤§åœ°å‡å°‘äº†æœ‰æ•ˆè´Ÿè½½çš„å¤§å°ã€‚æ­¤å¤–ï¼Œå®¢æˆ·ç«¯å®é™…ä¸Šå¯ä»¥è®¿é—®ä¸åŒæ•°æ®ä¹‹é—´å®šä¹‰çš„å…³ç³»ï¼Œå¹¶ä¸”å¯ä»¥ä¸€æ¬¡æ€§è·å¾—æ‰€æœ‰å…³ç³»ï¼Œè€Œä¸éœ€è¦ 1+N è¯·æ±‚ï¼Œä¹Ÿä¸éœ€è¦ç¼–ç¨‹æ¥æ‰¹å¤„ç†æˆ–å¹¶è¡ŒåŒ– API è°ƒç”¨ã€‚

![](img/b12de7dfb78cfcfe8a7976482edbc207.png)

Imagine REST APIsâ€¦that *also* let you transfer your SQL querying skills.

è¿˜æœ‰ä¸€äº›é™„å¸¦çš„å¥½å¤„:GraphQL æ˜¯ä¸¥æ ¼ç±»å‹åŒ–çš„ï¼ŒAPI ä¸­å…¬å¼€çš„æ‰€æœ‰ç±»å‹éƒ½åœ¨æ¨¡å¼ä¸­å®šä¹‰ã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥å°†å‰ç«¯ä¸åç«¯åˆ†ç¦»ï¼Œå› æ­¤å‰ç«¯å›¢é˜Ÿå¯ä»¥é€šè¿‡æ¨¡ä»¿æ‰€éœ€çš„æ•°æ®ç»“æ„æ¥è½»æ¾æµ‹è¯•ä»–ä»¬çš„åº”ç”¨ç¨‹åºï¼Œåç«¯å›¢é˜Ÿå¯ä»¥è®¾è®¡å‡ºæ˜ç¡®ã€å•ä¸€çš„åœ£ç»ï¼Œå³æ¨¡å¼ã€‚æ›´å¥½çš„æ˜¯ï¼Œ*æ¨¡å¼æœ¬èº«*å¯ä»¥ä½œä¸º API çš„æ–‡æ¡£ï¼ŒèŠ‚çœäº†å¤§é‡çš„ç¹çå·¥ä½œã€‚

# é‚£ä¹ˆ StepZen åœ¨å“ªé‡Œå‘¢ï¼Ÿ

*å¤ªå¥½äº†ï¼é‚£æˆ‘ä»¬å°±ä»€ä¹ˆéƒ½ç”¨ GraphQL å§ï¼*å—¯ï¼ŒGraphQL *æ˜¯*çš„ç‰›é€¼ï¼Œä½†å®ƒä¹Ÿæ˜¯ä¸€é¡¹ç›¸å¯¹è¾ƒæ–°çš„æŠ€æœ¯ï¼Œå¤§å¤šæ•°å…¬å¼€çš„ API éƒ½ä¸æ”¯æŒå®ƒã€‚å°† REST API è¿ç§»åˆ° GraphQL ä¹Ÿä¸ç®€å•ï¼Œè€Œä¸”ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ã€‚

ä¸è¦å®³æ€•ï¼Œè¿™æ˜¯ StepZen çš„æ•‘æ´ï¼

ç®€è€Œè¨€ä¹‹ï¼ŒStepZen æ˜¯ä¸€ä¸ª GraphQL æŠ½è±¡å±‚ï¼Œç”¨äº*æ‚¨æ‰€æœ‰çš„*æ•°æ®æºï¼Œå®ƒåœ¨å¹•ååšäº†å¤§é‡çš„å·¥ä½œï¼Œä½¿æ‚¨å¯ä»¥éå¸¸å®¹æ˜“åœ°å°†å…³ç³»æ•°æ®åº“ã€REST APIsã€å…¶ä»– GraphQL APIsï¼Œæ— è®ºæ‚¨æœ‰ä»€ä¹ˆï¼Œç»„åˆæˆä¸€ä¸ªå•ä¸€çš„ GraphQL ç«¯ç‚¹ï¼Œç„¶åæ‚¨å¯ä»¥åœ¨ä¸€ä¸ªæ— æœåŠ¡å™¨éƒ¨ç½²ä¸Šæ‰˜ç®¡å®ƒã€‚

æ‚¨å°†è·å¾— GraphQL çš„æ‰€æœ‰ä¼˜åŠ¿ï¼Œå¹¶ç»“åˆ StepZen æä¾›çš„â€œå³æœåŠ¡â€çš„æ‰€æœ‰ä¼˜åŠ¿â€”å®æ—¶æ“ä½œèƒ½åŠ›ã€ç›‘æ§ã€æŒ‡æ ‡ã€ç¼“å­˜ã€æœåŠ¡å™¨åŸºç¡€è®¾æ–½ã€å¯ä¼¸ç¼©æ€§ã€ç¡®ä¿æ­£å¸¸è¿è¡Œæ—¶é—´â€”ä¸ºæ‚¨èŠ‚çœå¤§é‡æ—¶é—´æ¥è®¾ç½®å¯ä¼¸ç¼©ã€è®¾è®¡è‰¯å¥½çš„é«˜æ€§èƒ½ GraphQL APIã€‚

# æ¡ˆä¾‹ç ”ç©¶:é€šè¿‡ StepZen å°† REST API è¿ç§»åˆ° GraphQL

å› æ­¤ï¼Œæ‰€æœ‰çš„æ–¹å¼ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æˆ‘æ˜¯å¦‚ä½•åˆ©ç”¨ StepZen åœ¨è¿™é‡Œã€‚æˆ‘ç»å¸¸ä½¿ç”¨[randomuser . me](https://randomuser.me/)APIâ€”â€”è¿™æ˜¯ä¸€ç§é¢å‘äººä»¬çš„ *lorem ipsum* ç”Ÿæˆå™¨â€”â€”æ¥æ¨¡æ‹Ÿæµ‹è¯•å‰ç«¯çš„æ•°æ®ã€‚æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥è§£å†³å®ƒçš„ REST ç‰¹æœ‰çš„ç¼ºç‚¹ï¼Œä½†æ˜¯å®ƒä»¬ä½¿æˆ‘çš„ API è°ƒç”¨æ›´åŠ å†—é•¿å’Œå¤æ‚ï¼Œå¯¹äºè¿™æ ·ç®€å•çš„ä¸œè¥¿æ¥è¯´ï¼Œè¿™æ˜¯å¤šä½™çš„ã€‚æ‰€ä»¥æˆ‘é€šè¿‡ StepZen å°†å®ƒè¿ç§»åˆ° GraphQLï¼Œæ”¹å–„äº†å“åº”æ—¶é—´å¹¶å‡å°‘äº†è¿‘ 70%çš„å¸¦å®½ä½¿ç”¨ï¼

![](img/6b1120f890d739b6ec1509bb73d05058.png)

Payload size difference between REST and GraphQL versions of the same API. This effect is amplified further in real-world projects where payload sizes can be in the MegaBytes range for each page of displayed results, and thatâ€™s not even counting infinite scrolling and static assets!

æˆ‘çš„è®¾ç½®éå¸¸ç®€å•ã€‚æˆ‘åœ¨ Express ä¸Šæ„å»ºäº†ä¸€ä¸ª API ä»£ç†æœåŠ¡å™¨ï¼Œå…¬å¼€äº†ä¸€ä¸ªç«¯ç‚¹ï¼Œè¯¥ç«¯ç‚¹ä»£è¡¨æˆ‘çš„å‰ç«¯è°ƒç”¨ Randomuser.me APIï¼Œåœ¨å°†ç»“æœå‘é€å›æˆ‘çš„ React åº”ç”¨ç¨‹åºä¹‹å‰å¯¹å…¶è¿›è¡Œæ•´ç†å’Œæ ¼å¼åŒ–ã€‚åœ¨çœŸæ­£çš„ç½‘ç«™ä¸Šï¼Œè¿™åªä¼šä»æˆ‘çš„ MongoDB å­˜å‚¨ä¸­æå–å®é™…æ•°æ®ã€‚

![](img/04bb80e641481dec577052ca0979e1e1.png)

I get names, portrait image URLs, and use that data to mock up a testimonial page, for example.

## æ­¥éª¤ 0:å…ˆå†³æ¡ä»¶

StepZen æä¾›äº†ä¸€ä¸ªæ¼‚äº®çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥è®©æ‚¨å¿«é€Ÿæ„å»ºå’Œéƒ¨ç½² GraphQL APIã€‚è®©æˆ‘ä»¬ç”¨ npm æ¥è·å–å®ƒå¹¶è¿›è¡Œå…¨å±€å®‰è£…ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒçš„ CLI å‘½ä»¤ã€‚

```
npm install -g stepzen
```

ç„¶åï¼Œä½¿ç”¨ä»¥ä¸‹ä¿¡æ¯ç™»å½•:

```
stepzen login
```

â€¦è¾“å…¥æ‚¨çš„ç”¨æˆ·åï¼Œç„¶ååœ¨å‡ºç°æç¤ºæ—¶è¾“å…¥æ‚¨çš„ç®¡ç†å‘˜å¯†é’¥ã€‚

## æ­¥éª¤ 1:åˆ›å»ºæ¨¡å¼

ğŸ’¡StepZen CLI æä¾›äº†ä¸€ç§éå¸¸ç®€å•çš„æ–¹æ³•ï¼Œå¯ä»¥ä¸ºæ‚¨éœ€è¦ç‚¹å‡»çš„æ¯ä¸ª REST API ç«¯ç‚¹è‡ªåŠ¨åˆ›å»ºæ¨¡å¼(`stepzen import`å‘½ä»¤),ä½†æ˜¯é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»¥â€œæ™®é€šâ€çš„æ–¹å¼æ¥åšï¼Œå› ä¸ºè¿™å°†å¸®åŠ©æ‚¨ç†Ÿæ‚‰å¦‚ä½•åˆ›å»º GraphQL æ¨¡å¼ã€‚æˆ‘ä»¬ä¸€ä¼šå„¿å°±å›æ¥è®¨è®ºè¿™ä¸ªé—®é¢˜ï¼

åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ç›®å½•ï¼Œç»™å®ƒèµ·ä¸€ä¸ªæœ‰æ„ä¹‰çš„åå­—ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º **randomuser.graphql** çš„æ–°æ–‡ä»¶â€”â€”è¿™æ˜¯æ‚¨çš„æ¨¡å¼æ–‡ä»¶ã€‚è¿™æ˜¯æˆ‘ä»¬å®šä¹‰ç±»å‹å’ŒæŸ¥è¯¢çš„åœ°æ–¹ï¼Œä¸ºæˆ‘ä»¬éœ€è¦çš„æ¯ä¸ª REST API æŒ‡å®šç«¯ç‚¹ã€‚

æˆ‘ä»¬çš„å…·ä½“ç”¨ä¾‹éå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦ç‚¹å‡» https://randomuser.me/api/çš„ï¼Œå¯é€‰åœ°ä¼ å…¥ä¸€ä¸ªæ•´æ•°(è¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›ç”Ÿæˆçš„ç”¨æˆ·æ•°é‡)ä½œä¸ºæŸ¥è¯¢å‚æ•°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„æ¨¡å¼çš„å†…å®¹å°†å¦‚ä¸‹æ‰€ç¤º:

```
**./randomuser.graphql**
--------------------------------------------------------------------type User {
  gender: String!
  name: JSON!
  location: JSON!
  email: String!
  login: JSON!
  dob: JSON!
  registered: JSON!
  phone: String!
  cell: String!
  id: JSON!
  picture: JSON!
  nat: String!
}type Query {
  getRandomUser(results: Int!): [User!]!
  @rest(
    endpoint: â€œhttps://randomuser.me/api/?results=$results"
    resultroot: â€œresults[]â€
  )
}
```

> GraphQL è¯­æ³•ä¸­çš„æ„Ÿå¹å·è¡¨ç¤ºä¸å¯ä¸ºç©ºçš„å­—æ®µã€‚å¤§æ‹¬å·è¡¨ç¤ºæˆ‘ä»¬æœŸæœ›ç”¨æˆ·ç±»å‹çš„æ•°ç»„ä½œä¸ºè¯¥æŸ¥è¯¢çš„è¾“å‡ºã€‚

ğŸ’¡æ­£å¦‚æ‰€æ‰¿è¯ºçš„ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•:é€šè¿‡ç®€å•çš„*å¯¼å…¥*ä¸€ä¸ª REST API ç«¯ç‚¹ï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ¨¡å¼ï¼

```
stepzen import curl [https://randomuser.me/api/?results=3](https://randomuser.me/api/?results=3) â€” query-name getRandomUser
```

è¿™å°†ä¸ºæ‚¨åˆ›å»ºä¸€äº›æ–‡ä»¶å’Œæ–‡ä»¶å¤¹â€”æœ€é‡è¦çš„æ˜¯ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„ã€‚curl æ–‡ä»¶å¤¹ä¸­çš„ graphql æ¨¡å¼æ–‡ä»¶ï¼Œå¸¦æœ‰ä¸€ä¸ªåä¸º`getRandomUser`çš„æŸ¥è¯¢ï¼Œå®ƒæ¥å—ä¸€ä¸ªæ•°å­—ä½œä¸ºè¾“å…¥â€”â€”è¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚

ä»…æ­¤è€Œå·²ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†ï¼æ¯”è‡ªå·±ç¼–å†™æ¨¡å¼ç®€å•å¾—å¤šï¼Œè€Œä¸”æ‚¨å¯ä»¥è¿›ä¸€æ­¥å®šåˆ¶è‡ªåŠ¨ç”Ÿæˆçš„æ¨¡å¼ï¼Œä»¥æ›´å¥½åœ°æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚

æˆ–è€…ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ StepZen çš„å·¥å…· [JSON2SDL](https://www.json2sdl.com/) æ¥ä¸ºæ‚¨å¤„ç†æ¨¡å¼åˆ›å»ºã€‚æˆ–è€…ï¼Œç®€å•åœ°ä½¿ç”¨ StepZen ä» [GraphQL Studio](https://graphql.stepzen.com/) ä¸­é¢„å…ˆæ„å»ºçš„æ¨¡å¼ä¹‹ä¸€ã€‚

æœ€åï¼Œå¯¹äºä»»ä½•ç»™å®šçš„é¡¹ç›®ï¼ŒStepZen è¿˜éœ€è¦ä¸€ä¸ªæ¸…å•æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªåä¸º **index.graphql** çš„æ–‡ä»¶ï¼Œå®ƒå°†ä½äºåŒä¸€ä¸ªç›®å½•ä¸­ã€‚å®ƒä½¿ç”¨ç‰¹æ®Šçš„`@sdl`æŒ‡ä»¤ä»æ‰€æœ‰æŒ‡å®šçš„ GraphQL æ–‡ä»¶ä¸­åŠ è½½æ¨¡å¼ã€‚å¦‚ä½ æ‰€æ–™ï¼Œå¦‚æœä½ æœ‰å¤šä¸ª**ã€‚graphql** æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥å°†å®ƒä»¬åŒ…å«åœ¨è¿™ä¸ªæ•°ç»„ä¸­ã€‚

```
**./index.graphql**
--------------------------------------------------------------------schema @sdl(files: [â€œrandomuser.graphqlâ€]){
  query: Query
}
```

## æ­¥éª¤ 2:éƒ¨ç½²åˆ°äº‘

æˆ‘ä»¬å®Œäº†ï¼å¼€å§‹éƒ¨ç½²å§ï¼

```
stepzen start
```

è¿™å°†ä½¿ç”¨æˆ‘ä»¬æŒ‡å®šçš„æ•°æ®æºåˆ›å»ºæˆ‘ä»¬çš„ GraphQL APIï¼Œå¹¶ä¸”â€”â€”å¦‚æœæ²¡æœ‰é”™è¯¯â€”â€”å°†å®ƒéƒ¨ç½²åˆ°äº‘ä¸­ã€‚æ‚¨å°†è¢«è¦æ±‚å‘½åç«¯ç‚¹(CLI æä¾›äº†ä¸€ä¸ªæ‚¨å¯ä»¥æ›´æ”¹çš„é»˜è®¤å€¼)ï¼Œä¸€æ—¦å®Œæˆä¸Šä¼ ï¼Œå®ƒå°†ä¸ºæ‚¨æä¾›æ‚¨çš„ç«¯ç‚¹ URLï¼Œä»¥åŠæ‚¨æ‰˜ç®¡çš„ GraphQL API çš„æœ¬åœ°ä»£ç†(æ‚¨å¯ä»¥ä½¿ç”¨ GraphiQL GUI è¿›è¡Œæµè§ˆ)ã€‚

## æ­¥éª¤ API ä»£ç†æœåŠ¡å™¨

æˆ‘ä»¬ç°åœ¨å¤„äºæœ€åå†²åˆºé˜¶æ®µã€‚å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯åœ¨ **index.js** æ„å»ºæˆ‘ä»¬çš„ Express æœåŠ¡å™¨ï¼Œå®ƒä»£è¡¨æˆ‘ä»¬çš„å‰ç«¯è¿›è¡ŒæŸ¥è¯¢ã€‚

é¦–å…ˆï¼Œä¾èµ–æ€§ã€‚

```
npm i express axios dotenv
```

æˆ‘ä»¬æ­£åœ¨ä¸ºæˆ‘ä»¬çš„æœåŠ¡å™¨è·å– **ExpressJS** ï¼Œè·å– **Axios** æ¥å‘å‡º HTTP è¯·æ±‚ï¼Œè·å– **dotenv** æ¥å­˜å‚¨æˆ‘ä»¬ä¸æƒ³åœ¨æºä»£ç ä¸­å…¬å¼€çš„ç¯å¢ƒå˜é‡â€”â€”æ¯”å¦‚æˆ‘ä»¬çš„æœåŠ¡å™¨ç«¯å£å·ã€StepZen ApiKey å’Œæˆ‘ä»¬çš„ API ç«¯ç‚¹ã€‚(å¦‚æœä½ ä½¿ç”¨çš„æ˜¯åƒ GitHub è¿™æ ·é¢å‘å…¬ä¼—çš„æºä»£ç æ§ä»¶ï¼Œä¸è¦å¿˜è®°åŒ…å«**ã€‚env** æ–‡ä»¶åœ¨æ‚¨çš„**ä¸­ã€‚gitignore** ï¼)

è¯·æ³¨æ„ï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥è®¿é—®ç”¨æˆ·ç±»å‹çš„ä»»ä½•è¿”å›å­—æ®µï¼Œä½†å¯¹äºæˆ‘ä»¬çš„ç”¨ä¾‹ï¼Œæˆ‘ä»¬åªéœ€è¦åç§°å’Œå›¾ç‰‡ URLï¼Œå› æ­¤è¿™å°±æ˜¯æˆ‘ä»¬å°†åœ¨ GraphQL æŸ¥è¯¢ä¸­æŒ‡å®šçš„æ‰€æœ‰å†…å®¹ï¼Œä¸ºæˆ‘ä»¬èŠ‚çœäº†å¤§é‡å¸¦å®½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ GraphQL æŸ¥è¯¢å°†å¦‚ä¸‹æ‰€ç¤º:

```
query MyQuery {
  getRandomUser(results:3){
    name
    picture
  }
}--------------------------------------------------------------------
**./index.js**
--------------------------------------------------------------------const axios = require(â€œaxiosâ€).default;
const express = require(â€œexpressâ€);
require(â€œdotenvâ€).config();
const app = express();// RandomUser resource// for routes like /randomuser?results=3 (params optional)app.get(â€œ/randomuserâ€, async (req, res) => {// GraphQL query (only names & pics)const body = JSON.stringify({
  query: `query MyQuery {
    getRandomUser(results:${req.query.results || 1}){
      name
      picture
    }
  }`,
});// calling our deployed GraphQL APIaxios({
  url: process.env.STEPZEN_GRAPHQL_API,
  method: â€œpostâ€,
    headers: {
      â€œContent-Typeâ€: â€œapplication/jsonâ€,
      â€œContent-lengthâ€: body.length,
      Authorization: â€œApikey â€œ + process.env.STEPZEN_API_KEY,
      â€œUser-Agentâ€: â€œNodeâ€,
    },
  data: body,
}).then((response) => { res.send({
    result: â€œsuccessâ€,
    users: response.data.data.getRandomUser,
  });
});});// no routes matchapp.use((req, res, next) => {
  const error = new Error();
  error.message = â€œNot foundâ€;
  error.status = 404;
  next(error);
});// json error handlerapp.use(async (error, req, res, next) => {
  res.status(404).send({
    result: â€œfailureâ€,
    error: error,
  });
});// create Express.js HTTP serverapp.listen(process.env.PORT || 3000);
```

> è¯·è®°ä½ï¼Œæ ‡å‡†çš„ GraphQL API è°ƒç”¨åº”è¯¥æ˜¯ HTTP POST è¯·æ±‚ï¼Œä½¿ç”¨ application/json å†…å®¹ç±»å‹ï¼Œå¹¶åŒ…å« json ç¼–ç çš„ä¸»ä½“(æˆ‘ä»¬çš„æŸ¥è¯¢)ã€‚

æˆ‘ä»¬éƒ½å®Œæˆäº†ï¼å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ç”¨ cURLã€Postman æˆ–è¯¸å¦‚æ­¤ç±»çš„å·¥å…·æµ‹è¯•å®ƒï¼Œçœ‹çœ‹æˆ‘ä»¬æ˜¯å¦å¾—åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ã€‚

```
**ExpressJS API response to a GET with query params ?results=3**
--------------------------------------------------------------------{
  â€œresultâ€: â€œsuccessâ€,
  â€œusersâ€: [
  {
    â€œnameâ€: {
    â€œfirstâ€: â€œIvanaâ€,
    â€œlastâ€: â€œMorinâ€,
    â€œtitleâ€: â€œMadameâ€
    },â€œpictureâ€: {
  â€œlargeâ€: â€œhttps://randomuser.me/api/portraits/women/29.jpg",
  â€œmediumâ€: â€œhttps://randomuser.me/api/portraits/med/women/29.jpg",
  â€œthumbnailâ€:
    â€œhttps://randomuser.me/api/portraits/thumb/women/29.jpg"
  }
},{
  â€œnameâ€: {
    â€œfirstâ€: â€œMylanâ€,
    â€œlastâ€: â€œOlivierâ€,
    â€œtitleâ€: â€œMrâ€
  },â€œpictureâ€: {
  â€œlargeâ€: â€œhttps://randomuser.me/api/portraits/men/25.jpg",
  â€œmediumâ€: â€œhttps://randomuser.me/api/portraits/med/men/25.jpg",
  â€œthumbnailâ€: â€œhttps://randomuser.me/api/portraits/thumb/men/25.jpg"
}},{
 â€œnameâ€: {
   â€œfirstâ€: â€œJosepâ€,
   â€œlastâ€: â€œGutierrezâ€,
   â€œtitleâ€: â€œMrâ€
  },â€œpictureâ€: {
  â€œlargeâ€: â€œhttps://randomuser.me/api/portraits/men/36.jpg",
  â€œmediumâ€: â€œhttps://randomuser.me/api/portraits/med/men/36.jpg",
  â€œthumbnailâ€:   â€œhttps://randomuser.me/api/portraits/thumb/men/36.jpg"
}}]}
```

å®Œç¾ã€‚å¯¹äºä¸ºå‰ç«¯è®¾è®¡ç”Ÿæˆå¿«é€Ÿå’Œè‚®è„çš„æ¨¡å‹ï¼Œè¿™å°†å·¥ä½œå¾—å¾ˆå¥½ã€‚

# ä¸¤å…¨å…¶ç¾

GraphQL éå¸¸å¼ºå¤§å’Œçµæ´»ï¼ŒStepZen å‡­å€Ÿå…¶å¼ºå¤§çš„ CLI å·¥å…·ã€ä¸°å¯Œçš„ç‰¹æ€§ã€é’ˆå¯¹å¤§é‡æ•°æ®æºçš„é¢„åˆ¶æ¨¡å¼å’Œä¸°å¯Œçš„æ–‡æ¡£ï¼Œä½¿å¾—å®ç° GraphQL å˜å¾—éå¸¸å®¹æ˜“ï¼Œå¹¶ä¸”å¯ä»¥æ»¡è¶³æ‚¨çš„æ‰€æœ‰å¼€å‘éœ€æ±‚ã€‚

StepZen çš„ GraphQL-as-a-service æ¨¡å‹æ— ç–‘æ˜¯ä¸€ä¸ªé¢å¤–çš„æŠ½è±¡å±‚ï¼Œä½†ç”±äº StepZen ä»æ‚¨(æˆ–æ‚¨çš„ç»„ç»‡çš„å¼€å‘äººå‘˜)çš„è§’åº¦å‡ºå‘ï¼Œè´Ÿè´£å¼€ç®±å³ç”¨ï¼Œæ‰€ä»¥æ‚¨æ‰€åšçš„åªæ˜¯å®šä¹‰æ•°æ®çš„æ¨¡å¼ï¼Œæè¿°æ‚¨éœ€è¦çš„ API å’Œ DB è°ƒç”¨ï¼Œç„¶åæŒ‡å¯¼å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜ç®€å•åœ°è°ƒç”¨é›†ä¸­å¼ StepZen GraphQL ç«¯ç‚¹ã€‚

æ€»è€Œè¨€ä¹‹ï¼ŒStepZen è®©å¼€å‘è€…â€”â€”æ— è®ºæ˜¯å‰ç«¯è¿˜æ˜¯åç«¯â€” *å’Œ*ç”¨æˆ·çš„ç”Ÿæ´»å˜å¾—ç®€å•å¤šäº†ï¼Œå› ä¸ºä»–ä»¬å¯ä»¥æ›´å¿«åœ°è·å¾—æ›´å¤šæ•°æ®ã€‚

*åŸè´´äº*[***plain English . io***](https://plainenglish.io/blog/how-to-migrate-rest-api-to-graphql-with-stepzen)*ã€‚*