<html>
<head>
<title>Build a Twitter Followers Counter using Next.js, NextAuth and Tailwind</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Next.js、NextAuth和Tailwind创建一个Twitter关注者计数器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-a-twitter-followers-counter-using-next-js-nextauth-and-tailwind-dc8a99152af5?source=collection_archive---------5-----------------------#2022-01-04">https://javascript.plainenglish.io/build-a-twitter-followers-counter-using-next-js-nextauth-and-tailwind-dc8a99152af5?source=collection_archive---------5-----------------------#2022-01-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="0b66" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用Next.js、NextAuth、SWR、支持黑暗模式的Tailwind构建Twitter追随者计数器的步骤</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/379c9e53a11ef521f398271fb232ef78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u4ow4NJV8jfHP1cEej0LIA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">TwiterStats Placeholder</figcaption></figure><p id="31db" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要学习新东西，仅仅阅读文档是不够的。我们应该实际应用它。同样，在学习新技术时，我们应该通过开发简单的应用程序来应用它们，以获得实践经验。</p><p id="3edb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了学习一些新的技术，让我们构建一个小的应用程序。在这里，我们将通过开发一个Twitter关注者计数器应用程序来学习<a class="ae ky" href="https://nextjs.org/docs/getting-started" rel="noopener ugc nofollow" target="_blank"> Next.js </a>、<a class="ae ky" href="https://next-auth.js.org/getting-started/introduction" rel="noopener ugc nofollow" target="_blank"> NextAuth </a>、<a class="ae ky" href="https://swr.vercel.app/docs/getting-started" rel="noopener ugc nofollow" target="_blank"> SWR </a>和<a class="ae ky" href="https://tailwindcss.com/" rel="noopener ugc nofollow" target="_blank"> Tailwind </a> CSS。</p><p id="e92f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将建立一个类似于<a class="ae ky" href="https://twiter-stats.vercel.app" rel="noopener ugc nofollow" target="_blank"> TwiterStats </a>的应用程序。</p><h1 id="9109" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">技术堆栈</h1><ol class=""><li id="d07c" class="lx ly in jm b jn lz jr ma jv mb jz mc kd md kh me mf mg mh bi translated">Next.js用于构建ReactJS应用程序。</li><li id="7a6e" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">用Twitter实现OAuth的NextAuth。</li><li id="ab1c" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">用于从API获取数据的SWR。</li><li id="efb2" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">UI的顺风</li><li id="bcf7" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated"><a class="ae ky" href="https://github.com/draftbit/twitter-lite" rel="noopener ugc nofollow" target="_blank"> Twitter Lite </a>用于从Twitter APIs获取数据。</li></ol><h1 id="c97a" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">Next.js和顺风设置</h1><p id="c897" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">我们可以使用一个命令用next.js设置tailwind，如下所示:</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="d57c" class="mv la in mr b gy mw mx l my mz">npx create-next-app -e with-tailwindcss twitter-count</span></pre><p id="742f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上面的命令基于官方的Next.js示例自动配置顺风设置。</p><p id="4e09" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安装完成后，使用<code class="fe na nb nc mr b">cd twitter-count</code>导航到您的项目文件夹，并使用<code class="fe na nb nc mr b">yarn dev</code>命令启动开发服务器。如果你在浏览器中点击<code class="fe na nb nc mr b">http://localhost:3000</code>，你会看到下面的页面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/a98f3cb8b87f5787a4dd3d69634911d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*idDxpdAGrAXvxIcjROiNkA.png"/></div></div></figure><h1 id="6ac1" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">配置NextAuth.js</h1><h2 id="f46c" class="mv la in bd lb ne nf dn lf ng nh dp lj jv ni nj ln jz nk nl lr kd nm nn lv no bi translated">什么是NextAuth？</h2><p id="fd5a" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated"><a class="ae ky" href="https://next-auth.js.org/" rel="noopener ugc nofollow" target="_blank"> NextAuth </a>是Next.js的开源认证包，NextAuth简化了Twitter、Google、Apple、Github等社交认证登录。它还支持电子邮件或无密码登录和数据库集成。</p><p id="aad8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用下面的命令将<code class="fe na nb nc mr b">next auth</code>添加到您的项目中</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="a913" class="mv la in mr b gy mw mx l my mz">yarn add next-auth</span></pre><p id="1f2f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，在<code class="fe na nb nc mr b">pages/api/auth</code>文件夹中创建一个名为<code class="fe na nb nc mr b">[…nextauth].js</code>的文件，并添加以下代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="938c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们分解上面的代码</p><p id="91b0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上面的NextAuth函数处理所有社交认证的动态路由。这里我们将使用Twitter OAuth，所以我们在providers中添加了<strong class="jm io">twiterprovider</strong>。为了执行成功的OAuth，我们需要<strong class="jm io"> TWITTER_ID </strong>和<strong class="jm io"> TWITTER_SECRET </strong>，通过几个简单的步骤从<a class="ae ky" href="https://developer.twitter.com/en" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> Twitter开发者平台</strong> </a>获取它们。</p><p id="206e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">按照这个<a class="ae ky" href="https://developer.twitter.com/en/docs/twitter-api/getting-started/getting-access-to-the-twitter-api" rel="noopener ugc nofollow" target="_blank">链接</a>中的步骤获得Twitter API访问权限。</p><p id="19e8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从开发者门户获取秘密后，如上所述在<strong class="jm io"> env </strong>中更新并添加到<strong class="jm io">提供者</strong>中。</p><p id="3b76" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在与Twitter的OAuth成功后，使用<strong class="jm io">回调</strong>在会话中设置所需的数据。在成功的OAuth上，我们从Twitter获得许多细节，在这里我们将定制我们需要的数据并保存在会话中。</p><p id="3a26" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们不应该将诸如<code class="fe na nb nc mr b">authToken</code>和<code class="fe na nb nc mr b">authSecret</code>这样的秘密暴露给客户端，所以我们将它们保存在JWT令牌对象中。然后我们可以使用<code class="fe na nb nc mr b">getToken</code>助手方法在服务器端访问用户凭证。</p><p id="d08f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe na nb nc mr b"><strong class="jm io">secret</strong></code>用于散列令牌、签名或加密cookies以及生成密钥的随机字符串。</p><h1 id="b94f" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">配置会话提供程序</h1><p id="9207" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">扭曲顶层组件的<code class="fe na nb nc mr b">SessionProvier</code>上下文，使用<code class="fe na nb nc mr b">useSession</code>钩子获取子组件中的会话数据，如下所示</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="6a01" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe na nb nc mr b"><strong class="jm io">refetchInterval</strong></code>用于在后台定期获取会话。</p><p id="832f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我们的应用程序中，<code class="fe na nb nc mr b">_app.js</code>是顶层组件，所以我们已经包装了会话提供者。这里我们包装了来自<a class="ae ky" href="https://github.com/pacocoursey/next-themes" rel="noopener ugc nofollow" target="_blank"> next-theme </a>的ThemeProvide上下文，以启用黑暗模式支持。</p><h1 id="0cd0" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">追随者计数器组件</h1><p id="057b" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">在Followers组件中添加以下代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><h1 id="4b96" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">分解追随者组件</h1><h2 id="d5f7" class="mv la in bd lb ne nf dn lf ng nh dp lj jv ni nj ln jz nk nl lr kd nm nn lv no bi translated">什么是SWR？</h2><p id="4f54" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">SWR是Next.js团队开发的一个用于数据获取的React钩子。它支持实时数据提取、内置缓存、自动重新验证、预取等等。</p><p id="614d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在followers组件中，我们调用了<code class="fe na nb nc mr b">/api/twitter/user</code> API来获取Twitter用户的基本信息，比如姓名、关注者数量、个人资料描述和位置。我们使用SWR在一段时间内从API获取数据。</p><p id="da3d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因为我们从NextOAuth获得的数据不是实时数据。因此，我们使用<strong class="jm io"> Twitter Lite </strong> API来实时获取Twitter用户的详细信息。</p><h1 id="9e19" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">Twitter Lite集成</h1><p id="da1e" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">Twitter Lite是一个小巧、功能全面、灵活的Twitter APIs服务器库。</p><p id="8737" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在Next.js中，你也可以构建API，<code class="fe na nb nc mr b">api/*</code>中的文件被认为是API端点。它们在服务器上处理，而不是在客户端。Twitter APIs只能从服务器端访问，所以我们在<code class="fe na nb nc mr b">api/</code>文件夹中有一个用户API来使用Twitter lite包访问show API。</p><p id="23a9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">添加下面的代码<code class="fe na nb nc mr b">pages/api/twitter/user.js</code>，使用<code class="fe na nb nc mr b">/api/twitter/user</code> API访问用户详细信息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="318f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如下所示，在<code class="fe na nb nc mr b">index.js</code>文件中添加追随者组件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="e36c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里我们使用<code class="fe na nb nc mr b">signIn</code>和<code class="fe na nb nc mr b">signOut</code>来自<code class="fe na nb nc mr b">next-auth</code>的方法来启动OAuth登录。要使用Twitter登录，我们将Twitter参数传递给登录方法，如下所示</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="7e65" class="mv la in mr b gy mw mx l my mz">signIn('twitter');</span></pre><p id="6086" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在只需点击浏览器中的URL，就可以看到如下的变化</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5d2504e97606eb538bdb5efed97cfe14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5yaaG89i6V59GDMdozsh3Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Login</figcaption></figure><p id="9dc0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在调用<code class="fe na nb nc mr b"><strong class="jm io">signIn</strong></code>方法时，应用将被重定向到Twitter OAuth页面，单击OAuth页面上的<strong class="jm io">授权应用</strong>按钮将重定向回我们的followers组件，如下图所示。</p><blockquote class="nr ns nt"><p id="934e" class="jk jl nu jm b jn jo jp jq jr js jt ju nv jw jx jy nw ka kb kc nx ke kf kg kh ig bi translated">注册时，我们需要在Twitter开发人员门户中配置OAuth重定向URL。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/379c9e53a11ef521f398271fb232ef78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u4ow4NJV8jfHP1cEej0LIA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Counter Component</figcaption></figure><p id="f12f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以根据自己的需要定制UI，这里我只介绍了集成部分，以及使用tailwind的基本UI。</p><h1 id="f0d1" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">在韦尔塞尔部署</h1><p id="00c8" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">您可以通过以下两步在Vercel中部署您的计数器应用程序:</p><ol class=""><li id="3924" class="lx ly in jm b jn jo jr js jv ny jz nz kd oa kh me mf mg mh bi translated">创建一个<a class="ae ky" href="https://vercel.com/signup" rel="noopener ugc nofollow" target="_blank"> Vercel账户</a></li><li id="5dad" class="lx ly in jm b jn mi jr mj jv mk jz ml kd mm kh me mf mg mh bi translated">连接您的存储库，然后单击部署。</li></ol><h1 id="acd9" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">链接</h1><p id="420a" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated"><strong class="jm io"> GitHub回购</strong>-&gt;<a class="ae ky" href="https://github.com/Nilanth/twiter-stats" rel="noopener ugc nofollow" target="_blank">https://github.com/Nilanth/twiter-stats</a></p><p id="a260" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">现场演示</strong>-&gt;<a class="ae ky" href="https://twiter-stats.vercel.app/" rel="noopener ugc nofollow" target="_blank">https://twiter-stats . vercel . app</a></p><h1 id="5000" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">结论</h1><p id="e48f" class="pw-post-body-paragraph jk jl in jm b jn lz jp jq jr ma jt ju jv mn jx jy jz mo kb kc kd mp kf kg kh ig bi translated">我们已经成功地将Twitter与NextAuth集成在一起，并使用Next和tailwind显示了关注者的数量。我们现在已经有了使用这些技术的实际经验。</p><p id="d116" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">感谢您的阅读。</p><p id="a96c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="nu">更多内容看</em> <a class="ae ky" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="nu">说白了。报名参加我们的</em> </a><a class="ae ky" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="nu">免费每周简讯</em> </a> <em class="nu">。在我们的</em> <a class="ae ky" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <em class="nu">社区</em> </a> <em class="nu">获得独家写作机会和建议。</em></p></div></div>    
</body>
</html>