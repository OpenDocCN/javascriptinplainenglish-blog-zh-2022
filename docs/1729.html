<html>
<head>
<title>React Virtual DOM and Reconciliation — Explained Like I’m Five</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应虚拟DOM和和解——像我五岁时那样解释</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-virtual-dom-and-reconciliation-explained-like-im-five-6e4670ffc847?source=collection_archive---------7-----------------------#2022-04-14">https://javascript.plainenglish.io/react-virtual-dom-and-reconciliation-explained-like-im-five-6e4670ffc847?source=collection_archive---------7-----------------------#2022-04-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="3b0f" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">理解React的虚拟DOM和协调概念。</h2></div><h1 id="2746" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">什么是DOM？</h1><p id="17cc" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">DOM代表文档对象模型。<code class="fe lq lr ls lt b">HTML</code>是网页的语言。它为web页面结构提供了许多专门的标签，包括将多个页面链接在一起的方式。网页的结构表现为树形结构<code class="fe lq lr ls lt b">document object</code>。JavaScript编程语言可以改变这个文档对象的结构，为网页带来动态行为。</p><p id="4187" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated"><code class="fe lq lr ls lt b">DOM</code>(文档对象模型)是树形结构网页文档的编程接口。文档树被称为<code class="fe lq lr ls lt b">DOM Tree</code>。</p><p id="dfb6" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated">我们用一个简单的例子来理解一下。下面是一个HTML代码片段，目的是显示网页的标题和网页正文中的一些信息。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi lz"><img src="../Images/afd9525b18fca2c28bc48b7e27e64fc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GwnBsF_-0uPqsh9_"/></div></div></figure><p id="75bb" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated">如果我们将上面的代码片段表示为一个文档树，它将看起来像这样。每个HTML元素代表树中的一个<code class="fe lq lr ls lt b">node</code>。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ml"><img src="../Images/03787dad13cca3805a51bdde8ae5d062.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*okmtKWxrIgd2FVQf"/></div></div></figure><p id="0436" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated">当它呈现在网页上时，我们可以看到这样的信息，</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/0616efa72bfa51f23c7e2b145062e79c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/0*5SntOUc5yh_gnLzW"/></div></figure><p id="1579" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated">现在，如果我们必须改变段落的文本(<code class="fe lq lr ls lt b">&lt;p&gt;</code>标签)，我们将需要能够从文档树中找到<code class="fe lq lr ls lt b">&lt;p&gt;</code>标签，然后为它设置一个新的文本值。我们必须使用JavaScript DOM APIs来完成所有这些工作。</p><pre class="ma mb mc md gt mn lt mo mp aw mq bi"><span id="7b7e" class="mr kd in lt b gy ms mt l mu mv">const paragraph = document.querySelector("p"); paragraph.innerText = 'Some other text!';</span></pre><p id="4317" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated">在文档树中寻找特定节点的机制称为<code class="fe lq lr ls lt b">Querying the DOM</code>。在文档树中添加新节点、删除节点或更新节点称为<code class="fe lq lr ls lt b">DOM Manipulation</code>。DOM操作的结果反映在web用户界面上。这个过程叫做<code class="fe lq lr ls lt b">rendering</code>。</p><h1 id="7319" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">DOM操作代价很高</h1><p id="196b" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">频繁更新<code class="fe lq lr ls lt b">DOM</code>成本高昂。这可能会降低网页的性能，使其变慢。因为DOM是用树结构表示的，所以查询和更新通常比渲染要快。然而，如果我们不得不遍历DOM树的很大一部分来找到要更新的节点，这也可能是很昂贵的。</p><p id="4ea9" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated">让我们看看下面的雇员表，该表显示了雇员的姓名以及该雇员是否已婚。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mw"><img src="../Images/9b035cdb48bcc12b88db841072a0e2f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PGHKiXrcI_ewrJTR"/></div></div></figure><p id="8cf8" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated">如果我们每次都必须遍历这个表的文档树表示来进行更新，那么DOM操作的成本会很高。</p><h1 id="968a" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">React中的虚拟DOM和协调</h1><p id="649b" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">反应过来是<code class="fe lq lr ls lt b">declarative</code>。这意味着React从开发人员那里抽象出许多底层操作，比如DOM操作。因此，React还确保额外注意解决由于频繁的DOM操作和呈现而可能出现的性能问题。</p><p id="2f97" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated">React从不直接更新<code class="fe lq lr ls lt b">original DOM</code>(除非开发人员用例需要)。在React中，对于每个DOM对象，都会创建一个相应的内存副本。这个副本被称为<code class="fe lq lr ls lt b">Virtual DOM</code> (VDOM)。</p><p id="6777" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated">在<code class="fe lq lr ls lt b">Virtual DOM</code>树中，每个元素由一个节点表示。每当元素的状态改变时，都会创建一个新的虚拟DOM树。React的diffing算法会将当前的虚拟DOM树与其以前的版本进行比较。最后，虚拟DOM使用该算法用diff更新实际DOM。</p><p id="78bc" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated">下面的动画图像解释了虚拟DOM是如何作为原始DOM的副本创建的，以及差异和更新是如何发生的。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mx"><img src="../Images/f35e49887b2983508ef8d75f93a9b106.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*h6ADDv1bYskIrb--RlK1Pw.gif"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">How Virtual DOM works — Learn visually</figcaption></figure><p id="5dd1" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated"><em class="nc">请</em> <a class="ae nd" href="https://res.cloudinary.com/atapas/image/upload/v1649655587/demos/vdom_idrwtz.gif" rel="noopener ugc nofollow" target="_blank"> <em class="nc">点击此链接</em> </a> <em class="nc">如果您没有看到上面的动画图像</em></p><ul class=""><li id="1a42" class="ne nf in kw b kx lu la lv ld ng lh nh ll ni lp nj nk nl nm bi translated">首先，React创建原始DOM的副本，称之为虚拟DOM。虚拟DOM的每个节点代表一个元素。</li><li id="fd70" class="ne nf in kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">接下来，如果有一个元素的状态更新，就会创建一个新的虚拟DOM。</li><li id="9a77" class="ne nf in kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">差分算法识别变化中的差异。在这种情况下，来自已更改节点的子树被标识为diff。</li><li id="5132" class="ne nf in kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">最后，React运行批处理更新，用这些更改更新原始DOM，以保持同步。</li></ul><p id="cfb6" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated">通过区分不同的树来确定哪些部分需要更改，然后用它来更新原始DOM的机制被称为<code class="fe lq lr ls lt b">Reconciliation</code>。你可以在这里了解<a class="ae nd" href="https://reactjs.org/docs/reconciliation.html" rel="noopener ugc nofollow" target="_blank">和解。React使用了一个名为【16.0版本的新协调引擎。你可以点击</a>了解更多关于<a class="ae nd" href="https://github.com/acdlite/react-fiber-architecture" rel="noopener ugc nofollow" target="_blank"> React光纤架构的信息。</a></p><p id="a998" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated">就是这样。我希望虚拟DOM和调和的初学者友好解释对你有所帮助。</p><h1 id="8ae5" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">结论</h1><p id="0855" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">作为<code class="fe lq lr ls lt b">React</code>的初学者，你不需要知道虚拟DOM是如何工作的，差异是如何发生的，什么是批量更新等等。但是如果你有兴趣知道React如何处理应用程序性能和其他概念，如记忆，你必须花一些时间理解虚拟DOM和渲染的概念。</p><p id="1c79" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated">此外，不管你喜不喜欢，虚拟DOM和渲染对你的面试官来说可能是一个令人兴奋的话题😉！所以，最好意识到这一点。</p><p id="ffb0" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated">如果您有兴趣从视频教程中进一步了解虚拟DOM、协调、区分和批量更新，请查看以下内容:</p><figure class="ma mb mc md gt me"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h1 id="ec7d" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">在我们结束之前…</h1><p id="2ba2" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">我分享我的知识，</p><ul class=""><li id="4e2f" class="ne nf in kw b kx lu la lv ld ng lh nh ll ni lp nj nk nl nm bi translated">🌐Web开发(JavaScript、React、Next.js、Node.js等等……)</li><li id="9a16" class="ne nf in kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">🛡️网络安全公司</li><li id="2bd2" class="ne nf in kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">💼职业发展</li><li id="1e3e" class="ne nf in kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">🌱开源</li><li id="e207" class="ne nf in kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">✍️内容创作</li></ul><p id="1b88" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated">让我们连接起来，</p><ul class=""><li id="b618" class="ne nf in kw b kx lu la lv ld ng lh nh ll ni lp nj nk nl nm bi translated"><a class="ae nd" href="https://twitter.com/tapasadhikary" rel="noopener ugc nofollow" target="_blank">在Twitter上关注</a></li><li id="c02b" class="ne nf in kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated"><a class="ae nd" href="https://www.youtube.com/tapasadhikary?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank">订阅我的YouTube频道</a></li><li id="5140" class="ne nf in kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated"><a class="ae nd" href="https://github.com/atapas" rel="noopener ugc nofollow" target="_blank">GitHub上的附带项目</a></li><li id="88c7" class="ne nf in kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated"><a class="ae nd" href="https://www.showwcase.com/community/react.js" rel="noopener ugc nofollow" target="_blank">展示React社区</a></li></ul></div><div class="ab cl nu nv hr nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ig ih ii ij ik"><p id="639d" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated"><em class="nc">最初发布于</em><a class="ae nd" href="https://blog.greenroots.info/reactjs-virtual-dom-and-reconciliation-explain-like-im-five" rel="noopener ugc nofollow" target="_blank"><em class="nc">https://blog . greenroots . info</em></a><em class="nc">。</em></p><p id="f621" class="pw-post-body-paragraph ku kv in kw b kx lu jo kz la lv jr lc ld lw lf lg lh lx lj lk ll ly ln lo lp ig bi translated"><em class="nc">更多内容请看</em> <a class="ae nd" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw io"> <em class="nc">说白了就是</em> </strong> </a> <em class="nc">。报名参加我们的</em> <a class="ae nd" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw io"> <em class="nc">免费每周简讯</em> </strong> </a> <em class="nc">。关注我们</em><a class="ae nd" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kw io"><em class="nc">Twitter</em></strong></a><em class="nc">和</em><a class="ae nd" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kw io"><em class="nc">LinkedIn</em></strong></a><em class="nc">。加入我们的</em> <a class="ae nd" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kw io"> <em class="nc">社区不和谐</em> </strong> </a> <em class="nc">。</em></p></div></div>    
</body>
</html>