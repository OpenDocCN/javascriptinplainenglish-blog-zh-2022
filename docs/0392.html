<html>
<head>
<title>React 18 Suspense Minimal Example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应18悬念最小的例子</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-18-suspense-minimal-example-775f786ba24?source=collection_archive---------1-----------------------#2022-01-23">https://javascript.plainenglish.io/react-18-suspense-minimal-example-775f786ba24?source=collection_archive---------1-----------------------#2022-01-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/83d7997fe5d1137b6a50abc7cf03fda8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7fJ68lmnebwn7jHhygONWg.png"/></div></div></figure><p id="52a9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在React的当前版本中(<code class="fe kt ku kv kw b">17.0.2</code>在本文创建时)，<code class="fe kt ku kv kw b">Suspense</code>是一个组件，它允许开发人员延迟加载应用程序部分。它接受<code class="fe kt ku kv kw b">fallback</code>属性，并显示内容，而子组件是延迟加载的。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi kx"><img src="../Images/262d240d6a9781f7577fb1b83b646d30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o0dDiRBK9SWqlifdnl_7KQ.png"/></div></div></figure><p id="8261" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然而，从React 18开始，将有可能使用<code class="fe kt ku kv kw b">Suspense</code>获取数据。这意味着,<code class="fe kt ku kv kw b">fallback</code>将一直显示，直到组件获取所有需要的数据。或者一般来说，组件预期的所有事件都会发生。假设我们只想显示占位符2秒钟:</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lc"><img src="../Images/93a02d7c89517dfe4a25126abc98be7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m6t6gEpXunPDqJnz_uWrcg.png"/></div></div></figure><p id="33d7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如你所料，<code class="fe kt ku kv kw b">Loading...</code>将显示2秒钟，然后显示<code class="fe kt ku kv kw b">Component loaded</code>。</p><p id="5c1f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然而，当我第一次看到上面的代码时，我不明白<em class="ld">怎么会这样...<code class="fe kt ku kv kw b">useTimeout</code>挂钩的神奇机制是什么？简言之，它必须:</em></p><ol class=""><li id="db73" class="le lf in jx b jy jz kc kd kg lg kk lh ko li ks lj lk ll lm bi translated">停止组件代码执行。</li><li id="e060" class="le lf in jx b jy ln kc lo kg lp kk lq ko lr ks lj lk ll lm bi translated">让<code class="fe kt ku kv kw b">Suspense</code>知道组件还没有准备好</li><li id="71f5" class="le lf in jx b jy ln kc lo kg lp kk lq ko lr ks lj lk ll lm bi translated">通知<code class="fe kt ku kv kw b">Suspence</code>何时应该重新尝试渲染组件。</li></ol><p id="ef5a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要停止代码执行，您需要使用<code class="fe kt ku kv kw b">throw</code>语句。为了让<code class="fe kt ku kv kw b">Suspense</code>知道它是预期的，抛出的值需要是一个<code class="fe kt ku kv kw b">Promise</code>。<code class="fe kt ku kv kw b">Suspense</code>会抓住这个承诺并订阅它，重新尝试渲染。请注意:下面的代码只是为了演示:</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi kx"><img src="../Images/1e995e6ed6de26f5d9894c2d48491147.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zwgCh4yVDduN97Wj0Eg78g.png"/></div></div></figure><p id="12e3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ld">(一头雾水</em> <code class="fe kt ku kv kw b"><em class="ld">||=</em></code> <em class="ld">？查看</em> <a class="ae ls" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_OR_assignment" rel="noopener ugc nofollow" target="_blank"> <em class="ld">本文档</em> </a> <em class="ld"> ) </em></p><p id="2af7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">事实证明，悬念使用了非常简单的机制，但有一个困难的部分。你可能会问为什么<code class="fe kt ku kv kw b">fullfilled</code>和<code class="fe kt ku kv kw b">promise</code>不能存储在ref中，这样钩子就可以重用了:</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lc"><img src="../Images/659c623cc7bfeb99680f0900d57b5ef4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ACYEYfqA6J8llGgbGKtSdA.png"/></div></div></figure><p id="cecc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">事实证明，当组件没有被加载时，钩子不能被真正使用。在渲染完成之前，组件将在每次渲染尝试时被卸载/装载，而不会抛出承诺。因此，为了弄清楚，如果这个组件实际上已经开始了数据加载过程，我们应该依赖一个全局可用的缓存。(在我们简化的例子中，它只是<code class="fe kt ku kv kw b">fullfilled</code>变量)。当然，在现实世界的例子中，这种简单的方法是行不通的(这个钩子只工作一次)。</p><p id="7342" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这就是为什么建议使用支持悬念的好库(比如<a class="ae ls" href="https://swr.vercel.app/" rel="noopener ugc nofollow" target="_blank"> SWR </a>)。</p><p id="2353" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae ls" href="https://codesandbox.io/s/suspense-timeout-example-4g7rh" rel="noopener ugc nofollow" target="_blank">上面例子的全部代码</a>。</p><p id="7093" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi">👋</p><p id="0290" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ld">更多内容看</em> <a class="ae ls" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="ld">说白了就是</em> </strong> </a> <em class="ld">。报名参加我们的</em> <a class="ae ls" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="ld">免费周报</em> </strong> </a> <em class="ld">。在我们的</em> <a class="ae ls" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="ld">社区获得独家访问写作机会和建议</em> </strong> </a> <em class="ld">。</em></p></div></div>    
</body>
</html>