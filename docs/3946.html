<html>
<head>
<title>Build Your Own Reactive System like Vue.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">像Vue.js一样建立自己的反应系统</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-your-own-reactive-system-like-vue-js-33d02ce38bd2?source=collection_archive---------6-----------------------#2022-10-12">https://javascript.plainenglish.io/build-your-own-reactive-system-like-vue-js-33d02ce38bd2?source=collection_archive---------6-----------------------#2022-10-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="c5d9" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">一个简单的例子，使用普通的JavaScript创建你自己的反应系统，比如VueJS</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/49e978256ebc671994b69406c824796b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V0Lr-OoJNrsN4bz2A1WuEA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Vue Reactivity</figcaption></figure><p id="1777" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">整个Vue生态系统最显著的特征之一是Vue的高反应性。它简化了开发人员的状态管理，使他们的生活更加轻松。作为一名开发人员，你不需要担心当你的应用程序状态改变时更新视图，因为Vue在后台处理得很好。</p><p id="733d" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">通过一个非常基本的例子，我们将在本文中尝试构建一个小的反应式系统，利用Vue使用的相同技术使其组件状态反应。</p><h2 id="881a" class="lo lp in bd lq lr ls dn lt lu lv dp lw lb lx ly lz lf ma mb mc lj md me mf mg bi translated">什么是反应性？</h2><p id="b1e7" class="pw-post-body-paragraph ks kt in ku b kv mh jo kx ky mi jr la lb mj ld le lf mk lh li lj ml ll lm ln ig bi translated">反应性简单地描述了应用程序状态的变化，这种变化是由对它的一个依赖对象或属性的修改引起的。让我们用一个例子来更好地把握这一点。</p><p id="da86" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">如果我们看下面的JavaScript代码并执行它。</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="b7ec" class="lo lp in mn b gy mr ms l mt mu">let firstname = 'Code';<br/>let fullname = firstname + ' Ceeker';</span><span id="63cc" class="lo lp in mn b gy mv ms l mt mu">console.log(fullname);</span></pre><p id="e363" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们将得到下面的输出。</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="514d" class="lo lp in mn b gy mr ms l mt mu">Output: <strong class="mn io">Code Ceeker</strong></span></pre><p id="fd2b" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">上面的输出没有什么令人惊讶的，因为这是上面的代码所预期的。</p><p id="634d" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在，让我们尝试更新代码以输出修改后的<code class="fe mw mx my mn b">firstnam</code>。</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="5fd6" class="lo lp in mn b gy mr ms l mt mu">let firstname = 'Code';<br/>let fullname = firstname + ' Ceeker';</span><span id="5144" class="lo lp in mn b gy mv ms l mt mu">console.log(fullname);</span><span id="95b1" class="lo lp in mn b gy mv ms l mt mu">firstname <strong class="mn io">= 'Modified Code';<br/>console.log(fullname);</strong></span></pre><p id="47ab" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">产量是多少？</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="d839" class="lo lp in mn b gy mr ms l mt mu">Output: <strong class="mn io">Code Ceeker<br/>        Code Ceeker</strong></span></pre><p id="d54b" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">它仍然是一样的，这是正确的，因为我们没有用修改后的<code class="fe mw mx my mn b"><strong class="ku io">firstname</strong></code>重新计算<code class="fe mw mx my mn b"><strong class="ku io">fullname </strong></code>。我们只是在修改<code class="fe mw mx my mn b"><strong class="ku io">firstname</strong></code>的值。而且，我们知道，默认情况下JavaScript不是反应式的，因此上面的代码也不是。</p><p id="316a" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><strong class="ku io">这里我们实际需要的是当我们给</strong> <code class="fe mw mx my mn b"><strong class="ku io">firstname</strong></code> <strong class="ku io">赋一个新值的时候，它也应该在</strong> <code class="fe mw mx my mn b"><strong class="ku io">fullname</strong></code> <strong class="ku io">中得到反映。这就是反应性的含义。</strong></p><p id="3357" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">如果这是在Vue中编码的，那么由于Vue的反应系统，我们将得到作为'<strong class="ku io">修改代码Ceeker </strong>'的输出。这也不需要重新计算<code class="fe mw mx my mn b"><strong class="ku io">fullname </strong></code>。</p><p id="8ce6" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><strong class="ku io"> <em class="mz">那么我们可以用普通的JavaScript让上面的代码反应吗？</em> </strong></p><p id="6134" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">是的，我们可以通过使用Vue在幕后使用的相同方法使上面的代码具有反应性。</p></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><h2 id="a294" class="lo lp in bd lq lr ls dn lt lu lv dp lw lb lx ly lz lf ma mb mc lj md me mf mg bi translated">如何让代码具有反应性？</h2><p id="a929" class="pw-post-body-paragraph ks kt in ku b kv mh jo kx ky mi jr la lb mj ld le lf mk lh li lj ml ll lm ln ig bi translated">在JavaScript中，有一个名为<strong class="ku io"> Proxy </strong>的内置特性，Vue利用它来包装您的属性，并在您为其赋值时得到通知。想了解更多关于代理的细节，请点击<a class="ae nh" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="147c" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">因此，每当一个新值被赋给一个属性时，Vue就会意识到这一点，并更新它所有的引用。</p><p id="0cc6" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们将在这里尝试使用相同的技术，通过使用一个<strong class="ku io">代理</strong>，使上面的普通JavaScript代码具有反应性。</p><p id="0cfa" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">首先，让我们创建一个具有所需属性的对象。</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="d0b8" class="lo lp in mn b gy mr ms l mt mu">const <strong class="mn io">data </strong>= {<br/> firstname: 'Code',<br/> fullname: 'Ceeker'<br/>};</span></pre><p id="8d48" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">为了给<strong class="ku io">数据对象</strong>增加反应性，我们用一个<strong class="ku io">代理对象</strong>包装该数据对象。</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="e3cf" class="lo lp in mn b gy mr ms l mt mu">const proxy = new <strong class="mn io">Proxy</strong>(<strong class="mn io">data</strong>, <strong class="mn io">handler</strong>);</span></pre><blockquote class="ni nj nk"><p id="e45d" class="ks kt mz ku b kv kw jo kx ky kz jr la nl lc ld le nm lg lh li nn lk ll lm ln ig bi translated">以上是现代JavaScript中内置的构造函数，所以请确保你是在chrome这样的现代浏览器上运行这段代码。</p></blockquote><p id="ce94" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">您可能对<strong class="ku io">代理构造函数</strong>中传递的<strong class="ku io">第二个参数(即处理程序)</strong>感到疑惑。</p><p id="07f8" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这是<strong class="ku io">处理程序对象</strong>，它提供代理支持的某些<strong class="ku io">特性，如陷阱</strong>。例如，通过在处理程序中添加一个<strong class="ku io">设置函数</strong>来设置陷阱。</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="c5c9" class="lo lp in mn b gy mr ms l mt mu">const handler = {<br/> <strong class="mn io">set(target, key, value)</strong> {<br/> }<br/>}</span></pre><p id="8d7e" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><strong class="ku io">在处理程序中，从代理构造函数自动接收set函数的目标、键和值参数。</strong></p><p id="ff5d" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">为了理解它的作用，让我们在控制台记录目标、键和值的值。</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="464c" class="lo lp in mn b gy mr ms l mt mu">const handler = {<br/> set(target, key, value) {<br/>  <strong class="mn io">console.log(target);<br/>  console.log(key);<br/>  console.log(value);</strong><br/> }<br/>}</span></pre><p id="5740" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">此外，由于<strong class="ku io">代理</strong>对象包装了<strong class="ku io">数据</strong>对象，我们可以使用代理对象访问数据对象的属性，如下所示。</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="536f" class="lo lp in mn b gy mr ms l mt mu">const proxy = new Proxy(data, handler);<br/><strong class="mn io">proxy.firstname = 'Modified Code';</strong></span></pre><p id="d439" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">使用上面的代码和handler对象，我们可以看到下面的console.log消息。</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="d620" class="lo lp in mn b gy mr ms l mt mu"><strong class="mn io">1. {firstName: 'Modified Code'} // Data object</strong><br/><strong class="mn io">2. firstName                    // Key(property name)</strong><br/><strong class="mn io">3. Modified Code                // Value</strong></span></pre><ol class=""><li id="928e" class="no np in ku b kv kw ky kz lb nq lf nr lj ns ln nt nu nv nw bi translated"><strong class="ku io">目标</strong>是本质上被包装的对象，即我们传递给代理构造器的<strong class="ku io">数据对象</strong>。</li><li id="d0ae" class="no np in ku b kv nx ky ny lb nz lf oa lj ob ln nt nu nv nw bi translated"><strong class="ku io">键</strong>是<strong class="ku io">属性(即</strong> <code class="fe mw mx my mn b"><strong class="ku io">firstname</strong></code> <strong class="ku io"> ) </strong>，我们为其设置了<strong class="ku io">新值</strong>。</li><li id="3d6a" class="no np in ku b kv nx ky ny lb nz lf oa lj ob ln nt nu nv nw bi translated"><strong class="ku io">值</strong>是我们设置给<code class="fe mw mx my mn b"><strong class="ku io">firstname </strong></code>属性的<strong class="ku io">新值</strong>。</li></ol><p id="2d98" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这显示了一个处理程序在那里做什么。</p></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><h2 id="83eb" class="lo lp in bd lq lr ls dn lt lu lv dp lw lb lx ly lz lf ma mb mc lj md me mf mg bi translated">应用反应性</h2><p id="cebe" class="pw-post-body-paragraph ks kt in ku b kv mh jo kx ky mi jr la lb mj ld le lf mk lh li lj ml ll lm ln ig bi translated">所以，回到我们最初的代码，每当<code class="fe mw mx my mn b"><strong class="ku io">firstname </strong></code>改变时，我们需要改变<code class="fe mw mx my mn b"><strong class="ku io">fullname </strong></code>。在一个<strong class="ku io">代理对象</strong>的帮助下，通过设置一个所谓的<strong class="ku io">设置陷阱</strong>这样的处理程序，我们可以实现这个。</p><p id="196f" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><strong class="ku io">我们可以定义一个setter函数，每当代理对象上的一个属性被设置为一个新值时，这个函数就会被触发。</strong></p><p id="68c2" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">然后我们可以检查我们正在设置的<strong class="ku io">键</strong>是否是<code class="fe mw mx my mn b"><strong class="ku io">firstname</strong></code>，并用分配的新值<strong class="ku io">更新<strong class="ku io">设置陷阱</strong>中的<code class="fe mw mx my mn b"><strong class="ku io">fullname </strong></code>属性。</strong></p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="3b1b" class="lo lp in mn b gy mr ms l mt mu">const handler = {<br/> set(target, key, value) {<br/>  <strong class="mn io">if(key === 'firstname'){<br/>   target.fullname = value + ' Ceeker';<br/>  }<br/>  target.firstname = value;<br/> </strong>}<br/>}</span></pre><p id="3133" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在，如果我们尝试用这个代理设置来执行我们的初始代码，我们会看到更新<code class="fe mw mx my mn b"><strong class="ku io">firstname </strong></code>也会更新<code class="fe mw mx my mn b"><strong class="ku io">fullname </strong></code>属性。</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="db07" class="lo lp in mn b gy mr ms l mt mu">const data = {<br/> firstname: 'Code',<br/> fullname: 'Ceeker'<br/>};</span><span id="2333" class="lo lp in mn b gy mv ms l mt mu"><strong class="mn io">const handler = {<br/> set(target, key, value) {<br/>  if(key === 'firstname'){<br/>   target.fullname = value + ' Ceeker';<br/>  }<br/>  target.firstname = value;<br/> }<br/>}</strong></span><span id="1fb2" class="lo lp in mn b gy mv ms l mt mu"><strong class="mn io">console.log(data.fullname);  // Ceeker</strong></span><span id="4f03" class="lo lp in mn b gy mv ms l mt mu">const proxy = new Proxy(<strong class="mn io">data</strong>, <strong class="mn io">handler</strong>);<br/><strong class="mn io">proxy.firstname = 'Modified Code';</strong></span><span id="9736" class="lo lp in mn b gy mv ms l mt mu"><strong class="mn io">console.log(data.fullname);  // Modified Code Ceeker</strong></span></pre><p id="15a1" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><strong class="ku io">输出</strong></p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="59bb" class="lo lp in mn b gy mr ms l mt mu"><strong class="mn io">Code Ceeker<br/>Modified Code Ceeker</strong></span></pre><p id="9dfb" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">代码<code class="fe mw mx my mn b"><strong class="ku io">proxy.firstname = ‘Modified Code’</strong></code>将触发代理处理程序的<code class="fe mw mx my mn b"><strong class="ku io">set</strong></code> <strong class="ku io"> </strong>函数，该函数随后也更新数据属性的<code class="fe mw mx my mn b"><strong class="ku io">fullname</strong></code>和<code class="fe mw mx my mn b"><strong class="ku io">firstname</strong></code>。</p><p id="0707" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这就是我们如何创建我们的反应系统来跟踪一个属性并在<strong class="ku io"> firstname </strong>属性改变时更新另一个属性。</p><p id="bbb4" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">简而言之，Vue通过一些额外的简化实现了这一点。它监视你的数据属性，任何时候其中一个属性发生变化，它都会更新你程序中使用它的部分。这就是Vue的运作方式，但显然它的运作方式比我们这里的更复杂。但这只是一个快速概述，应该有助于您了解Vue反应性一般是如何工作的。</p><p id="7dd9" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">感谢您的阅读。</p></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><p id="910a" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><em class="mz">更多内容请看</em><a class="ae nh" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ku io"><em class="mz">plain English . io</em></strong></a><em class="mz">。报名参加我们的</em> <a class="ae nh" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ku io"> <em class="mz">免费周报</em> </strong> </a> <em class="mz">。关注我们关于</em><a class="ae nh" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ku io"><em class="mz">Twitter</em></strong></a><a class="ae nh" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ku io"><em class="mz">LinkedIn</em></strong></a><em class="mz"/><a class="ae nh" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ku io"><em class="mz">YouTube</em></strong></a><em class="mz"/><a class="ae nh" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="ku io"><em class="mz">不和</em> </strong> </a> <em class="mz">。对增长黑客感兴趣？检查</em> <a class="ae nh" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="ku io"> <em class="mz">电路</em> </strong> </a> <em class="mz">。</em></p></div></div>    
</body>
</html>