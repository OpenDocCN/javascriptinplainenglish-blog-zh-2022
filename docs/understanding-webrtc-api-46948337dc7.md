# äº†è§£ WebRTC â€”ç¬¬ 1 éƒ¨åˆ†

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/understanding-webrtc-api-46948337dc7?source=collection_archive---------11----------------------->

## ç‡ƒçƒ§ç½‘ç»œçš„å°–ç«¯æŠ€æœ¯ä¹‹ä¸€

åœ¨è¿‡å»çš„åå¹´ä¸­ï¼ŒWebRTC åœ¨ web å¼€å‘ç¤¾åŒºä¸­è·å¾—äº†å¾ˆå¤§çš„äººæ°”ã€‚æ„Ÿè°¢ç–«æƒ…(è™½ç„¶æ˜¯ç§¯æçš„æ–¹å¼),å› ä¸ºè®¸å¤šå…¬å¸å¼€å§‹é‡‡ç”¨åœ¨å®¶æ°¸ä¹…å·¥ä½œğŸ‘¨â€ğŸ’»ï¼Œåƒ Atlassianï¼ŒShopifyï¼ŒSpotifyï¼ŒTwitterâ€¦â€¦(OMG åå•è¿˜åœ¨ç»§ç»­)ã€‚è¿™ç§è¿œç¨‹å·¥ä½œçš„é‡‡ç”¨å¯¼è‡´å¤§å¤šæ•°å…¬å¸è´­ä¹°å®æ—¶é€šä¿¡å·¥å…·ï¼Œå¦‚ MS Teams å’Œ Gmeetï¼Œå®ƒä»¬å°† WebRTC ä½œä¸ºä¸»è¦ç»„ä»¶ã€‚

æ ¹æ® PayScale çš„æ•°æ®ï¼Œ2022 å¹´ç¾å›½ WebRTC å¼€å‘äººå‘˜çš„å¹³å‡å·¥èµ„çº¦ä¸º 74136 ç¾å…ƒ/å¹´ã€‚ç›¸å½“ä¸é”™çš„æŠ¥é…¬ï¼Œå¥½å§ï¼Œè®©æˆ‘ä»¬ç›´æ¥è¿›å…¥ä¸»é¢˜ã€‚

![](img/b478cacbcf8b56167a2ebbaca5a7adf9.png)

Photo by [Brian_Cragun](https://pixabay.com/users/brian_cragun-19680916/) on [Pixabay](https://pixabay.com/)

# ä»€ä¹ˆæ˜¯ WebRTCï¼Ÿ

> WebRTC æ˜¯ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œå…è®¸ä½¿ç”¨å¯é çš„åè®®å’ŒåŠ å¯†æŠ€æœ¯è¿›è¡Œå®æ—¶æ•°æ®ä¼ è¾“ã€‚

è¿™äº›å®æ—¶æ•°æ®å¯ä»¥æ˜¯éŸ³é¢‘ã€è§†é¢‘ï¼Œæˆ–è€…å¯èƒ½æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²æ¶ˆæ¯ï¼Œåªéœ€å‡ è¡Œä»£ç å°±å¯ä»¥ä»¥ä¸€ç§éå¸¸å¿«é€Ÿã€æ›´åŠ å®‰å…¨çš„æ–¹å¼è¿›è¡Œäº¤æ¢ï¼ğŸ’†

# å¦‚ä½•å¼€å§‹ğŸ¤”

ä½œä¸ºå¼€å‘äººå‘˜ï¼Œå½“æˆ‘ä»¬é‡åˆ°ä¸€é¡¹æ–°æŠ€æœ¯æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé™·å…¥å¦‚ä½•å¼€å§‹çš„å›°å¢ƒã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯ç›´æ¥è¿›å…¥å®ç”¨çš„æ–¹æ³•ã€‚

è®©æˆ‘ä»¬ä»è·Ÿéšäº²å»å†™ä¸€ä¸ªç®€å•çš„è¦ç‚¹å¼€å§‹ğŸ˜˜åŸåˆ™ã€‚æ‰“å¼€ä»£ç ç¼–è¾‘å™¨ï¼Œå¤åˆ¶ç²˜è´´ä¸‹é¢çš„ä»£ç ã€‚

æ™®é€šçš„ javascript å¾ˆæ— èŠï¼Œè®©æˆ‘ä»¬ç»™å®ƒæ·»åŠ ä¸€äº› html å’Œ css çš„ç‚¹ç¼€å§ï¼ŒğŸ¥³

å‰å®³ï¼ğŸ¤©æˆ‘ä»¬åšåˆ°äº†ï¼ğŸ˜æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ª WebRTC æ”¯æŒçš„èŠå¤©åº”ç”¨ç¨‹åºï¼Œç°åœ¨è®©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£ä»£ç ã€‚

HTML å’Œ CSS éƒ¨åˆ†æ˜¯ä¸è¨€è‡ªæ˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åªå…³æ³¨ javascriptã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„èŠå¤©åº”ç”¨ç¨‹åºï¼Œå®ƒä½¿ç”¨ WebRTC çš„é›†æˆ [dataChannelAPI](https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Using_data_channels) æ¥å‘é€å’Œæ¥æ”¶èŠå¤©æ¶ˆæ¯ã€‚

# é‚£ä¹ˆä»€ä¹ˆæ˜¯æ•°æ®é€šé“å‘¢ï¼Ÿ

> WebRTC æ•°æ®é€šé“æ˜¯ä¸€ç§åª’ä»‹ï¼Œé€šè¿‡å®ƒï¼Œå¯¹ç­‰æ–¹å¯ä»¥é€šè¿‡å¯¹ç­‰è¿æ¥å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚

æ‰€ä»¥æ•°æ®é€šé“å°±åƒä¸€åº§æ¡¥ğŸŒ‰ç”¨äºå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚

# é‚£ä¹ˆä»€ä¹ˆæ˜¯å¯¹ç­‰è¿æ¥å‘¢ï¼Ÿ

> WebRTC å¯¹ç­‰è¿æ¥è¿æ¥ä¸åŒä¼šè¯ä¸­çš„å¯¹ç­‰æ–¹ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ä½¿ç”¨å¯¹ç­‰åè®®è¿›è¡Œé€šä¿¡ã€‚

ç®€å•åœ°è¯´ï¼Œå¯¹ç­‰è¿æ¥å¤„ç†ä¸€ç»„åè®®ï¼Œé€šè¿‡è¿™äº›åè®®ï¼Œä¸åŒè®¡ç®—æœºä¹‹é—´å¯ä»¥è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚å®ƒå¤„ç†è¯¸å¦‚å°†æ¶ˆæ¯å‘é€åˆ°å“ªé‡Œä»¥åŠå“ªæ¡æ¶ˆæ¯åº”è¯¥å‘é€åˆ°å“ªå°è®¡ç®—æœºä¹‹ç±»çš„ç»†èŠ‚ã€‚ä¸€æ—¦æˆ‘ä»¬å®Œæˆäº†å¯¹ç­‰è¿æ¥ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£å¯¹ç­‰è¿æ¥çš„ä¸»è¦ç»„ä»¶ã€‚

*   RTCIceCandidate
*   ä¼šè¯æè¿°åè®®(sdp)

## å†°ä»€ä¹ˆï¼Ÿ

> äº¤äº’å¼è¿æ¥å»ºç«‹(ICE)æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå……å½“å¯¹ç­‰ä½“ä½¿ç”¨ RTCPeerConnection è¿›è¡Œé€šä¿¡çš„åè®®å’Œè·¯ç”±æœºåˆ¶ã€‚

ä½¿ç”¨ ICE åè®®ï¼Œå°†ç”Ÿæˆå€™é€‰äººã€‚iceCandidate æ˜¯åŒ…å«ç½‘ç»œè·¯ç”±ä¿¡æ¯çš„å­—ç¬¦ä¸²ï¼Œæ•°æ®åŒ…ä½¿ç”¨è¯¥ä¿¡æ¯åœ¨å¯¹ç­‰è¿æ¥ä¸­æµåŠ¨ã€‚

## å¥½å§ï¼Œé‚£ SDP å‘¢ï¼Ÿ

> SDP æ˜¯å¦ä¸€ç§ä¿å­˜ç‰¹å®šäºä¼šè¯çš„ä¿¡æ¯çš„åè®®ï¼Œä¾‹å¦‚æ”¯æŒçš„éŸ³é¢‘æˆ–è§†é¢‘ç¼–è§£ç å™¨ã€åŠ å¯†ç®—æ³•ä»¥åŠå…¶ä»–ä¸è®¾å¤‡ç›¸å…³çš„è¯¦ç»†ä¿¡æ¯ã€‚

SDP æ˜¯ WebRTC çš„ä¸»è¦ç»„ä»¶ä¹‹ä¸€ã€‚æ­¤å¤–ï¼Œåœ¨ä¸¤ä¸ªå¯¹ç­‰ä½“ä¹‹é—´åˆ›å»º WebRTC è¿æ¥çš„ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºå’Œäº¤æ¢ sdp(æä¾›å’Œåº”ç­”)ã€‚

ä¸ºäº†åˆ›å»ºä¸€ä¸ª WebRTC è¿æ¥ï¼Œæˆ‘ä»¬è¦ç»è¿‡ä¸€ä¸ª**ä¿¡ä»¤é˜¶æ®µ**ğŸš¥ã€‚è®©æˆ‘ä»¬é€šè¿‡å¬ä¸€ä¸ªğŸ’æ•…äº‹ã€‚

# ä¸€ä¸ªç½—å¯†æ¬§ğŸ¤µâ€”æœ±ä¸½å¶ğŸ‘©â€ğŸ’¼æ•…äº‹

![](img/836e170e2267dfd2c25abdabeec92a88.png)

Photo by [Oscar Mucyo](https://unsplash.com/@oscarmucyo?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/s/photos/mobile-chat?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

ç½—å¯†æ¬§æƒ³è¦ç»™æœ±ä¸½å¶å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œæ‰€ä»¥ä»–å†³å®šä½¿ç”¨ WebRTCã€‚Romeo ä»ä»–çš„æœ¬åœ° RTCPeerConnection åˆ›å»ºä¸€ä¸ª offer sdpï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºæœ¬åœ°æè¿°ã€‚ç°åœ¨ç½—å¯†æ¬§å‘æœ±ä¸½å¶å‘å‡ºäº†é‚€è¯·ğŸ’Œé€šè¿‡æŸç§é€šä¿¡åè®®(å¯èƒ½æ˜¯å¥—æ¥å­—è¿æ¥)ã€‚

```
localConnection = new RTCPeerConnection();
localConnection.createOffer().then((offer) => {
    localConnection.setLocalDescription(offer);
    // send offer to JulietğŸ‘©â€ğŸ’¼
}
```

Juliet æ”¶åˆ°è¯¥æè®®ï¼Œå°†å…¶è®¾ç½®ä¸ºè¿œç¨‹æè¿°ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåº”ç­” sdp æ¥æœ¬åœ°è®¾ç½®å®ƒï¼Œå°†å…¶å‘é€å› RomeoğŸ’Œã€‚

```
remoteConnection = new RTCPeerConnection();
remoteConnection.setRemoteDescription(offer).then(() => {
    remoteConnection.createAnswer().then((answer) => {
        remoteConnection.setLocalDescription(answer)
        // send answer to RomeoğŸ¤µ
    })
})
```

æ”¶åˆ°ç­”æ¡ˆ-sdp ç½—å¯†æ¬§å¾ˆé«˜å…´ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºä»–çš„è¿œç¨‹æè¿°ã€‚ç»“æœï¼Œice å€™é€‰è€…å¼€å§‹åœ¨ä¸¤ç«¯ç”Ÿæˆï¼Œç„¶åäº¤æ¢ğŸ’Œå®æ—¶åœ°ã€‚

```
localConnection.setRemoteDescription(answer)localConnection.onicecandidate = (event) => {
    remoteConnection.addIceCandidate(event.candidate);
    // send candidate to JulietğŸ‘©â€ğŸ’¼
}remoteConnection.onicecandidate = (event) => {
    localConnection.addIceCandidate(event.candidate);
    // send candidate to RomeoğŸ¤µ
}
```

ç°åœ¨è¿æ¥å·²ç»å‡†å¤‡å¥½å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œä½†æ˜¯ Romeo éœ€è¦ä¸€ä¸ªç§˜å¯†çš„æ•°æ®é€šé“æ¥å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ï¼Œæ‰€ä»¥ä»–åˆ›å»ºäº†ä¸€ä¸ªé€šé“å¹¶å‘é€äº†ä»–çš„ç¬¬ä¸€æ¡æ¶ˆæ¯ã€‚

```
sendChannel = localConnection.createDataChannel("romeo-juliet");
sendChannel.send("Hey my love â¤ï¸");
```

å¦ä¸€æ–¹é¢ï¼ŒJuliet æ­£åœ¨ä¾¦å¬æ–°åˆ›å»ºçš„æ•°æ®é€šé“å¹¶æ¥æ”¶æ¶ˆæ¯ã€‚

```
receiveChannel.onmessage = (event) => {
    message = event.data; //Hey my love â¤ï¸
}
```

è¿™æ ·ä¸€ä¸ªå¹¸ç¦çš„ç»“å±€ä¸æ˜¯å—ğŸ˜Šï¼Œè¿™æ€ä¹ˆå¯èƒ½ï¼Ÿ

å˜£ï¼ï¼ï¼æ— æ³•å‘é€æ¶ˆæ¯ã€‚

![](img/11bffa973d03ce461b0779710e56184b.png)

Unable to send message ğŸ™

è¿™ä¸ªé”™è¯¯çš„åŸå› å¯èƒ½æ˜¯ä»€ä¹ˆï¼Ÿç½—å¯†æ¬§åº”è¯¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿåœ¨è¯„è®ºåŒºç­‰ä½ çš„å›ç­”ã€‚

# ç»“è®º

æˆ‘çŸ¥é“è¿™å°†æ˜¯åŠ¿ä¸å¯æŒ¡çš„ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨è¿™ä¸ªå¿«é€Ÿåšå®¢ä¸­è®¨è®ºäº†è®¸å¤šæ¦‚å¿µã€‚å­¦ä¹ æ–°æŠ€æœ¯çš„æœ€å¥½æ–¹æ³•æ˜¯åŸ¹å…»å¥½å¥‡å¿ƒï¼Œå°è¯•æ–°äº‹ç‰©ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œä¸€ä¸ªä¸“ä¸šçš„å»ºè®®æ˜¯é˜…è¯» [**æ–‡æ¡£**](https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/connectionState#failed) **ã€‚æ˜¯çš„ï¼Œé˜…è¯»æ–‡æ¡£æ˜¯æ›´å¥½åœ°ç†è§£äº‹ç‰©çš„æœ€å¥½æ–¹æ³•ä¹‹ä¸€ã€‚ä½ å¯èƒ½ä¹Ÿä¼šæ‰¾åˆ°ä¸Šè¿°é—®é¢˜çš„ç­”æ¡ˆğŸ’¡ğŸ˜‰ä¸€å®šè¦å»çœ‹çœ‹ã€‚**

*æ›´å¤šå†…å®¹è¯·çœ‹*[***plain English . io***](https://plainenglish.io/)*ã€‚æŠ¥åå‚åŠ æˆ‘ä»¬çš„* [***å…è´¹å‘¨æŠ¥***](http://newsletter.plainenglish.io/) *ã€‚å…³æ³¨æˆ‘ä»¬ä¸Š*[***Twitter***](https://twitter.com/inPlainEngHQ)[***LinkedIn***](https://www.linkedin.com/company/inplainenglish/)*[***YouTube***](https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw)**å’Œ* [***ä¸å’Œ***](https://discord.gg/GtDtUAvyhW) *å¯¹æˆé•¿é»‘å®¢æ„Ÿå…´è¶£ï¼Ÿæ£€æŸ¥* [***ç”µè·¯***](https://circuit.ooo/) ***ã€‚*****