<html>
<head>
<title>OAuth Implicit Grant for Single Page Applications, jsFiddle, and Codepen</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OAuth对单页应用程序、jsdild和Codepen的隐式授权</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/oauth-implicit-grant-for-single-page-applications-jsfiddle-and-codepen-10c2c7946f05?source=collection_archive---------19-----------------------#2022-08-24">https://javascript.plainenglish.io/oauth-implicit-grant-for-single-page-applications-jsfiddle-and-codepen-10c2c7946f05?source=collection_archive---------19-----------------------#2022-08-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/3912f3f5f91e06b2ce826b1e51c8a88f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UgZ46HawdwXICBAmpIm7cg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">OAuth logo</figcaption></figure><p id="3d56" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">随着电脑和智能手机变得越来越强大，单页面应用程序(SPAs)的吸引力持续上升。SPA是一个主要在浏览器中运行<em class="kx">的应用程序。</em>最著名的SPA是Gmail应用程序。如今，温泉到处都是。</p><p id="ed03" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">更复杂的SPA应用程序通常使用React、Vue或类似的框架。不管有没有jQuery，JavaScript都可以很好地工作。</p><p id="ce51" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">对于快速开发和原型制作来说，jsFiddle和Codepen是构建spa的优秀工具。在本文中，我将向您展示如何将OAuth隐式授权流用于您的jsFiddle或Codepen JS项目。</p><p id="1a1e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> OAuth授权码和隐式授权流</strong></p><p id="506c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">OAuth v2.0包括多个授权应用程序访问资源的流程。经常使用的授权码授权流由包括安全服务器后端的应用程序使用，该安全服务器后端可以适当地保护其客户端秘密值。</p><p id="211f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">因为纯SPA没有安全的服务器后端，所以需要不同的OAuth解决方案。有两种选择，OAuth v2.0推荐的OAuth隐式授权流，以及即将推出的OAuth v2.1要求的授权码授权(没有客户端秘密)+ PKCE(代码交换的证明密钥)流</p><p id="5c4a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">单页申请和OAuth隐式授权流程</strong></p><p id="a6c9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">OAuth v2.0隐式授权流可用于任何单页应用程序:</p><ol class=""><li id="ff37" class="ky kz in kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated">向OAuth授权服务器(AS)注册SPA的返回URL，并接收客户端ID。客户端id不是秘密，它们是客户端应用程序的公共标识符。</li><li id="d6b6" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">为了获得访问令牌，SPA将浏览器重定向到AS，或者为AS打开新的浏览器选项卡。AS URL包括客户端ID和其他数据。</li><li id="99ae" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">AS返回一个登录页面，使应用程序的用户能够向身份提供者进行身份验证。</li><li id="5294" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">AS将浏览器重定向到注册的返回URL。访问令牌包含在片段标识符中。例如<code class="fe lm ln lo lp b">https://app.example.com/#access_token=eyJ0eXAiOiJNl1aBmkCllvQ&amp;expires_in=28800&amp;token_type=bearer&amp;scope=signature&amp;state=3CDOtfb9e0cRsJQFp</code></li></ol><p id="c32b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">重定向或打开新的浏览器窗口？</strong></p><p id="0c87" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">客户端应用程序可以向OAuth授权服务器打开一个新的浏览器窗口，或者重定向浏览器。标准要求不得使用iFrame。</p><p id="f6d0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">打开一个新的浏览器选项卡或窗口是更简单的解决方案:SPA仍在其原始浏览器窗口中运行，并保持其状态。在授权流程中不会重置。一旦用户通过as进行了身份验证，它就可以关闭登录浏览器选项卡。注意，OAuth安全标准需要新的浏览器选项卡或窗口来显示授权服务器的URL。这使用户能够验证URL。</p><p id="4274" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">重定向单页应用程序的浏览器窗口本身要求SPA首先存储其状态，因为当AS将浏览器重定向回SPA时，SPA将重新启动。SPA状态可以本地存储在浏览器中，也可以远程存储在服务器中。</p><p id="ed62" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> jsFiddle和code pen vs OAuth隐式授权流</strong></p><p id="a765" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">不幸的是，jsFiddle、Codepen和类似的工具不能直接使用隐式授权流。这些工具的JavaScript应用程序在iFrames中运行，与jsFiddle和Codepen URLs一起使用的片段标识符对其托管的JavaScript应用程序不可用。</p><p id="bf3a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">解决方案是使用一个“<a class="ae lq" href="https://docusign.github.io/jsfiddleImplicitGrantReturn.html" rel="noopener ugc nofollow" target="_blank">重定向页面</a>，一个单独托管的HTML/JavaScript文件，用于来自授权服务器的重定向。重定向页面使用<a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" rel="noopener ugc nofollow" target="_blank"> Window.postMessage </a>将授权服务器的响应发送回在jsFiddle或Codepen中运行的JavaScript应用程序。</p><p id="ec5b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">OAuth流程示例</strong></p><ol class=""><li id="9072" class="ky kz in kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated">应用程序向OAuth授权服务器注册。对于这些例子，使用了DocuSign developer OAuth服务器。应用程序的OAuth返回URL被设置为<a class="ae lq" href="https://docusign.github.io/jsfiddleImplicitGrantReturn.html" rel="noopener ugc nofollow" target="_blank">重定向页面</a> ( <a class="ae lq" href="https://github.com/docusign/docusign.github.io/blob/master/jsfiddleImplicitGrantReturn.html" rel="noopener ugc nofollow" target="_blank">源</a>)。</li><li id="74c5" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">JavaScript注册一个事件监听器来接收传入的窗口消息。</li><li id="63ed" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">用户单击登录按钮。</li><li id="a6a3" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">JavaScript从<a class="ae lq" href="https://www.random.org" rel="noopener ugc nofollow" target="_blank">random.org</a>获得一个随机数字符串。nonce作为<code class="fe lm ln lo lp b">state</code>属性被发送(并且稍后被检查)以防止<a class="ae lq" href="https://oauth.net/articles/authentication/#access-token-injection" rel="noopener ugc nofollow" target="_blank">访问令牌注入攻击</a>。</li><li id="14da" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">将打开一个新的浏览器选项卡，指向隐式授权流的起始URL。</li><li id="7040" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">用户通过OAuth身份验证服务进行身份验证。</li><li id="eeff" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">身份验证服务将浏览器重定向到重定向页面。访问令牌包含在重定向URL中。</li><li id="b477" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">重定向URL页面使用<code class="fe lm ln lo lp b">Window.postMessage</code>将其传入的片段(散列)字符串发送到浏览器标签的父标签，即运行在Codepen或jsFiddler中的JavaScript。</li><li id="2d8c" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">JavaScript接收消息。它解码消息，检查<code class="fe lm ln lo lp b">state</code>值，并存储访问令牌。</li><li id="df8f" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">访问令牌现在可以用于其他API调用。</li></ol><p id="0393" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">活生生的例子</strong></p><figure class="lr ls lt lu gt jo"><div class="bz fp l di"><div class="lv lw l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">OAuth Implicit grant with Codepen</figcaption></figure><figure class="lr ls lt lu gt jo"><div class="bz fp l di"><div class="lx lw l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">OAuth Implicit grant with jsFiddle</figcaption></figure><p id="7c3f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">结论</strong></p><p id="eb01" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">由于它们的速度和非常低的延迟，单页应用程序通常是构建优秀应用程序的最佳答案。但是没有一个应用是孤岛，所以经常需要API访问和OAuth授权。这些jsFiddle和Codepen示例为构建下一个unicorn应用程序提供了一个良好的开端。</p><p id="776f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">参考文献</strong></p><p id="708f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">机密与公共OAuth客户<a class="ae lq" href="https://tools.ietf.org/html/rfc6749#section-2.1" rel="noopener ugc nofollow" target="_blank"> RFC 6749 2.1 </a></p><p id="baa8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">隐式授权<a class="ae lq" href="https://www.rfc-editor.org/rfc/rfc6749.html#section-4.2" rel="noopener ugc nofollow" target="_blank"> RFC 6749 4.2 </a></p><p id="7e15" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">PKCE <a class="ae lq" href="https://www.rfc-editor.org/rfc/rfc7636.html" rel="noopener ugc nofollow" target="_blank"> RFC 7636 </a></p><p id="bff4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><a class="ae lq" href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-06" rel="noopener ugc nofollow" target="_blank"> OAuth v2.1(草案)</a></p></div><div class="ab cl ly lz hr ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ig ih ii ij ik"><p id="c412" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="kx">更多内容看</em> <a class="ae lq" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io"> <em class="kx">说白了。报名参加我们的</em> <a class="ae lq" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io"> <em class="kx">免费周报</em> </strong> </a> <em class="kx">。关注我们关于</em><a class="ae lq" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kb io"><em class="kx">Twitter</em></strong></a>，<a class="ae lq" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kb io"><em class="kx">LinkedIn</em></strong></a><em class="kx">，</em><a class="ae lq" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kb io"><em class="kx">YouTube</em></strong></a><em class="kx">，以及</em> <a class="ae lq" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io"> <em class="kx">不和</em> </strong> </a> <em class="kx">。</em></strong></a></p></div></div>    
</body>
</html>