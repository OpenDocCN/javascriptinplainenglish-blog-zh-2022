<html>
<head>
<title>How to Create a Stripe Subscription with React and Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用React和Node.js创建条带订阅</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-a-stripe-subscription-with-react-and-node-js-b7c5e5e24967?source=collection_archive---------1-----------------------#2022-11-01">https://javascript.plainenglish.io/how-to-create-a-stripe-subscription-with-react-and-node-js-b7c5e5e24967?source=collection_archive---------1-----------------------#2022-11-01</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="4f78" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">使用React和Node.js中的Stripe向您的客户收取定期付款。</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/eee16a32a4f3e4e980b60b28f1fb9f6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xr54vv32DW9s84df-psl3A.jpeg"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Photo by <a class="ae kw" href="https://unsplash.com/@towfiqu999999?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Towfiqu barbhuiya</a> on <a class="ae kw" href="https://unsplash.com/s/photos/payment?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="fed4" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">Stripe是收集客户付款的最受欢迎的方法之一。它简单易用，是任何web开发人员的必备技能。</p><p id="aa02" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在上一篇文章<a class="ae kw" href="https://medium.com/p/27c5a858b7f7" rel="noopener">中，我们看到了如何在React应用程序中收款</a>。</p><div class="lt lu gq gs lv lw"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-integrate-stripe-with-a-react-application-27c5a858b7f7"><div class="lx ab fp"><div class="ly ab lz cl cj ma"><h2 class="bd is gz z fq mb fs ft mc fv fx iq bi translated">如何将Stripe与React应用程序集成</h2><div class="md l"><h3 class="bd b gz z fq mb fs ft mc fv fx dk translated">为您的企业接受和处理付款从未如此简单！</h3></div><div class="me l"><p class="bd b dl z fq mb fs ft mc fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="mf l"><div class="mg l mh mi mj mf mk kq lw"/></div></div></a></div><p id="001d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">今天，我们将学习如何创建一个订阅，并使它变得非常简单。</p><p id="f13c" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">我们开始吧！</p><pre class="kh ki kj kk gu ml mm mn mo aw mp bi"><span id="6745" class="mq mr ir mm b gz ms mt l mu mv">This story was originally published <a class="ae kw" href="https://www.mohammadfaisal.dev/blog/how-to-create-a-stripe-subscription-with-reactjs-and-nodejs" rel="noopener ugc nofollow" target="_blank">here</a></span></pre><h1 id="fbfb" class="mw mr ir bd mx my mz na nb nc nd ne nf jx ng jy nh ka ni kb nj kd nk ke nl nm bi translated">第一步</h1><p id="f94a" class="pw-post-body-paragraph kx ky ir kz b la nn js lc ld no jv lf lg np li lj lk nq lm ln lo nr lq lr ls ik bi translated">要设置订阅，首先，您需要Stripe dashboard中的两个秘密值</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj ns"><img src="../Images/d8558759c0aad568e0d04d4d8cf25eeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aCYt0aEpO9fveu61oc6tAA.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Stripe dashboard</figcaption></figure><p id="af21" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">对于前端:</p><pre class="kh ki kj kk gu ml mm mn mo aw mp bi"><span id="f2f0" class="mq mr ir mm b gz ms mt l mu mv">STRIPE_PUBLISHABLE_KEY</span></pre><p id="7677" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">对于后端:</p><pre class="kh ki kj kk gu ml mm mn mo aw mp bi"><span id="97a8" class="mq mr ir mm b gz ms mt l mu mv">STRIPE_SECRET_KEY</span></pre><p id="c285" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">存储这些值，因为我们很快就会用到它们！</p><h1 id="5130" class="mw mr ir bd mx my mz na nb nc nd ne nf jx ng jy nh ka ni kb nj kd nk ke nl nm bi translated">创建产品和价格</h1><p id="411a" class="pw-post-body-paragraph kx ky ir kz b la nn js lc ld no jv lf lg np li lj lk nq lm ln lo nr lq lr ls ik bi translated">下一步。转到您的仪表板并创建一个产品。</p><p id="c665" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在本例中，我们为该产品设置了两个价格。一个月一次，一年一次。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nt"><img src="../Images/8d0f5c2af14557ed6f1ba6e3256b9142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zNe9crm9I6SGzqFnim1FMg.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Product Pricing</figcaption></figure><p id="22cd" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在获取价格的API ID。该键以<code class="fe nu nv nw mm b">price_somerandomstuff</code>开始</p><h1 id="e5d3" class="mw mr ir bd mx my mz na nb nc nd ne nf jx ng jy nh ka ni kb nj kd nk ke nl nm bi translated">实际流量</h1><p id="172d" class="pw-post-body-paragraph kx ky ir kz b la nn js lc ld no jv lf lg np li lj lk nq lm ln lo nr lq lr ls ik bi translated">整个订阅工作流程有几个步骤。</p><ol class=""><li id="32d5" class="nx ny ir kz b la lb ld le lg nz lk oa lo ob ls oc od oe of bi translated">首先，你从前端收集用户<code class="fe nu nv nw mm b">name</code>和<code class="fe nu nv nw mm b">email</code>以及他们的计划。</li><li id="fb49" class="nx ny ir kz b la og ld oh lg oi lk oj lo ok ls oc od oe of bi translated">在最后一步中，我们希望收集用户选择的<code class="fe nu nv nw mm b">price API ID</code>。</li><li id="5005" class="nx ny ir kz b la og ld oh lg oi lk oj lo ok ls oc od oe of bi translated">用户还填写他们的支付细节。为了收集他们的付款细节，我们使用了<code class="fe nu nv nw mm b">CardElement</code>。Stripe SDK提供了这个组件。</li><li id="5303" class="nx ny ir kz b la og ld oh lg oi lk oj lo ok ls oc od oe of bi translated">然后我们将这4条信息(<code class="fe nu nv nw mm b">name</code>、<code class="fe nu nv nw mm b">email</code>、<code class="fe nu nv nw mm b">paymentDetails</code>和<code class="fe nu nv nw mm b">priceid</code>)发送到后端。</li><li id="e965" class="nx ny ir kz b la og ld oh lg oi lk oj lo ok ls oc od oe of bi translated">后端创建一个包含姓名、电子邮件和支付细节的<code class="fe nu nv nw mm b">customer</code>。您可以将此步骤中创建的客户存储在您自己的数据库中。</li><li id="58ea" class="nx ny ir kz b la og ld oh lg oi lk oj lo ok ls oc od oe of bi translated">然后后端使用这个<code class="fe nu nv nw mm b">customer</code>和<code class="fe nu nv nw mm b">pricedId</code>创建一个<code class="fe nu nv nw mm b">subscription</code>，并将它传递回<code class="fe nu nv nw mm b">clientSecret</code>给前端。</li><li id="bd25" class="nx ny ir kz b la og ld oh lg oi lk oj lo ok ls oc od oe of bi translated">前端使用那个<code class="fe nu nv nw mm b">clientSecret</code>创建一个<code class="fe nu nv nw mm b">paymentIntent</code>。</li><li id="393c" class="nx ny ir kz b la og ld oh lg oi lk oj lo ok ls oc od oe of bi translated">如果成功，您将在条带控制面板上看到订阅处于活动状态。</li></ol><p id="e683" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这需要很多步骤，所以让我们开始吧。</p><h1 id="a3f8" class="mw mr ir bd mx my mz na nb nc nd ne nf jx ng jy nh ka ni kb nj kd nk ke nl nm bi translated">准备后端</h1><p id="349f" class="pw-post-body-paragraph kx ky ir kz b la nn js lc ld no jv lf lg np li lj lk nq lm ln lo nr lq lr ls ik bi translated">首先，安装依赖项:</p><pre class="kh ki kj kk gu ml mm mn mo aw mp bi"><span id="041b" class="mq mr ir mm b gz ms mt l mu mv">yarn add stripe</span></pre><p id="9a01" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后用您的密钥初始化条带:</p><pre class="kh ki kj kk gu ml mm mn mo aw mp bi"><span id="903d" class="mq mr ir mm b gz ms mt l mu mv">import Stripe from 'stripe'</span><span id="bd81" class="mq mr ir mm b gz ol mt l mu mv">const stripe = new Stripe('your_stripe_secret_key')</span></pre><p id="4769" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后创建一个接受post请求的路由。</p><pre class="kh ki kj kk gu ml mm mn mo aw mp bi"><span id="6840" class="mq mr ir mm b gz ms mt l mu mv">app.post('/create-subscription', ( req  ,res ) =&gt; {</span><span id="7520" class="mq mr ir mm b gz ol mt l mu mv">    createSubscription(req);</span><span id="e789" class="mq mr ir mm b gz ol mt l mu mv">})</span></pre><p id="bb74" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后是创建订阅的实际函数</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="om on l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">createSubscription.ts</figcaption></figure><h1 id="be86" class="mw mr ir bd mx my mz na nb nc nd ne nf jx ng jy nh ka ni kb nj kd nk ke nl nm bi translated">准备前端</h1><p id="492a" class="pw-post-body-paragraph kx ky ir kz b la nn js lc ld no jv lf lg np li lj lk nq lm ln lo nr lq lr ls ik bi translated">我们正在创建与ReactJs应用程序的集成。您需要安装两个库。</p><pre class="kh ki kj kk gu ml mm mn mo aw mp bi"><span id="b73e" class="mq mr ir mm b gz ms mt l mu mv">yarn add <a class="ae kw" href="http://twitter.com/stripe/react-stripe-js" rel="noopener ugc nofollow" target="_blank">@stripe/react-stripe-js</a> <a class="ae kw" href="http://twitter.com/stripe/stripe-js" rel="noopener ugc nofollow" target="_blank">@stripe/stripe-js</a></span></pre><p id="28f4" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后初始化Stripe实例并包装您的应用程序。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="om on l"/></div></figure><p id="f181" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">注意我们有一个<code class="fe nu nv nw mm b">CheckoutForm</code>组件。让我们来创造它。它会照顾整个流程。</p><p id="66f9" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">让我们来看看主要功能</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="om on l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">createSubscription.ts</figcaption></figure><p id="3b57" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在此功能中:</p><ol class=""><li id="5cfb" class="nx ny ir kz b la lb ld le lg nz lk oa lo ob ls oc od oe of bi translated">我们通过使用Stripe提供的<code class="fe nu nv nw mm b">CardElement</code>获取详细信息来创建支付方法。</li><li id="0f95" class="nx ny ir kz b la og ld oh lg oi lk oj lo ok ls oc od oe of bi translated">然后我们调用后端，在那里会为我们创建一个订阅。</li><li id="12d9" class="nx ny ir kz b la og ld oh lg oi lk oj lo ok ls oc od oe of bi translated">然后我们从后台取回<code class="fe nu nv nw mm b">clientSecret</code>，可以用来确认支付。</li><li id="09cb" class="nx ny ir kz b la og ld oh lg oi lk oj lo ok ls oc od oe of bi translated">如果一切顺利，那么我们将有一个工作订阅！</li></ol><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj oo"><img src="../Images/d7fdbceb060d597a91a6b017f5b1bf4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AsLvPR9YK7Co80p9SU0xow.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Active Subscription</figcaption></figure><p id="7dde" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">就是这样！</p><h1 id="a1b9" class="mw mr ir bd mx my mz na nb nc nd ne nf jx ng jy nh ka ni kb nj kd nk ke nl nm bi translated">最终代码:</h1><p id="d5ee" class="pw-post-body-paragraph kx ky ir kz b la nn js lc ld no jv lf lg np li lj lk nq lm ln lo nr lq lr ls ik bi translated">最终的组件将是这样的。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="om on l"/></div></figure><p id="4af3" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">大概就是这样。希望你今天学到了新东西！</p><pre class="kh ki kj kk gu ml mm mn mo aw mp bi"><span id="0774" class="mq mr ir mm b gz ms mt l mu mv">You can reach out to me via <a class="ae kw" href="https://www.linkedin.com/in/56faisal/" rel="noopener ugc nofollow" target="_blank"><strong class="mm is">LinkedIN</strong></a> or my <a class="ae kw" href="https://www.mohammadfaisal.dev/blog" rel="noopener ugc nofollow" target="_blank"><strong class="mm is">Personal Website</strong></a></span></pre><div class="lt lu gq gs lv lw"><a rel="noopener  ugc nofollow" target="_blank" href="/45-npm-packages-to-solve-16-react-problems-a9ab18946224"><div class="lx ab fp"><div class="ly ab lz cl cj ma"><h2 class="bd is gz z fq mb fs ft mc fv fx iq bi translated">45个NPM软件包解决16个React问题</h2><div class="md l"><h3 class="bd b gz z fq mb fs ft mc fv fx dk translated">关于如何选择完美的npm包的深入指导</h3></div><div class="me l"><p class="bd b dl z fq mb fs ft mc fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="mf l"><div class="op l mh mi mj mf mk kq lw"/></div></div></a></div><h2 id="e8f4" class="mq mr ir bd mx oq or dn nb os ot dp nf lg ou ov nh lk ow ox nj lo oy oz nl pa bi translated">资源:</h2><p id="55af" class="pw-post-body-paragraph kx ky ir kz b la nn js lc ld no jv lf lg np li lj lk nq lm ln lo nr lq lr ls ik bi translated"><a class="ae kw" href="https://stripe.com/docs/billing/subscriptions/build-subscriptions?ui=checkout" rel="noopener ugc nofollow" target="_blank">https://stripe . com/docs/billing/subscriptions/build-subscriptions？ui =结帐</a></p></div></div>    
</body>
</html>