<html>
<head>
<title>Why Axios Can Be Used Both in Browser and Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么Axios可以在浏览器和Node.js中同时使用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/why-axios-can-be-used-both-in-browser-and-node-js-5b88206f70f?source=collection_archive---------6-----------------------#2022-07-11">https://javascript.plainenglish.io/why-axios-can-be-used-both-in-browser-and-node-js-5b88206f70f?source=collection_archive---------6-----------------------#2022-07-11</a></blockquote><div><div class="fc ic id ie if ig"/><div class="ih ii ij ik il"><div class=""/><div class=""><h2 id="45b5" class="pw-subtitle-paragraph jl in io bd b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc dk translated">axios如何兼容两种不同的请求方法</h2></div><figure class="ke kf kg kh gu ki gi gj paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gi gj kd"><img src="../Images/7f3647a3afb6ae1dcd3166df88a3fe07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8VnEnDm0sI8R9J11"/></div></div><figcaption class="kp kq gk gi gj kr ks bd b be z dk">Photo by <a class="ae kt" href="https://unsplash.com/@lucabravo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Luca Bravo</a> on <a class="ae kt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="f8fd" class="ku kv io bd kw kx ky kz la lb lc ld le ju lf jv lg jx lh jy li ka lj kb lk ll bi translated">前言</h1><p id="9bab" class="pw-post-body-paragraph lm ln io lo b lp lq jp lr ls lt js lu lv lw lx ly lz ma mb mc md me mf mg mh ih bi translated">Axios有一个很棒的特性<code class="fe mi mj mk ml b">isomorphic</code>，这也是我喜欢用axios作为web apps的请求库的原因之一。<code class="fe mi mj mk ml b">isomorphic</code>意味着axios代码可以在浏览器和Node.js中运行。</p><p id="ea8e" class="pw-post-body-paragraph lm ln io lo b lp mm jp lr ls mn js lu lv mo lx ly lz mp mb mc md mq mf mg mh ih bi translated">我们都知道在浏览器中发送请求依赖于XMLHttpRequest构造函数或者Fetch API，在node.js中依赖于node.js提供的HTTP模块，同样的代码库，axios如何兼容两种不同的请求方式。</p><h1 id="255c" class="ku kv io bd kw kx ky kz la lb lc ld le ju lf jv lg jx lh jy li ka lj kb lk ll bi translated">axios请求的步骤</h1><p id="5b9c" class="pw-post-body-paragraph lm ln io lo b lp lq jp lr ls lt js lu lv lw lx ly lz ma mb mc md me mf mg mh ih bi translated">为了回答这个问题，我们需要了解axios的请求步骤。</p><figure class="ke kf kg kh gu ki gi gj paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gi gj mr"><img src="../Images/dad7712891073205ce1a6e0d5c37490a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HzmDFhRUMl20N8NS6ODraA.png"/></div></div><figcaption class="kp kq gk gi gj kr ks bd b be z dk">process of axios request</figcaption></figure><p id="64c9" class="pw-post-body-paragraph lm ln io lo b lp mm jp lr ls mn js lu lv mo lx ly lz mp mb mc md mq mf mg mh ih bi translated">当我们发送请求时，至少有7个步骤:</p><ol class=""><li id="b27d" class="ms mt io lo b lp mm ls mn lv mu lz mv md mw mh mx my mz na bi translated">我们启动一个请求，我们需要提供URL、参数等。</li><li id="74a1" class="ms mt io lo b lp nb ls nc lv nd lz ne md nf mh mx my mz na bi translated">Axios将执行请求的拦截器</li><li id="4d22" class="ms mt io lo b lp nb ls nc lv nd lz ne md nf mh mx my mz na bi translated">Axios将转换请求数据，如序列化参数、添加头等。</li><li id="6322" class="ms mt io lo b lp nb ls nc lv nd lz ne md nf mh mx my mz na bi translated">Axios将通过请求的适配器将请求发送到服务器。</li><li id="776b" class="ms mt io lo b lp nb ls nc lv nd lz ne md nf mh mx my mz na bi translated">Axios将转换响应数据，比如transform JSON。</li><li id="e9cf" class="ms mt io lo b lp nb ls nc lv nd lz ne md nf mh mx my mz na bi translated">Axios将执行响应拦截器。</li><li id="97a6" class="ms mt io lo b lp nb ls nc lv nd lz ne md nf mh mx my mz na bi translated">我们终于可以处理回应了。</li></ol><p id="8fcd" class="pw-post-body-paragraph lm ln io lo b lp mm jp lr ls mn js lu lv mo lx ly lz mp mb mc md mq mf mg mh ih bi translated">当我们在浏览器和node.js中使用axios时，会有不同的适配器。</p><h1 id="74a8" class="ku kv io bd kw kx ky kz la lb lc ld le ju lf jv lg jx lh jy li ka lj kb lk ll bi translated">axios的适配器</h1><p id="cab8" class="pw-post-body-paragraph lm ln io lo b lp lq jp lr ls lt js lu lv lw lx ly lz ma mb mc md me mf mg mh ih bi translated">Axios对请求使用两个适配器，浏览器使用XMLHttpRequest，Node.js使用HTTP模块。Axios将根据允许的环境判断使用哪个适配器:</p><pre class="ke kf kg kh gu ng ml nh ni aw nj bi"><span id="b811" class="nk kv io ml b gz nl nm l nn no">// Code from <a class="ae kt" href="https://github.com/axios/axios/blob/bc733fec78326609e751187c9d453cee9bf1993a/lib/defaults/index.js#L19" rel="noopener ugc nofollow" target="_blank">axios/index.js at bc733fec78326609e751187c9d453cee9bf1993a · axios/axios (github.com)</a><br/>function getDefaultAdapter() {<br/>  var adapter;<br/>  if (typeof XMLHttpRequest !== 'undefined') {<br/>    // For browsers use XHR adapter<br/>    adapter = require('../adapters/xhr');<br/>  } else if (typeof process !== 'undefined' &amp;&amp; Object.prototype.toString.call(process) === '[object process]') {<br/>    // For node use HTTP adapter<br/>    adapter = require('../adapters/http');<br/>  }<br/>  return adapter;<br/>}</span></pre><p id="5386" class="pw-post-body-paragraph lm ln io lo b lp mm jp lr ls mn js lu lv mo lx ly lz mp mb mc md mq mf mg mh ih bi translated">当我们在Node.js中使用axios时，由于node.js中没有XMLHttpRequest，但是有一个process对象，axios会使用由Node.js HTTP/HTTPS模块实现的<code class="fe mi mj mk ml b">http</code>适配器。</p><p id="d638" class="pw-post-body-paragraph lm ln io lo b lp mm jp lr ls mn js lu lv mo lx ly lz mp mb mc md mq mf mg mh ih bi translated">当我们在浏览器中使用axios时，因为所有浏览器都有XMLHttpRequest，所以会使用<code class="fe mi mj mk ml b">xhr</code>的适配器。</p><p id="fd9d" class="pw-post-body-paragraph lm ln io lo b lp mm jp lr ls mn js lu lv mo lx ly lz mp mb mc md mq mf mg mh ih bi translated">如果web app是用webpack构建的，代码会略有不同。构建后的代码是:</p><pre class="ke kf kg kh gu ng ml nh ni aw nj bi"><span id="93f3" class="nk kv io ml b gz nl nm l nn no">// code after webpack's build<br/>function getDefaultAdapter() {<br/>  var adapter;<br/>  if (typeof XMLHttpRequest !== 'undefined') {<br/>    // For browsers use XHR adapter<br/>    adapter = __webpack_require__(448);<br/>  } else if (typeof process !== 'undefined' &amp;&amp; Object.prototype.toString.call(process) === '[object process]') {<br/>    // For node use HTTP adapter<br/>    adapter = __webpack_require__(448); // same with XHR<br/>  }<br/>  return adapter;<br/>}</span></pre><p id="d426" class="pw-post-body-paragraph lm ln io lo b lp mm jp lr ls mn js lu lv mo lx ly lz mp mb mc md mq mf mg mh ih bi translated">可以发现适配器都使用XHR适配器。你好奇webpack是怎么做到的吗？</p><p id="4d97" class="pw-post-body-paragraph lm ln io lo b lp mm jp lr ls mn js lu lv mo lx ly lz mp mb mc md mq mf mg mh ih bi translated">在axios的package.json文件中，浏览器字段配置为:</p><pre class="ke kf kg kh gu ng ml nh ni aw nj bi"><span id="2164" class="nk kv io ml b gz nl nm l nn no">// config from axios <a class="ae kt" href="https://github.com/axios/axios/blob/bc733fec78326609e751187c9d453cee9bf1993a/package.json#L70" rel="noopener ugc nofollow" target="_blank">https://github.com/axios/axios/blob/bc733fec78326609e751187c9d453cee9bf1993a/package.json#L70</a></span><span id="91c1" class="nk kv io ml b gz np nm l nn no">"browser": {    <br/>  "./lib/adapters/http.js": "./lib/adapters/xhr.js",      <br/>  "./lib/defaults/env/FormData.js": "./lib/helpers/null.js"  <br/>}</span></pre><p id="159f" class="pw-post-body-paragraph lm ln io lo b lp mm jp lr ls mn js lu lv mo lx ly lz mp mb mc md mq mf mg mh ih bi translated">使用webpack构建web应用程序时，将默认使用浏览器配置信息。所以HTTP的适配器将被XHR取代。</p><h1 id="508d" class="ku kv io bd kw kx ky kz la lb lc ld le ju lf jv lg jx lh jy li ka lj kb lk ll bi translated">结论</h1><p id="dd59" class="pw-post-body-paragraph lm ln io lo b lp lq jp lr ls lt js lu lv lw lx ly lz ma mb mc md me mf mg mh ih bi translated">在这篇帖子里，我解释了为什么axios可以同时在browser和Node.js中运行，适应不同环境的请求，根据XMLHttpRequest判断浏览器环境，通过process object判断Node.js环境。</p><p id="9bef" class="pw-post-body-paragraph lm ln io lo b lp mm jp lr ls mn js lu lv mo lx ly lz mp mb mc md mq mf mg mh ih bi translated">最后，希望这篇文章对你有帮助。我期待你能关注我，我会分享更多实用的文章。</p><p id="4b1c" class="pw-post-body-paragraph lm ln io lo b lp mm jp lr ls mn js lu lv mo lx ly lz mp mb mc md mq mf mg mh ih bi translated"><em class="nq">更多内容请看</em><a class="ae kt" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lo ip"><em class="nq">plain English . io</em></strong></a><em class="nq">。报名参加我们的</em> <a class="ae kt" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lo ip"> <em class="nq">免费周报</em> </strong> </a> <em class="nq">。关注我们关于</em><a class="ae kt" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="lo ip"><em class="nq">Twitter</em></strong></a><em class="nq">和</em><a class="ae kt" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="lo ip"><em class="nq">LinkedIn</em></strong></a><em class="nq">。查看我们的</em> <a class="ae kt" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="lo ip"> <em class="nq">社区不和谐</em> </strong> </a> <em class="nq">加入我们的</em> <a class="ae kt" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="lo ip"> <em class="nq">人才集体</em> </strong> </a> <em class="nq">。</em></p></div></div>    
</body>
</html>