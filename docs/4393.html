<html>
<head>
<title>Add Angular 15 Missing Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">添加Angular 15缺失文件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/add-angular-15-missing-files-b90a1dbcea89?source=collection_archive---------2-----------------------#2022-11-29">https://javascript.plainenglish.io/add-angular-15-missing-files-b90a1dbcea89?source=collection_archive---------2-----------------------#2022-11-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/1279cb3c5794579b154519fdb9b28d8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dbgEraQFyrfms4aNJ_HZHQ.jpeg"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Add Angular 15 Missing Files (Enviroments, Karma, Test, And Polyfills)</figcaption></figure><div class=""/><p id="df4b" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Angular 15已经发布了大量有趣的新功能</p><p id="da75" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">但我发现人们抱怨的一件事是，当你使用<code class="fe kx ky kz la b">ng new</code>或<code class="fe kx ky kz la b">npm init @angular@latest</code>时，现在有一些文件丢失了，虽然这是一个很好的理由——为了使新项目简单——有些人需要恢复其中的一些或全部，在这篇文章中，我将帮助你恢复每个文件，但请只在你需要时这样做</p><h1 id="3d0f" class="lb lc jc bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">1.环境文件</h1><p id="ebdb" class="pw-post-body-paragraph jz ka jc kb b kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw ig bi translated"><em class="me">注意:</em>开始用<strong class="kb jd">角度15.1 </strong>可以用<code class="fe kx ky kz la b">ng g environments</code>自动调至</p><p id="a7d8" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这可能是最显著的变化，因为每个人都将它们用于API URL，在我们讨论如何恢复它们之前，这里的问题是，您是否有一个用于生产和本地(或多个，本地、开发、stg、生产…)的API URL</p><p id="a612" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果您的答案是否定的，并且您总是只使用一个链接，那么不用担心，只需创建一个简单的<code class="fe kx ky kz la b">environment.ts</code>文件并导出您正在使用的所有变量，但是忽略那里的<code class="fe kx ky kz la b">production: false | true</code></p><p id="7d91" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果答案是肯定的，那么你将需要更多的努力，但仍然很容易</p><p id="5df5" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">像以前一样创建你的<code class="fe kx ky kz la b">environment.ts</code>和<code class="fe kx ky kz la b">environment.prod.ts</code>，再次忽略<code class="fe kx ky kz la b">production: false | true</code></p><p id="733a" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">然后在<code class="fe kx ky kz la b">angular.json</code>文件的<code class="fe kx ky kz la b">project/projects/project-name/architect/build/configurations/production</code>里面添加这几行</p><pre class="mf mg mh mi gt mj la mk bn ml mm bi"><span id="45a7" class="mn lc jc la b be mo mp l mq mr">"fileReplacements": [<br/>  {<br/>    "replace": "src/environments/environment.ts",<br/>    "with": "src/environments/environment.prod.ts"<br/>  }<br/>]</span></pre><p id="8dc2" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这一直是<code class="fe kx ky kz la b">environment</code>在构建时被其产品版本取代的原因</p><p id="cc8a" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">要了解更多信息，请访问<a class="ae ms" href="https://angular.io/guide/build#configuring-application-environments" rel="noopener ugc nofollow" target="_blank">角度文档</a></p><h1 id="eb9b" class="lb lc jc bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">2.karma文件</h1><p id="b957" class="pw-post-body-paragraph jz ka jc kb b kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw ig bi translated"><em class="me">注意:</em>从<strong class="kb jd">角度15.1开始</strong>你可以用<code class="fe kx ky kz la b">ng g config</code>然后选择<code class="fe kx ky kz la b">karma</code>来自动进行</p><p id="7865" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe kx ky kz la b">karma.conf.js</code>文件也不在那里——人们通常会更改它以添加代码覆盖率——所以在添加它之后，您需要再次更改<code class="fe kx ky kz la b">/projects/project-name/architect/test/options</code>中的<code class="fe kx ky kz la b">angular.json</code>文件并添加</p><pre class="mf mg mh mi gt mj la mk bn ml mm bi"><span id="fcd0" class="mn lc jc la b be mo mp l mq mr">"options": {<br/>  ...<br/>  "karmaConfig": "karma.conf.js"<br/>}</span></pre><p id="b918" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这是一个代码覆盖率为80%的样本文件</p><pre class="mf mg mh mi gt mj la mk bn ml mm bi"><span id="1e13" class="mn lc jc la b be mo mp l mq mr">// Karma configuration file, see link for more information<br/>// https://karma-runner.github.io/1.0/config/configuration-file.html<br/><br/>module.exports = function (config) {<br/>  config.set({<br/>    basePath: '',<br/>    frameworks: ['jasmine', '@angular-devkit/build-angular'],<br/>    plugins: [<br/>      require('karma-jasmine'),<br/>      require('karma-chrome-launcher'),<br/>      require('karma-jasmine-html-reporter'),<br/>      require('karma-coverage'),<br/>      require('@angular-devkit/build-angular/plugins/karma')<br/>    ],<br/>    client: {<br/>      jasmine: {<br/>        // you can add configuration options for Jasmine here<br/>        // the possible options are listed at https://jasmine.github.io/api/edge/Configuration.html<br/>        // for example, you can disable the random execution with `random: false`<br/>        // or set a specific seed with `seed: 4321`<br/>      },<br/>      clearContext: false // leave Jasmine Spec Runner output visible in browser<br/>    },<br/>    jasmineHtmlReporter: {<br/>      suppressAll: true // removes the duplicated traces<br/>    },<br/>    coverageReporter: {<br/>      dir: require('path').join(__dirname, './coverage/learn-ngrx'),<br/>      subdir: '.',<br/>      reporters: [<br/>        { type: 'html' },<br/>        { type: 'text-summary' }<br/>      ],<br/>      check: {<br/>        global: {<br/>          statements: 80,<br/>          branches: 80,<br/>          functions: 80,<br/>          lines: 80<br/>        }<br/>      }<br/>    },<br/>    reporters: ['progress', 'kjhtml'],<br/>    port: 9876,<br/>    colors: true,<br/>    logLevel: config.LOG_INFO,<br/>    autoWatch: true,<br/>    browsers: ['Chrome'],<br/>    singleRun: false,<br/>    restartOnFileChange: true<br/>  });<br/>};</span></pre><p id="1d83" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">要获得最新的配置版本，请访问<a class="ae ms" href="https://angular.io/guide/testing#configuration" rel="noopener ugc nofollow" target="_blank">角度文档</a></p><h1 id="cd5f" class="lb lc jc bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">3.测试文件</h1><p id="6e0c" class="pw-post-body-paragraph jz ka jc kb b kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw ig bi translated"><code class="fe kx ky kz la b">test.ts</code>文件很少被修改，在某些情况下，最好添加一个脚本而不是修改它，以防万一，比如你想让它失败，如果有任何错误，你应该添加一个文件(如<code class="fe kx ky kz la b">fail-on-error.js</code>)</p><pre class="mf mg mh mi gt mj la mk bn ml mm bi"><span id="8322" class="mn lc jc la b be mo mp l mq mr">console.error = function(message?: any): void {<br/>    fail(`Test contained console error:\n${message}`);<br/>};</span></pre><p id="5726" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">然后在里面<code class="fe kx ky kz la b">/projects/project-name/architect/test/options</code></p><pre class="mf mg mh mi gt mj la mk bn ml mm bi"><span id="1f67" class="mn lc jc la b be mo mp l mq mr">"options": {<br/>  ...<br/>  "scripts": ["fail-on-error.js"]<br/>}</span></pre><p id="9098" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">但是如果你想替换<code class="fe kx ky kz la b">test.ts</code>而不是添加到它，那么不要添加<code class="fe kx ky kz la b">scripts</code>而要添加<code class="fe kx ky kz la b">main</code></p><pre class="mf mg mh mi gt mj la mk bn ml mm bi"><span id="4cd4" class="mn lc jc la b be mo mp l mq mr">"options": {<br/>  "main": "src/test.ts",<br/>  ...<br/>}</span></pre><p id="eb4f" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">要实现这一点，还需要做一个改变，就是在<code class="fe kx ky kz la b">tsconfig.spec.json</code>中添加新的<code class="fe kx ky kz la b">test.ts</code>,如下所示</p><pre class="mf mg mh mi gt mj la mk bn ml mm bi"><span id="09b2" class="mn lc jc la b be mo mp l mq mr">/* To learn more about this file see: https://angular.io/config/tsconfig. */<br/>{<br/>  "extends": "./tsconfig.json",<br/>  "compilerOptions": {<br/>    "outDir": "./out-tsc/spec",<br/>    "types": [<br/>      "jasmine"<br/>    ]<br/>  },<br/>  "files": [<br/>    "src/test.ts"    &lt;-----<br/>  ],<br/>  "include": [<br/>    "src/**/*.spec.ts",<br/>    "src/**/*.d.ts"<br/>  ]<br/>}</span></pre><p id="bf99" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">采样<code class="fe kx ky kz la b">test.ts</code>以启用<code class="fe kx ky kz la b">errorOnUnknownElements</code>和<code class="fe kx ky kz la b">errorOnUnknownProperties</code></p><pre class="mf mg mh mi gt mj la mk bn ml mm bi"><span id="3c23" class="mn lc jc la b be mo mp l mq mr">// This file is required by karma.conf.js and loads recursively all the .spec and framework files<br/><br/>import 'zone.js/testing';<br/>import { getTestBed } from '@angular/core/testing';<br/>import {<br/>  BrowserDynamicTestingModule,<br/>  platformBrowserDynamicTesting<br/>} from '@angular/platform-browser-dynamic/testing';<br/><br/>// First, initialize the Angular testing environment.<br/>getTestBed().initTestEnvironment(<br/>  BrowserDynamicTestingModule,<br/>  platformBrowserDynamicTesting(),<br/>  { <br/>    errorOnUnknownElements: true,<br/>    errorOnUnknownProperties: true<br/>  }<br/>);</span></pre><h1 id="b039" class="lb lc jc bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">4.多填充物</h1><p id="0eb7" class="pw-post-body-paragraph jz ka jc kb b kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw ig bi translated"><code class="fe kx ky kz la b">polyfills.ts</code>也被删除，我相信这是修改最少的文件，但是Angular团队给了我们一个更好的选择，将多填充路径直接添加到<code class="fe kx ky kz la b">angular.json</code>文件中</p><p id="6d9b" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">例如，如果你想要<code class="fe kx ky kz la b">core-js/actual/array/from</code>，你可以修改<code class="fe kx ky kz la b">/projects/project-name/architect/build/options/polyfills</code>为</p><pre class="mf mg mh mi gt mj la mk bn ml mm bi"><span id="f553" class="mn lc jc la b be mo mp l mq mr">"polyfills": [<br/>  "zone.js",<br/>  "core-js/actual/array/from"<br/>],</span></pre><p id="77db" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">就这些，阅读<a class="ae ms" href="https://angular.io/guide/browser-support#polyfills" rel="noopener ugc nofollow" target="_blank">角度文档</a>了解更多信息</p><h1 id="b944" class="lb lc jc bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">5.browserslistrc</h1><p id="a05f" class="pw-post-body-paragraph jz ka jc kb b kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw ig bi translated"><em class="me">注意:</em>开始用<strong class="kb jd">角度15.1 </strong>你可以用<code class="fe kx ky kz la b">ng g config</code>然后选择<code class="fe kx ky kz la b">browserslist</code>来自动调</p><p id="8a2a" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">实际上这很简单，只需在项目的根目录下创建它的<code class="fe kx ky kz la b">.browserslistrc</code>文件就可以了，阅读<a class="ae ms" href="https://angular.io/guide/build#configuring-browser-compatibility" rel="noopener ugc nofollow" target="_blank"> Angular文档</a>了解更多信息</p><p id="e38b" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">你可以在<a class="ae ms" href="https://github.com/robertIsaac/add-angular15-missing-files" rel="noopener ugc nofollow" target="_blank">GitHub回购</a>中看到回购示例</p><p id="72ad" class="pw-post-body-paragraph jz ka jc kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="me">更多内容请看</em><a class="ae ms" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kb jd"><em class="me">plain English . io</em></strong></a><em class="me">。报名参加我们的</em> <a class="ae ms" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kb jd"> <em class="me">免费周报</em> </strong> </a> <em class="me">。关注我们上</em><a class="ae ms" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kb jd"><em class="me">Twitter</em></strong></a><a class="ae ms" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kb jd"><em class="me">LinkedIn</em></strong></a><strong class="kb jd"><em class="me"/></strong><a class="ae ms" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kb jd"><em class="me">YouTube</em></strong></a><strong class="kb jd"><em class="me"/></strong><em class="me">和</em> <a class="ae ms" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kb jd"> <em class="me">不和</em> </strong> </a>  <em class="me">对成长黑客感兴趣？检查</em> <a class="ae ms" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kb jd"> <em class="me">电路</em> </strong> </a> <strong class="kb jd"> <em class="me">。</em> </strong></p></div></div>    
</body>
</html>