<html>
<head>
<title>Rendering Contentful Rich Text Components in Gatsby</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在《盖茨比》中呈现内容丰富的文本组件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/rendering-contentful-rich-text-components-in-gatsby-4744d4940cea?source=collection_archive---------10-----------------------#2022-06-24">https://javascript.plainenglish.io/rendering-contentful-rich-text-components-in-gatsby-4744d4940cea?source=collection_archive---------10-----------------------#2022-06-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b681" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">修复了更新Gatsby和依赖项后的渲染</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8406f6347d3f43a300410b71c8670e39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nk_a5o-6-xQ8cGHKGWn1TQ.jpeg"/></div></div></figure><p id="f7d6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">嘿，盖茨比迷！</p><p id="9f2c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将跳过细枝末节，直奔主题。</p><p id="967e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">几天前，我更新了盖茨比网站上的依赖项，大约一年没碰过它了。你知道这意味着什么，对吧？</p><p id="c5c0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">可怕，可怕的混乱。所有东西都坏了，但是大多数错误在实际阅读错误文本后相对容易修复。</p><p id="9d72" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，最让我头疼的是在富文本组件中呈现图像，用GraphQL从Contentful查询。</p><p id="24da" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我的旧代码看起来像这样:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="a699" class="ls lt iq lo b gy lu lv l lw lx">export const pageQuery = graphql`<br/>  query ContentfulBlogPost($slug: String!) {<br/>    contentfulPost(slug: { eq: $slug }) {<br/>      id<br/>      title<br/>      subtitle<br/>      slug<br/>      date(formatString: "Do MMMM, YYYY")<br/>      excerpt<br/>      content {<br/>        json<br/>      }<br/>      description {<br/>        description<br/>        childMarkdownRemark {<br/>          timeToRead<br/>          html<br/>          rawMarkdownBody<br/>        }<br/>      }<br/>    }<br/>    site {<br/>      siteMetadata {<br/>        title<br/>        siteUrl<br/>      }<br/>    }<br/>  }<br/>`;</span></pre><p id="df58" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用数据的Gatsby组件看起来是这样的——为了更容易理解，我删除了不相关的代码:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="44b8" class="ls lt iq lo b gy lu lv l lw lx">class BlogPostTemplate extends React.Component {<br/>  render() {<br/>    const post = this.props.data.contentfulPost;<br/>    const siteTitle = this.props.data.site.siteMetadata.title;<br/>    const blogContent = this.props.data.contentfulPost.content<br/>      .json;<br/>    const title = post.title;<br/>    const image = post.featuredImage.fluid.src;<br/>    const location = this.props.location;</span><span id="59f4" class="ls lt iq lo b gy ly lv l lw lx">const Bold = ({ children }) =&gt; &lt;b&gt;{children}&lt;/b&gt;;<br/>    const Italic = ({ children }) =&gt; &lt;i&gt;{children}&lt;/i&gt;;</span><span id="0d27" class="ls lt iq lo b gy ly lv l lw lx">const options = {<br/>      renderMark: {<br/>        [MARKS.BOLD]: (text) =&gt; &lt;Bold&gt;{text}&lt;/Bold&gt;,<br/>        [MARKS.ITALIC]: (text) =&gt; &lt;Italic&gt;{text}&lt;/Italic&gt;,<br/>      },<br/>      renderNode: {<br/>        [BLOCKS.PARAGRAPH]: (node, children) =&gt; {<br/>          return &lt;TextMedium textMedium={children} /&gt;;<br/>        },<br/>        [BLOCKS.HEADING_2]: (node, children) =&gt; {<br/>          return &lt;Subtitle subtitle={children} /&gt;;<br/>        },<br/>        [BLOCKS.HEADING_3]: (node, children) =&gt; {<br/>          return &lt;Heading heading={children} /&gt;;<br/>        },<br/>        [BLOCKS.EMBEDDED_ASSET]: (node) =&gt; {<br/>          const alt = node.data.target.fields.title["en-US"];<br/>          const url = node.data.target.fields.file["en-US"].url;<br/>          return &lt;img alt={alt} src={url} /&gt;;<br/>        },<br/>        [INLINES.HYPERLINK]: (node, children) =&gt; {<br/>          return (<br/>            &lt;a className="link" href={node.data.uri}&gt;<br/>              {node.content[0].value}<br/>            &lt;/a&gt;<br/>          );<br/>        },<br/>      },<br/>      blockquote: (node) =&gt; {<br/>        return (<br/>          &lt;blockquote className="offer"&gt;<br/>            {node.content}<br/>          &lt;/blockquote&gt;<br/>        );<br/>      },<br/>      hyperlink: (node) =&gt; {<br/>        const altText = node.content[0].value;<br/>        const url = node.data.uri;<br/>        return (<br/>          &lt;a className="link" href={url}&gt;<br/>            {altText}<br/>          &lt;/a&gt;<br/>        );<br/>      },<br/>    };</span><span id="4728" class="ls lt iq lo b gy ly lv l lw lx">return (<br/>      &lt;Layout location={location} title={siteTitle}&gt;<br/>        &lt;SEO<br/>          title={title}<br/>          description={post.excerpt}<br/>          pathname={location.pathname}<br/>          featuredImage={image}<br/>        /&gt;<br/>        &lt;Row&gt;<br/>          &lt;Breadcrumb&gt;<br/>            &lt;li&gt;<br/>              &lt;a href="/blog/"&gt;Blog home&lt;/a&gt;<br/>            &lt;/li&gt;<br/>            &lt;li&gt;<br/>              &lt;a href={`${post.slug}`}&gt;{title}&lt;/a&gt;<br/>            &lt;/li&gt;<br/>          &lt;/Breadcrumb&gt;<br/>        &lt;/Row&gt;<br/>        &lt;Section isCentered isNarrow&gt;<br/>          &lt;Row isCentered wrap&gt;<br/>            &lt;Title title={title} isCentered /&gt;<br/>            &lt;SubHeading subheading={post.subtitle} isCentered /&gt;<br/>          &lt;/Row&gt;<br/>          &lt;Row isCentered&gt;<br/>            &lt;Column100&gt;<br/>              &lt;BlogBody&gt;<br/>                {documentToReactComponents(blogContent, options)}<br/>              &lt;/BlogBody&gt;<br/>              &lt;ReturnLink<br/>                isCentered<br/>                anchortext="Return to all articles"<br/>                href="/blog/"<br/>              /&gt;<br/>            &lt;/Column100&gt;<br/>          &lt;/Row&gt;<br/>          &lt;Subscribe /&gt;<br/>        &lt;/Section&gt;<br/>      &lt;/Layout&gt;<br/>    );<br/>  }<br/>}</span><span id="2d8c" class="ls lt iq lo b gy ly lv l lw lx">export default BlogPostTemplate;</span></pre><p id="c359" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用Contentful富文本组件的Gatsby组件是<blogbody>，代码如下:</blogbody></p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="d3aa" class="ls lt iq lo b gy lu lv l lw lx">&lt;BlogBody&gt;<br/>   {documentToReactComponents(blogContent, options)}<br/>&lt;/BlogBody&gt;</span></pre><p id="8fe6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不再起作用的是:embedded_asset块。我在这里显示了这两个选项，尽管我查询的是相同的数据。</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="3109" class="ls lt iq lo b gy lu lv l lw lx">[BLOCKS.EMBEDDED_ASSET]: (node) =&gt; {<br/>          const alt = node.data.target.fields.title["en-US"];<br/>          const url = node.data.target.fields.file["en-US"].url;<br/>          return &lt;img alt={alt} src={url} /&gt;;<br/>        },</span><span id="35a4" class="ls lt iq lo b gy ly lv l lw lx">OR:</span><span id="5f78" class="ls lt iq lo b gy ly lv l lw lx">"embedded-asset-block": (node) =&gt; {<br/>          const alt = node.data.target.fields.title["en-US"];<br/>          const url = node.data.target.fields.file["en-US"].url;<br/>          return &lt;img alt={alt} src={url} /&gt;;<br/>        },</span></pre><p id="5bd6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">重构版本—首先，查询的数据:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="055e" class="ls lt iq lo b gy lu lv l lw lx">export const pageQuery = graphql`<br/>  query ContentfulBlogPost($slug: String!) {<br/>    contentfulPost(slug: { eq: $slug }) {<br/>      id<br/>      title<br/>      subtitle<br/>      slug<br/>      date(formatString: "Do MMMM, YYYY")<br/>      excerpt<br/>      content {<br/>        raw<br/>        references {<br/>          ... on ContentfulAsset {<br/>            __typename<br/>            contentful_id<br/>            id<br/>            title<br/>            file {<br/>              url<br/>            }<br/>          }<br/>          gatsbyImageData(width: 400)<br/>        }<br/>      }<br/>      description {<br/>        childMarkdownRemark {<br/>          timeToRead<br/>          html<br/>          rawMarkdownBody<br/>        }<br/>      }<br/>    }<br/>    site {<br/>      siteMetadata {<br/>        title<br/>        siteUrl<br/>      }<br/>    }<br/>  }<br/>`;</span></pre><p id="169f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里的重要变化是,<code class="fe lz ma mb lo b">content { json }</code>数据被替换为:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="fd5e" class="ls lt iq lo b gy lu lv l lw lx">content {<br/>        raw<br/>        references {<br/>          ... on ContentfulAsset {<br/>            __typename<br/>            contentful_id<br/>            id<br/>            title<br/>            file {<br/>              url<br/>            }<br/>          }<br/>          gatsbyImageData(width: 400)<br/>        }<br/>      }</span></pre><p id="bf2e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">新的Gatsby组件看起来像这样——<code class="fe lz ma mb lo b">embedded_asset</code>块:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="7d48" class="ls lt iq lo b gy lu lv l lw lx">[BLOCKS.EMBEDDED_ASSET]: node =&gt; {<br/>          const url = node.data.target.file.url<br/>          const alt = node.data.target.title<br/>          return &lt;img alt={alt} src={url} /&gt;<br/>        },</span></pre><p id="5e55" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">而<code class="fe lz ma mb lo b">&lt;BlogBody&gt;</code>的分量:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="c4e5" class="ls lt iq lo b gy lu lv l lw lx">&lt;BlogBody&gt;<br/>   {blogContent?.raw &amp;&amp; renderRichText(blogContent, options)}<br/>&lt;/BlogBody&gt;</span></pre><p id="04fb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就是这样，现在可以用了:)</p><p id="76d9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我忘了保存实际的错误文本，所以如果你得到了那个难看的错误，并且在谷歌搜索了几个小时、几天、几周之后找到了这篇文章，请在下面的评论中添加错误文本。</p><p id="166d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="mc">更多内容看</em> <a class="ae md" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="mc">说白了就是</em> </strong> </a> <em class="mc">。报名参加我们的</em> <a class="ae md" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="mc">免费周报</em> </strong> </a> <em class="mc">。关注我们关于</em><a class="ae md" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="mc">Twitter</em></strong></a><em class="mc">和</em><a class="ae md" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="mc">LinkedIn</em></strong></a><em class="mc">。查看我们的</em> <a class="ae md" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="mc">社区不和谐</em> </strong> </a> <em class="mc">加入我们的</em> <a class="ae md" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="mc">人才集体</em> </strong> </a> <em class="mc">。</em></p></div></div>    
</body>
</html>