<html>
<head>
<title>Relearning the Front-End: JavaScript V8 Engine Mechanism</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重新学习前端:JavaScript V8引擎机制</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/relearning-the-front-end-javascript-v8-engine-mechanism-cc6457b43aff?source=collection_archive---------2-----------------------#2022-10-14">https://javascript.plainenglish.io/relearning-the-front-end-javascript-v8-engine-mechanism-cc6457b43aff?source=collection_archive---------2-----------------------#2022-10-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4569366773dedd624b0d104542dbaf8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Iy2ydwupUyw2ChDL"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@grakozy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Greg Rakozy</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8154" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我会花一个月的时间整理前端相关的知识。一方面我会巩固自己的技能。另一方面，我会用它来分享初级前端工程师的学习路径和高级前端工程师的知识复习。</p><p id="655c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总体文章目录</p><ul class=""><li id="8023" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated"><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/relearn-the-front-end-html-26a38c5ba196">重新学习前端— HTML </a></li><li id="d703" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/relearn-the-front-end-css-4d74eb5981f8">重新学习前端——CSS</a></li><li id="62a9" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/relearn-the-front-end-javascript-basics-d770eefd791f">重新学习前端——JavaScript基础知识</a></li><li id="9205" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/relearning-the-front-end-javascript-object-oriented-913077e735bf">重新学习前端——面向JavaScript对象</a></li><li id="2f93" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/relearning-the-front-end-javascript-v8-engine-mechanism-cc6457b43aff">重新学习前端— JavaScript V8引擎机制</a></li><li id="d734" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/relearning-the-front-end-browser-rendering-mechanism-efbfc19d225f">重新学习前端—浏览器渲染机制</a></li><li id="af48" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/relearn-the-front-end-browser-caching-strategy-21cd081886d">重新学习前端—浏览器缓存策略</a></li><li id="fb8a" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/relearn-the-front-end-sorting-algorithm-348f939632e0">重新学习前端—排序算法</a></li><li id="d263" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/relearning-the-front-end-design-patterns-e95444b6bdb">重新学习前端—设计模式</a></li><li id="e49c" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/relearn-the-front-end-network-b0402a870336">重新学习前端网络</a></li><li id="5a6f" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/relearning-the-front-end-front-end-security-bbc20ded6b12">重新学习前端—前端安全</a></li></ul><p id="479f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章是关于JavaScript V8引擎机制的。</p><h1 id="6749" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">1如何在V8中执行一段JS代码</h1><ul class=""><li id="64c5" class="lb lc iq kf b kg mn kk mo ko mp ks mq kw mr la lg lh li lj bi translated"><strong class="kf ir">预分析</strong>:检查语法错误，但不生成AST</li><li id="6e07" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><strong class="kf ir">生成AST </strong>:经过词法/语法分析，生成抽象语法树</li><li id="4676" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><strong class="kf ir">生成字节码</strong>:基线编译器(点火)将AST转换成字节码</li><li id="b794" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><strong class="kf ir">生成机器码</strong>:优化编译器(涡扇)将字节码转换成优化的机器码。另外，在逐行执行字节码的过程中，如果经常执行一段代码，V8会直接将这段代码转换保存为机器码，下一次执行不需要经过字节码，优化了执行速度</li></ul><h1 id="0176" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">2引用计数和标记清理简介</h1><ul class=""><li id="197c" class="lb lc iq kf b kg mn kk mo ko mp ks mq kw mr la lg lh li lj bi translated"><strong class="kf ir">引用计数</strong>:如果一个变量被赋予了引用类型，那么该对象的引用数为+1。如果变量变成另一个值，那么对象的引用数是-1，垃圾收集器将回收引用数为0的对象。但是，当对象被循环引用时，引用的次数永远不会归零，导致无法释放内存。</li><li id="7e27" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><strong class="kf ir">标记移除</strong>:垃圾收集器先标记内存中的所有对象，然后从根节点开始遍历，移除被引用对象和运行环境中对象的标记，剩下的标记对象不可访问，等待回收对象。</li></ul><h1 id="7685" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">V8如何执行垃圾收集</h1><p id="d44f" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">JS引擎中变量有两个主要的存储位置，堆栈内存和堆内存。堆栈内存存储基本类型数据和引用类型数据的内存地址，堆内存存储引用类型数据。</p><p id="d004" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">栈内存回收</strong>:调用栈上下文切换后，栈内存被回收，比较简单</p><p id="900d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">堆内存回收</strong> : V8的堆内存分为新一代内存和老一代内存。新一代内存是临时分配的内存，存在时间短，而老一代内存存在时间长。</p><h2 id="4251" class="mv lq iq bd lr mw mx dn lv my mz dp lz ko na nb md ks nc nd mh kw ne nf ml ng bi translated">新一代内存回收机制</h2><p id="1197" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">新一代的内存容量很小，在64位系统下只有32M。新生代的记忆分为两部分:从和到。执行垃圾回收时，首先扫描From，恢复非存活对象，存活对象按顺序复制到to，然后交换From/To，等待下一次恢复</p><h2 id="d245" class="mv lq iq bd lr mw mx dn lv my mz dp lz ko na nb md ks nc nd mh kw ne nf ml ng bi translated">老一代内存回收机制</h2><ul class=""><li id="affd" class="lb lc iq kf b kg mn kk mo ko mp ks mq kw mr la lg lh li lj bi translated"><strong class="kf ir">提升</strong>:如果多次采集后年轻一代的变量仍然存在，则放入老一代的记忆中</li><li id="3c64" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><strong class="kf ir">标记移除</strong>:老一代内存会先遍历所有对象并进行标记，然后取消正在使用或强引用的对象的标记，并回收已标记的对象</li><li id="d48d" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><strong class="kf ir">整理内存碎片</strong>:将对象移动到内存的一端</li></ul><h1 id="cc37" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">4.JS为什么比C++等语言慢，V8做了哪些优化？</h1><h2 id="085f" class="mv lq iq bd lr mw mx dn lv my mz dp lz ko na nb md ks nc nd mh kw ne nf ml ng bi translated">4.1的问题</h2><ul class=""><li id="159d" class="lb lc iq kf b kg mn kk mo ko mp ks mq kw mr la lg lh li lj bi translated"><strong class="kf ir">动态类型</strong>:每次访问属性/seek方法，都需要先检查类型；此外，动态类型很难在编译阶段进行优化</li><li id="97c3" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><strong class="kf ir">属性访问</strong>:在C++/Java等语言中，方法、属性存储在数组中，只能通过数组移位来获取，而JS存储在对象中，每次获取都要进行哈希查询。</li></ul><h2 id="d40b" class="mv lq iq bd lr mw mx dn lv my mz dp lz ko na nb md ks nc nd mh kw ne nf ml ng bi translated">4.2针对V8的优化</h2><ul class=""><li id="43c3" class="lb lc iq kf b kg mn kk mo ko mp ks mq kw mr la lg lh li lj bi translated"><strong class="kf ir">优化JIT</strong>(just-in-time compilation):与C++/Java等编译语言相比，JS是一边解释一边执行，效率较低。V8对这个过程进行了优化:如果一段代码执行了多次，V8会将这段代码转换成机器码并缓存，下次运行时直接使用机器码。</li><li id="ba7e" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><strong class="kf ir">隐藏类</strong>:对于C++等语言，只需要很少的指令就可以通过offset获取变量信息，而JS需要进行字符串匹配，效率很低。V8借用类和偏移位置的思想将对象划分成不同的组，即隐藏类。</li><li id="726e" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><strong class="kf ir">嵌入式缓存</strong>:即缓存对象查询的结果。一般的查询过程是:获取隐藏类地址- &gt;根据属性名查找偏移值- &gt;计算属性地址，嵌入式缓存就是这个过程结果的缓存。</li></ul><h1 id="869f" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">最后</h1><p id="2a34" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated"><strong class="kf ir">感谢阅读</strong>。期待您的关注，阅读更多高质量的文章。</p><div class="nh ni gp gr nj"><div role="button" tabindex="0" class="ab bv gv cb fp nk nl bn nm jw ex"><div class="nn l"><div class="ab q"><div class="l di"><img alt="omgzui" class="l de bw no np fe" src="../Images/113db82933227743d0067a68e250ac93.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*AmBIV4haXTWPO--EhE0Q1A.jpeg"/><div class="fb bw l no np fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@omgzui?source=post_page-----cc6457b43aff--------------------------------" rel="noopener follow" target="_top"> omgzui </a></p></div></div><div class="ns nt gw l"><h2 class="bd ir sz lb fp ta fr fs tb fu fw ip bi translated">更好的编程</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi tc au td te tf po tg an eh ei th ti tj el em eo de bk ep" href="https://medium.com/@omgzui/list/better-programing-9b4c9bb174aa?source=post_page-----cc6457b43aff--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="tk l fo"><span class="bd b dl z dk">109 stories</span></div></div></div><div class="of dh og fp ab oh fo di"><div class="di nx bv ny nz"><div class="dh l"><img alt="" class="dh" src="../Images/64fcf15e27c514ec49d62966b68dbc15.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*DbDdSUf5SchniJuq"/></div></div><div class="di nx bv oa ob oc"><div class="dh l"><img alt="" class="dh" src="../Images/3e6ce891363c151131c5993ca0dcc526.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*7cAp-WibSblfO7hT"/></div></div><div class="di bv od oe oc"><div class="dh l"><img alt="" class="dh" src="../Images/a7dd413de22f319a3c4729c9e737feb8.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*FcmHdVfoUOhlJlsG"/></div></div></div></div></div><div class="nh ni gp gr nj"><div role="button" tabindex="0" class="ab bv gv cb fp nk nl bn nm jw ex"><div class="nn l"><div class="ab q"><div class="l di"><img alt="omgzui" class="l de bw no np fe" src="../Images/113db82933227743d0067a68e250ac93.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*AmBIV4haXTWPO--EhE0Q1A.jpeg"/><div class="fb bw l no np fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@omgzui?source=post_page-----cc6457b43aff--------------------------------" rel="noopener follow" target="_top"> omgzui </a></p></div></div><div class="ns nt gw l"><h2 class="bd ir sz lb fp ta fr fs tb fu fw ip bi translated">Java Script语言</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi tc au td te tf po tg an eh ei th ti tj el em eo de bk ep" href="https://medium.com/@omgzui/list/javascript-48bfc7b5f93c?source=post_page-----cc6457b43aff--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="tk l fo"><span class="bd b dl z dk">57 stories</span></div></div></div><div class="of dh og fp ab oh fo di"><div class="di nx bv ny nz"><div class="dh l"><img alt="" class="dh" src="../Images/64fcf15e27c514ec49d62966b68dbc15.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*DbDdSUf5SchniJuq"/></div></div><div class="di nx bv oa ob oc"><div class="dh l"><img alt="" class="dh" src="../Images/3e6ce891363c151131c5993ca0dcc526.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*7cAp-WibSblfO7hT"/></div></div><div class="di bv od oe oc"><div class="dh l"><img alt="" class="dh" src="../Images/a7dd413de22f319a3c4729c9e737feb8.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*FcmHdVfoUOhlJlsG"/></div></div></div></div></div><div class="nh ni gp gr nj"><div role="button" tabindex="0" class="ab bv gv cb fp nk nl bn nm jw ex"><div class="nn l"><div class="ab q"><div class="l di"><img alt="omgzui" class="l de bw no np fe" src="../Images/113db82933227743d0067a68e250ac93.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*AmBIV4haXTWPO--EhE0Q1A.jpeg"/><div class="fb bw l no np fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@omgzui?source=post_page-----cc6457b43aff--------------------------------" rel="noopener follow" target="_top"> omgzui </a></p></div></div><div class="ns nt gw l"><h2 class="bd ir sz lb fp ta fr fs tb fu fw ip bi translated">新闻</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi tc au td te tf po tg an eh ei th ti tj el em eo de bk ep" href="https://medium.com/@omgzui/list/news-67ec0a972660?source=post_page-----cc6457b43aff--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="tk l fo"><span class="bd b dl z dk">23 stories</span></div></div></div><div class="of dh og fp ab oh fo di"><div class="di nx bv ny nz"><div class="dh l"><img alt="" class="dh" src="../Images/c3f36b36bf050f98fd5a8e3c89103cad.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*LISEmTdz19k7BAHY"/></div></div><div class="di nx bv oa ob oc"><div class="dh l"><img alt="" class="dh" src="../Images/8459df5aae62dc00f04377e09544be88.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*RvBGLw3V9JZfn_HO"/></div></div><div class="di bv od oe oc"><div class="dh l"><img alt="" class="dh" src="../Images/2864058bcedc8c1cd6492624ba9671c6.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*IUWVb3zTn1_HKV9P"/></div></div></div></div></div><p id="40c2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="om">更多内容请看</em><a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="om">plain English . io</em></strong></a><em class="om">。报名参加我们的</em> <a class="ae kc" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="om">免费周报</em> </strong> </a> <em class="om">。关注我们关于</em><a class="ae kc" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="om">Twitter</em></strong></a><a class="ae kc" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="om">LinkedIn</em></strong></a><strong class="kf ir"><em class="om"/></strong><a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="om">YouTube</em></strong></a><strong class="kf ir"><em class="om">，以及</em></strong><em class="om"/><a class="ae kc" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="om">不和</em> </strong> </a>  <em class="om">对成长黑客感兴趣？检查</em> <a class="ae kc" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="om">电路</em> </strong> </a> <strong class="kf ir"> <em class="om">。</em> </strong></p></div></div>    
</body>
</html>