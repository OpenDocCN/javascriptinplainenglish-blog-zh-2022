<html>
<head>
<title>Integration of Keycloak in TYK Gateway Middleware</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Keycloak在TYK网关中间件中的集成</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/integration-of-keycloak-in-tyk-gateway-middleware-26f8e5b760e3?source=collection_archive---------2-----------------------#2022-03-27">https://javascript.plainenglish.io/integration-of-keycloak-in-tyk-gateway-middleware-26f8e5b760e3?source=collection_archive---------2-----------------------#2022-03-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="37ef" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何使用Tyk Gateway(开源)中间件将Keycloak与REST API(多租户应用)集成，并为现有请求发送自定义头。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/36386a4a5e5f723bddd09a5e0ca63d7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9sOjSUr6bK4-rc0F"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@clemhlrdt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Clément Hélardot</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="aab1" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">介绍</h1><p id="058c" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">在本文中，我们的目的是了解如何使用<a class="ae ks" href="https://tyk.io/" rel="noopener ugc nofollow" target="_blank"> Tyk </a> <a class="ae ks" href="https://tyk.io/docs/plugins/supported-languages/javascript-middleware/middleware-scripting-guide/" rel="noopener ugc nofollow" target="_blank">网关中间件</a>来保护我们自己的<a class="ae ks" href="https://github.com/santoshshinde2012/node-boilerplate" rel="noopener ugc nofollow" target="_blank"> Node.js API </a>并从客户端发送当前请求的定制请求头。为了获得访问令牌，我们将使用<a class="ae ks" href="https://www.keycloak.org/" rel="noopener ugc nofollow" target="_blank"> Keycloak </a>。</p><p id="6451" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">那些不熟悉Tyk网关并希望了解该网关的基本特性的人可以参考我以前的文章，请参见下面的链接。</p><div class="mm mn gp gr mo mp"><a rel="noopener  ugc nofollow" target="_blank" href="/getting-started-with-tyk-open-source-on-your-local-machine-6468d1c4f7b"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd io gy z fp mu fr fs mv fu fw im bi translated">在本地机器上开始使用Tyk API Gateway</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">用Node.js和Express创建一个简单的API端点，然后创建一个本地TYK网关(开源)。</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="my l"><div class="mz l na nb nc my nd km mp"/></div></div></a></div><p id="6218" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">此外，我们已经在下面的文章中介绍了如何使用Keycloak开始使用Tyk api gateway。</p><div class="mm mn gp gr mo mp"><a rel="noopener  ugc nofollow" target="_blank" href="/getting-started-to-tyk-api-gateway-with-keycloak-16307435584a"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd io gy z fp mu fr fs mv fu fw im bi translated">使用Keycloak开始使用Tyk API网关</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">如何使用Tyk Gateway(开源)来保护Node.js API，拒绝来自</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="my l"><div class="ne l na nb nc my nd km mp"/></div></div></a></div><p id="1cb1" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">我们将在本文和POC中使用以下技术堆栈。</p><ol class=""><li id="be5a" class="nf ng in ln b lo mh lr mi lu nh ly ni mc nj mg nk nl nm nn bi translated"><a class="ae ks" href="https://tyk.io/" rel="noopener ugc nofollow" target="_blank"> TYK门户</a></li><li id="9012" class="nf ng in ln b lo no lr np lu nq ly nr mc ns mg nk nl nm nn bi translated"><a class="ae ks" href="https://tyk.io/docs/plugins/supported-languages/javascript-middleware/middleware-scripting-guide/" rel="noopener ugc nofollow" target="_blank"> TYK Javascript中间件</a></li><li id="5389" class="nf ng in ln b lo no lr np lu nq ly nr mc ns mg nk nl nm nn bi translated"><a class="ae ks" href="https://www.keycloak.org/" rel="noopener ugc nofollow" target="_blank">钥匙锁</a></li><li id="26be" class="nf ng in ln b lo no lr np lu nq ly nr mc ns mg nk nl nm nn bi translated"><a class="ae ks" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank">Docker</a>&amp;<a class="ae ks" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank">Docker-Compose</a></li><li id="fe94" class="nf ng in ln b lo no lr np lu nq ly nr mc ns mg nk nl nm nn bi translated"><a class="ae ks" href="https://github.com/santoshshinde2012/node-boilerplate" rel="noopener ugc nofollow" target="_blank"> Node.js </a></li></ol><h1 id="749b" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">什么是TYK网关中间件？</h1><p id="6158" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">Tyk提供了添加定制中间件或插件来扩展其功能的能力，下面是Tyk提供的两种定制类型。</p><ol class=""><li id="74f8" class="nf ng in ln b lo mh lr mi lu nh ly ni mc nj mg nk nl nm nn bi translated">中间件组件——基本上有两类，第一类是<strong class="ln io">前</strong>，第二类是<strong class="ln io">后</strong>。通常，预中间件组件将在任何令牌或会话验证发生之前执行。后中间件组件将在执行完所有检查并且请求准备好被代理后运行。</li><li id="1fd4" class="nf ng in ln b lo no lr np lu nq ly nr mc ns mg nk nl nm nn bi translated">动态事件处理程序——这些组件在API事件上触发，或者你可以简单地称它们为<a class="ae ks" href="https://tyk.io/docs/basic-config-and-security/report-monitor-trigger-events/webhooks/#setup-with-api" rel="noopener ugc nofollow" target="_blank"> webhooks </a>。</li></ol><p id="14e0" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">查看以下TYK官方文章，了解更多关于定制JS中间件概述的信息。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nt"><img src="../Images/12238a1e7e5b18508fc92be4b7f81239.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ghfQMfk1XxfQkdbA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Request Middleware Chain (Source — <a class="ae ks" href="https://tyk.io/docs/concepts/middleware-execution-order/" rel="noopener ugc nofollow" target="_blank">https://tyk.io/docs/concepts/middleware-execution-order/</a>)</figcaption></figure></div><div class="ab cl nu nv hr nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ig ih ii ij ik"><h1 id="cecd" class="kt ku in bd kv kw ob ky kz la oc lc ld jt od ju lf jw oe jx lh jz of ka lj lk bi translated">假设</h1><p id="00cd" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">本文假设您已经安装了TYK网关和带有docker-compose的Keycloak，如果您需要任何帮助，请参考下一篇文章中概述的步骤。</p><div class="mm mn gp gr mo mp"><a rel="noopener  ugc nofollow" target="_blank" href="/getting-started-to-tyk-api-gateway-with-keycloak-16307435584a"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd io gy z fp mu fr fs mv fu fw im bi translated">使用Keycloak开始使用Tyk API网关</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">如何使用Tyk Gateway(开源)来保护Node.js API，拒绝来自</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="my l"><div class="ne l na nb nc my nd km mp"/></div></div></a></div><h1 id="dc32" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">TYK中间件中的Keycloak集成—工作流</h1><p id="1306" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">让我们以一个多租户应用程序和您向Tyk Gateway注册的API为例。如果您需要基于基于租户的请求发送您自己的定制头，并且您已经将OAuth 2.0与不同的租户集成，那么您可以使用TYK网关中间件来实现这一点。</p><p id="4766" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">我们将基于图像中显示的以下流程实现我们的实现。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi og"><img src="../Images/f75df63fa77e8d9d5ee9acce095e9823.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RY-ahQ1PVLcyQtQM_mAE5g.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Keycloak Integration in TYK Middleware — Workflow</figcaption></figure><h1 id="4b62" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">开始安装</h1><p id="3e12" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我们将使用docker-compose在本地安装TYK &amp; Keycloak，这是最快的方法。</p><h2 id="d07d" class="oh ku in bd kv oi oj dn kz ok ol dp ld lu om on lf ly oo op lh mc oq or lj os bi translated"><strong class="ak">步骤1 —克隆docker-compose存储库</strong></h2><div class="mm mn gp gr mo mp"><a href="https://github.com/santoshshinde2012/tyk-keycloak-middleware" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd io gy z fp mu fr fs mv fu fw im bi translated">GitHub-Santosh shinde 2012/tyk-keycloak-middleware:这是key cloak和tyk的入门版…</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">这是使用Javascript - GitHub的keycloak和tyk中间件的入门版…</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">github.com</p></div></div><div class="my l"><div class="ot l na nb nc my nd km mp"/></div></div></a></div><pre class="kd ke kf kg gt ou ov ow ox aw oy bi"><span id="a45d" class="oh ku in ov b gy oz pa l pb pc">git clone <a class="ae ks" href="https://github.com/santoshshinde2012/tyk-keycloak-middleware.git" rel="noopener ugc nofollow" target="_blank">https://github.com/santoshshinde2012/tyk-keycloak-demo.git</a><br/>cd <a class="ae ks" href="https://github.com/santoshshinde2012/tyk-keycloak-middleware.git" rel="noopener ugc nofollow" target="_blank">tyk-keycloak-demo</a>// Run the application using docker-compose<br/>docker-compose up</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi pd"><img src="../Images/ffdc6e2528651e72281b5b71e4d00656.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rPEQ3GgmVHtZjsmP9Wox9Q.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Run the Tyk &amp; Keycloak application</figcaption></figure><h2 id="7aed" class="oh ku in bd kv oi oj dn kz ok ol dp ld lu om on lf ly oo op lh mc oq or lj os bi translated"><strong class="ak">第2步— </strong> <a class="ae ks" href="https://tyk.io/docs/plugins/supported-languages/javascript-middleware/middleware-scripting-guide/" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">创建TYK认证中间件</strong> </a></h2><p id="ee89" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">中间件的对象是通过调用<code class="fe pe pf pg ov b">TykJS.TykMiddleware.NewMiddleware({})</code>构造函数，然后使用<code class="fe pe pf pg ov b">NewProcessRequest()</code>闭包语法用您的函数初始化它来创建的。查看这篇<a class="ae ks" href="https://tyk.io/docs/plugins/supported-languages/javascript-middleware/middleware-scripting-guide/" rel="noopener ugc nofollow" target="_blank">文章</a>了解更多详情。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ph"><img src="../Images/f2b36cb61cb6dfb07f0aab4238ebe8c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zvDESj6cJNO88q1z-fd7sQ.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk"><a class="ae ks" href="https://github.com/santoshshinde2012/tyk-keycloak-middleware/blob/master/tyk/middleware/auth.js" rel="noopener ugc nofollow" target="_blank">Create TYK Auth Middleware</a></figcaption></figure><h2 id="6a1c" class="oh ku in bd kv oi oj dn kz ok ol dp ld lu om on lf ly oo op lh mc oq or lj os bi translated"><strong class="ak">步骤3——理解请求、会话和规范的用法</strong></h2><p id="dc8a" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated"><strong class="ln io">请求</strong>—<code class="fe pe pf pg ov b">request</code>对象提供了一组可以操作的数组，当这些数组发生变化时，将会影响请求通过中间件管道的过程。</p><p id="731f" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated"><strong class="ln io">会话</strong> — Tyk使用内部会话表示来处理特定密钥的配额、速率限制和访问权限。这些数据可用于后处理中间件进行处理。会话对象本身不可编辑，因为它对Tyk的正确运行至关重要。</p><p id="a286" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">Spec(Config) —您可以在API定义中使用<code class="fe pe pf pg ov b">config_data</code>特殊字段，通过JSVM将定制属性传递给中间件。示例— <code class="fe pe pf pg ov b">spec.config_data.{Keyname}</code></p><h2 id="5c14" class="oh ku in bd kv oi oj dn kz ok ol dp ld lu om on lf ly oo op lh mc oq or lj os bi translated"><strong class="ak">步骤4—创建演示Node.js应用程序</strong></h2><p id="e9ff" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">对于本文，我们将使用已经使用TypeScript和Express创建的<a class="ae ks" href="https://github.com/santoshshinde2012/node-boilerplate" rel="noopener ugc nofollow" target="_blank"> Node.js样板</a>代码。</p><div class="mm mn gp gr mo mp"><a href="https://github.com/santoshshinde2012/node-boilerplate" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd io gy z fp mu fr fs mv fu fw im bi translated">GitHub-Santosh shinde 2012/Node-Boilerplate:用于微服务的节点类型脚本样板…</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">微服务的节点类型脚本样板。用TypeScript编写的Node.js应用程序的框架(带有安装说明…</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">github.com</p></div></div><div class="my l"><div class="pi l na nb nc my nd km mp"/></div></div></a></div><pre class="kd ke kf kg gt ou ov ow ox aw oy bi"><span id="4733" class="oh ku in ov b gy oz pa l pb pc">// clone the application<br/>git clone <a class="ae ks" href="https://github.com/santoshshinde2012/node-boilerplate.git" rel="noopener ugc nofollow" target="_blank">https://github.com/santoshshinde2012/node-boilerplate.git</a>// change to the new directory<br/>cd node-boilerplate// Run the application using docker-compose<br/>docker-compose up</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi pj"><img src="../Images/4e4f2dd82c09d55b2aa2b97c7302060f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*O4UFZ-BT9HkQeAEK.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Run the Node JS Application</figcaption></figure><h2 id="ebd8" class="oh ku in bd kv oi oj dn kz ok ol dp ld lu om on lf ly oo op lh mc oq or lj os bi translated"><strong class="ak">步骤5—为我们的租户设置Keycloak领域和客户端</strong></h2><p id="bbb7" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">如果您不熟悉<a class="ae ks" href="https://www.keycloak.org/documentation" rel="noopener ugc nofollow" target="_blank"> Keycloak </a>，请浏览以下文章了解更多详情。</p><div class="mm mn gp gr mo mp"><a href="https://blog.santoshshinde.com/introduction-to-building-an-effective-identity-and-access-management-architecture-with-keycloak-4c1645124d83" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd io gy z fp mu fr fs mv fu fw im bi translated">使用Keycloak构建有效的身份和访问管理架构简介</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">Keycloak是一个开源软件产品，允许使用身份和访问管理进行单点登录，旨在为现代…</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">blog.santoshshinde.com</p></div></div><div class="my l"><div class="pk l na nb nc my nd km mp"/></div></div></a></div><p id="d161" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">我们需要创建一个领域，并在该领域中创建一个具有client_credentials授权类型的客户机。在Tyk网关内创建API时，将使用以下参数。</p><ol class=""><li id="8ce5" class="nf ng in ln b lo mh lr mi lu nh ly ni mc nj mg nk nl nm nn bi translated">创建领域</li></ol><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi pj"><img src="../Images/cc394e5d51f835a97eb0c87c017ab947.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*h_K2oSVV3u_Zjjwz.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Create Realm</figcaption></figure><p id="63f2" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">2.创建客户端</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi pl"><img src="../Images/f7fda62ed2f8916aa4a80835dc339111.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UXnB6kNAGIpl9mbuS55g5A.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">create client</figcaption></figure><p id="11d3" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">3.启用客户端凭证授予类型(如何在钥匙锁身份与访问管理系统中使用客户端凭证授予类型)</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ph"><img src="../Images/ed189eb44ac609b54e90232a13b303e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aHL2i5aG-egH6bYuTDLIzA.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Enable for client credentials grant type</figcaption></figure><p id="7517" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">4.获取客户端的客户端机密</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi pm"><img src="../Images/47a59737ceff6632cea9273228187163.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-l3YdbxQa_d8znV-NWRWUA.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Get client secrete for client</figcaption></figure><pre class="kd ke kf kg gt ou ov ow ox aw oy bi"><span id="b552" class="oh ku in ov b gy oz pa l pb pc">"KC_CLIENT_ID": "backend-app-client",</span><span id="4e1d" class="oh ku in ov b gy pn pa l pb pc">"KC_GRANT_TYPE": "client_credentials",</span><span id="4c11" class="oh ku in ov b gy pn pa l pb pc">"KC_REALM": "tyk",</span><span id="5882" class="oh ku in ov b gy pn pa l pb pc">"KC_CLIENT_SECRET": "iimAz1Pnq9zbzVvLVbbTlc5qJLJ46OLh",</span><span id="70fb" class="oh ku in ov b gy pn pa l pb pc">"KC_SERVER": "http://oidc:8080"</span></pre><h2 id="4463" class="oh ku in bd kv oi oj dn kz ok ol dp ld lu om on lf ly oo op lh mc oq or lj os bi translated"><strong class="ak">步骤6—添加/创建新的API </strong></h2><p id="7a93" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">请在下面找到我们将要使用的示例</p><p id="5843" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated"><a class="ae ks" href="https://github.com/santoshshinde2012/tyk-keycloak-middleware/blob/master/tyk/apps/web.json" rel="noopener ugc nofollow" target="_blank">https://github . com/Santosh shinde 2012/tyk-key cloak-middleware/blob/master/tyk/apps/web . JSON</a></p><pre class="kd ke kf kg gt ou ov ow ox aw oy bi"><span id="21ad" class="oh ku in ov b gy oz pa l pb pc">{<br/>    "name": "web",<br/>    "slug": "web",<br/>    "api_id": "web",<br/>    "org_id": "web",<br/>    "definition": {<br/>        "location": "header",<br/>        "key": "version"<br/>    },<br/>    "use_keyless": true,<br/>    "version_data": {<br/>        "not_versioned": true,<br/>        "versions": {<br/>            "Default": {<br/>                "name": "Default"<br/>            }<br/>        }<br/>    },<br/>    "config_data": {<br/>        "KC_CLIENT_ID": "backend-app-client",<br/>        "KC_REALM": "tyk",<br/>        "KC_GRANT_TYPE": "client_credentials",<br/>        "KC_SECRET": "iimAz1Pnq9zbzVvLVbbTlc5qJLJ46OLh",<br/>        "KC_SERVER": "http://oidc:8080"<br/>    },<br/>    "custom_middleware": {<br/>        "pre": [<br/>            {<br/>                "name": "auth",<br/>                "path": "/opt/tyk-gateway/middleware/auth.js",<br/>                "require_session": false,<br/>                "raw_body_only": false<br/>            }<br/>        ]<br/>    },<br/>    "driver": "otto",<br/>    "proxy": {<br/>        "listen_path": "/web",<br/>        "target_url": "http://host.docker.internal:3146/web",<br/>        "strip_listen_path": true<br/>    }<br/>}</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi po"><img src="../Images/406c00e1697331331d96d521a9799787.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fXIAvGWd7l8bvhh-vPwV1w.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Create API</figcaption></figure><h2 id="f244" class="oh ku in bd kv oi oj dn kz ok ol dp ld lu om on lf ly oo op lh mc oq or lj os bi translated"><strong class="ak">步骤7—通过网关访问API</strong></h2><p id="d3e8" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我们现在可以通过Tyk网关访问REST API端点。</p><ol class=""><li id="d5a5" class="nf ng in ln b lo mh lr mi lu nh ly ni mc nj mg nk nl nm nn bi translated">请求</li></ol><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi pp"><img src="../Images/35d4ea53b0a6b00dcd0677ec9facd3d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bsGGotYkNbyQthFo6jTwkQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Request</figcaption></figure><p id="77e8" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">2.反应</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ph"><img src="../Images/ebdf71703fba0c4b1bb515295faddb2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BhphLE9DTDS2P5CmaVyiZA.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Response</figcaption></figure><p id="db19" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">感谢阅读，请分享你的评论，如果这个博客增加了你的学习价值，请鼓掌。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="pq pr l"/></div></figure><p id="0fbe" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated"><em class="ps">更多内容请看</em><a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ln io"><em class="ps">plain English . io</em></strong></a><em class="ps">。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ln io"> <em class="ps">免费周报</em> </strong> </a> <em class="ps">。关注我们关于</em><a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ln io"><em class="ps">Twitter</em></strong></a><em class="ps">和</em><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ln io"><em class="ps">LinkedIn</em></strong></a><em class="ps">。加入我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ln io"> <em class="ps">社区不和谐</em> </strong> </a> <em class="ps">。</em></p></div></div>    
</body>
</html>