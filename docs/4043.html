<html>
<head>
<title>How to Build a Simple CSV Parser with Lightning Web Components</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Lightning Web组件构建简单的CSV解析器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-build-a-simple-csv-parser-with-lightning-web-components-464a110a1cd2?source=collection_archive---------2-----------------------#2022-10-20">https://javascript.plainenglish.io/how-to-build-a-simple-csv-parser-with-lightning-web-components-464a110a1cd2?source=collection_archive---------2-----------------------#2022-10-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="dc9b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">创建LWC以在Salesforce中上传CSV文件，并在Lightning数据表中显示其内容</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4e21e4057e381bedcd7d9f4ca7ab93d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0FOK1CG3uS_qlZosob1Bww.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Original from <a class="ae kv" href="https://pixabay.com/images/id-1568698/" rel="noopener ugc nofollow" target="_blank">Pixabay</a> under <a class="ae kv" href="https://pixabay.com/service/license/" rel="noopener ugc nofollow" target="_blank">Pixabay License</a></figcaption></figure><p id="b85a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Salesforce项目中，您经常会遇到允许上传Excel列表或CSV文件并基于其内容创建数据记录的要求。</p><p id="5b81" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这些情况下，通常会考虑使用第三方库。然而，在Salesforce中，外部库的使用相对麻烦，因为它们只能作为<a class="ae kv" href="https://developer.salesforce.com/docs/component-library/documentation/en/lwc/lwc.create_resources" rel="noopener ugc nofollow" target="_blank">静态资源</a>使用，也不提供任何合理的版本控制。</p><p id="9ab6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，根据需求的复杂程度，也可以用普通的JavaScript轻松地编写一个CSV解析器。所以这正是我们在这篇文章中想要做的，只是建立我们自己的CSV解析器LWC。</p><h1 id="b180" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">上传CSV文件</h1><p id="4e45" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们将从最重要的开始，提供文件上传以使我们的CSV文件可用于解析其内容。幸运的是，Salesforce提供了一个标准组件，我们可以在我们的LWC - <a class="ae kv" href="https://developer.salesforce.com/docs/component-library/bundle/lightning-input/example" rel="noopener ugc nofollow" target="_blank">闪电输入</a>中使用该组件。因此，让我们在LWC的HTML模板中添加一个“file”类型的输入字段来处理传入的文件上传。我们将上传配置为仅接受CSV文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="85cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在LWC的JS部分，我们将使用来自<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/File_API" rel="noopener ugc nofollow" target="_blank">文件API </a>的<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/FileReader" rel="noopener ugc nofollow" target="_blank"> FileReader </a>对象来读取CSV上传，并使它们可用于进一步处理，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="3dd1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">文件上传通常也支持多个文件的上传。然而，在我们的用例中，我们只想允许上传单个文件并读取其内容。因此，我们在代码中使用<em class="mr"> files[0] </em>，只考虑列表中的第一个文件。</p><h1 id="855f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">构建CSV解析器</h1><p id="d614" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在我们已经实现了CSV文件的一般上传和读取，我们可以开始构建解析器了。</p><p id="a113" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">必要的解析方法基本上只是检查CSV文件的内容，并将其转换为一种数据结构，以便我们在以后的代码中更容易处理。因为我们还想在以后向用户显示我们的数据，所以我们已经将它转换成一种支持简单的表格显示的格式。以下代码包含描述最重要步骤的注释:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="4566" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了上面的代码，我们现在已经处理并准备好了我们的数据以进行进一步的操作。所以接下来我们应该考虑它们在用户界面中的表现。</p><h1 id="89de" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">在数据表中显示CSV内容</h1><p id="3eab" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">最后，我们希望向用户展示CSV处理的结果。为此，我们将使用另一个标准LWC - <a class="ae kv" href="https://developer.salesforce.com/docs/component-library/bundle/lightning-datatable/example" rel="noopener ugc nofollow" target="_blank"> Lightning数据表</a>。在上一节中，我们已经准备好了CSV数据，以匹配datatable组件支持的格式。因此，唯一缺少的就是将datatable组件添加到我们的HTML模板中，并为<em class="mr">数据</em>和<em class="mr">列</em>属性分配适当的值。为了让我们的组件看起来格式更好，我们还额外添加了一个<a class="ae kv" href="https://developer.salesforce.com/docs/component-library/bundle/lightning-card/example" rel="noopener ugc nofollow" target="_blank"> Lightning卡</a>作为包装器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="6c35" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">瞧，我们的表现在应该显示上传的CSV文件的格式良好的内容，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/e06a6f3d60c8174b6c889eeb3e1fdfca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H-OQOAWc3J_PC25ZFQtqCw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Preview of the finished CSV Parser LWC showing uploaded file contents</figcaption></figure><p id="ea96" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">原则上，我们现在可以在组织的任何地方使用我们的组件。我们的LWC的以下示例XML文件允许在应用程序、主页和记录页面上使用:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><h1 id="14db" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="4a85" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们创建了一个简单的CSV上传组件，允许我们读取上传文件的内容。我们还添加了一个<a class="ae kv" href="https://developer.salesforce.com/docs/component-library/bundle/lightning-datatable/example" rel="noopener ugc nofollow" target="_blank"> Lightning数据表</a>来在UI中显示解析结果。</p><p id="9aff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，这仅仅是一个起点，对于真实项目中的用例来说，这种状态是不够的。为了在这样的上下文中使用我们的组件，现在必须为数据的实际处理添加适当的业务逻辑。例如，通过添加Apex类来创建文件内容，作为org中特定类型对象的实际记录。</p><p id="bf1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，我们的组件目前只支持UTF-8编码，逗号分隔的CSV文件。当然，不同的CSV文件之间的分隔符可能不同。为了在这里创造更多的灵活性，如果用户可以动态地设置分隔符，例如通过一个额外的输入字段，这也将是我们组件的一个有用的扩展。</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><p id="e146" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">GitHub上提供了完整的源代码，包括JEST单元测试和JSDoc注释:</p><div class="na nb gp gr nc nd"><a href="https://github.com/svierk/awesome-lwc-collection/tree/main/force-app/main/default/lwc/csvToDatatable" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ir gy z fp ni fr fs nj fu fw ip bi translated">awesome-LWC-collection/force-app/main/default/LWC/csvtodatable at main…</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">⚡️收集了一些现成的Lightning Web组件，可能会对您的SFDX项目有所帮助…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">github.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr kp nd"/></div></div></a></div></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><p id="cb70" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mr">更多内容请看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="mr">plain English . io</em></strong></a><em class="mr">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="mr">免费周报</em> </strong> </a> <em class="mr">。关注我们关于</em><a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="mr">Twitter</em></strong></a><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="mr">LinkedIn</em></strong></a><em class="mr"/><a class="ae kv" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="mr">YouTube</em></strong></a><em class="mr"/><a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="mr">不和</em> </strong> </a> <em class="mr">。对增长黑客感兴趣？检查</em> <a class="ae kv" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="mr">电路</em> </strong> </a> <em class="mr">。</em></p></div></div>    
</body>
</html>