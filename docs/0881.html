<html>
<head>
<title>Publish Your Agora Livestream to YouTube, Facebook, or Twitch Using the Web UIKit &amp; Media Push</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用网络工具包和媒体推送将您的Agora直播发布到YouTube、脸书或Twitch</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/publishing-your-agora-livestream-to-youtube-facebook-or-twitch-using-the-web-uikit-media-push-b18e03f164ca?source=collection_archive---------11-----------------------#2022-02-18">https://javascript.plainenglish.io/publishing-your-agora-livestream-to-youtube-facebook-or-twitch-using-the-web-uikit-media-push-b18e03f164ca?source=collection_archive---------11-----------------------#2022-02-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="d8d6" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">关于如何扩展Web UIKit以及如何向其添加媒体推送功能的教程。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/37dacaa707be27bce8725403d71b330f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zolEmhg0O1KYSKevs0F_iw.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Banner for Media Push with Agora Web UIKit</figcaption></figure><p id="ed57" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">当主持直播时，很难选择一个单一的平台来播放你的内容。有了Agora，你不必做出选择:你可以在自己的网站上托管直播流，并将其发布到多个第三方服务，如YouTube、脸书直播、Twitch等。使用Agora媒体推送服务可以做到这一点。</p><p id="ae9c" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在本教程中，我们将讨论如何扩展Web UIKit，以及如何为其添加媒体推送功能。你可以阅读关于Web UIKit <a class="ae lo" href="https://www.agora.io/en/blog/agora-web-uikit-add-video-calling-or-live-streaming-to-your-website-in-minutes/" rel="noopener ugc nofollow" target="_blank">发布</a>和<a class="ae lo" href="https://www.agora.io/en/blog/adding-video-chat-or-live-streaming-to-your-website-in-5-lines-of-code-using-the-agora-web-uikit/" rel="noopener ugc nofollow" target="_blank">深入</a>的内容。</p><h1 id="f5b1" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">先决条件</h1><ul class=""><li id="df3d" class="mh mi in ku b kv mj ky mk lb ml lf mm lj mn ln mo mp mq mr bi translated">一个Agora开发者账户(免费，<a class="ae lo" href="https://sso.agora.io/en/signup?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=publishing-your-agora-livestream-to-youtube-facebook-or-twitch-using-the-web-uikit" rel="noopener ugc nofollow" target="_blank">在这里注册！</a>)</li><li id="a684" class="mh mi in ku b kv ms ky mt lb mu lf mv lj mw ln mo mp mq mr bi translated">Node.js LTS版本</li><li id="1314" class="mh mi in ku b kv ms ky mt lb mu lf mv lj mw ln mo mp mq mr bi translated">对React的高级理解</li></ul><h1 id="a007" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">设置</h1><p id="ebcb" class="pw-post-body-paragraph ks kt in ku b kv mj jo kx ky mk jr la lb mx ld le lf my lh li lj mz ll lm ln ig bi translated">您可以在<a class="ae lo" href="https://github.com/EkaanshArora/Agora-Web-UIKit-RTMP" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得示例代码，或者您可以创建自己的React项目。打开终端并执行:</p><pre class="kd ke kf kg gt na nb nc nd aw ne bi"><span id="ccf9" class="nf lq in nb b gy ng nh l ni nj">npx create-react-app demo --template typescript<br/>cd demo</span></pre><p id="8c48" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">安装Agora React原生SDK和UIKit:</p><pre class="kd ke kf kg gt na nb nc nd aw ne bi"><span id="7e98" class="nf lq in nb b gy ng nh l ni nj">npm i agora-react-uikit</span></pre><p id="45ba" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><strong class="ku io"> <em class="nk">注:</em> </strong> <em class="nk"> </em>撰写时，当前<code class="fe nl nm nn nb b">agora-react-uikit</code>发布为<code class="fe nl nm nn nb b">v0.0.5</code>。</p><p id="233f" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在Agora控制台中，您必须为您的项目启用RTMP转换器。您可以转到“用法”选项卡，从下拉菜单中选择您的项目:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi no"><img src="../Images/d32839b5504801d49e3d28ac891b65ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7x9eT5gT7ZXFTgyTHGUsGg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Agora Console</figcaption></figure><p id="9402" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这就是设计。现在，您可以执行npm start来启动本地主机上的web服务器。</p><h1 id="e91f" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">构建实时流</h1><p id="99bf" class="pw-post-body-paragraph ks kt in ku b kv mj jo kx ky mk jr la lb mx ld le lf my lh li lj mz ll lm ln ig bi translated">UIKit为您提供了一个名为<code class="fe nl nm nn nb b">&lt;AgoraUIKit&gt;</code>的高级组件，可用于呈现完整的视频通话或直播，UIKit博客深入介绍了如何在无需编写太多代码的情况下定制UI和功能。我们将使用组成<code class="fe nl nm nn nb b">&lt;AgoraUIKit&gt;</code>组件的组件来添加媒体推送功能。</p><p id="dfba" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们将清除<code class="fe nl nm nn nb b">App.tsx</code>文件，重新开始:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="7cf9" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们将创建一个名为videocall的状态变量。当它为真时，我们将呈现直播流，当它为假时，我们将呈现一个按钮来切换应用程序状态和启动流。我们还在直播旁边创建了两个按钮来切换角色和布局。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="82d7" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">为了构建Livestream，我们将使用<code class="fe nl nm nn nb b">PropsContext</code>组件包装所有内容，以便将用户属性传递给UIKit。我们将为<code class="fe nl nm nn nb b">rtcProps</code>添加道具— Agora应用ID、频道名称、令牌、直播角色和布局。我们可以使用<code class="fe nl nm nn nb b">styleProps</code>定制样式，并使用<code class="fe nl nm nn nb b">callbacks</code>访问直播事件。当用户点击结束通话按钮时，我们将切换设置<code class="fe nl nm nn nb b">videocall</code>状态为假。</p><p id="d75e" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">然后我们将渲染<code class="fe nl nm nn nb b">VideoCallUI</code>组件。我们将自己定义它，而不是使用带有<code class="fe nl nm nn nb b">UIKit</code>的按钮来添加开始和停止流按钮。如果用户角色是host，我们将用<code class="fe nl nm nn nb b">TracksConfigure</code>组件包装它，该组件创建麦克风和摄像机轨迹并将它们传递给UI。</p><p id="9f04" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><strong class="ku io"> <em class="nk">注意:</em> </strong>建议对生产环境中运行的所有RTE应用进行令牌认证。有关Agora平台中基于令牌的认证的更多信息，请参见本指南:【https://docs.agora.io/en/Video/token? T21】平台=所有% 20平台。</p><p id="a5a6" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">让我们定义一下<code class="fe nl nm nn nb b">VideoCallUI</code>组件:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="a5cc" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们将通过用处理Livestream逻辑的<code class="fe nl nm nn nb b">RtcConfigure</code>组件包装一切来组合组件。我们将添加一个新的<code class="fe nl nm nn nb b">RTMP</code>组件，根据状态渲染<code class="fe nl nm nn nb b">GridVideo</code>或<code class="fe nl nm nn nb b">PinnedVideo</code>，并在内部渲染<code class="fe nl nm nn nb b">LocalControls</code>组件。</p><h1 id="546f" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">将流推送到CDN</h1><p id="587b" class="pw-post-body-paragraph ks kt in ku b kv mj jo kx ky mk jr la lb mx ld le lf my lh li lj mz ll lm ln ig bi translated">我们将创建一个名为<code class="fe nl nm nn nb b">RTMP</code>的新组件，它将包含发布/取消发布来自CDN的流的代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="2aa4" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们将定义RTMP网址。例如，如果你正在使用Twitch，你的URL应该是这样的:<code class="fe nl nm nn nb b">rtmp://xxx.contribute.live-video.net/app/{your_stream_key}</code>，如果你正在使用YouTube Live，它应该是这样的:<code class="fe nl nm nn nb b">rtmp://a.rtmp.youtube.com/live2/{your_stream_key}</code>。我们还将定义直播流的高度和宽度:我使用的是1280x720:</p><p id="1760" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们将存储流状态和按钮状态作为状态。然后，我们可以从<code class="fe nl nm nn nb b">RtcContext</code>访问SDK客户端对象和本地用户的uid ( <code class="fe nl nm nn nb b">localUid</code>)。我们可以从<code class="fe nl nm nn nb b">MaxUidContext</code>和<code class="fe nl nm nn nb b">MinUidContext</code>访问流上的用户。这些将返回调用中所有主机的数组。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="f962" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们将创建一个<code class="fe nl nm nn nb b">useEffect</code>钩子，每当用户加入或离开这个调用时，它就调用<code class="fe nl nm nn nb b">transcode</code>函数。我们可以通过将最小和最大数组添加到依赖数组来实现这一点。只有当流被发布时，我们才会调用<code class="fe nl nm nn nb b">transcode</code>。</p><p id="67ae" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在<code class="fe nl nm nn nb b">transcode</code>函数中，我们创建了一个config对象来在网格中显示用户。可以自定义高度、宽度、x-y位置、水印等。您还可以自定义视频属性，如比特率和帧速率。最后，我们将使用配置文件调用客户机对象上的<code class="fe nl nm nn nb b">setLiveTranscoding</code>方法。</p><p id="47a5" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><strong class="ku io"> <em class="nk">注:</em> </strong>在单主机的情况下，Agora不建议转码。可以跳过步骤1，直接调用<code class="fe nl nm nn nb b">enableTranscoding</code>设为false的<code class="fe nl nm nn nb b">client.startLiveStreaming</code>。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="7bb6" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们将创建两个函数——<code class="fe nl nm nn nb b">rtmpOn</code>和<code class="fe nl nm nn nb b">rtmpOff</code>——来调用客户端对象上的<code class="fe nl nm nn nb b">startLiveStreaming</code>和<code class="fe nl nm nn nb b">stopLiveStreaming</code>方法，并更新组件状态:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="7798" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们将在一个带有空依赖数组的useEffect挂钩中添加错误和警告的事件侦听器。在组件返回中，我们将显示开始和停止向CDN流式传输的按钮，并进行一些样式设置。就这样，我们准备使用UIKit旁边的新RTMP按钮将直播视频流发布到CDN。</p><h1 id="8107" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">结论</h1><p id="83f9" class="pw-post-body-paragraph ks kt in ku b kv mj jo kx ky mk jr la lb mx ld le lf my lh li lj mz ll lm ln ig bi translated">如果你认为Agora Web UIKit中有一些很好的特性可以让很多用户受益，那么你可以随意地添加资源库并添加一个pull请求。感谢所有的贡献！</p><h1 id="39b2" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">其他资源</h1><p id="42eb" class="pw-post-body-paragraph ks kt in ku b kv mj jo kx ky mk jr la lb mx ld le lf my lh li lj mz ll lm ln ig bi translated">如果您在使用Web UIKit时有任何问题，我邀请您加入<a class="ae lo" href="https://agora.io/en/join-slack" rel="noopener ugc nofollow" target="_blank"> Agora开发者Slack社区</a>，您可以在<code class="fe nl nm nn nb b">#web-help-me</code>频道提问。请随意提出功能请求或报告<a class="ae lo" href="https://github.com/AgoraIO-Community/Web-React-UIKit/issues" rel="noopener ugc nofollow" target="_blank"> UIKit Repo </a>或<a class="ae lo" href="https://github.com/EkaanshArora/Agora-Web-UIKit-RTMP" rel="noopener ugc nofollow" target="_blank">项目repo </a>上的错误。</p><p id="2ec7" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><em class="nk">更多内容看</em> <a class="ae lo" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ku io"> <em class="nk">说白了。报名参加我们的</em><strong class="ku io"><em class="nk"/></strong><a class="ae lo" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ku io"><em class="nk">免费周报</em> </strong> </a> <em class="nk">。在我们的</em> <a class="ae lo" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ku io"> <em class="nk">社区不和谐</em> </strong> </a> <em class="nk">获得独家获取写作机会和建议。</em></strong></a></p></div></div>    
</body>
</html>