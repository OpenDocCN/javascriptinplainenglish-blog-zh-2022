<html>
<head>
<title>Reduce Disk Space in React App By 60% Using PNPM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PNPM将React应用中的磁盘空间减少60%</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/reduce-disk-space-in-reactjs-app-by-60-using-pnpm-5e2c5e19a6b6?source=collection_archive---------4-----------------------#2022-09-21">https://javascript.plainenglish.io/reduce-disk-space-in-reactjs-app-by-60-using-pnpm-5e2c5e19a6b6?source=collection_archive---------4-----------------------#2022-09-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="d0ee" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">关于在React应用程序中使用PNPM减少磁盘空间的教程。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/37041cbc063011e9805c6bd515f9efd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XPd5SWvmPAdNqngLq0RR-g.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@nordwood?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">NordWood Themes</a> on <a class="ae ks" href="https://unsplash.com/@nordwood?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="aa3a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您是否正在处理多个具有共同依赖关系的React项目？如果是这样，那么这篇文章是给你的。</p><p id="e79d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当处理多个项目或微前端应用程序时，您需要在每个项目上安装相同的依赖项，例如，如果您处理5个基于React的项目，所有项目都具有相同的依赖项版本，并且每个项目都有节点模块文件夹，这将占用大量的磁盘空间。</p><p id="63a5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们可能会从中得到一些问题。</p><ol class=""><li id="f84c" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">为什么同一个依赖项安装了多次却没有重用？</li><li id="7f9a" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">当处理多个具有相同依赖关系的项目时，如何节省磁盘空间？</li><li id="11b9" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">如何加速依赖项的安装？</li></ol><p id="0a5e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在本文中，我们可以看到如何使用pnpm解决这个问题。</p><h1 id="d537" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">什么是PNPM？</h1><p id="12e3" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated"><strong class="kv io"> pnpm </strong>代表性能npm。它是基于NodeJS的项目的包管理器。主要关注速度和处理磁盘空间的有效方式。它是“npm”和“yarn”的替代词。</p><h1 id="9ee6" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">突出</h1><ol class=""><li id="42eb" class="lp lq in kv b kw mv kz mw lc na lg nb lk nc lo lu lv lw lx bi translated">快的</li><li id="34b9" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">高效的</li><li id="a445" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">支持Monorepos</li></ol><h1 id="7cea" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">PNPM的效率如何？</h1><p id="d183" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">Pnpm非常高效地处理磁盘内存。让我们看看怎么做。</p><p id="1511" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">pnpm将依赖项保存在您机器上的一个<strong class="kv io">全局存储库</strong>中，在项目和依赖项之间创建一个硬链接。所以确切的<strong class="kv io">依赖关系</strong>在项目之间<strong class="kv io">共享</strong>，节省了大量空间。在npm中，它还会复制相同的依赖项，并将它们保存在特定于项目的节点模块中，这增加了存储空间。</p><h1 id="d105" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">PNPM使用非平面目录</h1><p id="c061" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">默认情况下，<strong class="kv io"> pnpm </strong>在全局存储和项目节点模块之间创建一个符号链接。但是你可以看到节点模块为每个项目占用了磁盘空间。</p><p id="d613" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是由于<a class="ae ks" href="https://unix.stackexchange.com/questions/88423/why-do-hard-links-seem-to-take-the-same-space-as-the-originals" rel="noopener ugc nofollow" target="_blank">硬链接</a>，硬链接指向原始文件所在的相同位置。但是对于一个版本，在内存中只保存依赖关系的一个副本。参考下图:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nd"><img src="../Images/63a7b4cd7c35dc6d48799c2df98c3bc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ai54jG3TcCGeo9Ph"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">pnpm file structure</figcaption></figure><h1 id="b7e6" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">让我们看一个实时的例子</h1><p id="4888" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated"><strong class="kv io">每个React应用的常见依赖关系</strong></p><pre class="kd ke kf kg gt ne nf ng nh aw ni bi"><span id="b3a5" class="nj me in nf b gy nk nl l nm nn">"dependencies": {<br/>"<a class="ae ks" href="http://twitter.com/testing" rel="noopener ugc nofollow" target="_blank">@testing</a>-library/jest-dom": "5.16.5",<br/>"<a class="ae ks" href="http://twitter.com/testing" rel="noopener ugc nofollow" target="_blank">@testing</a>-library/react": "13.3.0",<br/>"<a class="ae ks" href="http://twitter.com/testing" rel="noopener ugc nofollow" target="_blank">@testing</a>-library/user-event": "13.5.0",<br/>"react": "18.2.0",<br/>"react-dom": "18.2.0",<br/>"react-scripts": "5.0.1",<br/>"web-vitals": "2.1.4"<br/>}</span></pre><h1 id="71db" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">使用NPM配置的项目</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi no"><img src="../Images/9cdeb888a4ab585df1ad80ec8f889625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WHTolVisxKSyjY-nbZwKxw.png"/></div></div></figure><p id="edc2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">磁盘总容量:<strong class="kv io"> 1260 MB </strong></p><h1 id="0689" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">使用PNPM配置的项目</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi np"><img src="../Images/02163c457d0b3f30f2652671895a8146.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C0ySP8vEZ-Ih_LyEHibjPA.png"/></div></div></figure><p id="0b6b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="nq">注意:所有的依赖项都将放在全局存储中，而不是单个项目中。上表是为了区分。</em></p><p id="9016" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">磁盘总容量:<strong class="kv io"> 500 MB </strong></p><p id="ea05" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">公共依赖项放在全局存储中，由项目访问。根据上面的例子，常见的依赖项有<strong class="kv io"> 380MB </strong>。根据上面的例子，我们可以看到，通过高效地使用“pnpm ”,我们节省了60%的磁盘空间。</p><h1 id="170b" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">PNPM更快</h1><p id="7226" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">与其他依赖项管理器相比，pnpm速度更快，因为它在安装中没有阻塞阶段。每个依赖项都有自己的阶段，通过单独安装每个依赖项，下一个阶段会尽快开始。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nr"><img src="../Images/0ae2a7b02ecd2633748c23ad520e214d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cKzgS0CyAgWpLUzw"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">pnpm dependency</figcaption></figure><h1 id="6202" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">基准</h1><p id="0d4c" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">基准是由<a class="ae ks" href="https://pnpm.io/benchmarks#lots-of-files" rel="noopener ugc nofollow" target="_blank"> pnpm官方文档</a>使用这个<a class="ae ks" href="https://github.com/pnpm/pnpm.github.io/blob/main/benchmarks/fixtures/alotta-files/package.json" rel="noopener ugc nofollow" target="_blank">包. json </a>给出的。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ns"><img src="../Images/a1712d1b02f1488665e881a1d711f748.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8v9hH9IfwIqJ1iUT"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">benchmarks</figcaption></figure><h1 id="7f3d" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">装置</h1><h2 id="03da" class="nj me in bd mf nt nu dn mj nv nw dp mn lc nx ny mp lg nz oa mr lk ob oc mt od bi translated">使用NPM</h2><p id="8916" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">我们可以通过以下命令使用npm全局安装pnpm:</p><pre class="kd ke kf kg gt ne nf ng nh aw ni bi"><span id="6064" class="nj me in nf b gy nk nl l nm nn">npm install -g pnpm</span></pre><h2 id="716b" class="nj me in bd mf nt nu dn mj nv nw dp mn lc nx ny mp lg nz oa mr lk ob oc mt od bi translated">使用自制软件</h2><p id="3deb" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">我们可以用下面的命令安装自制软件:</p><pre class="kd ke kf kg gt ne nf ng nh aw ni bi"><span id="413c" class="nj me in nf b gy nk nl l nm nn">brew install pnpm</span></pre><h1 id="c499" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">作为独立脚本安装</h1><p id="97aa" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated"><strong class="kv io">使用卷曲</strong></p><pre class="kd ke kf kg gt ne nf ng nh aw ni bi"><span id="dbc1" class="nj me in nf b gy nk nl l nm nn">curl -fsSL <a class="ae ks" href="https://get.pnpm.io/install.sh" rel="noopener ugc nofollow" target="_blank">https://get.pnpm.io/install.sh</a> | sh -</span></pre><p id="ecd4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">使用wget </strong></p><pre class="kd ke kf kg gt ne nf ng nh aw ni bi"><span id="426e" class="nj me in nf b gy nk nl l nm nn">wget -qO- <a class="ae ks" href="https://get.pnpm.io/install.sh" rel="noopener ugc nofollow" target="_blank">https://get.pnpm.io/install.sh</a> | sh -</span></pre><p id="3dfe" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">使用PNPM创建React应用</strong></p><p id="f791" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们可以使用下面的命令来配置React应用程序:</p><pre class="kd ke kf kg gt ne nf ng nh aw ni bi"><span id="a922" class="nj me in nf b gy nk nl l nm nn">pnpm create react-app my-pnpm-app</span></pre><h1 id="4087" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">常见命令</h1><p id="e246" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated"><code class="fe oe of og nf b">pnpm install</code> - &gt;从package.json安装依赖项</p><p id="cdfe" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe oe of og nf b">pnpm add</code> - &gt;添加依赖关系</p><p id="8dc6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe oe of og nf b">pnpm run</code> - &gt;运行package.json文件中的脚本</p><p id="8d1b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe oe of og nf b">pnpm test</code> - &gt;在项目中运行测试</p><p id="db18" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe oe of og nf b">pnpm init</code> - &gt;创建一个package.json文件</p><p id="11ba" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe oe of og nf b">pnpm publish</code> - &gt;将包发布到注册表</p><p id="d4a3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe oe of og nf b">pnpm start</code> - &gt;运行package.json中的命令启动app。</p><h1 id="4f17" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">结论</h1><p id="5153" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated"><strong class="kv io"> pnpm </strong>比npm和yarn更快，处理磁盘内存的效率更高。当处理多个项目和微前端应用程序时，这给了我们很多自由空间。将依赖关系放在全局存储上并重用它更有效，这是其他包管理器所没有的。</p><p id="cc57" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">感谢您的阅读。</p></div><div class="ab cl oh oi hr oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="ig ih ii ij ik"><p id="e223" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="nq">更多内容请看</em><a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nq">plain English . io</em></strong></a><em class="nq">。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nq">免费周报</em> </strong> </a> <em class="nq">。关注我们关于</em><a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nq">Twitter</em></strong></a><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nq">LinkedIn</em></strong></a><em class="nq"/><a class="ae ks" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nq">YouTube</em></strong></a><em class="nq"/><a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nq">不和</em> </strong> </a> <em class="nq">。对增长黑客感兴趣？检查</em> <a class="ae ks" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nq">电路</em> </strong> </a> <em class="nq">。</em></p></div></div>    
</body>
</html>