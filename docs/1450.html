<html>
<head>
<title>The Fastest Way to Iterate Over an Array in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中迭代数组的最快方法</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-quickest-way-to-iterate-over-an-array-in-javascript-db23659b8c24?source=collection_archive---------1-----------------------#2022-03-25">https://javascript.plainenglish.io/the-quickest-way-to-iterate-over-an-array-in-javascript-db23659b8c24?source=collection_archive---------1-----------------------#2022-03-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="17de" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">迭代数组的最有效方法。</h2></div><p id="b6d6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们有了一个框架<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/using-playwright-and-benchmark-js-to-test-javascript-performance-across-browsers-99fc0dc56e55">来测试JavaScript代码在不同浏览器上的性能</a>，我们可以开始探索可以优化代码的公共领域。一个明显的例子是迭代数组时；做那件事最有效的方法是什么？</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi kz"><img src="../Images/8f5870912513c014c3c1f6dd7ab53a9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DWiUvdxzuKAFnZww"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@tsvetoslav?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Tsvetoslav Hristov</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="5c92" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">JavaScript中有许多不同的原生方法来迭代数组:</p><ul class=""><li id="54b9" class="lp lq in ke b kf kg ki kj kl lr kp ls kt lt kx lu lv lw lx bi translated">标准<code class="fe ly lz ma mb b">for</code>回路</li><li id="743f" class="lp lq in ke b kf mc ki md kl me kp mf kt mg kx lu lv lw lx bi translated"><code class="fe ly lz ma mb b">for...in</code>循环(只要你<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...in#array_iteration_and_for...in" rel="noopener ugc nofollow" target="_blank">不介意顺序</a></li><li id="9d9d" class="lp lq in ke b kf mc ki md kl me kp mf kt mg kx lu lv lw lx bi translated"><code class="fe ly lz ma mb b">for...of</code>循环</li><li id="6302" class="lp lq in ke b kf mc ki md kl me kp mf kt mg kx lu lv lw lx bi translated"><code class="fe ly lz ma mb b">Array.prototype.forEach</code></li><li id="54c6" class="lp lq in ke b kf mc ki md kl me kp mf kt mg kx lu lv lw lx bi translated"><code class="fe ly lz ma mb b">while</code>循环</li><li id="e27b" class="lp lq in ke b kf mc ki md kl me kp mf kt mg kx lu lv lw lx bi translated"><code class="fe ly lz ma mb b">do...while</code>循环</li></ul><p id="0bfb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此外，其他实用程序库也提供了类似的方法；为了比较，这里我们还将包括来自流行的<a class="ae ky" href="https://lodash.com/" rel="noopener ugc nofollow" target="_blank"> Lodash </a>库的<code class="fe ly lz ma mb b">forEach</code>。</p><p id="4f6e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你认为哪个表现最好？你觉得会有区别吗？让我们来看看，通过迭代一个包含100，000个数字的数组并对每个数字调用<code class="fe ly lz ma mb b">toString</code>来进行测试:</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="5adc" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">结果(对于2.3GHz i7 MacBook Pro，使用剧作家版本1.20.2):</p><pre class="la lb lc ld gt mj mb mk ml aw mm bi"><span id="0851" class="mn mo in mb b gy mp mq l mr ms">✓  [chromium] › tests/bench.spec.js:3:1 › Run benchmarks (39s)<br/>Starting benchmark suites...</span><span id="4b7a" class="mn mo in mb b gy mt mq l mr ms">--- iterate --------------------------------------------------------<br/>Running...</span><span id="6e92" class="mn mo in mb b gy mt mq l mr ms">✅ 'iterate' suite has completed: standard for loop,for...of loop,do...while loop,while loop was the winner! 🏆</span><span id="3d58" class="mn mo in mb b gy mt mq l mr ms">🏆 standard for loop is fastest (376 ops/sec ±0.81%)<br/>⏳ for...of loop is 0.50% slower (374 ops/sec ±0.91%)<br/>⏳ while loop is 0.92% slower (373 ops/sec ±0.81%)<br/>⏳ do...while loop is 0.93% slower (373 ops/sec ±0.77%)<br/>⏳ _.forEach is 22.88% slower (290 ops/sec ±0.70%)<br/>⏳ ES6 forEach is 24.69% slower (283 ops/sec ±1.32%)<br/>⏳ for...in loop is 69.97% slower (113 ops/sec ±1.36%)</span><span id="74aa" class="mn mo in mb b gy mt mq l mr ms">✓  [firefox] › tests/bench.spec.js:3:1 › Run benchmarks (41s)<br/>Starting benchmark suites...</span><span id="22d6" class="mn mo in mb b gy mt mq l mr ms">--- iterate --------------------------------------------------------<br/>Running...</span><span id="bff4" class="mn mo in mb b gy mt mq l mr ms">✅ 'iterate' suite has completed: standard for loop,while loop was the winner! 🏆</span><span id="d291" class="mn mo in mb b gy mt mq l mr ms">🏆 standard for loop is fastest (5566 ops/sec ±0.87%)<br/>⏳ while loop is 0.95% slower (5513 ops/sec ±0.72%)<br/>⏳ do...while loop is 3.67% slower (5362 ops/sec ±0.82%)<br/>⏳ for...of loop is 73.11% slower (1497 ops/sec ±0.52%)<br/>⏳ ES6 forEach is 95.27% slower (263 ops/sec ±1.13%)<br/>⏳ _.forEach is 95.45% slower (253 ops/sec ±0.82%)<br/>⏳ for...in loop is 98.92% slower (60 ops/sec ±1.90%)</span><span id="b8bf" class="mn mo in mb b gy mt mq l mr ms">✓  [webkit] › tests/bench.spec.js:3:1 › Run benchmarks (39s)<br/>Starting benchmark suites...</span><span id="1ee8" class="mn mo in mb b gy mt mq l mr ms">--- iterate --------------------------------------------------------<br/>Running...</span><span id="ced6" class="mn mo in mb b gy mt mq l mr ms">✅ 'iterate' suite has completed: standard for loop,for...of loop was the winner! 🏆</span><span id="ee81" class="mn mo in mb b gy mt mq l mr ms">🏆 standard for loop is fastest (281 ops/sec ±0.93%)<br/>⏳ for...of loop is 0.89% slower (278 ops/sec ±0.97%)<br/>⏳ do...while loop is 1.08% slower (278 ops/sec ±0.60%)<br/>⏳ while loop is 1.43% slower (277 ops/sec ±0.61%)<br/>⏳ ES6 forEach is 29.96% slower (197 ops/sec ±0.69%)<br/>⏳ _.forEach is 30.40% slower (195 ops/sec ±0.71%)<br/>⏳ for...in loop is 72.68% slower (77 ops/sec ±1.59%)</span></pre><p id="aa20" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从这里我们可以看到，在所有的浏览器中，标准的<code class="fe ly lz ma mb b">for</code>循环、<code class="fe ly lz ma mb b">while</code>循环和<code class="fe ly lz ma mb b">do...while</code>循环实际上执行的是相同的，这并不奇怪，因为它们本质上是相同的结构，但是使用了不同的语法。然而，其他选项的表现因浏览器而异，在Firefox的SpiderMonkey引擎上表现尤为糟糕；在这里，您可能会看到使用标准<code class="fe ly lz ma mb b">for</code>或<code class="fe ly lz ma mb b">while</code>循环之外的任何东西都会造成&gt; 70%的性能损失，这是一个显著的差异！同样令人惊讶的是，一个<code class="fe ly lz ma mb b">for...of</code>循环在SpiderMonkey中的表现如此糟糕，尽管它在其他引擎中提供了与<code class="fe ly lz ma mb b">for</code>和<code class="fe ly lz ma mb b">while</code>相当的性能。</p><p id="0b4e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">同样有趣的是<code class="fe ly lz ma mb b">Array.prototype.forEach</code>函数的性能差异，您可能认为这是标准<code class="fe ly lz ma mb b">for</code>循环的语法糖，因此性能也一样好，但是尽管这在WebKit上似乎是真的，但它在其他引擎上的性能要慢20–95 %,这一点绝对值得注意。</p><p id="3b11" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">考虑到Lodash在性能方面的知名度，你可能会惊讶地看到它在这里排名垫底。由于Lodash是开源的，我们可以看看发生了什么:</p><div class="mu mv gp gr mw mx"><a href="https://github.com/lodash/lodash/blob/master/.internal/arrayEach.js" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd io gy z fp nc fr fs nd fu fw im bi translated">lodash/arrayEach.js位于主lodash/lodash</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">此文件包含双向Unicode文本，其解释或编译可能与下面显示的不同…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">github.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl lj mx"/></div></div></a></div><p id="c51c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Lodash提供了额外的功能，允许您提前退出迭代，但是对每个循环的额外检查显然会降低它的速度，所以在您不需要它的情况下，您是在做无用功。</p><p id="c02e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">总之，如果你关心性能，你应该尽可能坚持使用<code class="fe ly lz ma mb b">for</code>或<code class="fe ly lz ma mb b">while</code>循环，但是和以往一样，<strong class="ke io">只在你需要</strong>时才优化性能；可读性和可维护性通常更重要。</p><p id="c6d7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nm">更多内容看</em> <a class="ae ky" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nm">说白了就是io </em> </strong> </a> <em class="nm">。报名参加我们的</em> <a class="ae ky" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nm">免费周报</em> </strong> </a> <em class="nm">。关注我们关于</em><a class="ae ky" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="nm">Twitter</em></strong></a><em class="nm">和</em><a class="ae ky" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="nm">LinkedIn</em></strong></a><em class="nm">。加入我们的</em> <a class="ae ky" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nm">社区</em> </strong> </a> <em class="nm">。</em></p></div></div>    
</body>
</html>