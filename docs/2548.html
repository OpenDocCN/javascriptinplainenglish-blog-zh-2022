<html>
<head>
<title>How to Create Your Own CLI with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Node.js创建自己的CLI</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-your-own-cli-with-node-js-7646a976f8fa?source=collection_archive---------11-----------------------#2022-06-15">https://javascript.plainenglish.io/how-to-create-your-own-cli-with-node-js-7646a976f8fa?source=collection_archive---------11-----------------------#2022-06-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="0aa3" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">第2部分:目录创建、通过文件路径定制模板等等</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/5f6723e353a8a98878e110f4b867af99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NWCyrOpmNQM-TpIw"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@codestorm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Safar Safarov</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b7b4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">亲爱的读者，又见面了！我假设您是在阅读了<strong class="kv io">“如何使用Node.js创建自己的CLI”</strong>系列的第一部分后阅读了本文。如果是的话，我很高兴你能来这里。如果没有，我推荐先看完，或者直接在这里抓取初始代码<a class="ae ks" href="https://codesandbox.io/s/create-project-oweiqo" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="9599" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在本文中，我们将扩展CLI的功能，使其更加强大和方便。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="8c23" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">序</h1><p id="3a23" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">在本文中，我使用没有突出显示TypeScript语法的gists，但是突出显示了diff。这是有意的，因为已经编写了很多代码，使用diff而不是传统的语法高亮会更容易浏览。</p><p id="cc24" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这种方法明显的缺点是复制<em class="mt">不同的</em>代码，但是有工具可以使这变得更容易。我建议您使用您的IDE删除您刚刚将diff复制到的文件中的所有<code class="fe mu mv mw mx b">+</code>字符，然后使用<a class="ae ks" href="https://prettier.io/docs/en/index.html" rel="noopener ugc nofollow" target="_blank">更漂亮的</a>来格式化代码。</p><p id="8f67" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">例如，在Webstorm中就这么简单:</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="40e8" class="nc lx in mx b gy nd ne l nf ng">// open replace tool<br/>// paste + into the first input, leave the second input blank, and then click Replace all<br/>⌘+R (Ctrl+R)</span><span id="169c" class="nc lx in mx b gy nh ne l nf ng">// format code<br/>⌘+⌥+L (Ctrl+Alt+Shift+L)</span></pre><p id="e503" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请注意，项目中没有安装更漂亮的配置，但是有一个更漂亮的配置可用，您可以在这里获得它<a class="ae ks" href="https://codesandbox.io/s/create-project-oweiqo" rel="noopener ugc nofollow" target="_blank">。您可能需要</a><a class="ae ks" href="https://prettier.io/docs/en/editors.html" rel="noopener ugc nofollow" target="_blank">配置您的IDE </a>来使用它。</p><p id="a7c2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">重要提示:</strong>如果您还没有阅读本系列的第一部分，并且刚刚获得代码，请在继续之前遵循以下步骤:</p><ol class=""><li id="7f01" class="ni nj in kv b kw kx kz la lc nk lg nl lk nm lo nn no np nq bi translated">使用CLI源代码切换到目录</li><li id="f88d" class="ni nj in kv b kw nr kz ns lc nt lg nu lk nv lo nn no np nq bi translated">安装依赖项</li><li id="2d7b" class="ni nj in kv b kw nr kz ns lc nt lg nu lk nv lo nn no np nq bi translated">运行<code class="fe mu mv mw mx b">npm run dev</code></li><li id="5651" class="ni nj in kv b kw nr kz ns lc nt lg nu lk nv lo nn no np nq bi translated">跑<code class="fe mu mv mw mx b">npm link</code></li></ol><p id="b543" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这将允许您在系统的任何地方使用此CLI。</p><h1 id="ede1" class="lw lx in bd ly lz nw mb mc md nx mf mg jt ny ju mi jw nz jx mk jz oa ka mm mn bi translated">项目概述</h1><p id="b515" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">这是关于用Node.js构建自己的CLI的系列文章的第二部分。TL；博士:</p><ol class=""><li id="e44e" class="ni nj in kv b kw kx kz la lc nk lg nl lk nm lo nn no np nq bi translated">您可以使用<code class="fe mu mv mw mx b">create-project</code>命令引导项目。有一个方便的向导可以帮助您记住我们的CLI的功能以及可以配置的选项。</li><li id="a5b2" class="ni nj in kv b kw nr kz ns lc nt lg nu lk nv lo nn no np nq bi translated">在一个单独的终端中运行CLI目录下的<code class="fe mu mv mw mx b">npm run dev</code>，这样我们写的代码就会被自动编译。</li></ol><p id="36c3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在本文中，我们将扩展CLI的功能。最终代码可在<a class="ae ks" href="https://codesandbox.io/s/create-project-pt2-ytkvzb" rel="noopener ugc nofollow" target="_blank">这里</a>获得。这个项目将在节点14和以上。</p><p id="aaea" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在本文结束时，您将拥有一个强大的跨平台CLI，用于创建支持定制模板的项目。</p><h1 id="63f8" class="lw lx in bd ly lz nw mb mc md nx mf mg jt ny ju mi jw nz jx mk jz oa ka mm mn bi translated">新功能</h1><p id="98ee" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">我们应该在CLI中添加哪些杀手级功能？我会选择这些:</p><ol class=""><li id="18c2" class="ni nj in kv b kw kx kz la lc nk lg nl lk nm lo nn no np nq bi translated">使CLI能够创建目录。将项目目录的创建委托给CLI会非常方便。call参数将用于指定项目的名称，因此我们需要为模板设置另一个标志。</li><li id="8138" class="ni nj in kv b kw nr kz ns lc nt lg nu lk nv lo nn no np nq bi translated"><strong class="kv io">增加对自定义模板的支持。</strong>自定义模板使创建和重用特定模板变得容易，而无需派生库。</li><li id="69bc" class="ni nj in kv b kw nr kz ns lc nt lg nu lk nv lo nn no np nq bi translated"><strong class="kv io">添加选择到设置</strong> <code class="fe mu mv mw mx b">husky</code> <strong class="kv io">。</strong>如果用户决定在项目中初始化git repo，他可能还想设置<a class="ae ks" href="https://typicode.github.io/husky/#/" rel="noopener ugc nofollow" target="_blank"> Husky </a>。</li></ol><p id="77b6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这些功能将使使用我们的CLI更加方便。如果你在想别的事情，请随意写下评论！与此同时，我会用这些。我们开始吧！</p><h2 id="9b65" class="nc lx in bd ly ob oc dn mc od oe dp mg lc of og mi lg oh oi mk lk oj ok mm ol bi translated">先决条件</h2><p id="f9ff" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">先做一点配置调整。在第一篇文章中使用CLI时，您可能已经看到了这个错误。</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="5e7c" class="nc lx in mx b gy nd ne l nf ng">(!) Unresolved dependencies<br/><a class="ae ks" href="https://rollupjs.org/guide/en/#warning-treating-module-as-external-dependency" rel="noopener ugc nofollow" target="_blank">https://rollupjs.org/guide/en/#warning-treating-module-as-external-dependency</a></span></pre><p id="e6e7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">那是什么？默认情况下，Rollup只解析相对导入，而<code class="fe mu mv mw mx b">import chalk from chalk</code> <a class="ae ks" href="https://rollupjs.org/guide/en/#warning-treating-module-as-external-dependency" rel="noopener ugc nofollow" target="_blank">等导入被视为外部依赖</a>。警告来自于这种行为的隐含性质。为了摆脱这种情况，您要么需要将它们显式地包含在您的包中，要么将它们标记为外部的。有一个汇总插件<a class="ae ks" href="https://github.com/stevenbenisek/rollup-plugin-auto-external" rel="noopener ugc nofollow" target="_blank">可以做到这一点，所以你不必手动列出它们。让我们安装它。</a></p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="1a5e" class="nc lx in mx b gy nd ne l nf ng">// inside the project tab<br/>npm i -D rollup-plugin-auto-external</span></pre><p id="a37f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">之后，稍微调整一下汇总配置。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="om on l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Marking node_modules imports as external</figcaption></figure><p id="bbf1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">另外，请注意<code class="fe mu mv mw mx b">typescript</code>插件的<code class="fe mu mv mw mx b">exclude</code>选项。如果您已经开始填写模板，它还会抑制一些警告。</p><h2 id="0673" class="nc lx in bd ly ob oc dn mc od oe dp mg lc of og mi lg oh oi mk lk oj ok mm ol bi translated">为项目创建目录并添加模板标志</h2><p id="c4f4" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">首先，我们需要创建另一个标志来存储模板，以便我们可以使用之前用作项目名称模板的参数。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="om on l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Move template from CLI call argument to -t flag</figcaption></figure><p id="07b9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">之后，我们需要添加另一个选项<code class="fe mu mv mw mx b">project</code>来存储调用参数，并在<code class="fe mu mv mw mx b">types.ts</code>中反映这一点。它不能为空，所以如果它没有被传递，我们必须要求用户指定它，并在提供值后检查它。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="om on l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Adding a project option and asking the user to enter it if it was not specified</figcaption></figure><p id="0c71" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">注意<code class="fe mu mv mw mx b">prompt-for-missing-options.ts</code>中关于<code class="fe mu mv mw mx b">project</code>选项问题中的<code class="fe mu mv mw mx b">validate</code>功能。如果值无效，它应该返回<code class="fe mu mv mw mx b">false</code>，这迫使用户键入不同的内容。有关可能的问题对象字段的更多信息，请参见<a class="ae ks" href="https://github.com/SBoudrias/Inquirer.js#questions" rel="noopener ugc nofollow" target="_blank">查询人文档</a>。</p><p id="bf23" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，我们需要添加对<code class="fe mu mv mw mx b">project</code>选项的支持。这必须是为项目创建目录的另一个任务的参数。让我们为这个任务创建一个函数。</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="f98c" class="nc lx in mx b gy nd ne l nf ng">// inside the project tab<br/>touch src/utils/create-project-directory.ts</span></pre><p id="fb04" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在让我们将目录创建逻辑添加到其中，并在我们的任务运行器中使用它。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="om on l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Adding a task to create a project directory</figcaption></figure><p id="5375" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请注意，我们已经将<code class="fe mu mv mw mx b">targetDirectory</code>从<code class="fe mu mv mw mx b">process.cwd()</code>更改为新创建的项目目录，以便其他任务能够正常工作。</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="5b52" class="nc lx in mx b gy nd ne l nf ng">// playground directory, e.g. /documents</span><span id="bb97" class="nc lx in mx b gy nh ne l nf ng">// targetDirectory === created directory /documents/something<br/>create-project something<br/>// template files will be copied to the /documents/something directory, the git repo will be initialized there and dependencies will be installed there</span><span id="6a06" class="nc lx in mx b gy nh ne l nf ng">// targetDirectory === process.cwd()<br/>create-project something<br/>// template files will be copied here to the /documents directory, same goes for the git repo and dependencies</span></pre><p id="4a82" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在，让我们检查一下一切是否正常。运行以下命令。</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="420c" class="nc lx in mx b gy nd ne l nf ng">// playground directory, e.g. /documents<br/>create-project</span></pre><p id="d1a0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">应该会提示您缺少参数。</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="e257" class="nc lx in mx b gy nd ne l nf ng">? Please type project's name (cannot be empty) dir<br/>? Please choose which project template to use JavaScript<br/>? Initialize a git repository? Yes<br/>? Install packages? (Y/n) Yes</span></pre><p id="6965" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">之后，您可以切换到项目目录并确保一切都按预期工作:模板文件被复制，git存储库被初始化，并且包(如果您在<code class="fe mu mv mw mx b">package.json</code>文件中添加了<code class="fe mu mv mw mx b">dependency</code>部分)被安装。</p><h2 id="091d" class="nc lx in bd ly ob oc dn mc od oe dp mg lc of og mi lg oh oi mk lk oj ok mm ol bi translated">自定义模板</h2><p id="1de9" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">什么是自定义模板？基本上，这是您的本地机器上包含所需模板的目录的路径。您可以运行以下命令，并期望从指定目录中的模板构建项目。</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="03d4" class="nc lx in mx b gy nd ne l nf ng">// playground directory, e.g. /documents<br/>create-project -t file:./my-custom-template</span></pre><p id="6d62" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在我们有两个支持的模板:JavaScript和TypeScript。如何实现对这种<code class="fe mu mv mw mx b">file:</code>语法的支持？</p><p id="649d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，我们需要为新类型的模板创建一个类型，并扩展模板验证助手，以便能够使用<code class="fe mu mv mw mx b">file:</code>语法。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="om on l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Adding type for custom templates</figcaption></figure><p id="4885" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">注意TypeScript <a class="ae ks" href="https://www.typescriptlang.org/docs/handbook/2/template-literal-types.html" rel="noopener ugc nofollow" target="_blank">模板文字语法</a>:我们可以使用类似<code class="fe mu mv mw mx b">`abc{string}`</code>的表达式来描述以特定字符开头的字符串。<code class="fe mu mv mw mx b">checkTemplateValidity</code>收到了对模板开始符号的额外检查，<code class="fe mu mv mw mx b">parseArgumentsIntoOptions</code>收到了关于<code class="fe mu mv mw mx b">file:</code>模板语法的额外日志。为了避免意外，我们还保留了<code class="fe mu mv mw mx b">file:</code>模板语法的情况。</p><p id="6f0f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">其次，我们需要弄清楚我们将从哪里获取模板。如果模板以<code class="fe mu mv mw mx b">file:</code>开始，我们必须解析给定的路径。否则，一切都应该和以前一样工作。</p><p id="f3d4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们创建另一个实用函数来获取基于其类型的模板路径。</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="e5d0" class="nc lx in mx b gy nd ne l nf ng">// inside the project tab<br/>touch src/utils/get-template-directory.ts</span></pre><p id="4cb6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">之后，给它添加下面的代码，并在<code class="fe mu mv mw mx b">main.ts</code>中使用它来得到<code class="fe mu mv mw mx b">templateDirectory</code>。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="om on l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Calculating template path based on its type</figcaption></figure><p id="864c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这里是另一个<code class="fe mu mv mw mx b">startWith</code>检查，看看我们是否有一个自定义模板。如果是，那么将使用给定的路径，如果不是，我们像以前一样使用一个受支持的模板。</p><p id="3f8d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们试试吧！</p><p id="3682" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">创建一个自定义模板目录，并在其中放置一些文件。</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="43d8" class="nc lx in mx b gy nd ne l nf ng">// playground directory, e.g. /documents<br/>mkdir my-custom-template<br/>touch my-custom-template/index.html</span></pre><p id="6e81" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在，让我们使用这个模板来创建一个项目。</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="09b6" class="nc lx in mx b gy nd ne l nf ng">// playground directory, e.g. /documents<br/>create-project my-project -t file:my-custom-template</span></pre><p id="f35f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当提供其他选项时，用<code class="fe mu mv mw mx b">n</code>键拒绝它们。等待项目创建完成。您应该会看到如下所示的日志。</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="9c77" class="nc lx in mx b gy nd ne l nf ng">? Initialize a git repository? No<br/>? Install packages? No<br/>  ✔ Create project directory<br/>  ✔ Copy project files<br/>  ↓ Install dependencies [skipped]<br/>    → Pass --install or -i to automatically install dependencies<br/>DONE Project ready</span></pre><p id="e5e0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">转到已创建项目的目录，确保它包含我们使用的定制模板中的<code class="fe mu mv mw mx b">index.html</code>文件。</p><p id="dfb6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">太好了！起作用了。但是像往常一样，有一个小问题。运行以下命令:</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="87b4" class="nc lx in mx b gy nd ne l nf ng">// playground directory, e.g. /documents<br/>create-project my-another-project -t file:my-nonexisted-template</span></pre><p id="ead1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">跳过提示。您应该会看到这样的日志:</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="4871" class="nc lx in mx b gy nd ne l nf ng">? Initialize a git repository? No<br/>? Install packages? No<br/>  ✔ Create project directory<br/>  ✖ Copy project files<br/>    Install dependencies<br/>ERROR Error occurred</span></pre><p id="7f3d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你注意到什么问题了吗？我们试图使用一个不存在的模板。这没什么不对的，对吧？我们怎么能用不存在的东西呢？让我们尝试使用现有的模板。</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="654d" class="nc lx in mx b gy nd ne l nf ng">// playground directory, e.g. /documents<br/>create-project my-another-project -t file:my-custom-template</span></pre><p id="ebe1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">砰！<code class="fe mu mv mw mx b">my-another-project</code>目录已经创建！</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="7268" class="nc lx in mx b gy nd ne l nf ng">? Initialize a git repository? No<br/>? Install packages? No<br/>  ✖ Create project directory<br/>    → mkdir: my-another-project: File exists<br/>    Copy project files<br/>    Install dependencies</span></pre><p id="9405" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">想象一下，你犯了一个小小的错别字，得到了一个错误，用正确的数据再试一次，但仍然看到错误。不太方便吧？在继续任何任务之前，我们需要检查模板目录。</p><p id="702e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，让我们再创建两个实用程序:</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="bee7" class="nc lx in mx b gy nd ne l nf ng">// inside the project tab<br/>touch src/utils/get-template.ts<br/>touch src/utils/custom-template-helpers.ts</span></pre><p id="031b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe mu mv mw mx b">get-template.ts</code>将用于从<code class="fe mu mv mw mx b">-t</code>标志中获取传递的模板或基于原始模板的<code class="fe mu mv mw mx b">undefined</code>。它也会记录错误，如果有的话，而不是<code class="fe mu mv mw mx b">parse-arguments-into-options.ts</code>。模板助手，比如检查传递的模板是否是自定义模板，它的路径解析器将存储在<code class="fe mu mv mw mx b">custom-template-helpers.ts</code>中。</p><p id="e4f4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在让我们在其中编写代码，并将它们与项目挂钩:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="om on l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Checking custom template before proceeding</figcaption></figure><p id="00ab" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">代码很多，我们来分解一下。</p><p id="64b8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，我们创建了上面的函数。</p><p id="253d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">其次，我们在<code class="fe mu mv mw mx b">parse-arguments-into-options.ts</code>中使用了<code class="fe mu mv mw mx b">getTemplate</code>。由于<code class="fe mu mv mw mx b">getTemplate</code>的异步特性，<code class="fe mu mv mw mx b">parseArgumentsIntoOptions</code>变成了异步的，所以<code class="fe mu mv mw mx b">cli</code>正在等待它。</p><p id="bff1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，我们重构了<code class="fe mu mv mw mx b">get-template-directory.ts</code>以使用来自<code class="fe mu mv mw mx b">custom-template-helpers.ts</code>的助手。</p><p id="e108" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们看看这是否解决了我们的问题。删除之前创建的<code class="fe mu mv mw mx b">my-another-project</code>目录，并尝试使用不存在的模板再次创建项目。</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="c2d7" class="nc lx in mx b gy nd ne l nf ng">// playground directory, e.g. /documents<br/>rm -rf my-another-project<br/>create-project my-another-project -t file:my-nonexistent-template</span></pre><p id="3346" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您应该会看到下面的日志:</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="37d8" class="nc lx in mx b gy nd ne l nf ng">WARNING There is no such template: /path/to-/template/my-nonexistent-template. Check the specified path</span></pre><p id="75f5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请停止向导，并使用现有模板重试。</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="acd6" class="nc lx in mx b gy nd ne l nf ng">// playground directory, e.g. /documents<br/>create-project my-another-project -t file:my-custom-template<br/>? Initialize a git repository? No<br/>? Install packages? No<br/>  ✔ Create project directory<br/>  ✔ Copy project files<br/>  ↓ Install dependencies [skipped]<br/>    → Pass --install or -i to automatically install dependencies<br/>DONE Project ready</span></pre><p id="364f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">真见鬼。我们解决了过早创建项目目录的问题，现在我们的CLI可以从自定义模板创建项目，正确处理它们并方便地响应可能的错误。</p><h2 id="f5f7" class="nc lx in bd ly ob oc dn mc od oe dp mg lc of og mi lg oh oi mk lk oj ok mm ol bi translated">强壮的</h2><p id="a411" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">什么是<a class="ae ks" href="https://typicode.github.io/husky/#/" rel="noopener ugc nofollow" target="_blank">哈士奇</a>？它是一个在提交或推送时运行某些东西的工具。Husky使得在提交或推送代码之前运行测试、lint代码甚至提交消息变得简单。我们不会强制执行特定的操作，但会初始化Husky以在提交时运行默认的<code class="fe mu mv mw mx b">npm test</code>。</p><p id="8956" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，让我们添加对另一个选项<code class="fe mu mv mw mx b">-h</code>的支持。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="om on l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Adding -h option</figcaption></figure><p id="fafb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请注意，新标志<code class="fe mu mv mw mx b">-h</code> ( <code class="fe mu mv mw mx b">--husky</code>)用于执行<code class="fe mu mv mw mx b">-g</code>和<code class="fe mu mv mw mx b">-i</code>标志。为什么？</p><ol class=""><li id="d906" class="ni nj in kv b kw kx kz la lc nk lg nl lk nm lo nn no np nq bi translated">没有git就没有使用Husky的意义。</li><li id="d26a" class="ni nj in kv b kw nr kz ns lc nt lg nu lk nv lo nn no np nq bi translated"><a class="ae ks" href="https://typicode.github.io/husky/#/?id=automatic-recommended" rel="noopener ugc nofollow" target="_blank">Husky</a>的自动设置需要在<code class="fe mu mv mw mx b">husky-init</code>之后安装依赖项。</li></ol><p id="5948" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们还为Husky选项添加了一个提示，但只在设置了git选项时，无论是通过call参数还是提示。当使用提示选择Husky选项时，不会提示安装选项设置，并且安装选项的答案值会自动设置为<code class="fe mu mv mw mx b">true</code>。它为<code class="fe mu mv mw mx b">-h</code>选项提供了一致的行为，无论是用call参数还是提示符指定。</p><p id="cb3d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">之后，让我们创建另一个util来初始化Husky:</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="df75" class="nc lx in mx b gy nd ne l nf ng">// inside the project tab<br/>touch src/utils/init-husky.ts</span></pre><p id="bf3c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，让我们为这个任务编写代码，并在任务运行器中使用它:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="om on l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Creating and using a Husky task</figcaption></figure><p id="0061" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">注意，我使用了<code class="fe mu mv mw mx b">npx</code>来运行<code class="fe mu mv mw mx b">husky-init</code>。如果您使用<a class="ae ks" href="https://yarnpkg.com/" rel="noopener ugc nofollow" target="_blank">纱线</a>或<a class="ae ks" href="https://pnpm.io/" rel="noopener ugc nofollow" target="_blank"> pnpm </a>，您必须使用<a class="ae ks" href="https://typicode.github.io/husky/#/?id=automatic-recommended" rel="noopener ugc nofollow" target="_blank">文档</a>中提到的不同命令。</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="6160" class="nc lx in mx b gy nd ne l nf ng">npx husky-init &amp;&amp; npm install       # npm<br/>npx husky-init &amp;&amp; yarn              # Yarn 1<br/>yarn dlx husky-init --yarn2 &amp;&amp; yarn # Yarn 2+<br/>pnpm dlx husky-init &amp;&amp; pnpm install # pnpm</span></pre><p id="c9bf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我有意跳过安装依赖项，因为这是一个已经存在的独立任务。</p><p id="5ecf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在，让我们检查该选项是否被选中并正常工作。运行以下命令。确定您的终端中的日志与下面的匹配:</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="5e0b" class="nc lx in mx b gy nd ne l nf ng">// playground directory, e.g. /documents</span><span id="c4c6" class="nc lx in mx b gy nh ne l nf ng">// 1. Without -g or -h. Reject prompt for -g<br/>create-project project-name -t javascript<br/>? Initialize a git repository? No<br/>? Install packages? (Y/n)</span><span id="16c2" class="nc lx in mx b gy nh ne l nf ng">// 2. Without -g or -h. Accept prompt for -g. Reject prompt for -h<br/>create-project project-name -t javascript<br/>? Initialize a git repository? Yes<br/>? Initialize Husky? No<br/>? Install packages? (Y/n)</span><span id="fe0a" class="nc lx in mx b gy nh ne l nf ng">// 3. Without -g or -h. Accept prompt for -g. Accept prompt for -h<br/>create-project project-name -t javascript<br/>? Initialize a git repository? Yes<br/>? Initialize Husky? Yes<br/>// There should be no prompt for -i</span><span id="7b9f" class="nc lx in mx b gy nh ne l nf ng">// 4. With -g. Assume that rejecting/accepting the prompt for -h works the same way as before<br/>create-project project-name -t javascript -g<br/>? Initialize Husky? (y/N)</span><span id="5b47" class="nc lx in mx b gy nh ne l nf ng">// 5. With -h<br/>create-project project-name -t javascript -h<br/>// There should be no prompts at all</span></pre><p id="a64a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">此外，检查哈士奇是真的安装。</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="c69c" class="nc lx in mx b gy nd ne l nf ng">// playground directory, e.g. /documents<br/>// assume you created a project named project-name<br/>cat project-name/.husky/pre-commit</span></pre><p id="8117" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您应该会看到下面的日志。如果是，那么一切都很好。</p><pre class="kd ke kf kg gt my mx mz na aw nb bi"><span id="ba52" class="nc lx in mx b gy nd ne l nf ng">#!/usr/bin/env sh<br/>. "$(dirname -- "$0")/_/husky.sh"</span><span id="29f9" class="nc lx in mx b gy nh ne l nf ng">npm test</span></pre></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="4cbc" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">结论</h1><p id="b614" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">我们做得很好！我们现在可以为项目创建目录，使用定制模板，并为git项目设置Husky。我们的CLI变得越来越强大和方便。</p><p id="8713" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我还想在这个系列中介绍一些内容，比如发布到NPM和CI/CD。关注并订阅，让你不要错过！</p><p id="bc5e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你喜欢这篇文章，请告诉我！</p><p id="2db4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">祝你今天开心！玩的开心！</p><p id="6273" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="mt">更多内容请看</em><a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mt">plain English . io</em></strong></a><em class="mt">。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="mt">免费周报</em> </strong> </a> <em class="mt">。关注我们关于</em><a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mt">Twitter</em></strong></a><em class="mt">和</em><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mt">LinkedIn</em></strong></a><em class="mt">。查看我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="mt">社区不和谐</em> </strong> </a> <em class="mt">加入我们的</em> <a class="ae ks" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="mt">人才集体</em> </strong> </a> <em class="mt">。</em></p></div></div>    
</body>
</html>