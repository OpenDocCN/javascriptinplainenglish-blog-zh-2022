<html>
<head>
<title>React Crash Course — POST and DELETE Methods</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React速成班—发布和删除方法</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-crash-course-post-and-delete-methods-675f95dffe0f?source=collection_archive---------7-----------------------#2022-03-01">https://javascript.plainenglish.io/react-crash-course-post-and-delete-methods-675f95dffe0f?source=collection_archive---------7-----------------------#2022-03-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="092d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第10部分:在React应用程序中调用fetch来更新后端</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/194b8609c1e921e3af6dbdfe529d82dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JVyiL97Pn2cKtfmt"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@lautaroandreani?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Lautaro Andreani</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="de2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls"> Live dev笔记由</em> <a class="ae kv" href="https://www.youtube.com/channel/UCTZRcDjjkVajGL6wd76UnGg" rel="noopener ugc nofollow" target="_blank"> <em class="ls">丹尼斯·艾维</em></a><em class="ls">——</em><a class="ae kv" href="https://www.youtube.com/watch?v=6fM3ueN9nYM" rel="noopener ugc nofollow" target="_blank"><em class="ls">React JS速成班</em> </a></p><blockquote class="lt"><p id="23b4" class="lu lv iq bd lw lx ly lz ma mb mc lr dk translated">在第10部分中，我们将添加删除和创建注释功能，这两个功能将分别使用delete和POST方法。在这个过程中，我们将在React组件中构建更多的HTML元素来运行这些功能。</p></blockquote></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><p id="6921" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你也可以参考我的Github repo:</p><div class="mk ml gp gr mm mn"><a href="https://github.com/emilyyleung/notesapp/tree/Part-10/POST-and-DELETE-Methods" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd ir gy z fp ms fr fs mt fu fw ip bi translated">GitHub-Emily leung/notes app at Part-10/POST-and-DELETE-Methods</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">在GitHub上创建一个帐户，为Emily leung/notes app的开发做出贡献。</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">github.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb kp mn"/></div></div></a></div></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="b537" class="nc nd iq bd ne nf ng nh ni nj nk nl nm jw nn jx no jz np ka nq kc nr kd ns nt bi translated">删除注释</h1><p id="b817" class="pw-post-body-paragraph kw kx iq ky b kz nu jr lb lc nv ju le lf nw lh li lj nx ll lm ln ny lp lq lr ij bi translated">为了删除注释，我们将在<code class="fe nz oa ob oc b">&lt;h3&gt;</code>标签下的<code class="fe nz oa ob oc b">NotePage</code>组件中添加一个按钮元素。我们将赋予它一个<code class="fe nz oa ob oc b">onClick</code>属性来运行我们将要创建的<code class="fe nz oa ob oc b">deleteNote</code>函数。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="d30b" class="oh nd iq oc b gy oi oj l ok ol">// notesapp &gt; src &gt; pages &gt; NotePage.js</span><span id="6296" class="oh nd iq oc b gy om oj l ok ol">return (<br/> &lt;div className='note'&gt;<br/>  &lt;div className='note-header'&gt;<br/>   &lt;h3&gt;<br/>     &lt;ArrowLeft onClick={handleSubmit} /&gt;<br/>   &lt;/h3&gt;<br/>   <strong class="oc ir">&lt;button onClick={deleteNote}&gt;Delete&lt;/button&gt;</strong><br/>  &lt;/div&gt;<br/>  &lt;textarea<br/>   onChange={(e) =&gt; {<br/>    setNote({ ...note, body: e.target.value });<br/>   }}<br/>   value={note?.body}<br/>  &gt;&lt;/textarea&gt;<br/> &lt;/div&gt;<br/>);</span></pre><p id="713f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了我们用<code class="fe nz oa ob oc b">DELETE</code>替换了<code class="fe nz oa ob oc b">PUT</code>之外，<code class="fe nz oa ob oc b">deleteNote</code>函数看起来与我们的<code class="fe nz oa ob oc b">updateNote</code>函数非常相似。一旦发出获取请求，我们还将包括历史重定向方法。</p><blockquote class="on oo op"><p id="f58f" class="kw kx ls ky b kz la jr lb lc ld ju le oq lg lh li or lk ll lm os lo lp lq lr ij bi translated"><em class="iq">由于注释的内容没有改变(但被完全删除)，请求中不需要</em> <code class="fe nz oa ob oc b"><em class="iq">body</em></code> <em class="iq">属性。</em></p></blockquote><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="5f82" class="oh nd iq oc b gy oi oj l ok ol">// notesapp &gt; src &gt; pages &gt; NotePage.js</span><span id="d673" class="oh nd iq oc b gy om oj l ok ol">let deleteNote = async () =&gt; {<br/> await fetch(`<a class="ae kv" href="http://localhost:8000/notes/${noteId}`" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/notes/${noteId}`</a>, {<br/>  method: "DELETE",<br/> });<br/> history.push("/");<br/>};</span></pre><h1 id="3c1f" class="nc nd iq bd ne nf ot nh ni nj ou nl nm jw ov jx no jz ow ka nq kc ox kd ns nt bi translated">空白票据移除</h1><p id="0db3" class="pw-post-body-paragraph kw kx iq ky b kz nu jr lb lc nv ju le lf nw lh li lj nx ll lm ln ny lp lq lr ij bi translated">该应用程序还被设计为在注释内容为空时删除注释。我们可以在退出笔记时测试这一点。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="945f" class="oh nd iq oc b gy oi oj l ok ol">// notesapp &gt; src &gt; pages &gt; NotePage.js</span><span id="6cb1" class="oh nd iq oc b gy om oj l ok ol">let handleSubmit = async () =&gt; {<br/> <strong class="oc ir">if (!note.body) {<br/>  await deleteNote();<br/> }</strong><br/> await updateNote();<br/> history.push("/");<br/>};</span></pre><h1 id="facd" class="nc nd iq bd ne nf ot nh ni nj ou nl nm jw ov jx no jz ow ka nq kc ox kd ns nt bi translated">创建便笺</h1><p id="f7b2" class="pw-post-body-paragraph kw kx iq ky b kz nu jr lb lc nv ju le lf nw lh li lj nx ll lm ln ny lp lq lr ij bi translated">为了创建一个新的注释，我们将在components文件夹中包含一个add button组件。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="1512" class="oh nd iq oc b gy oi oj l ok ol">notesapp<br/>├── public<br/>│   └── index.html<br/>└── src<br/>    ├── assets<br/>    │    ├── arrow-left.svg<br/>    │    └── data.js<br/>    ├── pages<br/>    │    ├── NotePage.js<br/>    │    └── NotesListPage.js<br/>    ├── components<br/>    │    ├── Header.js<br/>    │    ├── ListItem.js<br/>    │    └── <strong class="oc ir">AddButton.js // Create new component</strong><br/>    ├── App.css<br/>    ├── App.js<br/>    └── index.js</span></pre><p id="dd3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nz oa ob oc b">AddButton</code>组件的工作方式类似于我们的<code class="fe nz oa ob oc b">ListItem</code>组件，我们将使用来自<code class="fe nz oa ob oc b">react-router-dom</code>的<code class="fe nz oa ob oc b">Link</code>组件。按钮将发送到<code class="fe nz oa ob oc b">/note/new</code>。它将使用来自<a class="ae kv" href="https://mumbleui.com/icons" rel="noopener ugc nofollow" target="_blank"> Mumble UI </a>的另一个SVG，因此我们需要导入SVG文件作为它自己的ReactComponent。</p><blockquote class="on oo op"><p id="927c" class="kw kx ls ky b kz la jr lb lc ld ju le oq lg lh li or lk ll lm os lo lp lq lr ij bi translated"><em class="iq">注意:AddButton组件只是将用户重定向到一个自定义路线，而不是创建一个新的注释</em></p></blockquote><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="bc29" class="oh nd iq oc b gy oi oj l ok ol">// notesapp &gt; src &gt; components &gt; AddButton.js</span><span id="7883" class="oh nd iq oc b gy om oj l ok ol">import { Link } from "react-router-dom";<br/>import { ReactComponent as AddIcon } from "../assets/add.svg";</span><span id="8c58" class="oh nd iq oc b gy om oj l ok ol">const AddButton = () =&gt; {<br/> return (<br/>  &lt;Link to='/note/new' className='floating-button'&gt;<br/>   &lt;AddIcon /&gt;<br/>  &lt;/Link&gt;<br/> );<br/>};<br/>export default AddButton;</span></pre><p id="1790" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">准备好组件后，让我们将其导入<code class="fe nz oa ob oc b">NotesListPage</code></p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="16ff" class="oh nd iq oc b gy oi oj l ok ol">// notesapp &gt; src &gt; pages &gt; NotesListPage.js</span><span id="b3b0" class="oh nd iq oc b gy om oj l ok ol">import AddButton from '../components/AddButton'</span></pre><p id="95ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后将<code class="fe nz oa ob oc b">AddButton</code>组件包含在父div最底部的JSX中。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="a58e" class="oh nd iq oc b gy oi oj l ok ol">// notesapp &gt; src &gt; pages &gt; NotesListPage.js</span><span id="146c" class="oh nd iq oc b gy om oj l ok ol">return (<br/>    &lt;div className='notes'&gt;<br/>        &lt;div className='notes-header'&gt;<br/>            &lt;h2 className='notes-title'&gt;&amp;#9782; Notes&lt;/h2&gt;<br/>            &lt;p className='notes-count'&gt;{notes.length}&lt;/p&gt;<br/>        &lt;/div&gt;<br/>        &lt;div className='notes-list'&gt;<br/>            {notes.map((note, index) =&gt; <br/>                &lt;ListItem key={index} note={note}/&gt;<br/>            )}<br/>        &lt;/div&gt;</span><span id="4dc8" class="oh nd iq oc b gy om oj l ok ol">        <strong class="oc ir">&lt;AddButton/&gt;</strong><br/>    &lt;/div&gt;<br/>)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/7ee41e43bc9353afc8e49d75d9d122f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8muUkIwW8l4I8nQH"/></div></div></figure><p id="46e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了指示应用程序创建一个新的便笺，我们将添加一个<code class="fe nz oa ob oc b">createNote</code>处理程序向我们的后端发送一个<code class="fe nz oa ob oc b">POST</code>请求。当用户在新便笺中单击后退箭头时，该处理程序被触发。</p><p id="ea38" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">默认情况下，note对象将拥有包含我们的注释内容的<code class="fe nz oa ob oc b">body</code>键，但是<code class="fe nz oa ob oc b">updated</code>属性将被添加到当前日期时间对象中。<code class="fe nz oa ob oc b">id</code>将在保存时创建。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="7528" class="oh nd iq oc b gy oi oj l ok ol">// notesapp &gt; src &gt; pages &gt; NotePage.js</span><span id="0034" class="oh nd iq oc b gy om oj l ok ol">let createNote = async () =&gt; {<br/> await fetch("<a class="ae kv" href="http://localhost:8000/notes/" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/notes/</a>", {<br/>  method: "POST",<br/>  headers: {<br/>   "Content-Type": "application/json",<br/>  },<br/>  body: JSON.stringify({ ...note, updated: new Date() }),<br/> });<br/>};</span></pre><p id="e804" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当用户返回主页时,<code class="fe nz oa ob oc b">handleSubmit</code>函数需要知道如何处理该便笺。</p><p id="90ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在对当前便笺运行正确的函数之前，返回箭头处理程序函数需要测试一些场景:</p><ul class=""><li id="f7ab" class="oz pa iq ky b kz la lc ld lf pb lj pc ln pd lr pe pf pg ph bi translated">如果注释不是新的并且没有注释内容→删除注释</li><li id="47f7" class="oz pa iq ky b kz pi lc pj lf pk lj pl ln pm lr pe pf pg ph bi translated">如果注释的ID为“新”并且内容不为空→创建注释</li><li id="17f2" class="oz pa iq ky b kz pi lc pj lf pk lj pl ln pm lr pe pf pg ph bi translated">如果注释没有“新”ID→更新注释</li></ul><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="ee63" class="oh nd iq oc b gy oi oj l ok ol">// notesapp &gt; src &gt; pages &gt; NotePage.js</span><span id="9302" class="oh nd iq oc b gy om oj l ok ol">let handleSubmit = () =&gt; {</span><span id="9481" class="oh nd iq oc b gy om oj l ok ol">   <strong class="oc ir"> if (noteId !== 'new' &amp;&amp; !note.body) {<br/>        await deleteNote()<br/>    } else if (noteId === 'new' &amp;&amp; note !== null) {<br/>        await createNote()<br/>    } else if (noteId !== 'new') {<br/>        await updateNote()<br/>    }</strong></span><span id="2e7a" class="oh nd iq oc b gy om oj l ok ol">    history.push('/')<br/>}</span></pre><h1 id="3e2c" class="nc nd iq bd ne nf ot nh ni nj ou nl nm jw ov jx no jz ow ka nq kc ox kd ns nt bi translated">隐藏错误</h1><p id="3c8c" class="pw-post-body-paragraph kw kx iq ky b kz nu jr lb lc nv ju le lf nw lh li lj nx ll lm ln ny lp lq lr ij bi translated">创建新笔记时需要理解的一点是，通过将用户重定向到<code class="fe nz oa ob oc b">http://localhost:8000/notes/new</code>，我们实际上是在试图搜索数据库中不存在的笔记。因此，每次都会返回一个错误(尽管我们在应用程序中看不到它)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pn"><img src="../Images/dd194196c7ef1f827e96db66aeb6819e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7-sDjG_o9OGYRB5v"/></div></div></figure><p id="34d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以在<code class="fe nz oa ob oc b">getNote</code>函数中抛出这个错误，通过检查<code class="fe nz oa ob oc b">noteId</code>值来确定我们是否运行fetch请求。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="d55a" class="oh nd iq oc b gy oi oj l ok ol">// notesapp &gt; src &gt; pages &gt; NotePage.js</span><span id="21e4" class="oh nd iq oc b gy om oj l ok ol">let getNote = async () =&gt; {<br/>  <strong class="oc ir">if (noteId === 'new') return;</strong><br/>  let response = await fetch(`http://localhost:8000/notes/${noteId}/`);<br/>  let data = await response.json();<br/>  setNote(data);<br/>}</span></pre><blockquote class="on oo op"><p id="c410" class="kw kx ls ky b kz la jr lb lc ld ju le oq lg lh li or lk ll lm os lo lp lq lr ij bi translated"><em class="iq">此外，当我们创建一个新便笺但没有填写任何内容并点击返回箭头时，仍然会创建一个空便笺。通过修复这个隐藏的错误，我们也解决了这个问题——因为</em> <code class="fe nz oa ob oc b"><em class="iq">setNote</em></code> <em class="iq">函数不会被触发。</em></p></blockquote><h1 id="91be" class="nc nd iq bd ne nf ot nh ni nj ou nl nm jw ov jx no jz ow ka nq kc ox kd ns nt bi translated">条件按钮</h1><p id="e09b" class="pw-post-body-paragraph kw kx iq ky b kz nu jr lb lc nv ju le lf nw lh li lj nx ll lm ln ny lp lq lr ij bi translated">我们可以添加的另一个特性是，当我们创建一个新的注释时，我们可以有条件地指定按钮的文本来显示“done”(如果注释是新的)或“delete”(如果它是一个现有的注释)。最重要的是，我们要确保按钮也运行正确的功能。使用三元运算测试<code class="fe nz oa ob oc b">noteId</code>的值是可能的</p><p id="bb97" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您还应该注意到，删除注释按钮将直接运行<code class="fe nz oa ob oc b">deleteNote</code>功能。这使得应用程序不必做任何不必要的检查。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="240e" class="oh nd iq oc b gy oi oj l ok ol">// notesapp &gt; src &gt; pages &gt; NotePage.js</span><span id="69d7" class="oh nd iq oc b gy om oj l ok ol">return (<br/>    &lt;div className='note'&gt;<br/>        &lt;div className='note-header'&gt;<br/>            &lt;h3&gt;<br/>                &lt;Link to="/"&gt;<br/>                    &lt;ArrowLeft onClick={handleSubmit}/&gt;<br/>                &lt;/Link&gt;<br/>            &lt;/h3&gt;</span><span id="2917" class="oh nd iq oc b gy om oj l ok ol">            <strong class="oc ir">{noteId !== 'new' ? (<br/>                &lt;button onClick={deleteNote}&gt;Delete&lt;/button&gt;    <br/>            ) : (<br/>                &lt;button onClick={handleSubmit}&gt;Done&lt;/button&gt;<br/>            )}</strong><br/>            <br/>        &lt;/div&gt;<br/>        <br/>        &lt;textarea onChange={(e) =&gt; {setNote({...note, body:e.target.value})}} value={note?.body}&gt;&lt;/textarea&gt;</span><span id="155d" class="oh nd iq oc b gy om oj l ok ol">    &lt;/div&gt;<br/>)</span></pre><p id="4d49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一篇文章将研究如何添加有用的细节，比如缩短标题和包含一个格式良好的日期。</p><p id="60d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">更多内容请看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ls">plain English . io</em></strong></a><em class="ls">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ls">免费周报</em> </strong> </a> <em class="ls">。关注我们关于</em><a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ls">Twitter</em></strong></a><em class="ls">和</em><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ls">LinkedIn</em></strong></a><em class="ls">。加入我们的</em> <a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ls">社区不和谐</em> </strong> </a> <em class="ls">。</em></p></div></div>    
</body>
</html>