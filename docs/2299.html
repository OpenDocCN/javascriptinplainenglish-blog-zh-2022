<html>
<head>
<title>How to Unzip a File with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Node.js解压文件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/unzip-a-file-with-nodejs-5f94b360f7df?source=collection_archive---------0-----------------------#2022-05-29">https://javascript.plainenglish.io/unzip-a-file-with-nodejs-5f94b360f7df?source=collection_archive---------0-----------------------#2022-05-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5cae" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在FS能够实现的所有特性中，解压缩不是其中之一。让我们看看如何使用Node.js来实现这一点</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e1a2154976c0bb869cbc2c6e48e495cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sznusBUWAT8tWWkyIDY_nQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by Daniel Battersby: <a class="ae kv" href="https://www.pexels.com/photo/close-up-view-of-man-zipping-jacket-9965135/" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/photo/close-up-view-of-man-zipping-jacket-9965135/</a></figcaption></figure><p id="4d00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Node.js不支持Zip。通过查看，我们可以找到一些库，但是没有一个库提供如何做的清晰文档。</p><p id="2971" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们今天会努力解决这个问题！</p><p id="eb7f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于本文，我选择了库<strong class="ky ir"> jszip </strong>，因为它是<strong class="ky ir">最轻的</strong>和<strong class="ky ir">最容易使用的</strong>！</p><div class="ls lt gp gr lu lv"><a href="https://www.npmjs.com/package/jszip" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">jszip</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">一个用于创建、阅读和编辑的库。用JavaScript压缩文件，有一个可爱简单的API。看…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">www.npmjs.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj kp lv"/></div></div></a></div></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="b341" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">设置我们的环境</h1><p id="5b3b" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">在开始编写任何代码之前，让我们设置一下我们的环境。</p><blockquote class="no np nq"><p id="beab" class="kw kx nr ky b kz la jr lb lc ld ju le ns lg lh li nt lk ll lm nu lo lp lq lr ij bi translated">您将需要一个Node.js环境，因为它不能与任何基于web的环境一起工作。虽然Jszip是web兼容的，但是我们将使用fs来读取我们的文件</p></blockquote><p id="dd37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们用命令<code class="fe nv nw nx ny b">npm install -S jszip</code>安装jszip</p><p id="0d4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，我们还需要一个zip文件。但是我认为，如果你看到了这篇文章，那是因为你已经有了一篇文章，而你不知道如何提取它！对于我的文章，我将我的<code class="fe nv nw nx ny b">package-lock.json</code>压缩成一个zip文件。下面是它的结构:</p><pre class="kg kh ki kj gt nz ny oa ob aw oc bi"><span id="9d97" class="od ms iq ny b gy oe of l og oh">- package-lock<br/>  | package-lock.json</span></pre><h1 id="cd1d" class="mr ms iq bd mt mu oi mw mx my oj na nb jw ok jx nd jz ol ka nf kc om kd nh ni bi translated">打开我们的zip文件</h1><p id="1544" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">在能够提取zip文件的内容之前，我们需要访问它。为此，我们将使用内置的文件系统模块<code class="fe nv nw nx ny b">fs</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/468c74d7506e5dee0841c8b049396fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wZE5N2YYf77GpC1XoRAsug.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Read the zip file</figcaption></figure><blockquote class="no np nq"><p id="2091" class="kw kx nr ky b kz la jr lb lc ld ju le ns lg lh li nt lk ll lm nu lo lp lq lr ij bi translated">因为我的项目非常小。我必须创建一个函数并执行它来使用async/await特性。</p></blockquote><p id="9e27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">读取文件时不需要精确的编码</strong>，我们需要的只是文件的原始内容。</p><h1 id="17dc" class="mr ms iq bd mt mu oi mw mx my oj na nb jw ok jx nd jz ol ka nf kc om kd nh ni bi translated">加载我们的zip文件</h1><p id="f7d8" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">现在读完这个文件后，我们想用Jszip加载它。首先，我们必须创建它的一个实例:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/2b543ecb687219022bdca6f229db65db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GLtWt-YACz8Jhi6upYkKLg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Creating an instance of jszip</figcaption></figure><p id="2998" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建实例后，我们可以通过添加以下代码来加载我们的文件:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/6b838cbe399c8d20b0c8f0abe4fcbedd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a28bIWXksiW_wFG7IcCo1g.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Load the zip file</figcaption></figure><p id="0e0e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经加载了我们的文件，让我们停下来看一下它的内容。在上面运行console.log，下面是打印的内容:</p><pre class="kg kh ki kj gt nz ny oa ob aw oc bi"><span id="530c" class="od ms iq ny b gy oe of l og oh">{                                    <br/>  files: [Object: null prototype] {  <br/>    'package-lock/': {               <br/>      name: 'package-lock/',         <br/>      dir: true,                     <br/>      date: 2022-05-29T18:12:24.000Z,<br/>      comment: null,                 <br/>      unixPermissions: null,         <br/>      dosPermissions: 16,            <br/>      _data: [Promise],              <br/>      _dataBinary: true,             <br/>      options: [Object]<br/>    },<br/>    'package-lock/package-lock.json': {<br/>      name: 'package-lock/package-lock.json',<br/>      dir: false,<br/>      date: 2022-05-01T22:40:52.000Z,<br/>      comment: null,<br/>      unixPermissions: null,<br/>      dosPermissions: 32,<br/>      _data: [Object],<br/>      _dataBinary: true,<br/>      options: [Object],<br/>      unsafeOriginalName: 'package-lock/package-lock.json'<br/>    }<br/>  },<br/>  comment: null,<br/>  root: '',<br/>  clone:</span></pre><p id="3219" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到像<code class="fe nv nw nx ny b">comment </code>或<code class="fe nv nw nx ny b">root</code>这样的几个项目，但我们不会对它们给予太多关注。</p><p id="19c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，有趣的是<code class="fe nv nw nx ny b">files</code>对象。我们有两件东西:</p><ul class=""><li id="57fe" class="op oq iq ky b kz la lc ld lf or lj os ln ot lr ou ov ow ox bi translated">包装锁/</li><li id="4e4c" class="op oq iq ky b kz oy lc oz lf pa lj pb ln pc lr ou ov ow ox bi translated">包锁/包锁. json</li></ul><p id="26ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一个是包含我们的文件的文件夹。我们可以确认它是一个文件夹，因为项目<code class="fe nv nw nx ny b">dir</code>是真实的。</p><p id="203e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第二项包含在我们的文件夹中，它是我们的package-lock.json。</p><h1 id="0f0f" class="mr ms iq bd mt mu oi mw mx my oj na nb jw ok jx nd jz ol ka nf kc om kd nh ni bi translated">在当前目录中解压我们的zip文件</h1><p id="3fcf" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">现在，让我们把它们都提取出来。提取所有项目的最简单的方法是通过循环使用<code class="fe nv nw nx ny b">files</code>对象中的键，然后创建一个新目录(如果它是一个目录)或创建文件。</p><blockquote class="no np nq"><p id="4441" class="kw kx nr ky b kz la jr lb lc ld ju le ns lg lh li nt lk ll lm nu lo lp lq lr ij bi translated">Jszip做得很好，将始终遵循逻辑顺序，这意味着<strong class="ky ir">目录将始终在文件</strong>之前，您不会因为目录不存在而无法创建文件</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/765444e8ad804124a9f0b48eee7896fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y5eLfhr96IU1sVc4xS1ksg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Looping through the files</figcaption></figure><blockquote class="no np nq"><p id="8af3" class="kw kx nr ky b kz la jr lb lc ld ju le ns lg lh li nt lk ll lm nu lo lp lq lr ij bi translated">在这种情况下，我决定使用for循环，因为我们稍后需要做一些异步操作。</p></blockquote><p id="1ef8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这段代码中，我们遍历所有的键，获取相应的文件并检查它是否是一个目录。如果是一个目录，我们简单地用<code class="fe nv nw nx ny b">fs.mkdirSync</code>创建一个目录。</p><blockquote class="no np nq"><p id="512a" class="kw kx nr ky b kz la jr lb lc ld ju le ns lg lh li nt lk ll lm nu lo lp lq lr ij bi translated">如果您愿意，也可以使用<code class="fe nv nw nx ny b">fs.mkdir</code>。</p></blockquote><p id="4724" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们必须写我们的文件。为此，我们将使用每个文件项可用的<code class="fe nv nw nx ny b">fs.writeFileSync</code>和<code class="fe nv nw nx ny b">async()</code>函数。这个函数允许我们将文件转换成fs可以理解和写入的可读格式。在我们的情况下，这将是一个<code class="fe nv nw nx ny b">arraybuffer</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pd"><img src="../Images/8a56f507da3ff4203ac53be96bbffd9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*su7FBzTx2gdeIp-dk9RooQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Our final code</figcaption></figure><p id="0861" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们到了。如果您运行这段代码，您将能够提取并复制根目录中zip文件的内容！</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="4dcb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是用Node.js和Jszip解压文件的全部内容。如果你想在评论里放一篇文章，请告诉我！</p><p id="e9b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你喜欢这篇文章，不要犹豫留下掌声或关注！</p><p id="cba9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nr">更多内容看</em> <a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nr">说白了。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nr">免费周报</em> </strong> </a> <em class="nr">。关注我们关于</em><a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="nr">Twitter</em></strong></a><em class="nr">和</em><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="nr">LinkedIn</em></strong></a><em class="nr">。查看我们的</em> <a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nr">社区不和谐</em> </strong> </a> <em class="nr">加入我们的</em> <a class="ae kv" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nr">人才集体</em> </strong> </a> <em class="nr">。</em></strong></a></p></div></div>    
</body>
</html>