<html>
<head>
<title>How to Use the New Node.js 18 Test Runner</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用新的Node.js 18测试运行程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-the-new-node-js-18-test-runner-6afaa06e64e0?source=collection_archive---------1-----------------------#2022-05-02">https://javascript.plainenglish.io/how-to-use-the-new-node-js-18-test-runner-6afaa06e64e0?source=collection_archive---------1-----------------------#2022-05-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9c40" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">概述Node.js测试模块以及如何使用它为Node.js代码编写测试。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/050c4cb57e97aefbccd0070600495a35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YQnoXB3d_emDY7hz"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@antoine1003?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Antoine Dautry</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="fea5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Node.js 18于4月19日发布，带来了一些新特性。在本文中，我们将介绍实验性的Node.js测试模块，以及如何使用它为Node.js代码编写测试。</p><h1 id="75d3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">我们应该测试什么？</strong></h1><p id="6563" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">您可以跟随任何Node.js项目，但是为了简单起见，我们将使用在我讨论Jest测试的前一篇文章<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/learn-jest-javascript-unit-testing-5ca104b564ce">中使用的相同项目。</a></p><div class="mp mq gp gr mr ms"><a rel="noopener  ugc nofollow" target="_blank" href="/learn-jest-javascript-unit-testing-5ca104b564ce"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">学习Jest——JavaScript单元测试</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">单元测试是指测试单个的代码单元，甚至是多个代码单元，以确保它们能正常工作…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng kp ms"/></div></div></a></div><p id="7c60" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为您的项目创建一个新目录，并创建一个名为<code class="fe nh ni nj nk b">index.js</code>的新文件:</p><pre class="kg kh ki kj gt nl nk nm nn aw no bi"><span id="80d1" class="np lt iq nk b gy nq nr l ns nt">function add(a, b) {<br/>  return a + b<br/>}</span><span id="8e89" class="np lt iq nk b gy nu nr l ns nt">function subtract(a, b) {<br/>  return a - b<br/>}</span><span id="66db" class="np lt iq nk b gy nu nr l ns nt">function multiply(a, b) {<br/>  return a * b<br/>}</span><span id="56de" class="np lt iq nk b gy nu nr l ns nt">function divide(a, b) {<br/>  return a / b<br/>}</span><span id="8690" class="np lt iq nk b gy nu nr l ns nt">function power(a, b) {<br/>  return a ** b<br/>}</span><span id="6f87" class="np lt iq nk b gy nu nr l ns nt">module.exports = {<br/>  add,<br/>  subtract,<br/>  multiply,<br/>  divide,<br/>  power<br/>}</span></pre><h1 id="fda0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">写作测试</strong></h1><p id="4963" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">为了在Node.js中编写测试，我们使用<code class="fe nh ni nj nk b"><a class="ae kv" href="https://nodejs.org/dist/latest-v18.x/docs/api/test.html" rel="noopener ugc nofollow" target="_blank">node:test</a></code>模块来定义我们的测试，使用<code class="fe nh ni nj nk b"><a class="ae kv" href="https://nodejs.org/dist/latest-v18.x/docs/api/assert.html" rel="noopener ugc nofollow" target="_blank">assert</a></code>模块来做出不同的断言。实际上，我们将使用<code class="fe nh ni nj nk b"><a class="ae kv" href="https://nodejs.org/dist/latest-v18.x/docs/api/assert.html" rel="noopener ugc nofollow" target="_blank">assert/strict</a></code>模块，因为它有一些好处。</p><p id="ef23" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先是它用<code class="fe nh ni nj nk b">===</code>代替了<code class="fe nh ni nj nk b">==</code>。在JavaScript中，<code class="fe nh ni nj nk b">==</code>不是严格的相等检查，但<code class="fe nh ni nj nk b">===</code>是。一个简单的例子:<code class="fe nh ni nj nk b">1 == “1”</code>为真，<code class="fe nh ni nj nk b">1 === “1”</code>为假。第二个好处是，当处理对象时，失败的断言将向您显示实际值和期望值的差异，从而更容易检测测试失败的原因。</p><p id="32b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将在名为<code class="fe nh ni nj nk b">test.js</code>的新文件中创建我们的测试。我们将从我们希望测试的<code class="fe nh ni nj nk b">index.js</code>中导入测试模块、断言模块和函数。</p><pre class="kg kh ki kj gt nl nk nm nn aw no bi"><span id="5a15" class="np lt iq nk b gy nq nr l ns nt">const test = require('node:test')<br/>const assert = require('assert/strict')<br/>const { add, subtract, multiply, divide, power } = require('./index')<br/>// Or for ES6<br/>import test from 'node:test'<br/>import assert from 'assert/strict'<br/>import { add, subtract, multiply, divide, power } from './index'</span></pre><p id="761a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们定义我们的第一个测试。我们将断言<code class="fe nh ni nj nk b">add(1, 2)</code>等于<code class="fe nh ni nj nk b">3</code>。我们调用<code class="fe nh ni nj nk b">test</code>方法，并为测试提供一个名称，以及一个运行测试的函数。在函数内部，我们将使用<code class="fe nh ni nj nk b">add</code>函数和期望值调用<code class="fe nh ni nj nk b">assert</code>方法。</p><pre class="kg kh ki kj gt nl nk nm nn aw no bi"><span id="a814" class="np lt iq nk b gy nq nr l ns nt">test('add', () =&gt; {<br/>  assert.equal(add(1, 2), 3)<br/>})</span></pre><p id="b29d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以用<code class="fe nh ni nj nk b">node test.js</code>运行我们的测试。我们得到一个警告，提醒我们<code class="fe nh ni nj nk b">node:test</code> runner是实验性的，将来可能会改变。之后我们的测试运行，我们看到它通过了！</p><pre class="kg kh ki kj gt nl nk nm nn aw no bi"><span id="44c6" class="np lt iq nk b gy nq nr l ns nt">(node:8396) ExperimentalWarning: The test runner is an experimental feature. This feature could change at any time<br/>(Use `node --trace-warnings ...` to show where the warning was created)<br/>TAP version 13<br/>ok 1 - add<br/>  ---<br/>  duration_ms: 0.0092444<br/>  ...<br/>1..1<br/># tests 1<br/># pass 1<br/># fail 0<br/># skipped 0<br/># todo 0<br/># duration_ms 0.1194634</span></pre><p id="554e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我想花点时间指出这里使用的格式。在顶部，您可以看到对TAP版本13的引用。TAP，或<a class="ae kv" href="https://testanything.org/" rel="noopener ugc nofollow" target="_blank"> Test Anything Protocol </a>，是一种写测试结果的格式。这是一种以语言无关的方式报告测试结果的标准。这种TAP格式可以被测试工具解释，如果需要的话，可以用来创建一个更容易阅读的报告。</p><div class="mp mq gp gr mr ms"><a href="https://testanything.org/" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">测试任何协议</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">TAP，Test Anything协议，是测试工具中测试模块之间的一个简单的基于文本的接口。它…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">testanything.org</p></div></div><div class="nb l"><div class="nv l nd ne nf nb ng kp ms"/></div></div></a></div><p id="23e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们愿意，我们可以为一个功能编写多个测试，组织它们的一个很好的方法是使用子测试。子测试是在作为第一个参数传递给提供给<code class="fe nh ni nj nk b">test</code>方法的函数的测试上下文中定义的。我们可以用它来为一个函数编写多个边缘案例。如果任何一个子测试失败，整个测试都将失败。我们还应该等待这些方法，否则，测试将在子测试完成之前结束，所有仍在运行的子测试都将被取消。</p><pre class="kg kh ki kj gt nl nk nm nn aw no bi"><span id="b74d" class="np lt iq nk b gy nq nr l ns nt">test('subtract', async (t) =&gt; {<br/>  await t.test('subtracts two numbers', () =&gt; {<br/>    assert.equal(subtract(1, 2), -1)<br/>  })</span><span id="cb6b" class="np lt iq nk b gy nu nr l ns nt">  await t.test('subtracts two numbers', () =&gt; {<br/>    assert.equal(subtract(2, 1), 1)<br/>  })<br/>})</span></pre><p id="766b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将在这里结束它，但是看看您是否可以为剩余的方法编写测试。然后，在你自己的项目中尝试一下！</p><h1 id="23ac" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">结论</strong></h1><p id="50f6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Node.js实验测试器是一种很好的编写测试的内置方式。然而，它仍然是实验性的，所以我不推荐在生产项目中使用它，因为API可能随时改变。同时，我仍然推荐使用Jest或Mocha来编写重要项目的测试，但是实验测试器是一个很好的尝试。但前提是你不介意事情有可能会破裂。无论哪种方式，我都推荐学习测试模块，一旦它变得更加稳定，我很乐意在我自己的项目中使用它。尤其是如果有人是TAP输出的好消费者。</p><p id="62f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nw">更多内容请看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="nw">plain English . io</em></strong></a><em class="nw">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nw">免费周报</em> </strong> </a> <em class="nw">。关注我们关于</em><a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="nw">Twitter</em></strong></a><em class="nw">和</em><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="nw">LinkedIn</em></strong></a><em class="nw">。加入我们的</em> <a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nw">社区不和谐</em> </strong> </a> <em class="nw">。</em></p></div></div>    
</body>
</html>