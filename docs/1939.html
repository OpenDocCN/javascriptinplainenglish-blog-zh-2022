<html>
<head>
<title>Rule of Three — Three Strikes And You Refactor</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">三原则——三振出局，你就重构</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/rule-of-three-three-strikes-and-you-refactor-942d13e7d5cd?source=collection_archive---------2-----------------------#2022-05-02">https://javascript.plainenglish.io/rule-of-three-three-strikes-and-you-refactor-942d13e7d5cd?source=collection_archive---------2-----------------------#2022-05-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fe9d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在删除重复的代码之前，请三思</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/04f70d93e901b6cba7862b041452915f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jxsTK7is5xDdpug-"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@jtzanno?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Joao Tzanno</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e9f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">软件开发中最常见的一个误区就是<strong class="ky ir">干原则——不要重复自己</strong>。这通常听起来很简单:<a class="ae kv" href="https://medium.com/@mariusbongarts11/dry-your-wet-typescript-code-e3c777b3daf9" rel="noopener">DRY原则</a>指出，应该避免在存在于两个地方并重复相同知识和业务逻辑的代码中出现重复和重复。实际上，即使是有经验的开发人员也不会意识到代码复制和知识复制的区别。</p><p id="ac20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于有经验的开发人员来说，认识到<strong class="ky ir">知识</strong>和<strong class="ky ir">意外复制</strong>之间的区别甚至更加困难，因为需要对代码的领域理解。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="cbca" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">知识复制</h1><blockquote class="mr"><p id="0d8c" class="ms mt iq bd mu mv mw mx my mz na lr dk translated"><em class="nb">“我们看到的是语法重复还是知识重复？”—安东尼·夏马纳</em></p></blockquote><p id="7ea9" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">为了从根本上发现知识重复，必须肯定地回答两个问题:</p><ol class=""><li id="3380" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated"><strong class="ky ir"> <em class="nq">是否存在看起来完全相同的代码？</em>T13】</strong></li><li id="51a6" class="nh ni iq ky b kz nr lc ns lf nt lj nu ln nv lr nm nn no np bi translated"><strong class="ky ir"> <em class="nq">代码是否重复相同的知识和逻辑？</em> </strong></li></ol><p id="c359" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">回答第一个问题很容易。假设您使用正则表达式来验证密码强度:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="cba6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在应用程序的其他部分，我们初始化同一个变量。显然，存在看起来完全相同的代码。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><ol class=""><li id="97e9" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated"><em class="nq">确实存在看起来和✅一模一样的代码</em></li></ol></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="aced" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">但是，代码是否重复了相同的知识和逻辑？</strong>这个问题比较难。如果不确定，可以问一个替换问题:<em class="nq">改变一个代码块会导致改变另一个吗？</em></p><blockquote class="mr"><p id="953a" class="ms mt iq bd mu mv mw mx my mz na lr dk translated">存在真正的复制，其中对一个实例的每一个改变都需要对该实例的每一个副本进行相同的改变。——罗伯特·马丁</p></blockquote><p id="e111" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">我有意识地选择了一个简单的例子。假设验证密码的正则表达式用于相同上下文中的相同应用程序，如果逻辑发生变化，我们需要在两个地方更改代码。这意味着我们的应用程序重复相同的知识。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="0864" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nq"> 2。代码重复着同样的知识和逻辑</em> ✅</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="c187" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于两个条件都适用，我们可以确认代码中的知识重复。我们可以通过删除重复的代码来重构我们的代码。</p><p id="a8f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也许，你已经意识到回答第二个问题并不容易。我们需要理解应用程序的底层业务逻辑，以避免删除<strong class="ky ir">意外的重复</strong>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="95bf" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated"><strong class="ak">意外重复</strong></h1><p id="e6f7" class="pw-post-body-paragraph kw kx iq ky b kz ny jr lb lc nz ju le lf oa lh li lj ob ll lm ln oc lp lq lr ij bi translated">为了理解意外复制，让我们看一些示例代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="11b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们再次检查我们的问题:</p><ol class=""><li id="2871" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated"><strong class="ky ir"> <em class="nq">是否存在看起来完全相同的代码？</em> </strong></li><li id="17f4" class="nh ni iq ky b kz nr lc ns lf nt lj nu ln nv lr nm nn no np bi translated"><strong class="ky ir"> <em class="nq">代码是否重复相同的知识和逻辑？</em>T12】</strong></li></ol><p id="c9fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">和第一个例子一样，这段代码包含一些重复的语法。<code class="fe od oe of og b">ProductService</code>和<code class="fe od oe of og b">FeedbackService</code>都在重复这个代码块:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="0164" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以很容易地将这段代码外包给抽象超类<code class="fe od oe of og b">CRUDService</code>。这将为我们节省几行重复的代码。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><ol class=""><li id="da50" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated"><em class="nq">确实存在看起来和✅一模一样的代码</em></li></ol></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="3ab5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，关于第二个问题。让我们从提出替换问题开始:<em class="nq">改变一个代码块会导致改变另一个代码块吗？</em></p><p id="15df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设我们的业务逻辑发生了变化:</p><blockquote class="oh oi oj"><p id="0633" class="kw kx nq ky b kz la jr lb lc ld ju le ok lg lh li ol lk ll lm om lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="iq">现在每个用户都可以创建反馈，但创建产品仍需要拥有适当的权限。</em> </strong></p></blockquote><p id="9780" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将导致我们改变<code class="fe od oe of og b">FeedbackService</code>类，但<code class="fe od oe of og b">ProductService</code>类不需要改变。这意味着我们发现了<strong class="ky ir">偶然的重复</strong>，我们不应该抽象我们的代码。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="8beb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nq"> 2。代码不重复相同的知识和逻辑</em> ❌</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><blockquote class="oh oi oj"><p id="c7fd" class="kw kx nq ky b kz la jr lb lc ld ju le ok lg lh li ol lk ll lm om lo lp lq lr ij bi translated"><em class="iq">“如果两个明显重复的代码段沿着不同的路径发展——如果它们以不同的速率变化，并且出于不同的原因——那么它们不是真正的重复”——罗伯特·c·马丁</em></p></blockquote><p id="d4e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">想象一下，通过清理重复的代码来抽象我们的代码，不仅我们的两个示例类继承了我们的超类，还有更多。因为我们清理了意外的重复，所以我们已经取消了代码的重构。这比拥有一些重复的代码要糟糕得多。</p><p id="3e4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">理论上，我们现在应该能够区分必要的和偶然的复制。</p><p id="09ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是如果我们不确定呢？</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="3133" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">三法则</h1><blockquote class="mr"><p id="12c3" class="ms mt iq bd mu mv mw mx my mz na lr dk translated"><em class="nb">三振出局，你重构</em></p></blockquote><figure class="on oo op oq or kk"><div class="bz fp l di"><div class="os nx l"/></div></figure><p id="7a1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">发现知识重复并不容易，清理意外重复远比复制代码更有害。</p><p id="287f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">三3️⃣法则定义了当你发现一些重复的代码并且前两种情况不足以识别共享的知识时，<strong class="ky ir">在你重构之前等待第三个重复的</strong>。</p><blockquote class="mr"><p id="eee4" class="ms mt iq bd mu mv mw mx my mz na lr dk translated"><em class="nb">真的很难，感觉很可怕，但还是闭上眼睛试试吧。——</em><a class="ae kv" href="https://www.justinweiss.com/articles/i-dry-ed-up-my-code-and-now-its-hard-to-work-with-what-happened/" rel="noopener ugc nofollow" target="_blank"><em class="nb">贾斯汀·维斯</em> </a></p></blockquote><p id="7d86" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">马丁·福勒在他的书<em class="nq">中定义了三条规则:重构:改进现有代码的设计:</em></p><ul class=""><li id="0067" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr ot nn no np bi translated">第一次做某件事，你就去做。</li><li id="9be2" class="nh ni iq ky b kz nr lc ns lf nt lj nu ln nv lr ot nn no np bi translated">当你第二次做类似的事情时，你会因为重复而退缩，但你还是做了同样的事情。</li><li id="35e3" class="nh ni iq ky b kz nr lc ns lf nt lj nu ln nv lr ot nn no np bi translated"><em class="nq">当你第三次做类似的事情时，你就重构了。</em></li></ul><h1 id="338b" class="lz ma iq bd mb mc ou me mf mg ov mi mj jw ow jx ml jz ox ka mn kc oy kd mp mq bi translated">最后的想法</h1><p id="05f0" class="pw-post-body-paragraph kw kx iq ky b kz ny jr lb lc nz ju le lf oa lh li lj ob ll lm ln oc lp lq lr ij bi translated">重复代码是软件中技术债务和错误的主要原因之一。这就是为什么DRY原则是软件开发中最有价值的原则之一。但是，正确应用它更为重要。</p><p id="9834" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记住，每当你发现dome重复的代码时，问问自己:<em class="nq">“我看到的是重复的语法</em>  <em class="nq">还是重复的知识</em>  <em class="nq">？”。</em>如果你不确定，应用三的<strong class="ky ir">法则。</strong></p><p id="35b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望你喜欢阅读这篇文章。我总是很乐意回答问题，也乐于接受批评。请随时联系我😊</p><p id="3cc6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里是无限制访问媒体上所有内容的链接。如果你用这个链接注册，我会赚一小笔钱，不需要你额外付费。</p><div class="oz pa gp gr pb pc"><a href="https://medium.com/@mariusbongarts/membership" rel="noopener follow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd ir gy z fp ph fr fs pi fu fw ip bi translated">通过我的推荐链接加入Medium-Marius bong arts</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">medium.com</p></div></div><div class="pl l"><div class="pm l pn po pp pl pq kp pc"/></div></div></a></div><p id="b454" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关注我，不要错过我的下一篇文章。我写了关于Typescript、Web组件、前端框架、软件设计模式、Chrome扩展以及更多的主题！🙏</p><h1 id="8dc7" class="lz ma iq bd mb mc ou me mf mg ov mi mj jw ow jx ml jz ox ka mn kc oy kd mp mq bi translated">关于作者</h1><p id="8697" class="pw-post-body-paragraph kw kx iq ky b kz ny jr lb lc nz ju le lf oa lh li lj ob ll lm ln oc lp lq lr ij bi translated">Marius Bongarts是埃森哲互动公司的软件工程分析师。他还创建了<a class="ae kv" href="https://chrome.google.com/webstore/detail/web-highlights-%20-bookmark/hldjnlbobkdkghfidgoecgmklcemanhm" rel="noopener ugc nofollow" target="_blank"> Web Highlights Chrome扩展</a>，允许成千上万的用户在每个网站上创建文本亮点和书签。通过提供标签和目录，您可以在web-highlights.com上的相应网络应用程序中轻松地重新找到您的网络研究。看看吧！</p><p id="a69f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过<strong class="ky ir"/><a class="ae kv" href="https://www.linkedin.com/in/marius-bongarts-6b3638171/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">LinkedIn</strong></a><strong class="ky ir"/>与我取得联系或者在<a class="ae kv" href="https://twitter.com/MariusBongarts" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> Twitter </strong> </a>上关注我。</p><div class="oz pa gp gr pb pc"><a href="https://medium.com/@mariusbongarts11/will-web-components-replace-frontend-frameworks-535891d779ba" rel="noopener follow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd ir gy z fp ph fr fs pi fu fw ip bi translated">Web组件会取代前端框架吗？</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">它们是为解决不同的问题而构建的。</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">medium.com</p></div></div><div class="pl l"><div class="pr l pn po pp pl pq kp pc"/></div></div></a></div><div class="oz pa gp gr pb pc"><a href="https://medium.com/@mariusbongarts11/my-journey-to-the-first-9-99-with-my-side-project-3edc13dd1f2d" rel="noopener follow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd ir gy z fp ph fr fs pi fu fw ip bi translated">我的第一个9.99美元之旅与我的副业</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">Chrome扩展带来的被动收入</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">medium.com</p></div></div><div class="pl l"><div class="ps l pn po pp pl pq kp pc"/></div></div></a></div><div class="oz pa gp gr pb pc"><a rel="noopener  ugc nofollow" target="_blank" href="/publish-your-side-project-now-1e3bb170c079"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd ir gy z fp ph fr fs pi fu fw ip bi translated">发布你的副业，现在！</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">如果你不为你的第一次发布感到尴尬，那你发布得太晚了。</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="pl l"><div class="pt l pn po pp pl pq kp pc"/></div></div></a></div><p id="6abc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nq">更内容于</em> <a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nq">普通英语</em> </strong> </a> <em class="nq">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nq">免费周报</em> </strong> </a> <em class="nq">。</em> <a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nq">推特</em> </strong> </a> <em class="nq">和</em><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="nq">LinkedIn</em></strong></a><em class="nq">追随我们。加入我们的</em> <a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nq">社群不和</em> </strong> </a> <em class="nq">。</em></p></div></div>    
</body>
</html>