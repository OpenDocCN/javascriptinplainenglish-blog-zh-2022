<html>
<head>
<title>How to Resolve a Promise from Outside in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•åœ¨JavaScriptä¸­è§£ææ¥è‡ªå¤–éƒ¨çš„æ‰¿è¯º</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://javascript.plainenglish.io/javascript-resolve-promise-from-outside-cefdb7381128?source=collection_archive---------2-----------------------#2022-07-04">https://javascript.plainenglish.io/javascript-resolve-promise-from-outside-cefdb7381128?source=collection_archive---------2-----------------------#2022-07-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/ef628095de36309c84fbd9376992786f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s20a83MwtcjOlaMxGiVhAA.png"/></div></div></figure><p id="29ee" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¦åœ¨JavaScriptä¸­è§£ææ¥è‡ªå¤–éƒ¨çš„æ‰¿è¯ºï¼Œå°†<code class="fe kt ku kv kw b">resolve</code>å›è°ƒèµ‹ç»™åœ¨<code class="fe kt ku kv kw b">Promise</code>æ„é€ å‡½æ•°èŒƒå›´ä¹‹å¤–å®šä¹‰çš„å˜é‡ï¼Œç„¶åè°ƒç”¨è¯¥å˜é‡æ¥è§£æ<code class="fe kt ku kv kw b">Promise</code>ã€‚ä¾‹å¦‚:</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="ca88" class="lf lg in kw b gy lh li l lj lk">let promiseResolve;<br/>let promiseReject;</span><span id="454c" class="lf lg in kw b gy ll li l lj lk">const promise = new Promise((resolve, reject) =&gt; {<br/>  promiseResolve = resolve;<br/>  promiseReject = reject;<br/>});</span><span id="8032" class="lf lg in kw b gy ll li l lj lk">promiseResolve();</span></pre><p id="6273" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åšè¿™æ ·çš„äº‹æƒ…å‘¢ï¼Ÿå¥½å§ï¼Œä¹Ÿè®¸æˆ‘ä»¬æœ‰ä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„æ“ä½œAï¼Œç”¨æˆ·å¸Œæœ›å¦ä¸€ä¸ªæ“ä½œBå‘ç”Ÿï¼Œä½†æ˜¯Bå¿…é¡»ç­‰å¾…Aå®Œæˆã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ç¤¾äº¤åº”ç”¨ç¨‹åºï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­åˆ›å»ºã€ä¿å­˜å’Œå‘å¸ƒå¸–å­ã€‚</p><p id="5016" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">index.html</strong></p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="156e" class="lf lg in kw b gy lh li l lj lk">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;Resolving a Promise from Outside&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;p&gt;<br/>      Save status:<br/>      &lt;b&gt;&lt;span id="save-status"&gt;Not saved&lt;/span&gt;&lt;/b&gt;<br/>    &lt;/p&gt;<br/>    &lt;p&gt;<br/>      Publish status:<br/>      &lt;b&gt;&lt;span id="publish-status"&gt;Not published&lt;/span&gt;&lt;/b&gt;<br/>    &lt;/p&gt;<br/>    &lt;button id="save"&gt;Save&lt;/button&gt;<br/>    &lt;button id="publish"&gt;Publish&lt;/button&gt;<br/>    &lt;script src="index.js"&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><figure class="kx ky kz la gt jo gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/d1a49f116df438d7304a8cd56b6a1861.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/0*4QmJJfwfOSZF8mCj.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Users can save and publish posts.</figcaption></figure><p id="01d3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">å¦‚æœä¸€ç¯‡æ–‡ç« æ­£åœ¨è¢«ä¿å­˜(æ“ä½œA ),è€Œç”¨æˆ·å¸Œæœ›åœ¨ä¿å­˜è¿‡ç¨‹ä¸­å‘å¸ƒè¯¥æ–‡ç« (æ“ä½œB ),è¯¥æ€ä¹ˆåŠï¼Ÿã€‚å¦‚æœæˆ‘ä»¬ä¸æƒ³åœ¨ä¿å­˜æ—¶ç¦ç”¨â€œå‘å¸ƒâ€æŒ‰é’®ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿åœ¨å‘å¸ƒä¹‹å‰ä¿å­˜æ–‡ç« ã€‚</p><p id="1ea4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> index.js </strong></p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="d50c" class="lf lg in kw b gy lh li l lj lk">// Enable UI interactivity<br/>const saveStatus = document.getElementById('save-status');<br/>const saveButton = document.getElementById('save');<br/>const publishStatus = document.getElementById(<br/>  'publish-status'<br/>);<br/>const publishButton = document.getElementById('publish');<br/>saveButton.onclick = () =&gt; {<br/>  save();<br/>};<br/>publishButton.onclick = async () =&gt; {<br/>  await publish();<br/>};</span><span id="f645" class="lf lg in kw b gy ll li l lj lk">let saveResolve;<br/>let hasSaved = false;</span><span id="edd0" class="lf lg in kw b gy ll li l lj lk">function save() {<br/>  hasSaved = false;<br/>  saveStatus.textContent = 'Saving...';<br/>  setTimeout(() =&gt; {<br/>    saveResolve();<br/>    hasSaved = true;<br/>    saveStatus.textContent = 'Saved';<br/>  }, 3000);<br/>}</span><span id="cc28" class="lf lg in kw b gy ll li l lj lk">async function waitForSave() {<br/>  if (!hasSaved) {<br/>    await new Promise((resolve) =&gt; {<br/>      saveResolve = resolve;<br/>    });<br/>  }<br/>}</span><span id="0b02" class="lf lg in kw b gy ll li l lj lk">async function publish() {<br/>  publishStatus.textContent = 'Waiting for save...';<br/>  await waitForSave();<br/>  publishStatus.textContent = 'Published';<br/>  return;<br/>}</span></pre><p id="c8f3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¿™æ®µä»£ç çš„å…³é”®éƒ¨åˆ†æ˜¯<code class="fe kt ku kv kw b">save()</code>å’Œ<code class="fe kt ku kv kw b">waitForSave()</code>å‡½æ•°ã€‚å½“ç”¨æˆ·ç‚¹å‡»â€œå‘å¸ƒâ€æ—¶ï¼Œè°ƒç”¨<code class="fe kt ku kv kw b">waitForSave()</code>ã€‚å¦‚æœå¸–å­å·²ç»ä¿å­˜ï¼Œä»<code class="fe kt ku kv kw b">waitForSave()</code>è¿”å›çš„<code class="fe kt ku kv kw b">Promise</code>ä¼šç«‹å³è§£æï¼Œå¦åˆ™å®ƒä¼šå°†å…¶<code class="fe kt ku kv kw b">resolve</code>å›è°ƒåˆ†é…ç»™ä¸€ä¸ªå¤–éƒ¨å˜é‡ï¼Œè¯¥å˜é‡å°†åœ¨ä¿å­˜åè¢«è°ƒç”¨ã€‚è¿™ä½¿å¾—<code class="fe kt ku kv kw b">publish()</code>åœ¨ç»§ç»­ä¹‹å‰ç­‰å¾…<code class="fe kt ku kv kw b">save()</code>ä¸­çš„è¶…æ—¶åˆ°æœŸã€‚</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/2625c2cb5a8ed58ebfae4fc29e1c3747.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/0*t_17TqHN9-9sL4lr.gif"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Publish doesnâ€™t happen until after save.</figcaption></figure><p id="f8fb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª<code class="fe kt ku kv kw b">Deferred</code>ç±»æ¥æŠ½è±¡å’Œé‡ç”¨è¿™ä¸ªé€»è¾‘:</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="7437" class="lf lg in kw b gy lh li l lj lk">class Deferred {<br/>  constructor() {<br/>    this.promise = new Promise((resolve, reject) =&gt; {<br/>      this.reject = reject;<br/>      this.resolve = resolve;<br/>    });<br/>  }<br/>}</span><span id="ccb9" class="lf lg in kw b gy ll li l lj lk">const deferred = new Deferred();</span><span id="79e7" class="lf lg in kw b gy ll li l lj lk">// Resolve from outside<br/>deferred.resolve();</span></pre><p id="3559" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ç°åœ¨ï¼Œè§£æ/æ‹’ç»<code class="fe kt ku kv kw b">Promise</code>çš„å˜é‡å’Œ<code class="fe kt ku kv kw b">Promise</code>æœ¬èº«å°†åŒ…å«åœ¨åŒä¸€ä¸ª<code class="fe kt ku kv kw b">Deferred</code>å¯¹è±¡ä¸­ã€‚</p><p id="f314" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">æˆ‘ä»¬å¯ä»¥é‡æ„ä»£ç æ¥ä½¿ç”¨è¿™ä¸ªç±»:</p><p id="94fc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> index.js </strong></p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="ee86" class="lf lg in kw b gy lh li l lj lk">// Enable UI interactivity<br/>// ...</span><span id="2489" class="lf lg in kw b gy ll li l lj lk">const deferredSave = new Deferred();<br/>let hasSaved = false;</span><span id="6264" class="lf lg in kw b gy ll li l lj lk">function save() {<br/>  hasSaved = false;<br/>  saveStatus.textContent = 'Saving...';<br/>  setTimeout(() =&gt; {<br/>    deferredSave.resolve();<br/>    hasSaved = true;<br/>    saveStatus.textContent = 'Saved';<br/>  }, 3000);<br/>}</span><span id="41d2" class="lf lg in kw b gy ll li l lj lk">async function waitForSave() {<br/>  if (!hasSaved) await deferredSave.promise;<br/>}</span><span id="5841" class="lf lg in kw b gy ll li l lj lk">async function publish() {<br/>  // ...<br/>}</span></pre><p id="5e75" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">åŠŸèƒ½å°†åƒä»¥å‰ä¸€æ ·å·¥ä½œ:</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/2625c2cb5a8ed58ebfae4fc29e1c3747.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/0*t_17TqHN9-9sL4lr.gif"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">The functionality works as before after using the Deferred class.</figcaption></figure><p id="c2c4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ã€codingbeautydev.comã€‘æ›´æ–°äº:<a class="ae lt" href="https://cbdev.link/0edf01" rel="noopener ugc nofollow" target="_blank"><em class="ls"/></a></p></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><p id="a550" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">æ‚¨å¯ä»¥åœ¨å“ªé‡Œæ‰¾åˆ°æˆ‘ä»¬:</p><p id="3c47" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ğŸŒ<a class="ae lt" href="https://cbdev.link/b621b9" rel="noopener ugc nofollow" target="_blank">ç½‘ç«™</a> |ğŸŒŸ<a class="ae lt" href="https://twitter.com/CodingBeautyDev" rel="noopener ugc nofollow" target="_blank">æ¨ç‰¹</a> |ğŸŒŸ<a class="ae lt" href="http://facebook.com/CodingBeautyDev" rel="noopener ugc nofollow" target="_blank">è„¸ä¹¦</a></p></div><div class="ab cl lu lv hr lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ig ih ii ij ik"><h1 id="f82a" class="mb lg in bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">JavaScriptåšçš„æ¯ä¸€ä»¶ç–¯ç‹‚çš„äº‹æƒ…</h1><p id="9a76" class="pw-post-body-paragraph jv jw in jx b jy my ka kb kc mz ke kf kg na ki kj kk nb km kn ko nc kq kr ks ig bi translated">ä¸€æœ¬å…³äºJavaScriptå¾®å¦™çš„è­¦å‘Šå’Œé²œä¸ºäººçŸ¥çš„éƒ¨åˆ†çš„è¿·äººæŒ‡å—ã€‚</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/143ee152ba78025ea8643ba5b9726a20.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*YS5Oub8REWy8vnOEqBnsyQ.png"/></div></figure><p id="7d6e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae lt" href="https://cbdev.link/d3c4eb" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">æŠ¥å</strong> </a>ç«‹å³å…è´¹é¢†å–ä¸€ä»½ã€‚</p></div></div>    
</body>
</html>