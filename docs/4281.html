<html>
<head>
<title>Building Bubble Maps in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript构建气泡图</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/building-bubble-maps-in-javascript-65be27c044f7?source=collection_archive---------9-----------------------#2022-11-16">https://javascript.plainenglish.io/building-bubble-maps-in-javascript-65be27c044f7?source=collection_archive---------9-----------------------#2022-11-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="6c58" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">气泡图是气泡图和地理图的结合。仔细看看这个地图&amp;学习如何用JS构建气泡图。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/cc39c331ccd0834df4db2cd05e03dc7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BetTdPU4FpPCEcJV.png"/></div></div></figure><p id="0de6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">地图是将数据置于地理环境中的一种很好的方式。而且它们并不难创造！我渴望通过帮助你在JavaScript的帮助下创建一个<a class="ae lk" href="https://www.anychart.com/chartopedia/chart-type/bubble-map/" rel="noopener ugc nofollow" target="_blank">气泡图</a>，这是最流行的数据图<a class="ae lk" href="https://www.anychart.com/chartopedia/usage-type/chart-to-show-location/" rel="noopener ugc nofollow" target="_blank">之一。</a></p><p id="cfa9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">气泡图是一张<a class="ae lk" href="https://www.anychart.com/chartopedia/chart-type/bubble-chart/" rel="noopener ugc nofollow" target="_blank">气泡图</a>和一张地理图的组合。它使用不同大小(有时是不同颜色)的圆圈来表示与位置或区域相关的数值。</p><p id="fc71" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在本教程中，我将可视化全美汽油价格的数据。今年夏天，在俄罗斯-乌克兰冲突爆发后，价格飙升至创纪录高位。第一个基本气泡图将按州显示7月份的天然气价格。最后一份报告将增加自2月23日以来的变化幅度，2月23日是俄罗斯对乌克兰发动攻击的前一天。</p><p id="181a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">跟着做，你将学会用JS轻松地创建漂亮的交互式地图，没有任何问题！</p><h1 id="d884" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">最终JS气泡图预览</h1><p id="4090" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">查看本教程中基于JavaScript的气泡贴图的最终结果:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/c1511b07630634d50c9b97fe0b042a80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ifPwcqSstKPXIDB67XoxA.png"/></div></div></figure><h1 id="e502" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">4步基本JavaScript气泡图</h1><p id="2219" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">从头开始创建交互式JS气泡图可能会令人望而生畏和乏味。但是我会告诉你如何轻松有趣地完成它。</p><p id="de0b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">一般来说，构建基本气泡图有四个基本步骤，就像任何其他图表一样:准备网页、添加JavaScript文件、加载数据和编写一些图表代码。就这么办吧！</p><h2 id="6f55" class="mi lm in bd ln mj mk dn lr ml mm dp lv kx mn mo lx lb mp mq lz lf mr ms mb mt bi translated">1.准备网页</h2><p id="80f3" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">重要的事情先来。我创建了一个空白网页。然后我添加一个块级HTML元素(<code class="fe mu mv mw mx b">div</code>)作为气泡图的占位符；我还给它一个唯一的id ( <code class="fe mu mv mw mx b">container</code>)并设置一些样式。</p><p id="ae58" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">下面是我的HTML页面现在的样子:</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="ff31" class="nc lm in mx b be nd ne l nf ng">&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;JavaScript Bubble Map&lt;/title&gt;<br/>    &lt;style type="text/css"&gt;      <br/>      html, body, #container { <br/>        width: 100%; height: 100%; margin: 0; padding: 0; <br/>      } <br/>    &lt;/style&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="container"&gt;&lt;/div&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="183f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我希望可视化显示在整个屏幕上。所以我将占位符div元素的宽度和高度设置为100%。如果你认为适合你的情况，可以随意改变。</p><h2 id="9c81" class="mi lm in bd ln mj mk dn lr ml mm dp lv kx mn mo lx lb mp mq lz lf mr ms mb mt bi translated">2.添加JavaScript文件</h2><p id="3294" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">第二，所有用于制作气泡图的JS文件都必须添加到网页中。这是通过将包装在<code class="fe mu mv mw mx b">script</code>标签中的相应链接添加到<code class="fe mu mv mw mx b">head</code>部分来完成的。</p><p id="c49a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了快速简单，我将使用名为<a class="ae lk" href="https://www.anychart.com" rel="noopener ugc nofollow" target="_blank"> AnyChart </a>的JavaScript图表库，确切地说是<a class="ae lk" href="https://www.anychart.com/products/anymap/" rel="noopener ugc nofollow" target="_blank"> AnyMap </a>解决方案。因此，我包含了构建气泡图所需的两个模块，“core”和“geo maps”，以及美国的地理数据文件。</p><p id="f5a6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">然后，我通过将<code class="fe mu mv mw mx b">script</code>标签添加到<code class="fe mu mv mw mx b">body</code>部分，为将来的JS映射代码本身准备一个位置(基本上，这个标签可以放在页面上的任何地方)。</p><p id="5ce3" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">查看我的HTML页面现在的样子:</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="2cbb" class="nc lm in mx b be nd ne l nf ng">&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;JavaScript Bubble Map&lt;/title&gt;<br/>    &lt;script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-core.min.js"&gt;&lt;/script&gt;<br/>    &lt;script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-map.min.js"&gt;&lt;/script&gt;<br/>    &lt;script src="https://cdn.anychart.com/releases/8.11.0/geodata/countries/united_states_of_america/united_states_of_america.js"&gt;&lt;/script&gt;<br/>    &lt;style type="text/css"&gt;      <br/>      html, body, #container { <br/>        width: 100%; height: 100%; margin: 0; padding: 0; <br/>      } <br/>    &lt;/style&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;  <br/>    &lt;div id="container"&gt;&lt;/div&gt;<br/>    &lt;script&gt;<br/>      // The place for the JavaScript bubble mapping code.<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><h2 id="a371" class="mi lm in bd ln mj mk dn lr ml mm dp lv kx mn mo lx lb mp mq lz lf mr ms mb mt bi translated">3.加载数据</h2><p id="9089" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">第三，我加我的数据。</p><p id="6299" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">有多种数据格式<a class="ae lk" href="https://docs.anychart.com/Working_with_Data" rel="noopener ugc nofollow" target="_blank">可以使用。我决定使用JSON，并创建了一个数据文件，其中包含美国各州普通汽油的</a><a class="ae lk" href="https://gasprices.aaa.com/state-gas-price-averages/" rel="noopener ugc nofollow" target="_blank">价格</a>，你可以在这里看一下<a class="ae lk" href="https://gist.githubusercontent.com/shacheeswadia/eead370d79e0f20df5148b79b6887393/raw/fba29e3dcf1806cab770e845546a136a924cf1d5/dataBubbleMap2.json" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="e772" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我还需要两个JS文件来使用这些数据。一个是<a class="ae lk" href="https://docs.anychart.com/Working_with_Data/Data_Adapter" rel="noopener ugc nofollow" target="_blank">数据适配器</a>，用于加载JSON数据文件本身。另一个是<a class="ae lk" href="https://docs.anychart.com/Maps/Map_Projections#using_proj4.js" rel="noopener ugc nofollow" target="_blank"> Proj4js </a>，用于转换坐标以绘制各个地理状态上的气泡。我在<code class="fe mu mv mw mx b">head</code>部分将它们和其他脚本一起引用。</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="2fe4" class="nc lm in mx b be nd ne l nf ng">&lt;script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-data-adapter.min.js"&gt;&lt;/script&gt;<br/>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.15/proj4.js"&gt;&lt;/script&gt;4. Write some charting code</span></pre><p id="de3c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">然后，我使用anychart.data.loadJsonFile()函数加载JSON文件，放在之前放在body部分的脚本标记中。</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="8b91" class="nc lm in mx b be nd ne l nf ng">anychart.data.loadJsonFile( 'https://gist.githubusercontent.com/shacheeswadia/eead370d79e0f20df5148b79b6887393/raw/fba29e3dcf1806cab770e845546a136a924cf1d5/dataBubbleMap2.json', function (data) {})The fourth step is for populating the script tag in the body section of the web page with the code to visualize the JS-based bubble map. Actually, just a few quick lines will be enough!</span></pre><h2 id="85e6" class="mi lm in bd ln mj mk dn lr ml mm dp lv kx mn mo lx lb mp mq lz lf mr ms mb mt bi translated">4.写一些图表代码</h2><p id="57cd" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">第四步是用代码填充网页的<code class="fe mu mv mw mx b">body</code>部分的<code class="fe mu mv mw mx b">script</code>标签，以可视化基于JS的气泡图。实际上，只要几行简短的台词就够了！</p><p id="2cb2" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">所有的代码都将被打包到<code class="fe mu mv mw mx b">anychart.onDocumentReady()</code>函数中，以便在执行任何其他操作之前，页面被完全加载。</p><p id="1c28" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">首先，我在其中加载数据，如第三步所示。然后，我使用内置函数创建一个地图图表实例，并添加美国的地理数据。</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="6ca8" class="nc lm in mx b be nd ne l nf ng">&lt;script&gt;<br/><br/>  anychart.onDocumentReady(function() {<br/>    <br/>    // load the data<br/>    anychart.data.loadJsonFile( 'https://gist.githubusercontent.com/shacheeswadia/eead370d79e0f20df5148b79b6887393/raw/fba29e3dcf1806cab770e845546a136a924cf1d5/dataBubbleMap2.json',<br/>    function (data) {<br/>      <br/>      // create a map chart<br/>      let map = anychart.map();<br/><br/>      // add the u.s. geodata<br/>      map.geoData("anychart.maps.united_states_of_america");<br/><br/>    });<br/><br/>  });<br/>&lt;/script&gt;</span></pre><p id="692e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">因为我想用气泡表示天然气价格，所以我创建了一个气泡序列，并将这些值映射为整个地图上气泡的大小:</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="1f96" class="nc lm in mx b be nd ne l nf ng">let series = map.bubble(<br/>  anychart.data.set(data).mapAs({<br/>    size: "Petrol"<br/>  })<br/>);</span></pre><p id="1e4b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">标题对于更好的易读性很重要。所以我启用系列标签来显示州名并添加标题。</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="5ea3" class="nc lm in mx b be nd ne l nf ng">// enable the series labels<br/>series<br/>  .labels()<br/>  .enabled(true);<br/>      <br/>// set the map's title<br/>map.title("Gasoline Prices in the United States in July 2022");</span></pre><p id="dce4" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">最后，我引用HTML块级元素作为地图的容器，并绘制结果可视化。</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="7929" class="nc lm in mx b be nd ne l nf ng">// set the container id<br/>map.container("container");<br/><br/>// initiate the map drawing<br/>map.draw();</span></pre><p id="ba1d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这就对了。一个可爱的交互式泡泡地图就是这样用JavaScript创建的！你可以清楚地了解2022年7月美国哪些州的汽油价格最高。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nh"><img src="../Images/3b07c73afab8643f1ef8685ca0f17dbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VjQYtm9rYXU2X8VLpWhZ-w.png"/></div></div></figure><p id="d197" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我在<a class="ae lk" href="https://playground.anychart.com/9266aZgG/" rel="noopener ugc nofollow" target="_blank">游乐场</a>在线代码编辑器中保存了这个基本JS泡泡图的代码，这样你就可以仔细查看它，添加你自己的数据，等等。我也把它放在下面。</p><p id="a96f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">但是请不要离开，请继续阅读，因为我还有更多东西要给你看！</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="fd8d" class="nc lm in mx b be nd ne l nf ng">&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;JavaScript Bubble Map&lt;/title&gt;<br/>    &lt;script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-core.min.js"&gt;&lt;/script&gt;<br/>    &lt;script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-map.min.js"&gt;&lt;/script&gt;<br/>    &lt;script src="https://cdn.anychart.com/releases/8.11.0/geodata/countries/united_states_of_america/united_states_of_america.js"&gt;&lt;/script&gt;<br/>    &lt;script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-data-adapter.min.js"&gt;&lt;/script&gt;<br/>    &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.15/proj4.js"&gt;&lt;/script&gt;<br/>    &lt;style type="text/css"&gt;      <br/>      html, body, #container { <br/>        width: 100%; height: 100%; margin: 0; padding: 0; <br/>      } <br/>    &lt;/style&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;  <br/>    &lt;div id="container"&gt;&lt;/div&gt;<br/>    &lt;script&gt;<br/>      anychart.onDocumentReady(function () {<br/>        anychart.data.loadJsonFile(<br/>          "https://gist.githubusercontent.com/shacheeswadia/eead370d79e0f20df5148b79b6887393/raw/fba29e3dcf1806cab770e845546a136a924cf1d5/dataBubbleMap2.json",<br/>          function (data) {<br/>      <br/>            // create a map chart<br/>            let map = anychart.map();<br/><br/>            // add the u.s. geodata<br/>            map.geoData("anychart.maps.united_states_of_america");<br/><br/>            // create a bubble series<br/>            let series = map.bubble(<br/>              anychart.data.set(data).mapAs({<br/>                size: "Petrol"<br/>              })<br/>            );<br/><br/>            // enable the series labels<br/>            series<br/>              .labels()<br/>              .enabled(true);<br/>      <br/>            // set the map's title<br/>            map.title("Gasoline Prices in the United States in July 2022");<br/><br/>            // set the container id<br/>            map.container("container");<br/><br/>            // initiate the map drawing<br/>            map.draw();<br/>      <br/>          }<br/>        );<br/>      });<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><h1 id="0fbd" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">自定义JS气泡图</h1><p id="fea4" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">自定义JavaScript气泡图有无数种可能性。现在，我将解释和演示其中的一些。首先，我将为气泡涂上颜色，以反映2022年2月至7月期间每个州的天然气价格上涨了多少。然后，我将增强标签位置、工具提示、悬停状态下的颜色和地图标题。</p><h2 id="3896" class="mi lm in bd ln mj mk dn lr ml mm dp lv kx mn mo lx lb mp mq lz lf mr ms mb mt bi translated">1.使用颜色来显示更改</h2><p id="48b9" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">在气泡图中，像气泡图一样，您可以使用颜色来可视化数据中的额外维度。我想借此机会说明各州二月和七月的汽油价格差异。数据文件有这两个值:“汽油”用于上面的基本气泡图，而“PetrolFeb”用于二月，取自互联网档案库<a class="ae lk" href="https://web.archive.org/web/20220224013244/https://gasprices.aaa.com/state-gas-price-averages/" rel="noopener ugc nofollow" target="_blank"/>。因此，在做任何事情之前，我遍历每个数据点并找出差异。根据这个值，我计算了上升的百分比，并将小数位数限制在两位。</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="5c41" class="nc lm in mx b be nd ne l nf ng">data.forEach(function (d) {<br/>  let diff = d.Petrol - d.PetrolFeb;<br/>  d.percentRise = ((diff * 100) / d.PetrolFeb).toFixed(2);<br/>});</span></pre><p id="cc01" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在我将根据这个百分比给泡泡上色。为此，我需要一个规模，将接受的价值，并返回相应的颜色。AnyChart提供了色阶选项，但是为了使本教程更有教育意义，我想在这里向您展示如何使用另一个库来结合主库提供一些功能。我决定使用开源JavaScript图表库<a class="ae lk" href="https://d3js.org/" rel="noopener ugc nofollow" target="_blank"> D3.js </a>演示线性色标的创建。</p><p id="6239" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">首先，我在HTML页面的<code class="fe mu mv mw mx b">head</code>部分包含了D3.js脚本。</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="8406" class="nc lm in mx b be nd ne l nf ng">&lt;script src="https://d3js.org/d3.v7.min.js"&gt;&lt;/script&gt;</span></pre><p id="da62" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">其次，我创建了一个D3分位数标度，它接受一系列值并返回颜色。我保持该域接受从20到50的值，因为百分比上升值落在这些数字之间，并在该范围内添加五个颜色值。</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="d7a9" class="nc lm in mx b be nd ne l nf ng">let fillColor = d3<br/>  .scaleQuantile()<br/>  .domain([20, 50])<br/>  .range(["#1b8366", "#77dd79", "#f7e975", "#fea43e", "#cf0011"]);</span></pre><p id="d131" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">最后，我使用刚刚创建的D3.js标尺，基于百分比增量值设置每个数据点的填充值。</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="1347" class="nc lm in mx b be nd ne l nf ng">data.forEach(function (d) {<br/>  let diff = d.Petrol - d.PetrolFeb;<br/>  d.percentRise = ((diff * 100) / d.PetrolFeb).toFixed(2);<br/>  d.fill = fillColor(d.percentRise);<br/>});</span></pre><p id="22a6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果这听起来有点复杂，不要担心。我只是想向你展示在选择丰富的地方定制的力量。</p><h2 id="7b08" class="mi lm in bd ln mj mk dn lr ml mm dp lv kx mn mo lx lb mp mq lz lf mr ms mb mt bi translated">2.改进标签放置</h2><p id="ce92" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">默认情况下，标签放置在气泡的中心。我想把它们移到一边一点。同时，我还将定制标签的字体大小和颜色，以获得更好的可读性和美观性。</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="2c1f" class="nc lm in mx b be nd ne l nf ng">series<br/>  .labels()<br/>  .enabled(true)<br/>  .anchor("left-center")<br/>  .position("right")<br/>  .fontColor("#353535")<br/>  .fontSize(11)<br/>  .offsetX(5);</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nh"><img src="../Images/9cdfd968d219133b0c5f32c709f3c5e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vRD5M4KEeXKsQbbthCtJSQ.png"/></div></div></figure><p id="a77d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">看一眼这张交互式气泡图(可在<a class="ae lk" href="https://playground.anychart.com/VTFesAw7" rel="noopener ugc nofollow" target="_blank">游乐场</a>上获得)，很容易注意到，与美国其他地区相比，加州的汽油价格在2月份是最高的，但涨幅不大，而犹他州和爱达荷州的涨幅最大。</p><h2 id="2260" class="mi lm in bd ln mj mk dn lr ml mm dp lv kx mn mo lx lb mp mq lz lf mr ms mb mt bi translated">3.增强工具提示</h2><p id="5672" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">默认的工具提示显示纬度和经度，这在这种情况下是没有用的。在工具提示中显示更多有意义的信息总是一个好主意。这很容易实现。</p><p id="11c9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我选择在工具提示中显示以下内容:州名、七月和二月的汽油价格以及变化百分比。为了更好的展示，我使用HTML。</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="c005" class="nc lm in mx b be nd ne l nf ng">series<br/>  .tooltip()<br/>  .useHtml(true)<br/>  .format("&lt;h6 style='font-size:14px; font-weight:400; margin: 0.2rem 0;'&gt;Price in July: &lt;b&gt;{%Petrol}&lt;/b&gt;&lt;/h6&gt;&lt;h6 style='font-size:14px; font-weight:400; margin: 0.2rem 0;'&gt;Price in February: &lt;b&gt;{%PetrolFeb}&lt;/b&gt;&lt;/h6&gt;&lt;h6 style='font-size:14px; font-weight:400; margin: 0.2rem 0;'&gt;Change: &lt;b&gt;{%percentRise}%&lt;/b&gt;&lt;/h6&gt;");</span></pre><h2 id="7ce3" class="mi lm in bd ln mj mk dn lr ml mm dp lv kx mn mo lx lb mp mq lz lf mr ms mb mt bi translated">4.改变悬浮状态下的气泡颜色</h2><p id="6b1f" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">因为我已经增强了工具提示，当鼠标悬停在气泡上时会显示出来，所以我还想调整悬停状态下气泡的颜色。例如，让我把它变成一个更深的阴影，不管它的底色是什么。</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="9c5b" class="nc lm in mx b be nd ne l nf ng">series<br/>  .hovered()<br/>  .fill(function (d) {<br/>    return anychart.color.darken(d.sourceColor, 0.2);<br/>  })<br/>  .stroke(0);</span></pre><h2 id="a13e" class="mi lm in bd ln mj mk dn lr ml mm dp lv kx mn mo lx lb mp mq lz lf mr ms mb mt bi translated">5.自定义标题</h2><p id="32e0" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">最后，我让标题更好地解释了气泡图所代表的内容。我只是为标题启用了HTML，并为标题添加了更多的信息和格式。</p><pre class="kd ke kf kg gt my mx mz bn na nb bi"><span id="4607" class="nc lm in mx b be nd ne l nf ng">map<br/>  .title()<br/>  .enabled(true)<br/>  .useHtml(true)<br/>  .text(<br/>    '&lt;span style = "color: #7c868e; font-size:18px;"&gt;Gasoline Prices in the United States in July 2022&lt;/span&gt;' +<br/>      '&lt;br/&gt;&lt;span style="font-size: 15px;"&gt;Color shows change from February 2022&lt;/span&gt;'<br/>  );</span></pre><p id="f835" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">就这样，一张绝对好看又有信息量的泡泡图就做好了！看看这个:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nh"><img src="../Images/e0d2282bef1e4c99b0db779a005eea15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zmwDI-Ad5lPzLs-pG_KxRQ.png"/></div></div></figure><p id="9822" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这个交互式的JavaScript泡泡地图可以在<a class="ae lk" href="https://playground.anychart.com/SpCcz2KJ/" rel="noopener ugc nofollow" target="_blank">游乐场</a>上找到，这里非常欢迎你继续玩它的代码。</p><h1 id="25da" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">结论</h1><p id="5726" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">现在你知道如何使用JavaScript (HTML5)制作气泡图了！下一步，看<a class="ae lk" href="https://docs.anychart.com/Maps/Proportional_Symbol_Map" rel="noopener ugc nofollow" target="_blank">文档</a>，继续练习。可视化非常有助于理解数据。有了强大的JavaScript库，当您知道自己在做什么时，创建图表和地图会非常容易。</p><p id="bd06" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果您对想要学习的下一种数据可视化有任何问题或建议，请告诉我。在那之前，不要让高昂的油价让你沮丧——尝试泡泡地图或任何其他视觉效果，因为这样做不需要燃料！</p></div><div class="ab cl ni nj hr nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ig ih ii ij ik"><p id="d100" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">非常感谢Shachee Swadia提供了这个令人惊叹的泡泡地图教程！T9】</p><p id="3b74" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io"> <em class="np">一定不要错过我们博客上的其他</em> </strong> <a class="ae lk" href="https://www.anychart.com/blog/category/javascript-chart-tutorials/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="np"> JavaScript制图教程</em> </strong> </a> <strong class="kq io"> <em class="np">！</em>T13】</strong></p><p id="be04" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io"> <em class="np">有没有想出一个不那么惊艳的客座博文？</em> </strong> <a class="ae lk" href="https://www.anychart.com/support/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="np">让我们知道</em> </strong> </a> <strong class="kq io"> <em class="np">，我们将很高兴讨论您的建议！</em> </strong></p></div><div class="ab cl ni nj hr nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ig ih ii ij ik"><p id="9866" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="np">原载于2022年11月16日</em><a class="ae lk" href="https://www.anychart.com/blog/2022/11/16/bubble-maps-js/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="np">www.anychart.com</em></strong></a><em class="np">。</em></p><p id="026e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="np">更多内容看</em> <a class="ae lk" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="np">说白了就是</em> </strong> </a> <em class="np">。报名参加我们的</em> <a class="ae lk" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="np">免费周报</em> </strong> </a> <em class="np">。关注我们关于</em> <a class="ae lk" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="np">推特</em> </strong> </a>，<a class="ae lk" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="np">LinkedIn</em></strong></a><em class="np">，</em><a class="ae lk" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="np">YouTube</em></strong></a><em class="np">，以及</em> <a class="ae lk" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="np">不和</em> </strong>对增长黑客感兴趣？检查 </a><a class="ae lk" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="np">电路</em> </strong> </a> <em class="np">。</em></p></div></div>    
</body>
</html>