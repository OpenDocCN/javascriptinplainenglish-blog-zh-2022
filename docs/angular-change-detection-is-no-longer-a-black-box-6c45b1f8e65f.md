# 角度变化检测不再是一个黑匣子

> 原文：<https://javascript.plainenglish.io/angular-change-detection-is-no-longer-a-black-box-6c45b1f8e65f?source=collection_archive---------3----------------------->

![](img/a9ef32c699d70373bd7b5c0ecc9c37fd.png)

你好啊，小白脸！我将负责更新商业模式，而你将负责改变观点。

听起来很棒？没有吗？为什么不把 CD(变化检测)当作一个黑盒，依靠 Angular 来为我们做这件事呢？

1.事情并不总是像你期望的那样发展。有时，组件中的数据会更新，但视图不会更新。如果你明白光盘是如何工作的，你就会知道如何解决这个问题。

2.你必须意识到 CD 如何影响应用程序的性能。

这篇文章是一个瞥见 CD 世界的好地方。

## **什么是变更检测(CD)？**

当数据发生变化时更新视图(DOM)的过程。

模型的数据(组件)可以包括对象、数组和基本类型，它们都将作为表单、输入或用户可以查看和交互的任何其他内容显示在 dom 上。

每当我们对组件数据进行更改时，模板会立即呈现出来

作为开发人员，我们的工作是保持模型的业务逻辑是最新的，Angular 通过其 CD 机制负责视图渲染。

![](img/870d5d7661ce88c2485335fe784bea45.png)

## **它是如何工作的？**

对于每个组件，将创建变化检测器并将其排列在树中。

CD 从上到下检查树中的每个组件，查看模型中的数据是否发生了变化，如果发生了变化，它将呈现并更新 DOM。

角度从上到下运行 CD。这里没有循环！如果在完成更改检测后更改了某个值，将出现以下错误:“ExpressionChangedAfterItHasBeenCheckedError”。

**我肯定你以前见过那个错误。**

## **CD 什么时候运行？**

每当发生以下情况之一时，它都会运行更改检测器:

1.  事件，如点击*或*提交
2.  HTTP 呼叫
3.  SetTimeOut()或 setInterval()

然而，Angular 如何知道一个异步操作刚刚发生了呢？它怎么知道用户只是点击或者数据被更新了呢？

嗯，它不知道，所以，谁是那个说“嘿 Angular，现在是渲染用户的最佳时机，只需提交一个表单！”

**Zone.js**

区域是一个执行上下文，或者你可以说它保存了关于当前代码运行的环境的信息，就好像区域是一个老大哥，知道关于异步/同步任务的一切，包括它何时开始和结束。

Angular 使用 NgZone(区域的分支)通知 Angular 运行 cd。

## **听起来很神奇，但是要多少钱呢？**

性能就是价格。

Angular 在每次事件触发变化检测(Dom event，HTTP，timer)时，从上到下检查组件树中的每个组件。例如，如果父组件有一个输入并且用户输入，那么 CD 将在该组件及其所有子组件上运行，即使它们都不需要更新。

如果我们有一个复杂的应用程序，它会降低速度，用户体验可能会受到影响

那么，如果我们的应用程序极其庞大和复杂，我们能做什么呢？

好消息是，我们不必接受如此糟糕的性能，通过使用 onPush 方法或“ngZonengZone.runOutsideAngula”，您可能会显著减少 CD 调用的数量并优化性能。但这是另一篇博客文章的主题。

*更多内容请看*[***plain English . io***](https://plainenglish.io/)*。报名参加我们的* [***免费周报***](http://newsletter.plainenglish.io/) *。关注我们关于*[***Twitter***](https://twitter.com/inPlainEngHQ)*和*[***LinkedIn***](https://www.linkedin.com/company/inplainenglish/)*。加入我们的* [***社区不和谐***](https://discord.gg/GtDtUAvyhW) *。*