<html>
<head>
<title>How to Connect to MongoDB Using Mongoose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Mongoose连接到MongoDB</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-connect-to-mongodb-using-mongoose-599760dc27df?source=collection_archive---------9-----------------------#2022-07-14">https://javascript.plainenglish.io/how-to-connect-to-mongodb-using-mongoose-599760dc27df?source=collection_archive---------9-----------------------#2022-07-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="1f38" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">关于如何使用Mongoose连接到MongoDB的教程</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/168cffe0b8e61f435bfed58b848b068a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jiiTCU9eiOTwX2wN"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@urielsc26?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Uriel SC</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="bc5e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">MongoDB是一个用于存储数据的NoSQL数据库。使用node，您可以创建一个连接到远程MongoDB服务器的服务器，并创建数据库集合来存储不同类型的数据。</p><p id="3752" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Mongoose使得连接到MongoDB变得非常简单，并且内置了对模型和数据类型的支持。</p><p id="66ec" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">第一步是安装Mongoose和其他依赖项。下面是我的package.json文件，其中包含本例中的所有依赖项:</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="5d52" class="lu lv in lq b gy lw lx l ly lz">{</span><span id="9755" class="lu lv in lq b gy ma lx l ly lz">"name": "node-mongoose",</span><span id="940a" class="lu lv in lq b gy ma lx l ly lz">"version": "1.0.0",</span><span id="3357" class="lu lv in lq b gy ma lx l ly lz">"description": "",</span><span id="2573" class="lu lv in lq b gy ma lx l ly lz">"main": "app.js",</span><span id="18bc" class="lu lv in lq b gy ma lx l ly lz">"dependencies": {</span><span id="3b78" class="lu lv in lq b gy ma lx l ly lz">"bcryptjs": "^2.4.3",</span><span id="b8cd" class="lu lv in lq b gy ma lx l ly lz">"body-parser": "^1.20.0",</span><span id="bf38" class="lu lv in lq b gy ma lx l ly lz">"ejs": "^3.1.8",</span><span id="f86a" class="lu lv in lq b gy ma lx l ly lz">"express": "^4.18.1",</span><span id="421e" class="lu lv in lq b gy ma lx l ly lz">"express-session": "^1.17.3",</span><span id="3dad" class="lu lv in lq b gy ma lx l ly lz">"mongoose": "^6.4.3",</span><span id="78bb" class="lu lv in lq b gy ma lx l ly lz">"nodemon": "^2.0.18"</span><span id="16de" class="lu lv in lq b gy ma lx l ly lz">},</span><span id="fb7a" class="lu lv in lq b gy ma lx l ly lz">"scripts": {</span><span id="15ca" class="lu lv in lq b gy ma lx l ly lz">"start": "nodemon app.js",</span><span id="be71" class="lu lv in lq b gy ma lx l ly lz">"example": "nodemon example.js",</span><span id="21ca" class="lu lv in lq b gy ma lx l ly lz">"test": "echo \"Error: no test specified\" &amp;&amp; exit 1"</span><span id="d9be" class="lu lv in lq b gy ma lx l ly lz">},</span><span id="4e37" class="lu lv in lq b gy ma lx l ly lz">"keywords": [],</span><span id="3066" class="lu lv in lq b gy ma lx l ly lz">"author": "",</span><span id="2831" class="lu lv in lq b gy ma lx l ly lz">"license": "ISC"</span><span id="f32a" class="lu lv in lq b gy ma lx l ly lz">}</span></pre><p id="8c19" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">只需复制这个文件并运行npm install，就可以在Node.js终端中使用npm run start运行服务器。</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="bf33" class="lu lv in lq b gy lw lx l ly lz">const mongoose = require('mongoose')</span></pre><p id="a8d4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一旦导入了Mongoose，就可以创建一个模式或模型。</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="702f" class="lu lv in lq b gy lw lx l ly lz">const postSchema = new mongoose.Schema({</span><span id="fb05" class="lu lv in lq b gy ma lx l ly lz">    title: {</span><span id="fb72" class="lu lv in lq b gy ma lx l ly lz">        type: String,</span><span id="6055" class="lu lv in lq b gy ma lx l ly lz">        required: true</span><span id="ab9a" class="lu lv in lq b gy ma lx l ly lz">    },</span><span id="2d0b" class="lu lv in lq b gy ma lx l ly lz">    content: {<br/>        type: String,</span><span id="abb1" class="lu lv in lq b gy ma lx l ly lz">        required: true</span><span id="262d" class="lu lv in lq b gy ma lx l ly lz">    }<br/>})</span><span id="56d0" class="lu lv in lq b gy ma lx l ly lz">module.exports = mongoose.model('Post', postSchema)</span></pre><p id="6d3c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一旦创建了这个模型，您就可以读取、写入和更新这个集合中的文档。集合名称将作为“文章”存储在数据库中。</p><p id="5502" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要连接到MongoDB数据库，您需要一个连接字符串，它在您的MongoDB Atlas主机上提供。该连接字符串包括数据库名称和密码，因此请确保将其安全地存储在. env文件中。</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="d530" class="lu lv in lq b gy lw lx l ly lz">const CONNECT_URL = "" // Your connection string<br/>mongoose</span><span id="a2e9" class="lu lv in lq b gy ma lx l ly lz">.connect(CONNECT_URL, { useNewUrlParser: true, useUnifiedTopology: true })</span><span id="0904" class="lu lv in lq b gy ma lx l ly lz">.then((result) <em class="mb">=&gt;</em> {</span><span id="cda0" class="lu lv in lq b gy ma lx l ly lz">// If connection is successful, start the server.</span><span id="6483" class="lu lv in lq b gy ma lx l ly lz">app.listen(process.env.PORT || 8000);</span><span id="122d" class="lu lv in lq b gy ma lx l ly lz">})</span><span id="f395" class="lu lv in lq b gy ma lx l ly lz">.catch((error) <em class="mb">=&gt;</em> {</span><span id="7d63" class="lu lv in lq b gy ma lx l ly lz">console.log(error);</span><span id="4fec" class="lu lv in lq b gy ma lx l ly lz">});</span></pre><p id="b60a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一旦添加了连接，就可以开始添加GET和POST路由来处理不同的请求。</p><p id="8272" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了处理路由，我将使用express。</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="7ec7" class="lu lv in lq b gy lw lx l ly lz"><em class="mb">const</em> express = require("express");<br/><em class="mb">const</em> app = express();</span></pre><p id="0bc7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了渲染这个例子中的页面，我将使用EJS作为模板引擎。用npm安装EJS，然后添加EJS作为默认模板引擎。</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="c0d2" class="lu lv in lq b gy lw lx l ly lz">app.set("view engine", "ejs");</span><span id="bb25" class="lu lv in lq b gy ma lx l ly lz">app.set("views", "views");</span></pre><p id="bc6d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我将在主文件夹中创建一个名为views的文件夹，在这个文件夹中，我将添加一个posts.ejs文件。在主页上，我将从数据库集合中获取文章，并将它们呈现到模板posts.ejs中。</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="6117" class="lu lv in lq b gy lw lx l ly lz">app.get("/", (req, res) =&gt; {<br/> <br/>    const Post = mongoose.model("Post", postSchema);</span><span id="76fc" class="lu lv in lq b gy ma lx l ly lz">    Post.find().then(posts =&gt; {</span><span id="4b11" class="lu lv in lq b gy ma lx l ly lz">        res.render("posts", {posts: posts})</span><span id="1806" class="lu lv in lq b gy ma lx l ly lz">    })</span><span id="5fbb" class="lu lv in lq b gy ma lx l ly lz">})</span></pre><p id="55a5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">posts数组将被传递给posts.ejs模板，在这个模板中，您可以使用特殊的语法来呈现帖子。</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="f2e8" class="lu lv in lq b gy lw lx l ly lz">&lt;% posts.map(post =&gt; { %&gt;</span><span id="72cd" class="lu lv in lq b gy ma lx l ly lz">    &lt;div&gt;&lt;%= post.title %&gt;&lt;/div&gt;</span><span id="756b" class="lu lv in lq b gy ma lx l ly lz">&lt;% }) %&gt;</span></pre><p id="751d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">完整的文件如下所示:</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="6ca5" class="lu lv in lq b gy lw lx l ly lz">&lt;html lang="en"&gt;</span><span id="c693" class="lu lv in lq b gy ma lx l ly lz">&lt;head&gt;</span><span id="76aa" class="lu lv in lq b gy ma lx l ly lz">&lt;meta charset="UTF-8" /&gt;</span><span id="dd9e" class="lu lv in lq b gy ma lx l ly lz">&lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;</span><span id="3129" class="lu lv in lq b gy ma lx l ly lz">&lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;</span><span id="8f48" class="lu lv in lq b gy ma lx l ly lz">&lt;title&gt;Home&lt;/title&gt;</span><span id="a395" class="lu lv in lq b gy ma lx l ly lz">&lt;/head&gt;</span><span id="8504" class="lu lv in lq b gy ma lx l ly lz">&lt;body&gt;</span><span id="f29d" class="lu lv in lq b gy ma lx l ly lz">&lt;h2&gt;Posts&lt;/h2&gt;</span><span id="6a86" class="lu lv in lq b gy ma lx l ly lz">&lt;% posts.map(post =&gt; { %&gt;</span><span id="dd9b" class="lu lv in lq b gy ma lx l ly lz">&lt;div&gt;&lt;%= post.title %&gt;&lt;/div&gt;</span><span id="677e" class="lu lv in lq b gy ma lx l ly lz">&lt;% }) %&gt;</span><span id="0ca8" class="lu lv in lq b gy ma lx l ly lz">&lt;/body&gt;</span><span id="72c3" class="lu lv in lq b gy ma lx l ly lz">&lt;/html&gt;</span></pre><p id="c2d0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了在EJS中执行JavaScript，该语法打开和关闭JavaScript代码，并执行其中的代码:</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="4730" class="lu lv in lq b gy lw lx l ly lz">&lt;% %&gt;</span></pre><p id="7a87" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要呈现JavaScript变量的值，使用以下语法:</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="95b7" class="lu lv in lq b gy lw lx l ly lz">&lt;%= %&gt;</span></pre><p id="af8d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，如果您想要创建模板文件，您可以使用以下标记来呈现它们:</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="3ed4" class="lu lv in lq b gy lw lx l ly lz">&lt;%-  %&gt;</span></pre><h1 id="487f" class="mc lv in bd md me mf mg mh mi mj mk ml jt mm ju mn jw mo jx mp jz mq ka mr ms bi translated">源代码</h1><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="27f5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这就是了。感谢您的阅读。</p><p id="7835" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="mb">更多内容请看</em><a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mb">plain English . io</em></strong></a><em class="mb">。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="mb">免费周报</em> </strong> </a> <em class="mb">。关注我们关于</em><a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mb">Twitter</em></strong></a><strong class="kv io"><em class="mb"/></strong><em class="mb">和</em><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mb">LinkedIn</em></strong></a><em class="mb">。查看我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="mb">社区不和谐</em> </strong> </a> <em class="mb">加入我们的</em> <a class="ae ks" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="mb">人才集体</em> </strong> </a> <em class="mb">。</em></p></div></div>    
</body>
</html>