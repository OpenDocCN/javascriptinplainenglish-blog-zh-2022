<html>
<head>
<title>How to Get the Caret Index Position of a contentEditable Element with JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用JavaScript获取contentEditable元素的插入符号索引位置</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-get-the-caret-index-position-of-a-contenteditable-element-with-javascript-7954195287f4?source=collection_archive---------6-----------------------#2022-12-14">https://javascript.plainenglish.io/how-to-get-the-caret-index-position-of-a-contenteditable-element-with-javascript-7954195287f4?source=collection_archive---------6-----------------------#2022-12-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ffacf904fdf1d3cd40504c2730297715.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*x6ftV1j5rNsfuWRz"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@aditi_gautam?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Aditi Gautam</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="cd46" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时候，我们想用JavaScript获取一个<code class="fe lb lc ld le b">contentEditable</code>元素的插入符号索引位置。</p><p id="0017" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用JavaScript获得一个<code class="fe lb lc ld le b">contentEditable</code>元素的插入符号索引位置。</p><h1 id="4a9d" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">使用document.getSelector方法</h1><p id="774c" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以使用<code class="fe lb lc ld le b">document.getSelector</code>来获得选择。</p><p id="7e2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用它来得到选择的长度，从而得到光标的位置。</p><p id="ef86" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以编写以下HTML:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="b8cf" class="mq lg iq le b gy mr ms l mt mu">&lt;div contenteditable&gt;some text here &lt;i&gt;italic text here&lt;/i&gt; some other text here &lt;b&gt;bold text here&lt;/b&gt; end of text&lt;/div&gt;</span></pre><p id="cbd5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以通过编写以下JavaScript代码来获取光标的位置:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="776d" class="mq lg iq le b gy mr ms l mt mu">const cursorPosition = () =&gt; {<br/>  const sel = document.getSelection();<br/>  sel.modify("extend", "backward", "paragraphboundary");<br/>  const pos = sel.toString().length;<br/>  if (sel.anchorNode != undefined) sel.collapseToEnd();<br/>  return pos;<br/>}</span><span id="91ca" class="mq lg iq le b gy mv ms l mt mu">const elm = document.querySelector('[contenteditable]');</span><span id="0ebb" class="mq lg iq le b gy mv ms l mt mu">const printCaretPosition = () =&gt; {<br/>  console.log(cursorPosition(), 'length:', elm.textContent.trim().length)<br/>}<br/>elm.addEventListener('click', printCaretPosition)<br/>elm.addEventListener('keydown', printCaretPosition)</span></pre><p id="f6cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe lb lc ld le b">cursorPosition</code>函数，它调用<code class="fe lb lc ld le b">documebnt.getSelection</code>方法来获取div中的文本。</p><p id="6f9c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe lb lc ld le b">modify</code>来调整当前选择。</p><p id="a617" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过<code class="fe lb lc ld le b">'paragraphboundary'</code>移动<code class="fe lb lc ld le b">'backward'</code>。</p><p id="1619" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们在将它转换成一个字符串后得到选择的长度。</p><p id="dd49" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们折叠选择并返回<code class="fe lb lc ld le b">pos</code>来返回光标的位置。</p><p id="f531" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们用<code class="fe lb lc ld le b">querySelector</code>得到div。</p><p id="4416" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们创建<code class="fe lb lc ld le b">printCaretPosition</code>来打印光标位置。</p><p id="df4c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们调用<code class="fe lb lc ld le b">addEventListener</code>,这样当我们在div上点击或输入时，我们就调用<code class="fe lb lc ld le b">printCaretPosition</code>。</p><h1 id="af60" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="9392" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以使用<code class="fe lb lc ld le b">document.getSelector</code>来获得选择。</p><p id="b5bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mw">更多内容请看</em><a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">plain English . io</em></strong></a><em class="mw">。报名参加我们的</em> <a class="ae kc" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="mw">免费周报</em> </strong> </a> <em class="mw">。关注我们关于</em><a class="ae kc" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">Twitter</em></strong></a><a class="ae kc" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">LinkedIn</em></strong></a><em class="mw"/><a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">YouTube</em></strong></a><em class="mw"/><a class="ae kc" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">不和</em> </strong> </a> <strong class="kf ir"> <em class="mw">。</em>T49】</strong></p><p id="3a0b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> <em class="mw">对缩放您的软件启动感兴趣</em> </strong> <em class="mw">？检查</em> <a class="ae kc" href="https://circuit.ooo/?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="mw">电路</em> </strong> </a> <em class="mw">。</em></p></div></div>    
</body>
</html>