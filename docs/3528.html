<html>
<head>
<title>How to Validate Dynamic Routes in React Router</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React路由器中验证动态路由</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-validate-dynamic-routes-in-react-router-8f399ace1d4e?source=collection_archive---------8-----------------------#2022-09-05">https://javascript.plainenglish.io/how-to-validate-dynamic-routes-in-react-router-8f399ace1d4e?source=collection_archive---------8-----------------------#2022-09-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="1178" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">在呈现组件之前获取并验证数据</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/86d29d19eaebfedfaee9010f31331658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XWzR_-M7bmWY3as2"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@flowforfrank?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ferenc Almasi</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8203" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">源代码:<a class="ae ks" href="https://github.com/AbdelrhmanAmin/React-Dynamic-Routes-Manager" rel="noopener ugc nofollow" target="_blank">https://github . com/AbdelrhmanAmin/React-Dynamic-Routes-Manager</a></p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="cc88" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">问题是:</h1><p id="280c" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">为了说明这个问题，让我们以用户档案为例。</p><p id="4236" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我将使用参数<code class="fe mt mu mv mw b">users/:userId</code>定义动态路线，并呈现配置文件组件，在组件内部，我将从<code class="fe mt mu mv mw b">useParams</code>获取<code class="fe mt mu mv mw b">userId</code>，在<code class="fe mt mu mv mw b">useEffect</code>内部，我将发出获取请求以获取用户信息。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/fa26825aee03cc60296641f94cc86829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*u7I2xDhFtekjiLcLPvCtFg.png"/></div></figure><p id="9290" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">问题是，<code class="fe mt mu mv mw b">userId</code>真的可以是任何东西。它可能是<code class="fe mt mu mv mw b">12</code>或<code class="fe mt mu mv mw b">hellomom</code>…因为React在客户端做所有事情，所以即使有人将URL更改为无效内容(例如<code class="fe mt mu mv mw b">users/hilol</code>)或有人试图访问已被删除的用户配置文件的URL，页面组件也会呈现。</p><p id="bce6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当然，拥有良好的结构很重要，在获取数据时在页面组件中显示加载指示器以及获取失败时的错误消息是至关重要的。但是，如果我们可以在呈现组件之前获取并验证数据，那会怎么样呢？</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="4732" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">我的解决方案</h1><p id="ebe0" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">我构建了一个管理器组件，它负责验证获取响应是否正常，如果是，则呈现页面组件，否则显示404页面。</p><p id="3016" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我带你看一下代码。</p><p id="3c79" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，我会将页面组件包装在管理器组件中，如下所示:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi my"><img src="../Images/223d498c5520e05d354c53b7b851609f.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*ovgauyvbzc9_qCzf9u0Yww.png"/></div></figure><p id="6639" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后，我将传递给管理器一个名为<code class="fe mt mu mv mw b">fetcher</code>的属性，它是一个接收路由参数并返回获取请求的函数。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/05eb8b90a70f01e37aa1e51630c3cfa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*6A0x_u5W8jyghV7gagh_Sg.png"/></div></figure><p id="83b0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当用户进入页面时，首先会发生的事情是，管理器将执行第一个useEffect，即进行验证的那个。仅当路径名不在<code class="fe mt mu mv mw b">invalidRoutesRef</code>内时。</p><blockquote class="na nb nc"><p id="bf4a" class="kt ku nd kv b kw kx jo ky kz la jr lb ne ld le lf nf lh li lj ng ll lm ln lo ig bi translated">注意:这在每次挂载时都是空的，我建议你使用Redux或React context来存储<code class="fe mt mu mv mw b">invalidRoutes</code>以避免无效的验证路径。</p><p id="82b3" class="kt ku nd kv b kw kx jo ky kz la jr lb ne ld le lf nf lh li lj ng ll lm ln lo ig bi translated">我之所以使用<code class="fe mt mu mv mw b"><em class="in">invalidRoutesRef</em></code>而不是简单地使用像<code class="fe mt mu mv mw b"><em class="in">isValid</em></code>这样的标志，是因为我注意到在导航到一个不同的配置文件后,<code class="fe mt mu mv mw b"><em class="in">isValid</em></code>的值将保持为“false ”,因此即使<code class="fe mt mu mv mw b"><em class="in">userId</em></code>有效，页面也会显示404。</p></blockquote><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/e50533fec33e2f5b42c39a72a2a6c325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*2Wu5QALz-eR13IA6DhQiOQ.png"/></div></figure><p id="4fd0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该函数首先将<code class="fe mt mu mv mw b">isLoading</code>设置为true(提示:默认设置为true，以便在第一次渲染时显示加载指示器😄)并将路由的<code class="fe mt mu mv mw b">params</code>传递给<code class="fe mt mu mv mw b">fetcher</code>函数，并等待直到获取解决。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ni"><img src="../Images/ce8df9cf7f69f63abbf6422b6678ad4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sVsWCImOTWOZVazSycwKDg.png"/></div></div></figure><p id="2f28" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe mt mu mv mw b">isLoading</code>将在获取数据时显示加载屏幕。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/e28cdc2afffbd8d896a291dcd3d30b56.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*-7dAyxIc0gregY756stAtA.png"/></div></figure><p id="bdc1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果请求失败，则按下<code class="fe mt mu mv mw b">pathname</code>至<code class="fe mt mu mv mw b">invalidRoutesRef</code>。然后，将<code class="fe mt mu mv mw b">isLoading</code>设置为假。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nk"><img src="../Images/37e4229116a34adfb1651ea6fb4dc993.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ohduFFCoQR_JUh6mb68kzg.png"/></div></div></figure><p id="b331" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi gj"><img src="../Images/c5602b7a7d25522cdd7e6535d0a92946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IVovj2ebLi9_N1-7I4XnzA.png"/></div></div></figure></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><p id="c739" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我希望这能使你受益。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><p id="ef66" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="nd">更多内容看</em> <a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nd">说白了。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nd">免费周报</em> </strong> </a> <em class="nd">。关注我们关于</em> <a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nd">推特</em> </strong> </a>，<a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nd">LinkedIn</em></strong></a><em class="nd">，</em><a class="ae ks" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nd">YouTube</em></strong></a><em class="nd">，</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nd">不和</em> </strong> </a> <em class="nd">。</em></strong></a></p></div></div>    
</body>
</html>