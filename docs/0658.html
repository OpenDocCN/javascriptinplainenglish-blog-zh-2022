<html>
<head>
<title>Add a Customize Users-Permissions Provider for Strapi V4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为Strapi V4添加自定义用户权限提供程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/add-a-customize-users-permissions-provider-for-strapi-v4-6aa78c642977?source=collection_archive---------2-----------------------#2022-02-05">https://javascript.plainenglish.io/add-a-customize-users-permissions-provider-for-strapi-v4-6aa78c642977?source=collection_archive---------2-----------------------#2022-02-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="2ac1" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">关于如何为Strapi V4添加自定义用户权限提供程序的指南。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/594225392bf810fe6a5a52a42dc77028.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JN4jknSpV2OFpQq1"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@desola?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Desola Lanre-Ologun</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="33f3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">更新:</strong></p><p id="7dd6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">根据<a class="ae ks" href="https://docs.strapi.io/developer-docs/latest/development/plugins-extension.html#within-the-extensions-folder" rel="noopener ugc nofollow" target="_blank">插件扩展——Strapi开发者文档</a>，找到一个更简单的方法</p><p id="d7cd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在src/extensions/users-permissions/strapi-server . js中</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="6efa" class="lu lv in lq b gy lw lx l ly lz">'use strict';</span><span id="fa69" class="lu lv in lq b gy ma lx l ly lz">module.exports = (plugin) =&gt; {<br/> plugin.bootstrap = require('./server/bootstrap');<br/> plugin.services['providers'] = require('./server/services/providers');<br/> <strong class="lq io">return</strong> plugin;<br/>};</span></pre><p id="3a38" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">不需要。/src/extensions/users-permissions/server/index . js/src/extensions/users-permissions/server/service/index . js。</p><p id="cb6a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先我们根据Strapi V4文档在我们的项目结构中的src/extensions文件夹下创建一个名为“users-permissions”的文件夹:<a class="ae ks" href="https://docs.strapi.io/developer-docs/latest/development/plugins-extension.html#extending-a-plugin-s-interface" rel="noopener ugc nofollow" target="_blank">https://docs . Strapi . io/developer-docs/latest/development/plugins-extension . html # extending-a-plugin-s-interface</a>。</p><p id="7801" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因为Users-Permissions provider是一个“服务器”端插件代码，我们需要创建一个文件名为strapi-server.js的文件</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="257c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后我们需要创建相应的文件夹:</p><p id="e587" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe md me mf lq b">./server/bootstrap and ./server/services.</code></p><p id="67ad" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后从node _ modules/@ strapi/plugin-users-permissions/，复制一些源代码:</p><p id="55e3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">server/index.js、server/bootstrap/index.js、server/services/index.js和server/providers.js。</p><p id="0dd9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，我们有这样的文件和文件夹结构:</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="271b" class="lu lv in lq b gy lw lx l ly lz">├──── src<br/>│     ├──── <a class="ae ks" href="https://docs.strapi.io/developer-docs/latest/development/plugins-extension.html" rel="noopener ugc nofollow" target="_blank">extensions</a> # files to extend installed plugins<br/>│     │     └──── users-permissions<br/>│     │           ├──── server<br/>│     │           │     └──── bootstrap<br/>│     │           │     │     └ index.js<!-- --> <br/>│     │           │     └──── services<br/>│     │           │     │     └ index.js<br/>│     │           │     │     └ providers.js<br/>│     │           │     └ index.js  <br/>│     │           └ <a class="ae ks" href="https://docs.strapi.io/developer-docs/latest/developer-resources/plugin-api-reference/server.html" rel="noopener ugc nofollow" target="_blank">strapi-server.js</a></span></pre><p id="1440" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在我们添加自定义提供程序代码之前，我们需要首先修复requrie文件路径。</p><p id="3035" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在server/index.js中，将源代码修补为:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="58f7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在server/bootstrap/index.js中，按如下方式修补源代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="6f69" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在server/services/index.js中，将源代码修补为:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="dee3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在是时候添加我们定制提供者源代码了！</p><p id="516f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在server/bootstrap/index.js中:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="3fba" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在server/services/providers.js中:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="56f8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在你知道了。感谢您的阅读。</p><p id="5e56" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="mg">更多内容看</em> <a class="ae ks" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="mg">说白了。报名参加我们的</em><strong class="kv io"><em class="mg"/></strong><a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mg">免费周报</em> </strong> </a> <em class="mg">。在我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="mg">社区不和谐</em> </strong> </a> <em class="mg">获得独家获取写作机会和建议。</em></strong></a></p></div></div>    
</body>
</html>