<html>
<head>
<title>How to Detect When the User Presses the Shift+Enter and Key Combo and Add a New Line in Text Area When the User Does So?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何检测用户何时按下Shift+Enter和组合键，并在用户这样做时在文本区域添加一个新行？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-detect-when-the-user-presses-the-shift-enter-and-key-combo-and-add-a-new-line-in-text-area-1151669dadbb?source=collection_archive---------16-----------------------#2022-08-24">https://javascript.plainenglish.io/how-to-detect-when-the-user-presses-the-shift-enter-and-key-combo-and-add-a-new-line-in-text-area-1151669dadbb?source=collection_archive---------16-----------------------#2022-08-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/597298954b2ca1024b9f9c3fc313f36a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4hA51hNiNIszh3E8"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@maritafox?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Marita Kavelashvili</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="cdae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时，我们希望检测用户何时按下shift-enter组合键，并在用户这样做时在文本区域添加一个新行。</p><p id="6b1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究如何在光标位于文本区域时检测按下的shift-enter组合键。</p><h1 id="6907" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在文本区域添加文本选择以移动光标</h1><p id="f933" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过在文本区域中添加一个选择范围，将文本区域中的光标移动到下一行。</p><p id="b1af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有以下文本区域:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4b9a" class="mn lc iq mj b gy mo mp l mq mr">&lt;textarea&gt;&lt;/textarea&gt;</span></pre><p id="abbc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以监听<code class="fe ms mt mu mj b">keydown</code>事件来检测shift+enter组合键的按下。</p><p id="0f31" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果组合被按下，那么我们停止默认行为，然后将文本选择添加到文本区域，将光标移动到下一行。</p><p id="61fc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2d23" class="mn lc iq mj b gy mo mp l mq mr">const pasteIntoInput = (el, text) =&gt; {<br/>  el.focus();<br/>  if (typeof el.selectionStart === "number" &amp;&amp;<br/>    typeof el.selectionEnd === "number") {<br/>    const val = el.value;<br/>    const selStart = el.selectionStart;<br/>    el.value = val.slice(0, selStart) + text + val.slice(el.selectionEnd);<br/>    el.selectionEnd = el.selectionStart = selStart + text.length;<br/>  } else if (typeof document.selection !== "undefined") {<br/>    const textRange = document.selection.createRange();<br/>    textRange.text = text;<br/>    textRange.collapse(false);<br/>    textRange.select();<br/>  }<br/>}</span><span id="23dc" class="mn lc iq mj b gy mv mp l mq mr">const handleEnter = (evt) =&gt; {<br/>  if (evt.keyCode === 13 &amp;&amp; evt.shiftKey) {<br/>    if (evt.type === "keypress") {<br/>      evt.preventDefault();<br/>      pasteIntoInput(evt.target, "\n");<br/>    }<br/>  }<br/>}</span><span id="8dc3" class="mn lc iq mj b gy mv mp l mq mr">const textarea = document.querySelector('textarea')<br/>textarea.addEventListener('keydown', handleEnter)</span></pre><p id="2d5a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有接受<code class="fe ms mt mu mj b">el</code>元素和<code class="fe ms mt mu mj b">text</code>值的<code class="fe ms mt mu mj b">pasteIntoInput</code>函数。</p><p id="7d52" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在函数中，我们调用<code class="fe ms mt mu mj b">el.focus</code>来关注元素。</p><p id="67c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们检查<code class="fe ms mt mu mj b">selectionStart</code>和<code class="fe ms mt mu mj b">selectionEnd</code>是否是一个数。</p><p id="f13e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们将<code class="fe ms mt mu mj b">el.value</code>设置为选择文本的第一部分，将它与<code class="fe ms mt mu mj b">text</code>连接，并将它与所选文本的第二部分连接。</p><p id="b200" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们将<code class="fe ms mt mu mj b">el.selectionEnd</code>设置为文本的新长度。</p><p id="116f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe ms mt mu mj b">documebt.selection</code>是<code class="fe ms mt mu mj b">undefined</code>，</p><p id="085e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe ms mt mu mj b">documenbt.selection.createRange</code>创建一个新的选择。</p><p id="0bcd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们设置选择的文本，所有的<code class="fe ms mt mu mj b">collapse</code>折叠选择并调用<code class="fe ms mt mu mj b">select</code>选择它。</p><p id="4128" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们创建<code class="fe ms mt mu mj b">handleEnter</code>函数，它是事件处理程序。</p><p id="bda0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们检测shift+enter组合键并停止默认行为，如果组合键被按下，调用<code class="fe ms mt mu mj b">pasteIntoInput</code>在文本区域粘贴一个新行。</p><p id="1504" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们用<code class="fe ms mt mu mj b">querySelector</code>选择文本区域。</p><p id="f98e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe ms mt mu mj b">addEventListener</code>来监听文本区域上的<code class="fe ms mt mu mj b">keydown</code>事件。</p><p id="e9a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，当我们按shift+enter时，光标将移动到新的一行。</p><h1 id="7787" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="5497" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过停止默认行为，在按下shift+enter时在文本区域插入一个新行，然后在选中的文本中添加一个新行字符，并将其设置为文本区域的新<code class="fe ms mt mu mj b">value</code>来添加新行。</p><p id="cec7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mw">更多内容请看</em><a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">plain English . io</em></strong></a><em class="mw">。报名参加我们的</em> <a class="ae kc" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="mw">免费周报</em> </strong> </a> <em class="mw">。关注我们关于</em><a class="ae kc" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">Twitter</em></strong></a><a class="ae kc" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">LinkedIn</em></strong></a><em class="mw"/><a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">YouTube</em></strong></a><em class="mw"/><a class="ae kc" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">不和</em> </strong> </a> <em class="mw">。</em></p></div></div>    
</body>
</html>