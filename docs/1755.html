<html>
<head>
<title>React Auth Hook — Context API and useReducer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React Auth Hook —上下文API和useReducer</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-auth-hook-context-api-and-usereducer-8567a2ef0d89?source=collection_archive---------0-----------------------#2022-04-17">https://javascript.plainenglish.io/react-auth-hook-context-api-and-usereducer-8567a2ef0d89?source=collection_archive---------0-----------------------#2022-04-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="5ee0" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">创建一个自定义钩子，在React和expose方法中实现更好的身份验证版本，以更新提供者，就像MSAL身份验证一样。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/9ef6170e7083466cad7f7df386af8ea3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uiSN09LGFNjJTw1w"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a999" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果管理不当，在任何前端应用程序中处理身份验证都会变得很麻烦。一些应用程序根据其需求有不同的情况。例如，每当会话或令牌过期时触发弹出窗口，或者获取令牌以更新任何其他服务或单个位置，您可以在其中清除缓存和本地存储等。</p><h2 id="00dc" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">目标</h2><p id="4f78" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">本文的目标是创建一个自定义组件提供程序，它在内部处理auth API并管理其状态。此外，公开获取令牌和切换登录弹出窗口的方法。</p><h2 id="6bee" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">定义</h2><p id="fdd4" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated"><strong class="kv io">上下文API </strong>是一种跨组件传递属性的机制，无需创建道具树和道具钻取。点击这里阅读官方文档了解背景<a class="ae ks" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank">以获得更深入的理解。</a></p><p id="74e2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> useReducer </strong>用于处理复杂的状态逻辑，为我们提供了状态和动作两个基本思路来管理状态。useState的替代方法，用于调度。点击阅读官方文档<a class="ae ks" href="https://reactjs.org/docs/hooks-reference.html#usereducer" rel="noopener ugc nofollow" target="_blank">中关于useReducer的更多信息。</a></p><h2 id="2447" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">开始</h2><p id="25eb" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">在我们跳到代码之前，如果你想看完整的代码，那么你可以看看这个<a class="ae ks" href="https://github.com/Piyush-Use-Personal/react-auth-hook.git" rel="noopener ugc nofollow" target="_blank">回购和源代码</a>。</p><p id="7271" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">引导应用程序</strong></p><p id="f229" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我使用create-react-app来引导项目，但是当然，你可以在现有的应用程序或其他程序中实现它。此外，我清理了本文上下文中不需要的文件。</p><p id="8434" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在假设您对存储、上下文和钩子的定义有了基本的概念，让我们开始编写代码。</p><p id="b7ab" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在从本文的<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/how-to-handle-different-endpoints-in-axios-and-nodejs-8b288d92e940?source=your_stories_page-------------------------------------">中得出的<code class="fe mn mo mp mq b">src/service/Auth.js</code>内的源代码中添加了一个服务类。</a></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/3ba1e824abfacb531f35bb708a4acf52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*MrhFdYMyZvyEj3q-U6fcMQ.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Auth.js based on reqres</figcaption></figure><p id="49b5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我正在使用一个名为<a class="ae ks" href="https://reqres.in/" rel="noopener ugc nofollow" target="_blank"> reqres </a>的在线服务，但是你应该使用你的认证提供者或者后端来处理这个类。</p><p id="05e9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这个类的功能是管理auth操作并生成一个令牌，同时在构造函数本身中传递默认的Axios属性。</p><p id="403b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">创建商店</strong></p><p id="5a1e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们用以下文件创建另一个名为<code class="fe mn mo mp mq b">store</code>的文件夹</p><ul class=""><li id="7c2a" class="ms mt in kv b kw kx kz la lc mu lg mv lk mw lo mx my mz na bi translated"><code class="fe mn mo mp mq b">action.js</code> —该文件将创建改变状态所需的动作</li><li id="35d8" class="ms mt in kv b kw nb kz nc lc nd lg ne lk nf lo mx my mz na bi translated"><code class="fe mn mo mp mq b">reducer.js</code> —基于不同动作控制状态的文件</li><li id="cc86" class="ms mt in kv b kw nb kz nc lc nd lg ne lk nf lo mx my mz na bi translated"><code class="fe mn mo mp mq b">popup.js</code> —基于状态变化触发某些用户界面的外部文件</li><li id="3e78" class="ms mt in kv b kw nb kz nc lc nd lg ne lk nf lo mx my mz na bi translated"><code class="fe mn mo mp mq b">index.js</code> —整个俱乐部的文件和商店</li></ul><p id="10b3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们将在创建完商店的所有骨架后，最终触摸到<code class="fe mn mo mp mq b">index.js</code>。</p><p id="6a2e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> <em class="ng">在action.js文件</em> </strong>中，我们将首先创建将触发一些reducer方法的所有action _ TYPES，以及处理错误、成功和加载状态的更少的ACTION，但是您可以根据您的需要和特性添加和更新这些。</p><p id="34ad" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在doLogin方法中，我们根据需要分派动作来触发不同的状态变化。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nh"><img src="../Images/6026b134bb31112235639d97a661db2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XKFs5kN7nq54SamS2HtjTw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">action.js</figcaption></figure><p id="9d65" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> <em class="ng">在reducer.js文件</em> </strong>中，我们将导入动作，并根据传入的类型更新状态和还原更少的状态(如果响应成功，则停止加载并清除错误)。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ni"><img src="../Images/6148fced22db6df6ecc90131e2bbab8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Or6RqW_wHrg0NZiVhxaJ2g.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">reducer.js</figcaption></figure><p id="7400" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> <em class="ng">在popup.js文件</em> </strong>中，我正在创建一个在上下文中被全局触发的弹出窗口。在弹出窗口中，我放置了一个只更新里面道具的表单，在关闭、提交和打开弹出窗口时，它将对家长保持关闭。</p><p id="505c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我要了类似<code class="fe mn mo mp mq b">isOpen, onClose and onSave</code>更新界面的参数。该表单包含两个字段，用于输入电子邮件和密码，以提交到我们在启动阶段开始时创建的后端服务中。</p><p id="9f16" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你可以根据你的应用程序版本来更新结构，比如导航到某个页面，或者稍微改变布局等等。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nj"><img src="../Images/a660bd0c73690409b12510c07c40d04d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4kvIRPkasqBh9Sixal9GGg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">popup.js</figcaption></figure><p id="1b04" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">整合我们刚刚创造的一切</strong></p><p id="ca51" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了将我们刚刚创建的所有内容整合到一个地方，我们添加了一个文件名<code class="fe mn mo mp mq b">index.js</code>，它将作为Auth的父存储。</p><p id="aa9d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，我们将导入动作、缩减器、弹出文件和内容，以及我们在动作文件中创建的初始状态。导入所有东西后，我用方法<code class="fe mn mo mp mq b">React.createContext</code>创建了一个存储，并用它<code class="fe mn mo mp mq b">React.useContext</code>公开一个钩子来使用。</p><p id="c6e4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在，让我们创建一个提供者组件，只将一个道具作为子组件，然后使用我们刚刚创建的与React <code class="fe mn mo mp mq b">useReducer</code>函数同名的reducer，并将authReducer和initialAuthState作为属性传递给它。</p><p id="86bf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要触发弹出窗口，使用常规的<code class="fe mn mo mp mq b">useState</code>并在方法中切换它。为了更新动作，我创建了一个名为<code class="fe mn mo mp mq b">login</code>的方法，并在调度我们之前为异步操作创建的相同方法时公开该方法，并在它发出成功响应后切换该方法。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nk"><img src="../Images/e8b4dbfc251a9ff01fd4040ff1204ef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wl-4-7-ZuFGTkXpP6rlAcA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">index.js</figcaption></figure><p id="614a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">设置好所有方法后，让我们创建一个自定义对象来包装状态和方法，并从组件获取控制来调度任何方法。</p><pre class="kd ke kf kg gt nl mq nm nn aw no bi"><span id="f508" class="lp lq in mq b gy np nq l nr ns">const operationsAndState = {</span><span id="e7b9" class="lp lq in mq b gy nt nq l nr ns">   state: authState,</span><span id="8af0" class="lp lq in mq b gy nt nq l nr ns">   login,</span><span id="4959" class="lp lq in mq b gy nt nq l nr ns">   toggleLoginPopup</span><span id="ce15" class="lp lq in mq b gy nt nq l nr ns">}</span></pre><p id="0ddc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这一部分将向组件及其方法公开。在返回时，组件用我们刚刚创建的子窗口和登录弹出窗口包装提供者，并将各自的属性传递给它。</p><p id="1997" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因为我们将它放在子组件级别，所以我们可以从所有子组件中切换它。</p><p id="1366" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">如何使用</strong></p><p id="e8a5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要使用我们刚刚创建的提供者，我们需要将其包装在父组件上。现在，组件树将可以从上下文中访问所有状态。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/2194a72c4a0848197eb2921823a8449d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*PWGfp_jf8VqOibLFUlXrjQ.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">App.js</figcaption></figure><p id="0a58" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要更新状态并触发它，首先，让我们创建一个名为<code class="fe mn mo mp mq b">home.js</code>的文件，导入我们创建的钩子，并从组件析构中获取触发它的状态和方法。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nv"><img src="../Images/b9f78c46c13177272a5e35eb5182749e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZsiKlADkUUwmZRy0RRC2Mw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">home.js</figcaption></figure><p id="4750" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这将和我们创造的一样美好。当你运行应用程序时，你可以在点击按钮时切换模式，当你填写细节时，你会同时看到状态的变化。</p><p id="9e35" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">根据<a class="ae ks" href="https://reqres.in/" rel="noopener ugc nofollow" target="_blank">要求</a>使用此凭证进行成功检查。</p><pre class="kd ke kf kg gt nl mq nm nn aw no bi"><span id="1ccd" class="lp lq in mq b gy np nq l nr ns">{<br/>    "email": "eve.holt@reqres.in",<br/>    "password": "cityslicka"<br/>}</span></pre><h2 id="6983" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">结论</h2><p id="e855" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">总结这篇文章，我希望你学到了一些好的东西，并将其应用到你的项目中。尝试创造最适合自己的方法和途径。</p><p id="ed03" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">对于那些错过了源代码的人来说，可从<a class="ae ks" href="https://github.com/Piyush-Use-Personal/react-auth-hook.git" rel="noopener ugc nofollow" target="_blank">这里获得</a>。祝你有美好的一天和更好的运气。谢了。</p><p id="4b45" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="ng">更多内容请看</em><a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="ng">plain English . io</em></strong></a><em class="ng">。报名参加我们的</em><strong class="kv io"><em class="ng"/></strong><a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="ng">免费周报</em> </strong> </a> <em class="ng">。关注我们关于</em><a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="ng">Twitter</em></strong></a><em class="ng">和</em><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="ng">LinkedIn</em></strong></a><em class="ng">。加入我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="ng">社区</em> </strong> </a> <em class="ng">。</em></p></div></div>    
</body>
</html>