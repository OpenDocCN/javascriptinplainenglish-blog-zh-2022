<html>
<head>
<title>React Hooks — When to Use useLayoutEffect Instead of useEffect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React挂钩—何时使用useLayoutEffect而不是useEffect</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-hooks-when-to-use-uselayouteffect-instead-of-useeffect-3271a96d881a?source=collection_archive---------0-----------------------#2022-08-20">https://javascript.plainenglish.io/react-hooks-when-to-use-uselayouteffect-instead-of-useeffect-3271a96d881a?source=collection_archive---------0-----------------------#2022-08-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bd58" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">useEffect和useLayoutEffect的区别——用一个真实的例子来解释。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9470cbbcc53199c26fd00c91bdbab0b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jYD7tL8pQAFTf7Lm"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@johnschno?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">John Schnobrich</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="63f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">两个React钩子(<a class="ae kv" href="https://reactjs.org/docs/hooks-reference.html#useeffect" rel="noopener ugc nofollow" target="_blank"> <em class="ls"> useEffect </em> </a>和<a class="ae kv" href="https://reactjs.org/docs/hooks-reference.html#uselayouteffect" rel="noopener ugc nofollow" target="_blank"><em class="ls">useLayoutEffect</em></a><strong class="ky ir"><em class="ls">)</em></strong>签名相同，名字相似，结果相似，有什么区别？与其读一千遍，不如看一遍它们之间的区别！🦉</p><p id="a393" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的gif显示了两个聊天框——页面加载后，消息被“提取”,然后每个聊天框滚动到底部。左边的框使用<code class="fe lt lu lv lw b">useLayoutEffect</code>钩子滚动到底部，右边的框使用<code class="fe lt lu lv lw b">useEffect</code>。<strong class="ky ir">使用</strong> <code class="fe lt lu lv lw b"><strong class="ky ir">useEffect</strong></code> <strong class="ky ir">，你可以注意到一些奇怪的闪烁。</strong> <strong class="ky ir">但这是为什么呢？</strong>🤷‍♂️</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lx"><img src="../Images/f17e67cd0444ad1657123819cc046c63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*GeEvUL0Zl3FVlSzNhFKiSg.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk"><strong class="bd ly">useEffect vs useLayoutEffect in React 17 — loading initial data</strong></figcaption></figure><p id="06c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">注意:上面的gif来自一个使用React v17的app。稍后，我们将使用它进行比较，以了解React v18+中的不同行为。</em></p><h1 id="04e6" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">useLayoutEffect和useEffect的区别</h1><p id="4249" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">要理解UI为什么会闪烁，我们需要先理解两个钩子的区别。<strong class="ky ir"/><code class="fe lt lu lv lw b"><strong class="ky ir">useLayoutEffect</strong></code><strong class="ky ir">和</strong> <code class="fe lt lu lv lw b"><strong class="ky ir">useEffect</strong></code> <strong class="ky ir">的区别在于挂钩什么时候开火。</strong>在React组件生命周期的环境中可以看到这一点:</p><h2 id="6cbc" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">React组件的生命周期</h2><ol class=""><li id="5958" class="ni nj iq ky b kz mr lc ms lf nk lj nl ln nm lr nn no np nq bi translated">用户与app交互，组件变化的<em class="ls">状态</em>或<em class="ls">道具</em>。</li><li id="e8c4" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">React更新文档对象模型(DOM)。</li><li id="cb6f" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated"><strong class="ky ir"/><code class="fe lt lu lv lw b"><strong class="ky ir">useLayoutEffect</strong></code><strong class="ky ir">钩火。</strong></li><li id="f888" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">浏览器绘画= &gt;向用户显示视觉变化。</li><li id="13d0" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated"><strong class="ky ir"/><code class="fe lt lu lv lw b"><strong class="ky ir">useEffect</strong></code><strong class="ky ir">吊钩着火。</strong></li></ol><h2 id="967a" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">为什么<strong class="ak">React应用程序只在使用效果时闪烁</strong></h2><p id="2498" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">注意<code class="fe lt lu lv lw b"><strong class="ky ir">useLayoutEffect</strong></code> <strong class="ky ir">在浏览器绘画和用户看到任何视觉变化</strong>之前触发。这基本上是避免闪烁的秘密。</p><p id="4e00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">如果你使用</strong> <code class="fe lt lu lv lw b"><strong class="ky ir">useEffect</strong></code> <strong class="ky ir">钩子滚动到底部，它只有在消息已经显示给用户之后才会触发(参见组件生命周期),这导致了闪烁。</strong>另一方面，如果使用<code class="fe lt lu lv lw b">useLayoutEffect</code>钩子，首先将消息添加到DOM，然后通过改变DOM将消息滚动到底部，只有在这之后，才会向用户呈现视觉变化(没有闪烁)。</p><h2 id="73e0" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated"><strong class="ak">何时您应该选择useLayoutEffect </strong></h2><p id="7f82" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">如果你需要直接更新DOM并对UI进行可视化的修改，你应该使用<code class="fe lt lu lv lw b">useLayoutEffect</code>。这使它更加平滑，并改善闪烁问题。</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="ba22" class="lz ma iq bd mb mc od me mf mg oe mi mj jw of jx ml jz og ka mn kc oh kd mp mq bi translated">反应17和反应18中使用效果的不同行为</h1><p id="a493" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">前面的示例显示了消息初始加载时发生的情况。然而，<strong class="ky ir">从React 18开始，如果组件的<em class="ls"> props </em>或<em class="ls"> state </em>因点击</strong>等用户输入而改变，则行为可能会有所不同。</p><p id="1175" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">使用React 17 </strong>(下面的gif)<strong class="ky ir">，</strong>如果用户通过点击按钮添加消息，而你使用<code class="fe lt lu lv lw b">useEffect</code>进行滚动，你仍然可以看到同样的闪烁问题。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lx"><img src="../Images/9442f2df5626a988059fd292aeb4dff6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZG5gg_OGCTXcnwl-ODZvBA.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk"><strong class="bd ly"><em class="oi">useEffect vs useLayoutEffect in React 17 — click event</em></strong></figcaption></figure><p id="c5db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了React 18 (下面的gif)<strong class="ky ir">，</strong>如果用户点击一个按钮添加一条新消息，即使有了<code class="fe lt lu lv lw b">useEffect</code>，你也能“免费”获得平滑滚动。这是你应该保持你的npm包最新的另一个原因。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lx"><img src="../Images/2118cc3a9d316e24c7668d2a12fe7f99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*hOOcBaEofCMb8fIvD9ieUA.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk"><strong class="bd ly"><em class="oi">useEffect vs useLayoutEffect in React 18— click event</em></strong></figcaption></figure></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="81de" class="lz ma iq bd mb mc od me mf mg oe mi mj jw of jx ml jz og ka mn kc oh kd mp mq bi translated"><strong class="ak">结论</strong></h1><p id="d8c0" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated"><code class="fe lt lu lv lw b">useEffect</code>和<code class="fe lt lu lv lw b">useLayoutEffect</code> React挂钩具有相同的签名，它们都用于副作用。区别在于他们何时开火。在浏览器绘制之前,<code class="fe lt lu lv lw b">useLayoutEffect</code>钩子触发(在用户可以看到视觉变化之前)。浏览器绘画后会触发<code class="fe lt lu lv lw b">useEffect</code>钩子。当你直接更新DOM时应该使用<code class="fe lt lu lv lw b">useLayoutEffect</code>来避免闪烁。此外，记得让你的npm包和其他工具保持最新，以充分利用它们。</p><p id="0ad9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您喜欢这篇文章，请关注我，了解更多关于React、JavaScript、TypeScript等开发的技巧！🚀</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/6f883c10aad9d2642afb19e7f30c5625.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/0*XdobK8LiIaCIEp4N.gif"/></div></figure><h2 id="cb09" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated"><strong class="ak"> GitHub </strong></h2><p id="d2ee" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">你可以在GitHub上找到这篇文章中用于gif的React应用程序。请随意尝试钩子和不同的React版本！💪</p><div class="ok ol gp gr om on"><a href="https://github.com/pixochi/use-effect-vs-use-layout-effect-react-hooks" rel="noopener  ugc nofollow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd ir gy z fp os fr fs ot fu fw ip bi translated">GitHub-pix ochi/use-effect-vs-use-layout-effect-react-hooks</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">react Hooks——use effect与useLayoutEffect，并给出一个真实的例子</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">github.com</p></div></div></div></a></div><h2 id="8d68" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">成为会员</h2><p id="a982" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated"><em class="ls">如果你喜欢阅读这样的故事，并想支持我成为一名作家，</em> <a class="ae kv" href="https://jakub-kozak.medium.com/membership" rel="noopener"> <em class="ls">考虑报名成为一名中等会员</em> </a> <em class="ls">。每月5美元，你可以无限制地阅读媒体上的故事。如果你</em> <a class="ae kv" href="https://jakub-kozak.medium.com/membership" rel="noopener"> <em class="ls">用我的链接</em> </a> <em class="ls">注册，我会赚一小笔佣金</em>🙌</p><div class="ok ol gp gr om on"><a href="https://jakub-kozak.medium.com/membership" rel="noopener follow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd ir gy z fp os fr fs ot fu fw ip bi translated">通过我的推荐链接加入Medium雅各布·科萨克</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">阅读雅各布·科萨克(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">jakub-kozak.medium.com</p></div></div><div class="ow l"><div class="ox l oy oz pa ow pb kp on"/></div></div></a></div><h2 id="b2d6" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">工作机会——来加入我吧</h2><p id="355f" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我在T21的团队正在寻找更多的开发者！你有使用React和Ruby on Rails的经验吗？那就不要犹豫，马上申请吧:<a class="ae kv" href="https://www.tjekvik.com/careers" rel="noopener ugc nofollow" target="_blank">https://www.tjekvik.com/careers</a>。你可以在欧洲的任何地方工作！🌍</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><div class="kg kh ki kj gt on"><a href="https://jakub-kozak.medium.com/10-best-vs-code-extensions-for-development-with-react-bb1bc9851818" rel="noopener follow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd ir gy z fp os fr fs ot fu fw ip bi translated">使用React进行开发的10个最佳代码扩展</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">使用JavaScript和TypeScript改善您的开发人员体验</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">jakub-kozak.medium.com</p></div></div><div class="ow l"><div class="pc l oy oz pa ow pb kp on"/></div></div></a></div><div class="ok ol gp gr om on"><a href="https://jakub-kozak.medium.com/stop-using-for-conditional-rendering-in-react-a0f7b96200f8" rel="noopener follow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd ir gy z fp os fr fs ot fu fw ip bi translated">停止在React中使用“&amp;&amp;”进行条件渲染</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">通过在React组件中不使用` &amp;&amp; '来避免错误</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">jakub-kozak.medium.com</p></div></div><div class="ow l"><div class="pd l oy oz pa ow pb kp on"/></div></div></a></div><div class="ok ol gp gr om on"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-use-react-context-with-hooks-for-global-state-management-8d7d3526c5af"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd ir gy z fp os fr fs ot fu fw ip bi translated">如何使用带有钩子的React上下文进行全局状态管理</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">用React的useContext创建一个自定义上下文挂钩</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ow l"><div class="pe l oy oz pa ow pb kp on"/></div></div></a></div><div class="ok ol gp gr om on"><a href="https://medium.com/swlh/best-moment-js-alternatives-5dfa6861a1eb" rel="noopener follow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd ir gy z fp os fr fs ot fu fw ip bi translated">最佳时刻。JS替代方案</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">比较大小、性能、类型脚本支持等</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">medium.com</p></div></div><div class="ow l"><div class="pf l oy oz pa ow pb kp on"/></div></div></a></div><div class="ok ol gp gr om on"><a href="https://medium.com/swlh/how-to-build-a-chrome-extension-with-react-typescript-and-webpack-92e806ce2e16" rel="noopener follow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd ir gy z fp os fr fs ot fu fw ip bi translated">如何使用React、TypeScript和Webpack构建Chrome扩展</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">从创建样板文件到发布Chrome网络商店的完整扩展</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">medium.com</p></div></div><div class="ow l"><div class="pg l oy oz pa ow pb kp on"/></div></div></a></div></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="5eab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">更多内容请看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ls">plain English . io</em></strong></a><em class="ls">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ls">免费周报</em> </strong> </a> <em class="ls">。关注我们关于</em><a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ls">Twitter</em></strong></a><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ls">LinkedIn</em></strong></a><em class="ls"/><a class="ae kv" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ls">YouTube</em></strong></a><em class="ls"/><a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ls">不和</em> </strong> </a> <em class="ls">。</em></p></div></div>    
</body>
</html>