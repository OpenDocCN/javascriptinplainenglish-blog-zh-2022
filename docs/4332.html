<html>
<head>
<title>React Lazy Load &amp; Suspense For Better Performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对延迟加载和暂停做出反应，以获得更好的性能</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-lazy-load-suspense-for-better-performance-2458735b980e?source=collection_archive---------13-----------------------#2022-11-21">https://javascript.plainenglish.io/react-lazy-load-suspense-for-better-performance-2458735b980e?source=collection_archive---------13-----------------------#2022-11-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="97c9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">向您最终用户注入不必要的代码会导致性能泄漏，需要加载更多的代码，即使实际上只需要很少一部分代码。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/dab2f2c73cde89d43acde7c54d6cbb2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cYrpFgnICFSzx6U_qz_sfQ.png"/></div></div></figure></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="e634" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated">惰性负载——为什么它如此强大？</h1><p id="73b8" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">React应用程序可以轻松增长，可以添加越来越多的组件，这些组件可以包含10-500行代码或更多(不推荐)，第三方请求等等。即使最终用户页面不需要加载每个组件，也会降低React应用程序的性能，损害用户体验。</p><h2 id="1305" class="mm kz iq bd la mn mo dn le mp mq dp li lz mr ms lk md mt mu lm mh mv mw lo mx bi translated">加载组件而不加载惰性负载</h2><pre class="kg kh ki kj gt my mz na bn nb nc bi"><span id="01f9" class="nd kz iq mz b be ne nf l ng nh">import React from 'react';<br/>import GalleryComponent from './GalleryComponent'<br/><br/>const HomeComponent = () =&gt; (<br/>  &lt;div&gt;<br/>    &lt;GalleryComponent /&gt;<br/>  &lt;/div&gt;<br/>)</span></pre><h2 id="1220" class="mm kz iq bd la mn mo dn le mp mq dp li lz mr ms lk md mt mu lm mh mv mw lo mx bi translated">用惰性负载加载组件</h2><pre class="kg kh ki kj gt my mz na bn nb nc bi"><span id="d6c5" class="nd kz iq mz b be ne nf l ng nh">import React, { lazy } from 'react';<br/><br/>const GalleryComponent = lazy(() =&gt; import('./GalleryComponent'));<br/><br/>const HomeComponent = () =&gt; (<br/>  &lt;div&gt;<br/>    &lt;GalleryComponent /&gt;<br/>  &lt;/div&gt;<br/>)</span></pre><p id="33b1" class="pw-post-body-paragraph lq lr iq ls b lt ni jr lv lw nj ju ly lz nk mb mc md nl mf mg mh nm mj mk ml ij bi translated">如你所见，添加惰性负载非常简单，也非常值得。只有当<code class="fe nn no np mz b">&lt;HomeComponent/&gt;</code>组件被加载时，<code class="fe nn no np mz b">&lt;GalleryComponent /&gt;</code>也会被加载。</p><blockquote class="nq"><p id="1b46" class="nr ns iq bd nt nu nv nw nx ny nz ml dk translated">这种称为<strong class="ak">动态导入</strong>的导入类型，这样我们就可以使用这种方法在组件级别上轻松地对<strong class="ak">React应用程序进行代码拆分</strong>。</p></blockquote><h1 id="85dd" class="ky kz iq bd la lb oa ld le lf ob lh li jw oc jx lk jz od ka lm kc oe kd lo lp bi translated">延迟加载和暂停组合</h1><p id="a3cd" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">既然我们知道了惰性负载是如何工作的，以及它如何帮助我们反应应用程序性能和用户体验，为什么我们还需要反应悬念呢？</p><p id="385e" class="pw-post-body-paragraph lq lr iq ls b lt ni jr lv lw nj ju ly lz nk mb mc md nl mf mg mh nm mj mk ml ij bi translated">让我们看一下我们之前使用的同一个例子，但是现在让我们假设<code class="fe nn no np mz b">&lt;GalleryComponent /&gt;</code>包含一个问题，比如:API请求需要几秒钟返回结果，JavaScript负载大，设备较弱或者网络连接不好。</p><pre class="kg kh ki kj gt my mz na bn nb nc bi"><span id="8149" class="nd kz iq mz b be ne nf l ng nh">import React, { lazy } from 'react';<br/><br/>/* <br/>  - GalleryComponent contain API request / large JavaScript payload. <br/>*/<br/>const GalleryComponent = lazy(() =&gt; import('./GalleryComponent'));<br/><br/>const HomeComponent = () =&gt; (<br/>  &lt;div&gt;<br/>    &lt;GalleryComponent /&gt;<br/>  &lt;/div&gt;<br/>)</span></pre><p id="9767" class="pw-post-body-paragraph lq lr iq ls b lt ni jr lv lw nj ju ly lz nk mb mc md nl mf mg mh nm mj mk ml ij bi translated">在这种情况下，用户将会看到几秒钟的空白区域，直到从<code class="fe nn no np mz b">&lt;GalleryComponent /&gt;</code>收到结果，这不利于用户体验，这就是React悬念的目的。</p><p id="aeed" class="pw-post-body-paragraph lq lr iq ls b lt ni jr lv lw nj ju ly lz nk mb mc md nl mf mg mh nm mj mk ml ij bi translated">反应暂停帮助我们向用户显示一条消息或另一个组件，告诉用户该组件正在加载，因此用户会在加载延迟时看到这条消息。</p><pre class="kg kh ki kj gt my mz na bn nb nc bi"><span id="16b1" class="nd kz iq mz b be ne nf l ng nh">import React, { lazy, Suspense } from 'react';<br/><br/>const GalleryComponent = lazy(() =&gt; import('./GalleryComponent'));<br/><br/>const renderLoader = () =&gt; &lt;p&gt;Loading...&lt;/p&gt;;<br/><br/>const DetailsComponent = () =&gt; (<br/>  &lt;Suspense fallback={renderLoader()}&gt;<br/>    &lt;GalleryComponent /&gt;<br/>  &lt;/Suspense&gt;<br/>)</span></pre><p id="a1d9" class="pw-post-body-paragraph lq lr iq ls b lt ni jr lv lw nj ju ly lz nk mb mc md nl mf mg mh nm mj mk ml ij bi translated">暂停接收一个回退组件，它将在加载延迟时向用户显示。这样，当<code class="fe nn no np mz b">&lt;GalleryComponent /&gt;</code>加载时，用户将会看到“正在加载…”的消息。</p><h2 id="1b4a" class="mm kz iq bd la mn mo dn le mp mq dp li lz mr ms lk md mt mu lm mh mv mw lo mx bi translated">挂起多个组件</h2><pre class="kg kh ki kj gt my mz na bn nb nc bi"><span id="58fe" class="nd kz iq mz b be ne nf l ng nh">import React, { lazy, Suspense } from 'react';<br/><br/>const GalleryComponent = lazy(() =&gt; import('./GalleryComponent'));<br/>const MoreGalleryComponent = lazy(() =&gt; import('./MoreGalleryComponent'));<br/>const GalleryInfoComponent = lazy(() =&gt; import('./GalleryInfoComponent'));<br/><br/><br/>const renderLoader = () =&gt; &lt;p&gt;Loading...&lt;/p&gt;;<br/><br/>const DetailsComponent = () =&gt; (<br/>  &lt;Suspense fallback={renderLoader()}&gt;<br/>    &lt;GalleryComponent /&gt;<br/>    &lt;MoreGalleryComponent /&gt;<br/>    &lt;GalleryInfoComponent /&gt;<br/>  &lt;/Suspense&gt;<br/>)</span></pre><p id="8adf" class="pw-post-body-paragraph lq lr iq ls b lt ni jr lv lw nj ju ly lz nk mb mc md nl mf mg mh nm mj mk ml ij bi translated">这里我们可以看到React Suspense是多么的<strong class="ls ir">非常有用</strong>,“正在加载…”消息将一直显示给用户，直到所有组件都已获取完毕，只有这样用户才能<strong class="ls ir">看到它们同时显示</strong>。</p></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><p id="d2ae" class="pw-post-body-paragraph lq lr iq ls b lt ni jr lv lw nj ju ly lz nk mb mc md nl mf mg mh nm mj mk ml ij bi translated">感谢你到目前为止的阅读，如果你喜欢这样的内容，并且你想支持我作为一个程序员和作家写更多这样的文章，尽你所能提高这篇文章的排名和<a class="ae of" href="https://medium.com/membership/@nissimzarur" rel="noopener"> <strong class="ls ir"> <em class="og">请用我的链接注册成为Medium的会员(5美元/月订阅)，你将可以无限制地访问Medium上的所有内容。</em> </strong> </a></p><p id="6f58" class="pw-post-body-paragraph lq lr iq ls b lt ni jr lv lw nj ju ly lz nk mb mc md nl mf mg mh nm mj mk ml ij bi translated"><em class="og">更多内容看</em> <a class="ae of" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ls ir"> <em class="og">说白了就是io </em> </strong> </a> <em class="og">。报名参加我们的</em> <a class="ae of" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ls ir"> <em class="og">免费周报</em> </strong> </a> <em class="og">。关注我们关于</em><a class="ae of" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ls ir"><em class="og">Twitter</em></strong></a><em class="og">和</em><a class="ae of" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ls ir"><em class="og">LinkedIn</em></strong></a><em class="og">。查看我们的</em> <a class="ae of" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ls ir"> <em class="og">社区不和谐</em> </strong> </a> <em class="og">加入我们的</em> <a class="ae of" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="ls ir"> <em class="og">人才集体</em> </strong> </a> <em class="og">。</em></p></div></div>    
</body>
</html>