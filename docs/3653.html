<html>
<head>
<title>Let’s Understand Chrome V8: Compiler Workflow: Parse, AST, and Token</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们来理解Chrome V8:编译器工作流:解析、AST和令牌</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/lets-understand-chrome-v8-compiler-workflow-parse-ast-and-token-6aa581eec70e?source=collection_archive---------7-----------------------#2022-09-14">https://javascript.plainenglish.io/lets-understand-chrome-v8-compiler-workflow-parse-ast-and-token-6aa581eec70e?source=collection_archive---------7-----------------------#2022-09-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="2dde" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">第23章:生成AST的工作流程</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/2229cb027639f57877eb360bf75cd927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yCFNVeb4ds9hl7WF-NP-kw.png"/></div></div></figure><p id="e057" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="lk">欢迎阅读</em> <a class="ae ll" href="https://medium.com/@huidou" rel="noopener"> <em class="lk">其他章节让我们来了解一下Chrome V8 </em> </a></p><p id="6c66" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在本文中，我将讨论Parse、AST和Token是如何协同工作的，并引导您完成编译以及观察和查看细节。具体来说，您将看到如何扫描标记，以及Parse如何使用标记来生成AST树。</p><h1 id="ef98" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated"><strong class="ak"> 1。Parse_Info </strong></h1><p id="1b3c" class="pw-post-body-paragraph ko kp in kq b kr me jo kt ku mf jr kw kx mg kz la lb mh ld le lf mi lh li lj ig bi translated">下面是Parse_Info类。它是解析器的内核类，管理JavaScript源代码和AST树。简单地说，解析器的输入是JavaScript代码，输出是AST树。但是请注意，从V8加载JavaScript源代码的那一刻起，代码就已经被编码为UTF-16了。</p><p id="a3bc" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">让我们进入Parse_Info。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="0122" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在上面的代码中，第5行是AST工厂方法；第13行文字返回AST树；第17行flags_显示了函数没有被优化的原因；第33行literal_负责保存完整的AST树。正如我提到的，AST是解析器的一个输出，所以如果您想详细查看解析器的工作流程，您只需调试它并继续查看成员变量literal_，通过这种方式，您将看到AST的生成以及工厂方法是如何被调用的。</p><h1 id="d4ef" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated"><strong class="ak"> 2。装配树</strong></h1><p id="011f" class="pw-post-body-paragraph ko kp in kq b kr me jo kt ku mf jr kw kx mg kz la lb mh ld le lf mi lh li lj ig bi translated">正如我上面提到的，变量literal_代表一个AST树，它的声明类是FunctionLiteral。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="edaa" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我要强调的是，AST粒度是一个函数，换句话说，一个JavaScript函数只对应一棵AST树。在上面的代码中，第26行成员变量body_保存了AST正文，如果您对细节有疑问，请浏览正文。第4–15行将语言模式设置为严格或宽松。</p><p id="89db" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">再来看看第18行FunctionKind。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="de57" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">您应该看到函数种类不是JavaScript书中的类型，因为函数种类只是表示编译器中的函数种类。有关详细信息，请参见编译器书籍。</p><h1 id="33e5" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated"><strong class="ak"> 3。AST节点类型</strong></h1><p id="b543" class="pw-post-body-paragraph ko kp in kq b kr me jo kt ku mf jr kw kx mg kz la lb mh ld le lf mi lh li lj ig bi translated">以下宏模板是不完整的节点类型列表。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="b1d7" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在上面的代码中，参见第34行，它将所有的模板组织在一起，为作为编译器管道一部分的解析器中的JavaScript函数生成一个AST树。通过宏AST_NODE_LIST，我们应该看到一个AST中有三个类型，每个类型又有更多的子类型。所有这些类型都对应于我们的JavaScript代码，并准确地表示语义。</p><h1 id="6a3b" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated"><strong class="ak"> 4。令牌类型</strong></h1><p id="60b2" class="pw-post-body-paragraph ko kp in kq b kr me jo kt ku mf jr kw kx mg kz la lb mh ld le lf mi lh li lj ig bi translated">以下宏模板是不完整的标记列表。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="d6b9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">令牌在扫描器中使用，扫描器是V8编译器的一部分，负责将JavaScript代码转换成令牌。举个简单的例子，见第5行，令牌类型是句点，对应JavaScript代码中的点，这意味着扫描器会把看到的每个点都转换成句点令牌。同样，第10行和第12行是轻括号和右括号，用于描述JavaScript代码中的<code class="fe ml mm mn mo b">(</code>和<code class="fe ml mm mn mo b">)</code>。所以在每一行，每一个以T开头的宏中，第一个参数是token类型，第二个是类型对应的词法，最后一个数字是token优先级，数字越小，token越高，会越早转换。</p><h1 id="a763" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated"><strong class="ak"> 5。有限状态自动化</strong></h1><p id="907a" class="pw-post-body-paragraph ko kp in kq b kr me jo kt ku mf jr kw kx mg kz la lb mh ld le lf mi lh li lj ig bi translated">在大多数编译器中，词法分析器和语法分析器使用FSA(有限状态自动化)来分析源代码。在V8中，它使用switch-case来实现FSA，让我们看看lexer FSA，即令牌扫描器。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="bdd1" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">ScanSingleToken()负责生成令牌。在第8–40行中，每个案例都是一个令牌。</p><p id="f6bc" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">下面的代码是解析器FSA，它使用令牌并为AST树生成节点。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="6bc4" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">最后，我认为FSA是编译器的一个重要基础，值得更深入地研究。</p><p id="5fee" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="lk">好了，这部分就到此为止了。下次再见，保重！</em></p><p id="4bc7" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果你有任何问题，请联系我。<strong class="kq io">微信</strong> : qq9123013 <strong class="kq io">邮箱</strong>:<a class="ae ll" href="mailto:v8blink@outlook.com" rel="noopener ugc nofollow" target="_blank">v8blink@outlook.com</a></p></div><div class="ab cl mp mq hr mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ig ih ii ij ik"><p id="5d5d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="lk">更多内容请看</em><a class="ae ll" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="lk">plain English . io</em></strong></a><em class="lk">。报名参加我们的</em> <a class="ae ll" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lk">免费周报</em> </strong> </a> <em class="lk">。关注我们关于</em><a class="ae ll" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="lk">Twitter</em></strong></a><a class="ae ll" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="lk">LinkedIn</em></strong></a><em class="lk"/><a class="ae ll" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="lk">YouTube</em></strong></a><em class="lk"/><a class="ae ll" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="lk">不和</em> </strong> </a> <em class="lk">。对增长黑客感兴趣？检查</em> <a class="ae ll" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lk">电路</em> </strong> </a> <em class="lk">。</em></p></div></div>    
</body>
</html>