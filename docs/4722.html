<html>
<head>
<title>Understanding npm install, clean-install, and update</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解npm安装、全新安装和更新</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/5-examples-to-understand-important-npm-commands-7f9a43e7a90b?source=collection_archive---------9-----------------------#2022-12-27">https://javascript.plainenglish.io/5-examples-to-understand-important-npm-commands-7f9a43e7a90b?source=collection_archive---------9-----------------------#2022-12-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e480" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">重要npm命令的简单指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9f9e5f051495532c334795b0f90e6cb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TgwU1T4q-L7CeW7Vl2ctFA.jpeg"/></div></div></figure><p id="7e1c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们知道我们必须运行<code class="fe ln lo lp lq b">npm install</code>来安装依赖项。但是当我们运行<code class="fe ln lo lp lq b">npm install</code>时，到底会发生什么呢？如果我们竞选<code class="fe ln lo lp lq b">npm update</code>会发生什么？如果已经有了命令<code class="fe ln lo lp lq b">npm install</code>，为什么还有<code class="fe ln lo lp lq b">npm clean-install</code>？</p><h1 id="ed65" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">package.json和包锁. json</h1><p id="f83e" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">首先让我们明确一下package.json和package-lock.json的区别:</p><ul class=""><li id="7944" class="mo mp iq kt b ku kv kx ky la mq le mr li ms lm mt mu mv mw bi translated">package.json包含关于允许安装哪个版本的信息。这可能是一个精确的版本，但你经常会发现类似这样的东西:<code class="fe ln lo lp lq b">"examplePackage": ^4.16.0</code>。这告诉npm，最低版本要求是<code class="fe ln lo lp lq b">4.16.0</code>，所有次要版本和补丁版本直到<code class="fe ln lo lp lq b">&lt; 5.0.0</code>都是可以接受的。你可以在这里阅读语义版本<a class="ae mx" href="https://docs.npmjs.com/about-semantic-versioning" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="ec37" class="mo mp iq kt b ku my kx mz la na le nb li nc lm mt mu mv mw bi translated">package-lock.json总是包含关于包的确切版本的信息。例子:<code class="fe ln lo lp lq b">"examplePackage": 4.16.5</code></li></ul><h1 id="87d2" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">Npm安装和npm全新安装比较</h1><p id="a688" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">现在，当我们运行<code class="fe ln lo lp lq b">npm install</code>时会发生什么？</p><p id="5281" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这取决于运行该命令的目录中有哪些文件。让我们看一些案例。</p><h2 id="cfe2" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">案例1:不存在node_modules文件夹/包尚未安装/包锁. json存在</h2><p id="6198" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">假设我们下载了一个包含package.json和package-lock.json文件的存储库。node_modules文件夹通常从git中显式排除。因此，我们需要在本地安装依赖项。当我们运行<code class="fe ln lo lp lq b">npm install</code>时，package-lock.json中定义的依赖项的确切版本被安装。Npm下载模块并将它们添加到node_modules目录中，该目录是自动创建的。</p><pre class="kg kh ki kj gt np lq nq bn nr ns bi"><span id="a52c" class="nt ls iq lq b be nu nv l nw nx">added 1 package, and audited 2 packages in 577ms</span></pre><p id="2538" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们也可以在这里运行<code class="fe ln lo lp lq b">npm clean-install</code>。</p><p id="ef98" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ln lo lp lq b">npm clean-install</code>和<code class="fe ln lo lp lq b">npm install</code>一样，安装package-lock.json中定义的确切版本。</p><pre class="kg kh ki kj gt np lq nq bn nr ns bi"><span id="e343" class="nt ls iq lq b be nu nv l nw nx">added 1 package, and audited 2 packages in 518ms</span></pre><p id="154f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们假设examplePackage ist版本的最新版本<code class="fe ln lo lp lq b">4.17.0</code>。</p><p id="7984" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们的package.json包含信息<code class="fe ln lo lp lq b">"examplePackage": ^4.16.0</code>和我们的package-lock.json <code class="fe ln lo lp lq b">"examplePackage": 4.16.5</code>。</p><p id="d267" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这告诉我们有一个比当前安装的版本更新的版本，package.json中的版本规范允许我们升级。但是，npm安装或npm全新安装将准确安装版本<code class="fe ln lo lp lq b">4.16.5</code>，并且不会更新。</p><p id="ad94" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为此我们有命令<code class="fe ln lo lp lq b">npm update</code>。<code class="fe ln lo lp lq b">npm update</code>将检查每个包的最新版本，如果package.json允许，就安装它。因此，它会更新node_modules和package-lock.json中的文件</p><p id="974b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们区分<code class="fe ln lo lp lq b">npm install</code> / <code class="fe ln lo lp lq b">npm clean install</code>和<code class="fe ln lo lp lq b">npm update</code>的原因是因为我们希望安装与其他人推送至资源库的版本完全相同的版本。这也是为什么您将package-lock.json推送到您的存储库或者从存储库中取出的原因。</p><h2 id="e6ee" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">情况2:已经安装了具有允许版本/ package-lock.json的包</h2><p id="01d4" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">这种情况与前一种情况的唯一区别在于，这里已经安装了软件包。如果你在这样的目录中运行<code class="fe ln lo lp lq b">npm install</code>，什么都不会改变。</p><pre class="kg kh ki kj gt np lq nq bn nr ns bi"><span id="66ea" class="nt ls iq lq b be nu nv l nw nx">up to date, audited 2 packages in 403ms</span></pre><p id="a671" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">npm检查package.json中的包及其版本，并与package-lock.json中的已安装版本进行比较。由于已安装版本满足package.json的版本要求，因此不会安装任何内容。</p><p id="2169" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">命令的一个区别是<code class="fe ln lo lp lq b">npm clean-install</code>在重新安装package-lock.json中定义的所有包之前删除node_modules目录。</p><pre class="kg kh ki kj gt np lq nq bn nr ns bi"><span id="5952" class="nt ls iq lq b be nu nv l nw nx">added 1 package, and audited 2 packages in 559ms</span></pre><h2 id="f1dc" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">案例3:软件包已安装，但版本不允许package.json和package-lock.json中的版本不兼容</h2><p id="a359" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">如果手动更改package.json中的版本，就会出现这种情况。如同在代码编辑器中编辑文件一样。</p><p id="a633" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">比如说，我们把package.json从<code class="fe ln lo lp lq b">"examplePackage": ^4.16.0</code>改成<code class="fe ln lo lp lq b">"examplePackage": 4.16.0</code>。现在带有<code class="fe ln lo lp lq b">"examplePackage": 4.16.5</code>的package-lock.json不再有效。</p><p id="1c5e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这种情况下，在运行<code class="fe ln lo lp lq b">npm install</code>时，包管理器将会注意到这种不一致性，并将执行以下操作:</p><ul class=""><li id="838f" class="mo mp iq kt b ku kv kx ky la mq le mr li ms lm mt mu mv mw bi translated">在node_modules文件夹中安装package.json中指定的版本。</li><li id="828a" class="mo mp iq kt b ku my kx mz la na le nb li nc lm mt mu mv mw bi translated">更新package-lock.json中列出的版本</li></ul><p id="928c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ln lo lp lq b">Npm install</code>通常不写入package-lock.json(给定的package-lock.json已经存在，并且已经安装了包)。只有当您在package.json中手动更改包的版本，使package-lock.json中的版本不再匹配时，它才会这样做。与<code class="fe ln lo lp lq b">npm install</code>不同，<code class="fe ln lo lp lq b">npm clean-install</code>从不写入package-lock.json。如果您运行<code class="fe ln lo lp lq b">npm clean-install</code>并且package.json和package-lock.json中有不兼容的版本，npm将抛出一个错误，命令将停止执行。</p><p id="680b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在下面的例子中，package.json包含<code class="fe ln lo lp lq b">"typescript": "4.8.3”</code>，但是package-lock.json包含<code class="fe ln lo lp lq b">“4.9.3”</code>。运行<code class="fe ln lo lp lq b">npm clean-install</code>时，出现错误消息:</p><pre class="kg kh ki kj gt np lq nq bn nr ns bi"><span id="b401" class="nt ls iq lq b be nu nv l nw nx">Invalid: lock file's typescript@4.9.3 does not satisfy typescript@4.8.3</span></pre><p id="aad5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行<code class="fe ln lo lp lq b">npm install</code>时:</p><pre class="kg kh ki kj gt np lq nq bn nr ns bi"><span id="1679" class="nt ls iq lq b be nu nv l nw nx">changed 1 package, and audited 2 packages in 1s</span></pre><p id="0ecc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">正如npm输出和对package-lock.json文件的研究所确认的，版本被更改为<code class="fe ln lo lp lq b">"typescript": "4.8.3”</code>。</p><h2 id="71ca" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">案例4:缺少package-lock.json /缺少node_modules文件夹</h2><p id="c7e4" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">如果package-lock.json文件完全丢失，它会在运行<code class="fe ln lo lp lq b">npm install</code>时创建。在这种情况下，会安装package.json允许的最新可用软件包版本，并创建package-lock.json。</p><h2 id="963e" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">情况5:缺少package-lock.json / node_modules文件夹存在</h2><p id="bca6" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">与前一种情况的不同之处在于，该模块已经安装。和案例4一样，package-lock.json文件是在运行<code class="fe ln lo lp lq b">npm install</code>时生成的。</p><p id="1f09" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是，由于模块已经存在，npm不会安装任何新的东西，它只生成文件。Package-lock.json将包含与node_modules文件夹中的包版本相同的版本。</p><p id="7021" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当在没有package-lock.json文件的目录中运行<code class="fe ln lo lp lq b">npm clean-install</code>时，会抛出一个错误。</p><pre class="kg kh ki kj gt np lq nq bn nr ns bi"><span id="cec8" class="nt ls iq lq b be nu nv l nw nx">The `npm ci` command can only install with an existing package-lock.json or<br/>npm-shrinkwrap.json with lockfileVersion &gt;= 1. Run an install with npm@5 or<br/>later to generate a package-lock.json file, then try again.</span></pre><h1 id="f97b" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">摘要</h1><p id="3633" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">当在一个项目中与几个开发人员一起工作时，每个人都安装相同版本的npm模块是很重要的。这就是为什么package.json和package-lock.json都应该提交给git的原因。使用<code class="fe ln lo lp lq b">npm install</code>或<code class="fe ln lo lp lq b">npm clean-install</code>时，如果尚未安装package-lock.json中指定的确切版本，则会安装这些版本。只有在以下情况下才会安装新版本:A)新版本可用；B)package . JSON中的版本规范允许更新的版本；C)在没有package-lock.json文件的情况下使用<code class="fe ln lo lp lq b">npm update</code>或<code class="fe ln lo lp lq b">npm install</code>。</p><p id="6058" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ln lo lp lq b">npm clean-install</code>比<code class="fe ln lo lp lq b">npm install</code>更严格，因为当发现不一致的版本时，它会抛出一个错误，并且不允许在没有package-lock.json文件的情况下安装。</p><p id="19e5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="ny">更多内容看</em> <a class="ae mx" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="ny">说白了。报名参加我们的</em> <a class="ae mx" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="ny">免费周报</em> </strong> </a> <em class="ny">。关注我们关于</em> <a class="ae mx" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="ny">推特</em></strong></a><a class="ae mx" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="ny">LinkedIn</em></strong></a><em class="ny"/><a class="ae mx" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="ny">YouTube</em></strong></a><em class="ny"/><a class="ae mx" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="ny">不和</em> </strong> </a> <strong class="kt ir"> <em class="ny">。</em>T51】</strong></strong></a></p><p id="de5f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> <em class="ny">对缩放您的软件启动感兴趣</em> </strong> <em class="ny">？检查</em> <a class="ae mx" href="https://circuit.ooo/?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="ny">电路</em> </strong> </a> <em class="ny">。</em></p></div></div>    
</body>
</html>