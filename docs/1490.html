<html>
<head>
<title>The Right Way to Use LocalStorage in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中使用LocalStorage的正确方法</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-right-way-to-use-localstorage-in-javascript-4e6e24be5ec1?source=collection_archive---------12-----------------------#2022-03-28">https://javascript.plainenglish.io/the-right-way-to-use-localstorage-in-javascript-4e6e24be5ec1?source=collection_archive---------12-----------------------#2022-03-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="2c50" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">用不到5分钟的时间解释了LocalStorage API</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/990f180c436ab755c556a9d95792876a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qKvxVZ3icNFgriPKH-z3ww.png"/></div></div></figure><p id="5b66" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">作为web开发人员，我们都遇到过这样的情况，我们希望保存一条信息，如用户数据、主题偏好或选定的过滤器，以便在不同的浏览器会话中为用户提供一致的体验。</p><p id="37be" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这正是LocalStorage API发挥作用的地方。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/521798959c590bddde6e7f98a190fe34.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*JXto_IEuewQLwm8V.gif"/></div></figure><p id="03b7" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">坚持住坚持住。让我们从基础开始</p><h1 id="d1e0" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">什么是LocalStorage？</h1><p id="65ab" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">web浏览器的LocalStorage API允许跨浏览器会话存储和读取存储的数据。</p><p id="5f78" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">让我们来分解一下:</p><ul class=""><li id="f8ab" class="mi mj in kq b kr ks ku kv kx mk lb ml lf mm lj mn mo mp mq bi translated">它允许我们将数据存储到永久存储器中，这样当我们重新启动浏览器甚至计算机时，数据仍然可用。</li><li id="bd79" class="mi mj in kq b kr mr ku ms kx mt lb mu lf mv lj mn mo mp mq bi translated">它将数据存储在该源的本地，这意味着您只能对当前源的本地存储读取/写入数据，即以下组合(协议+域+端口)</li></ul><p id="22d3" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="mw">需要注意的是，本地存储器开始清空，一旦关闭最后一个私有标签，私有会话期间添加的项目将被清除。</em></p><h1 id="2ec6" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">本地存储的内部</h1><p id="ee65" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">LocalStorage是一个键值存储，这意味着它根据提供的键存储给定值，就像一个JavaScript对象，但<em class="mw">是持久的</em>。</p><p id="70a4" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">键值存储提供了快速的查找和写入，因为它的结构使得寻找正确的元素总是要花费恒定的时间(除了做I/O的时间)。这意味着本地存储中有数百个键不会减慢查找速度。(不知道你为什么会这么做。)</p><p id="3de7" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">随着它的速度而来的是一个限制，即<code class="fe mx my mz na b">key</code>和<code class="fe mx my mz na b">value</code>都必须是存储在本地存储器中的字符串。嗯，这并不是很难做到。</p><p id="f88a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="mw">目前，Web存储规范允许每个浏览器的每个应用程序最多存储5MB。</em></p><h1 id="59c1" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">如何使用LocalStorage？</h1><p id="1c4e" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">幸运的是，LocalStorage API的接口相当简单。</p><p id="b2bf" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">让我们来看看如何在本地存储上进行创建/读取/更新/删除等基本操作，</p><h1 id="4e2d" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">写入数据</h1><p id="fdf6" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated"><code class="fe mx my mz na b">localStorage.setItem()</code>接受一个字符串作为<code class="fe mx my mz na b">key</code>，<code class="fe mx my mz na b">value</code>也接受一个字符串。</p><pre class="kd ke kf kg gt nb na nc nd aw ne bi"><span id="835b" class="nf lm in na b gy ng nh l ni nj">localStorage.setItem('&lt;key&gt;', '&lt;value&gt;')</span></pre><p id="fd2d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">上面的代码行将根据给定的键写入值，如果已经存在，现有的值将被覆盖。</p><h1 id="1d53" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">读取数据</h1><p id="3ecd" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">为了读取存储的信息，我们需要提供<code class="fe mx my mz na b">key</code></p><pre class="kd ke kf kg gt nb na nc nd aw ne bi"><span id="b036" class="nf lm in na b gy ng nh l ni nj">const value = localStorage.getItem('&lt;key&gt;')<br/>// value will be null or string</span></pre><p id="b129" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果在给定的<code class="fe mx my mz na b">key</code>中没有找到数据，则返回<code class="fe mx my mz na b">null</code>。</p><h2 id="e14e" class="nf lm in bd ln nk nl dn lr nm nn dp lv kx no np lx lb nq nr lz lf ns nt mb nu bi translated">在LocalStorage中存储对象</h2><p id="510e" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">你可能想知道，“字符串！天哪，我该拿一个物体怎么办？”别担心。</p><p id="e3b4" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们仍然被允许存储对象的序列化版本，</p><pre class="kd ke kf kg gt nb na nc nd aw ne bi"><span id="9162" class="nf lm in na b gy ng nh l ni nj">    // storing an object in LocalStorage<br/>    const user = { name: 'anshuman_bhardwaj' }<br/>    localStorage.setItem('user', JSON.stringify(user))</span><span id="fa94" class="nf lm in na b gy nv nh l ni nj">    // reading the object from LocalStorage<br/>    const strinifiedUser = localStorage.getItem('user')<br/>    if(strinifiedUser) {<br/>      const retrivedUser = JSON.parse(strinifiedUser)<br/>    }</span></pre><h1 id="9096" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">删除数据</h1><p id="c2e1" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">有两种以编程方式从LocalStorage中移除存储数据的方法</p><h2 id="c09b" class="nf lm in bd ln nk nl dn lr nm nn dp lv kx no np lx lb nq nr lz lf ns nt mb nu bi translated"><code class="fe mx my mz na b">removeItem</code></h2><p id="3452" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">如果您已经知道要删除哪个项目，那么<code class="fe mx my mz na b">removeItem</code>就是正确的选择。</p><pre class="kd ke kf kg gt nb na nc nd aw ne bi"><span id="cb6c" class="nf lm in na b gy ng nh l ni nj">localStorage.removeItem('&lt;key&gt;')</span></pre><h2 id="cd10" class="nf lm in bd ln nk nl dn lr nm nn dp lv kx no np lx lb nq nr lz lf ns nt mb nu bi translated">清楚的</h2><p id="33db" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">如果您想从存储器中取出所有钥匙，那么<code class="fe mx my mz na b">clear</code>是<em class="mw">明确的</em>选择。(你看到我在那里做了什么吗？)</p><pre class="kd ke kf kg gt nb na nc nd aw ne bi"><span id="6c98" class="nf lm in na b gy ng nh l ni nj">localStorage.clear()</span></pre><p id="14bd" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">虽然听起来可能很刺激，但是<code class="fe mx my mz na b">clear</code>方法不应该使用太多，因为它会清除<strong class="kq io">所有的</strong>而不仅仅是您添加的<em class="mw">项。</em></p><p id="9b64" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这意味着，如果您正在与使用LocalStorage的服务进行交互，例如像Firebase Auth或Okta这样的身份验证模块，清除LocalStorage也会删除这些服务输入的数据，这将破坏它们的行为。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/9b8849a899827a26eb99b2c37a09855f.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/0*QX2IYu2bFoebU-v1.gif"/></div></figure><p id="aea1" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">是啊，别担心，我抓住你了。</p><p id="1d6d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在计算机科学中，我们应该始终关注封装，也就是说，我们应该隐藏信息或者封装信息。嗯，这正是我们要解决这个小问题的方法。</p><p id="ebb1" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="mw">以下是我的朋友&amp;同事</em> <a class="ae nx" href="https://www.linkedin.com/in/ryanirilli" rel="noopener ugc nofollow" target="_blank"> <em class="mw">莱恩</em> </a> <em class="mw">给我的提示。</em></p><h1 id="b151" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">在本地存储中创建和使用命名空间？</h1><p id="b933" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">我们可以通过将我们所有的数据放在一个预定义的&amp;唯一的键或名称空间下来应用封装的原则。这将使我们能够对应用程序的其他部分隐藏我们的(我们无法控制的)数据，并避免我们错误地更新我们不应该更新的数据。</p><p id="dbdc" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">“听起来不错，但我们该怎么做？”，你可能想知道。</p><p id="4855" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">嗯，它比听起来更简单，通过将整个应用程序状态封装在一个键下，而不是为每条信息使用一个新的键来工作。</p><h2 id="2990" class="nf lm in bd ln nk nl dn lr nm nn dp lv kx no np lx lb nq nr lz lf ns nt mb nu bi translated">第一步</h2><p id="6b04" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">创建一个关键的、可预测的但独特的。一个很好的例子是[您的-app-name]+[某个唯一的-token]，即DEV-007</p><h2 id="92fd" class="nf lm in bd ln nk nl dn lr nm nn dp lv kx no np lx lb nq nr lz lf ns nt mb nu bi translated">第二步</h2><p id="424a" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">在存储信息时，我们从LocalStorage中读取命名空间值，对其进行反序列化，根据对象中的键更新该值，然后在写入LocalStorage之前再次对其进行序列化。</p><h2 id="3a79" class="nf lm in bd ln nk nl dn lr nm nn dp lv kx no np lx lb nq nr lz lf ns nt mb nu bi translated">第三步</h2><p id="8c40" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">在读取信息时，我们从LocalStorage中读取命名空间值，对其进行反序列化，并从对象中返回键值。</p><p id="a993" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="mw">这样，我们就把命名空间当作自己的小LocalStorage。</em></p><p id="57a3" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">下面是上面的代码实现:</p><pre class="kd ke kf kg gt nb na nc nd aw ne bi"><span id="a8d0" class="nf lm in na b gy ng nh l ni nj">const NAMESPACE = "DEV-007";</span><span id="5157" class="nf lm in na b gy nv nh l ni nj">function writeToStorage(key, value) {<br/>  const serializedData = localStorage.getItem(NAMESPACE);<br/>  const data = serializedData ? JSON.parse(serializedData) : {};<br/>  data[key] = value;<br/>  localStorage.setItem(NAMESPACE, JSON.stringify(data));<br/>}</span><span id="28c6" class="nf lm in na b gy nv nh l ni nj">function readFromStorage(key) {<br/>  const serializedData = localStorage.getItem(NAMESPACE);<br/>  const data = JSON.parse(serializedData);<br/>  return data ? data[key] : undefined;<br/>}</span><span id="0f39" class="nf lm in na b gy nv nh l ni nj">function clear() {<br/>  localStorage.setItem(NAMESPACE, JSON.stringify({}));<br/>}</span><span id="485c" class="nf lm in na b gy nv nh l ni nj">function removeItem(key) {<br/>  const serializedData = localStorage.getItem(NAMESPACE);<br/>  const data = serializedData ? JSON.parse(serializedData) : {};<br/>  delete data[key]<br/>  localStorage.setItem(NAMESPACE, JSON.stringify(data));<br/>}</span></pre><p id="3827" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe mx my mz na b">clear</code>和<code class="fe mx my mz na b">removeItem</code>的上述实现使用安全，解决了我们的问题。</p><p id="b373" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">不用担心，您不必编写自己的实现，因为有一个npm包<a class="ae nx" href="https://www.npmjs.com/package/store2" rel="noopener ugc nofollow" target="_blank"> store2 </a>可以解决上述问题，并提供更智能的本地存储。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/e172790057061f748389bd6c03332e9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/0*f3CJ-YpsqbBGsIGd.gif"/></div></figure><p id="bbc0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">今天到此为止。如果你有任何问题或建议，请在下面的评论中提出。<br/>更多此类内容，请<a class="ae nx" href="https://twitter.com/sun_anshuman" rel="noopener ugc nofollow" target="_blank">在Twitter上关注我</a></p><p id="e899" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="mw">下次见！</em></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/a789ea41091acb0ade02655803d805fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/0*YDvw3wP4Hzye7hQ2.gif"/></div></figure></div><div class="ab cl nz oa hr ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ig ih ii ij ik"><p id="9c41" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="mw">原载于2022年3月28日</em><a class="ae nx" href="https://theanshuman.dev/articles/the-right-way-to-use-localstorage-in-javascript-41a0" rel="noopener ugc nofollow" target="_blank"><em class="mw">https://theanshuman . de</em>v</a><em class="mw">。</em></p><p id="dd35" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="mw">更多内容请看</em> <a class="ae nx" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="mw">说白了。报名参加我们的</em> <a class="ae nx" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="mw">免费周报</em> </strong> </a> <em class="mw">。关注我们</em> <a class="ae nx" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="mw">推特</em> </strong> </a> <em class="mw">和</em><strong class="kq io"><em class="mw"/></strong><a class="ae nx" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="mw">LinkedIn</em></strong></a><em class="mw">。加入我们的</em> <a class="ae nx" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="mw">社区不和谐</em> </strong> </a> <em class="mw">。</em></strong></a></p></div></div>    
</body>
</html>