<html>
<head>
<title>Upload Files to Google Drive from React without OAuth2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从React上传文件到Google Drive，无需OAuth2</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/upload-files-to-google-drive-from-react-without-oauth2-73b1f4add606?source=collection_archive---------1-----------------------#2022-05-09">https://javascript.plainenglish.io/upload-files-to-google-drive-from-react-without-oauth2-73b1f4add606?source=collection_archive---------1-----------------------#2022-05-09</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="be87" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">在Node.js和Multer的帮助下，没有OAuth2！</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/4085646e118566eef20cc289a6a606ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BQZwsdUzMSj5igNwCiclhQ.jpeg"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Photo by <a class="ae kw" href="https://unsplash.com/@alesiaskaz?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Alesia Kazantceva</a> on <a class="ae kw" href="https://unsplash.com/s/photos/technology?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e112" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">使用Google服务需要OAuth2认证，这实现起来有点复杂，如果你只是想实现一个简单的功能，可能不值得这么麻烦。</p><p id="5f4f" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">今天我们将学习如何使用服务帐户将文件上传到google drive。它将允许我们避免实现OAuth2身份验证。</p><h2 id="8b9c" class="lt lu ir bd lv lw lx dn ly lz ma dp mb lg mc md me lk mf mg mh lo mi mj mk ml bi translated">视频格式:</h2><p id="2f02" class="pw-post-body-paragraph kx ky ir kz b la mm js lc ld mn jv lf lg mo li lj lk mp lm ln lo mq lq lr ls ik bi translated">如果你喜欢视频格式，这里是这样的:</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="mr ms l"/></div></figure><p id="bad3" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如果没有，我们继续。</p><h1 id="c884" class="mt lu ir bd lv mu mv mw ly mx my mz mb jx na jy me ka nb kb mh kd nc ke mk nd bi translated">先决条件</h1><ol class=""><li id="845a" class="ne nf ir kz b la mm ld mn lg ng lk nh lo ni ls nj nk nl nm bi translated">首先要做的是创建一个服务帐户并获取<code class="fe nn no np nq b">key.json</code>文件。从您的谷歌云控制台</li><li id="e6d9" class="ne nf ir kz b la nr ld ns lg nt lk nu lo nv ls nj nk nl nm bi translated">然后，您需要在您的控制台上启用google drive API</li><li id="3857" class="ne nf ir kz b la nr ld ns lg nt lk nu lo nv ls nj nk nl nm bi translated">在下载的key.json文件中，您会看到一个<code class="fe nn no np nq b">client_email</code>字段。复制该值。</li><li id="ebee" class="ne nf ir kz b la nr ld ns lg nt lk nu lo nv ls nj nk nl nm bi translated">转到您想要通过API访问的google drive，并与该电子邮件帐户共享该文件夹/文件。</li></ol><p id="c72d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">最后一步很重要，因为它将允许我们避免实现OAuth2身份验证。</p><h1 id="b913" class="mt lu ir bd lv mu mv mw ly mx my mz mb jx na jy me ka nb kb mh kd nc ke mk nd bi translated">准备前端</h1><p id="202d" class="pw-post-body-paragraph kx ky ir kz b la mm js lc ld mn jv lf lg mo li lj lk mp lm ln lo mq lq lr ls ik bi translated">创建新的React应用程序。</p><p id="f207" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">前端代码非常容易。我们只需要一个文件选择器从本地机器上选择一个文件，并将其发送到Node.js服务器。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nw ms l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">GoogleDriveFileUploader.tsx</figcaption></figure><p id="e951" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这是一个简单的组件，允许我们从本地存储中选择一个文件，并调用我们接下来要开发的API。</p><h1 id="6d75" class="mt lu ir bd lv mu mv mw ly mx my mz mb jx na jy me ka nb kb mh kd nc ke mk nd bi translated">准备后端</h1><p id="e0b2" class="pw-post-body-paragraph kx ky ir kz b la mm js lc ld mn jv lf lg mo li lj lk mp lm ln lo mq lq lr ls ik bi translated">让我们首先通过安装一些依赖项来初始化项目。</p><pre class="kh ki kj kk gu nx nq ny nz aw oa bi"><span id="51b9" class="lt lu ir nq b gz ob oc l od oe">yarn add googleapis express cors multer</span></pre><p id="6175" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这里的<code class="fe nn no np nq b">multer</code>是一个用于<code class="fe nn no np nq b">express</code>应用程序的特殊中间件，帮助文件上传</p><p id="0a09" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><code class="fe nn no np nq b">googleapis</code>是我们与谷歌云API交互的方式。</p><p id="a40f" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">我们先来回顾一下我们要做的事情。</p><h2 id="bb15" class="lt lu ir bd lv lw lx dn ly lz ma dp mb lg mc md me lk mf mg mh lo mi mj mk ml bi translated">配置乘法器</h2><ol class=""><li id="0d1c" class="ne nf ir kz b la mm ld mn lg ng lk nh lo ni ls nj nk nl nm bi translated">我们将使用<code class="fe nn no np nq b">multer</code>配置我们的磁盘存储。这将允许我们将收到的文件存储在指定的文件夹中。</li></ol><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nw ms l"/></div></figure><h2 id="976e" class="lt lu ir bd lv lw lx dn ly lz ma dp mb lg mc md me lk mf mg mh lo mi mj mk ml bi translated">验证我们的应用程序</h2><p id="c079" class="pw-post-body-paragraph kx ky ir kz b la mm js lc ld mn jv lf lg mo li lj lk mp lm ln lo mq lq lr ls ik bi translated">然后，我们将使用key.json文件创建并授权我们的应用程序代码。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nw ms l"/></div></figure><p id="c438" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后创建我们的函数来处理文件上传特性。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nw ms l"/></div></figure><p id="845e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">注意在<code class="fe nn no np nq b">fileMetadata</code>字段中有一个<strong class="kz is">父</strong>数组。这是我们要将文件上传到的google drive文件夹的id。</p><p id="c467" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在我们将文件上传到google drive后，我们也想删除该文件。让我们为此创建另一个函数。</p><pre class="kh ki kj kk gu nx nq ny nz aw oa bi"><span id="2b1d" class="lt lu ir nq b gz ob oc l od oe">const deleteFile = (filePath) =&gt; {<br/>  fs.unlink(filePath, () =&gt; {<br/>    console.log("file deleted");<br/>  });<br/>};</span></pre><p id="8447" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">最后，让我们得到我们的端点，并一起使用所有这些。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nw ms l"/></div></figure><h1 id="b392" class="mt lu ir bd lv mu mv mw ly mx my mz mb jx na jy me ka nb kb mh kd nc ke mk nd bi translated">获取文件列表</h1><p id="b835" class="pw-post-body-paragraph kx ky ir kz b la mm js lc ld mn jv lf lg mo li lj lk mp lm ln lo mq lq lr ls ik bi translated">在前面的步骤中，我们注意到我们使用了一个ID来指定我们想要将文件上传到的文件夹。我们可以使用下面的函数来列出与这个特定服务帐户共享的可用文件和文件夹。</p><pre class="kh ki kj kk gu nx nq ny nz aw oa bi"><span id="6219" class="lt lu ir nq b gz ob oc l od oe">const response = await drive.files.list(params);</span></pre><p id="6761" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">从响应中，我们将得到一个可以找到文件id的列表。</p><h1 id="601f" class="mt lu ir bd lv mu mv mw ly mx my mz mb jx na jy me ka nb kb mh kd nc ke mk nd bi translated">上传文件而不存储它</h1><p id="b38f" class="pw-post-body-paragraph kx ky ir kz b la mm js lc ld mn jv lf lg mo li lj lk mp lm ln lo mq lq lr ls ik bi translated">上述解决方案非常有效。直到得到不能在磁盘上存储文件的要求。</p><p id="f1ce" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">例如，当您在docker中运行应用程序而没有root权限时，您必须授予非root用户权限。否则，您会得到一个错误，因为该特定用户无法将文件存储在存储器中。</p><p id="b228" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">为了解决这个问题，Multer为我们提供了另一个选择。我们用<code class="fe nn no np nq b"> multer’s</code> <code class="fe nn no np nq b">memorystorage</code>就可以了。</p><p id="77cd" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">它会将文件存储在应用程序内存中。如果文件大小不是超级疯狂的话，应该不成问题。只需在这里进行配置。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nw ms l"/></div></figure><p id="6ac1" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">你可以走了！</p><p id="3fee" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">今天到此为止。希望你学到了新东西。</p><p id="dea3" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">祝您愉快！</p><p id="8073" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><strong class="kz is">通过</strong> <a class="ae kw" href="https://www.linkedin.com/in/56faisal/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is"> LinkedIn </strong> </a> <strong class="kz is">或我的</strong> <a class="ae kw" href="https://www.mohammadfaisal.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is">个人网站</strong> </a> <strong class="kz is">与我取得联系。</strong></p><p id="1a42" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><em class="of">更多内容请看</em> <a class="ae kw" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is"> <em class="of">说白了就是</em> </strong> </a> <em class="of">。报名参加我们的</em> <a class="ae kw" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is"> <em class="of">免费每周简讯</em> </strong> </a> <em class="of">。关注我们</em><a class="ae kw" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kz is"><em class="of">Twitter</em></strong></a><em class="of">和</em><a class="ae kw" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kz is"><em class="of">LinkedIn</em></strong></a><em class="of">。加入我们的</em> <a class="ae kw" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is"> <em class="of">社区不和谐</em> </strong> </a> <em class="of">。</em></p></div></div>    
</body>
</html>