<html>
<head>
<title>I Built a Chrome Extension to Instantly Find eToro’s Stocks on FINVIZ’s Stock Screener</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我构建了一个Chrome扩展，可以在FINVIZ的股票筛选工具上即时找到eToro的股票</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/i-built-a-chrome-extension-to-instantly-find-etoros-stocks-on-finviz-s-stock-screener-89243d4493d9?source=collection_archive---------8-----------------------#2022-06-02">https://javascript.plainenglish.io/i-built-a-chrome-extension-to-instantly-find-etoros-stocks-on-finviz-s-stock-screener-89243d4493d9?source=collection_archive---------8-----------------------#2022-06-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/78c8f240e13ab0fb3644e8c7c3809ace.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M4SoQ1vXsyzSqJYvkP9fPg.png"/></div></div></figure><div class=""/><div class=""><h2 id="a3fd" class="pw-subtitle-paragraph jv ix iy bd b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dk translated">你不再需要不断切换标签来查看eToro中是否存在某种股票</h2></div><p id="9386" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">在疫情被困在室内的时候(就像其他人一样)，我创建了一个eToro账户，开始了我拥有劳力士、劳斯莱斯和罗孚的旅程。</p><p id="5657" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">显然，这并没有发生。这就是为什么你在看我在Medium.com的文章，而不是看我在IG上的文章。</p><p id="02ec" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我不仅没有被冰冷的现金淹没，而且我还是一个糟糕的交易者。这也是我在YouTube上观看大师们(<a class="ae lj" href="https://www.youtube.com/user/tradingwithrayner" rel="noopener ugc nofollow" target="_blank">雷纳·特奥</a> &amp; <a class="ae lj" href="https://www.youtube.com/watch?v=zBIeAeukTfQ&amp;ab_channel=SeanDekmar" rel="noopener ugc nofollow" target="_blank">肖恩·德克马尔</a>是我的首选)时一直试图解决的问题(糟糕的交易者部分)。</p><p id="2038" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">在疯狂观看他们的视频时，我遇到了FINVIZ的股票筛选程序。这是一个非常酷的平台，你可以根据不同的技术因素筛选出8，000多只股票，然后帮助你更好地规划你的交易。</p><figure class="lk ll lm ln gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/79d21d76129bea691d64851363ae1aeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*X7oCOAoqIt3M1qi8YJOLDQ.gif"/></div></div></figure><p id="6f1f" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">但问题是，其中一些不在eToro上，乍一看你不会知道。</p><p id="aba9" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">因此，我通常的工作流程总是复制股票行情，进入eToro的搜索，然后粘贴股票行情，看看它是否可用。如果Finviz给我100只股票的列表，那么我需要做100次这个动作。</p><p id="d059" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">好玩。好玩。</p><p id="50c0" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">当然，应该有更好的方法。</p><p id="99d5" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">而不是找到一个已经能做我想做的事情的工具或者抱怨没有工具。</p><p id="f517" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我决定从头开始构建自己的工具。</p><h1 id="3ae8" class="lo lp iy bd lq lr ls lt lu lv lw lx ly ke lz kf ma kh mb ki mc kk md kl me mf bi translated">范围</h1><ol class=""><li id="f819" class="mg mh iy kp b kq mi kt mj kw mk la ml le mm li mn mo mp mq bi translated">构建一个Chrome扩展，从FINVIZ读取股票行情，并将其传递到后端。</li><li id="bdfa" class="mg mh iy kp b kq mr kt ms kw mt la mu le mv li mn mo mp mq bi translated">在后端使用Laravel检查数据库中的值，并为每个ticker返回一个布尔值</li><li id="c830" class="mg mh iy kp b kq mr kt ms kw mt la mu le mv li mn mo mp mq bi translated">我可能需要想办法从eToro获取数据。似乎他们没有官方的API。所以找到一个解决方法。</li></ol><h1 id="677d" class="lo lp iy bd lq lr ls lt lu lv lw lx ly ke lz kf ma kh mb ki mc kk md kl me mf bi translated">策略</h1><ol class=""><li id="8e41" class="mg mh iy kp b kq mi kt mj kw mk la ml le mm li mn mo mp mq bi translated">写乱七八糟的代码。越乱越好。我在很短的时间内构建了这个，它是为我自己做的，所以代码不需要进行适当的结构化。它只需要工作。还有，远离模块构建者，我没有一整天的时间去琢磨如何配置Webpack。</li><li id="5cd0" class="mg mh iy kp b kq mr kt ms kw mt la mu le mv li mn mo mp mq bi translated">将tickers的废弃限制在FINVIZ的概述选项卡上，以进行概念验证</li><li id="2997" class="mg mh iy kp b kq mr kt ms kw mt la mu le mv li mn mo mp mq bi translated">如果我有时间，想办法在扩展中加入支付/记帐功能。破产者需要得到报酬。</li><li id="9cc7" class="mg mh iy kp b kq mr kt ms kw mt la mu le mv li mn mo mp mq bi translated">也许以后，我也可以将该功能扩展到CoinGecko。改天再说。不要忘乎所以，现在就开始努力。</li><li id="755d" class="mg mh iy kp b kq mr kt ms kw mt la mu le mv li mn mo mp mq bi translated">想出一个扩展名，并找到一个图标，等等。把这个留到最后。不要在早期浪费时间。</li></ol><h1 id="3b29" class="lo lp iy bd lq lr ls lt lu lv lw lx ly ke lz kf ma kh mb ki mc kk md kl me mf bi translated">让编码开始吧</h1><ol class=""><li id="290f" class="mg mh iy kp b kq mi kt mj kw mk la ml le mm li mn mo mp mq bi translated"><strong class="kp iz">安装/项目设置</strong></li></ol><p id="c7a5" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">谷歌有一个非常详细的入门指南，你可以参考开始做事情。</p><p id="ea6b" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">导读-<a class="ae lj" href="https://developer.chrome.com/docs/extensions/mv3/getstarted/" rel="noopener ugc nofollow" target="_blank">https://developer . chrome . com/docs/extensions/mv3/get started/</a></p><p id="0029" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">该指南还提供了一个完整示例(代码库)的链接。我将简单地下载它，并开始修改代码，以加快速度。</p><p id="a817" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">哦，还有一件事。一旦你下载了代码库，你就可以通过Chrome把它作为一个未打包的扩展来加载。相同的指南中概述了这些步骤，所以如果您也想尝试一下，可以参考一下。</p><p id="3948" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz"> 2。弄清楚代码库</strong></p><p id="6b1d" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">根据文档，主要文件有:</p><ul class=""><li id="bccc" class="mg mh iy kp b kq kr kt ku kw mw la mx le my li mz mo mp mq bi translated">manifest.json —所有元数据、权限等。被扔在这里。</li><li id="cfdc" class="mg mh iy kp b kq mr kt ms kw mt la mu le mv li mz mo mp mq bi translated">js——处理对扩展本身真正重要的事件。想想生命周期事件。处理不同生命周期事件的逻辑在这里被抛出。</li><li id="ddc3" class="mg mh iy kp b kq mr kt ms kw mt la mu le mv li mz mo mp mq bi translated">popup.html——基本上是UI层。所有的HTML逻辑和UI元素的CSS都在这里。popup.html也有一个相应的JS文件，它处理操作UI层的逻辑。</li><li id="2a2c" class="mg mh iy kp b kq mr kt ms kw mt la mu le mv li mz mo mp mq bi translated">和popup.js — JS文件来处理来自popup.html的事件，还可以注入内容脚本等。</li></ul><p id="9bd1" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">第一项任务——转到manifest.json，更改名称和描述。</p><p id="4a4e" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz"> manifest.json </strong></p><pre class="lk ll lm ln gt na nb nc nd aw ne bi"><span id="6ffb" class="nf lp iy nb b gy ng nh l ni nj">{<br/>	"name": "Finviz X eToro extension", <br/>	"description": "Show if the ticker exists on eToro", <br/>	// <br/>}</span></pre><p id="5e89" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">请注意，无论何时对manifest.json进行更改，都需要转到chrome://extensions，并重新加载扩展。</p><p id="f792" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我做的下一件事是前往popup.html，我给车身添加了一些造型，还添加了h2元素。我只是想看看这些变化是否会立即反映出来——事实的确如此。</p><p id="e549" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">此外，popup.html有一个绿色按钮，它在popup.js文件中有一个相应的click事件，该事件委托给一个setPageBackgroundColor方法。</p><p id="cf48" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我不会做太多改变，但我会在每个方法中添加一个console.log，看看它在Chrome DevTools中是什么样子。</p><p id="7741" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz"> popup.js </strong></p><pre class="lk ll lm ln gt na nb nc nd aw ne bi"><span id="bdb7" class="nf lp iy nb b gy ng nh l ni nj">let changeColor = document.getElementById("changeColor");</span><span id="f3c6" class="nf lp iy nb b gy nk nh l ni nj">// When the button is clicked, inject setPageBackgroundColor into current page<br/>changeColor.addEventListener("click", async () =&gt; {<br/>  let [tab] = await chrome.tabs.query({ active: true, currentWindow: true });</span><span id="3697" class="nf lp iy nb b gy nk nh l ni nj">// line that I added in<br/>  console.log('button clicked'); </span><span id="2ebd" class="nf lp iy nb b gy nk nh l ni nj">  chrome.scripting.executeScript({<br/>    target: { tabId: tab.id },<br/>    function: setPageBackgroundColor,<br/>  });<br/>});</span><span id="92c0" class="nf lp iy nb b gy nk nh l ni nj">// The body of this function will be execuetd as a content script inside the<br/>// current page<br/>function setPageBackgroundColor() {</span><span id="7912" class="nf lp iy nb b gy nk nh l ni nj">// line that I added in<br/>  console.log('setPageBackgroundColor method called.'); </span><span id="e4e4" class="nf lp iy nb b gy nk nh l ni nj">  chrome.storage.sync.get("color", ({ color }) =&gt; {<br/>    document.body.style.backgroundColor = color;<br/>  });<br/>}</span></pre><p id="dcbc" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz">结果:</strong></p><figure class="lk ll lm ln gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nl"><img src="../Images/811be2688eeaf1fcd88a71189596d80a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ze2DtVAy2UUp7LXTptNuMQ.gif"/></div></div></figure><p id="e9f4" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">似乎我在按钮的事件侦听器中编写的任何代码都会出现在扩展的开发工具中，setPageBackgroundColor方法中的代码会在浏览器的开发工具(FINVIZ页面)中执行。</p><p id="c55d" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">这两种环境都应该是隔离的。</p><p id="0701" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">下面是我要做的——每次点击绿色按钮时，我都要从FINVIZ页面获取tickers，并在setPageBackgroundColor中登录它们。现在，我将把尽可能多的逻辑放入这个方法本身。</p><p id="2310" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">在这一点上，我甚至不打算重命名这个方法，我将在最后清理它。</p><p id="c749" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz"> 3。从FINVIZ中删除ticker</strong></p><p id="d0dc" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">可能是最简单的部分。</p><p id="be97" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我所要做的就是检查HTML中的table元素，并获取这个类。在那里，执行querySelectorAll，并映射内部HTML。</p><p id="39e6" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">嘣！搞定了。</p><pre class="lk ll lm ln gt na nb nc nd aw ne bi"><span id="c66c" class="nf lp iy nb b gy ng nh l ni nj">let tickers = Array.from(document.querySelectorAll('.screener-link-primary'))<br/>  .map(function (tickerHtml) {<br/>    return tickerHtml.innerHTML; <br/>})</span><span id="8fe6" class="nf lp iy nb b gy nk nh l ni nj">console.log(tickers);</span></pre><p id="0588" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">继续前进。</p><figure class="lk ll lm ln gt ip gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/55dc8f5305a2f6638ea57543fdf4c80b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*iF0_IjgOC_H-O2kNdBDfJQ.gif"/></div></figure><p id="6d88" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz"> 4。在popup.html分机</strong>中显示报价机列表</p><p id="c4ea" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">这并不完全简单。</p><p id="47f6" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">为了做到这一点，我必须理解Chrome扩展的结构。</p><p id="a16f" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我浏览了以下链接:</p><p id="c9be" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">架构概述—<a class="ae lj" href="https://developer.chrome.com/docs/extensions/mv3/architecture-overview/" rel="noopener ugc nofollow" target="_blank">https://developer . chrome . com/docs/extensions/mv3/architecture-Overview/</a></p><p id="e3b1" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">信息传递——https://developer.chrome.com/docs/extensions/mv3/messaging/<a class="ae lj" href="https://developer.chrome.com/docs/extensions/mv3/messaging/" rel="noopener ugc nofollow" target="_blank">T5</a></p><p id="66bd" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">chrome . storage—<a class="ae lj" href="https://developer.chrome.com/docs/extensions/reference/storage/" rel="noopener ugc nofollow" target="_blank">https://developer . chrome . com/docs/extensions/reference/storage/</a></p><p id="553c" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">其要点是，您直接为扩展本身编写的代码和您“注入”到当前页面中的代码是完全隔离的。因此，您需要使用他们的消息传递API在两者之间共享数据。</p><p id="c9bb" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">你可以阅读上面的链接来更好地理解事情是如何运作的。</p><p id="5c5a" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我是这样做的:</p><p id="97e7" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我从上面的消息传递指南中复制了chrome.runtime.sendMessage部分，并将其添加到内容脚本部分(setPageBackgroundColor方法)。</p><p id="73b3" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我在popup.js的底部添加了一个相应的chrome . runtime . on Message . addlistener部分，也是从上面的消息传递指南复制过来的。</p><p id="24fc" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">这一切都非常有效。</p><p id="5283" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz"> setPageBackgroundColor方法又名内容脚本部分</strong></p><pre class="lk ll lm ln gt na nb nc nd aw ne bi"><span id="deca" class="nf lp iy nb b gy ng nh l ni nj">function setPageBackgroundColor() {<br/>	<br/>	let tickers = Array.from(document.querySelectorAll('.screener-link-primary'))<br/>  .map(function (tickerHtml) {<br/>    return tickerHtml.innerHTML; <br/>  })</span><span id="ece2" class="nf lp iy nb b gy nk nh l ni nj">	console.log(tickers);</span><span id="ca86" class="nf lp iy nb b gy nk nh l ni nj">	chrome.runtime.sendMessage({ <br/>    identifier: "finvizOverviewTab", <br/>    tickers: tickers<br/>  }, function (response) {<br/>    console.log(response.farewell);<br/>  });</span><span id="b0a1" class="nf lp iy nb b gy nk nh l ni nj">}</span></pre><p id="2fd8" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz"> popup.js(文件底部)</strong></p><pre class="lk ll lm ln gt na nb nc nd aw ne bi"><span id="aaca" class="nf lp iy nb b gy ng nh l ni nj">chrome.runtime.onMessage.addListener(<br/>  function (request, sender, sendResponse) {<br/>    console.log(sender.tab ?<br/>      "from a content script:" + sender.tab.url :<br/>      "from the extension");<br/>    if (request.identifier === "finvizOverviewTab")  {<br/>      console.log('tickers', request.tickers); </span><span id="4e51" class="nf lp iy nb b gy nk nh l ni nj">			// manipulate the DOM </span><span id="5b9f" class="nf lp iy nb b gy nk nh l ni nj">    }</span><span id="7f5a" class="nf lp iy nb b gy nk nh l ni nj">    sendResponse({ farewell: "goodbye" });<br/>  }<br/>);</span></pre><p id="0220" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz">结果</strong></p><figure class="lk ll lm ln gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nl"><img src="../Images/73c83d445a240da441468dc8a2ce9b4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nXyiX0WROP6ItkEgq9c6Kw.gif"/></div></div></figure><p id="4a92" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz"> 5。在分机上显示滚动条(错误)</strong></p><p id="f3f9" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我觉得一切都在工作，我休息了一下，我想在扩展本身和开发工具上显示滚动条，然后砰的一声弹出了这个错误。</p><p id="d8f5" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">乍一看，这很令人困惑，因为manifest.json文件具有activeTab权限，所以我认为这一切都很好，但编程并不是这样工作的。</p><p id="24d9" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz">错误</strong></p><pre class="lk ll lm ln gt na nb nc nd aw ne bi"><span id="1dab" class="nf lp iy nb b gy ng nh l ni nj">Uncaught (in promise) Error: Cannot access contents of the page. Extension manifest must request permission to access the respective host.</span></pre><figure class="lk ll lm ln gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nl"><img src="../Images/b4bdbc424471379689f0eb8f64300c40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0lG7rBAvriMxqQ2QHcTrbw.gif"/></div></div></figure><p id="a23a" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz">解决方案</strong></p><p id="0327" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">原来您需要一个针对manifest.json文件的host_permissions键来使事情正常运行。</p><pre class="lk ll lm ln gt na nb nc nd aw ne bi"><span id="2527" class="nf lp iy nb b gy ng nh l ni nj">"host_permissions": [<br/>    "*://finviz.com/"<br/> ],</span></pre><p id="ead2" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">这似乎能完成任务。</p><p id="cc2d" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">结果</p><figure class="lk ll lm ln gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nn"><img src="../Images/7eb6126101d8d24a1e4e97fba7c2eed8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3RF5BNt2PVr6WHdATTIfGQ.gif"/></div></div></figure><p id="06ae" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">跨栏的前半部分完成了。现在，我需要整理后端。在本文中，我不会过多讨论后端是如何工作的。我将在另一篇文章中介绍这一点。</p><p id="9559" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">6。从后端获取数据</p><p id="a8a8" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">此时，我所要做的就是通过HTTP调用将tickers列表从页面传递到后端，获得JSON响应，并相应地处理它。</p><p id="667f" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">为了简单起见，我将tickers数组转换成一个字符串，如下所示:</p><pre class="lk ll lm ln gt na nb nc nd aw ne bi"><span id="e963" class="nf lp iy nb b gy ng nh l ni nj">let tickerString = tickers.join('|');</span></pre><p id="97f2" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">然后将其附加到URL上。我使用fetch API对后端进行HTTP调用:</p><pre class="lk ll lm ln gt na nb nc nd aw ne bi"><span id="6c1d" class="nf lp iy nb b gy ng nh l ni nj">let results = await fetch('&lt;http://example-backend.test/check-tickers-status?tickers=&gt;' + tickerString)<br/>  .then(response =&gt; response.json())<br/>  .then(response =&gt; response.data); </span><span id="52db" class="nf lp iy nb b gy nk nh l ni nj">  console.log(results);</span></pre><p id="1445" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">后端将返回一个对象，包含所有的tickers和一个相应的布尔值。我只是在弹出窗口中显示了这些值。</p><p id="e53a" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz">结果</strong></p><figure class="lk ll lm ln gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/825637ba3b1d3830386a8c656d825760.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*4AnRIXudOcMTrphCZzmmQA.gif"/></div></div></figure><p id="a339" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz"> 7。高亮显示屏幕上的文本</strong></p><p id="ec49" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">现在很好，我可以清楚地看到eToro上扩展的弹出窗口本身的滚动条，但我也想突出显示FINVIZ页面上的项目。</p><p id="5742" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我是这样做的——我从上面的消息传递指南中复制了这段代码。</p><p id="28cc" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我是这样编辑的:</p><pre class="lk ll lm ln gt na nb nc nd aw ne bi"><span id="0c5b" class="nf lp iy nb b gy ng nh l ni nj">chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {<br/>    chrome.tabs.sendMessage(tabs[0].id, { <br/>      'identifier': 'tickerResults', <br/>      'results': results<br/>    }, function (response) {<br/>      console.log(response.farewell);<br/>    });<br/>  });</span></pre><p id="0be4" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">在setPageBackgroundColor方法(内容脚本)中，我添加了一个侦听器来处理消息:</p><pre class="lk ll lm ln gt na nb nc nd aw ne bi"><span id="124e" class="nf lp iy nb b gy ng nh l ni nj">chrome.runtime.onMessage.addListener(<br/>    function (request, sender, sendResponse) {<br/>      console.log(sender.tab ?<br/>        "from a content script:" + sender.tab.url :<br/>        "from the extension");<br/>      if (request.identifier === "tickerResults") {<br/>        <br/>        console.log('received the ticker results from the extension', request.results);</span><span id="35b9" class="nf lp iy nb b gy nk nh l ni nj">				// update the dom <br/>      }<br/>        <br/>      sendResponse({ 'farewell': "goodbye" });<br/>    }<br/>  );</span></pre><p id="bfa6" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz">结果</strong></p><figure class="lk ll lm ln gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/6630c6db56fc427dd371c14d32f65d32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ltoQHfAGX4Tc1xxTGAICOA.gif"/></div></div></figure><p id="6026" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">最后要做的事情是获取从扩展传递到内容脚本的结果，然后更新DOM。</p><p id="deff" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我是这样做的:</p><pre class="lk ll lm ln gt na nb nc nd aw ne bi"><span id="16a7" class="nf lp iy nb b gy ng nh l ni nj">let tickerResultsFromEtoro = request.results;</span><span id="d4e8" class="nf lp iy nb b gy nk nh l ni nj">let tickersHtmlElements = Array.from(document.querySelectorAll('.screener-link-primary'));</span><span id="74bb" class="nf lp iy nb b gy nk nh l ni nj">let tickers = tickersHtmlElements.map(function (tickerHtml) {<br/>    return tickerHtml.innerHTML; <br/>  })</span><span id="fc62" class="nf lp iy nb b gy nk nh l ni nj">for (let key in tickerResultsFromEtoro) {<br/>          if (tickerResultsFromEtoro[key]) {<br/>            let element = tickersHtmlElements[tickers.indexOf(key)]; <br/>            element.parentElement.parentElement.style.background = '#c6ddc6';</span><span id="1dc6" class="nf lp iy nb b gy nk nh l ni nj">            let thirdCol = element.parentElement.parentElement.children[2];</span><span id="be4c" class="nf lp iy nb b gy nk nh l ni nj">            thirdCol.innerHTML = thirdCol.innerHTML + `&lt;a href="&lt;https://www.etoro.com/markets/${key}&gt;" target="__blank" class="screener-link-primary" style="float:right;"&gt;Open on eToro&lt;/a&gt;`<br/>          }<br/>        }</span></pre><p id="26dc" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><strong class="kp iz">结果</strong></p><figure class="lk ll lm ln gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/3edc3e183bba7a57fe6c0c30645f9da3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*1gD3-fhenNFJ8_yTKBtFJA.gif"/></div></div></figure><p id="05f0" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">让我加入一些基本的CSS，让popup.js看起来稍微好一点。</p><figure class="lk ll lm ln gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/ac8273d36331fe7b1f01a2580571c7d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*NUo1DZVaNSC9KMw7_24RMA.gif"/></div></div></figure><p id="1206" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">太好了！它工作了。</p><p id="0d29" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">现在我可以很快看到哪些tickers在eToro上可用，哪些不可用。我为自己节省了很多时间和精力。</p><p id="08b5" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">印象深刻。</p><figure class="lk ll lm ln gt ip gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/1675fad982bf00727127f8bf91a49409.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*ZvPAhMaUyiQFetr8URhi8g.gif"/></div></figure><h1 id="4460" class="lo lp iy bd lq lr ls lt lu lv lw lx ly ke lz kf ma kh mb ki mc kk md kl me mf bi translated">开发者体验</h1><p id="a129" class="pw-post-body-paragraph kn ko iy kp b kq mi jz ks kt mj kc kv kw no ky kz la np lc ld le nq lg lh li ig bi translated">如果你懂香草JS，应该是轻而易举的事。</p><p id="6eb3" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">否则你可能会有一些麻烦。但是这里好的一面是文档很切题。只需遵循入门指南，您将能够顺利地开始行动。</p><p id="d627" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我喜欢的另一件事是，我不需要安装一堆不同的工具或软件包。我只需下载代码库，就可以让chrome扩展在浏览器中运行。</p><p id="219a" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">我肯定会构建更多我自己能用的chrome扩展。你也应该试一试！</p><h1 id="c94a" class="lo lp iy bd lq lr ls lt lu lv lw lx ly ke lz kf ma kh mb ki mc kk md kl me mf bi translated">下一步是什么？</h1><p id="f75f" class="pw-post-body-paragraph kn ko iy kp b kq mi jz ks kt mj kc kv kw no ky kz la np lc ld le nq lg lh li ig bi translated">当前版本的Finviz X eToro扩展相当基础。我可以让它变得更好，下面是我本周要做的事情:</p><ul class=""><li id="60bb" class="mg mh iy kp b kq kr kt ku kw mw la mx le my li mz mo mp mq bi translated">在background.js上添加一个权限检查，使这个扩展只有在用户使用<a class="ae lj" href="http://Finviz.com" rel="noopener ugc nofollow" target="_blank">Finviz.com</a>时才可以点击</li><li id="bd65" class="mg mh iy kp b kq mr kt ms kw mt la mu le mv li mz mo mp mq bi translated">使用存储API来存储之前的结果，这样每次点击时扩展就不会为空。</li><li id="77db" class="mg mh iy kp b kq mr kt ms kw mt la mu le mv li mz mo mp mq bi translated">做一些CSS工作，使扩展可发布</li><li id="1582" class="mg mh iy kp b kq mr kt ms kw mt la mu le mv li mz mo mp mq bi translated">可能会考虑将商业模式整合到扩展中。想想免费扫描的次数，然后他们应该付费使用它进行额外的扫描。让我们看看。</li></ul><h1 id="59ee" class="lo lp iy bd lq lr ls lt lu lv lw lx ly ke lz kf ma kh mb ki mc kk md kl me mf bi translated">后端怎么样？</h1><p id="43d3" class="pw-post-body-paragraph kn ko iy kp b kq mi jz ks kt mj kc kv kw no ky kz la np lc ld le nq lg lh li ig bi translated">这个chrome扩展的大部分逻辑都是在后端处理的。eToro没有官方的API，所以我必须找到一个变通办法从eToro获取数据。得到这些数据后，我简单地使用Laravel来处理来自chrome扩展的HTTP请求。</p><p id="eea1" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">你想知道更多关于我如何构建后端的信息吗？</p><p id="2540" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">在<a class="ae lj" href="https://medium.com/@ajay_613" rel="noopener">Medium.com</a>上关注我，一旦我们达到100个关注，我会提供一个关于我如何让后端运行起来的深入指导。</p><p id="1708" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><a class="ae lj" href="https://medium.com/@ajay_613/i-tried-automating-my-files-folders-with-php-for-the-first-time-4172a0af22b5" rel="noopener"> <strong class="kp iz">也读:我第一次尝试用PHP自动化我的文件&amp;文件夹</strong> </a></p><p id="a702" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated"><em class="nr">更多内容看</em> <a class="ae lj" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kp iz"> <em class="nr">说白了就是io </em> </strong> </a> <em class="nr">。报名参加我们的</em> <a class="ae lj" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kp iz"> <em class="nr">免费周报</em> </strong> </a> <em class="nr">。关注我们关于</em><a class="ae lj" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kp iz"><em class="nr">Twitter</em></strong></a><em class="nr">和</em><a class="ae lj" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kp iz"><em class="nr">LinkedIn</em></strong></a><em class="nr">。查看我们的</em> <a class="ae lj" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kp iz"> <em class="nr">社区不和谐</em> </strong> </a> <em class="nr">加入我们的</em> <a class="ae lj" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kp iz"> <em class="nr">人才集体</em> </strong> </a> <em class="nr">。</em></p></div></div>    
</body>
</html>