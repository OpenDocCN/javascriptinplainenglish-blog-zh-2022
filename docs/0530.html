<html>
<head>
<title>Risk-Based Authentication using Auth0 Actions and Have I Been Pwned APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Auth0操作的基于风险的身份验证以及我是否已被Pwned APIs</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/risk-based-authentication-using-auth0-actions-and-have-i-been-pwned-apis-fd3cb65c040a?source=collection_archive---------11-----------------------#2022-01-29">https://javascript.plainenglish.io/risk-based-authentication-using-auth0-actions-and-have-i-been-pwned-apis-fd3cb65c040a?source=collection_archive---------11-----------------------#2022-01-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/94f2695047497d4199fb94177f592111.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_mkTx6eGle7bdcTS"/></div></div></figure><div class=""/><p id="6767" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文中，我们将研究如何通过实现基于风险的身份验证来提高系统的安全性。为了实现这一点，我们将使用Auth0动作将<a class="ae kt" href="https://haveibeenpwned.com/" rel="noopener ugc nofollow" target="_blank"><em class="ku"/></a>API集成到我们的登录流中。</p><h1 id="80a1" class="kv kw iy bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">什么是基于风险的身份认证？</h1><p id="bc4f" class="pw-post-body-paragraph jv jw iy jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">简而言之，基于风险的身份认证(RBA)使用关于用户的实时情报来决定他们的活动是正常的(低风险)还是可疑的(高风险)。</p><p id="8a4b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">RBA根据登录行为估计风险分值。对于任何给定的访问尝试，通常会根据一组预定义的规则实时计算风险分值。然后为用户提供适合该风险级别的身份验证选项。</p><p id="8f02" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在评估登录活动的风险时，需要考虑许多因素。例如:</p><ul class=""><li id="2b19" class="ly lz iy jx b jy jz kc kd kg ma kk mb ko mc ks md me mf mg bi translated">用户的位置</li><li id="f4e1" class="ly lz iy jx b jy mh kc mi kg mj kk mk ko ml ks md me mf mg bi translated">设备/浏览器</li><li id="8174" class="ly lz iy jx b jy mh kc mi kg mj kk mk ko ml ks md me mf mg bi translated">IP和网络信息</li><li id="3cac" class="ly lz iy jx b jy mh kc mi kg mj kk mk ko ml ks md me mf mg bi translated">尝试登录的次数</li></ul><p id="877c" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">或者与用户及其环境相关的因素。例如，在凌晨2点尝试登录公司的人力资源系统会被认为是可疑的(高风险)。</p><p id="b330" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以及更多在特定环境下可能有意义的因素。</p><figure class="mn mo mp mq gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mm"><img src="../Images/cdb5b6b369db8d86c2204af59f0d0c7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*678Ml-PmVKLAOMgJ"/></div></div></figure><p id="7d53" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">大多数身份验证提供程序都支持RBA。</p><p id="79b7" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是几个例子的链接，<a class="ae kt" href="https://auth0.com/docs/secure/multi-factor-authentication/adaptive-mfa" rel="noopener ugc nofollow" target="_blank"> Auth0 </a>，<a class="ae kt" href="https://help.okta.com/en/prod/Content/Topics/Security/behavior-detection/faq-behavior-detection.htm" rel="noopener ugc nofollow" target="_blank"> Okta </a>，<a class="ae kt" href="https://docs.microsoft.com/en-us/azure/active-directory/authentication/tutorial-risk-based-sspr-mfa" rel="noopener ugc nofollow" target="_blank"> Azure AD </a>，<a class="ae kt" href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pool-settings-adaptive-authentication.html" rel="noopener ugc nofollow" target="_blank"> AWS Cognito </a>和<a class="ae kt" href="https://support.google.com/a/answer/6002699?hl=en" rel="noopener ugc nofollow" target="_blank"> Google </a>支持RBA。</p><p id="aac6" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用RBA，您不需要总是强制实施MFA，仅当根据风险分值需要时，您才可以要求额外的身份认证。这有助于改善登录流的用户体验，并使低风险登录更容易发生，摩擦更少。</p><h1 id="8583" class="kv kw iy bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">基于风险的身份验证的内置Auth0功能</h1><p id="4dfb" class="pw-post-body-paragraph jv jw iy jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">幸运的是，Auth0有一些特性支持您</p><ul class=""><li id="8b4b" class="ly lz iy jx b jy jz kc kd kg ma kk mb ko mc ks md me mf mg bi translated"><a class="ae kt" href="https://auth0.com/docs/secure/multi-factor-authentication/adaptive-mfa" rel="noopener ugc nofollow" target="_blank">自适应MFA </a> —此功能会触发MFA，并在置信度较低时要求用户完成MFA质询(活动具有高风险)。</li></ul><p id="ad57" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Auth0还提供了一系列与RBA齐头并进的<a class="ae kt" href="https://auth0.com/docs/secure/attack-protection" rel="noopener ugc nofollow" target="_blank">攻击保护</a>功能。</p><ul class=""><li id="6ebc" class="ly lz iy jx b jy jz kc kd kg ma kk mb ko mc ks md me mf mg bi translated"><a class="ae kt" href="https://auth0.com/docs/secure/attack-protection/breached-password-detection" rel="noopener ugc nofollow" target="_blank">密码泄露检测</a> — Auth0跟踪主要第三方网站上发生的重大安全漏洞。如果用户密码因数据泄露而泄露，他们将会收到通知，并且可能会被阻止登录。</li><li id="fbe3" class="ly lz iy jx b jy mh kc mi kg mj kk mk ko ml ks md me mf mg bi translated"><a class="ae kt" href="https://auth0.com/docs/secure/attack-protection/bot-detection" rel="noopener ugc nofollow" target="_blank">Bot Detection</a>—Bot Detection通过检测请求何时可能来自Bot并提供验证码挑战来阻止Bot攻击，从而减少脚本攻击。</li></ul><p id="04ef" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这些功能支持基于风险的身份认证的大多数典型场景，您可以进一步定制它们，以最大限度地满足您的使用需求。</p><h1 id="d7a2" class="kv kw iy bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">什么是<a class="ae kt" href="https://haveibeenpwned.com/" rel="noopener ugc nofollow" target="_blank">我被pwn了吗</a>它有什么帮助？</h1><p id="a872" class="pw-post-body-paragraph jv jw iy jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">由安全专家<a class="ae kt" href="https://en.wikipedia.org/wiki/Troy_Hunt" rel="noopener ugc nofollow" target="_blank"> Troy Hunt </a>、<a class="ae kt" href="https://haveibeenpwned.com/" rel="noopener ugc nofollow" target="_blank"><em class="ku">when I be pwned</em></a>是一个允许互联网用户检查他们的数据是否因数据泄露而受损的网站。</p><p id="8585" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">作为用户，你可以访问这个网站，输入你的电子邮件地址，获得一份你的电子邮件地址所涉及的数据泄露清单。</p><figure class="mn mo mp mq gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mr"><img src="../Images/6575ed2232a99824f35360d9d947ea95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*epor0QNEOeMkL_es"/></div></div></figure><p id="cce7" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://haveibeenpwned.com/" rel="noopener ugc nofollow" target="_blank"><em class="ku"/></a>也提供了REST APIs，您可以使用它们通过代码进行同样的查询。</p><p id="fe67" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">例如，这是一个API的响应，它返回一个电子邮件地址的数据违规列表。</p><p id="8502" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">请求:</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="bd9f" class="mx kw iy mt b gy my mz l na nb"><a class="ae kt" href="https://haveibeenpwned.com/api/v3/breachedaccount/{account}?truncateResponse=false" rel="noopener ugc nofollow" target="_blank">https://haveibeenpwned.com/api/v3/breachedaccount/{account}?truncateResponse=false</a></span></pre><p id="6d6a" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">回应:</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="6ef9" class="mx kw iy mt b gy my mz l na nb">[<br/>    {<br/>        "Name": "XYZ",<br/>        "Title": "XYZ",<br/>        "Domain": "xyz.com",<br/>        "BreachDate": "2020-03-22",<br/>        "AddedDate": "2020-11-15T00:59:50Z",<br/>        "ModifiedDate": "2020-11-15T01:07:10Z",<br/>        "Description": "In March 2020, the stock photo site .....",<br/>        "LogoPath": ".../Images/PwnedLogos/xyz.png",<br/>        "DataClasses": [<br/>            "Email addresses",<br/>            "IP addresses",<br/>            "Names",<br/>            "Passwords",<br/>            "Phone numbers",<br/>            "Physical addresses",<br/>            "Usernames"<br/>        ],<br/>        "IsVerified": true,<br/>        "IsFabricated": false,<br/>        "IsSensitive": false,<br/>        "IsRetired": false,<br/>        "IsSpamList": false,<br/>        "IsMalware": false<br/>    },<br/>...<br/>]</span></pre><p id="f1b5" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我想你现在应该能猜到我要说什么了。我想在登录流程中使用<a class="ae kt" href="https://haveibeenpwned.com/" rel="noopener ugc nofollow" target="_blank"><em class="ku"/></a>REST API来检测用户名(电子邮件)是否出现数据泄露，并根据风险因素做出适当反应。</p><p id="1e1e" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">例如，如果用户(电子邮件地址)在最近的数据泄露中列出，我将向用户发送一封更改(重置)密码的电子邮件，并要求他们完成MFA质询。我将在本文的剩余部分进一步描述登录流程。</p><p id="9447" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要使用API，您需要购买API密钥。请阅读<a class="ae kt" href="https://haveibeenpwned.com/API/Key" rel="noopener ugc nofollow" target="_blank">这些说明</a>以获取您的HIBP API密钥。</p><h1 id="c495" class="kv kw iy bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">使用Auth0操作扩展基于风险的身份验证</h1><p id="03ec" class="pw-post-body-paragraph jv jw iy jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">如前所述，Auth0内置特性已经为基于风险的身份认证提供了坚实的基础，但根据您的业务需求，您可能需要考虑更多因素作为风险评估的一部分。</p><p id="e5d5" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这就是Auth0操作的亮点，它让您可以将Auth0的功能扩展到已定义的范围之外。</p><p id="728d" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://haveibeenpwned.com/" rel="noopener ugc nofollow" target="_blank"><em class="ku"/></a>为<a class="ae kt" href="https://haveibeenpwned.com/FAQs" rel="noopener ugc nofollow" target="_blank">数据泄露</a>提供数据，同时<a class="ae kt" href="https://haveibeenpwned.com/Pastes" rel="noopener ugc nofollow" target="_blank">粘贴</a>，通常在其他来源之前拥有数据。因此，它是保护您的系统的一个很好的辅助资源。</p><p id="41d0" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然而，使用<a class="ae kt" href="https://haveibeenpwned.com/" rel="noopener ugc nofollow" target="_blank"><em class="ku"/></a>REST API只是一个示例，展示了如何使用其他数据源来增强您的风险评估。因此，在采用这个数据源之前，请做好您的研究。</p><h1 id="ed1b" class="kv kw iy bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">什么是Auth0操作？</h1><blockquote class="nc nd ne"><p id="94f6" class="jv jw ku jx b jy jz ka kb kc kd ke kf nf kh ki kj ng kl km kn nh kp kq kr ks ig bi translated">Auth0操作是在Node.js中编写的安全、特定于租户的版本化函数，在Auth0运行时的特定时间点执行。动作用于通过自定义逻辑自定义和扩展Auth0的功能。<a class="ae kt" href="http://auth0.com/docs/customize/actions" rel="noopener ugc nofollow" target="_blank">auth0.com/docs/customize/actions</a></p></blockquote><p id="a032" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，这种集成的想法是使用一个登录操作并编写一个Node.js函数来:</p><ul class=""><li id="d441" class="ly lz iy jx b jy jz kc kd kg ma kk mb ko mc ks md me mf mg bi translated">调用<a class="ae kt" href="https://haveibeenpwned.com/" rel="noopener ugc nofollow" target="_blank"> <em class="ku">我是否被pwned过</em></a>REST API来判断电子邮件地址(用户名)是否被列在数据泄露中。</li><li id="7881" class="ly lz iy jx b jy mh kc mi kg mj kk mk ko ml ks md me mf mg bi translated"><a class="ae kt" href="https://haveibeenpwned.com/" rel="noopener ugc nofollow" target="_blank"> <em class="ku">我被pwn了吗</em> </a>响应会给我一个给定电子邮件地址的数据泄露列表。</li><li id="b93e" class="ly lz iy jx b jy mh kc mi kg mj kk mk ko ml ks md me mf mg bi translated">我会选择最近的漏洞。</li><li id="6ddb" class="ly lz iy jx b jy mh kc mi kg mj kk mk ko ml ks md me mf mg bi translated">然后，我检查用户在最近一次数据泄露后是否更改了密码。</li><li id="b1a5" class="ly lz iy jx b jy mh kc mi kg mj kk mk ko ml ks md me mf mg bi translated">如果是这样，用户无需额外身份验证即可登录。</li><li id="5ea8" class="ly lz iy jx b jy mh kc mi kg mj kk mk ko ml ks md me mf mg bi translated">如果没有，用户需要完成MFA质询，他们会收到一封电子邮件来更改(重置)他们的密码。</li></ul><p id="ed18" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该流程图显示了新的登录流程，如下所示。</p><figure class="mn mo mp mq gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ni"><img src="../Images/af01d49eb379b3a2db926baf824630ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tNO_MtmqyiEEgWm8"/></div></div></figure><blockquote class="nc nd ne"><p id="263e" class="jv jw ku jx b jy jz ka kb kc kd ke kf nf kh ki kj ng kl km kn nh kp kq kr ks ig bi translated">注意:使用<a class="ae kt" href="https://auth0.com/docs/authenticate/identity-providers/social-identity-providers" rel="noopener ugc nofollow" target="_blank">社交</a>或<a class="ae kt" href="https://auth0.com/docs/authenticate/identity-providers/enterprise-identity-providers" rel="noopener ugc nofollow" target="_blank">企业</a>连接登录的用户必须向身份提供商(如谷歌或脸书)重置密码。</p></blockquote><p id="dac2" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于社交用户，您可能希望限制他们对系统中敏感数据的访问，或者警告他们有违规行为。因此他们可以采取任何必要的行动。(不在本例的范围内)</p><p id="09b1" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以做的其他事情包括:</p><ul class=""><li id="ebd1" class="ly lz iy jx b jy jz kc kd kg ma kk mb ko mc ks md me mf mg bi translated">如果您正在处理高风险活动，请完全阻止用户访问。例如，如果泄露的帐户属于可以进行高价值货币交易的公司财务部门员工。在这种情况下，你可能会采取更激烈的措施，包括亲自恢复帐户或使用<a class="ae kt" href="https://en.wikipedia.org/wiki/Know_your_customer" rel="noopener ugc nofollow" target="_blank"> KYC </a>服务，如<a class="ae kt" href="https://onfido.com/" rel="noopener ugc nofollow" target="_blank"> Onfido </a>来确保用户身份。</li></ul><p id="e169" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了这篇博客，我们将坚持使用一个更简单的REST API集成示例。</p><h1 id="8afb" class="kv kw iy bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated"><a class="ae kt" href="https://auth0.com/docs/customize/actions/write-your-first-action" rel="noopener ugc nofollow" target="_blank">创建你的第一个行动</a></h1><p id="f1d0" class="pw-post-body-paragraph jv jw iy jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">要开始，您需要一个Auth0帐户。如果你还没有，请按照这些说明<a class="ae kt" href="https://auth0.com/docs/get-started" rel="noopener ugc nofollow" target="_blank">来设置一个。</a></p><p id="a141" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">登录到您的Auth0帐户后，单击操作&gt;流&gt;登录以创建登录操作。</p><figure class="mn mo mp mq gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nj"><img src="../Images/6c41f617e4a85a8595306d1225fe8b34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6W3mIim2mu0BloFb"/></div></div></figure><p id="8878" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这创建了一个作为登录流的一部分运行的<code class="fe nk nl nm mt b"><a class="ae kt" href="https://auth0.com/docs/customize/actions/triggers/post-login" rel="noopener ugc nofollow" target="_blank">post-login</a></code>触发器。它在用户登录后和请求刷新令牌时执行。</p><figure class="mn mo mp mq gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nn"><img src="../Images/f5bc6c5e0b1720c4b822f1bb0ae96065.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z2TSqCGEgFG_7lsJ"/></div></div></figure><p id="653d" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">单击添加操作中的+按钮，并选择构建自定义。称之为<em class="ku">我被pwn了吗</em>剩下的就这样吧。</p><figure class="mn mo mp mq gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nj"><img src="../Images/3116ae4b15239a969c82cd45a9dd232d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yIJGjG-yIJrqg2Hm"/></div></div></figure><p id="f973" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建完成后，您将进入编辑屏幕。在这里，您可以为您的操作编写代码，测试并部署它。</p><p id="590e" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我们编写逻辑来调用<a class="ae kt" href="https://haveibeenpwned.com/" rel="noopener ugc nofollow" target="_blank"> <em class="ku">我是否被pwned</em></a>API来检查用户电子邮件地址是否涉及数据泄露。</p><figure class="mn mo mp mq gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nj"><img src="../Images/dbbf4d997d60a6365d616ee716f66325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m3eaI4ebUVOSaow5"/></div></div></figure><p id="0651" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将使用<em class="ku"> onExecutePostLogin </em>函数，这是一个在执行<a class="ae kt" href="https://auth0.com/docs/customize/actions/triggers/post-login" rel="noopener ugc nofollow" target="_blank"> PostLogin流</a>期间将被调用的处理程序。</p><p id="1eeb" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ku"> onExecutePostLogin </em>函数接收两个参数，<em class="ku"> API </em>(类型<a class="ae kt" href="https://auth0.com/docs/customize/actions/triggers/post-login/api-object" rel="noopener ugc nofollow" target="_blank"> PostLoginApi </a>)和<em class="ku">事件</em>(类型<a class="ae kt" href="https://auth0.com/docs/customize/actions/triggers/post-login/event-object" rel="noopener ugc nofollow" target="_blank">事件</a>)</p><p id="8be7" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于这个例子，我们将使用<code class="fe nk nl nm mt b">event.user</code>来查找用户的电子邮件地址。<code class="fe nk nl nm mt b">event.user</code>包含代表当前交易发起的用户的信息，如<code class="fe nk nl nm mt b">email</code>、<code class="fe nk nl nm mt b">identities</code>等。</p><p id="6033" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们还使用<code class="fe nk nl nm mt b">event.client</code>来获取客户端id。知道客户端id后，我们可以向用户发送一封重置密码的电子邮件。</p><p id="5b8b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以在<a class="ae kt" href="https://auth0.com/docs/customize/actions/triggers/post-login" rel="noopener ugc nofollow" target="_blank"> Auth0文档</a>中了解更多关于<code class="fe nk nl nm mt b">api</code>和<code class="fe nk nl nm mt b">event</code>的完整功能。</p><p id="d1d9" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将使用来自<a class="ae kt" href="https://haveibeenpwned.com/" rel="noopener ugc nofollow" target="_blank"> <em class="ku">的两个API:</em></a></p><ul class=""><li id="5e88" class="ly lz iy jx b jy jz kc kd kg ma kk mb ko mc ks md me mf mg bi translated">获取电子邮件地址的数据泄露列表。这将返回一个已经按日期排序的违规名称数组。所以列表上的第一项是最近的违规。</li><li id="ccc5" class="ly lz iy jx b jy mh kc mi kg mj kk mk ko ml ks md me mf mg bi translated">获取特定违规的详细信息。我们将使用前面列表中第一个违规的名称来获取详细信息。这包括<code class="fe nk nl nm mt b">BreachDate</code>。</li></ul><p id="04b5" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以在这里阅读<em class="ku">我被pwn了吗</em>API<a class="ae kt" href="https://haveibeenpwned.com/API/v3" rel="noopener ugc nofollow" target="_blank">的功能</a></p><h1 id="3441" class="kv kw iy bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">登录操作的代码</h1><figure class="mn mo mp mq gt ip"><div class="bz fp l di"><div class="no np l"/></div></figure><h1 id="8434" class="kv kw iy bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">测试您的行动</h1><p id="e9d3" class="pw-post-body-paragraph jv jw iy jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">在动作编辑器的左侧，您还有3个选项。看起来像播放按钮的那个是测试。如果你点击它，会给你一个登录有效负载的例子，一旦你点击run，它会模拟一个动作调用，调用的主体与你在登录/后登录流程中得到的相同。</p><p id="a31b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以随意编辑有效负载。比如我把邮箱地址改成了<code class="fe nk nl nm mt b">account-exists@hibp-integration-tests.com</code>。</p><p id="b586" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是一个在<a class="ae kt" href="https://haveibeenpwned.com/" rel="noopener ugc nofollow" target="_blank"> <em class="ku">中提供的测试电子邮件地址，我是否已经被pwn过</em> </a> API文档，用于用户数据泄露的场景。</p><p id="4c6e" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">运行操作后，您可以在右下方的面板中看到结果。</p><p id="a27a" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是我测试中的一个例子。</p><figure class="mn mo mp mq gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nj"><img src="../Images/3a9850f5e886298cccbb9df4d928dae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*S9zrca0MwYN01eLH"/></div></div></figure><p id="ec28" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以使用<code class="fe nk nl nm mt b">console.log</code>来查看函数调用中每一步的结果。</p><p id="2fef" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">动作编辑器自动保存你的代码，一旦你满意了，你可以点击部署按钮。</p><p id="7d6b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，当用户尝试登录时，他们将通过我们的登录操作，并需要成功通过我们增强的基于风险的身份认证，然后才能成功登录。</p><h1 id="7f40" class="kv kw iy bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">动作的其他特征</h1><p id="2a9d" class="pw-post-body-paragraph jv jw iy jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">行动可以提供更多。你得到一个秘密管理器，一个包管理器(对于npm包)和内置代码的版本历史。</p><p id="735f" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这弥补了更好的开发者体验。</p><figure class="mn mo mp mq gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nj"><img src="../Images/68c36be33c7f210717305d14719c4824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5Z7yXHCUx1Nm5ErR"/></div></div></figure><h1 id="eab2" class="kv kw iy bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">动作限制</h1><p id="597e" class="pw-post-body-paragraph jv jw iy jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">动作给了你一个定制和扩展Auth0功能的好方法，但是有一些限制。例如，流的每次执行必须在10秒或更短时间内完成，否则处理将在错误中结束。</p><p id="15f0" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">其中一些限制是为了确保当您添加更多代码和功能时，用户体验保持平稳。</p><p id="b32a" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">开始前，确保检查这些<a class="ae kt" href="https://auth0.com/docs/customize/actions/limitations" rel="noopener ugc nofollow" target="_blank">限制</a>。</p><h1 id="0417" class="kv kw iy bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">结论</h1><p id="8032" class="pw-post-body-paragraph jv jw iy jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">Auth0 Actions为开发团队提供了一种简单的方法来实现基于他们独特需求的认证和授权，并为许多可能性打开了大门。</p><p id="5309" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于这个登录动作示例，我们只触及了皮毛。行动提供了更多的挂钩，每种挂钩都有大量的例子。我们的风险计算功能也是如此。例如，我们可以利用漏洞的类型(例如:电子邮件、密码……)以及在<a class="ae kt" href="https://haveibeenpwned.com/API/v3" rel="noopener ugc nofollow" target="_blank"><em class="ku"/></a>中提供的更多数据来进行更有意义的风险计算。</p><p id="1eb8" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果这看起来像是你一直在寻找的东西，我鼓励你阅读Actions <a class="ae kt" href="https://auth0.com/docs/customize/actions" rel="noopener ugc nofollow" target="_blank">文档</a>来了解更多关于不同动作的能力并找到更多的例子。</p><p id="6cc7" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感谢阅读这篇文章。如果您有任何反馈或问题，请联系此处或在<a class="ae kt" href="https://twitter.com/_pazel" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上联系。</p><h1 id="2ff1" class="kv kw iy bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">参考</h1><ul class=""><li id="0bee" class="ly lz iy jx b jy lt kc lu kg nq kk nr ko ns ks md me mf mg bi translated"><a class="ae kt" href="https://auth0.com/docs/customize/actions" rel="noopener ugc nofollow" target="_blank">授权0行动文件</a></li><li id="1d85" class="ly lz iy jx b jy mh kc mi kg mj kk mk ko ml ks md me mf mg bi translated"><a class="ae kt" href="https://haveibeenpwned.com/API/v3" rel="noopener ugc nofollow" target="_blank">我被pwn了吗</a></li></ul><p id="81cb" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ku">更多内容看</em> <a class="ae kt" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx iz"> <em class="ku">说白了就是</em> </strong> </a> <em class="ku">。报名参加我们的</em> <a class="ae kt" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx iz"> <em class="ku">免费周报</em> </strong> </a> <em class="ku">。在我们的</em> <a class="ae kt" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jx iz"> <em class="ku">社区不和谐</em> </strong> </a> <em class="ku">获得独家获取写作机会和建议。</em></p></div></div>    
</body>
</html>