<html>
<head>
<title>Develop APIs with Express Framework and PostgreSQL— Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Express Framework和PostgreSQL开发APIs第1部分</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/develop-apis-with-express-framework-and-postgresql-part-1-5cf2bbed90c2?source=collection_archive---------7-----------------------#2022-11-25">https://javascript.plainenglish.io/develop-apis-with-express-framework-and-postgresql-part-1-5cf2bbed90c2?source=collection_archive---------7-----------------------#2022-11-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/99ea46e856e4665c44d7601349b90345.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*CQX1M2bPeIt_32qzulSATQ.png"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">API development with Node + Express + PostgreSQL</figcaption></figure><h1 id="4d44" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">什么是ExpressJS？</h1><p id="6e83" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">ExpressJS是一个预构建的NodeJS框架，可以帮助您更快、更智能地创建服务器端web应用程序。简单性、极简主义、灵活性和可伸缩性是它的一些特征，因为它是在NodeJS本身中制造的，所以它也继承了它的性能。</p><h1 id="caa6" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">为什么选择ExpressJS？</h1><p id="2430" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">ExpressJS</p><ul class=""><li id="0acf" class="lr ls in kv b kw lt la lu le lv li lw lm lx lq ly lz ma mb bi translated">允许设置中间件来响应HTTP请求。通过使用各种中间件，我们可以模块化我们的应用程序。在处理请求的任何时候添加中间件都提供了一个复杂的、易于维护的请求处理管道。</li><li id="2bd0" class="lr ls in kv b kw mc la md le me li mf lm mg lq ly lz ma mb bi translated">定义用于根据HTTP方法和URL执行不同操作的路由表。Express提供了路由API，可以用较少的开发时间创建微服务。</li><li id="d47c" class="lr ls in kv b kw mc la md le me li mf lm mg lq ly lz ma mb bi translated">允许基于向模板传递参数来动态呈现HTML页面。</li></ul><h1 id="2476" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">开始使用:</h1><p id="c254" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">1.安装节点js。要检查节点是否已安装，运行以下命令:<br/> <code class="fe mh mi mj mk b">node -v<br/></code>这将返回您系统上安装的nodejs版本。如果这个命令出现错误，可以使用这个<a class="ae ml" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">链接</a>来安装节点。</p><p id="ba61" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mm lg lh li mn lk ll lm mo lo lp lq ig bi translated">2.为服务器创建一个目录:<br/> <code class="fe mh mi mj mk b">mkdir server</code> <br/>在这里你可以用你的应用名称替换<code class="fe mh mi mj mk b">server</code>。<br/>T3】</p><p id="f297" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mm lg lh li mn lk ll lm mo lo lp lq ig bi translated">3.用<code class="fe mh mi mj mk b">package.json</code>文件初始化服务器:<br/> <code class="fe mh mi mj mk b">yarn init -y</code> <br/> <code class="fe mh mi mj mk b">-y</code>或<code class="fe mh mi mj mk b">--yes</code>标志将帮助您创建具有必要属性默认值的<code class="fe mh mi mj mk b">package.json</code>文件。<br/>生产下列<code class="fe mh mi mj mk b">package.json</code>:</p><pre class="mp mq mr ms gt mt mk mu bn mv mw bi"><span id="8e1a" class="mx jw in mk b be my mz l na nb">{<br/>  "name": "server",<br/>  "version": "1.0.0",<br/>  "main": "index.js",<br/>  "license": "MIT"<br/>}</span></pre><p id="29f2" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mm lg lh li mn lk ll lm mo lo lp lq ig bi translated">有关<code class="fe mh mi mj mk b">yarn init</code>的更多信息，请在这里找到官方文档<a class="ae ml" href="https://classic.yarnpkg.com/lang/en/docs/cli/init/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="ec4b" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mm lg lh li mn lk ll lm mo lo lp lq ig bi translated">4.现在，我们将向我们的应用程序添加以下npm包:</p><ul class=""><li id="ad88" class="lr ls in kv b kw lt la lu le lv li lw lm lx lq ly lz ma mb bi translated"><strong class="kv io"> express </strong> : Express JS是一个Node.js框架，旨在快速构建API的web应用跨平台移动app，让node.js变得简单。</li><li id="5c6b" class="lr ls in kv b kw mc la md le me li mf lm mg lq ly lz ma mb bi translated"><strong class="kv io"> Nodemon </strong>:一个帮助开发基于Node.js的应用程序的工具，当检测到目录中的文件改变时自动<em class="nc">重启node应用程序</em>。<br/> <code class="fe mh mi mj mk b">yarn add express &amp;&amp; yarn add nodemon -D</code>(作为开发依赖)</li></ul><h1 id="da29" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">在package.json中添加服务器脚本</h1><p id="1444" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">更新后的<code class="fe mh mi mj mk b">package.json</code>文件将如下所示:</p><pre class="mp mq mr ms gt mt mk mu bn mv mw bi"><span id="a84f" class="mx jw in mk b be my mz l na nb">{<br/>  "name": "server",<br/>  "version": "1.0.0",<br/>  "main": "app.js",<br/>  "license": "MIT",<br/>  "scripts": {<br/>    "start": "NODE_ENV=production node src/app.js",<br/>    "dev": "nodemon src/app.js"<br/>  },<br/>  "dependencies": {<br/>    "express": "^4.18.2",<br/>  },<br/>  "devDependencies": {<br/>    "nodemon": "^2.0.20"<br/>  }<br/>}</span></pre><p id="0336" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mm lg lh li mn lk ll lm mo lo lp lq ig bi translated">1.在<code class="fe mh mi mj mk b">start</code>脚本中，我们将环境变量<code class="fe mh mi mj mk b">NODE_ENV</code>的值更改为<code class="fe mh mi mj mk b">production</code>，并使用<code class="fe mh mi mj mk b">app.js</code>条目文件运行我们的节点应用程序。</p><p id="b64e" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mm lg lh li mn lk ll lm mo lo lp lq ig bi translated">2.在<code class="fe mh mi mj mk b">dev</code>脚本中，我们运行nodemon让服务器在应用程序中每次保存更改时重启。</p><h1 id="4e07" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">从源目录开始</h1><p id="eb68" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">1.创建一个包含我们源代码的src目录。<br/> <code class="fe mh mi mj mk b">mkdir src &amp;&amp; cd src</code></p><p id="dd7a" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mm lg lh li mn lk ll lm mo lo lp lq ig bi translated">2.创建一个入口文件:<code class="fe mh mi mj mk b">app.js</code><br/><code class="fe mh mi mj mk b">app</code>对象通常表示快速应用程序。通过调用Express模块导出的顶层<code class="fe mh mi mj mk b">express()</code>函数来创建它</p><p id="088d" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mm lg lh li mn lk ll lm mo lo lp lq ig bi translated">使用指定的回调函数将HTTP GET请求路由到指定的路径。</p><p id="7bd2" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mm lg lh li mn lk ll lm mo lo lp lq ig bi translated"><code class="fe mh mi mj mk b">app.listen([port[, host[, backlog]]][, callback])<br/></code>绑定并监听指定主机和端口上的连接。这个方法与Node的<a class="ae ml" href="https://nodejs.org/api/http.html#http_server_listen" rel="noopener ugc nofollow" target="_blank"> http相同。Server.listen() </a>。</p><pre class="mp mq mr ms gt mt mk mu bn mv mw bi"><span id="837c" class="mx jw in mk b be my mz l na nb">const express = require("express");<br/>const app = express();<br/>const PORT = 5000;<br/><br/>app.get("/", (req, res) =&gt; {<br/>  res.send("Hello world!");<br/>});<br/><br/>app.listen(PORT, () =&gt; console.log(`Server started at http://localhost:5000/`));</span></pre><p id="2611" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mm lg lh li mn lk ll lm mo lo lp lq ig bi translated">3.运行:<br/> <code class="fe mh mi mj mk b">cd server &amp;&amp; yarn dev</code></p><p id="46c2" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mm lg lh li mn lk ll lm mo lo lp lq ig bi translated">4.在你的浏览器中进入<a class="ae ml" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io">http://localhost:5000/</strong></a>，你会看到‘Hello world！’在浏览器窗口中。</p><p id="8715" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mm lg lh li mn lk ll lm mo lo lp lq ig bi translated">5.我们在这里向路径<code class="fe mh mi mj mk b">/</code>的服务器发送一个get请求。分配给该路径或路由的回调在服务器上执行，响应按照回调中的定义发送。</p></div><div class="ab cl nd ne hr nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ig ih ii ij ik"><h1 id="63ff" class="jv jw in bd jx jy nk ka kb kc nl ke kf kg nm ki kj kk nn km kn ko no kq kr ks bi translated">配置PostgreSQL数据库</h1><ul class=""><li id="2e7a" class="lr ls in kv b kw kx la lb le np li nq lm nr lq ly lz ma mb bi translated">按照教程从这个<a class="ae ml" href="https://www.youtube.com/watch?v=0n41UTkOBb0" rel="noopener ugc nofollow" target="_blank">链接</a>到<strong class="kv io"> <em class="nc">在windows上安装PostgreSQL </em> </strong>。</li><li id="d490" class="lr ls in kv b kw mc la md le me li mf lm mg lq ly lz ma mb bi translated">我们将需要一个npm包<code class="fe mh mi mj mk b">pg</code>及其类型来建立与PostgreSQL数据库的连接。<br/> <code class="fe mh mi mj mk b">pg</code>软件包官方文档可从<a class="ae ml" href="https://node-postgres.com/" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</li><li id="5f69" class="lr ls in kv b kw mc la md le me li mf lm mg lq ly lz ma mb bi translated">在根目录下运行以下命令安装<code class="fe mh mi mj mk b">pg</code>包:<br/> <code class="fe mh mi mj mk b">yarn add pg</code></li><li id="bf11" class="lr ls in kv b kw mc la md le me li mf lm mg lq ly lz ma mb bi translated">添加<code class="fe mh mi mj mk b">db.js</code>文件:<br/> <code class="fe mh mi mj mk b">new Pool(config: Config)</code> <br/>构造一个新的池实例。<br/>该池最初是空的，并将在需要时<em class="nc">缓慢地</em>创建新客户端。<code class="fe mh mi mj mk b">config</code>对象的每个字段都是完全可选的。当池创建客户机时，传递给池的配置也会传递给池中的每个客户机实例。<br/>在这里了解更多关于池API <a class="ae ml" href="https://node-postgres.com/apis/pool" rel="noopener ugc nofollow" target="_blank">的信息。</a></li></ul><pre class="mp mq mr ms gt mt mk mu bn mv mw bi"><span id="03be" class="mx jw in mk b be my mz l na nb">const { Pool } = require("pg");<br/><br/>const pool = new Pool({<br/>  host: "localhost",<br/>  user: "postgres",<br/>  port: 5432,<br/>  password: "admin",<br/>  database: "postgres",<br/>});<br/><br/>module.exports = { pool }</span></pre><ul class=""><li id="8bea" class="lr ls in kv b kw lt la lu le lv li lw lm lx lq ly lz ma mb bi translated">现实项目中的所有细节都存储在<code class="fe mh mi mj mk b">.env</code>文件和生产环境变量中。它们是敏感的秘密，不能通过适当的认证和授权来共享。我们在本文中没有使用<code class="fe mh mi mj mk b">.env</code>文件，因为这预计是使用node-express开发API之旅的开始。</li><li id="9169" class="lr ls in kv b kw mc la md le me li mf lm mg lq ly lz ma mb bi translated">更新<code class="fe mh mi mj mk b">app.js</code> : <br/>在这里，<code class="fe mh mi mj mk b">pool.query</code>返回一个承诺，该承诺在被解析时返回<code class="fe mh mi mj mk b">pg.Result</code>对象。<br/> <code class="fe mh mi mj mk b">result.rows</code>返回查询结果的行数组。如果查询没有返回结果，那么<code class="fe mh mi mj mk b">rows</code>返回一个空数组。<br/>点击了解更多结果对象<a class="ae ml" href="https://node-postgres.com/apis/result" rel="noopener ugc nofollow" target="_blank">。</a></li></ul><pre class="mp mq mr ms gt mt mk mu bn mv mw bi"><span id="cfc9" class="mx jw in mk b be my mz l na nb">const express = require("express");<br/>const app = express();<br/><br/>const PORT = 5000;<br/><br/>// import pool object from db module that we just created<br/>const { pool } = require("./db");<br/><br/>app.get("/", (req, res) =&gt; {<br/>  res.send("Hello world!");<br/>});<br/><br/>// async-await pattern for get callback argument<br/>app.get("/users", async (req, res) =&gt; {<br/>  try {<br/>    // pool.query runs a query on the first available idle client and<br/>    // return its result<br/>    const result = await pool.query(`Select * from users`);<br/>    res.send(result.rows);<br/>  } catch (err) {<br/>    console.error('Error executing query', err.stack)<br/>    res.status(500).json({ error: 'Something went wrong'});<br/>  }<br/>});<br/><br/>app.listen(PORT, () =&gt; console.log(`Server started at http://localhost:5000/`));</span></pre><ul class=""><li id="f73a" class="lr ls in kv b kw lt la lu le lv li lw lm lx lq ly lz ma mb bi translated">在测试API之前，请确保添加到池构造函数中的数据库细节是准确的并且可以工作。然后运行下面的查询来创建表并添加一些虚拟数据。</li></ul><pre class="mp mq mr ms gt mt mk mu bn mv mw bi"><span id="ebaa" class="mx jw in mk b be my mz l na nb">-- Table: users<br/><br/>-- DROP TABLE users;<br/><br/>CREATE TABLE users<br/>(<br/>    id integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),<br/>    name character varying(50) NOT NULL,<br/>    email character varying(30),<br/>    CONSTRAINT users_pkey PRIMARY KEY (id)<br/>);<br/><br/>ALTER TABLE users<br/>    OWNER to postgres;<br/><br/>-- INSERT data<br/><br/>INSERT INTO<br/>    users (name, email)<br/>VALUES<br/>    ('user1', 'user1@mail.com'),<br/>    ('user2', 'user2@mail.com'),<br/>    ('user3', 'user3@mail.com');</span></pre><ul class=""><li id="b63b" class="lr ls in kv b kw lt la lu le lv li lw lm lx lq ly lz ma mb bi translated">因为我们关注的是Expressjs开发，所以我们不会深入数据库管理。如果您成功地运行了查询，您就可以开始了。</li><li id="eca3" class="lr ls in kv b kw mc la md le me li mf lm mg lq ly lz ma mb bi translated">结果对象的形状如下所示:</li></ul><pre class="mp mq mr ms gt mt mk mu bn mv mw bi"><span id="b54f" class="mx jw in mk b be my mz l na nb">{<br/>  command: 'SELECT',<br/>  rowCount: 3,<br/>  oid: null,<br/>  rows: [<br/>    { id: 1, name: 'user1', email: 'user1@mail.com' },<br/>    { id: 2, name: 'user2', email: 'user2@mail.com' },<br/>    { id: 3, name: 'user3', email: 'user3@mail.com' }<br/>  ],<br/>  fields: [<br/>    Field {<br/>      name: 'id',<br/>      tableID: 16947,<br/>      columnID: 1,<br/>      dataTypeID: 23,<br/>      dataTypeSize: 4,<br/>      dataTypeModifier: -1,<br/>      format: 'text'<br/>    },<br/>      arrayParser: [Object],<br/>      builtins: [Object]<br/>    },<br/>    text: {},<br/>    binary: {}<br/>  },<br/>  RowCtor: null,<br/>  rowAsArray: false<br/>}</span></pre><ul class=""><li id="2784" class="lr ls in kv b kw lt la lu le lv li lw lm lx lq ly lz ma mb bi translated">请注意，在上面的示例中，不需要签出或释放客户端。池在内部进行获取和释放。</li><li id="3fac" class="lr ls in kv b kw mc la md le me li mf lm mg lq ly lz ma mb bi translated">确保服务器正在运行，然后转到<a class="ae ml" href="http://localhost:5000/users" rel="noopener ugc nofollow" target="_blank"><strong class="kv io">http://localhost:5000/users</strong></a>在浏览器窗口中查看查询结果。</li></ul><div class="ns nt gp gr nu nv"><a href="https://github.com/yogeshdatir/node-express-starter-kit-with-javascript-postgresql" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd io gy z fp oa fr fs ob fu fw im bi translated">GitHub-yogeshdatir/node-express-starter-kit-with-JavaScript-PostgreSQL</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">github.com</p></div></div><div class="oe l"><div class="of l og oh oi oe oj jp nv"/></div></div></a></div></div><div class="ab cl nd ne hr nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ig ih ii ij ik"><h1 id="ed21" class="jv jw in bd jx jy nk ka kb kc nl ke kf kg nm ki kj kk nn km kn ko no kq kr ks bi translated">参考资料:</h1><ol class=""><li id="f675" class="lr ls in kv b kw kx la lb le np li nq lm nr lq ok lz ma mb bi translated"><a class="ae ml" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank">快递文件</a></li><li id="3402" class="lr ls in kv b kw mc la md le me li mf lm mg lq ok lz ma mb bi translated"><code class="fe mh mi mj mk b"><a class="ae ml" href="https://node-postgres.com/" rel="noopener ugc nofollow" target="_blank">pg</a></code> <a class="ae ml" href="https://node-postgres.com/" rel="noopener ugc nofollow" target="_blank">包文档</a></li></ol><h1 id="3cd7" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">有用资源:</h1><ol class=""><li id="7b00" class="lr ls in kv b kw kx la lb le np li nq lm nr lq ok lz ma mb bi translated"><a class="ae ml" href="https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs" rel="noopener ugc nofollow" target="_blank">多药耐药表</a></li></ol><p id="f930" class="pw-post-body-paragraph kt ku in kv b kw lt ky kz la lu lc ld le mm lg lh li mn lk ll lm mo lo lp lq ig bi translated"><em class="nc">更内容于</em><a class="ae ml" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nc"/></strong></a><em class="nc">。报名参加我们的</em> <a class="ae ml" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nc">免费周报</em> </strong> </a> <em class="nc">。</em><a class="ae ml" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nc"/></strong></a><a class="ae ml" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nc">领英</em></strong></a><em class="nc"/><a class="ae ml" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nc">YouTube</em></strong></a>T42<strong class="kv io">T44</strong>T48<em class="nc">上追随我们。对增长黑客感兴趣？查看</em> <a class="ae ml" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nc">电路</em> </strong> </a> <em class="nc">。</em></p></div></div>    
</body>
</html>