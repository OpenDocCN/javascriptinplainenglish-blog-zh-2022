<html>
<head>
<title>useRafInterval Hook in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React中的useRafInterval挂钩</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/userafinterval-hook-in-react-75e9a1281e38?source=collection_archive---------4-----------------------#2022-11-08">https://javascript.plainenglish.io/userafinterval-hook-in-react-75e9a1281e38?source=collection_archive---------4-----------------------#2022-11-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8c72" class="pw-subtitle-paragraph jr ip iq bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">为什么不用<code class="fe jn jo jp jq b">setInterval</code>，而用<code class="fe jn jo jp jq b">requestAnimationFrame</code></h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/e2aba8950318906a43370b233944a75b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6LyWr8p8nlenCbfq"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">Photo by <a class="ae kz" href="https://unsplash.com/@alexbemore?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Alexander Shatov</a> on <a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="002f" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在React中，我们可以为一些重复的逻辑使用定制的钩子。举个例子，如果我想写一个每隔一段时间执行一个同步函数的钩子，我可以这样写<code class="fe jn jo jp jq b">useInterval</code>:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="ed21" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">代码看起来很清楚，对吧？像这样使用:</p><pre class="kk kl km kn gt ly jq lz ma aw mb bi"><span id="f5f5" class="mc md iq jq b gy me mf l mg mh">const clear = useInterval(() =&gt; {<br/>    setCount((c) =&gt; c + 1);<br/>}, 1000);</span></pre><p id="4d29" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">但是<code class="fe jn jo jp jq b">setInterval</code>会在用户电脑锁屏或者切换到另一个标签页时继续运行。这也意味着它在后台不断消耗你的设备的电池。我们可以使用<code class="fe jn jo jp jq b">requestAnimationFrame</code>来代替，它告诉浏览器你希望执行一个动画，并请求浏览器在下一次重画之前调用一个指定的函数来更新动画。为了提高性能和电池寿命，在后台标签或隐藏iframe中运行时，大多数浏览器都暂停调用。</p><p id="90c4" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们先写一个<code class="fe jn jo jp jq b">setRafInterval</code>，就像<code class="fe jn jo jp jq b">setInterval</code>一样:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="b117" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">接下来，只需替换<code class="fe jn jo jp jq b">useInterval</code>中的<code class="fe jn jo jp jq b">window.setInterval</code>，并简单调整类型:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="fa45" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">以上是完整的代码。<code class="fe jn jo jp jq b">requestAnimationFrame</code>通常是根据你的屏幕的刷新率来调用的，比如一个常见的<code class="fe jn jo jp jq b">60HZ</code>屏幕，每秒回调的次数是60次，大概是<code class="fe jn jo jp jq b">16.6</code> s，所以这里我们定义<code class="fe jn jo jp jq b">RafHandle</code>，将每次调用返回的<code class="fe jn jo jp jq b">id</code>存储在对象中。由于外部使用的对象的引用，当读取<code class="fe jn jo jp jq b">id</code>时，您将总是获得最新的<code class="fe jn jo jp jq b">id</code>。</p><p id="a60c" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">下面是一个使用案例:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mi lx l"/></div></figure><p id="c54f" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">最后，由你来权衡这两个选项。比如你要做一个计时之类的后台运行的案例，或者你需要在小于<code class="fe jn jo jp jq b">16.6</code> ms的间隔内执行一个函数，那么<code class="fe jn jo jp jq b">requestAnimationFrame</code>就不能选择，但是如果是一些计算更新动画等。，<code class="fe jn jo jp jq b">requestAnimationFrame</code>明显更好。</p><p id="5a50" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><em class="mj">不是中等会员？</em> <a class="ae kz" href="https://medium.com/@hellostephanie2022/membership" rel="noopener"> <em class="mj">支持我在这里成为一个</em> </a> <em class="mj">。</em></p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="7663" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><em class="mj">更多内容请看</em><a class="ae kz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lc ir"><em class="mj">plain English . io</em></strong></a><em class="mj">。报名参加我们的</em> <a class="ae kz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lc ir"> <em class="mj">免费周报</em> </strong> </a> <em class="mj">。关注我们关于</em><a class="ae kz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="lc ir"><em class="mj">Twitter</em></strong></a><a class="ae kz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="lc ir"><em class="mj">LinkedIn</em></strong></a><em class="mj"/><a class="ae kz" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="lc ir"><em class="mj">YouTube</em></strong></a><em class="mj"/><a class="ae kz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="lc ir"><em class="mj">不和</em> </strong> </a> <em class="mj">。对增长黑客感兴趣？检查</em> <a class="ae kz" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="lc ir"> <em class="mj">电路</em> </strong> </a> <em class="mj">。</em></p></div></div>    
</body>
</html>