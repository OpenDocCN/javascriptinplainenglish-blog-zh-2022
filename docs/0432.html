<html>
<head>
<title>Angular: Dragging, Dropping, and Swapping Elements Using a Reusable Directive</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular:使用可重用指令拖放和交换元素</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/angular-dragging-dropping-and-swapping-elements-using-a-reusable-directive-cb4b170d44cf?source=collection_archive---------4-----------------------#2022-01-25">https://javascript.plainenglish.io/angular-dragging-dropping-and-swapping-elements-using-a-reusable-directive-cb4b170d44cf?source=collection_archive---------4-----------------------#2022-01-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="0835" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">仅使用指令实现拖放和交换，以提高代码的可重用性。</h2></div><p id="62ab" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我已经用JavaScript写了一个相同概念的故事。你可以看看下面的链接。</p><div class="ky kz gp gr la lb"><a href="https://ramya-bala221190.medium.com/dragging-dropping-and-swapping-elements-with-javascript-11d9cdac2178" rel="noopener follow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd io gy z fp lg fr fs lh fu fw im bi translated">用Javascript拖放和交换元素</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">我想分享一个工作解决方案，当拖放时，一个元素如何与另一个元素交换…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">ramya-bala221190.medium.com</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp lq lb"/></div></div></a></div><p id="9778" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个故事围绕着只使用指令实现拖放和交换来提高代码的可重用性。</p><p id="b2bb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我用了一个类似的例子，3个盒子一个挨着一个浮动。目标是<strong class="ke io">每个音符可以被拖放到任何其他音符的位置，但不能放在自己身上。</strong></p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi lr"><img src="../Images/68cec07144602f521925edec0ca3c9eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JVV86x5c6l1cijq70ZWHlA.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Drag, Drop, and Swap of Notes</figcaption></figure><p id="edc2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> AppComponent模板:</strong>在这个模板中，我们正在遍历一个数组<strong class="ke io">的注释。</strong>从上面的截图可以明显看出，因为有3个盒子，所以这是一个由3个对象组成的数组，属性名为<strong class="ke io">。</strong></p><figure class="ls lt lu lv gt lw"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="6b9a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们已经将<strong class="ke io">dragdropswapdirect</strong>应用于每个&lt; div.note &gt;标签。该指令将完全执行拖放和交换操作。我们向指令传递了2个输入来执行这项工作:</p><p id="e3ff" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">=&gt;<strong class="ke io">将</strong>数组注释为<strong class="ke io"> @Input ('list') </strong>和</p><p id="7083" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">=&gt; <strong class="ke io">将&lt; div.note &gt;标签在<strong class="ke io"> notes </strong>数组中的位置</strong>作为<strong class="ke io">@ Input(' ele imposition))</strong>。</p><p id="9e00" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将在故事的稍后阶段回到<strong class="ke io"> returnUpdatedList </strong>。</p><p id="9804" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> AppComponent类:</strong>该类不言自明。我们已经定义了数组<strong class="ke io">注释</strong>，稍后将讨论方法<strong class="ke io"> returnUpdatedList() </strong>。</p><figure class="ls lt lu lv gt lw"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="8391" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">dragdropswapdirect类:</strong></p><figure class="ls lt lu lv gt lw"><div class="bz fp l di"><div class="mg mh l"/></div></figure><ol class=""><li id="c3b0" class="mi mj in ke b kf kg ki kj kl mk kp ml kt mm kx mn mo mp mq bi translated">通过使用@HostBinding将<strong class="ke io"> draggable属性</strong>设置为true，每个<div.note>标签都可以拖动。</div.note></li></ol><pre class="ls lt lu lv gt mr ms mt mu aw mv bi"><span id="c853" class="mw mx in ms b gy my mz l na nb">@HostBinding(‘attr.draggable’) draggable = true;</span></pre><p id="dd2b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2.让我们考虑一个实例，当包含<strong class="ke io"> Note1 </strong>的<div.note>标签被拖放到包含<strong class="ke io"> Note2 </strong>的&lt; div.note &gt;标签上。预期的行为是Note2取代Note1，Note1取代Note2。</div.note></p><pre class="ls lt lu lv gt mr ms mt mu aw mv bi"><span id="0d0f" class="mw mx in ms b gy my mz l na nb"><strong class="ms io">@HostListener(‘dragstart’, [‘$event’])</strong></span><span id="62b0" class="mw mx in ms b gy nc mz l na nb">onDragStart(e) {<br/>e.dataTransfer.setData(‘text’, this.elemPosition);<br/>}</span></pre><p id="bcc2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当我们开始<strong class="ke io">拖动Note1 </strong>时，触发<strong class="ke io"> dragstart </strong>事件，调用<strong class="ke io"> onDragStart() </strong>。在这个方法中，我们使用<strong class="ke io">数据传输</strong>对象的<strong class="ke io"> setData() </strong>方法为类型<strong class="ke io"> "text" </strong>设置<strong class="ke io">element</strong>中的数据。</p><p id="8239" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一个<strong class="ke io">数据传输对象</strong>用于保存在拖放操作中被拖动的数据。可以在所有拖动事件的<strong class="ke io">数据传输属性</strong>中访问该对象。</p><p id="03ee" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">element position</strong>包含notes数组中&lt; div.note &gt;标签的索引。因为我们正在拖动<strong class="ke io"> Note1 </strong>，所以<strong class="ke io">element composition</strong>包含了包含Note1的&lt; div.note &gt;标签的索引。</p><p id="18a7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.当Note1被<strong class="ke io">拖动到</strong> Note2上时，触发<strong class="ke io"> dragover </strong>事件，调用<strong class="ke io"> onDragOver() </strong>。</p><pre class="ls lt lu lv gt mr ms mt mu aw mv bi"><span id="10dc" class="mw mx in ms b gy my mz l na nb"><strong class="ms io">@HostListener(‘dragover’, [‘$event’])</strong></span><span id="eb17" class="mw mx in ms b gy nc mz l na nb"><strong class="ms io">onDragOver(e) {</strong><br/>e.preventDefault();<br/>}</span></pre><p id="675b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">4.当Note1被<strong class="ke io">拖放</strong>到Note2上时，包含Note2的&lt; div.note &gt;标签上触发<strong class="ke io"> drop </strong>事件，并调用<strong class="ke io"> onDrop() </strong>。</p><pre class="ls lt lu lv gt mr ms mt mu aw mv bi"><span id="149d" class="mw mx in ms b gy my mz l na nb"><strong class="ms io">@HostListener(‘drop’, [‘$event’])</strong></span><span id="8f98" class="mw mx in ms b gy nc mz l na nb"><strong class="ms io">onDrop(e) {</strong><br/>e.preventDefault();</span><span id="8651" class="mw mx in ms b gy nc mz l na nb">let <strong class="ms io">sourceElementIndex </strong>= e.dataTransfer.getData(‘text’);<br/>let <strong class="ms io">destElementIndex </strong>= this.elemPosition;<br/>let <strong class="ms io">clonedList </strong>= […this.list];</span><span id="8ac5" class="mw mx in ms b gy nc mz l na nb">if (sourceElementIndex !== destElementIndex) {<br/>clonedList.splice(destElementIndex, 1, this.list[sourceElementIndex]);</span><span id="e9eb" class="mw mx in ms b gy nc mz l na nb">clonedList.splice(sourceElementIndex, 1, this.list[destElementIndex]);</span><span id="7671" class="mw mx in ms b gy nc mz l na nb">this.returnUpdatedList.emit(clonedList);<br/>}<br/>}</span></pre><p id="b195" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> sourceElementIndex </strong>存储包含被拖动的Note1的&lt; div.note &gt;标签的索引。</p><p id="9592" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> destElementIndex </strong>包含<strong class="ke io"> notes </strong>数组中包含Note2的&lt; div.note &gt;标签的索引。</p><p id="94f4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">克隆列表</strong>包含数组<strong class="ke io">列表</strong>的副本。</p><p id="f275" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果被拖动的<div.note>标签与被拖放到的<div.note>标签具有不同的索引，即注释不能被拖放到自身上，则执行下面的交换逻辑，并且通过<strong class="ke io"> returnUpdatedList </strong>事件发射器将更新的<strong class="ke io"> clonedList </strong>与注释1和注释交换的位置返回给组件。</div.note></div.note></p><pre class="ls lt lu lv gt mr ms mt mu aw mv bi"><span id="3b74" class="mw mx in ms b gy my mz l na nb">clonedList.splice(destElementIndex, 1, this.list[sourceElementIndex]);</span><span id="ec35" class="mw mx in ms b gy nc mz l na nb">clonedList.splice(sourceElementIndex, 1, this.list[destElementIndex]);</span><span id="519e" class="mw mx in ms b gy nc mz l na nb">this.returnUpdatedList.emit(clonedList);</span></pre><p id="89f9" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<strong class="ke io"> AppComponent类</strong>中，我们用从指令接收到的更新后的<strong class="ke io"> clonedList </strong>数组来更新<strong class="ke io"> notes </strong>数组。</p><pre class="ls lt lu lv gt mr ms mt mu aw mv bi"><span id="ea15" class="mw mx in ms b gy my mz l na nb"><strong class="ms io">returnUpdatedList(data) {</strong><br/>this.notes = data;<br/>}</span></pre><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nd"><img src="../Images/cd12e8f6aac32a76aa79e786158e1ddb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MpYtAcHXSRKiQU3alSh1CA.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Note1 and Note2 have been swapped</figcaption></figure><p id="0d25" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面的例子可以在下面找到。</p><div class="ky kz gp gr la lb"><a href="https://stackblitz.com/edit/angular-jxifrf?file=src/app/app.component.ts" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd io gy z fp lg fr fs lh fu fw im bi translated">角形(叉形)堆叠</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">编辑描述</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">stackblitz.com</p></div></div><div class="lk l"><div class="ne l lm ln lo lk lp lq lb"/></div></div></a></div><p id="7ca9" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nf">更多内容请看</em><a class="ae ng" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="nf">plain English . io</em></strong></a><em class="nf">。报名参加我们的</em> <a class="ae ng" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nf">免费周报</em> </strong> </a> <em class="nf">。在我们的</em> <a class="ae ng" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nf">社区不和谐</em> </strong> </a> <em class="nf">获取独家写作机会和建议。</em></p></div></div>    
</body>
</html>