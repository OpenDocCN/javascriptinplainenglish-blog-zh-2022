<html>
<head>
<title>How to build your own gas estimator â€” Ethereum EIP-1559</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•æ„å»ºè‡ªå·±çš„æ°”ä½“ä¼°ç®—å™¨â€”ä»¥å¤ªåŠEIP-1559</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://javascript.plainenglish.io/how-to-build-your-own-gas-estimator-ethereum-eip-1559-4c340cf8992b?source=collection_archive---------14-----------------------#2022-12-27">https://javascript.plainenglish.io/how-to-build-your-own-gas-estimator-ethereum-eip-1559-4c340cf8992b?source=collection_archive---------14-----------------------#2022-12-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0172" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">ä½¿ç”¨Alchemyï¼Œå³æœ€æµè¡Œçš„åŒºå—é“¾æä¾›å•†ï¼ŒJavaScriptå’Œethersåº“</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/16bce4002c9a9896b083357285099e26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kHb51BUiHiA2RznDpngQ3g.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Build your own gas estimator with JS and Alchemy</figcaption></figure><p id="1ddc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">è®©æˆ‘å‘æ‚¨å±•ç¤ºå¦‚ä½•åˆ›å»ºæ‚¨è‡ªå·±çš„å¤©ç„¶æ°”ä¼°ç®—å™¨ï¼Œä»¥ç¡®ä¿æ‚¨çš„äº¤æ˜“å°†è¢«åŒ…æ‹¬åœ¨å†…ï¼Œå¹¶å°½å¯èƒ½å…·æœ‰æˆæœ¬æ•ˆç›Šã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœä½ åªæ˜¯ä¸ºäº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆè€Œæ¥ï¼Œå®Œæ•´çš„è„šæœ¬å¯ä»¥åœ¨æ–‡ç« æœ«å°¾æ‰¾åˆ°ã€‚</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h2 id="dc7a" class="ly lz iq bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">EIPä¹‹åçš„æ°”ä½“ç±»å‹å’Œç†è®ºâ€”â€”1559</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/13fa423d089d790c2e0a37d82fd7cec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hSq8_mq8kZeDwgl5xMP4rQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Different types of fees that we specify in EIP 1559</figcaption></figure><p id="01ab" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">é¦–å…ˆï¼Œè®©æˆ‘ä»¬æŠŠç†è®ºæé«˜åˆ°è¶³å¤Ÿçš„æ°´å¹³ï¼Œè¿™æ ·ä½ å°±å¯ä»¥çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•æ­£ç¡®ä½¿ç”¨å®ƒã€‚è‡ªä»EIP-1559åˆå¹¶ä»¥æ¥ï¼Œæ°”ä½“æœºåˆ¶å‘ç”Ÿäº†å˜åŒ–ã€‚æˆ‘ä»¬æœ‰ä¸¤ç§è´¹ç”¨:</p><p id="3d48" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">åŸºæœ¬è´¹ç”¨:</strong>ç”±ç½‘ç»œè‡ªè¡Œç¡®å®šã€‚æ€ä¹ˆä¼šï¼Ÿæ¯ä¸ªåŒºå—éƒ½æœ‰ä¸€ä¸ªç”¨æ°”é‡é™åˆ¶ï¼Œè®¾ç½®ä¸º30Mï¼Œæ‰€ä»¥å¯ä»¥æ˜¯0åˆ°30Mä¹‹é—´çš„ä¸€ä¸ªæ•°å­—ã€‚å¦‚æœæ°”ä½“ä½¿ç”¨æ¯”ç‡ï¼Œå³æ ¹æ®æœ€å¤§å€¼ä½¿ç”¨çš„æ°”ä½“ç™¾åˆ†æ¯”è¶…è¿‡50%ï¼Œåˆ™å¢åŠ 12.5%ï¼Œå¦‚æœä½äºæœ€å¤§å€¼ï¼Œåˆ™å‡å°‘12.5%ï¼Œå¦‚æœæ­£å¥½ä¸º50%ï¼Œåˆ™ä¿æŒä¸å˜ã€‚ç®€å•è®¡ç®—ï¼Œç»“æœæ˜¯50%çš„1%çš„å˜åŠ¨å’ŒåŸºæœ¬è´¹ç”¨å¢åŠ æˆ–å‡å°‘0.25%ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/80d182d549ef99e88f3730b04eca423d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yBYw6CRD0Y71AtDFMdGLlg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Base fee determination</figcaption></figure><p id="95a4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">ä¼˜å…ˆæƒè´¹:</strong>å¦ä¸€æ–¹é¢ä¼˜å…ˆæƒè´¹æ˜¯çŸ¿å·¥çš„ã€‚æ‰€ä»¥æ‰å«ä¼˜å…ˆã€‚å¦‚æœä½ æƒ³æˆä¸ºç¬¬ä¸€ï¼Œä½ éœ€è¦ä»˜é’±ã€‚å‘é€äº¤æ˜“çš„æœ€å¸¸è§æ–¹å¼æ˜¯æŒ‡å®šä¼˜å…ˆè´¹ç”¨ï¼Œå› ä¸ºåŸºæœ¬è´¹ç”¨ä¼šè‡ªåŠ¨è®¾ç½®ã€‚</p><p id="0024" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">æœ€é«˜è´¹ç”¨:</strong>å‘Šè¯‰ä½ æ€»å…±è¦èŠ±å¤šå°‘é’±ï¼Œå³åŸºæœ¬è´¹ç”¨+ä¼˜å…ˆè´¹ç”¨ã€‚</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h2 id="49ef" class="ly lz iq bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">å¦‚ä½•ä¼°è®¡ä½ éœ€è¦å¤šå°‘æ±½æ²¹</h2><p id="2bc0" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">â€œä¼°è®¡â€æ˜¯è¿™é‡Œçš„å…³é”®è¯ã€‚ä½ æ°¸è¿œä¸çŸ¥é“ä½ éœ€è¦å¤šå°‘ä¼˜å…ˆæƒè´¹æ‰èƒ½è¢«æ”¶å½•ï¼Œä½†æ˜¯ä½ å¯ä»¥éå¸¸æ¥è¿‘ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œéå¸¸æ¥è¿‘é€šå¸¸å°±è¶³å¤Ÿäº†ã€‚è¿™æ˜¯æˆ‘ä»¬å°†éµå¾ªçš„ä¸‰æ­¥æµç¨‹:</p><ol class=""><li id="4642" class="mw mx iq kx b ky kz lb lc le my li mz lm na lq nb nc nd ne bi translated">è·å–æœ€åxå—è´¹ç”¨ä¿¡æ¯</li><li id="55d2" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated">é‡ç»„å®ƒï¼Œè¿™æ ·æ›´å®¹æ˜“ä»ä¿¡æ¯ä¸­å¾—å‡ºç»“è®º</li><li id="a45f" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated">é€€å›ä¼°ä»·</li></ol></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h2 id="56e3" class="ly lz iq bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">å»ºç«‹</h2><p id="0ad7" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">å› ä¸ºæˆ‘ä»¬ä½¿ç”¨ç‚¼é‡‘æœ¯ï¼Œä½ éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯è·å¾—ä½ çš„APIå¯†åŒ™/ URLã€‚ä½ å¯ä»¥é€šè¿‡è¿›å…¥<a class="ae nk" href="https://alchemy.com/?r=e4ff0bfe-6af8-4b99-aed8-ed199ae6cc2a" rel="noopener ugc nofollow" target="_blank"> alchemy dashboard </a>(æ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå‚è€ƒé“¾æ¥)ï¼Œä¸ºä½ æƒ³è¦çš„ä»»ä½•ç½‘ç»œåˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå¹¶è·å¾—ä½ éœ€è¦çš„ä¸œè¥¿ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/7fdb998d4090c54f2d908a33ebdcb4fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JK0pPJZJ8IFo9zHB1MCa1w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Alchemy Keys Modal</figcaption></figure><h2 id="cc5e" class="ly lz iq bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">è·å–æœ€å20å—è´¹ç”¨ä¿¡æ¯</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Fetchfees script</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/a5608bd53af8a87ca2168d8d175fcf2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*LQLitF-k3VmLH3Z1rAclFg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Data we get back</figcaption></figure><p id="6cb9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">ä¸ºä»€ä¹ˆæ˜¯20ä¸ªå†å²è¡—åŒºï¼Ÿå› ä¸ºè¿™æ˜¯å¤§å¤šæ•°å•†ä¸šè§£å†³æ–¹æ¡ˆ(ethersã€web3ç­‰)çš„æ•°é‡ã€‚)ä½¿ç”¨ã€‚è¿™é‡Œçš„è¦ç‚¹æ˜¯è·å–è¶³å¤Ÿçš„æ•°æ®ä»¥å¾—å‡ºæœ‰æ„ä¹‰çš„ç»“è®ºã€‚æ¯ä¸ªå‚æ•°æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿè®©æˆ‘ä»¬æ·±å…¥ç ”ç©¶ä¸€ä¸‹ã€‚</p><h2 id="ffc3" class="ly lz iq bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated"><strong class="ak">å¥–åŠ±</strong></h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/9b9f783d538350605dbdcfb749226cd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*uVagkqa59jtboRBZvbX3Bw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Reward array</figcaption></figure><p id="d03f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">è¿™äº›æ•°ç»„ä»£è¡¨ä»€ä¹ˆï¼Ÿä»–ä»¬å‘Šè¯‰æˆ‘ä»¬ä»€ä¹ˆæ˜¯ä¼˜å…ˆæƒè´¹çš„é—¨æ§›ï¼Œç”¨åœ¨ä¸€ä¸ªç»™å®šçš„ç™¾åˆ†ä½æ•°ã€‚æˆ‘ä»¬å°†å…¶æŒ‡å®šä¸ºparamsçš„æœ€åä¸€ä¸ªå‚æ•°ã€‚ä¸ºä»€ä¹ˆæ˜¯1ã€50ã€90ï¼Ÿè¿™åˆæ˜¯ä¸€ä¸ªè¯•é”™çš„é—®é¢˜ã€‚æˆ‘å¯åŠ¨äº†ä¸€ä¸ªå¤šè¾¹å½¢åŠ æ²¹ç«™ï¼Œå¹¶æ­£åœ¨è°ƒæ•´å®ƒã€‚</p><pre class="kg kh ki kj gt nq nr ns bn nt nu bi"><span id="f652" class="nv lz iq nr b be nw nx l ny nz">const { data } = await axios.post(URL, {<br/>  id: 1,<br/>  jsonrpc: "2.0",<br/>  method: "eth_feeHistory",<br/>  params: [historicalBlocks, "latest", [1, 50, 90]],<br/>});</span></pre><p id="a39a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">ç™¾åˆ†ä½æ•°å‘Šè¯‰æˆ‘ä»¬ä»€ä¹ˆæ˜¯ç»™å®šç™¾åˆ†æ¯”çš„ä¼˜å…ˆè´¹ç”¨ã€‚åŸºæœ¬ä¸Šï¼Œè¿™æ„å‘³ç€å¦‚æœ0x9502f900æ˜¯[1ï¼Œ50ï¼Œ90]æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªï¼Œé‚£ä¹ˆå¦‚æœæ‚¨å‘é€å…·æœ‰è¯¥ä¼˜å…ˆçº§è´¹ç”¨çš„äº‹åŠ¡ï¼Œå®ƒå°†æœ‰90%çš„å¯èƒ½æ€§è¢«åŒ…å«åœ¨ä¸‹ä¸€ä¸ªå—ä¸­ã€‚</p><h2 id="e3f9" class="ly lz iq bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">æ¯æ°”åŸºæœ¬è´¹ç”¨</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/046cdbabd5cb5909293944d3e9c8af89.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*hYX1qmiuyPpGKHQhx4iTew.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">baseFeePerGas return parameter</figcaption></figure><p id="131d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">ç¬¬ä¸€å—æ˜¯æœ€æ–°çš„ä¸€å—ï¼Œå³æœ€è¿‘çš„ä¸€å—ã€‚å› ä¸ºåŸºæœ¬è´¹ç”¨æ˜¯è‡ªåŠ¨è®¾å®šçš„ï¼Œæ‰€ä»¥å†å²è´¹ç”¨å¹¶ä¸é‚£ä¹ˆæœ‰ç”¨ã€‚ä¹Ÿè®¸ä½ ä¼šçŸ¥é“å¦‚ä½•è¿›ä¸€æ­¥ä½¿ç”¨å®ƒï¼Œæ‰€ä»¥æˆ‘å°±æŠŠå®ƒç•™åœ¨è¿™é‡Œã€‚</p><h2 id="9376" class="ly lz iq bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">æ°”ä½“ä½¿ç”¨æ¯”ç‡</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/89231909f272c01913a6e484490fb01e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*-LCLNXBdVnecTxaCgrXNxA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Gas Used Ratio</figcaption></figure><p id="71d3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">ç”±äºè¿™ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåˆ¤æ–­ä¸‹ä¸€ä¸ªå—çš„åŸºæœ¬è´¹ç”¨æ˜¯å¤§äºè¿˜æ˜¯å°äºå‰ä¸€ä¸ªã€‚ä¸è¿‡ï¼Œä½ åªéœ€è¦æœ€åä¸€ä¸ªã€‚</p><h2 id="dd8d" class="ly lz iq bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">é‡ç»„</h2><p id="12e1" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">é€šå¸¸ï¼Œæˆ‘ä»¬å¸Œæœ›ä»¥æ›´æœ‰ç”¨çš„æ–¹å¼ç»„ç»‡æ•°æ®ã€‚å½’æ ¹ç»“åº•ï¼Œä»£ç çš„ç®€å•æ€§å¾ˆé‡è¦ã€‚è¿™æ­£æ˜¯formatFeeHistoryå‡½æ•°çš„ä½œç”¨ã€‚</p><pre class="kg kh ki kj gt nq nr ns bn nt nu bi"><span id="301b" class="nv lz iq nr b be nw nx l ny nz">function formatFeeHistory(result) {<br/>  let blockNum = Number(result.oldestBlock);<br/>  let index = 0;<br/>  const blocks = [];<br/><br/>  while (blockNum &lt; Number(result.oldestBlock) + historicalBlocks) {<br/>    blocks.push({<br/>      number: blockNum,<br/>      baseFeePerGas: Number(result.baseFeePerGas[index]),<br/>      gasUsedRatio: Number(result.gasUsedRatio[index]),<br/>      priorityFeePerGas: result.reward[index].map((x) =&gt; Number(x) / 1e9),<br/>    });<br/>    blockNum += 1;<br/>    index += 1;<br/>  }<br/><br/>  return blocks;<br/>}</span></pre><p id="0e3b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">æˆ‘ä»¬ä»å“åº”ä¸­è·å–data.resultï¼Œå¹¶åˆ›å»ºä¿å­˜æ‰€æœ‰ä¸æ•°æ®å—ç›¸å…³çš„æ•°æ®çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›å°†æ‰€æœ‰å˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œè€Œä¸æ˜¯è·³åˆ°å¤šä¸ªæ•°æ®æºä¸Šã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªç®€å•çš„è¿­ä»£ç»“æ„ï¼Œå°±åƒè¿™æ ·:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/3a433e1d4ed177d420ce7f66c028b356.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BPcgEFRlhXgftba090Bc8g.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Results of formatFeeHistory function</figcaption></figure><h2 id="621b" class="ly lz iq bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">é€€å›ä¼°ä»·</h2><p id="59ce" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†æˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬å—æ•°ã€åŸºæœ¬è´¹ç”¨ã€ç”¨æ°”æ¯”ç‡å’Œæ ¹æ®ç™¾åˆ†æ¯”çš„ä¼˜å…ˆè´¹ç”¨ã€‚è¿˜æœ‰ä¸€ä»¶äº‹:</p><pre class="kg kh ki kj gt nq nr ns bn nt nu bi"><span id="4894" class="nv lz iq nr b be nw nx l ny nz">function avg(arr) {<br/>  const sum = arr.reduce((a, v) =&gt; a + v);<br/>  return Math.round(sum / arr.length);<br/>}<br/>...<br/><br/>const blocks = formatFeeHistory(data.result);<br/><br/>console.log(blocks);<br/><br/>const slow = avg(blocks.map((b) =&gt; b.priorityFeePerGas[0]));<br/>const average = avg(blocks.map((b) =&gt; b.priorityFeePerGas[1]));<br/>const fast = avg(blocks.map((b) =&gt; b.priorityFeePerGas[2]));<br/><br/>const provider = new ethers.providers.JsonRpcProvider(URL);<br/><br/>const currentBlock = await provider.getBlock("latest");<br/><br/>const baseFee = Number(currentBlock.baseFeePerGas.toString()) / 1e9;<br/><br/>console.log("Manual estimate max priority fee:", {<br/>  slow: slow,<br/>  average: average,<br/>  fast: fast,<br/>});<br/><br/>console.log("\nBaseFee: ", baseFee, "\n");<br/><br/>console.log("Manual estimate MaxFeePerGas:", {<br/>  slow: slow + baseFee,<br/>  average: average + baseFee,<br/>  fast: fast + baseFee,<br/>});<br/><br/>console.log("All prices are in gwei");</span></pre><p id="31e1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">æœ€åä¸€ä»¶äº‹æ˜¯é€šè¿‡ç´¢å¼•èšåˆpriorityFeePerGasï¼Œè¡¨ç¤ºæˆ‘ä»¬åœ¨å‰é¢çš„æ­¥éª¤ä¸­ä½œä¸ºparamsçš„æœ€åä¸€ä¸ªå‚æ•°ä¼ é€’çš„ç´¢å¼•ã€‚æˆ‘ä»¬ç”¨å¹³å‡å€¼ä½œä¸ºå‡½æ•°æ¥ä¼°ç®—æ°”ä½“ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/d81f75e3a0e419a29b98260de047d412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sAG43YfJ4gTbH17Jajv1wA.png"/></div></div></figure><p id="f6a9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæ‰€æœ‰çš„ä»·æ ¼éƒ½ç”¨gweiè¡¨ç¤ºï¼Œä¹Ÿå°±æ˜¯ä»åˆ°çš„weiï¼Œä»¥ä¾¿äºé˜…è¯»ã€‚æŠŠç»“æœé™¤ä»¥1e9ä¹Ÿå¯ä»¥å¾—åˆ°åŒæ ·çš„ç»“æœã€‚</p><h2 id="7483" class="ly lz iq bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">å¦‚ä½•åœ¨ä»£ç ä¸­è®¾ç½®maxFeePerGas</h2><p id="c48c" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">å¦‚æœæ‚¨æƒ³åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨maxFeePerGasï¼Œæ‚¨å¯ä»¥è¿™æ ·åš:</p><pre class="kg kh ki kj gt nq nr ns bn nt nu bi"><span id="f24f" class="nv lz iq nr b be nw nx l ny nz">// Setting in transaction object<br/>tx.maxFeePerGas = maxFeePerGas;<br/>...<br/>const sentTx = await wallet.sendTransaction(tx);<br/><br/>// Setting in deploy contract function<br/>contract = await Factory.deploy({ maxFeePerGas: fees.maxFeePerGas.fast });</span></pre><h2 id="0696" class="ly lz iq bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">æ€»ç»“ä¸€ä¸‹</h2><p id="0379" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">å¦‚ä½ æ‰€è§ï¼Œåˆ›å»ºè‡ªå·±çš„æ°”ä½“ä¼°ç®—å™¨å¹¶ä¸å¤æ‚ã€‚æœ‰äº†ç‚¼é‡‘æœ¯ï¼Œä½ å¯ä»¥æ¥è§¦åˆ°æ¯ä¸€ä¸ªä¸»è¦çš„EVMåŒºå—é“¾ï¼Œæ‰€ä»¥è¿™å¾ˆç®€å•ã€‚å¦‚æœä½ æƒ³è·å¾—å®Œæ•´çš„è„šæœ¬ï¼Œè¿™é‡Œæ˜¯:</p><pre class="kg kh ki kj gt nq nr ns bn nt nu bi"><span id="3b98" class="nv lz iq nr b be nw nx l ny nz">import { ethers } from "ethers";<br/>import axios from "axios";<br/><br/>const historicalBlocks = 20;<br/><br/>export const getGasPriceAlchemy = async (chain) =&gt; {<br/>  const { data } = await axios.post(<br/>    `https://eth-mainnet.g.alchemy.com/v2/${API_KEY}`,<br/>    {<br/>      id: 1,<br/>      jsonrpc: "2.0",<br/>      method: "eth_maxPriorityFeePerGas",<br/>    }<br/>  );<br/><br/>  console.log(data.result);<br/>  console.log(parseInt(data.result, 16));<br/>};<br/><br/>function formatFeeHistory(result) {<br/>  let blockNum = Number(result.oldestBlock);<br/>  let index = 0;<br/>  const blocks = [];<br/><br/>  while (blockNum &lt; Number(result.oldestBlock) + historicalBlocks) {<br/>    blocks.push({<br/>      number: blockNum,<br/>      baseFeePerGas: Number(result.baseFeePerGas[index]),<br/>      gasUsedRatio: Number(result.gasUsedRatio[index]),<br/>      priorityFeePerGas: result.reward[index].map((x) =&gt; Number(x) / 1e9),<br/>    });<br/>    blockNum += 1;<br/>    index += 1;<br/>  }<br/><br/>  return blocks;<br/>}<br/><br/>function avg(arr) {<br/>  const sum = arr.reduce((a, v) =&gt; a + v);<br/>  return Math.round(sum / arr.length);<br/>}<br/><br/>const getFeeHistory = async (chain) =&gt; {<br/>  const URL = `https://${chain}.g.alchemy.com/v2/${API_KEY}`;<br/><br/>  const { data } = await axios.post(URL, {<br/>    id: 1,<br/>    jsonrpc: "2.0",<br/>    method: "eth_feeHistory",<br/>    params: [historicalBlocks, "latest", [1, 50, 99]],<br/>  });<br/><br/>  // console.log(data.result.reward);<br/><br/>  // return;<br/><br/>  const blocks = formatFeeHistory(data.result);<br/><br/>  // console.log(blocks);<br/><br/>  const slow = avg(blocks.map((b) =&gt; b.priorityFeePerGas[0]));<br/>  const average = avg(blocks.map((b) =&gt; b.priorityFeePerGas[1]));<br/>  const fast = avg(blocks.map((b) =&gt; b.priorityFeePerGas[2]));<br/><br/>  const provider = new ethers.providers.JsonRpcProvider(URL);<br/><br/>  const currentBlock = await provider.getBlock("latest");<br/><br/>  const baseFee = Number(currentBlock.baseFeePerGas.toString()) / 1e9;<br/><br/>  console.log("Manual estimate max priority fee:", {<br/>    slow: slow,<br/>    average: average,<br/>    fast: fast,<br/>  });<br/><br/>  console.log("\nBaseFee: ", baseFee, "\n");<br/><br/>  console.log("Manual estimate MaxFeePerGas:", {<br/>    slow: slow + baseFee,<br/>    average: average + baseFee,<br/>    fast: fast + baseFee,<br/>  });<br/><br/>  console.log("All prices are in gwei");<br/><br/>};<br/><br/>getFeeHistory("eth-mainnet");</span></pre><p id="fd09" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">å¦‚æœå¯¹ä½ æœ‰å¸®åŠ©ï¼Œä½ å¯ä»¥å…³æ³¨æˆ‘çš„æ¨ç‰¹(Twitter ),è·å–æ›´å¤šç±»ä¼¼â¤.çš„å†…å®¹</p><p id="11bc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">å†è§ç¼–ç å‘˜ğŸ’»</p><p id="078f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="oe">æ›´å¤šå†…å®¹è¯·çœ‹</em><a class="ae nk" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="oe">plain English . io</em></strong></a><em class="oe">ã€‚æŠ¥åå‚åŠ æˆ‘ä»¬çš„</em> <a class="ae nk" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir"> <em class="oe">å…è´¹å‘¨æŠ¥</em> </strong> </a> <em class="oe">ã€‚å…³æ³¨æˆ‘ä»¬å…³äº</em><a class="ae nk" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="oe">Twitter</em></strong></a><a class="ae nk" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="oe">LinkedIn</em></strong></a><strong class="kx ir"><em class="oe"/></strong><a class="ae nk" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="oe">YouTube</em></strong></a><strong class="kx ir"><em class="oe">ï¼Œä»¥åŠ</em></strong><em class="oe"/><a class="ae nk" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="oe">ä¸å’Œ</em> </strong> </a>T55ã€‘</p><p id="9e07" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> <em class="oe">ç”¨</em> </strong> <a class="ae nk" href="https://circuit.ooo/?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir"> <em class="oe">ç”µè·¯</em> </strong> </a> <em class="oe">ä¸ºä½ çš„ç§‘æŠ€åˆ›ä¸šå»ºç«‹è®¤çŸ¥å’Œé‡‡ç”¨ã€‚</em></p></div></div>    
</body>
</html>