<html>
<head>
<title>Learn JavaScript Scopes with Examples</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过示例了解JavaScript作用域</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/scopes-in-javascript-ebf776d42430?source=collection_archive---------18-----------------------#2022-02-03">https://javascript.plainenglish.io/scopes-in-javascript-ebf776d42430?source=collection_archive---------18-----------------------#2022-02-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="fb4a" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">用实际例子理解JavaScript最容易混淆的部分之一。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/c43b64cd419cd9eb7d77f0877e45f600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l3yRTxnPj3kLtG7FNgGkuw.png"/></div></div></figure><p id="3199" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">让我们从简单的任务开始。查看下面的代码，告诉我我们会在控制台中看到什么:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lk ll l"/></div></figure><p id="7ce2" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">接下来的差不多了，我们唯一需要的就是把<strong class="kq io"> <em class="lm"> var </em> </strong>改成<strong class="kq io"> <em class="lm"> let </em> </strong>。你认为我们现在会看到什么？</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lk ll l"/></div></figure><p id="a7e6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果您认为在第一种情况下，输出将是:</p><pre class="kd ke kf kg gt ln lo lp lq aw lr bi"><span id="2c6f" class="ls lt in lo b gy lu lv l lw lx"><em class="lm">(wait 0sec) 3 (wait 1sec) 3 (wait 1sec ) 3</em></span></pre><p id="a35a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">其次是:</p><pre class="kd ke kf kg gt ln lo lp lq aw lr bi"><span id="0695" class="ls lt in lo b gy lu lv l lw lx"><em class="lm">(wait 0sec) 0 (wait 1sec) 1 (wait 1sec ) 2</em></span></pre><p id="996c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">那么你是正确的。但是为什么呢？我们只改变了一个词，但得到了不同的结果。这是因为JavaScript作用域，这是该语言中最棘手的部分之一。如果你不理解上面的例子，不要担心，几乎没有人理解:)</p><h1 id="f492" class="ly lt in bd lz ma mb mc md me mf mg mh jt mi ju mj jw mk jx ml jz mm ka mn mo bi translated">什么是范围？</h1><p id="27ec" class="pw-post-body-paragraph ko kp in kq b kr mp jo kt ku mq jr kw kx mr kz la lb ms ld le lf mt lh li lj ig bi translated">作用域是你可以<strong class="kq io">访问</strong>变量(或函数)的地方，在所有其他没有定义变量的地方。而且比较棘手的是，JavaScript有<strong class="kq io">两种类型的</strong>作用域:<strong class="kq io">功能</strong>和<strong class="kq io">块</strong>。</p><p id="f9dd" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当你用<strong class="kq io"> var </strong>或<strong class="kq io"> function </strong>关键字定义你的变量(或函数)时，就创建了函数作用域。将为用<strong class="kq io"> let </strong>或<strong class="kq io"> const </strong>关键字定义的变量创建块范围。</p><p id="26c8" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在处理功能范围时要考虑的一件重要事情是可变提升。这意味着变量的声明将放在离函数最近的<strong class="kq io">之上。</strong></p><p id="76eb" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">让我们看看功能范围和提升在示例中是如何工作的:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lk ll l"/></div></figure><p id="0d02" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们可以稍微重写一下上面的代码，以便更好地理解提升是如何工作的:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lk ll l"/></div></figure><h1 id="a53b" class="ly lt in bd lz ma mb mc md me mf mg mh jt mi ju mj jw mk jx ml jz mm ka mn mo bi translated">块范围</h1><p id="1fab" class="pw-post-body-paragraph ko kp in kq b kr mp jo kt ku mq jr kw kx mr kz la lb ms ld le lf mt lh li lj ig bi translated">所以功能定义了功能范围。而且毫不奇怪，代码块(<strong class="kq io"> <em class="lm"> {} </em> </strong>)就是块作用域的定义。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lk ll l"/></div></figure><h1 id="6263" class="ly lt in bd lz ma mb mc md me mf mg mh jt mi ju mj jw mk jx ml jz mm ka mn mo bi translated">回到我们开始的地方</h1><p id="37ee" class="pw-post-body-paragraph ko kp in kq b kr mp jo kt ku mq jr kw kx mr kz la lb ms ld le lf mt lh li lj ig bi translated">正如你可能已经理解的，我们在第一个例子中使用了不同类型的作用域。这就是为什么我们得到了两个完全不同的结果。但是为了让它更明显，让我们重写它们来看看。</p><p id="9e51" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">第一个:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lk ll l"/></div></figure><p id="ed45" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">或者我们可以使用while循环重写相同的代码(这将有助于我们理解第二个示例):</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lk ll l"/></div></figure><p id="8fe6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">下面是上面的代码是如何一步一步地工作的(不管什么类型的<br/>循环在<em class="lm">上对</em>和<em class="lm">使用相同的逻辑工作，而</em>):</p><ol class=""><li id="3306" class="mu mv in kq b kr ks ku kv kx mw lb mx lf my lj mz na nb nc bi translated">在第一次迭代<strong class="kq io">时，i = 0 </strong>，因此超时延迟为i*1000 = 0</li><li id="216d" class="mu mv in kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">setTimeout函数将超时回调的执行延迟0秒</li><li id="d3de" class="mu mv in kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">因此超时回调不会立即运行，而是只在<strong class="kq io">事件循环的下一阶段</strong>运行</li><li id="b3ac" class="mu mv in kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">循环继续运行，现在<strong class="kq io"> i = 1 </strong>，所以现在延迟1秒，然后<strong class="kq io"> i = 2 </strong></li><li id="279a" class="mu mv in kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">并且在最后一步<strong class="kq io"> i = 3 </strong>(但是循环没有运行，因为我们有一个条件i &lt; 3)</li><li id="70cf" class="mu mv in kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">在我们的周期中，我们注册了3个0、1、2秒延迟的超时回调</li><li id="eb22" class="mu mv in kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">我们的循环结束了，甚至循环继续，现在超时回调代码开始运行</li><li id="db90" class="mu mv in kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">所以现在，就像此刻一样，<strong class="kq io"> i = 3 </strong>，所有3个回调都将打印<strong class="kq io"> 3 </strong>作为输出。</li></ol><p id="bccc" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当我们用<strong class="kq io"> <em class="lm"> var </em> </strong>关键字声明变量时，我们让它在所有超时回调中共享，由于这些回调只在循环结束后运行<strong class="kq io">，它们将看到相同的值。</strong></p><p id="4e78" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了突出第二个示例中的块范围，我使用了一个while循环:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lk ll l"/></div></figure><p id="a020" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">代码的工作方式与第一个例子相同，唯一的区别是<strong class="kq io"> i </strong>没有在超时回调中共享，所以每个回调都有自己的值。</p></div><div class="ab cl ni nj hr nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ig ih ii ij ik"><p id="0e2d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这两个简单的例子向我们展示了JavaScript语言隐藏的复杂性，现在我们明白它们是如何工作的了。</p><p id="ee80" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="lm">更多内容看</em> <a class="ae np" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lm">说白了。报名参加我们的</em> <a class="ae np" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lm">免费周报</em> </strong> </a> <em class="lm">。在我们的</em> <a class="ae np" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lm">社区不和谐</em> </strong> </a> <em class="lm">获得独家获取写作机会和建议。</em></strong></a></p></div></div>    
</body>
</html>