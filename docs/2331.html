<html>
<head>
<title>How to Create an Infinite Scroll Effect using React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用React创建无限滚动效果</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-an-infinite-scroll-effect-using-react-524d2b6fcde4?source=collection_archive---------4-----------------------#2022-05-31">https://javascript.plainenglish.io/how-to-create-an-infinite-scroll-effect-using-react-524d2b6fcde4?source=collection_archive---------4-----------------------#2022-05-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/70d053133b7abd7b3a61a6cf2dab2922.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XFr_lMUI8YDSocgXADy0RA.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://www.pexels.com/@kseverin/" rel="noopener ugc nofollow" target="_blank">Kerde Severin</a> on <a class="ae jz" href="https://www.pexels.com/photo/selective-focus-photography-of-person-using-iphone-x-1542252/" rel="noopener ugc nofollow" target="_blank">pexels</a></figcaption></figure><p id="3569" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这篇博客中，我将回顾我是如何在React中创建无限滚动效果的。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ky"><img src="../Images/c8898610a4c0946c0279e2af71a91788.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*Ahmwd9IIWf6ZMOVQU0HhxQ.gif"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Final product we will be creating</figcaption></figure></div><div class="ab cl ld le hr lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ig ih ii ij ik"><p id="7123" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，我创建了一个express API。该API有一个带有请求参数page的端点。端点将返回一个包含十个数据元素的数组，这些数据元素对应于特定的页面。服务器代码如下所示。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="lk ll l"/></div></figure><p id="2f22" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我们将使用下面的命令<code class="fe lm ln lo lp b">npx create-react-app client —-template typescript</code>创建React应用程序。</p><p id="7d3c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注:如果您正在使用<code class="fe lm ln lo lp b">React version 18.1.0</code>，您可能需要移除。<code class="fe lm ln lo lp b">&lt;React.StrictMode&gt;</code>标签来自<code class="fe lm ln lo lp b">index.tsx</code>。在React的最近一次更新之后，您会注意到组件在第一次挂载时被挂载、卸载和重新挂载。你可以在这里阅读更多关于这些变化的信息<a class="ae jz" href="https://github.com/facebook/react/blob/main/CHANGELOG.md#react-1," rel="noopener ugc nofollow" target="_blank">。下面你可以看到<code class="fe lm ln lo lp b">index.tsx</code>文件应该是什么样子。</a></p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="lk ll l"/></div></figure><p id="0764" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我们可以在<code class="fe lm ln lo lp b">App.tsx</code>开始编码。我们将从创建三种状态开始:页面、数据和加载。页面状态将包含一个数字，随着我们不断检索更多的数据，这个数字将会更新。数据状态将是一个数组，它保存将要显示的所有数据。在我的例子中，这个数据数组将是一个数字数组。最后，加载状态将是一个布尔值，用于显示加载动画。</p><p id="b953" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我们还将创建一个函数，该函数将生成卡片来显示我们的数据，以及一个useEffect，该函数将用于在页面发生变化时更新数据状态。你的<code class="fe lm ln lo lp b">App.tsx</code>最后应该是这样的，显示前十张卡片。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="lk ll l"/></div></figure><p id="4f4e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一旦我们有了这些，我们就可以开始研究当我们滚动到列表底部时自动获取更多数据的逻辑。为此，我们将使用<a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API" rel="noopener ugc nofollow" target="_blank">交集观察者API </a>和<a class="ae jz" href="https://reactjs.org/docs/hooks-reference.html#useref" rel="noopener ugc nofollow" target="_blank"> React的useRef钩子</a>。</p><p id="159e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">相交观察器应用编程接口检测观察到的元素何时在视图中。一旦观察到的元素在视图中，我们将更新页面状态，触发useEffect获取更多数据。在这种情况下，我只想观察一个元素，列表的最后一个元素。这意味着我必须不断地将观察到的元素更新为列表中的最后一个元素。为此，我们可以添加一个新的状态，我称之为<code class="fe lm ln lo lp b">elem</code>并将<code class="fe lm ln lo lp b">setElem</code>添加到列表的最后一个元素中。这可以通过修改<code class="fe lm ln lo lp b">createCard</code>功能和用于渲染卡片的地图语句来完成。我们还将创建一个具有<code class="fe lm ln lo lp b">useRef</code>的相交观察者对象。通过使用<code class="fe lm ln lo lp b">useRef</code>我们将能够在重新渲染时跟踪<code class="fe lm ln lo lp b">observer</code>对象。在下面，您可以看到所做的更改。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="lk ll l"/></div></figure><p id="0f16" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，我们还将创建一个useEffect，用于更新observe元素。它将首先检查当前是否有可以观察到的元素。如果有，它将更新观察者以便观察当前元素。一旦观察到的元素进入视图，交集观察者回调将被触发，更新页码并获取更多数据。这将渲染更多的牌，触发<code class="fe lm ln lo lp b">setElem</code>。它将从观察前一个元素开始，然后观察列表中的最后一个元素，从开始开始循环。在下面，您可以看到useEffect应该是什么样子。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="lk ll l"/></div></figure><p id="de6d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">结合所有这些，<code class="fe lm ln lo lp b">App.tsx</code>应该是这样的。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="lk ll l"/></div></figure></div><div class="ab cl ld le hr lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ig ih ii ij ik"><p id="0b65" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">希望本指南能有所帮助。直到下次。快乐编码！</p><p id="c724" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="lq">更多内容请看</em><a class="ae jz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="lq">plain English . io</em></strong></a><em class="lq">。报名参加我们的</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="lq">免费周报</em> </strong> </a> <em class="lq">。关注我们关于</em><a class="ae jz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="lq">Twitter</em></strong></a><em class="lq">和</em><a class="ae jz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="lq">LinkedIn</em></strong></a><em class="lq">。查看我们的</em> <a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="lq">社区不和谐</em> </strong> </a> <em class="lq">加入我们的</em> <a class="ae jz" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="lq">人才集体</em> </strong> </a> <em class="lq">。</em></p></div></div>    
</body>
</html>