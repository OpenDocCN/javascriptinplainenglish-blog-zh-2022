<html>
<head>
<title>How to Use the useState Hook in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React中使用useState钩子</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-the-state-hook-in-react-dcc10fd8d1b8?source=collection_archive---------9-----------------------#2022-07-28">https://javascript.plainenglish.io/how-to-use-the-state-hook-in-react-dcc10fd8d1b8?source=collection_archive---------9-----------------------#2022-07-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="031f" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">了解React中最常用的钩子之一。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/518f70ba9024beb4be2ec3abfe330abe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8Gnmg-SEZZidO77d"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@lautaroandreani?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Lautaro Andreani</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3bfa" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">React是一个由组件组成的世界。</p><p id="818b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">组件本身维护它们自己的“状态”。</p><p id="1661" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你可能会问，什么是“状态”？</p><p id="587e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">状态只是一个普通的旧JavaScript对象，用来记录组件中包含的数据。</p><p id="42fe" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该数据可能保持不变，或者由于用户执行的某些操作而更新。</p><p id="b417" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">从React 16.8开始，React中的类和功能组件都可以维护状态。</p><p id="5015" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">由于React团队<a class="ae ks" href="https://reactjs.org/docs/hooks-intro.html#motivation" rel="noopener ugc nofollow" target="_blank">更倾向于使用功能组件</a>而不是类组件，让我们看看状态是如何在功能组件中管理的。</p><h1 id="520d" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">功能组件中的状态</h1><p id="34bd" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">假设您想跟踪用户点击按钮的次数。</p><p id="f287" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您可以维护一个“count”变量作为组件的状态变量来跟踪点击次数。</p><p id="c35f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">每次用户单击按钮时，都要更新状态中的“count”变量。</p><p id="0c09" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们看看语法是什么样子的:</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="e28f" class="mr lq in mn b gy ms mt l mu mv">import "./styles.css";<br/>import { useState } from "react";</span><span id="5510" class="mr lq in mn b gy mw mt l mu mv">export default function App() {<br/>  const [count, setCount] = useState(0);<br/>  const updateCountHandler = () =&gt; {<br/>    setCount(count + 1);<br/>  };<br/>  return (<br/>    &lt;div className="container"&gt;<br/>      &lt;button onClick={updateCountHandler}&gt;Click&lt;/button&gt;<br/>      &lt;p&gt;No. of clicks: {count}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="7ef4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在上面的代码片段中，组件使用语句维护其状态:</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="6964" class="mr lq in mn b gy ms mt l mu mv">const [count, setCount] = useState(0);</span></pre><p id="e02b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们从右到左理解这段代码中发生了什么:</p><p id="a925" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，我们看到使用参数0调用了useState挂钩。</p><p id="9079" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">“useState”是React提供的内置挂钩。</p><p id="5624" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">传递给它的参数是我们希望在第一次呈现时用来初始化状态的值。因为“计数”是一个数字，我们希望它从零开始。提供初始值完全是可选的。</p><p id="72e0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">转到赋值操作符的左边，我们看到一个奇怪的带有方括号的语法，即，</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="31b3" class="mr lq in mn b gy ms mt l mu mv">const [count, setCount]</span></pre><p id="9a6a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">上面的语法可能看起来令人困惑，所以让我来解释一下。</p><p id="5bf9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当我们用初始值调用useState钩子时，它返回一个数组。</p><p id="3b11" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该数组包含我们的状态变量“count”和一个更新计数变量“setCount”的函数。</p><p id="80dd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下面的代码片段相当于方括号代码片段。</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="bd8c" class="mr lq in mn b gy ms mt l mu mv">  const countState = useState(0);<br/>  <br/>  const count = countState[0]; // count state variable  <br/>  const setCount = countState[1]; // count state updater function</span></pre><p id="db6b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果在一个组件中有多个状态要维护，那么这个语法很快就会变得混乱，很难跟踪。</p><p id="a1c6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这样，使用方括号语法(即数组析构)来避免编写样板代码就变得很方便了。</p><p id="8eb7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">此外，您可以随意命名“count”和“setCount”。在你的状态更新函数前加上前缀“set ”,后跟它正在更新的状态的名称，这是一个很好的做法，这样可以理解被操作的状态和负责它的函数。</p><p id="385d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">转到updateCountHandler。</p><p id="38b5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您可以看到，它正在通过调用useState提供的“setCount”函数来更新计数，并将值递增1。</p><p id="329e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">updateCountHandler被传递给附加到按钮的onClick事件。</p><p id="71db" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">每次单击按钮时，updateCountHandler都会调用“setCount”来将计数加1。</p><p id="acc1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">“使用状态”提供的“计数”状态变量将反映更新后的值。</p><p id="8ed7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果想要显示“计数”值，可以使用JSX中的useState函数提供的“计数”。</p><p id="4066" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> React状态更新成批发生。</strong></p><p id="a60f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这意味着您可能不会像预期的那样很快看到更新的状态值。</p><p id="9b1c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">再举一个例子来理解吧。</p><p id="ce57" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">假设我们的按钮现在在点击时执行一些异步操作，我们需要计算同一个按钮的点击次数。</p><p id="e9b3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了模拟异步特性，我们可以添加2秒的超时。</p><p id="049a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">基于我们到目前为止对useState hook的理解，我们可能会提出如下解决方案:</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="3b5f" class="mr lq in mn b gy ms mt l mu mv">import "./styles.css";<br/>import { useState } from "react";</span><span id="fe6a" class="mr lq in mn b gy mw mt l mu mv">export default function App() {<br/>  const [count, setCount] = useState(0);<br/>  const updateCountHandler = () =&gt; {<br/>    setTimeout(() =&gt; {<br/>      setCount(count + 1);<br/>    }, 2000);<br/>  };<br/>  return (<br/>    &lt;div className="container"&gt;<br/>      &lt;button onClick={updateCountHandler}&gt;Click&lt;/button&gt;<br/>      &lt;p&gt;No. of clicks: {count}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="6545" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">根据上面的代码片段，您可能会期望“计数”的值与点击次数保持同步。</p><p id="59ec" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但这并没有发生。</p><p id="dc6e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">它不能像预期的那样工作，因为React的状态更新不是瞬时的，而是成批的。在“计数”中反映当前状态值需要时间。</p><p id="5398" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因为“计数”没有最新的状态值，所以我们将“计数”的旧值增加1。</p><p id="e45e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">React为我们提供了另一种useState钩子的变体来避免这种情况。</p><p id="6b77" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下面让我们来看看它的实际应用。</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="6b94" class="mr lq in mn b gy ms mt l mu mv">import "./styles.css";<br/>import { useState } from "react";</span><span id="ff9c" class="mr lq in mn b gy mw mt l mu mv">export default function App() {<br/>  const [count, setCount] = useState(0);<br/>  const updateCountHandler = () =&gt; {<br/>    setTimeout(() =&gt; {<br/>      setCount((prevCount) =&gt; prevCount + 1);<br/>    }, 2000);<br/>  };<br/>  return (<br/>    &lt;div className="container"&gt;<br/>      &lt;button onClick={updateCountHandler}&gt;Click&lt;/button&gt;<br/>      &lt;p&gt;No. of clicks: {count}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="b0ca" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下面的代码片段让一切变得不同:</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="cfc8" class="mr lq in mn b gy ms mt l mu mv">setCount((prevCount) =&gt; prevCount + 1);</span></pre><p id="4b6e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们将一个箭头函数传递给这个“setCount”更新函数的变体。React在这里插入前一个状态值，不管它是否反映在“计数”状态变量中。</p><p id="6815" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">“prevCount”可以是任何名称。唯一要记住的是，函数传递给状态更新函数的第一个参数将总是前一个状态值。</p><h2 id="fbca" class="mr lq in bd lr mz na dn lv nb nc dp lz lc nd ne mb lg nf ng md lk nh ni mf nj bi translated">外卖食品</h2><p id="2fe5" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">useState是React中最常用的钩子之一，因此也是最重要的一个。</p><p id="2a30" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我希望这篇关于useState的文章已经让您对React中的钩子工作有了一个很好的基本了解。</p><p id="43c1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你想了解更多，我推荐你看看下面的参考资料。</p><p id="17b0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在那之前，</p><p id="aba0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">编码快乐！</p><h2 id="e4fe" class="mr lq in bd lr mz na dn lv nb nc dp lz lc nd ne mb lg nf ng md lk nh ni mf nj bi translated">参考资料:</h2><ul class=""><li id="d288" class="nk nl in kv b kw mh kz mi lc nm lg nn lk no lo np nq nr ns bi translated"><a class="ae ks" href="https://reactjs.org/docs/hooks-reference.html#usestate" rel="noopener ugc nofollow" target="_blank">钩子API引用</a></li><li id="c99d" class="nk nl in kv b kw nt kz nu lc nv lg nw lk nx lo np nq nr ns bi translated"><a class="ae ks" href="https://reactjs.org/docs/hooks-state.html" rel="noopener ugc nofollow" target="_blank">使用状态挂钩</a></li></ul></div><div class="ab cl ny nz hr oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ig ih ii ij ik"><p id="823a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="of">更多内容请看</em><a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="of">plain English . io</em></strong></a><em class="of">。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="of">免费周报</em> </strong> </a> <em class="of">。关注我们关于</em><a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="of">Twitter</em></strong></a><strong class="kv io"><em class="of"/></strong><em class="of">和</em><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="of">LinkedIn</em></strong></a><em class="of">。查看我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="of">社区不和谐</em> </strong> </a> <em class="of">加入我们的</em> <a class="ae ks" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="of">人才集体</em> </strong> </a> <em class="of">。</em></p></div></div>    
</body>
</html>