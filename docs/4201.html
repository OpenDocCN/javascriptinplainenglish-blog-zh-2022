<html>
<head>
<title>Create a Virtual Assistant in 100 Lines of JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用100行JavaScript创建一个虚拟助手</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-a-complete-ai-assistant-in-100-lines-of-javascript-a80a40a8dfa9?source=collection_archive---------5-----------------------#2022-11-08">https://javascript.plainenglish.io/create-a-complete-ai-assistant-in-100-lines-of-javascript-a80a40a8dfa9?source=collection_archive---------5-----------------------#2022-11-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="c67c" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">用Web语音API构建一个简单的人工智能助手</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/718446d19d19aa678d4a05aebdeccd8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XAa4i4pbV4uy_Sl6"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk"><a class="ae ks" href="https://unsplash.com/photos/OYzbqk2y26c" rel="noopener ugc nofollow" target="_blank">Photo</a> on Unsplash</figcaption></figure><p id="929e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在本教程中，我们将用几行JavaScript在浏览器中创建一个名为<strong class="kv io">索尼娅</strong>的虚拟助手(就像Siri或Cortana一样)。这个机器人会听用户的语音命令，并用合成语音做出回应。我们的目标是只使用<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API/Using_the_Web_Speech_API" rel="noopener ugc nofollow" target="_blank">网络语音API </a>，在不牺牲太多功能的情况下，让应用程序尽可能简单。你可以在这里测试app <a class="ae ks" href="https://nasosg.github.io/sonya-assistant-medium/" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="cd32" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">您需要的工具</h1><ul class=""><li id="00f6" class="mh mi in kv b kw mj kz mk lc ml lg mm lk mn lo mo mp mq mr bi translated"><a class="ae ks" href="https://www.google.com/chrome/" rel="noopener ugc nofollow" target="_blank">谷歌浏览器</a></li><li id="9069" class="mh mi in kv b kw ms kz mt lc mu lg mv lk mw lo mo mp mq mr bi translated">您选择的文本编辑器</li></ul></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><h1 id="3b54" class="lp lq in bd lr ls ne lu lv lw nf ly lz jt ng ju mb jw nh jx md jz ni ka mf mg bi translated">语音到文本功能的API</h1><p id="5718" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc nj le lf lg nk li lj lk nl lm ln lo ig bi translated">我们需要的是一个能够将文本和语音相互转换的API。希望这个工具存在，它就是<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API/Using_the_Web_Speech_API" rel="noopener ugc nofollow" target="_blank"> Web语音API </a>，它提供了两个不同的功能领域——语音识别和语音合成(文本到语音)。我们将在这个故事中探索这两个领域。</p><blockquote class="nm nn no"><p id="18ef" class="kt ku np kv b kw kx jo ky kz la jr lb nq ld le lf nr lh li lj ns ll lm ln lo ig bi translated">Web Speech API仍处于试验阶段，因此该应用可以在许多浏览器中运行，但不是所有浏览器。截至目前，它可以在最新版本的Chrome、Edge、Opera和Safari中工作。不幸的是，它在Firefox中还不能完全工作<em class="in">😔</em>。</p></blockquote></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><h1 id="b140" class="lp lq in bd lr ls ne lu lv lw nf ly lz jt ng ju mb jw nh jx md jz ni ka mf mg bi translated">我们需要实现什么</h1><p id="71a9" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc nj le lf lg nk li lj lk nl lm ln lo ig bi translated">为了构建这个web应用程序，我们需要实现四个组件:</p><ol class=""><li id="8d22" class="mh mi in kv b kw kx kz la lc nt lg nu lk nv lo nw mp mq mr bi translated">要显示的简单聊天UI:</li></ol><ul class=""><li id="fb1b" class="mh mi in kv b kw kx kz la lc nt lg nu lk nv lo mo mp mq mr bi translated">用户怎么说</li><li id="3821" class="mh mi in kv b kw ms kz mt lc mu lg mv lk mw lo mo mp mq mr bi translated">助理的回答</li><li id="8811" class="mh mi in kv b kw ms kz mt lc mu lg mv lk mw lo mo mp mq mr bi translated">一个触发助手的按钮(比如“嘿Siri”命令)</li><li id="287f" class="mh mi in kv b kw ms kz mt lc mu lg mv lk mw lo mo mp mq mr bi translated">顶部有一个小的帮助区域，向用户解释一些事情</li></ul><p id="c7d2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">2.将用户的语音转换成文本(使用<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API/Using_the_Web_Speech_API" rel="noopener ugc nofollow" target="_blank">网络语音API </a></p><p id="f74e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">3.处理文本并根据文本执行操作</p><p id="9b8a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">4.将文本转换回语音，改变Sonya的声音和音调</p></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><h1 id="c7a8" class="lp lq in bd lr ls ne lu lv lw nf ly lz jt ng ju mb jw nh jx md jz ni ka mf mg bi translated">用户界面</h1><p id="76bf" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc nj le lf lg nk li lj lk nl lm ln lo ig bi translated">第一步是创建一个简单的UI。我们将创建一个HTML文件，其中包含一个<code class="fe nx ny nz oa b">button</code>来触发助手，并且在顶部有一个小的帮助区域向用户显示一些可用的命令。我们还将创建一个<code class="fe nx ny nz oa b">div</code>元素来显示用户说了什么和Sonya回复了什么，并创建一个<code class="fe nx ny nz oa b">p</code>元素来显示处理信息。在JavaScript中，我们将使用元素对象的唯一id属性来检索它们。</p><p id="2a5f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> HTML </strong></p><pre class="kd ke kf kg gt ob oa oc bn od oe bi"><span id="a118" class="of lq in oa b be og oh l oi oj">&lt;html&gt;<br/>&lt;head&gt;<br/>  ...<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>  &lt;div id="content"&gt;<br/>    &lt;h1&gt;Sonya&lt;/h1&gt;<br/>    &lt;p&gt;Give it a try with 'hi/hello', 'how are you', 'joke', 'coin <br/>    flip', 'what's your name', 'what time is it', 'bye/stop'&lt;/p&gt;<br/>    &lt;p&gt;You can also try 'play despacito' &amp;#128516;. It will play <br/>    on Youtube. Note: the pop-up may be blocked by your browser&lt;/p&gt;<br/>  &lt;/div&gt;<br/>  &lt;button id="startBtn"&gt;Start listening&lt;/button&gt;<br/>  &lt;div id="result"&gt;&lt;/div&gt;<br/>  &lt;p id="processing"&gt;&lt;/p&gt;<br/>  &lt;script src="script.js"&gt;&lt;/script&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="3a35" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> JavaScript </strong></p><pre class="kd ke kf kg gt ob oa oc bn od oe bi"><span id="34db" class="of lq in oa b be og oh l oi oj">const startBtn = document.getElementById("startBtn");<br/>const result = document.getElementById("result");<br/>const processing = document.getElementById("processing");</span></pre></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><h1 id="e212" class="lp lq in bd lr ls ne lu lv lw nf ly lz jt ng ju mb jw nh jx md jz ni ka mf mg bi translated">语音转文本</h1><p id="c46e" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc nj le lf lg nk li lj lk nl lm ln lo ig bi translated">让我们制作一个组件，它捕获语音命令并将其转换为文本以供进一步处理。我们将使用<code class="fe nx ny nz oa b">SpeechRecognition </code>接口。由于该API仅在受支持的浏览器中可用，我们将显示一条警告消息，并阻止开始按钮在不受支持的浏览器中显示。</p><pre class="kd ke kf kg gt ob oa oc bn od oe bi"><span id="7d71" class="of lq in oa b be og oh l oi oj">const SpeechRecognition = window.SpeechRecognition <br/>                          || window.webkitSpeechRecognition;<br/>let toggleBtn = null;<br/>if (typeof SpeechRecognition === "undefined") {<br/>  startBtn.remove();<br/>  result.innerHTML = "Your browser doesn't support Speech API. <br/>                      Please download latest Chrome version.";<br/>}</span></pre><p id="356d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们将创建一个<code class="fe nx ny nz oa b">SpeechRecognition</code>的实例，并设置一些<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechRecognition" rel="noopener ugc nofollow" target="_blank">属性</a>来定制语音识别。我们会将<code class="fe nx ny nz oa b">continuous</code>和<code class="fe nx ny nz oa b">interimResults</code>设置为<code class="fe nx ny nz oa b">true</code>，以实时显示口述文本，即使用户稍有停顿，也会继续录制<strong class="kv io">。</strong>当<code class="fe nx ny nz oa b">continuous</code>设置为真时，暂停时间为<strong class="kv io"> </strong>约15秒。</p><pre class="kd ke kf kg gt ob oa oc bn od oe bi"><span id="36a3" class="of lq in oa b be og oh l oi oj">const recognition = new SpeechRecognition();<br/>recognition.continuous = true;<br/>recognition.interimResults = true;</span></pre><p id="38c1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后，我们添加一个句柄来处理来自语音API的<code class="fe nx ny nz oa b">onresult</code>事件。每当语音API捕获一行代码时，<code class="fe nx ny nz oa b">onresult</code>中的这段代码就会被调用<strong class="kv io">。到目前为止，我们捕获的所有行都保存在<code class="fe nx ny nz oa b">event</code>中，这是一个<code class="fe nx ny nz oa b">SpeechRecognitionEvent</code>对象。因为我们只需要当前行，所以我们使用<code class="fe nx ny nz oa b">resultIndex</code>属性来获取已经改变的<code class="fe nx ny nz oa b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechRecognitionResultList" rel="noopener ugc nofollow" target="_blank">SpeechRecognitionResultList</a></code>数组中索引值最低的结果。</strong></p><p id="fd3b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，我们得到用户所说内容的文本<code class="fe nx ny nz oa b">transcript</code>。该文本经过一个<code class="fe nx ny nz oa b">process</code>函数，该函数被调用来处理用户的问题并找到答案。然后调用<code class="fe nx ny nz oa b">readOutLoud</code>函数读出答案。<code class="fe nx ny nz oa b">readOutLoud</code>和<code class="fe nx ny nz oa b">process</code>功能将在接下来的步骤中执行。用户和助理的语音命令也显示为文本。</p><pre class="kd ke kf kg gt ob oa oc bn od oe bi"><span id="95f1" class="of lq in oa b be og oh l oi oj">recognition.onresult = event =&gt; {<br/>  const current = event.resultIndex;<br/>  const recognitionResult = event.results[current];<br/>  const recognitionText = recognitionResult[0].transcript;<br/> <br/>  if (recognitionResult.isFinal) {<br/>    processing.innerHTML = "processing ...";<br/><br/>    const response = process(recognitionText);<br/>    const p = document.createElement("p");<br/>    p.innerHTML = `&lt;strong&gt;You said:&lt;/strong&gt; ${recognitionText} <br/>                   &lt;/br&gt;&lt;strong&gt;Sonya said:&lt;/strong&gt; ${response}`;<br/>    processing.innerHTML = "";<br/>    result.appendChild(p);<br/>    <br/>    readOutLoud(response);<br/>  } else {<br/>    processing.innerHTML = `listening: ${recognitionText}`;<br/>  }<br/>};</span></pre><p id="3505" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们还需要将识别作为一个开关来切换。因此，我们只需添加一个click事件，并将UI <code class="fe nx ny nz oa b">button</code>与<code class="fe nx ny nz oa b">recognition</code>对象相关联，这样，当单击<code class="fe nx ny nz oa b">button</code>时，语音识别服务将停止或开始侦听传入的音频，按钮的文本也会发生变化。</p><blockquote class="nm nn no"><p id="4dca" class="kt ku np kv b kw kx jo ky kz la jr lb nq ld le lf nr lh li lj ns ll lm ln lo ig bi translated"><code class="fe nx ny nz oa b">start()</code>方法启动语音识别服务，监听输入的音频以识别与当前<code class="fe nx ny nz oa b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechRecognition" rel="noopener ugc nofollow" target="_blank">SpeechRecognition</a></code>相关的语法。</p><p id="dfd9" class="kt ku np kv b kw kx jo ky kz la jr lb nq ld le lf nr lh li lj ns ll lm ln lo ig bi translated"><code class="fe nx ny nz oa b">stop()</code>方法停止语音识别服务的监听，并尝试使用目前捕获的音频返回结果。</p></blockquote><pre class="kd ke kf kg gt ob oa oc bn od oe bi"><span id="761f" class="of lq in oa b be og oh l oi oj">let listening = false;<br/><br/>toggleBtn = () =&gt; {<br/>  if (listening) {<br/>    recognition.stop();<br/>    startBtn.textContent = "Start listening";<br/>  } else {<br/>    recognition.start();<br/>    startBtn.textContent = "Stop listening";<br/>  }<br/>  listening = !listening;<br/>};<br/><br/>startBtn.addEventListener("click", toggleBtn);</span></pre></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><h1 id="9a03" class="lp lq in bd lr ls ne lu lv lw nf ly lz jt ng ju mb jw nh jx md jz ni ka mf mg bi translated">处理文本并执行操作</h1><p id="59ea" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc nj le lf lg nk li lj lk nl lm ln lo ig bi translated">在这一步中，我们将构建一个简单的对话逻辑并处理一些基本操作。虽然处理器是Sonya的大脑，但它只是一个条件语句的例子，允许Sonya响应命令<code class="fe nx ny nz oa b">hi</code>、<code class="fe nx ny nz oa b">how are you</code>、<code class="fe nx ny nz oa b">what's your name</code>、<code class="fe nx ny nz oa b">joke</code>、<code class="fe nx ny nz oa b">coin flip</code>、<code class="fe nx ny nz oa b">what time is it</code>等等。如果Sonya不知道答案，她将打开一个新标签，通过谷歌搜索。最后，我们可以通过说<code class="fe nx ny nz oa b">bye</code>或者<code class="fe nx ny nz oa b">stop</code>来阻止她听。</p><p id="5094" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要创建一个简单的<code class="fe nx ny nz oa b">process</code>，只需考虑您希望Sonya做什么，并为其添加一个if case。如果添加更多的条件，Sonya可以执行更多的任务。你可以进一步扩展这个<code class="fe nx ny nz oa b">process</code>功能，使用API或者AI库，让助手变得随心所欲的智能。</p><pre class="kd ke kf kg gt ob oa oc bn od oe bi"><span id="3c4b" class="of lq in oa b be og oh l oi oj">function process(rawText) {<br/>  let text = rawText.replace(/\s/g, "").replace(/\'/g, "");<br/>  text = text.toLowerCase();<br/>  let response = null;<br/><br/>  if (text.includes("hello") || text.trim() == "hi" || text.includes("hey")) {<br/>    response = getRandomItemFromArray(hello);<br/>  } else if (text.includes("your name")) {<br/>    response = "My name's Sonya.";<br/>  } else if (text.includes("howareyou")||text.includes("whatsup")) {<br/>    response = "I'm fine. How about you?";<br/>  } else if (text.includes("whattimeisit")) {<br/>    response = new Date().toLocaleTimeString();<br/>  } else if (text.includes("joke")) {<br/>    response = getRandomItemFromArray(joke);<br/>  } else if (text.includes("play")) &amp;&amp; text.includes("despacito")) {<br/>    response = "Opened it in another tab";<br/>    window.open("https://www.youtube.com/watch?v=kJQP7kiw5Fk",<br/>                "_blank", "noopener");<br/>  } else if (text.includes("flip") &amp;&amp; text.includes("coin")) {<br/>    response = Math.random() &lt; 0.5 ? 'heads' : 'tails';<br/>  } else if (text.includes("bye") || text.includes("stop")) {<br/>    response = "Bye!!";<br/>    toggleBtn();<br/>  }<br/><br/>  if (!response) {<br/>    window.open(`http://google.com/search?q=${rawText.replace("search", "")}`,<br/>                "_blank");<br/>    return `I found some information for ${rawText}`;<br/>  }<br/><br/>  return response;<br/>}</span></pre><h2 id="48b4" class="ok lq in bd lr ol om dn lv on oo dp lz lc op oq mb lg or os md lk ot ou mf ov bi translated">*请注意，在新窗口中打开的弹出窗口可能会被浏览器阻止，您需要允许访问。</h2><h2 id="ae5c" class="ok lq in bd lr ol om dn lv on oo dp lz lc op oq mb lg or os md lk ot ou mf ov bi translated">随机答案</h2><p id="2c80" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc nj le lf lg nk li lj lk nl lm ln lo ig bi translated">对于某些答案，Sonya会根据一个数组中指定的一组回复给出一个随机答案。例如，如果你说“你好”，Sonya会从一组问候中随机选择一项作为回应。为了得到这些答案，实现了getRandomItemFromArray函数。</p><pre class="kd ke kf kg gt ob oa oc bn od oe bi"><span id="5f0d" class="of lq in oa b be og oh l oi oj">function getRandomItemFromArray(array) {<br/>  const randomItem = array[Math.floor(Math.random() * array.length)];<br/>  return randomItem;<br/>};</span></pre></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><h1 id="8197" class="lp lq in bd lr ls ne lu lv lw nf ly lz jt ng ju mb jw nh jx md jz ni ka mf mg bi translated">文本到语音</h1><p id="9803" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc nj le lf lg nk li lj lk nl lm ln lo ig bi translated">最后一步，我们使用Web Speech API的<code class="fe nx ny nz oa b">speechSynthesis</code>控制器给我们的助手一个声音。加载声音后，我用更好的声音替换了桑娅的声音。如果你想看到更多的声音，查看文档。我还改变了一点说话的音调和语速。</p><pre class="kd ke kf kg gt ob oa oc bn od oe bi"><span id="366b" class="of lq in oa b be og oh l oi oj">function readOutLoud(message) {<br/>  const speech = new SpeechSynthesisUtterance();<br/>  <br/>  speech.text = message;<br/>  speech.volume = 1;<br/>  speech.rate = 1;<br/>  speech.pitch = 1.8;<br/>  speech.voice = voices[3];<br/><br/>  window.speechSynthesis.speak(speech);<br/>}</span></pre><h1 id="5b39" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">文本到语音参数</h1><h2 id="0c97" class="ok lq in bd lr ol om dn lv on oo dp lz lc op oq mb lg or os md lk ot ou mf ov bi translated"><strong class="ak">声音</strong></h2><p id="ccdc" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc nj le lf lg nk li lj lk nl lm ln lo ig bi translated">从声音开始，我想把Sonya的默认声音改为更女性化的声音，类似于Siri或Cortana等其他助手。为此，我必须用<code class="fe nx ny nz oa b">getVoices()</code>方法检索所有可用的声音，并从中选择一个。一开始我把所有的声音都包括进来，让用户自己选择，但后来我觉得没必要这样。</p><p id="aec7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请注意，根据<a class="ae ks" href="https://dvcs.w3.org/hg/speech-api/raw-file/tip/speechapi-errata.html" rel="noopener ugc nofollow" target="_blank"> Web Speech API勘误表</a>(E11 2013–10–17)，语音列表在页面上异步加载，加载时会触发一个<code class="fe nx ny nz oa b">onvoiceschanged</code>事件。所以我用这个事件来设定声音。</p><pre class="kd ke kf kg gt ob oa oc bn od oe bi"><span id="1015" class="of lq in oa b be og oh l oi oj">// wait on voices to be loaded before fetching list<br/>window.speechSynthesis.onvoiceschanged = function() {<br/>    voices = window.speechSynthesis.getVoices();<br/>};</span></pre><blockquote class="nm nn no"><p id="7886" class="kt ku np kv b kw kx jo ky kz la jr lb nq ld le lf nr lh li lj ns ll lm ln lo ig bi translated"><strong class="kv io"> voiceschanged </strong>:当<strong class="kv io"> getVoices() </strong>返回的SpeechSynthesisVoiceList的内容发生变化时触发。<strong class="kv io">例如</strong>:服务器端合成，其中<em class="in">列表被异步确定，或者当客户端语音被安装(卸载)时。</em></p></blockquote><h2 id="0c1a" class="ok lq in bd lr ol om dn lv on oo dp lz lc op oq mb lg or os md lk ot ou mf ov bi translated"><strong class="ak">音调、速率和音量</strong></h2><p id="f6da" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc nj le lf lg nk li lj lk nl lm ln lo ig bi translated">我使用的其他参数是<strong class="kv io">音调、速率和音量，</strong>这些都是<code class="fe nx ny nz oa b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance" rel="noopener ugc nofollow" target="_blank">SpeechSynthesisUtterance</a></code>接口的属性，用于获取和设置说话时的音调、速率或音量。</p><p id="c210" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">用于这些参数的值如下:</p><p id="9595" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">螺距= 1.8 </strong>:介于<strong class="kv io"> 0 </strong>和<strong class="kv io"> 2 </strong>之间的浮点数，其中1为当前默认螺距。<strong class="kv io">直觉上，音高是关于音频的。高频声音被感知为高音，低频声音被感知为低音。所以我选择了更高的音调，因为女性说话的音调更高，助理的声音也更女性化。</strong></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/3bd932c46437ebfe8b3890840353b73b.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/1*i-0kEpZ-GaxTYrJSdB8wbg.gif"/></div></figure><p id="5e1d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> rate = 1 </strong>:语速简单来说就是助理说话的速度(每分钟说出的字数)。它是一个浮动值，范围从0.1到10，默认汇率为<strong class="kv io"> 1 </strong>。1到1.5之间的值相当于正常的语速。</p><p id="8355" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> volume = 1 </strong>:机器人的声音有多大。它是一个介于0和1之间的浮点数。</p><p id="6edd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">那都是乡亲们！！！我们有一个很酷的助手，只有100行代码。代码可以在这个GitHub <a class="ae ks" href="https://github.com/NasosG/sonya-assistant-medium" rel="noopener ugc nofollow" target="_blank">库</a>找到，演示可以在<a class="ae ks" href="https://nasosg.github.io/sonya-assistant-medium/" rel="noopener ugc nofollow" target="_blank">这里</a>查看。</p></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><p id="18d6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下一步是什么？<a class="ae ks" href="https://medium.com/@gthanos" rel="noopener">在Medium上关注我</a>成为第一个阅读我的故事的人。</p></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><p id="c431" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="np">更多内容看</em> <a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="np">说白了。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="np">免费周报</em> </strong> </a> <em class="np">。关注我们关于</em> <a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="np">推特</em></strong></a><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="np">LinkedIn</em></strong></a><em class="np"/><a class="ae ks" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="np">YouTube</em></strong></a><em class="np"/><a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="np">不和</em> </strong> </a> <em class="np">。对增长黑客感兴趣？检查</em> <a class="ae ks" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="np">电路</em> </strong> </a> <em class="np">。</em></strong></a></p></div></div>    
</body>
</html>