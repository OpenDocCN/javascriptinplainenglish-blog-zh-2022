<html>
<head>
<title>Custom Pipes in Angular — The Ultimate Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角形定制管道——终极指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/custom-pipes-in-angular-the-ultimate-guide-e54bb400e3ce?source=collection_archive---------1-----------------------#2022-08-17">https://javascript.plainenglish.io/custom-pipes-in-angular-the-ultimate-guide-e54bb400e3ce?source=collection_archive---------1-----------------------#2022-08-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="a983" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">角度定制管道|性能优化</h2><div class=""/><div class=""><h2 id="f270" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">如何在Angular中创建自定义管道，什么是纯管道和不纯管道，以及如何使用纯管道来提高应用程序的性能。</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/80692c8a8dda791873944e683771bcc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wAMaQtZaVsE2Y2TL3L6GyQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Photo created using Canva — Angular logo from the <a class="ae le" href="https://angular.io/presskit" rel="noopener ugc nofollow" target="_blank">Angular PressKit</a></figcaption></figure><p id="0b71" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><a class="ae le" href="https://angular.io/api/core/Pipe" rel="noopener ugc nofollow" target="_blank">Angular中的管道</a>是在组件模板表达式中使用的函数，用于将值转换成另一种显示格式。Angular有几个内置管道，比如日期管道、<a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/angular-async-pipe-714dd864adaa">异步管道</a>等等。但是，如果这些管道不能满足我们的需求，我们可以创建自己的管道。</p><p id="e668" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在本文中，我们将研究:</p><ul class=""><li id="8f30" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma mg mh mi mj bi translated">如何<strong class="lh ja">在Angular中创建定制管道(</strong>手动/使用Angular CLI)</li><li id="94dc" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma mg mh mi mj bi translated">如何使用管道和传递额外的参数</li><li id="cf97" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma mg mh mi mj bi translated">什么是<strong class="lh ja">纯管道和不纯管道</strong></li><li id="8c64" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma mg mh mi mj bi translated">如何使用纯管道和内存化提高性能<strong class="lh ja"/></li></ul><p id="160f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">所以，让我们开始吧！</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="c2b1" class="mw mx iq bd my mz na nb nc nd ne nf ng kf nh kg ni ki nj kj nk kl nl km nm nn bi translated">在角度中创建自定义管道</h1><p id="bdda" class="pw-post-body-paragraph lf lg iq lh b li no ka lk ll np kd ln lo nq lq lr ls nr lu lv lw ns ly lz ma ij bi translated">要创建自定义管道，我们需要遵循3个简单的步骤:</p><p id="7d60" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> 1。创建一个类并用</strong> <code class="fe nt nu nv nw b"><a class="ae le" href="https://angular.io/api/core/Pipe" rel="noopener ugc nofollow" target="_blank"><strong class="lh ja">@Pipe</strong></a></code> <strong class="lh ja">装饰器装饰它。装饰器必须包括我们将要用来调用管道的<code class="fe nt nu nv nw b">name</code>。</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="29db" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> 2。实现</strong> <code class="fe nt nu nv nw b"><a class="ae le" href="https://angular.io/api/core/PipeTransform" rel="noopener ugc nofollow" target="_blank"><strong class="lh ja">PipeTransform</strong></a></code> <strong class="lh ja">界面。这个接口有一个我们需要实现的方法:<code class="fe nt nu nv nw b">transform</code>方法。</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="0caa" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><code class="fe nt nu nv nw b">value</code>是管道应用的参数。<code class="fe nt nu nv nw b">...args</code>称为“休息参数”。它被视为无限数量的可选参数(零个或更多)。如果我们不需要传递任何额外的参数，我们只传递第一个参数。最后，我们返回转换后的值。</p><p id="fd43" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> 3。在模块的</strong> <code class="fe nt nu nv nw b"><strong class="lh ja">declaration</strong></code> <strong class="lh ja">数组中添加自定义管道。</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="a767" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">从<a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/the-new-features-of-angular-v14-851995870f59"> Angular v14 </a>开始，我们也可以将管道添加到在模板中使用它的任何独立组件的<code class="fe nt nu nv nw b">imports</code>数组中。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="b9ae" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这就结束了在角度中创建和注册<em class="nz">定制管道的手动方式。</em></p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="d4c3" class="mw mx iq bd my mz na nb nc nd ne nf ng kf nh kg ni ki nj kj nk kl nl km nm nn bi translated">使用角度CLI</h1><p id="b84c" class="pw-post-body-paragraph lf lg iq lh b li no ka lk ll np kd ln lo nq lq lr ls nr lu lv lw ns ly lz ma ij bi translated">如果这对你来说是一项繁重的工作，不要担心。我们掩护你！</p><p id="0863" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">Angular CLI提供了一种快速生成拔模管类的方法。它还在<code class="fe nt nu nv nw b">AppModule</code>中注册管道。命令是:</p><pre class="kp kq kr ks gt oa nw ob oc aw od bi"><span id="9260" class="oe mx iq nw b gy of og l oh oi">ng generate pipe &lt;path-to-directory&gt;/&lt;pipe-name&gt;</span></pre><p id="8224" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">或者简称为:</p><pre class="kp kq kr ks gt oa nw ob oc aw od bi"><span id="116a" class="oe mx iq nw b gy of og l oh oi">ng g p &lt;path-to-directory&gt;/&lt;pipe-name&gt;</span></pre><p id="57d4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">例如，我们通过运行以下命令创建了<code class="fe nt nu nv nw b">mark</code>管道:</p><pre class="kp kq kr ks gt oa nw ob oc aw od bi"><span id="29e8" class="oe mx iq nw b gy of og l oh oi">ng g p pipes/mark</span></pre><p id="9e5e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">CLI生成了下面的draft pipe类，准备将我们想要的任何逻辑放入<code class="fe nt nu nv nw b">transform</code>方法中。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="1942" class="mw mx iq bd my mz na nb nc nd ne nf ng kf nh kg ni ki nj kj nk kl nl km nm nn bi translated">使用管道</h1><p id="6669" class="pw-post-body-paragraph lf lg iq lh b li no ka lk ll np kd ln lo nq lq lr ls nr lu lv lw ns ly lz ma ij bi translated">使用管道<strong class="lh ja"> </strong>的<strong class="lh ja"> </strong>语法为:</p><pre class="kp kq kr ks gt oa nw ob oc aw od bi"><span id="ff38" class="oe mx iq nw b gy of og l oh oi">&lt;value&gt; <strong class="nw ja">|</strong> &lt;pipe-name&gt;</span></pre><p id="12ba" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">例如，<code class="fe nt nu nv nw b">gender</code>管道接收熊猫的性别并返回一个引导图标类。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="708c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">奖励— </strong>我们还可以用链条连接管道。执行顺序是从左到右。</p><pre class="kp kq kr ks gt oa nw ob oc aw od bi"><span id="ac35" class="oe mx iq nw b gy of og l oh oi">&lt;value&gt; <strong class="nw ja">| </strong>&lt;pipe-name1&gt; <strong class="nw ja">| </strong>&lt;pipe-name2&gt; <strong class="nw ja">|</strong>...</span></pre></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="5780" class="mw mx iq bd my mz na nb nc nd ne nf ng kf nh kg ni ki nj kj nk kl nl km nm nn bi translated">P <strong class="ak">辅助额外参数</strong></h1><p id="5ef3" class="pw-post-body-paragraph lf lg iq lh b li no ka lk ll np kd ln lo nq lq lr ls nr lu lv lw ns ly lz ma ij bi translated">用于传递额外参数的<strong class="lh ja"> </strong>语法是:</p><pre class="kp kq kr ks gt oa nw ob oc aw od bi"><span id="f0aa" class="oe mx iq nw b gy of og l oh oi">&lt;value&gt; <strong class="nw ja">| </strong>&lt;pipe-name&gt;<strong class="nw ja">: </strong>&lt;arg1&gt;, &lt;arg2&gt;, ..., &lt;argN&gt;</span></pre><p id="ff66" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在我们的演示中，<code class="fe nt nu nv nw b">mark</code>管道接收两个字符串值:要转换的值和一个搜索词。如果该值包含搜索词，该词会带有下划线并变成红色。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="5768" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们还创建CSS类来定义样式。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="ca85" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">最后，我们在模板中使用管道。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="ddea" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在，如果我们寻找一只熊猫:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oj"><img src="../Images/be162e2fb9cdc9c391fc50dd35d0a2fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Ut5Jr11NKEN86ds4t_gh1A.gif"/></div></div></figure></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="8983" class="mw mx iq bd my mz na nb nc nd ne nf ng kf nh kg ni ki nj kj nk kl nl km nm nn bi translated">纯管道</h1><p id="24e2" class="pw-post-body-paragraph lf lg iq lh b li no ka lk ll np kd ln lo nq lq lr ls nr lu lv lw ns ly lz ma ij bi translated">默认情况下，管道被定义为<em class="nz">纯</em>。<em class="nz"> </em>为了清楚起见，我们可以这样明确地设定纯粹属性:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="6e3d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">属性为<code class="fe nt nu nv nw b">true</code>的<code class="fe nt nu nv nw b">pure</code>通知Angular】方法是纯的。</p><p id="2271" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果一个方法总是为相同的参数返回相同的结果，并且没有副作用，比如修改参数、全局变量或者除了返回值之外的任何其他东西，那么这个方法就被称为纯方法。</p><p id="7a5a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">Angular知道在这些条件下，除非输入值改变，否则<code class="fe nt nu nv nw b">transform</code>方法的结果不会改变。因此，只有当它检测到输入值的变化时，它才会执行管道。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="146f" class="mw mx iq bd my mz na nb nc nd ne nf ng kf nh kg ni ki nj kj nk kl nl km nm nn bi translated">不纯净的管道</h1><p id="5140" class="pw-post-body-paragraph lf lg iq lh b li no ka lk ll np kd ln lo nq lq lr ls nr lu lv lw ns ly lz ma ij bi translated">相反，通过将<code class="fe nt nu nv nw b">pure</code>属性设置为<code class="fe nt nu nv nw b">false</code>，我们声明了一个<em class="nz">不纯管道。每当Angular检测到每一次击键或鼠标移动的变化时，它将执行一个不纯的管道。</em></p><p id="c240" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">那为什么会有人想用不纯的烟斗呢？</p><p id="c9f6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">当我们想要<a class="ae le" href="https://angular.io/guide/pipes#detecting-impure-changes-within-composite-objects" rel="noopener ugc nofollow" target="_blank">检测复合对象</a>中的不纯变化时，通常使用不纯管道。</p><p id="9f24" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">将对象传递给管道时，Angular仅检查参照是否有变化。如果物体的某个属性内部发生了任何变化，Angular将无法判断。</p><p id="64cb" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在任何情况下，使用不纯的管道都要非常小心。官方文档指出“一个长时间运行的不纯管道会极大地降低您的应用程序的速度”。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="1393" class="mw mx iq bd my mz na nb nc nd ne nf ng kf nh kg ni ki nj kj nk kl nl km nm nn bi translated">提高应用程序性能</h1><p id="0b31" class="pw-post-body-paragraph lf lg iq lh b li no ka lk ll np kd ln lo nq lq lr ls nr lu lv lw ns ly lz ma ij bi translated">注意到了吗，当我们在上一个GIF的末尾清除搜索输入框时，会有很大的延迟？让我们看看是什么导致了这个问题，以及我们如何使用自定义管道来解决这个问题。</p><h2 id="ca63" class="oe mx iq bd my ok ol dn nc om on dp ng lo oo op ni ls oq or nk lw os ot nm iw bi translated">问题是</h2><p id="f202" class="pw-post-body-paragraph lf lg iq lh b li no ka lk ll np kd ln lo nq lq lr ls nr lu lv lw ns ly lz ma ij bi translated">问题的原因在调用<code class="fe nt nu nv nw b">calculatePopularity</code>方法的<code class="fe nt nu nv nw b">PandaComponent</code>模板文件中。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="dfc6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在组件的类文件中，<code class="fe nt nu nv nw b">calculatePopularity</code>方法使用当前熊猫的出生年份来计算它的受欢迎程度。出于演示目的，我们使用斐波那契数列和一个未优化的递归实现。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="f70a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">为什么调用模板中的方法会导致性能问题？</strong></p><p id="fc03" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">要回答这个问题，我们需要了解Angular的变化检测机制的基础。Angular运行变化检测，以确定当发生变化时，UI的哪些部分需要重新呈现。被调用方法的结果是UI的一部分。</p><p id="b336" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">Angular怎么知道一个方法的结果有没有变化？</strong></p><p id="2d77" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">它不能！只有一个方法可以知道:通过再次执行它。换句话说，它将在每次检测到更改时运行该方法，即使该更改是不相关的。</p><p id="2b1a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这将降低应用程序的性能。多少取决于被调用的方法做什么。在我们的演示中，我们做了一个繁重的、重复的、未优化的计算，因此出现了我们之前观察到的延迟。</p><p id="8159" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">你也可以通过加载时间判断出问题。我们运行Lighthouse，它产生了以下分数。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/b743a8e70e59976ec445fb21fce565a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*hqVPiwdKxUxA-H0tYzT3TQ.png"/></div></figure><blockquote class="ov ow ox"><p id="7b67" class="lf lg nz lh b li lj ka lk ll lm kd ln oy lp lq lr oz lt lu lv pa lx ly lz ma ij bi translated"><strong class="lh ja">注意:</strong>灯塔报告评分基于页面的加载时间，而不是与页面交互时的时间。</p></blockquote><h2 id="d989" class="oe mx iq bd my ok ol dn nc om on dp ng lo oo op ni ls oq or nk lw os ot nm iw bi translated">首次改进</h2><p id="9eee" class="pw-post-body-paragraph lf lg iq lh b li no ka lk ll np kd ln lo nq lq lr ls nr lu lv lw ns ly lz ma ij bi translated">第一步，我们将组件的<code class="fe nt nu nv nw b">changeDetection</code>策略更改为<code class="fe nt nu nv nw b"> <a class="ae le" href="https://angular.io/guide/change-detection-skipping-subtrees#using-onpush" rel="noopener ugc nofollow" target="_blank">OnPush</a></code>。这意味着只有当<code class="fe nt nu nv nw b">@Input</code>属性改变时，才会触发<code class="fe nt nu nv nw b">PandaComponent</code>内部的变化检测。</p><p id="4f3e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这大大减少了加载时间。运行Lighthouse证实了改进。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/6c248a8e5646e07cedb803995bdd960c.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*Xb-EMxUh2p6e9VX02YDBTA.png"/></div></figure><p id="a9cf" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这改进了加载时间，但没有改进应用程序的交互时间。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oj"><img src="../Images/b9626225e6d25909cdefb72e9d9362d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9TFlJuvmbLl3XcdZ3w7Obw.gif"/></div></div></figure><p id="a38d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这是因为每次我们输入一些东西，我们都在执行一个搜索，这会改变<code class="fe nt nu nv nw b">filteredPandas</code>的引用。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="f7a5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">panda组件的输入属性也是如此。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="bb41" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">结果，他们模板中的<code class="fe nt nu nv nw b">calculatePopularity</code>方法又被调用了。</p><h2 id="23f3" class="oe mx iq bd my ok ol dn nc om on dp ng lo oo op ni ls oq or nk lw os ot nm iw bi translated">纯净的管道拯救世界</h2><p id="02e1" class="pw-post-body-paragraph lf lg iq lh b li no ka lk ll np kd ln lo nq lq lr ls nr lu lv lw ns ly lz ma ij bi translated">这就是纯管道发挥作用的地方。我们创建一个纯粹的定制管道，仅在管道的输入发生变化时执行所需的计算。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="3d5d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">然后我们使用管道而不是调用方法。现在，除非传递给管道的值发生变化，否则不会重新计算流行度。简单地说，我们不再计算在结果中仍然可见的熊猫的受欢迎程度。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="65e3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这在很大程度上减少了交互时间，并使应用程序工作顺畅。因为加载时间没变，灯塔评分也没变。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oj"><img src="../Images/d865bff3db411a10bf2fa03a16c56bc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*drt3OOI7Hi1YgsMisZYsKA.gif"/></div></div></figure><h2 id="110f" class="oe mx iq bd my ok ol dn nc om on dp ng lo oo op ni ls oq or nk lw os ot nm iw bi translated">纯管道和记忆</h2><p id="8816" class="pw-post-body-paragraph lf lg iq lh b li no ka lk ll np kd ln lo nq lq lr ls nr lu lv lw ns ly lz ma ij bi translated">之前的改进是有的，但是为什么最后应用还是滞后？</p><p id="628a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">当我们清空搜索区域时，所有的熊猫都变得可见。因此，以前被隐藏的熊猫现在被重新呈现，它们的受欢迎程度必须被重新计算。</p><p id="1b4b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们能做得更好吗？是的，我们可以！</p><p id="7aca" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">如何？</strong>进入记忆化！</p><p id="e39c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">管道是纯的，因为斐波那契是一个纯函数。既然是这样，我们可以缓存计算结果，而不是从头开始重新计算。为此，我们通过运行以下命令来安装<code class="fe nt nu nv nw b">memo-decorator</code>包:</p><pre class="kp kq kr ks gt oa nw ob oc aw od bi"><span id="ef72" class="oe mx iq nw b gy of og l oh oi">npm install memo-decorator</span></pre><p id="8669" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">然后我们用<code class="fe nt nu nv nw b">@memo</code>装饰器装饰我们的<code class="fe nt nu nv nw b">fibonacci</code>方法。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="ec8f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这一句话足以改变现状吗？好吧，你自己看吧！</p><p id="1bf2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">应用程序加载速度更快，这也反映在灯塔评分。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/740f53d50f25170a049fafc3fe08ad11.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*VWDFjR3YCeJoUlM7-6Zu2w.png"/></div></figure><p id="e9b6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">此外，互动变得尽可能顺畅，没有任何滞后发生。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oj"><img src="../Images/1614e17519040099cc7f09cdcc3fece2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*zV-D7lYbStdHiAm2EFFPfg.gif"/></div></div></figure></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="f487" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果您得到的Lighthouse分数比我们的分数低50分，这可能是因为您在开发模式下运行应用程序。您需要将应用程序作为生产版本来提供。为此:</p><ol class=""><li id="2940" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma pb mh mi mj bi translated">安装<a class="ae le" href="https://www.npmjs.com/package/http-server" rel="noopener ugc nofollow" target="_blank"> http-server </a> : <code class="fe nt nu nv nw b">npm install http-server -g</code></li><li id="5a35" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma pb mh mi mj bi translated">构建应用:<code class="fe nt nu nv nw b">ng build</code></li><li id="c392" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma pb mh mi mj bi translated">服务于生产构建:<code class="fe nt nu nv nw b">http-server dist/ng-custom-pipe-demo</code></li></ol><p id="fa5a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">和往常一样，你可以在下面找到一个StackBlitz演示。别忘了<a class="ae le" href="https://vkagklis.medium.com/subscribe" rel="noopener">订阅我的简讯</a>获取更多类似内容！</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="pc ny l"/></div></figure></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="bcd0" class="mw mx iq bd my mz na nb nc nd ne nf ng kf nh kg ni ki nj kj nk kl nl km nm nn bi translated">结论</h1><p id="4fda" class="pw-post-body-paragraph lf lg iq lh b li no ka lk ll np kd ln lo nq lq lr ls nr lu lv lw ns ly lz ma ij bi translated">在本文中，我们研究了Angular中的自定义管道。我们解释了如何创建、使用和传递额外的参数。我们看到了纯净管道和不纯净管道之间的差异。最后，我们结合了纯管道和内存化来提高应用程序的性能。</p><p id="266c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">感谢阅读！我希望你喜欢这篇文章。</p><p id="9083" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">编码快乐！</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="1369" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><em class="nz">更多内容请看</em><a class="ae le" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lh ja"><em class="nz">plain English . io</em></strong></a><em class="nz">。报名参加我们的</em> <a class="ae le" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lh ja"> <em class="nz">免费周报</em> </strong> </a> <em class="nz">。关注我们关于</em><a class="ae le" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="lh ja"><em class="nz">Twitter</em></strong></a><a class="ae le" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="lh ja"><em class="nz">LinkedIn</em></strong></a><em class="nz"/><a class="ae le" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="lh ja"><em class="nz">YouTube</em></strong></a><em class="nz"/><a class="ae le" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="lh ja"><em class="nz">不和</em> </strong> </a> <em class="nz">。</em></p></div></div>    
</body>
</html>