# åœ¨ React ä¸­å¤„ç†äº‹ä»¶æ—¶è¦é¿å…çš„ 3 ä¸ªå¸¸è§é”™è¯¯

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/react-event-handling-common-mistakes-a8e8ee947e?source=collection_archive---------4----------------------->

![](img/38687a764c45e42562d62b32c4e69e44.png)

åœ¨ React åº”ç”¨ç¨‹åºä¸­ï¼Œäº‹ä»¶ç›‘å¬å™¨æˆ–è§‚å¯Ÿå™¨åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œç‰¹å®šçš„æ“ä½œã€‚è™½ç„¶åœ¨ React ä¸­åˆ›å»ºäº‹ä»¶ä¾¦å¬å™¨éå¸¸å®¹æ˜“ï¼Œä½†æ˜¯æ‚¨éœ€è¦é¿å…ä¸€äº›å¸¸è§çš„é™·é˜±ï¼Œä»¥é˜²æ­¢ä»¤äººå›°æƒ‘çš„é”™è¯¯ã€‚è¿™äº›é”™è¯¯æ˜¯åˆå­¦è€…æœ€å¸¸çŠ¯çš„ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªç›¸å½“æœ‰ç»éªŒçš„å¼€å‘äººå‘˜ï¼Œå®ƒä»¬æˆä¸ºæ‚¨è°ƒè¯•ä¼šè¯çš„åŸå› å¹¶ä¸ç½•è§ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ä¸€äº›å¸¸è§çš„é”™è¯¯ï¼Œä»¥åŠä½ åº”è¯¥æ€ä¹ˆåšã€‚

# 1.è®¿é—®çŠ¶æ€å˜é‡è€Œä¸å¤„ç†æ›´æ–°

çœ‹çœ‹è¿™ä¸ªç®€å•çš„ React åº”ç”¨ç¨‹åºã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŸºæœ¬çš„ç§’è¡¨åº”ç”¨ç¨‹åºï¼Œä»é›¶å¼€å§‹æ— é™è®¡æ•°ã€‚

`JavaScript`

```
import { useState, useEffect } from 'react';

export default function App() {
  const [time, setTime] = useState(0);
  useEffect(() => {
    const timer = setInterval(() => {
      setTime(time + 1);
    }, 1000);
    return () => {
      window.clearInterval(timer);
    }
  }, []);
  return (
    <div>
      Seconds: {time}
    </div>
  );
}
```

ç„¶è€Œï¼Œå½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªåº”ç”¨ç¨‹åºæ—¶ï¼Œç»“æœå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„:

![](img/65a57875f8e1abe8850031ffd69b47e5.png)

å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºç”±`setInterval()`å›è°ƒ/é—­åŒ…å¼•ç”¨çš„æ—¶é—´çŠ¶æ€å˜é‡å¼•ç”¨äº†åœ¨å®šä¹‰é—­åŒ…æ—¶æ–°é²œçš„é™ˆæ—§çŠ¶æ€ã€‚

é—­åŒ…åªèƒ½è®¿é—®ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­çš„`time`å˜é‡(å…¶å€¼ä¸º`0`)ï¼Œä½†ä¸èƒ½è®¿é—®åç»­æ¸²æŸ“ä¸­çš„æ–°`time`å€¼ã€‚JavaScript closure ä»å®šä¹‰å˜é‡çš„åœ°æ–¹è®°ä½å˜é‡ã€‚

è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯ç”±äº`setInterval()`é—­åŒ…åœ¨ç»„ä»¶ä¸­åªå®šä¹‰äº†ä¸€æ¬¡ã€‚

ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„`time`å˜é‡å°†æ€»æ˜¯æœ‰ä¸€ä¸ªå€¼`0`ï¼Œå› ä¸º React ä¸ä¼šåœ¨è°ƒç”¨`setState`æ—¶ç›´æ¥æ”¹å˜çŠ¶æ€å˜é‡ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªåŒ…å«æ–°çŠ¶æ€çš„æ–°å˜é‡ã€‚æ‰€ä»¥å½“è°ƒç”¨`setInterval`é—­åŒ…æ—¶ï¼Œå®ƒåªä¼šå°†çŠ¶æ€æ›´æ–°ä¸º`1`ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›é¿å…è¿™ç§é”™è¯¯å’Œé˜²æ­¢æ„å¤–é—®é¢˜çš„æ–¹æ³•ã€‚

# 1.å°†åŠŸèƒ½ä¼ é€’ç»™`setState`

é¿å…è¿™ç§é”™è¯¯çš„ä¸€ç§æ–¹æ³•æ˜¯å‘çŠ¶æ€æ›´æ–°å‡½æ•°(`setState`)ä¼ é€’ä¸€ä¸ªå›è°ƒï¼Œè€Œä¸æ˜¯ç›´æ¥ä¼ é€’ä¸€ä¸ªå€¼ã€‚React å°†ç¡®ä¿å›è°ƒæ€»æ˜¯æ¥æ”¶æœ€æ–°çš„çŠ¶æ€ï¼Œé¿å…è®¿é—®å¯èƒ½åŒ…å«æ—§çŠ¶æ€çš„çŠ¶æ€å˜é‡ã€‚å®ƒä¼šå°†çŠ¶æ€è®¾ç½®ä¸ºå›è°ƒè¿”å›çš„å€¼ã€‚

ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•åœ¨ç¤ºä¾‹ä¸­åº”ç”¨è¿™ä¸€ç‚¹:

`JavaScript`

```
import { useState, useEffect } from 'react';

export default function App() {
  const [time, setTime] = useState(0);
  useEffect(() => {
    const timer = setInterval(() => {
      // ğŸ‘‡ Pass callback
      setTime((prevTime) => prevTime + 1);
    }, 1000);
    return () => {
      window.clearInterval(timer);
    }
  }, []);
  return (
    <div>
      Seconds: {time}
    </div>
  );
}
```

![](img/0031a68615ff29f66ee3dbce945fe1c4.png)

ç°åœ¨ï¼Œæ¯æ¬¡`setInterval()`å›è°ƒè¿è¡Œæ—¶,`time`çŠ¶æ€éƒ½ä¼šå¢åŠ  1ï¼Œå°±åƒå®ƒåº”è¯¥åšçš„é‚£æ ·ã€‚

# 2.äº‹ä»¶ä¾¦å¬å™¨é‡æ–°æ³¨å†Œ

å¦ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯æ¯æ¬¡çŠ¶æ€æ”¹å˜æ—¶ç”¨æ–°çš„å›è°ƒæ¥é‡æ–°æ³¨å†Œäº‹ä»¶ä¾¦å¬å™¨ï¼Œè¿™æ ·å›è°ƒæ€»æ˜¯ä»å°é—­èŒƒå›´è®¿é—®æ–°çš„çŠ¶æ€ã€‚

æˆ‘ä»¬é€šè¿‡å°†çŠ¶æ€å˜é‡ä¼ é€’ç»™`useEffect`çš„ dependencies æ•°ç»„æ¥å®ç°è¿™ä¸€ç‚¹:

`JavaScript`

```
import { useState, useEffect } from 'react';

export default function App() {
  const [time, setTime] = useState(0);

  useEffect(() => {
    const timer = setInterval(() => {
      setTime(time + 1);
    }, 1000);

    return () => {
      window.clearInterval(timer);
    }
  }, [time]);

  return (
    <div>
      Seconds: {time}
    </div>
  );
}
```

æ¯æ¬¡`time`çŠ¶æ€æ”¹å˜æ—¶ï¼Œè®¿é—®æ–°é²œçŠ¶æ€çš„æ–°å›è°ƒè¢«æ³¨å†Œåˆ°`setInterval()`ã€‚è°ƒç”¨`setTime()`æ—¶ï¼Œæœ€æ–°çš„`time`çŠ¶æ€åŠ  1ï¼Œå¢åŠ çŠ¶æ€å€¼ã€‚

# 2.å¤šæ¬¡æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åº

è¿™æ˜¯æ–°æ¥è§¦ååº”é’©å­å’ŒåŠŸèƒ½ç»„ä»¶çš„å¼€å‘äººå‘˜ç»å¸¸çŠ¯çš„é”™è¯¯ã€‚å¦‚æœå¯¹ React ä¸­çš„é‡æ–°å‘ˆç°è¿‡ç¨‹æ²¡æœ‰åŸºæœ¬çš„äº†è§£ï¼Œæ‚¨å¯èƒ½ä¼šå°è¯•åƒè¿™æ ·æ³¨å†Œäº‹ä»¶ä¾¦å¬å™¨:

`JavaScript`

```
import { useState } from 'react';

export default function App() {
  const [time, setTime] = useState(0);

  setInterval(() => {
    setTime((prevTime) => prevTime + 1);
  }, 1000);

  return (
    <div>
      Seconds: {time}
    </div>
  );
}
```

æˆ–è€…ä½ å¯ä»¥åƒè¿™æ ·æŠŠå®ƒæ”¾åœ¨ä¸€ä¸ª`useEffect`é’©å­é‡Œ:

`JavaScript`

```
import { useState } from 'react';

export default function App() {
  const [time, setTime] = useState(0);

  useEffect(() => {
    setInterval(() => {
      setTime((prevTime) => prevTime + 1);
    }, 1000);
  });

  return (
    <div>
      Seconds: {time}
    </div>
  );
}
```

å¦‚æœä½ *å¯¹è¿™ä¸ªæœ‰ä¸€ä¸ªåŸºæœ¬çš„äº†è§£ï¼Œä½ åº”è¯¥å·²ç»èƒ½çŒœåˆ°è¿™ä¼šç»™ç½‘é¡µå¸¦æ¥ä»€ä¹ˆã€‚*

å‘ç”Ÿä»€ä¹ˆäº‹äº†ï¼Ÿ

æ­£åœ¨å‘ç”Ÿçš„æ˜¯ï¼Œåœ¨ä¸€ä¸ªåŠŸèƒ½ç»„ä»¶ä¸­ï¼Œæ¯å½“ç»„ä»¶é‡æ–°å‘ˆç°æ—¶ï¼Œé’©å­ä¹‹å¤–å’Œè¿”å›çš„ JSX æ ‡è®°ä¹‹å¤–çš„ä»£ç éƒ½è¢«æ‰§è¡Œã€‚

ä¸‹é¢æ˜¯æ—¶é—´çº¿ä¸­å‘ç”Ÿçš„äº‹æƒ…çš„åŸºæœ¬åˆ†ç±»:

1.  **ç¬¬ä¸€ä¸ª**æ¸²æŸ“:**ç›‘å¬å™¨ 1** å·²æ³¨å†Œ
2.  **ç›‘å¬å™¨ 1** æ³¨å†Œå 1 ç§’:`time`çŠ¶æ€æ›´æ–°ï¼Œå¯¼è‡´å¦ä¸€æ¬¡é‡æ–°æ¸²æŸ“)
3.  **ç¬¬äºŒ**æ¸²æŸ“:**å¬è€…äºŒ**æ³¨å†Œã€‚
4.  **ç›‘å¬å™¨ 1** åœ¨é‡æ–°æ¸²æŸ“åä»æœªè¢«æ³¨é”€ï¼Œæ‰€ä»¥â€¦
5.  ä¸Šæ¬¡**ç›‘å¬å™¨ 1** è°ƒç”¨å 1 ç§’:çŠ¶æ€æ›´æ–°
6.  **ç¬¬ä¸‰**æ¸²æŸ“:**ç›‘å¬å™¨ 3** æ³¨å†Œã€‚
7.  **ç›‘å¬å™¨ 2** åœ¨é‡æ–°æ¸²æŸ“åä»æœªè¢«æ³¨é”€ï¼Œæ‰€ä»¥â€¦
8.  **ç›‘å¬å™¨ 2** æ³¨å†Œå 1 ç§’:çŠ¶æ€æ›´æ–°
9.  **ç¬¬å››ä¸ª**æ¸²æŸ“:**ç›‘å¬å™¨ 4** æ³¨å†Œã€‚
10.  ä¸Šæ¬¡**ç›‘å¬å™¨ 1** è°ƒç”¨å 1 ç§’:çŠ¶æ€æ›´æ–°
11.  **ç¬¬äº”**æ¸²æŸ“:**å¬è€… 5** æ³¨å†Œã€‚
12.  ä¸Šæ¬¡**ç›‘å¬å™¨ 2** è°ƒç”¨å 1 ç§’:çŠ¶æ€æ›´æ–°
13.  **ç¬¬å…­**æ¸²æŸ“:**ç›‘å¬å™¨ 6** æ³¨å†Œã€‚
14.  **ç›‘å¬å™¨ 3** åœ¨é‡æ–°æ¸²æŸ“åä»æœªè¢«æ³¨é”€ï¼Œæ‰€ä»¥â€¦
15.  **ç›‘å¬å™¨**3 æ³¨å†Œå 1 ç§’:çŠ¶æ€æ›´æ–°ã€‚
16.  **ç¬¬ 7 ä¸ª**æ¸²æŸ“:**ç›‘å¬å™¨ 7** æ³¨å†Œâ€¦

æœ€ç»ˆï¼Œéšç€æˆç™¾ä¸Šåƒ(ç”šè‡³ä¸Šç™¾ä¸‡)çš„å›è°ƒè¢«åˆ›å»ºï¼Œäº‹æƒ…å¤±å»äº†æ§åˆ¶ï¼Œæ¯ä¸ªå›è°ƒåœ¨ä¸€ç§’é’Ÿå†…çš„ä¸åŒæ—¶é—´è¿è¡Œï¼Œå°†`time`é€’å¢ 1ã€‚

æœ¬æ–‡çš„ç¬¬ä¸€ä¸ªä¾‹å­å·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜â€”â€”å°†äº‹ä»¶ç›‘å¬å™¨æ”¾åœ¨`useEffect`é’©å­ä¸­ï¼Œå¹¶ç¡®ä¿ä¼ é€’ä¸€ä¸ªç©ºçš„ä¾èµ–æ•°ç»„(`[]`)ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚

`JavaScript`

```
import { useEffect, useState } from 'react';

export default function App() {
  const [time, setTime] = useState(0);

  useEffect(() => {
    setInterval(() => {
      setTime((prevTime) => prevTime + 1);
    }, 1000);
  }, []);

  return (
    <div>
      Seconds: {time}
    </div>
  );
}
```

`useEffect`åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“åä»¥åŠä¾èµ–æ•°ç»„ä¸­çš„ä»»ä½•å€¼æ”¹å˜æ—¶è¿è¡Œï¼Œæ‰€ä»¥ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ä½¿å®ƒåªåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶è¿è¡Œã€‚

ç°åœ¨æ—¶é—´åœ¨ç¨³æ­¥å¢åŠ ï¼Œä½†æ­£å¦‚ä½ åœ¨æ¼”ç¤ºä¸­çœ‹åˆ°çš„ï¼Œå®ƒå¢åŠ äº† 2 ç§’ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬ç¬¬ä¸€ä¸ªä¾‹å­ä¸­çš„ 1 ç§’ã€‚è¿™æ˜¯å› ä¸ºåœ¨ React 18 ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰ç»„ä»¶éƒ½è¦æŒ‚è½½ã€å¸è½½ï¼Œç„¶åå†æŒ‚è½½ã€‚æ‰€ä»¥`useEffect`å³ä½¿åœ¨ä¸€ä¸ªç©ºçš„ä¾èµ–æ•°ç»„ä¸­ä¹Ÿè¿è¡Œäº†ä¸¤æ¬¡ï¼Œåˆ›å»ºäº†ä¸¤ä¸ªç›‘å¬å™¨ï¼Œå®ƒä»¬æ¯ç§’é€šè¿‡`1`æ›´æ–°æ—¶é—´ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡å…³é—­ä¸¥æ ¼æ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­çœ‹åˆ°ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•ã€‚

# 3.ç»„ä»¶å¸è½½æ—¶ä¸æ³¨é”€äº‹ä»¶å¤„ç†ç¨‹åºã€‚

è¿™é‡Œå‘ç”Ÿçš„æ˜¯å†…å­˜æ³„æ¼ã€‚æˆ‘ä»¬åº”è¯¥ç¡®ä¿å½“ç»„ä»¶å¸è½½æ—¶ï¼Œä»»ä½•åˆ›å»ºçš„äº‹ä»¶ç›‘å¬å™¨éƒ½æ˜¯æœªæ³¨å†Œçš„ã€‚å› æ­¤ï¼Œå½“ React 18 ä¸¥æ ¼æ¨¡å¼å¼ºåˆ¶å¸è½½ç»„ä»¶æ—¶ï¼Œç¬¬ä¸€ä¸ªåŒºé—´ç›‘å¬å™¨åœ¨ç»„ä»¶å†æ¬¡æŒ‚è½½æ—¶æ³¨å†Œç¬¬äºŒä¸ªç›‘å¬å™¨ä¹‹å‰è¢«æ³¨é”€ã€‚åªæœ‰ç¬¬äºŒä¸ªç›‘å¬å™¨ä¼šè¢«ç•™ä¸‹ï¼Œæ—¶é—´ä¼šæ¯ç§’é’Ÿæ­£ç¡®æ›´æ–°â€”åˆ°`1`ã€‚

æ‚¨å¯ä»¥åœ¨ç»„ä»¶å¸è½½æ—¶æ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œæ–¹æ³•æ˜¯å°†å‡½æ•°`useEffect`é€‰æ‹©æ€§åœ°è¿”å›ã€‚æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨`clearInterval`åœ¨é‚£é‡Œæ³¨é”€åŒºé—´ç›‘å¬å™¨ã€‚

`JavaScript`

```
import { useEffect, useState } from 'react';

export default function App() {
  const [time, setTime] = useState(0);
  useEffect(() => {
    console.log('here');
    const timer = setInterval(() => {
      setTime((prevTime) => prevTime + 1);
    }, 1000);
    // ğŸ‘‡ Unregister interval listener
    return () => {
      clearInterval(timer);
    }
  }, []);
  return (
    <div>
      Seconds: {time}
    </div>
  );
}
```

`useEffect`çš„æ¸…ç†åŠŸèƒ½åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“ åè¿è¡Œ [**ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨ç»„ä»¶å¸è½½æ—¶ã€‚è¿™å¯ä»¥é˜²æ­¢å½“ä¸€ä¸ªå¯è§‚å¯Ÿå±æ€§æ”¹å˜å€¼è€Œç»„ä»¶ä¸­çš„è§‚å¯Ÿè€…æ²¡æœ‰å–æ¶ˆè®¢é˜…ä¹‹å‰çš„å¯è§‚å¯Ÿå€¼æ—¶å‘ç”Ÿçš„å†…å­˜æ³„æ¼ã€‚**](https://reactjs.org/docs/hooks-effect.html#explanation-why-effects-run-on-each-update)

# ç»“è®º

åœ¨ React ä¸­åˆ›å»ºäº‹ä»¶ä¾¦å¬å™¨éå¸¸ç®€å•ï¼Œæ‚¨åªéœ€è¦çŸ¥é“è¿™äº›æ³¨æ„äº‹é¡¹ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…æ„å¤–é”™è¯¯å’Œä»¤äººæ²®ä¸§çš„è°ƒè¯•ã€‚é¿å…è®¿é—®è¿‡æ—¶çš„çŠ¶æ€å˜é‡ï¼Œä¸è¦æ³¨å†Œè¶…è¿‡éœ€è¦çš„äº‹ä»¶ä¾¦å¬å™¨ï¼Œå¹¶ä¸”åœ¨ç»„ä»¶å¸è½½æ—¶æ€»æ˜¯å–æ¶ˆæ³¨å†Œäº‹ä»¶ä¾¦å¬å™¨ã€‚

*åŸè½½äº*ã€codingbeautydev.comã€‘

# *JavaScript åšçš„æ¯ä¸€ä»¶ç–¯ç‹‚çš„äº‹æƒ…*

*ä¸€æœ¬å…³äº JavaScript å¾®å¦™çš„è­¦å‘Šå’Œé²œä¸ºäººçŸ¥çš„éƒ¨åˆ†çš„è¿·äººæŒ‡å—ã€‚*

*![](img/143ee152ba78025ea8643ba5b9726a20.png)*

*[**æŠ¥å**](https://cbdev.link/d3c4eb) ç«‹å³å…è´¹é¢†å–ä¸€ä»½ã€‚*