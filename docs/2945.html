<html>
<head>
<title>Setup Cube.js with MongoDB (Along With Multi-Tenant Configuration)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用MongoDB设置Cube.js(以及多租户配置)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/setup-cubejs-with-mongodb-along-with-multi-tenant-configuration-d760258b5bbf?source=collection_archive---------0-----------------------#2022-07-17">https://javascript.plainenglish.io/setup-cubejs-with-mongodb-along-with-multi-tenant-configuration-d760258b5bbf?source=collection_archive---------0-----------------------#2022-07-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="169e" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">关于如何为多租户配置和MongoDB数据库设置Cube.js的教程</h2></div><p id="d6a7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我已经使用Cube.js一年了，这个库提供的优势是值得称赞的。随着越来越多的活跃社区，这个图书馆向它的用户承诺了一个伟大的特性。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi ky"><img src="../Images/6658a6aab41493a6803d2b058697c948.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/0*sxuwag4e-tUHyIBX.png"/></div><figcaption class="lg lh gj gh gi li lj bd b be z dk">Cube js documentation — <a class="ae lk" href="https://cube.dev/docs/" rel="noopener ugc nofollow" target="_blank">https://cube.dev/docs/</a></figcaption></figure><p id="b689" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本教程中，我们将学习如何为多租户配置和MongoDB数据库设置Cube.js，是的，这次我们为您介绍了Mac M1芯片。</p><p id="f3e8" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在开始之前，请记住安装MongoDB并运行mongod实例。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/46e69870f424da2c2995be31a8b56960.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/0*e12ABE8opLFNwsSJ.gif"/></div></figure><h1 id="ea81" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated"><strong class="ak">设置Cube.js项目:</strong></h1><p id="5dc1" class="pw-post-body-paragraph kc kd in ke b kf me jo kh ki mf jr kk kl mg kn ko kp mh kr ks kt mi kv kw kx ig bi translated">因为MongoDB是一个非关系数据库，所以它需要被采样到一个关系数据库中，比如MySQL数据库。mongoBI连接器通过让您在MongoDB上运行MySQL查询来智能地完成这项工作。然而，MongoDB按照特定的规则展平你的集合，更多关于这个<strong class="ke io"> </strong> <a class="ae lk" href="https://www.mongodb.com/blog/post/bi-connector-mapping-document-structures-to-relational-schema-part-1" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io">这里</strong> </a>。</p><ol class=""><li id="fb87" class="mj mk in ke b kf kg ki kj kl ml kp mm kt mn kx mo mp mq mr bi translated">根据您的操作系统版本<br/><a class="ae lk" href="https://www.mongodb.com/try/download/bi-connector" rel="noopener ugc nofollow" target="_blank">https://www.mongodb.com/try/download/bi-connecto</a>r下载mongoBI连接器的tar或zip文件</li></ol><pre class="kz la lb lc gt ms mt mu mv aw mw bi"><span id="7bc4" class="mx ln in mt b gy my mz l na nb">Mac users will OpenSSL , which can be installed via the following commands<br/>/usr/bin/ruby -e “$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"brew updatebrew install openssl</span></pre><p id="1490" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2.据观察，Mac M1芯片会导致OpenSSL安装出现问题。请参考以下资源中的步骤，让您的设置正常工作<br/><a class="ae lk" href="https://noahpeeters.de/posts/apple-silicon/homebrew-setup/" rel="noopener ugc nofollow" target="_blank">https://noahpeeters.de/posts/apple-silicon/homebrew-setup/</a></p><p id="b6c5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.解压缩您的mongoBI下载文件并导航到bin目录。使用以下命令安装mongoBI连接器:</p><pre class="kz la lb lc gt ms mt mu mv aw mw bi"><span id="a3ce" class="mx ln in mt b gy my mz l na nb">&gt; sudo install -m755 bin/mongo* /usr/local/bin/</span></pre><p id="cb5b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">4.从终端运行以下命令来启动mongoBI连接器并对数据库进行采样:</p><pre class="kz la lb lc gt ms mt mu mv aw mw bi"><span id="24af" class="mx ln in mt b gy my mz l na nb">&gt; mongosqld</span></pre><p id="ff41" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">5.如果一切正常，您应该在您的shell中看到一条关于<code class="fe nd ne nf mt b">mongosqld</code>进程的成功日志消息:<br/> <code class="fe nd ne nf mt b">[initandlisten] waiting for connections at 127.0.0.1:3307</code></p><p id="319e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">6.要启动您的应用程序，请使用以下命令以及您的项目名称:</p><pre class="kz la lb lc gt ms mt mu mv aw mw bi"><span id="3d14" class="mx ln in mt b gy my mz l na nb">&gt; npx cubejs-cli create &lt;name of the application&gt; -d mongobi</span></pre><p id="72c6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">7.设置各自的环境变量:</p><pre class="kz la lb lc gt ms mt mu mv aw mw bi"><span id="df23" class="mx ln in mt b gy my mz l na nb">CUBEJS_API_URL = “<a class="ae lk" href="http://localhost:4000" rel="noopener ugc nofollow" target="_blank">http://localhost:4000</a>"<br/>CUBEJS_API_SECRET = “e863ce0c26e4aaacc44b4cdef3abfaefe4ad3b488908cf89a256aaa9c3876e51cdd29abbc85115e75a510e4fda4c0857b706272e3faeffbf5e7b58efbd27d707”<br/>CUBEJS_DB_HOST=localhost<br/>CUBEJS_DB_NAME=Test<br/>CUBEJS_DB_PORT=3307<br/>CUBEJS_WEB_SOCKETS=true<br/>CUBEJS_DEV_MODE=true<br/>CUBEJS_DB_TYPE=mongobi<br/>CUBEJS_CACHE_AND_QUEUE_DRIVER=memory<br/>CUBEJS_SCHEDULED_REFRESH_TIMER=60<br/>CUBEJS_EXTERNAL_DEFAULT=true<br/>DEBUG_LOG=true<br/>CUBEJS_REFRESH_WORKER=true</span></pre><p id="c082" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请根据您感兴趣的数据库名称和端口名称设置CUBEJS_DB_NAME和CUBEJS_DB_PORT。我们将在开发人员模式下运行Cube.js，并使用refresh worker进行无头缓存(这不是必需的，但将取决于您的用例)。有关上述环境变量的更多信息，请参见<a class="ae lk" href="https://cube.dev/docs/reference/environment-variables#environment-variables" rel="noopener ugc nofollow" target="_blank">这里的</a>。</p><p id="38cc" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">8.使用以下内容启动应用程序:</p><pre class="kz la lb lc gt ms mt mu mv aw mw bi"><span id="949a" class="mx ln in mt b gy my mz l na nb">&gt;  npm run dev</span></pre><p id="e6bb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以从“localhost:4000”开始获取Cube.js playground</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ng"><img src="../Images/c39939cc28fa9c2bb48fb8fd47e93e0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BmyhJWInr23xVCEHp0oD2w.png"/></div></div></figure><h1 id="2d22" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated"><strong class="ak">设置多租户配置:</strong></h1><ol class=""><li id="1ed7" class="mj mk in ke b kf me ki mf kl nl kp nm kt nn kx mo mp mq mr bi translated">我们可以为您的每个集合包含多个租户的数据。为了过滤每个租户的数据，我们将参考“租户”集合中的<em class="nc"> tenantId </em>字段创建一个租户多维数据集。</li></ol><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="dccc" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2.我们需要通过连接操作在感兴趣的多维数据集和租户集合之间创建适当的连接，例如:</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="8259" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.将查询重写过滤器添加到Cube.js配置文件中的“module.exports”对象，以根据安全上下文的请求获取特定tenantId的数据。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="4e6c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">4.现在，我们已经在租户多维数据集和各自的过滤器之间建立了连接，我们可以通过安全上下文从请求特定租户Id的数据。</p><p id="2a2a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">5.转到Cube.js playground，单击“Add security Context”选项卡添加一个特定的安全上下文，然后单击“Save”按钮。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nq"><img src="../Images/8a88e105a3eb4287522f6dca93528d00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9OLJ7nyYwJ8kjP8aJbB00w.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk">Add security context via the “Add security tab” in Cube.js playground</figcaption></figure><p id="4de1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">6.Tada！您应该能够获得所请求的租户Id的数据。</p><p id="9a64" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢您的参与，请在下面的评论区留下您的意见和建议。</p><p id="d23e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nc">更多内容看</em> <a class="ae lk" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nc">说白了就是</em> </strong> </a> <em class="nc">。报名参加我们的</em> <a class="ae lk" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nc">免费周报</em> </strong> </a> <em class="nc">。关注我们关于</em> <a class="ae lk" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nc">推特</em></strong></a><strong class="ke io"><em class="nc"/></strong><em class="nc">和</em><a class="ae lk" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="nc">LinkedIn</em></strong></a><em class="nc">。查看我们的</em> <a class="ae lk" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nc">社区不和谐</em> </strong> </a> <em class="nc">加入我们的</em> <a class="ae lk" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nc">人才集体</em> </strong> </a> <em class="nc">。</em></p></div></div>    
</body>
</html>