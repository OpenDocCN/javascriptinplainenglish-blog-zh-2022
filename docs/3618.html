<html>
<head>
<title>How to Create a Popup for OAuth Login</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为OAuth登录创建弹出窗口</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-a-popup-for-oauth-login-38dee97f5f3b?source=collection_archive---------4-----------------------#2022-09-12">https://javascript.plainenglish.io/how-to-create-a-popup-for-oauth-login-38dee97f5f3b?source=collection_archive---------4-----------------------#2022-09-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="5f25" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">关于为OAuth登录创建登录弹出窗口而不是将用户重定向到另一个页面的教程。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/38303643e924b476aec5e5c7c3918089.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qqnbQzW5begzMfSy"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@mr_williams_photography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Micah Williams</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="712c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您已经启动并运行了OAuth，但是不喜欢它重定向用户登录。你更希望登录是一个弹出窗口。幸运的是，有一个简单的方法可以做到这一点。</p><h1 id="38a1" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">1.打开一个新窗口并创建对它的引用。</h1><p id="d08c" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">首先，我们需要创建弹出窗口。我们通过调用<code class="fe mm mn mo mp b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/open" rel="noopener ugc nofollow" target="_blank">window.open()</a></code>来做到这一点。我们还需要将对这个新窗口的引用存储在一个变量中，以便以后使用:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mq"><img src="../Images/94789b79f8ef18422771af0a13cae51b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U3PZQ-0R9JaCBa_NZ914dw.png"/></div></div></figure><p id="f725" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe mm mn mo mp b">window.open()</code>函数接受3个可选参数:</p><ol class=""><li id="2006" class="mr ms in kv b kw kx kz la lc mt lg mu lk mv lo mw mx my mz bi translated"><code class="fe mm mn mo mp b">url</code>是要加载到<code class="fe mm mn mo mp b">window</code>中的资源。</li><li id="e8e9" class="mr ms in kv b kw na kz nb lc nc lg nd lk ne lo mw mx my mz bi translated"><code class="fe mm mn mo mp b">target</code>控制<code class="fe mm mn mo mp b">url</code>将被加载到哪个<code class="fe mm mn mo mp b">window</code>。如果现有的<code class="fe mm mn mo mp b">window</code>与给定的名称匹配，那么<code class="fe mm mn mo mp b">url</code>将被加载到那个<code class="fe mm mn mo mp b">window</code>中。如果不匹配，则创建一个具有给定名称的新的<code class="fe mm mn mo mp b">window</code>。<code class="fe mm mn mo mp b">target</code>参数也可以接受<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#attr-target" rel="noopener ugc nofollow" target="_blank">特殊关键字</a>。</li><li id="8f9d" class="mr ms in kv b kw na kz nb lc nc lg nd lk ne lo mw mx my mz bi translated"><code class="fe mm mn mo mp b">windowFeatures</code>接受一个特殊格式的属性字符串给<code class="fe mm mn mo mp b">window</code>，就像<code class="fe mm mn mo mp b">height</code>和<code class="fe mm mn mo mp b">width</code>一样。如果你传递任何东西给这个参数，结果将是一个弹出窗口<code class="fe mm mn mo mp b">window</code>。还有一个专用的<code class="fe mm mn mo mp b">popup</code>属性，它将使<code class="fe mm mn mo mp b">window</code>成为一个最小的弹出窗口。</li></ol><p id="6873" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">对于OAuth工作流，将<code class="fe mm mn mo mp b">url</code>设置为您正在使用的API，将<code class="fe mm mn mo mp b">target</code>设置为现有的或新的<code class="fe mm mn mo mp b">window</code>的名称，并将<code class="fe mm mn mo mp b">windowFeatures</code>设置为<code class="fe mm mn mo mp b">"popup=true"</code>:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mq"><img src="../Images/16ece07704417dc8fd82cca63e76c82c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v_oCivu3lgUsjX2dj1MNFw.png"/></div></div></figure><p id="c5a4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这将打开一个弹出窗口，显示用户登录页面。</p><h1 id="8b11" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">2.使用setInterval检查弹出窗口。</h1><p id="d48f" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">现在我们有了一个弹出窗口，我们需要监听任何变化。这就是为什么保存对新的<code class="fe mm mn mo mp b">window</code>的引用很重要:有了这个引用，我们可以使用<code class="fe mm mn mo mp b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/setInterval" rel="noopener ugc nofollow" target="_blank">setInterval</a></code>定期检查状态。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mq"><img src="../Images/b0f5360fadc77c11749f827907557385.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UxkKvb1BjwQJC1vOfnivLQ.png"/></div></div></figure><p id="1deb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe mm mn mo mp b">setInterval</code>函数接受两个参数:一个回调函数和调用它的频率，以毫秒为单位。在上面的示例代码中，匿名回调函数(<code class="fe mm mn mo mp b">() =&gt; {}</code>)将每1秒被调用一次。对<code class="fe mm mn mo mp b">setInterval</code>函数的引用被存储为<code class="fe mm mn mo mp b">checkPopup</code>，这对以后阻止它永远检查弹出窗口很重要。</p><h1 id="64bd" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">3.弹出窗口打开时继续检查。</h1><p id="9adf" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">当我们的<code class="fe mm mn mo mp b">popup</code>打开时，我们想继续检查它的状态。为此，如果弹出窗口仍然打开，我们将简单地返回而不做任何事情:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mq"><img src="../Images/c1214882caf6705477818061a46fac4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aDHC9N1ozK3tAF9NFFO2QQ.png"/></div></div></figure><h1 id="bafa" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">4.准备好后关闭弹出窗口。</h1><p id="0de0" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">根据您在弹出窗口中使用的登录API，这一部分看起来会有所不同。在示例项目中，API重定向回网站，附加某些查询参数。因此，为了知道何时关闭弹出窗口，我们检查<code class="fe mm mn mo mp b">popup</code>是否被重定向回我们的网站:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mq"><img src="../Images/ef6c58d63a0fa1da4dff0f9681b0ed79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7lNN9Q2JPMtDFSbjYELj4g.png"/></div></div></figure><p id="df49" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果我们在检查了<code class="fe mm mn mo mp b">popup</code>是否关闭后试图关闭它，我们将会陷入一个无限循环的情况，在那里<code class="fe mm mn mo mp b">popup</code>将永远无法关闭。所以在检查<code class="fe mm mn mo mp b">popup</code>是否关闭之前，我们需要确保关闭<code class="fe mm mn mo mp b">popup</code>。</p><h1 id="a904" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">5.关闭状态检查。</h1><p id="ab57" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">最后，一旦<code class="fe mm mn mo mp b">popup</code>关闭，我们要关闭<code class="fe mm mn mo mp b">checkPopup</code>功能。我们通过在<code class="fe mm mn mo mp b">checkPopup</code>上调用<code class="fe mm mn mo mp b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/clearInterval" rel="noopener ugc nofollow" target="_blank">clearInterval</a></code>来实现这一点:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mq"><img src="../Images/9a4eb338624d9acae9e8161fea3fa69b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rbJZno3BJoTVXUFBbdQypw.png"/></div></div></figure></div><div class="ab cl nf ng hr nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ig ih ii ij ik"><pre class="kd ke kf kg gt nm mp nn no aw np bi"><span id="e202" class="nq lq in mp b gy nr ns l nt nu">const popup = window.open(url, “popup”, “popup=true”);<br/>const checkPopup = setInterval(() =&gt; {<br/>   if (popup.window.location.href<br/>      .includes(CLIENT_URL)) {popup.close()}<br/>   if (!popup || !popup.closed) return;<br/>   clearInterval(checkPopup);<br/>}, 1000);</span></pre><p id="05e0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当我使用<a class="ae ks" href="https://developer.spotify.com/documentation/general/guides/authorization/code-flow/" rel="noopener ugc nofollow" target="_blank"> Spotify的授权代码流</a>来请求访问用户的图书馆时，这段代码对我有效。这对你有用吗？下面让我知道！</p></div><div class="ab cl nf ng hr nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ig ih ii ij ik"><p id="421f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="nv">更多内容请看</em><a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nv">plain English . io</em></strong></a><em class="nv">。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nv">免费周报</em> </strong> </a> <em class="nv">。关注我们关于</em><a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nv">Twitter</em></strong></a><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nv">LinkedIn</em></strong></a><em class="nv"/><a class="ae ks" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nv">YouTube</em></strong></a><em class="nv"/><a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nv">不和</em> </strong> </a> <em class="nv">。对增长黑客感兴趣？检查</em> <a class="ae ks" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nv">电路</em> </strong> </a> <em class="nv">。</em></p></div></div>    
</body>
</html>