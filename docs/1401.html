<html>
<head>
<title>7 Ways to Flatten Arrays in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中展平数组的7种方法</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/7-ways-to-flatten-arrays-in-javascript-2574db3aff2?source=collection_archive---------3-----------------------#2022-03-22">https://javascript.plainenglish.io/7-ways-to-flatten-arrays-in-javascript-2574db3aff2?source=collection_archive---------3-----------------------#2022-03-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bf4a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我们来看看有什么可以替代扁平化的方法。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/37a97c00ca134d263e528d1f9d0dfab8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*i1yDySDWivs72o6V"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@fempreneurstyledstock?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Leone Venter</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1387" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数组扁平化就是将多层嵌套数组转换为只有一层。用代码来解释，应该是<code class="fe ls lt lu lv b">[1, [2, [3, 4, 5]]] =&gt; [1, 2, 3, 4, 5]</code>。让我们看看它是如何工作的！</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="967a" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">1.Array.prototype.flatMap +递归</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/77b287a6caa81e99c48a517740678a42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iX-pSDAXoDhd5T8mcSMh6A.png"/></div></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="f770" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们先来看看ES6中提供的<code class="fe ls lt lu lv b">flatMap</code>方法，就是调用<code class="fe ls lt lu lv b">Array.prototype.map</code>得到结果然后在结果上调用<code class="fe ls lt lu lv b">Array.prototype.flat(1)</code>，就是把结果扁平化一层。这比分别调用这两个方法要稍微高效一些。</p><p id="9517" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以判断当前项是否是循环中的嵌套数组，如果是，recurse，如果不是，直接返回。flatMap会帮助我们在循环结束后将结果展平一层。</p><h1 id="4397" class="md me iq bd mf mg my mi mj mk mz mm mn jw na jx mp jz nb ka mr kc nc kd mt mu bi translated">2.Array.prototype.reduce +递归</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/f38a7bf09de1456c1c054def2dd75727.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I9FLB-CEIL1Dd4c4wnAPsg.png"/></div></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="c482" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe ls lt lu lv b">Array.prototype.reduce</code>方法，我们可以进行累加计算，因为<code class="fe ls lt lu lv b">concat</code>的参数既可以传递数组，也可以传递单项，所以可以直接在一行中实现。</p><p id="d7a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里<code class="fe ls lt lu lv b">concat</code>这里也可以换成push，详见选项2。</p><h1 id="3496" class="md me iq bd mf mg my mi mj mk mz mm mn jw na jx mp jz nb ka mr kc nc kd mt mu bi translated">3.for…of +递归</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/1c9afeef622ddf55547eb496d157830c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UFkQZbzClvSKwL04RrMG8A.png"/></div></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="e7be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">循环原数组，判断当前项是否为数组，递归调用flatten，用<code class="fe ls lt lu lv b">concat</code>串联递归结果。如果不是数组，直接推到结果。</p><p id="acd2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样，<code class="fe ls lt lu lv b">concat</code>可以用push代替，详见选项2。</p><h1 id="aaab" class="md me iq bd mf mg my mi mj mk mz mm mn jw na jx mp jz nb ka mr kc nc kd mt mu bi translated">4.while +迭代</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/72b5a634a9cc452e7f93a0a8117f08c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7rFYM-L4rBr0ZO6ezfnr-g.png"/></div></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="486c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样就用<code class="fe ls lt lu lv b">Array.prototype.some</code> API连续判断<code class="fe ls lt lu lv b">arr</code>中是否有数组，如果有，就展平直到arr中没有数组项。</p><p id="24ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里<code class="fe ls lt lu lv b">Array.prototype.concat</code> API可以用三种方式编写。注意调用和应用之间的区别。</p><h1 id="b73b" class="md me iq bd mf mg my mi mj mk mz mm mn jw na jx mp jz nb ka mr kc nc kd mt mu bi translated">5.(String | | array . prototype . tostring)+(split | | JSON . parse)</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/c069be2947ba0dda10557889ce296f65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h1HL0A6pQgwGV7h_e_e8wQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="ddf2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在处理字符串数组或者数值数组的时候，我们可以调用<code class="fe ls lt lu lv b">String()</code>或者<code class="fe ls lt lu lv b">Array.prototype.toString</code>显式的将数组转换为字符串类型来移除原数组中的所有<code class="fe ls lt lu lv b">[]</code>，这样就会得到字符串<code class="fe ls lt lu lv b">1,2,3,4,5</code>。那么有两种处理方法:</p><ol class=""><li id="8ec7" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated">调用<code class="fe ls lt lu lv b">String.split</code>方法以<code class="fe ls lt lu lv b">,</code>分隔字符串，那么你将得到<code class="fe ls lt lu lv b">['1','2','3','4','5']</code>。此时数组中每一项的类型都是字符串而不是数字，所以我们通过对数组的每一项调用<code class="fe ls lt lu lv b">Number()</code>来调用<code class="fe ls lt lu lv b">Array.prototype.map</code>将其显式转换为数字。</li><li id="fa81" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">将字符串拼接成<code class="fe ls lt lu lv b">[1,2,3,4,5]</code>，然后调用<code class="fe ls lt lu lv b">JSON.parse</code>将字符串构造成数组对象。</li></ol><h1 id="bf1b" class="md me iq bd mf mg my mi mj mk mz mm mn jw na jx mp jz nb ka mr kc nc kd mt mu bi translated">6.JSON . stringify+RegExp+(split | | JSON . parse)</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/a725315fd861ad835199f7f7d315f92c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p-I0V1bDYM4aAjalZlU5lA.png"/></div></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="8f01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在处理字符串数组或者数值数组的时候，我们也是用<code class="fe ls lt lu lv b">JSON.stringify</code>对数组进行get <code class="fe ls lt lu lv b">'[1,[2,[3,[4,[5]]]]]'</code>，然后用RegExp去掉所有<code class="fe ls lt lu lv b">[]</code>，get <code class="fe ls lt lu lv b">1,2,3,4,5</code>。这与使用<code class="fe ls lt lu lv b">String()</code>或<code class="fe ls lt lu lv b">Array.prototype.toString</code>的效果相同。</p><p id="3604" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来的步骤与方案5相同，使用<code class="fe ls lt lu lv b">String.split</code>或<code class="fe ls lt lu lv b">JSON.parse</code>得到我们想要的结果。</p><h1 id="890e" class="md me iq bd mf mg my mi mj mk mz mm mn jw na jx mp jz nb ka mr kc nc kd mt mu bi translated">7.平的</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/b1a69d98109902a602582c58d9eb1867.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rRh3YKxizvnMWsuc7io78Q.png"/></div></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="fbf2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以直接使用ES6提供的<code class="fe ls lt lu lv b">flat</code>方法，该方法可以传递一个深度作为参数来表示要扩展的深度。这里我们指定了<code class="fe ls lt lu lv b">Infinity</code>，表示我们想要将任意深度的嵌套数组转换为一维数组。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><p id="d135" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们也想像flat一样实现传入指定深度，然后再展平的方法呢？</p><p id="891d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">只需要不断减少递归或迭代的次数，判断当前值是否大于0。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx mx l"/></div></figure><p id="c89c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还可以使用我在之前的文章中实现的<a class="ae kv" href="https://levelup.gitconnected.com/how-to-get-a-perfect-deep-equal-in-javascript-b849fe30e54f" rel="noopener ugc nofollow" target="_blank">来验证结果，我们可以看到它们符合我们的预期。</a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><p id="7537" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我是李。我会继续输出前端技术相关的故事。如果你喜欢这样的故事，想支持我，请考虑成为 <a class="ae kv" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="ny">中等会员</em> </a> <em class="ny">。每月5美元，你可以无限制地访问媒体内容。如果你通过</em> <a class="ae kv" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="ny">我的链接</em> </a> <em class="ny">报名，我会得到一点佣金。</em></p><p id="217e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你的支持对我来说非常重要——谢谢。</p><p id="09da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ny">更多内容请看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ny">plain English . io</em></strong></a><em class="ny">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ny">免费周报</em> </strong> </a> <em class="ny">。关注我们关于</em><a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ny">Twitter</em></strong></a><em class="ny">和</em><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ny">LinkedIn</em></strong></a><em class="ny">。加入我们的</em> <a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ny">社区不和谐</em> </strong> </a> <em class="ny">。</em></p></div></div>    
</body>
</html>