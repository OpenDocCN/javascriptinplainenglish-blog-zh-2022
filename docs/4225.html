<html>
<head>
<title>Improving Page Experience With H5 History API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用H5历史API改善页面体验</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/improving-page-experience-with-h5-history-api-1a23b64041a2?source=collection_archive---------6-----------------------#2022-11-10">https://javascript.plainenglish.io/improving-page-experience-with-h5-history-api-1a23b64041a2?source=collection_archive---------6-----------------------#2022-11-10</a></blockquote><div><div class="fc ic id ie if ig"/><div class="ih ii ij ik il"><div class=""/><figure class="gm go jm jn jo jp gi gj paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="gi gj jl"><img src="../Images/483cdbbf57e17ffa85b2ca1afa2e8878.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8fdGY3uFB_txBomm"/></div></div><figcaption class="jw jx gk gi gj jy jz bd b be z dk">Photo by <a class="ae ka" href="https://unsplash.com/@richygreat?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Richy Great</a> on <a class="ae ka" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f5a1" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">当我们用谷歌搜索某样东西时，会有很多结果。如果第一页没有期望的结果，我们可以切换到下一页，当我们点击浏览器返回图标时，我们可以继续看到上一页的内容。</p><p id="8d2f" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">是的，这是一次很好的经历，我们怎样才能让我们的页面变成这样。在本文中，我们将学习如何使用H5历史API来实现这个功能。</p><h2 id="aa5f" class="kz la io bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">历史API简介</h2><p id="39d1" class="pw-post-body-paragraph kb kc io kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky ih bi translated"><a class="ae ka" href="https://developer.mozilla.org/en-US/docs/Web/API/History_API" rel="noopener ugc nofollow" target="_blank">历史应用编程接口</a>提供了许多有用的方法和属性，我们可以导航回页面并操作历史堆栈的内容。</p><figure class="ly lz ma mb gu jp gi gj paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="gi gj lx"><img src="../Images/39b3988868b7103430c96e710df5ed9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-R7AiYdNum2oTmYFnRkOWw.png"/></div></div></figure><p id="f5dd" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">我们可以用<code class="fe mc md me mf b">history.pushState/replaceState</code>打开新的页面，用<code class="fe mc md me mf b">history.forward</code>向前，用<code class="fe mc md me mf b">history.back</code>向后，甚至可以用<code class="fe mc md me mf b">history.go</code>方法从会话历史中加载一个特定的页面。</p><p id="c091" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">当我们向前或向后移动时，无论是使用历史api还是使用浏览器导航图标，都会触发<code class="fe mc md me mf b">window.onpopstate</code>事件，我们可以做一些与页面相关的事情。</p><h2 id="7a42" class="kz la io bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">创建带有分页的页面</h2><p id="9d6f" class="pw-post-body-paragraph kb kc io kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky ih bi translated">我们将为unsplash的猫图片创建一个页面:</p><figure class="ly lz ma mb gu jp"><div class="bz fq l di"><div class="mg mh l"/></div></figure><p id="63ab" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">每个人都可以使用<a class="ae ka" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> unsplash </a>的open api来检索图片，我们在这里搜索猫图片，每页显示9张图片。</p><p id="a6ba" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">当我们点击下一步按钮，然后刷新页面时，页面状态会丢失，并且会显示第一页的图片。所以我们可以通过在url中添加分页来解决这个问题。</p><h2 id="d8ca" class="kz la io bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">使用历史应用编程接口将分页参数添加到url</h2><p id="227c" class="pw-post-body-paragraph kb kc io kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky ih bi translated">我们可以使用<code class="fe mc md me mf b">history.pushState</code>在不刷新页面的情况下更改网址。因此，当我们单击“下一步”按钮时，我们将分页参数添加到url搜索中:</p><pre class="ly lz ma mb gu mi mf mj mk aw ml bi"><span id="0abf" class="kz la io mf b gz mm mn l mo mp">history.pushState(null, '', `${window.location.pathname}?page=${currentPage+1}`);<br/>// don't forget to reload the next page pictures<br/>fetchDataFromUnsplash(currentPage+1);</span></pre><p id="07b9" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">当我们点击pre按钮时，只需使用<code class="fe mc md me mf b">history.back</code>方法返回最后一页。</p><p id="bf2b" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated"><a class="ae ka" href="https://codepen.io/bitbug/full/oNyBZNO" rel="noopener ugc nofollow" target="_blank"> Codepen.io </a>不支持更改在iframe中执行的代码的历史状态。我在本地复制了这段代码，并使用gif来显示效果:</p><figure class="ly lz ma mb gu jp gi gj paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="gi gj mq"><img src="../Images/37892dcbb3721b7611b3af16a20869b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*qeOB7ta6hWSFn6N72kfXFQ.gif"/></div></div></figure><p id="cff1" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">当我们点击“下一步”或“前一步”按钮时，分页信息将被保存到url搜索参数中。所以当我们刷新页面时，总是会显示上次访问的视图。您可以在此代码中查看更多详细信息:</p><figure class="ly lz ma mb gu jp"><div class="bz fq l di"><div class="mr mh l"/></div></figure><h2 id="7bb2" class="kz la io bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">最后</h2><p id="ffb6" class="pw-post-body-paragraph kb kc io kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky ih bi translated">在本文中，我们将学习如何使用H5历史API来记录分页参数，以获得更好的体验。虽然它只使用history.pushState并监听popstate事件，但这是react-router的基础。</p><p id="c2c2" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">希望这能对您有所帮助，还有另一篇与历史API相关的文章:</p><div class="ms mt gq gs mu mv"><a rel="noopener  ugc nofollow" target="_blank" href="/two-tips-of-history-to-improve-page-experience-947223666f71"><div class="mw ab fp"><div class="mx ab my cl cj mz"><h2 class="bd ip gz z fq na fs ft nb fv fx in bi translated">2个提高页面体验的历史技巧</h2><div class="nc l"><h3 class="bd b gz z fq na fs ft nb fv fx dk translated">使用历史的scroll restore属性和pushState/replaceState的状态参数来恢复滚动…</h3></div><div class="nd l"><p class="bd b dl z fq na fs ft nb fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj ju mv"/></div></div></a></div><p id="cae3" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated"><em class="nk">更多内容请看</em><a class="ae ka" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kd ip"><em class="nk">plain English . io</em></strong></a><em class="nk">。报名参加我们的</em> <a class="ae ka" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd ip"> <em class="nk">免费周报</em> </strong> </a> <em class="nk">。关注我们关于</em><a class="ae ka" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kd ip"><em class="nk">Twitter</em></strong></a><a class="ae ka" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kd ip"><em class="nk">LinkedIn</em></strong></a><em class="nk"/><a class="ae ka" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kd ip"><em class="nk">YouTube</em></strong></a><em class="nk"/><a class="ae ka" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kd ip"><em class="nk">不和</em> </strong> </a> <em class="nk">。对增长黑客感兴趣？检查</em> <a class="ae ka" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd ip"> <em class="nk">电路</em> </strong> </a> <em class="nk">。</em></p></div></div>    
</body>
</html>