<html>
<head>
<title>How to Chain WebSocket Messages in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在JavaScript中链接WebSocket消息</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-chain-websocket-messages-in-javascript-4fe50e3dcd04?source=collection_archive---------9-----------------------#2022-01-07">https://javascript.plainenglish.io/how-to-chain-websocket-messages-in-javascript-4fe50e3dcd04?source=collection_archive---------9-----------------------#2022-01-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="02f1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用异步和等待是如此简单</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/74356f514b79ffe5f13941002a315941.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pHlTjRX6w5LQoMgQY2rSLg.jpeg"/></div></div></figure><p id="c99a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您曾经需要使用JavaScript向WebSocket服务器发送消息，可能在某个时候您想知道是否有一种方法可以链接WebSocket服务器调用。</p><p id="a89e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当然有！</p><p id="cf47" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在之前的文章<a class="ae ln" href="https://medium.com/geekculture/playing-chess-through-the-command-line-e52ed69daf9f" rel="noopener">通过命令行下棋</a>中，我们学习了如何在浏览器控制台的命令行中运行一系列象棋命令，而不考虑它的异步方面。</p><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="5252" class="lt lu iq lp b gy lv lw l lx ly">const ws = new WebSocket('ws://127.0.0.1:8080');<br/>ws.send('/start analysis');<br/>ws.send('/piece e2');</span></pre><p id="7ee8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果从同步调用的角度来看，这段代码看起来还不错，但实际上并非如此——它是一个涉及象棋服务器的异步代码的例子。之所以看起来有效，是因为第一个命令和第二个命令之间经过了足够长的时间。在编写JavaScript代码时，无法假设哪个命令将首先运行。在同步范例中，chess命令肯定会一次运行一个，一个接一个地运行，然而，在异步范例中，您明确地确保它们这样做。</p><p id="8ad7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在ECMAScript 2017中，<a class="ae ln" href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Async_await" rel="noopener ugc nofollow" target="_blank"> async/await语法</a>来拯救代码，使代码在链接异步函数时更具可读性。我们想要控制消息发送到WebSocket服务器的顺序，所以它们都被包装到在<code class="fe lz ma mb lp b"><a class="ae ln" href="https://github.com/chesslablab/redux-chess/blob/master/src/actions/serverActions.js" rel="noopener ugc nofollow" target="_blank">src/actions/serverActions.js</a></code>文件中定义的异步await函数中。</p><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="d7fa" class="lt lu iq lp b gy lv lw l lx ly">...</span><span id="ab34" class="lt lu iq lp b gy mc lw l lx ly">export const wsMssgUndoMove = async (state) =&gt; {<br/>  return await state.server.ws.send(`/undomove`);<br/>};</span><span id="db74" class="lt lu iq lp b gy mc lw l lx ly">export const wsMssgResign = async (state, action) =&gt; {<br/>  return await state.server.ws.send(`/resign ${action}`);<br/>};</span><span id="e8b4" class="lt lu iq lp b gy mc lw l lx ly">export const wsMssgRematch = async (state, action) =&gt; {<br/>  return await state.server.ws.send(`/rematch ${action}`);<br/>};</span><span id="2a4d" class="lt lu iq lp b gy mc lw l lx ly">export const wsMssgRestart = async (state) =&gt; {<br/>  return await state.server.ws.send(`/restart ${state.mode.playfriend.hash}`);<br/>};</span><span id="933e" class="lt lu iq lp b gy mc lw l lx ly">export const wsMssgStartLoadpgn = async (state, movetext) =&gt; {<br/>  return await state.server.ws.send(`/start loadpgn "${movetext}"`);<br/>};</span><span id="e964" class="lt lu iq lp b gy mc lw l lx ly">export const wsMssgResponse = async (state) =&gt; {<br/>  return await state.server.ws.send(`/response`);<br/>};</span></pre><p id="20c9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，当以某种方式组合时，可以很容易地将WebSocket消息链接起来，如下例所示。</p><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="e3db" class="lt lu iq lp b gy lv lw l lx ly">...</span><span id="89bf" class="lt lu iq lp b gy mc lw l lx ly">wsMssgQuit(state).then(() =&gt; {<br/>  wsMssgStartPlayfriend(state, color, time, increment);<br/>});</span></pre><p id="9f38" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">上面的代码片段先退出当前游戏；然后，在浏览器相应地接收到来自服务器的响应之后，新的游戏以<code class="fe lz ma mb lp b"><a class="ae ln" href="https://github.com/chesslablab/redux-chess/blob/master/src/constants/modeNames.js" rel="noopener ugc nofollow" target="_blank">PLAYFRIEND</a></code>模式开始。</p><p id="8e47" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">非常感谢您的阅读！我希望今天的帖子对你有所帮助。</p><div class="md me gp gr mf mg"><a href="https://medium.com/geekculture/playing-chess-through-the-command-line-e52ed69daf9f" rel="noopener follow" target="_blank"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd ir gy z fp ml fr fs mm fu fw ip bi translated">通过命令行下棋</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">仅仅通过输入命令来下棋是很有趣的</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">medium.com</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu kp mg"/></div></div></a></div><div class="md me gp gr mf mg"><a rel="noopener  ugc nofollow" target="_blank" href="/understanding-how-a-complex-react-redux-app-works-934b3600ad13"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd ir gy z fp ml fr fs mm fu fw ip bi translated">复杂的React Redux应用程序如何工作</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">一步一步理解，不要弄得太乱。</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="mp l"><div class="mv l mr ms mt mp mu kp mg"/></div></div></a></div><div class="md me gp gr mf mg"><a rel="noopener  ugc nofollow" target="_blank" href="/check-out-the-redux-chess-demo-acbea003d710"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd ir gy z fp ml fr fs mm fu fw ip bi translated">查看Redux国际象棋演示</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">请坐下来，享受一杯你最喜欢的啤酒</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="mp l"><div class="mw l mr ms mt mp mu kp mg"/></div></div></a></div><p id="0695" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="mx">更多内容看</em> <a class="ae ln" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="mx">说白了. io </em> </a> <em class="mx">。报名参加我们的</em> <a class="ae ln" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="mx">免费每周简讯</em> </a> <em class="mx">。在我们的</em> <a class="ae ln" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <em class="mx">社区</em> </a> <em class="mx">获得独家写作机会和建议。</em></p></div></div>    
</body>
</html>