<html>
<head>
<title>How React Functional Components Made a Difference For Me While Fixing a Bug</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在修复Bug时，React功能组件如何对我产生影响</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-react-functional-components-made-a-difference-for-me-while-fixing-a-bug-13b6968bcff1?source=collection_archive---------7-----------------------#2022-09-15">https://javascript.plainenglish.io/how-react-functional-components-made-a-difference-for-me-while-fixing-a-bug-13b6968bcff1?source=collection_archive---------7-----------------------#2022-09-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fb99" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">什么是功能组件？功能组件是返回React元素的函数。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/25a8ed36d58269022d5a924027bca5bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Lpau6lgbqvuFlo1i"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@kobuagency?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">KOBU Agency</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1642" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">功能组件可以理解为返回React元素的函数，该元素接收表示组件属性的参数<code class="fe ls lt lu lv b">props</code>。</p><p id="f4ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在React 16.8之前，也就是没有React钩子，功能组件只作为UI组件，其输出完全由参数<code class="fe ls lt lu lv b">props</code>控制，没有其状态或业务逻辑代码，是纯函数。功能组件没有实例，没有生命周期，被称为无状态组件。</p><p id="fd7f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">React钩子出现后，钩子可以用来赋予功能组件状态和生命周期，所以功能组件也可以作为业务组件使用。</p><p id="a7e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在开发过程中，功能组件比类组件更容易使用，以下两点感受最深:</p><ul class=""><li id="19df" class="lw lx iq ky b kz la lc ld lf ly lj lz ln ma lr mb mc md me bi translated">不用上课，不用担心烦人的这个指点问题。</li><li id="b1ca" class="lw lx iq ky b kz mf lc mg lf mh lj mi ln mj lr mb mc md me bi translated">高复用性使得提取常见的，编写自定义钩子替换高阶组件变得容易。</li></ul><p id="9661" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">函数组件和类组件有一个非常重要的区别:<strong class="ky ir">函数组件捕获用于渲染的值</strong>。</p><p id="2df9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我是在遇到一个bug的时候才知道这个区别的，在解决这个bug的过程中明白了这个区别的意义。</p><p id="2e44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">BUG场景是这样的:有一个输入框和输入内容后，点击按钮进行搜索，在搜索的时候，首先请求的是一个接口，我们得到一个类型，然后用这个类型和输入框的值来请求搜索接口。这里用代码简要描述:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="3610" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码逻辑看起来没有错，但是QA给我指出了一个bug。在输入框中输入要搜索的内容后，点击搜索按钮开始搜索，然后在输入框中快速输入内容。结果，搜索界面<code class="fe ls lt lu lv b">getList</code>报告一个错误。</p><p id="8d20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">检查原因，发现<code class="fe ls lt lu lv b">getType</code>接口<code class="fe ls lt lu lv b">getType</code>和搜索接口<code class="fe ls lt lu lv b">getList</code>接受的参数<code class="fe ls lt lu lv b">val</code>不一致。</p><p id="c7e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在排查过程中，我很疑惑。很明显<code class="fe ls lt lu lv b">val</code>在两个请求中都读取了<code class="fe ls lt lu lv b">this.state.inpValue</code>的值。然后，我的同事指示我改用功能组件来解决这个bug。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="eee1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">换成功能组件后，再试一次，没有报错，bug修复。后来我发现，事件的状态和道具在功能组件中获得的值，就是事件被触发那一刻，用于页面渲染的状态和道具的值。</p><p id="05b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击搜索按钮时，<code class="fe ls lt lu lv b">val</code>的值就是此时输入框中的值。无论输入框后面的值如何变化，都不会捕捉到最新的值。</p><p id="de02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那为什么可以在类组件中获取最新的状态值呢？关键是在类组件中，状态是通过<code class="fe ls lt lu lv b">this</code>获得的，<code class="fe ls lt lu lv b">this</code>始终是最新的组件实例。</p><p id="b7e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在类组件中更改它也可以解决这个bug。这些变化如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="9601" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当搜索事件<code class="fe ls lt lu lv b">handleSearch</code>被触发时，输入框<code class="fe ls lt lu lv b">this.state.inpValue</code>的值被存储在<code class="fe ls lt lu lv b">inpValue</code>变量中，随后的事件使用输入框的值来获取<code class="fe ls lt lu lv b">inpValue</code>变量。输入框中的后续输入不会影响<code class="fe ls lt lu lv b">inpValue</code>变量的值，除非搜索事件handleSearch被再次触发。这个修改也可以解决这个bug。</p><h1 id="3b06" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">最后</h1><p id="fc94" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf ng lh li lj nh ll lm ln ni lp lq lr ij bi translated"><strong class="ky ir">感谢阅读</strong>。期待您的关注，阅读更多高质量的文章。</p><div class="nj nk gp gr nl"><div role="button" tabindex="0" class="ab bv gv cb fp nm nn bn no kp ex"><div class="np l"><div class="ab q"><div class="l di"><img alt="omgzui" class="l de bw nq nr fe" src="../Images/113db82933227743d0067a68e250ac93.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*AmBIV4haXTWPO--EhE0Q1A.jpeg"/><div class="fb bw l nq nr fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@omgzui?source=post_page-----13b6968bcff1--------------------------------" rel="noopener follow" target="_top"> omgzui </a></p></div></div><div class="nu nv gw l"><h2 class="bd ir tn lw fp to fr fs tp fu fw ip bi translated">更好的编程</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi tq au tr ts tt px tu an eh ei tv tw tx el em eo de bk ep" href="https://medium.com/@omgzui/list/better-programing-9b4c9bb174aa?source=post_page-----13b6968bcff1--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="ty l fo"><span class="bd b dl z dk">109 stories</span></div></div></div><div class="oh dh oi fp ab oj fo di"><div class="di nz bv oa ob"><div class="dh l"><img alt="" class="dh" src="../Images/64fcf15e27c514ec49d62966b68dbc15.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*DbDdSUf5SchniJuq"/></div></div><div class="di nz bv oc od oe"><div class="dh l"><img alt="" class="dh" src="../Images/3e6ce891363c151131c5993ca0dcc526.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*7cAp-WibSblfO7hT"/></div></div><div class="di bv of og oe"><div class="dh l"><img alt="" class="dh" src="../Images/a7dd413de22f319a3c4729c9e737feb8.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*FcmHdVfoUOhlJlsG"/></div></div></div></div></div><div class="nj nk gp gr nl"><div role="button" tabindex="0" class="ab bv gv cb fp nm nn bn no kp ex"><div class="np l"><div class="ab q"><div class="l di"><img alt="omgzui" class="l de bw nq nr fe" src="../Images/113db82933227743d0067a68e250ac93.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*AmBIV4haXTWPO--EhE0Q1A.jpeg"/><div class="fb bw l nq nr fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@omgzui?source=post_page-----13b6968bcff1--------------------------------" rel="noopener follow" target="_top"> omgzui </a></p></div></div><div class="nu nv gw l"><h2 class="bd ir tn lw fp to fr fs tp fu fw ip bi translated">Java Script语言</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi tq au tr ts tt px tu an eh ei tv tw tx el em eo de bk ep" href="https://medium.com/@omgzui/list/javascript-48bfc7b5f93c?source=post_page-----13b6968bcff1--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="ty l fo"><span class="bd b dl z dk">57 stories</span></div></div></div><div class="oh dh oi fp ab oj fo di"><div class="di nz bv oa ob"><div class="dh l"><img alt="" class="dh" src="../Images/64fcf15e27c514ec49d62966b68dbc15.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*DbDdSUf5SchniJuq"/></div></div><div class="di nz bv oc od oe"><div class="dh l"><img alt="" class="dh" src="../Images/3e6ce891363c151131c5993ca0dcc526.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*7cAp-WibSblfO7hT"/></div></div><div class="di bv of og oe"><div class="dh l"><img alt="" class="dh" src="../Images/a7dd413de22f319a3c4729c9e737feb8.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*FcmHdVfoUOhlJlsG"/></div></div></div></div></div><div class="nj nk gp gr nl"><div role="button" tabindex="0" class="ab bv gv cb fp nm nn bn no kp ex"><div class="np l"><div class="ab q"><div class="l di"><img alt="omgzui" class="l de bw nq nr fe" src="../Images/113db82933227743d0067a68e250ac93.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*AmBIV4haXTWPO--EhE0Q1A.jpeg"/><div class="fb bw l nq nr fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@omgzui?source=post_page-----13b6968bcff1--------------------------------" rel="noopener follow" target="_top"> omgzui </a></p></div></div><div class="nu nv gw l"><h2 class="bd ir tn lw fp to fr fs tp fu fw ip bi translated">新闻</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi tq au tr ts tt px tu an eh ei tv tw tx el em eo de bk ep" href="https://medium.com/@omgzui/list/news-67ec0a972660?source=post_page-----13b6968bcff1--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="ty l fo"><span class="bd b dl z dk">23 stories</span></div></div></div><div class="oh dh oi fp ab oj fo di"><div class="di nz bv oa ob"><div class="dh l"><img alt="" class="dh" src="../Images/c3f36b36bf050f98fd5a8e3c89103cad.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*LISEmTdz19k7BAHY"/></div></div><div class="di nz bv oc od oe"><div class="dh l"><img alt="" class="dh" src="../Images/8459df5aae62dc00f04377e09544be88.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*RvBGLw3V9JZfn_HO"/></div></div><div class="di bv of og oe"><div class="dh l"><img alt="" class="dh" src="../Images/2864058bcedc8c1cd6492624ba9671c6.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*IUWVb3zTn1_HKV9P"/></div></div></div></div></div></div><div class="ab cl oo op hu oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="ij ik il im in"><p id="63de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ov">更多内容请看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ov">plain English . io</em></strong></a><em class="ov">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ov">免费周报</em> </strong> </a> <em class="ov">。关注我们关于</em><a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ov">Twitter</em></strong></a><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ov">LinkedIn</em></strong></a><em class="ov"/><a class="ae kv" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ov">YouTube</em></strong></a><em class="ov"/><a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ov">不和</em> </strong> </a> <em class="ov">。对增长黑客感兴趣？检查</em> <a class="ae kv" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ov">电路</em> </strong> </a> <em class="ov">。</em></p></div></div>    
</body>
</html>