<html>
<head>
<title>How to Deploy Multiple Node.js Apps on a Single Server with SSL, Nginx, PM2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用SSL、Nginx、PM2在一台服务器上部署多个Node.js应用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-deploy-multiple-nodejs-apps-on-a-single-server-with-ssl-nginx-pm2-part-2-91ea028473a5?source=collection_archive---------2-----------------------#2022-08-24">https://javascript.plainenglish.io/how-to-deploy-multiple-nodejs-apps-on-a-single-server-with-ssl-nginx-pm2-part-2-91ea028473a5?source=collection_archive---------2-----------------------#2022-08-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="f42f" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">第2部分:用SSL在一台服务器上部署多个Node.js应用程序，Nginx，PM2</h2></div><h1 id="27f0" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">先决条件</h1><p id="085b" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">请在这里阅读<a class="ae lq" href="https://dev.to/ranjan/deploy-multiple-nodejs-apps-on-single-server-with-ssl-nginx-pm2-part-1-4841" rel="noopener ugc nofollow" target="_blank">系列的第一部分</a>。</p><figure class="ls lt lu lv gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi lr"><img src="../Images/ec254b2d199252b8db73706a7715d927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yBsSgiWJblfzV1KcyKV_xQ.png"/></div></div></figure><p id="8b9e" class="pw-post-body-paragraph ku kv in kw b kx md jo kz la me jr lc ld mf lf lg lh mg lj lk ll mh ln lo lp ig bi translated">我们已经为第一个应用程序设置了NGINX、PM2和SSL，我们将设置一个新的Node.js应用程序。</p><p id="495f" class="pw-post-body-paragraph ku kv in kw b kx md jo kz la me jr lc ld mf lf lg lh mg lj lk ll mh ln lo lp ig bi translated">我们只需几个步骤就能让新应用启动并运行</p><h1 id="ad66" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">步骤08 —克隆新项目或用文件创建新项目</h1><p id="a572" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">这与“步骤02”非常相似，我们将创建一个新文件夹，创建一个新应用程序，并在不同的端口号上运行它。</p><pre class="ls lt lu lv gt mi mj mk ml aw mm bi"><span id="e674" class="mn kd in mj b gy mo mp l mq mr">mkdir App2<br/>cd App2</span></pre><p id="9ca2" class="pw-post-body-paragraph ku kv in kw b kx md jo kz la me jr lc ld mf lf lg lh mg lj lk ll mh ln lo lp ig bi translated">现在只需创建一个名为index.js的新文件:</p><pre class="ls lt lu lv gt mi mj mk ml aw mm bi"><span id="68cc" class="mn kd in mj b gy mo mp l mq mr">nano index.js</span></pre><p id="b44b" class="pw-post-body-paragraph ku kv in kw b kx md jo kz la me jr lc ld mf lf lg lh mg lj lk ll mh ln lo lp ig bi translated">现在，将以下代码粘贴到index.js中:</p><pre class="ls lt lu lv gt mi mj mk ml aw mm bi"><span id="8c17" class="mn kd in mj b gy mo mp l mq mr">const http = require('http');</span><span id="41d9" class="mn kd in mj b gy ms mp l mq mr">const hostname = 'localhost';<br/>const port = 4000; //make sure this port no is different from the first one</span><span id="547c" class="mn kd in mj b gy ms mp l mq mr">const server = http.createServer((req, res) =&gt; {<br/>  res.statusCode = 200;<br/>  res.setHeader('Content-Type', 'text/plain');<br/>  res.end('Hello Everyone from APP 2 !\n');<br/>});</span><span id="9ad7" class="mn kd in mj b gy ms mp l mq mr">server.listen(port, hostname, () =&gt; {<br/>  console.log(`Server running at http://${hostname}:${port}/`);<br/>});</span></pre><h1 id="40f0" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">步骤09 —用PM2启动应用程序</h1><p id="a129" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">我们将从PM2开始应用程序，并给它一个名字(这是可选的):</p><pre class="ls lt lu lv gt mi mj mk ml aw mm bi"><span id="0f34" class="mn kd in mj b gy mo mp l mq mr">pm2 start index.js --name "APP 2"</span></pre><p id="db01" class="pw-post-body-paragraph ku kv in kw b kx md jo kz la me jr lc ld mf lf lg lh mg lj lk ll mh ln lo lp ig bi translated">这将在端口号4000启动应用程序。我们还可以使用以下命令查看所有运行PM2的应用程序:</p><pre class="ls lt lu lv gt mi mj mk ml aw mm bi"><span id="fe72" class="mn kd in mj b gy mo mp l mq mr">pm2 list</span></pre><p id="4662" class="pw-post-body-paragraph ku kv in kw b kx md jo kz la me jr lc ld mf lf lg lh mg lj lk ll mh ln lo lp ig bi translated">这将给你一个所有正在运行的应用程序的列表。您也可以使用id或名称来启动/停止/重启。</p><h1 id="1f71" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">步骤10 —使用NGINX添加反向代理</h1><p id="7afc" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">我们还需要为这个应用程序再添加一次服务器配置。</p><p id="e722" class="pw-post-body-paragraph ku kv in kw b kx md jo kz la me jr lc ld mf lf lg lh mg lj lk ll mh ln lo lp ig bi translated">要更新服务器，首先打开配置:</p><pre class="ls lt lu lv gt mi mj mk ml aw mm bi"><span id="d37c" class="mn kd in mj b gy mo mp l mq mr">sudo nano /etc/nginx/sites-available/default</span></pre><p id="d181" class="pw-post-body-paragraph ku kv in kw b kx md jo kz la me jr lc ld mf lf lg lh mg lj lk ll mh ln lo lp ig bi translated">并将这个新块添加到服务器块的<strong class="kw io">位置</strong>部分:</p><pre class="ls lt lu lv gt mi mj mk ml aw mm bi"><span id="8f77" class="mn kd in mj b gy mo mp l mq mr">server_name yourdomain2.com www.yourdomain2.com;</span><span id="a1bf" class="mn kd in mj b gy ms mp l mq mr">    location / {<br/>        proxy_pass http://localhost:4000; <br/>        proxy_http_version 1.1;<br/>        proxy_set_header Upgrade $http_upgrade;<br/>        proxy_set_header Connection 'upgrade';<br/>        proxy_set_header Host $host;<br/>        proxy_cache_bypass $http_upgrade;<br/>    }</span></pre><p id="d4fe" class="pw-post-body-paragraph ku kv in kw b kx md jo kz la me jr lc ld mf lf lg lh mg lj lk ll mh ln lo lp ig bi translated">如果你计划在<strong class="kw io">子域</strong>上托管第二个应用，只需用类似<code class="fe mt mu mv mj b">api2.yourdomain.com</code>的子域替换<code class="fe mt mu mv mj b">yourdomain2.com</code>即可。</p><p id="0388" class="pw-post-body-paragraph ku kv in kw b kx md jo kz la me jr lc ld mf lf lg lh mg lj lk ll mh ln lo lp ig bi translated">然后检查并重启NGINX:</p><pre class="ls lt lu lv gt mi mj mk ml aw mm bi"><span id="c387" class="mn kd in mj b gy mo mp l mq mr"># Check NGINX config<br/>sudo nginx -t</span><span id="f070" class="mn kd in mj b gy ms mp l mq mr"># Restart NGINX<br/>sudo service nginx restart</span></pre><p id="980a" class="pw-post-body-paragraph ku kv in kw b kx md jo kz la me jr lc ld mf lf lg lh mg lj lk ll mh ln lo lp ig bi translated">如果域被指向，你应该看到你的应用程序在端口80上运行。还需要一步——添加SSL。</p><h1 id="2c19" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">步骤11 —为第二个应用程序添加SSL</h1><p id="648a" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">我们已经安装了certbot，因此添加额外的域不成问题。</p><pre class="ls lt lu lv gt mi mj mk ml aw mm bi"><span id="bf96" class="mn kd in mj b gy mo mp l mq mr">sudo certbot --nginx -d yourdomain2.com -d <a class="ae lq" href="http://www.yourdomain2.com" rel="noopener ugc nofollow" target="_blank">www.yourdomain2.com</a></span></pre><p id="41d8" class="pw-post-body-paragraph ku kv in kw b kx md jo kz la me jr lc ld mf lf lg lh mg lj lk ll mh ln lo lp ig bi translated">或者对于<strong class="kw io">子域:</strong></p><pre class="ls lt lu lv gt mi mj mk ml aw mm bi"><span id="32a5" class="mn kd in mj b gy mo mp l mq mr">sudo certbot --nginx -d api2.yourdomain.com</span></pre><p id="018c" class="pw-post-body-paragraph ku kv in kw b kx md jo kz la me jr lc ld mf lf lg lh mg lj lk ll mh ln lo lp ig bi translated">仅此而已！您的新应用程序也应该在新的SSL域上运行。</p><p id="4487" class="pw-post-body-paragraph ku kv in kw b kx md jo kz la me jr lc ld mf lf lg lh mg lj lk ll mh ln lo lp ig bi translated">感谢阅读。干杯！</p><p id="8ba9" class="pw-post-body-paragraph ku kv in kw b kx md jo kz la me jr lc ld mf lf lg lh mg lj lk ll mh ln lo lp ig bi translated"><em class="mw">更多内容请看</em><a class="ae lq" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kw io"><em class="mw">plain English . io</em></strong></a><em class="mw">。报名参加我们的</em> <a class="ae lq" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw io"> <em class="mw">免费周报</em> </strong> </a> <em class="mw">。关注我们关于</em><a class="ae lq" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kw io"><em class="mw">Twitter</em></strong></a><a class="ae lq" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kw io"><em class="mw">LinkedIn</em></strong></a><em class="mw"/><a class="ae lq" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kw io"><em class="mw">YouTube</em></strong></a><em class="mw"/><a class="ae lq" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kw io"><em class="mw">不和</em> </strong> </a> <em class="mw">。</em></p></div></div>    
</body>
</html>