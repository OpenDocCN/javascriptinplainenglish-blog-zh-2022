<html>
<head>
<title>It’s 2022, Don’t Leave Your Angular Routes Unguarded</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现在是2022年，不要让你的棱角路线无人看守</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/its-2022-don-t-leave-your-angular-routes-unguarded-a234343444cd?source=collection_archive---------1-----------------------#2022-10-01">https://javascript.plainenglish.io/its-2022-don-t-leave-your-angular-routes-unguarded-a234343444cd?source=collection_archive---------1-----------------------#2022-10-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1f02" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何使用Angular Route Guard来保护未授权用户进入不同的页面/路径。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4d5e4ea9d9fdc17d7666285cd67ac062.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sr764odAUpmhVPhh2S4AUw.png"/></div></div></figure><p id="d5ce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您知道吗，即使在您的应用程序中显示或隐藏不同页面的导航按钮，人们仍然可以通过操纵浏览器中的URL来访问您的页面。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ln"><img src="../Images/f2ebde68aed1657d910c0364102989f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BobzXpbjXW0CKZpJ0aiTNg.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">With admin navigation buttons</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/d5ade687bb8fc572fa5b53fdef965bcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3178zlVE2eJYD1bcFW50Cw.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">Without admin navigation buttons</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lt"><img src="../Images/596b2108daccfec9cc9189dd7a1d5fc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OLhiIY2Sw5_JpmFiJQibyw.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">Route manipulation on the browser URL</figcaption></figure><p id="6294" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">许多网站由于没有在网站中正确地保护它们的路线而遭受安全问题！今天，我将向您展示如何使用Angular Route Guard来防止未经授权的用户进入不同的页面/路径。</p><p id="a941" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Angular提供了<code class="fe lu lv lw lx b">5 guards</code>现成的功能— <strong class="kt ir">可以激活、可以激活子对象、可以激活、解析、可以加载</strong>。今天，我们将关注<code class="fe lu lv lw lx b"><strong class="kt ir">CanActivate</strong></code>以及它如何保护你的角度路线。</p><h1 id="fc03" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">第一步</h1><p id="dc3d" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">在应用程序中设置认证服务文件。它应该有<code class="fe lu lv lw lx b">login</code>和<code class="fe lu lv lw lx b">logout</code>方法，允许用户用他们的用户名和密码验证自己。一旦用户通过了身份验证，您就可以将<strong class="kt ir">私有</strong>变量<code class="fe lu lv lw lx b">isLoggedIn</code>的状态更新为true，以便稍后当您需要验证用户是否通过了身份验证以进入受保护的路由时，您可以调用<code class="fe lu lv lw lx b">isAuthenticated</code>方法来获取<code class="fe lu lv lw lx b">isLoggedIn</code>的最新状态。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/04789644998bd0a314dcf1609b37976b.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*bvAUkxbgWCLrjJgJSkhgzw.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">auth.service.ts</figcaption></figure><p id="633c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我之所以将<code class="fe lu lv lw lx b">isLoggedIn</code>声明为<strong class="kt ir">私有</strong>变量，是因为我只想让<code class="fe lu lv lw lx b">login</code>和<code class="fe lu lv lw lx b">logout</code>方法成为唯一两个可以改变<code class="fe lu lv lw lx b">isLoggedIn</code>值的方法，其他可以访问AuthService文件的组件应该不能直接改变<code class="fe lu lv lw lx b">isLoggedIn</code>的值。</p><h1 id="16e0" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">第二步</h1><p id="6c59" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">您可以创建一个身份验证保护文件来实现<code class="fe lu lv lw lx b">CanActivate</code>接口，以便使用它。一旦从@angular/router实现了<code class="fe lu lv lw lx b">CanActivate</code>,您就可以访问<code class="fe lu lv lw lx b">canActivate</code>方法。在<code class="fe lu lv lw lx b">canActivate</code>方法中，可以先获取<code class="fe lu lv lw lx b">isLoggedIn</code>的最新状态，检查用户是否通过<strong class="kt ir">认证</strong>。如果是，你将允许应用程序的导航继续，否则你将<strong class="kt ir">重定向</strong>用户回到主页/登录页面。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/f95ab374d7191abf24112d79ccadd1d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*thnVU0zN_KIOA00zRcYhiA.png"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">auth.guard.ts</figcaption></figure><p id="b677" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我的例子中，如果用户试图在未经身份验证的情况下访问受保护的路由，我会将他们重定向到主页。</p><h1 id="7954" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">第三步</h1><p id="cd06" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">最后，您可以将<strong class="kt ir"> AuthGuard </strong>添加到<strong class="kt ir"> app-routing.module.ts </strong>文件中，以保护您的路线。在路由文件中，当声明路由路径和组件细节时，还可以添加另一个名为<code class="fe lu lv lw lx b">canActivate</code>的属性，并传入刚刚创建的AuthGuard。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/0d6a5bf3e698d0eb313fa4db8842715d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HR1f4kiXvh6atfANRPb6kw.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">app-routing.module.ts</figcaption></figure><p id="b7c6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，当您试图未经授权访问这些受保护的路由时，您将被自动重定向回主页/登录页面。除了在你的网站上显示和隐藏导航按钮，现在你有另一种机制来检查用户是否被允许访问受保护的路线。💯</p><p id="9f75" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">只是3️⃣快速的点出了亮点🌈。</p><ol class=""><li id="5153" class="my mz iq kt b ku kv kx ky la na le nb li nc lm nd ne nf ng bi translated">除了从客户端保护您的应用程序路由之外，还建议从服务器保护应用程序数据，以便万一由于任何原因在客户端验证失败，并且未授权用户设法访问受保护的路由，获取数据的API调用将返回<strong class="kt ir">HTTP 401 unauthorized error</strong>。</li><li id="ca32" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">如果您已经注意到路由文件中的<code class="fe lu lv lw lx b">canActivate</code>字段正在接受一个数组。这意味着，如果某些路由需要更多的权限才能访问，那么您可以通过多个<strong class="kt ir">身份验证守卫。</strong></li><li id="7dae" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">如果你已经注意到目前<code class="fe lu lv lw lx b">isLoggedIn</code>变量被声明为一个<strong class="kt ir">布尔</strong>变量，那么这个安全措施如何保护具有不同权限的多条路径是非常有限的。另一种通过不同权限对不同路由进行身份验证的方式是将<code class="fe lu lv lw lx b">isLoggedIn</code>变量转换为一个<strong class="kt ir">对象</strong>，该对象保存不同路由名称的<strong class="kt ir">多个布尔</strong>。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/9924f4a4fc1edca1f49c5b7de235bc89.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*oOW0rqiHwKyE5O56s2q9Ow.png"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">auth service for isLoggedIn as an object</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/121e00b5382a144a6d8a23485d02b2f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*v5vNCU1IGzU2VyR4eyFi1Q.png"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">auth guard to handle different permission for different protected routes</figcaption></figure><h1 id="898f" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">摘要</h1><p id="7f2e" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">希望这篇文章能让你更好地了解如何为你的Angular应用程序设置认证保护，并保护你的网站免受未授权用户的攻击。这可能不是完美的实现，但我希望它能帮助您尽快开始并保护您的应用程序！如果你有其他有趣的方法来保护你的角度应用，请在下面的评论中告诉我。我很想了解它，并与他人分享。干杯！😎</p><div class="no np gp gr nq nr"><a href="https://medium.com/@devjo/membership" rel="noopener follow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd ir gy z fp nw fr fs nx fu fw ip bi translated">用我的推荐链接- DevJo加入媒体</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">阅读DevJo的每一个故事(以及Medium上成千上万的其他作者)。你的会员费直接支持DevJo和…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">medium.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of kp nr"/></div></div></a></div></div><div class="ab cl og oh hu oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="ij ik il im in"><p id="c210" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="on">更多内容请看</em><a class="ae oo" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="on">plain English . io</em></strong></a><em class="on">。报名参加我们的</em> <a class="ae oo" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="on">免费周报</em> </strong> </a> <em class="on">。关注我们关于</em><a class="ae oo" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="on">Twitter</em></strong></a><a class="ae oo" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="on">LinkedIn</em></strong></a><em class="on"/><a class="ae oo" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="on">YouTube</em></strong></a><em class="on"/><a class="ae oo" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="on">不和</em> </strong> </a> <em class="on">。对增长黑客感兴趣？检查</em> <a class="ae oo" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="on">电路</em> </strong> </a> <em class="on">。</em></p></div></div>    
</body>
</html>