<html>
<head>
<title>Create Your First NPM Package and Publish It into the Gitlab Registry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建您的第一个NPM包并将其发布到Gitlab注册表中</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-your-first-npm-package-and-publish-it-into-gitlab-registry-94eec41e0770?source=collection_archive---------1-----------------------#2022-10-14">https://javascript.plainenglish.io/create-your-first-npm-package-and-publish-it-into-gitlab-registry-94eec41e0770?source=collection_archive---------1-----------------------#2022-10-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="9051" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何创建您自己的npm包，其中包含并集合了一组您希望在多个项目中重用的方法</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi kc"><img src="../Images/e994dee9863777dade8fb5297cd5f606.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*-kwgrTjV1caKyGGu0a5-_A.png"/></div></figure><p id="430e" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在使用NodeJS开发您的web应用程序时，您可能会注意到各种NPM包和库的存在，这使得开发过程更加容易。这些包帮助我们降低项目的复杂性，并允许我们毫无争议地重用开源方法。</p><p id="aa3a" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">因此，如果您曾经想知道如何创建自己的npm包，包括并组装一组您想要在多个项目中重用的方法，那么您就找对地方了！</p><h1 id="5e06" class="lg lh in bd li lj lk ll lm ln lo lp lq jt lr ju ls jw lt jx lu jz lv ka lw lx bi translated">待办事项列表</h1><ol class=""><li id="4084" class="ly lz in km b kn ma kq mb kt mc kx md lb me lf mf mg mh mi bi translated">创建国家预防机制包🎉</li><li id="b298" class="ly lz in km b kn mj kq mk kt ml kx mm lb mn lf mf mg mh mi bi translated">设置单元测试(可选)✅</li><li id="9504" class="ly lz in km b kn mj kq mk kt ml kx mm lb mn lf mf mg mh mi bi translated">设置文档生成(可选)📝</li><li id="3176" class="ly lz in km b kn mj kq mk kt ml kx mm lb mn lf mf mg mh mi bi translated">创建/配置Gitlab存储库以发布NPM包🔧</li><li id="ba30" class="ly lz in km b kn mj kq mk kt ml kx mm lb mn lf mf mg mh mi bi translated">设置。gitlab-ci管道👷</li><li id="aee4" class="ly lz in km b kn mj kq mk kt ml kx mm lb mn lf mf mg mh mi bi translated">推送和发布我们的npm包🚀！！</li><li id="3c16" class="ly lz in km b kn mj kq mk kt ml kx mm lb mn lf mf mg mh mi bi translated">如何在其他项目中安装我们的项目？➕</li></ol><h2 id="64da" class="mo lh in bd li mp mq dn lm mr ms dp lq kt mt mu ls kx mv mw lu lb mx my lw mz bi translated">关于这个例子</h2><p id="11ff" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt na kv kw kx nb kz la lb nc ld le lf ig bi translated">我们将创建的包提供了一些关于计算最常见几何形状的表面积的基本数学运算:三角形、正方形、矩形和圆形。</p><h1 id="605b" class="lg lh in bd li lj lk ll lm ln lo lp lq jt lr ju ls jw lt jx lu jz lv ka lw lx bi translated">🎉创建国家预防机制包</h1><h2 id="1f31" class="mo lh in bd li mp mq dn lm mr ms dp lq kt mt mu ls kx mv mw lu lb mx my lw mz bi translated">答。初始化项目</h2><p id="681e" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt na kv kw kx nb kz la lb nc ld le lf ig bi translated">第一步是创建国家预防机制项目，并使其在本地运行。所以让我们首先创建一个名为<code class="fe nd ne nf ng b">sb-geometry-plugin</code>的文件夹。然后，初始化它:</p><pre class="kd ke kf kg gt nh ng ni nj aw nk bi"><span id="8453" class="mo lh in ng b gy nl nm l nn no"># Create package.json file<br/>$ npm init</span></pre><p id="6736" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">这将要求我们填写一些信息(见下图)</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi np"><img src="../Images/72b651293b9694b8ccd94e4181aba7eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NEkhOvUOqE_BMikI4Q2nQw.jpeg"/></div></div><figcaption class="nu nv gj gh gi nw nx bd b be z dk">Initialize package</figcaption></figure><h2 id="13db" class="mo lh in bd li mp mq dn lm mr ms dp lq kt mt mu ls kx mv mw lu lb mx my lw mz bi translated">b.安装开发依赖项</h2><p id="4ca6" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt na kv kw kx nb kz la lb nc ld le lf ig bi translated">然后，我们应该安装一些必需的和可选的开发依赖项，这将有助于我们轻松地构建软件包。为此，我们需要:</p><ul class=""><li id="2f25" class="ly lz in km b kn ko kq kr kt ny kx nz lb oa lf ob mg mh mi bi translated"><code class="fe nd ne nf ng b"><strong class="km io">webpack</strong></code>是一个模块捆绑器，<code class="fe nd ne nf ng b"><strong class="km io">webpack-cli</strong></code>是一个使用<code class="fe nd ne nf ng b">webpack</code>的命令行工具。通过使用<code class="fe nd ne nf ng b">webpack</code>,我们也应该在捆绑之前使用<code class="fe nd ne nf ng b">babel-loader</code>将我们的ES6代码传输到ES5。</li></ul><pre class="kd ke kf kg gt nh ng ni nj aw nk bi"><span id="6afe" class="mo lh in ng b gy nl nm l nn no">$ npm i --save-dev webpack webpack-cli <a class="ae oc" href="http://twitter.com/babel/core" rel="noopener ugc nofollow" target="_blank">@babel/core</a> babel-loader</span></pre><ul class=""><li id="2f40" class="ly lz in km b kn ko kq kr kt ny kx nz lb oa lf ob mg mh mi bi translated"><code class="fe nd ne nf ng b"><strong class="km io">jest</strong></code>用于编写jest测试用例(可选)。</li></ul><pre class="kd ke kf kg gt nh ng ni nj aw nk bi"><span id="4ff0" class="mo lh in ng b gy nl nm l nn no">$ npm i --save-dev jest</span></pre><ul class=""><li id="6c6f" class="ly lz in km b kn ko kq kr kt ny kx nz lb oa lf ob mg mh mi bi translated"><code class="fe nd ne nf ng b"><strong class="km io">prettier</strong></code>、<code class="fe nd ne nf ng b"><strong class="km io">eslint-plugin-prettier</strong></code>和<code class="fe nd ne nf ng b"><strong class="km io">eslint-config-prettier</strong></code>用于林挺和格式化我们的代码(可选)。</li></ul><pre class="kd ke kf kg gt nh ng ni nj aw nk bi"><span id="1ebb" class="mo lh in ng b gy nl nm l nn no">$ npm i --save-dev prettier eslint-plugin-prettier eslint-config-prettier</span></pre><ul class=""><li id="ebae" class="ly lz in km b kn ko kq kr kt ny kx nz lb oa lf ob mg mh mi bi translated"><code class="fe nd ne nf ng b"><strong class="km io">documentation</strong></code>用于自动生成文档(可选)。</li></ul><pre class="kd ke kf kg gt nh ng ni nj aw nk bi"><span id="c0c3" class="mo lh in ng b gy nl nm l nn no">$ npm i --save-dev documentation</span></pre><h2 id="49ae" class="mo lh in bd li mp mq dn lm mr ms dp lq kt mt mu ls kx mv mw lu lb mx my lw mz bi translated">c.初始化git储存库</h2><p id="61eb" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt na kv kw kx nb kz la lb nc ld le lf ig bi translated">现在我们应该初始化我们的git存储库并添加<em class="od">。gitignore具有以下内容的</em>文件:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe of l"/></div></figure><pre class="kd ke kf kg gt nh ng ni nj aw nk bi"><span id="bc35" class="mo lh in ng b gy nl nm l nn no">$ git init<br/>$ git add *<br/>$ git commit -am "Initialize project"</span></pre><h2 id="8ad8" class="mo lh in bd li mp mq dn lm mr ms dp lq kt mt mu ls kx mv mw lu lb mx my lw mz bi translated">d.开始编码</h2><p id="ff0b" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt na kv kw kx nb kz la lb nc ld le lf ig bi translated">我们项目的初始结构如下图所示:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi og"><img src="../Images/dca533d5cfe48cf47f69f2aff51b94d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:676/format:webp/1*ODQ4LEttKjhYf7nX24nPvw.png"/></div></div></figure><p id="db2c" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">正如您在图片中看到的，我们的项目包含一堆文件和文件夹。现在让我们解释一下每一个的内容和用途。</p><ul class=""><li id="4e44" class="ly lz in km b kn ko kq kr kt ny kx nz lb oa lf ob mg mh mi bi translated">这些文件是用来设置beauty+ESLint的。漂亮是用来自动格式化我们的代码，以加强自以为是的代码格式，ESLint确保我们的代码风格保持良好的形式。</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe of l"/></div></figure><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe of l"/></div></figure><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe of l"/></div></figure><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe of l"/></div></figure><ul class=""><li id="5b8e" class="ly lz in km b kn ko kq kr kt ny kx nz lb oa lf ob mg mh mi bi translated"><code class="fe nd ne nf ng b"><strong class="km io">webpack.config.js</strong></code> : Webpack配置文件，它定义了如何捆绑我们JavaScript代码并为生产做准备。</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe of l"/></div></figure><ul class=""><li id="cc7c" class="ly lz in km b kn ko kq kr kt ny kx nz lb oa lf ob mg mh mi bi translated"><code class="fe nd ne nf ng b"><strong class="km io">/src/methods</strong></code>:包含3个文件，每个文件导出一个特定几何形状面积的计算公式。</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe of l"/></div></figure><ul class=""><li id="1efb" class="ly lz in km b kn ko kq kr kt ny kx nz lb oa lf ob mg mh mi bi translated"><code class="fe nd ne nf ng b"><strong class="km io">index.js</strong></code>:包的入口点，它导出我们的工具方法。</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe of l"/></div></figure><h1 id="ff0d" class="lg lh in bd li lj lk ll lm ln lo lp lq jt lr ju ls jw lt jx lu jz lv ka lw lx bi translated">✅设置单元测试(可选)</h1><p id="04d9" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt na kv kw kx nb kz la lb nc ld le lf ig bi translated">我们将使用Jest框架来编写3个方法的单元测试。为此，让我们创建<code class="fe nd ne nf ng b">/tests</code>文件夹，并开始编写我们的测试用例:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="8744" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在运行测试之前，我们应该在<code class="fe nd ne nf ng b">package.json</code>文件中配置单元测试:</p><pre class="kd ke kf kg gt nh ng ni nj aw nk bi"><span id="9748" class="mo lh in ng b gy nl nm l nn no">...<br/>"scripts" : {</span><span id="42f9" class="mo lh in ng b gy oh nm l nn no">       "test": "jest --coverage --passWithNoTests" // Run tests<br/>},<br/>"jest": { // jest configuration</span><span id="2909" class="mo lh in ng b gy oh nm l nn no">       "verbose": true,</span><span id="f2dd" class="mo lh in ng b gy oh nm l nn no">       "testEnvironment": "node"<br/>}</span><span id="35f8" class="mo lh in ng b gy oh nm l nn no">...</span></pre><p id="74df" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">之后，我们可以运行我们的测试，并在<code class="fe nd ne nf ng b">/coverage</code>中获得覆盖率报告:</p><pre class="kd ke kf kg gt nh ng ni nj aw nk bi"><span id="65a6" class="mo lh in ng b gy nl nm l nn no">$ npm run test</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi oi"><img src="../Images/e9319a92c48b89bb5fb3d01a533399cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ileW6yHEl12DbOLyd7Jl4Q.png"/></div></div><figcaption class="nu nv gj gh gi nw nx bd b be z dk">Output of running unit tests</figcaption></figure><h1 id="fefe" class="lg lh in bd li lj lk ll lm ln lo lp lq jt lr ju ls jw lt jx lu jz lv ka lw lx bi translated">📝设置文档生成(可选)</h1><p id="2a7a" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt na kv kw kx nb kz la lb nc ld le lf ig bi translated">通过使用文档工具，我们可以从包含在代码中的jsDoc注释中自动生成代码文档。</p><p id="d503" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">因此，让我们给我们的<code class="fe nd ne nf ng b">package.json</code>文件添加一些脚本:</p><pre class="kd ke kf kg gt nh ng ni nj aw nk bi"><span id="a356" class="mo lh in ng b gy nl nm l nn no">.....<br/>"scripts": {</span><span id="a43d" class="mo lh in ng b gy oh nm l nn no">    "docs:clean": "rimraf docs", <strong class="ng io">// Delete /docs folder</strong></span><span id="62f2" class="mo lh in ng b gy oh nm l nn no">    "docs:build": "npm run docs:clean &amp;&amp; documentation build src/**           -f html -o docs", <strong class="ng io">// Build documentation</strong></span><span id="2e0a" class="mo lh in ng b gy oh nm l nn no">     "clean": "rimraf dist", <strong class="ng io">// Delete /dist folder</strong></span><span id="ff23" class="mo lh in ng b gy oh nm l nn no">     "build": "npm run clean &amp;&amp; webpack --mode production", <strong class="ng io">// Build project</strong></span><span id="fc68" class="mo lh in ng b gy oh nm l nn no">     "prepare": "npm run build &amp;&amp; npm run docs:build", <strong class="ng io">// Prepare project for production</strong></span><span id="8528" class="mo lh in ng b gy oh nm l nn no">     "test": "jest --coverage --passWithNoTests" <strong class="ng io">// Run tests</strong></span><span id="79b5" class="mo lh in ng b gy oh nm l nn no">},</span><span id="18f9" class="mo lh in ng b gy oh nm l nn no">.....</span></pre><p id="6dde" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">现在，我们只需运行相应的脚本，就可以轻松地测试、构建和生成项目文档。例如，为了构建包并为生产做准备，我们只需运行:</p><pre class="kd ke kf kg gt nh ng ni nj aw nk bi"><span id="c3b7" class="mo lh in ng b gy nl nm l nn no">$ npm run prepare</span></pre><p id="f7b8" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">这将生成两个文件夹:</p><ul class=""><li id="95cb" class="ly lz in km b kn ko kq kr kt ny kx nz lb oa lf ob mg mh mi bi translated"><strong class="km io"> /dist </strong>:代码的发行版本</li><li id="e6b4" class="ly lz in km b kn mj kq mk kt ml kx mm lb mn lf ob mg mh mi bi translated"><strong class="km io"> /docs : </strong>包含代码文档</li></ul><h1 id="571d" class="lg lh in bd li lj lk ll lm ln lo lp lq jt lr ju ls jw lt jx lu jz lv ka lw lx bi translated">🔧创建Gitlab存储库</h1><p id="a284" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt na kv kw kx nb kz la lb nc ld le lf ig bi translated">首先，我们首先创建一个名为“sb-geometry-plugin”的空白Gitlab项目。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi oj"><img src="../Images/bd46b124cdfeb8eda0c81665a9f1c2f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XLB0FszpDN3BSpu5uTjlUw.jpeg"/></div></div></figure><p id="15db" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">然后我们推出我们的代码。</p><pre class="kd ke kf kg gt nh ng ni nj aw nk bi"><span id="7828" class="mo lh in ng b gy nl nm l nn no">$ git remote add origin <a class="ae oc" href="mailto:git@gitlab.com" rel="noopener ugc nofollow" target="_blank">git@gitlab.com</a>:xxxxxxx/sb-geometry-plugin.git<br/>$ git push --set-upstream origin master</span></pre><h1 id="65f4" class="lg lh in bd li lj lk ll lm ln lo lp lq jt lr ju ls jw lt jx lu jz lv ka lw lx bi translated">👷设置。gitlab-ci管道</h1><p id="a3b3" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt na kv kw kx nb kz la lb nc ld le lf ig bi translated">现在，我们将使用Gitlab CI/CD工具来管理我们的工作流程。根据官方文档，GitLab CI/CD是一个使用连续方法进行软件开发的工具。</p><p id="32b4" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">通过使用GitLab CI/CD，我们可以为构建和测试我们的项目定义一个管道，有关它如何工作的更多信息，您可以查看<a class="ae oc" href="https://docs.gitlab.com/ee/ci/introduction/index.html" rel="noopener ugc nofollow" target="_blank">官方文档。</a></p><p id="c732" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">因此，让我们用以下内容创建一个名为<code class="fe nd ne nf ng b">.gitlab-ci.yml </code>的文件:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="e5b5" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">我们的管道包含4个阶段，每个阶段负责完成一项任务。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi ok"><img src="../Images/3f0a050199fba676ef1b4defc0820929.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FtDocko1cJhqUjAgTOH5Iw.jpeg"/></div></div></figure><h1 id="6814" class="lg lh in bd li lj lk ll lm ln lo lp lq jt lr ju ls jw lt jx lu jz lv ka lw lx bi translated">🚀推送并发布我们的npm包！！</h1><p id="5f4b" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt na kv kw kx nb kz la lb nc ld le lf ig bi translated">如果你现在尝试直接推送我们的代码，你会看到Gitlab直接检测到我们的管道并开始运行它(请看下图)。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi ol"><img src="../Images/8326cb2c6d6f53f39768a4e8833fcfae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MIjtR5gzuhRl9YNtveODLA.png"/></div></div></figure><p id="ad85" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">糟糕，当他试图发布一个新的包<strong class="km io">时，我们的管道失败了😭。</strong>但是为什么呢？？</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi om"><img src="../Images/96eb6d810ac2798ebf747a98716c9be4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B3cw6_sVDgq_8ZpzDz_0gA.png"/></div></div></figure><p id="11c5" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">别慌，完全正常。事实上，我们的项目需要更多的配置来访问Gitlab注册表。</p><h2 id="554f" class="mo lh in bd li mp mq dn lm mr ms dp lq kt mt mu ls kx mv mw lu lb mx my lw mz bi translated">a.语义释放</h2><p id="62db" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt na kv kw kx nb kz la lb nc ld le lf ig bi translated">我们要做的第一件事是使用一个叫做semantic-release的伟大工具，这个工具帮助我们根据Git提交来管理何时发布新版本，更多信息请看<a class="ae oc" href="https://docs.gitlab.com/ee/ci/examples/semantic-release.html" rel="noopener ugc nofollow" target="_blank">这个</a>。</p><p id="c319" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">所以让我们安装它:</p><pre class="kd ke kf kg gt nh ng ni nj aw nk bi"><span id="a818" class="mo lh in ng b gy nl nm l nn no">$ <!-- -->npm install semantic-release @semantic-release/git @semantic-release/gitlab @semantic-release/npm --save-dev</span></pre><p id="54be" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在安装了所需的包之后，我们需要使用一个名为<code class="fe nd ne nf ng b">.releaserc.json</code>的配置文件来配置语义发布</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="cf2e" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">然后，让我们通过以下方式更新我们的package.json文件:</p><ol class=""><li id="a96f" class="ly lz in km b kn ko kq kr kt ny kx nz lb oa lf mf mg mh mi bi translated">将项目重命名为:<code class="fe nd ne nf ng b">@your_scope/project_name</code></li><li id="c47b" class="ly lz in km b kn mj kq mk kt ml kx mm lb mn lf mf mg mh mi bi translated">将主文件更改为:<code class="fe nd ne nf ng b">"main": "dist/index.js"</code></li><li id="c126" class="ly lz in km b kn mj kq mk kt ml kx mm lb mn lf mf mg mh mi bi translated">添加新脚本:<code class="fe nd ne nf ng b">"semantic-release": "semantic-release"</code></li><li id="f8c1" class="ly lz in km b kn mj kq mk kt ml kx mm lb mn lf mf mg mh mi bi translated">添加publishConfig条目:</li></ol><pre class="kd ke kf kg gt nh ng ni nj aw nk bi"><span id="8fbb" class="mo lh in ng b gy nl nm l nn no">"publishConfig": {</span><span id="b5f2" class="mo lh in ng b gy oh nm l nn no">"@your_scope:registry": "https://gitlab.com/api/v4/projects/40114401/packages/npm/"</span><span id="9ee7" class="mo lh in ng b gy oh nm l nn no">},</span></pre><h2 id="58f3" class="mo lh in bd li mp mq dn lm mr ms dp lq kt mt mu ls kx mv mw lu lb mx my lw mz bi translated">b.创造。npmrc文件</h2><blockquote class="on oo op"><p id="34ca" class="kk kl od km b kn ko jo kp kq kr jr ks oq ku kv kw or ky kz la os lc ld le lf ig bi translated">npm从命令行、环境变量和<code class="fe nd ne nf ng b">npmrc</code>文件中获取配置设置</p></blockquote><p id="e44e" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">要从外部注册表安装一个包(在我们的例子中是Gitlab ),我们需要告诉npm应该从哪里安装我们的包。为此，我们创建了一个名为。npmrc在我们项目的根中。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="48c8" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">您会注意到:</p><ul class=""><li id="e674" class="ly lz in km b kn ko kq kr kt ny kx nz lb oa lf ob mg mh mi bi translated">我们的范围包是:<code class="fe nd ne nf ng b">@sb-plugins</code></li><li id="ccc8" class="ly lz in km b kn mj kq mk kt ml kx mm lb mn lf ob mg mh mi bi translated">我们指定我们的包在gitlab注册表中发布。</li><li id="d9af" class="ly lz in km b kn mj kq mk kt ml kx mm lb mn lf ob mg mh mi bi translated">对于project_id你可以在项目的设置里找到(看下图)</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi ot"><img src="../Images/217c89dc5222f90dcd7fe21e2679bbe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QacWKuFgOnJK0DsxEJOyfg.png"/></div></div></figure><ul class=""><li id="72fa" class="ly lz in km b kn ko kq kr kt ny kx nz lb oa lf ob mg mh mi bi translated">最后，你可能会被问及<code class="fe nd ne nf ng b">CI_JOB_TOKEN</code>。答案是:</li></ul><blockquote class="on oo op"><p id="35d9" class="kk kl od km b kn ko jo kp kq kr jr ks oq ku kv kw or ky kz la os lc ld le lf ig bi translated">当管道作业即将运行时，GitLab会生成一个唯一的令牌，并将其作为<code class="fe nd ne nf ng b"><a class="ae oc" href="https://docs.gitlab.com/ee/ci/variables/predefined_variables.html" rel="noopener ugc nofollow" target="_blank">CI_JOB_TOKEN</a></code> <a class="ae oc" href="https://docs.gitlab.com/ee/ci/variables/predefined_variables.html" rel="noopener ugc nofollow" target="_blank">预定义变量</a>注入。</p></blockquote><h2 id="aff0" class="mo lh in bd li mp mq dn lm mr ms dp lq kt mt mu ls kx mv mw lu lb mx my lw mz bi translated">c.生成个人访问令牌</h2><p id="1393" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt na kv kw kx nb kz la lb nc ld le lf ig bi translated">配置太多？我有一个好消息:这是最后一步😃</p><blockquote class="on oo op"><p id="e3e0" class="kk kl od km b kn ko jo kp kq kr jr ks oq ku kv kw or ky kz la os lc ld le lf ig bi translated">作为发布包的一部分，语义发布增加了<code class="fe nd ne nf ng b">package.json</code>中的版本号。为了让semantic-release提交这个变更并将其推回GitLab，管道需要一个名为<code class="fe nd ne nf ng b">GITLAB_TOKEN</code>的定制CI/CD变量。</p></blockquote><p id="d72a" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">要创建这个变量，检查<a class="ae oc" href="https://docs.gitlab.com/ee/ci/examples/semantic-release.html#set-up-cicd-variables" rel="noopener ugc nofollow" target="_blank">这个</a>。</p><p id="2b24" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">最后，提交你的修改，然后再推一次🥁🥁🥁.</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi ou"><img src="../Images/46984d3094d6be68eb6a6b978ee4b392.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sg-VqXisg4mbmB7k2ln7rQ.png"/></div></div></figure><p id="01ae" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">我们的管道成功了，如果您检查您的项目注册表，您会找到您的包:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi ov"><img src="../Images/facd56214ea8cca248241bd2affe2b58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ADksmF4Vlcv2lC8RuSMwVg.png"/></div></div></figure><h1 id="ac26" class="lg lh in bd li lj lk ll lm ln lo lp lq jt lr ju ls jw lt jx lu jz lv ka lw lx bi translated">➕如何在其他项目中安装我们的软件包？</h1><p id="b7b6" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt na kv kw kx nb kz la lb nc ld le lf ig bi translated">如果我们不能在其他项目中使用我们的包，我们所做的一切都没有意义。但是，怎么做呢？</p><p id="b65e" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">如果您尝试使用npm直接安装它，将会出现以下错误:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi ow"><img src="../Images/c8daad0a9cce50b6cf2202d3bf633271.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jmb5h5dTVOHGodbvVoCK3Q.png"/></div></div></figure><p id="0185" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">事实上，npm在npm注册表中搜索我们的包，这就是为什么我们没有找到错误。</p><p id="8b33" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">为了解决这个问题，我们应该告诉npm我们想从gitlab注册表安装这个包。因此，让我们创建npm配置文件。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="3f73" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">现在尝试再次安装软件包:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi ox"><img src="../Images/e760fcab64162e2a6b139b1b5b456c0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o7DgQ9SSdQBNxMIKtBQ1wg.png"/></div></div></figure><h2 id="2429" class="mo lh in bd li mp mq dn lm mr ms dp lq kt mt mu ls kx mv mw lu lb mx my lw mz bi translated"><strong class="ak"> <em class="oy">加成</em> </strong>🎁</h2><p id="dd39" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt na kv kw kx nb kz la lb nc ld le lf ig bi translated">如果您想保持您的包的私密性:</p><ul class=""><li id="19f2" class="ly lz in km b kn ko kq kr kt ny kx nz lb oa lf ob mg mh mi bi translated">将您的项目设为私有</li><li id="b24b" class="ly lz in km b kn mj kq mk kt ml kx mm lb mn lf ob mg mh mi bi translated">使用您生成的个人访问令牌GITLAB_TOKEN将包安装到所需的项目中(只需取消。npmrc文件)</li></ul></div><div class="ab cl oz pa hr pb" role="separator"><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe"/></div><div class="ig ih ii ij ik"><p id="683c" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">感谢您的阅读，如果您有任何问题或意见，请不要犹豫，在下面留下您的评论。</p><ul class=""><li id="01fd" class="ly lz in km b kn ko kq kr kt ny kx nz lb oa lf ob mg mh mi bi translated">链接到Gitlab项目:<a class="ae oc" href="https://gitlab.com/sihemBouh/sb-geometry-plugin" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/sihemBouh/sb-geometry-plugin</a></li><li id="35c5" class="ly lz in km b kn mj kq mk kt ml kx mm lb mn lf ob mg mh mi bi translated">Gitlab页面中生成文档的链接:<a class="ae oc" href="https://sihembouh.gitlab.io/sb-geometry-plugin/" rel="noopener ugc nofollow" target="_blank">https://sihembouh.gitlab.io/sb-geometry-plugin/</a></li></ul><p id="9338" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><em class="od">更多内容请看</em><a class="ae oc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="km io"><em class="od">plain English . io</em></strong></a><em class="od">。报名参加我们的</em> <a class="ae oc" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="km io"> <em class="od">免费周报</em> </strong> </a> <em class="od">。关注我们关于</em><a class="ae oc" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="km io"><em class="od">Twitter</em></strong></a><a class="ae oc" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="km io"><em class="od">LinkedIn</em></strong></a><em class="od"/><a class="ae oc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="km io"><em class="od">YouTube</em></strong></a><em class="od"/><a class="ae oc" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="km io"><em class="od">不和</em> </strong> </a> <em class="od">。对增长黑客感兴趣？检查</em> <a class="ae oc" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="km io"> <em class="od">电路</em> </strong> </a> <em class="od">。</em></p></div></div>    
</body>
</html>