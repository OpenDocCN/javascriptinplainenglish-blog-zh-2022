# ä½¿ç”¨ Monad è®¾è®¡æ¨¡å¼åœ¨ Angular ä¸­è®°å½•åˆ†æäº‹ä»¶çš„ TypeScript è£…é¥°å™¨

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/typescript-decorator-for-logging-analytics-event-in-angular-using-monad-design-pattern-3241246b0c5d?source=collection_archive---------0----------------------->

## Logging Decorator ä½¿ç”¨ Monad è®¾è®¡æ¨¡å¼ã€è§£è€¦åº”ç”¨ç¨‹åºä»£ç å’Œæ—¥å¿—é€»è¾‘æ¥è·Ÿè¸ª Angular ä¸­çš„åˆ†æäº‹ä»¶ã€‚

![](img/97aa9ff941f495a649078bc4b75c07c0.png)

Monads, Monads Everywhere

åœ¨æ¯ä¸ª web/ç§»åŠ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå½“å®ƒæ‰©å±•æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªç‚¹éœ€è¦è®°å½• APIã€ç”¨æˆ·è¡Œä¸ºè·Ÿè¸ªã€äº‹ä»¶ã€åˆ†æã€é”™è¯¯ç­‰ã€‚

æ—¥å¿—è®°å½•æ˜¯åœ¨é—®é¢˜å½±å“æ‚¨çš„ç”¨æˆ·æˆ–ç»„ç»‡ä¹‹å‰è¿›è¡Œæ•…éšœæ’é™¤å’Œè§£å†³é—®é¢˜çš„æœ€ä½³å®è·µã€‚

è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¯¹äºæ¯ä¸€ä¸ªäº‹ä»¶åŠ¨ä½œï¼Œä½ éœ€è¦å°†äº‹ä»¶åˆ†æ´¾åˆ°åˆ†æå¹³å°ï¼Œæ¯”å¦‚ Google analyticsã€‚

å‡è®¾æ‚¨æœ‰ä¸€ä¸ªå‡½æ•°`logEvent`,å®ƒå°†åˆ†æäº‹ä»¶å‘é€åˆ°å¦‚ä¸‹æœåŠ¡:

```
interface IEvent = {
  eventName: string;
  eventData: {
    args: any;
   };
}const logEvent = (event: IEvent) => {
  thirdPartyAnalyticsService.send(event)
}const getUser = (userId) => {
 logEvent({eventName: 'submit'; eventData: { args: userId }}); result = getUserFromAPI() // .... do some operations
 return result;
}
```

å¦‚æœä½ çœ‹ä¸Šé¢çš„ä»£ç ï¼Œä½ ä¼šå¾ˆå¿«æ³¨æ„åˆ°ä»£ç åº“å°†å……æ»¡æ–¹æ³•`logEvent`æ··ä¹±å’Œé‡å¤æ— å¤„ä¸åœ¨ï¼Œå› ä¸ºéœ€æ±‚ä¸æ–­å˜åŒ–ï¼Œå¾ˆå¿«å°±ä¼šæœ‰å¾ˆå¤šæ¡ä»¶å’Œæ··ä¹±ã€‚

è¿™å¼€å§‹çœŸçš„çœŸçš„ä¼¤å®³ä½ çš„çœ¼ç›ï¼Œä½ å¼€å§‹åœ¨ä½ çš„æ¢¦é‡Œçœ‹åˆ°`logEvent`ã€‚ğŸ˜´å“¦ï¼Œå™©æ¢¦ã€‚ğŸ˜±

å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œå½“æˆ‘å¶ç„¶å‘ç°`Monads`æ—¶ï¼Œæˆ‘æ­£åœ¨å¯»æ‰¾ä¸€ç§è§£å†³æ–¹æ¡ˆæ¥å¹²ç‡¥è¿™æ®µä»£ç ï¼Œè¿™å°±æ˜¯ç‚¹å¼€å§‹è¿æ¥çš„æ—¶å€™ã€‚ğŸ‘€

è¿™é‡Œæœ‰ä¸€ä¸ªè§†é¢‘å¾ˆå¥½åœ°è§£é‡Šäº†å•å­æ˜¯ä»€ä¹ˆ:[https://www.youtube.com/watch?v=C2w45qRc3aU](https://www.youtube.com/watch?v=C2w45qRc3aU)

> åŸºæœ¬ä¸Šï¼Œå•å­æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå…è®¸ç”¨æˆ·é“¾æ¥æ“ä½œï¼ŒåŒæ—¶å•å­åœ¨å¹•åç®¡ç†ç§˜å¯†å·¥ä½œã€‚

è¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œåœ¨å¹•åç§˜å¯†åœ°è¿›è¡Œè®°å½•ã€‚ğŸ¤

## å•å­æœ‰ä¸‰ä¸ªéƒ¨åˆ†:

1.  åŒ…è£…ç±»å‹
2.  åŒ…è£¹åŠŸèƒ½:å…è®¸è¿›å…¥å•å­ç”Ÿæ€ç³»ç»Ÿ
3.  è¿è¡Œå‡½æ•°:å¯¹ä¸€å…ƒå€¼è¿è¡Œè½¬æ¢

ä½†è¿™å’Œæˆ‘ä»¬çš„é—®é¢˜æœ‰å…³ç³»å—ï¼Ÿè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨åŒ…è£…å‡½æ•°æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

è¿™æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œç¨å¾®åšäº†ä¸€ç‚¹è°ƒæ•´ï¼Œæˆ‘ä»¬ä¹Ÿè·Ÿè¸ªåŸå§‹å‡½æ•°çš„ç»“æœã€‚

å¦‚æœä½ ä»”ç»†è§‚å¯Ÿ`logWrapper`åŠŸèƒ½ï¼Œé“ƒå£°å¼€å§‹å“èµ·ï¼Œå®ï¼Œä¸ä¸ï¼Œå®ï¼Œå®â€¦ğŸ””

![](img/7a83437c0d35887294178b1d1555d6d1.png)

> ç§ï¼Œè£…é¥°è€…ä»¬â€¦

è¿™ä¸ªå‡½æ•°çœ‹èµ·æ¥æ›´åƒè£…é¥°è€…â€¦ğŸ”®

![](img/6f80beab6988c6b26cc1421d5da03f7a.png)

æ‰€ä»¥ä½ å¯èƒ½æƒ³çŸ¥é“è£…é¥°è€…å’Œå•å­æ˜¯ä¸æ˜¯ä¸€æ ·çš„ï¼Œç®€è€Œè¨€ä¹‹å®ƒä»¬ä¸æ˜¯ã€‚ä½†è¿™æ˜¯ä»¥åçš„è¯é¢˜ã€‚ğŸ—£

å›åˆ°æˆ‘ä»¬çš„é—®é¢˜ï¼Œæ¨¡å¼çœ‹èµ·æ¥æœ‰ç‚¹ç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª`logEvent`è‡ªå®šä¹‰çš„ typescript æ–¹æ³•è£…é¥°å™¨ï¼Œå®ƒå®Œå…¨æ»¡è¶³ç›¸åŒçš„ç›®çš„ã€‚ä»£ç å°†ç±»ä¼¼äºä¸‹é¢è¿™æ ·ã€‚

é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œæˆ‘ä»¬éš”ç¦»äº†åº”ç”¨ç¨‹åºå’Œåˆ†æä»£ç ã€‚

è™½ç„¶ä¸Šé¢çš„ä»£ç çœ‹èµ·æ¥å¾ˆå®Œæ•´ï¼Œè§£å†³æ–¹æ¡ˆä¹Ÿè¿è¡Œè‰¯å¥½ï¼Œä½†æ˜¯å®ƒæœ‰ä¸€äº›é™åˆ¶ã€‚è€ƒè™‘ä»¥ä¸‹åœºæ™¯:

```
@Logger()
getUser(userId) {
  // say some extra data is required to perform api request and we 
  // also need to track that extra data.
  const randomExtraData = Math.random(); const result = getUserFromAPI(userId, randomExtraData);
  return result;
}
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„`Logger`è£…é¥°è€…å¯ä»¥è®¿é—®`userId`å’Œ`result`ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®`randomExtraData`ã€‚

ä½¿ç”¨æˆ‘ä»¬ç°æœ‰çš„å®ç°ï¼Œæˆ‘ä»¬å°†æ— æ³•æ•è·`randomExtraData`çš„å€¼ï¼Œå¹¶å°†å…¶åŒ…å«åœ¨ä¼ é€’ç»™`logEvent`çš„åˆ†æäº‹ä»¶ä¸­ã€‚

æ¢å¥è¯è¯´ï¼Œåœ¨åº”ç”¨ç¨‹åºä»£ç å‡½æ•°ä½“ä¸­æ„é€ çš„æ•°æ®å¯¹`logEvent`å‡½æ•°ä¸å¯ç”¨ï¼Œä¹Ÿä¸èƒ½åŒ…å«åœ¨è·Ÿè¸ªäº‹ä»¶ä¸­ã€‚

è¿™ä¸ªéšæœºæ•°æ®å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œå¦ä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„ç»“æœã€ç½‘ç»œè¯·æ±‚ã€ä¿®æ”¹çš„æ•°æ®ç­‰ç­‰ã€‚

ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›æ”¹å˜ã€‚

å› ä¸º`Logger`å¯ä»¥è®¿é—®å®ƒæ‰€è°ƒç”¨çš„å‡½æ•°çš„è¿”å›å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†è¿”å›ç±»å‹ä»æ•°å­—æ”¹ä¸ºå¯¹è±¡ï¼Œåœ¨è¿”å›å€¼ä¸­ä¼ é€’ä¸€äº›å†…éƒ¨æ•°æ®(åœ¨æœ¬ä¾‹ä¸­ä¸º`randomExtraData`)ã€‚

*æ¥ä¸‹æ¥æ˜¯æˆ‘ä»¬åˆ›å»ºâ€œWrapperTypeâ€çš„éƒ¨åˆ†ã€‚*

```
[@Logger](http://twitter.com/Logger)()
getUser(userId) {
  const randomExtraData = Math.random(); const result = getUserFromAPI(userId, randomExtraData);
  return {
     result: result,
     __loggingInfo: {
        eventName: 'getUserEvent',
        eventData: {
          args: userId,
          result: result,
          extraData: randomExtraData,
        },
     } as IEvent
  }
}
```

å¾ˆå¥½ï¼Œè§£å†³äº†ä¸€ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æœ‰æ—¶æˆ‘æƒ³åœ¨è®°å½•ä¹‹å‰å‘ç°æœ‰çš„äº‹ä»¶æ•°æ®ä¸­æ·»åŠ é¢å¤–çš„æ•°æ®ï¼Œæˆ–è€…å¯¹ event data è¿›è¡Œä¸€äº›æ›´æ”¹ï¼Œä½†æœ‰æ—¶æˆ‘ä¸æƒ³è¿™æ ·åšã€‚

è¿™ä¸ªæ•°æ®ä¿®æ”¹è¿‡ç¨‹æ˜¯ç‰¹å®šäºæ—¥å¿—è®°å½•çš„ï¼Œæˆ‘ä¸å¸Œæœ›æˆ‘çš„ç»„ä»¶äº†è§£å®ƒï¼Œç”šè‡³ä¸å¸Œæœ›å¤„ç†å®ƒã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„`Logger`è£…é¥°å™¨ä¸­å¼•å…¥ä¸€ä¸ªå‚æ•°ï¼Œå®ƒå¯ä»¥æ¥å—ä¸€ä¸ª*æ„é€ å‡½æ•°*ï¼Œè¯¥å‡½æ•°æ„é€ ä¸€ä¸ªå®šåˆ¶çš„åˆ†æäº‹ä»¶æœ‰æ•ˆè´Ÿè½½ï¼Œå¯èƒ½ä¼šæ·»åŠ ä¸€äº›é¢å¤–çš„æ•°æ®ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªçš„æœ€ç»ˆç»“æœã€‚

***è®°å½•å™¨è£…é¥°å™¨å®ç°:***

***åº”ç”¨ç»„ä»¶åˆ©ç”¨è®°å½•å™¨è£…é¥°å™¨:***

æ­¤å¤–ï¼Œè¿™é‡Œæ˜¯å±•ç¤ºä¸Šè¿°è®°å½•å™¨è£…é¥°å™¨çš„ **Stackblitz ç¤ºä¾‹**ï¼Œè¯·ç»§ç»­æŸ¥çœ‹ã€‚ğŸ’»

[](https://stackblitz.com/edit/angular-ivy-2gym2w?file=src/app/app.component.ts) [## è¨è¾¾æ–¯

### åŸºäº@angular/animationsã€@angular/compilerã€@angular/coreã€@angular/common çš„ angular-cli é¡¹ç›®â€¦

stackblitz.com](https://stackblitz.com/edit/angular-ivy-2gym2w?file=src/app/app.component.ts) 

æœ€åï¼Œæˆ‘ä»¬ç®€è¦è®¨è®ºäº† Logger decorator çš„å®ç°ï¼Œè¯¥å®ç°ç”¨äºä½¿ç”¨ TypeScript decorator åœ¨ Angular ä¸­è·Ÿè¸ªåˆ†ææ•°æ®ã€‚

è¯·åœ¨ä¸‹é¢ç•™ä¸‹è¯„è®ºï¼Œè®©æˆ‘çŸ¥é“å…¶ä»–å„ç§æ–¹æ³•ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œæˆ–è€…å¦‚æœæœ‰ä»»ä½•å³å…´åˆ›ä½œã€‚æˆ‘å¾ˆä¹æ„å›ç­”è¿™äº›é—®é¢˜ã€‚

**å‚è€ƒæ–‡çŒ®:**

1.  [å»ºé€ å•å­](https://sambernheim.com/blog/building-a-monad)ğŸ—’[å¡ç¼ªå°”Â·ä¼¯æ©æµ·å§†](https://mobile.twitter.com/sambernheim)
2.  [ã€Youtubeã€‘è½¯ä»¶å·¥ç¨‹å¸ˆå¯¹å•å­çš„æœ€ä½³ä»‹ç»](https://youtu.be/C2w45qRc3aU)ğŸ“¹

*æ›´å¤šå†…å®¹çœ‹* [***è¯´ç™½äº†ã€‚æŠ¥åå‚åŠ æˆ‘ä»¬çš„***](https://plainenglish.io/) **[***å…è´¹å‘¨æŠ¥***](http://newsletter.plainenglish.io/) *ã€‚å…³æ³¨æˆ‘ä»¬å…³äº* [***æ¨ç‰¹***](https://twitter.com/inPlainEngHQ)**å’Œ*[***LinkedIn***](https://www.linkedin.com/company/inplainenglish/)*ã€‚æŸ¥çœ‹æˆ‘ä»¬çš„* [***ç¤¾åŒºä¸å’Œè°***](https://discord.gg/GtDtUAvyhW) *åŠ å…¥æˆ‘ä»¬çš„* [***äººæ‰é›†ä½“***](https://inplainenglish.pallet.com/talent/welcome) *ã€‚****