<html>
<head>
<title>Guide to Debugging Node.js Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js应用程序调试指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/guide-to-debugging-node-js-applications-3bd76416cd9c?source=collection_archive---------8-----------------------#2022-12-21">https://javascript.plainenglish.io/guide-to-debugging-node-js-applications-3bd76416cd9c?source=collection_archive---------8-----------------------#2022-12-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="55e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">即使是设计最好的软件也会有意想不到的错误。那我们怎么调试呢？调试应用程序的最佳方法和工具是什么？</p><p id="605b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就易用性而言，在开发或原型开发过程中，没有什么能比旧的console.log更好了。它很快，语法很简单，而且我们可以同时记录多件事情。</p><p id="2530" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这不是生产环境中的最佳解决方案，因为过多的日志生成会降低服务速度。对于调试具有多个代码分支的更复杂的问题来说，这并不太好，因为在复杂的代码中很容易迷失方向。有哪些选择？</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/973936e61f539ab052a12e8b92e2ad11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T0g8R54bprEtRGwS"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Photo by <a class="ae lb" href="https://unsplash.com/@rayhennessy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ray Hennessy</a> on <a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a3cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">调试Node.js有两种更好的方法。</p><ol class=""><li id="e523" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">从终端开始，使用Chrome DevTools</li><li id="8c44" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">使用VSCode集成调试器</li></ol><h1 id="0708" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">使用DevTools调试</h1><p id="8e9d" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">如果你是一个全栈开发人员，我相信你对Chrome DevTools很熟悉，但你知道它可以用于Node.js应用程序吗？</p><p id="d3f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用— inspect选项启动应用程序，如下所示。</p><pre class="km kn ko kp gt mt mu mv bn mw mx bi"><span id="f2fc" class="my lr iq mu b be mz na l nb nc"># node --inspect server.js<br/><br/>Debugger listening on ws://127.0.0.1:9229/xxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx<br/>For help, see: https://nodejs.org/en/docs/inspector<br/>Server running at http://127.0.0.1:3000/<br/>Debugger attached.</span></pre><p id="745a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该命令将在调试模式下运行Node.js。它将打开一个WebSocket，其他应用程序可以连接到这个web socket进行调试。当你打开Chrome DevTools时，它会自动检测打开的Node.js调试端口，并在左上角显示一个Node.js图标。单击该图标打开一个专用的DevTools窗口来调试您的应用程序。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/2e9f01dc026a88014455ad8a40f918d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*mvTvSUnueXSzySxS7borYg.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Node.js icon in DevTools</figcaption></figure><p id="5cee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您的应用程序是短期的，您没有时间打开调试窗口，可以使用— <strong class="jp ir"> inspect-brk </strong>选项。它会在启动时暂停应用程序的执行，给你时间打开DevTools。</p><p id="56c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您将TypeScript与ts-node一起使用，以下命令将会很有帮助:</p><pre class="km kn ko kp gt mt mu mv bn mw mx bi"><span id="6149" class="my lr iq mu b be mz na l nb nc">node --inspect -r ts-node/register  ./application.ts</span></pre><p id="04f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用于调试Node.js的DevTools窗口的选项卡比它的浏览器兄弟少。我们可以找到标签</p><ul class=""><li id="58d0" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk ne li lj lk bi translated">日志条目控制台。</li><li id="bf76" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk ne li lj lk bi translated">断点和调试的源。</li><li id="01bd" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk ne li lj lk bi translated">CPU分析</li><li id="b471" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk ne li lj lk bi translated">内存分析。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nf"><img src="../Images/e823cc7a47a931e8692c855a86252108.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qk6TuYg7fiHPNa44nVob_Q.png"/></div></div></figure><p id="d29e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在console选项卡中，我们可以像在浏览器中一样过滤日志输出。如果您的应用程序产生大量日志，这可能有助于大海捞针。在控制台窗口中查看日志条目比在终端中容易得多。</p><p id="1008" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在sources选项卡中，我们可以找到应用程序的所有源代码。如果你有一个TypeScript应用程序，并使用源地图，我们将看到原始的TypeScript代码。如果没有源代码图，您将会看到编译后的代码，可读性和有用性将会降低。</p><h1 id="c824" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">添加断点</h1><p id="976a" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">当问题比我们用简单的日志所能识别的更复杂时，我们将需要在代码中的某些断点或行号处暂停应用程序。这将允许我们检查应用程序的当前状态。哪些变量被初始化？这些变量的值是什么？我们从HTTP请求中得到的确切值是多少？</p><p id="4aab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有两种方法可以添加断点。它们可以通过编写<strong class="jp ir">调试器来添加；</strong>在源代码中。我们可以在任何我们想写的地方写它，它只会在应用程序以调试模式运行时暂停它。(尽管如此，最好不要将这些语句留在代码中)</p><p id="3921" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也可以通过单击源文件中的行号来创建断点。断点用深蓝色箭头标记，而非活动断点用浅蓝色箭头标记。这两种断点的行为方式相同。</p><p id="35b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当命中断点时，打开源文件，突出显示断点行，显示调用堆栈和范围内的所有变量。</p><p id="2193" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码会暂停，直到您按下resume、单步执行、单步执行或单步执行。“步骤”按钮允许您继续执行部分代码，并更好地理解所采用的代码路径。</p><h1 id="da97" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">CPU分析</h1><p id="8f1a" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">如果您想知道代码的哪些部分使用了最多的CPU，或者您是否有性能问题，您可以分析您的代码。这与其说是纯粹的调试，不如说是性能优化，尽管错误的实现会导致更高的CPU负载。</p><p id="1313" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">导致高CPU负载的原因并不总是很清楚，可能是一些简单的事情，如过多的console.log语句或对相对较大的JSON负载的解析。关于绩效评估的更多信息，你可以在这里阅读我的故事<a class="ae lb" href="https://medium.com/better-programming/performance-improvement-of-full-stack-javascript-applications-2b5f631a562c" rel="noopener"/>。</p><h1 id="3a28" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">内存分析</h1><p id="6b5b" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">内存泄漏是很难解决的问题。它会导致服务慢慢耗尽越来越多的内存，直到以不可预知的方式崩溃。</p><p id="bb03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">V8内存分析器允许您在给定时间拍摄应用程序内存的快照，然后做一些工作并制作另一个快照。通过比较这两个快照，您可以了解应用程序的内存量。</p><h1 id="f9fc" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">VSCode调试</h1><p id="6a17" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">如果您更愿意使用IDE来调试代码，可以使用VSCode中的javascript调试终端自动进行调试。</p><p id="a224" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从菜单或快捷键CTRL+SHIFT+'打开终端。</p><p id="4d97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从+号旁边的下拉菜单中，选择JavaScript Debug Terminal。</p><p id="d23b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也可以使用CTRL+SHIFT+P打开调试终端，并键入“javascript debug terminal”</p><p id="c7c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在VSCode中调试允许您直接在文件编辑器窗口中设置断点。它通常与DevTools、CPU和内存分析中的调试工作相同。调试控制台也有一些限制。</p><p id="10ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我只在必要的时候使用调试模式，因为这是有代价的，启动时间要长得多，性能也会下降。打开调试websocket有安全风险，所以不要在生产中使用— profiling选项。</p><p id="57c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">调试模式和断点在修复单元测试时工作得一样好，我发现它对那个用例真的很有用。</p><p id="9e65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您喜欢在IDE、DevTools中调试或者使用console.log，请在评论中告诉我。</p><p id="96e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢你所读的，考虑加入Medium，读更多的文章。你的一部分稿费用来支持像我这样的作者。点击这里加入。T3】</p><p id="a02f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ng">更多内容看</em> <a class="ae lb" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="ng">说白了就是</em> </strong> </a> <em class="ng">。报名参加我们的</em> <a class="ae lb" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="ng">免费周报</em> </strong> </a> <em class="ng">。关注我们关于</em> <a class="ae lb" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="ng">推特</em> </strong> </a>，<a class="ae lb" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="ng">LinkedIn</em></strong></a><em class="ng">，</em><a class="ae lb" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="ng">YouTube</em></strong></a><em class="ng">，以及</em> <a class="ae lb" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="ng">不和</em> </strong> </a> <strong class="jp ir"> <em class="ng">。</em>T53】</strong></p><p id="136f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="ng">对缩放您的软件启动感兴趣</em> </strong> <em class="ng">？检查出</em> <a class="ae lb" href="https://circuit.ooo?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="ng">电路</em> </strong> </a> <em class="ng">。</em></p></div></div>    
</body>
</html>