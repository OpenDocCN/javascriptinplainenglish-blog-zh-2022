<html>
<head>
<title>React useState hook Mistakes You Must Avoid!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你必须避免的错误！</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-usestate-hook-mistakes-you-must-avoid-fde757ca52f5?source=collection_archive---------3-----------------------#2022-12-18">https://javascript.plainenglish.io/react-usestate-hook-mistakes-you-must-avoid-fde757ca52f5?source=collection_archive---------3-----------------------#2022-12-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/15ae6223de2f10d7da342e8b9497db06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6-Ok0PvNXZ6pvAHbRHXLUg.png"/></div></div></figure><p id="6f84" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这篇博客中，我们将讨论React developer常犯的5个最常见的useState挂钩错误。我们将一步一步地看到所有常见的错误，并通过示例学习如何修复它们。</p><h1 id="5055" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">1.依赖于API响应来填充状态</h1><p id="d1fe" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我见过许多React开发人员在没有正确初始化的情况下定义了useState钩子，然后用API响应添加数据。当您试图在组件呈现之前访问状态数据时，这会给您一个错误，因为获取API响应需要一些时间。</p><blockquote class="lw lx ly"><p id="e475" class="jv jw lz jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated">让我们看看下面的例子</p></blockquote><p id="0aa6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">初始化组件</strong></p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="9e37" class="mm ku in mi b be mn mo l mp mq">import React, { useEffect, useState } from 'react';<br/><br/>const Initialize = () =&gt; {<br/>    const [product, setProduct] = useState();<br/><br/>    useEffect(() =&gt; {<br/>        // Consider this as an API response<br/>        const apiResponse = {<br/>            name: "T-Shirt",<br/>            price: "$399",<br/>            description: "A super coll T-Shirt for you"<br/>        }<br/>        setProduct(apiResponse);<br/>    }, [])<br/>    return (<br/>        &lt;div&gt;<br/>            &lt;h3&gt;{product.name}&lt;/h3&gt;<br/>            &lt;p&gt;{product.price}&lt;/p&gt;<br/>            &lt;p&gt;{product.description}&lt;/p&gt;<br/>        &lt;/div&gt;<br/>    );<br/>};<br/><br/>export default Initialize;</span></pre><p id="7295" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">输出</strong></p><figure class="md me mf mg gt jo gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/872be62bfdf5f710491f2e1a2ba45676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*AkDBsi2IaAVycxWFX3UQzw.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk">useState hook gives cannot read properties of undefined error</figcaption></figure><p id="10e0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们正在从产品状态中访问name属性，而该属性在状态中并不存在。一旦API调用成功，就会添加它。因此，在组件呈现期间，产品状态是未定义的。修复这个错误的一个好方法是初始化状态。</p><p id="4165" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">初始化组件</strong>中的初始化状态</p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="b56e" class="mm ku in mi b be mn mo l mp mq">import React, { useEffect, useState } from 'react';<br/><br/>const Initialize = () =&gt; {<br/>    const [product, setProduct] = useState({<br/>        name: "",<br/>        price: "",<br/>        description: ""<br/>    });<br/><br/>    useEffect(() =&gt; {<br/>        // Consider this as an API response<br/>        const apiResponse = {<br/>            name: "T-Shirt",<br/>            price: "$399",<br/>            description: "A super coll T-Shirt for you"<br/>        }<br/>        setProduct(apiResponse);<br/>    }, [])<br/>    return (<br/>        &lt;div&gt;<br/>            &lt;h3&gt;{product.name}&lt;/h3&gt;<br/>            &lt;p&gt;{product.price}&lt;/p&gt;<br/>            &lt;p&gt;{product.description}&lt;/p&gt;<br/>        &lt;/div&gt;<br/>    );<br/>};<br/><br/>export default Initialize;</span></pre><p id="ece1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">输出</strong></p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mw"><img src="../Images/edd7c3c9efba3e5de6cb714ee38f6ac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QVgnkwI2gi-7-YC49Lr61w.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk">No Error in the console</figcaption></figure><p id="09c3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">初始化状态后，错误从控制台消失，我们可以清楚地看到网页上的数据。</p><h1 id="da64" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">2.为每个输入元素创建状态更改方法</h1><p id="353b" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">假设您有一个表单组件，其中有多个输入元素。现在，您需要从这些输入元素中获取值，并更新组件状态。在这种情况下，一些初级开发人员为每个input元素创建一个独特的handle change函数，这不是处理表单数据的好方法。</p><blockquote class="lw lx ly"><p id="0fe9" class="jv jw lz jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated">让我们看看下面的例子</p></blockquote><p id="0591" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">更新状态组件</strong></p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="e9d4" class="mm ku in mi b be mn mo l mp mq">import { useState } from "react";<br/><br/>function UpdateState() {<br/>  const [formData, setFormData] = useState({name: '', email: '', password: ''});<br/><br/>  const handleName = event =&gt; {<br/>    setFormData({...formData, name: event.target.value})<br/>  }<br/><br/>  const handleEmail = event =&gt; {<br/>    setFormData({...formData, email: event.target.value})<br/>  }<br/><br/>  const handlePassword = event =&gt; {<br/>    setFormData({...formData, password: event.target.value})<br/>  }<br/><br/>  const handleSubmit = () =&gt; {<br/>    console.log(formData);<br/>  }<br/><br/>  return (<br/>    &lt;div&gt;<br/>      &lt;div className="input-control"&gt;<br/>        &lt;label htmlFor="name"&gt;Enter your Name&lt;/label&gt;<br/>        &lt;input <br/>         type="text" <br/>         className="input-field" <br/>         placeholder="Enter your name" <br/>         id="name" <br/>         onChange={handleName}<br/>        /&gt;<br/>      &lt;/div&gt;<br/>      &lt;div className="input-control"&gt;<br/>        &lt;label htmlFor="email"&gt;Enter your Email&lt;/label&gt;<br/>        &lt;input <br/>         type="email" <br/>         className="input-field" <br/>         placeholder="Enter your email" <br/>         id="email" <br/>         onChange={handleEmail}<br/>        /&gt;<br/>      &lt;/div&gt;<br/>      &lt;div className="input-control"&gt;<br/>        &lt;label htmlFor="password"&gt;Enter your Password&lt;/label&gt;<br/>        &lt;input <br/>         type="password" <br/>         className="input-field" <br/>         placeholder="Enter your password" <br/>         id="password" <br/>         onChange={handlePassword}<br/>        /&gt;<br/>      &lt;/div&gt;<br/><br/>      &lt;div&gt;<br/>        &lt;button onClick={handleSubmit} className="submit"&gt;Submit&lt;/button&gt;<br/>      &lt;/div&gt;<br/><br/>    &lt;/div&gt;<br/>  );<br/>}<br/><br/>export default UpdateState;</span></pre><p id="bae2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如我所说的，这不是处理表单数据的好方法。我们只需要一个函数来接收所有输入字段的数据并更新状态。让我们看看下面的代码，看看我们如何做到这一点。</p><p id="7e0f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">更新状态组件</strong></p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="8ef8" class="mm ku in mi b be mn mo l mp mq">import { useState } from "react";<br/><br/>function UpdateState() {<br/>  const [formData, setFormData] = useState({name: '', email: '', password: ''});<br/><br/>  const handleChange = name =&gt; event =&gt; {<br/>    setFormData({...formData, [name]: event.target.value})<br/>  }<br/><br/>  const handleSubmit = () =&gt; {<br/>    console.log(formData);<br/>  }<br/><br/>  return (<br/>    &lt;div&gt;<br/>      &lt;div className="input-control"&gt;<br/>        &lt;label htmlFor="name"&gt;Enter your Name&lt;/label&gt;<br/>        &lt;input <br/>         type="text" <br/>         className="input-field" <br/>         placeholder="Enter your name" <br/>         id="name" <br/>         onChange={handleChange("name")}<br/>        /&gt;<br/>      &lt;/div&gt;<br/>      &lt;div className="input-control"&gt;<br/>        &lt;label htmlFor="email"&gt;Enter your Email&lt;/label&gt;<br/>        &lt;input <br/>         type="email" <br/>         className="input-field" <br/>         placeholder="Enter your email" <br/>         id="email" <br/>         onChange={handleChange("email")}<br/>        /&gt;<br/>      &lt;/div&gt;<br/>      &lt;div className="input-control"&gt;<br/>        &lt;label htmlFor="password"&gt;Enter your Password&lt;/label&gt;<br/>        &lt;input <br/>         type="password" <br/>         className="input-field" <br/>         placeholder="Enter your password" <br/>         id="password" <br/>         onChange={handleChange("password")}<br/>        /&gt;<br/>      &lt;/div&gt;<br/><br/>      &lt;div&gt;<br/>        &lt;button onClick={handleSubmit} className="submit"&gt;Submit&lt;/button&gt;<br/>      &lt;/div&gt;<br/><br/>    &lt;/div&gt;<br/>  );<br/>}<br/><br/>export default UpdateState;</span></pre><p id="3099" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">输出</strong></p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mx"><img src="../Images/1a592451b99453e456cbe65bf9984f09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VDsc6S50S658XLaBuy62ug.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk">logging out the form data after clicking submit button</figcaption></figure><h1 id="acf0" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">3.在更新输入数据的同时呈现组件</h1><p id="67a2" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">你可以在上面的例子中看到，我在每个将要更新状态的输入元素中使用了onChange方法。我们知道一旦状态被更新，组件会重新呈现以反映新的变化。这样做的问题是，每次我们在输入框中输入一个字符，我们的组件都会重新呈现。使用<a class="ae my" rel="noopener ugc nofollow" target="_blank" href="/what-is-useref-hook-forwardref-in-react-a-complete-explanation-8f55496875ca"> <strong class="jx io"> useRef </strong> </a>钩子可以避免组件不必要的重新渲染。如果你想要一个关于useRef钩子和forwardRef的详细解释，那么<a class="ae my" rel="noopener ugc nofollow" target="_blank" href="/what-is-useref-hook-forwardref-in-react-a-complete-explanation-8f55496875ca"> <strong class="jx io">点击这里</strong> </a>。</p><blockquote class="lw lx ly"><p id="3b9d" class="jv jw lz jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated">让我们看看下面的例子</p></blockquote><p id="03a1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">用户执行组件</strong></p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="ebc0" class="mm ku in mi b be mn mo l mp mq">import React, { useRef } from 'react';<br/><br/>const UseRefImplement = () =&gt; {<br/>    const formField = useRef(null);<br/><br/>    const handleSubmit = () =&gt; {<br/>        console.log(formField.current['name'].value);<br/>        console.log(formField.current['email'].value);<br/>        console.log(formField.current['password'].value);<br/>    }<br/>    return (<br/>    &lt;div&gt;<br/>      &lt;form ref={formField}&gt;<br/>      &lt;div className="input-control"&gt;<br/>        &lt;label htmlFor="name"&gt;Enter your Name&lt;/label&gt;<br/>        &lt;input <br/>         type="text" <br/>         className="input-field" <br/>         placeholder="Enter your name" <br/>         id="name" <br/>         name="name"<br/>        /&gt;<br/>      &lt;/div&gt;<br/>      &lt;div className="input-control"&gt;<br/>        &lt;label htmlFor="email"&gt;Enter your Email&lt;/label&gt;<br/>        &lt;input <br/>         type="email" <br/>         className="input-field" <br/>         placeholder="Enter your email" <br/>         id="email" <br/>         name="email"<br/>        /&gt;<br/>      &lt;/div&gt;<br/>      &lt;div className="input-control"&gt;<br/>        &lt;label htmlFor="password"&gt;Enter your Password&lt;/label&gt;<br/>        &lt;input <br/>         type="password" <br/>         className="input-field" <br/>         placeholder="Enter your password" <br/>         id="password" <br/>         name="password"<br/>        /&gt;<br/>      &lt;/div&gt;<br/>      &lt;/form&gt;<br/><br/>      &lt;div&gt;<br/>        &lt;button onClick={handleSubmit} className="submit"&gt;Submit&lt;/button&gt;<br/>      &lt;/div&gt;<br/><br/>    &lt;/div&gt;<br/>  );<br/>};<br/><br/>export default UseRefImplement;</span></pre><p id="a489" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">输出</strong></p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/383fbe8af8f5d4ea62479b7a554618bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rvUFNoM8wMuwTXnm05s8Bg.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk">logging out the form data after clicking submit button</figcaption></figure><h1 id="64f7" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">4.使用异步方法更新状态</h1><p id="4141" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">在这种情况下，让我们先直接看例子。</p><p id="510c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">异步方法组件</strong></p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="0e85" class="mm ku in mi b be mn mo l mp mq">import React, { useEffect, useState } from 'react';<br/><br/>const AsyncMethod = () =&gt; {<br/>    const [count, setCount] = useState(0);<br/><br/>    const increment = () =&gt; {<br/>        console.log("state updated");<br/>        setCount(count+1);<br/>    }<br/><br/>    const asyncIncrement = () =&gt; {<br/>        setTimeout(() =&gt; {<br/>            setCount(count+1)<br/>            console.log("Async state updated");<br/>        }, 3000);<br/>    }<br/><br/>    useEffect(() =&gt; {<br/>        console.log(count);<br/>    }, [count]);<br/><br/>    return (<br/>        &lt;div className="async"&gt;<br/>            &lt;h2&gt;{count}&lt;/h2&gt;    <br/>            &lt;div className="button-group"&gt;<br/>                &lt;button onClick={increment}&gt;Increment&lt;/button&gt;<br/>                &lt;button onClick={asyncIncrement}&gt;Async Increment&lt;/button&gt;<br/>            &lt;/div&gt;   <br/>        &lt;/div&gt;<br/>    );<br/>};<br/><br/>export default AsyncMethod;</span></pre><p id="b568" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">输出</strong></p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/20e1ea22e957e2ec7d0bfad4233713d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SbDE0f9rzZ_mfrMw9NsMyQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk">state update and async state update</figcaption></figure><p id="5a6c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">仔细看控制台。我通过更新状态将数量增加到了7，现在不知从哪里，您看到了异步状态更新的4。</p><h2 id="87d9" class="nb ku in bd kv nc nd dn kz ne nf dp ld kg ng nh lh kk ni nj ll ko nk nl lp nm bi translated">异步状态更新有什么问题？</h2><p id="723b" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">实际上，我通过单击Increment按钮将计数增加到3，然后单击Async Increment按钮。但是你知道异步函数中有setTimeout来模拟异步更新。现在与此同时，我通过点击增量按钮将计数增加到7。此时，异步状态更新被触发，现在根据异步方法，当前状态计数为3，因为这是我单击异步增量时的计数。因此它将计数更新为4而不是8。</p><p id="409b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果异步状态更新方法跟踪当前状态，这个问题就可以解决。我们可以通过将回调函数传递给设置状态方法来做到这一点</p><p id="6108" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">异步方法组件</strong></p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="5237" class="mm ku in mi b be mn mo l mp mq">import React, { useEffect, useState } from 'react';<br/><br/>const AsyncMethod = () =&gt; {<br/>    const [count, setCount] = useState(0);<br/><br/>    const increment = () =&gt; {<br/>        console.log("state updated");<br/>        setCount(count+1);<br/>    }<br/><br/>    const asyncIncrement = () =&gt; {<br/>        setTimeout(() =&gt; {<br/>            setCount(prevCount =&gt; prevCount + 1)<br/>            console.log("Async state updated");<br/>        }, 3000);<br/>    }<br/><br/>    useEffect(() =&gt; {<br/>        console.log(count);<br/>    }, [count]);<br/><br/>    return (<br/>        &lt;div className="async"&gt;<br/>            &lt;h2&gt;{count}&lt;/h2&gt;    <br/>            &lt;div className="button-group"&gt;<br/>                &lt;button onClick={increment}&gt;Increment&lt;/button&gt;<br/>                &lt;button onClick={asyncIncrement}&gt;Async Increment&lt;/button&gt;<br/>            &lt;/div&gt;   <br/>        &lt;/div&gt;<br/>    );<br/>};<br/><br/>export default AsyncMethod;</span></pre><p id="1a09" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">输出</strong></p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/cdd41dcc0f318715916189b69b328cd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qH83Oc2Pklx_4D0NJD50WA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk">state update and async state update</figcaption></figure><p id="9e81" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在您可以看到，通过将回调函数传递给set state方法，该方法跟踪最新的状态数据，问题就解决了。</p><h1 id="779a" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">更新派生状态</h1><p id="07eb" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">初级React开发人员最常犯的一个错误是，当组件中有两个状态，而第二个状态是从第一个状态派生出来的，那么在更新状态时，他们会不知不觉地创建一个bug。</p><blockquote class="lw lx ly"><p id="883c" class="jv jw lz jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated">让我们看看下面的例子</p></blockquote><p id="14c4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">衍生组件</strong></p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="527c" class="mm ku in mi b be mn mo l mp mq">import React, { useState } from 'react';<br/><br/>const DeriveState = () =&gt; {<br/>    const [products, setProducts] = useState([<br/>        {<br/>            name: "T-Shirt",<br/>            price: "$399",<br/>            description: "A super cool T-Shirt for coders",<br/>            selectedColor: "crimson",<br/>            id: 146<br/>        },<br/>        {<br/>            name: "Shoes",<br/>            price: "$399",<br/>            description: "A great pair of shoes for your casual use",<br/>            selectedColor: "crimson",<br/>            id: 790<br/>        }<br/>    ])<br/><br/>    const [cartProduct, setCartProduct] = useState();  <br/><br/>    const addToCart = (productId) =&gt; {<br/>        const product = products.find(product =&gt; product.id === productId);<br/>        setCartProduct(product);<br/>    }<br/><br/>    const handleColor = (color, productId) =&gt; {<br/>        setProducts(currentProducts =&gt; currentProducts.map(product =&gt; {<br/>            if (product.id === productId) {<br/>                return {...product, selectedColor: color}<br/>            }<br/>            return product<br/>        }));<br/>    }<br/><br/>    return (<br/>        &lt;div className="cards"&gt;<br/>            {<br/>                cartProduct ?<br/>                &lt;div className="card-added"&gt;<br/>                {cartProduct.selectedColor} {cartProduct.name} is added to cart<br/>                &lt;/div&gt; : null<br/>            }<br/>            {<br/>                products.map(product =&gt; (<br/>                    &lt;div key={product.id} className="card"&gt;<br/>                      &lt;h3&gt;{product.name}&lt;/h3&gt;<br/>                      &lt;p&gt;{product.description}&lt;/p&gt;<br/>                      &lt;p&gt;{product.price}&lt;/p&gt;<br/>                      &lt;p className="quantity"&gt;<br/>                      &lt;button onClick={() =&gt; addToCart(product.id)} className="cart-btn"&gt;<br/>                      Add To Cart<br/>                      &lt;/button&gt;                   <br/>                      &lt;span <br/>                        onClick={() =&gt; handleColor("crimson", product.id)} <br/>                        className="select-color crimson"&gt;+&lt;/span&gt;<br/>                      &lt;span <br/>                        onClick={() =&gt; handleColor("green", product.id)} <br/>                        className="select-color green"&gt;+&lt;/span&gt;<br/>                      &lt;span <br/>                        onClick={() =&gt; handleColor("violet", product.id)} <br/>                        className="select-color violet"&gt;+&lt;/span&gt;<br/>                      &lt;span <br/>                        onClick={() =&gt; handleColor("black", product.id)} <br/>                        className="select-color black"&gt;+&lt;/span&gt;<br/>                      &lt;/p&gt;<br/>                    &lt;/div&gt;<br/>                ))<br/>            }<br/>        &lt;/div&gt;<br/>    );<br/>};<br/><br/>export default DeriveState;</span></pre><p id="1273" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">输出</strong></p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/feb97845fd21b562a232815bac816ef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MTjoijMFye_wLlFYsgtQHQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk">The UI of Derive state component</figcaption></figure><p id="e604" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可能会想，嘿，太棒了，所有的功能都工作正常，上面的代码有什么问题吗？好吧，让我告诉你有一个错误。如果您单击颜色按钮并尝试更新颜色，那么新选择的颜色不会得到反映，因为这里我们有两种不同的状态，我们正在更新唯一的原始状态。不更新派生状态。</p><p id="fe6e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了修复这个bug，我们基本上不是在派生状态下存储所选产品的副本。我们将存储所选产品的id。看看下面的代码。</p><p id="f822" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">衍生组件</strong></p><pre class="md me mf mg gt mh mi mj bn mk ml bi"><span id="89c3" class="mm ku in mi b be mn mo l mp mq">import React, { useState } from 'react';<br/><br/>const DeriveState = () =&gt; {<br/>    const [products, setProducts] = useState([<br/>        {<br/>            name: "T-Shirt",<br/>            price: "$399",<br/>            description: "A super cool T-Shirt for coders",<br/>            selectedColor: "crimson",<br/>            id: 146<br/>        },<br/>        {<br/>            name: "Shoes",<br/>            price: "$399",<br/>            description: "A great pair of shoes for your casual use",<br/>            selectedColor: "crimson",<br/>            id: 790<br/>        }<br/>    ])<br/><br/>    const [cartProduct, setCartProduct] = useState();<br/>    const [cartProductId, setCartProductId] = useState();<br/>    const addedProductToCart = products.find(product =&gt; product.id === cartProductId);<br/><br/>    const addToCart = (productId) =&gt; {<br/>        setCartProductId(productId);<br/>    }<br/><br/>    const handleColor = (color, productId) =&gt; {<br/>        setProducts(currentProducts =&gt; currentProducts.map(product =&gt; {<br/>            if (product.id === productId) {<br/>                return {...product, selectedColor: color}<br/>            }<br/>            return product<br/>        }));<br/>    }<br/><br/>    return (<br/>        &lt;div className="cards"&gt;<br/>            {<br/>                addedProductToCart ?<br/>                &lt;div className="card-added"&gt;<br/>                {addedProductToCart.selectedColor} {addedProductToCart.name} is added to cart<br/>                &lt;/div&gt; : null<br/>            }<br/>            {<br/>                products.map(product =&gt; (<br/>                    &lt;div key={product.id} className="card"&gt;<br/>                      &lt;h3&gt;{product.name}&lt;/h3&gt;<br/>                      &lt;p&gt;{product.description}&lt;/p&gt;<br/>                      &lt;p&gt;{product.price}&lt;/p&gt;<br/>                      &lt;p className="quantity"&gt;<br/>                      &lt;button onClick={() =&gt; addToCart(product.id)} className="cart-btn"&gt;<br/>                      Add To Cart<br/>                      &lt;/button&gt;                   <br/>                      &lt;span <br/>                        onClick={() =&gt; handleColor("crimson", product.id)} <br/>                        className="select-color crimson"&gt;+&lt;/span&gt;<br/>                      &lt;span <br/>                        onClick={() =&gt; handleColor("green", product.id)} <br/>                        className="select-color green"&gt;+&lt;/span&gt;<br/>                      &lt;span <br/>                        onClick={() =&gt; handleColor("violet", product.id)} <br/>                        className="select-color violet"&gt;+&lt;/span&gt;<br/>                      &lt;span <br/>                        onClick={() =&gt; handleColor("black", product.id)} <br/>                        className="select-color black"&gt;+&lt;/span&gt;<br/>                      &lt;/p&gt;<br/>                    &lt;/div&gt;<br/>                ))<br/>            }<br/>        &lt;/div&gt;<br/>    );<br/>};<br/><br/>export default DeriveState;</span></pre><p id="625a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">输出</strong></p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/a54bb99501b0b40d6ab9ba1f95632fbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uoTy6bEZK9yT5hWfuuNaJQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk">The UI of Derive state component</figcaption></figure><p id="39f7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们可以在页面上看到所选的颜色。我们还删除了所选产品的副本，只存储了它的id。</p><p id="0eff" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感谢您读到这里。我希望现在你已经理解了React developer在使用useState钩子时经常犯的错误。并且你已经准备好在你的下一个项目中避免这些错误。</p><h2 id="db3d" class="nb ku in bd kv nc nd dn kz ne nf dp ld kg ng nh lh kk ni nj ll ko nk nl lp nm bi translated">如果你想要更多这样的内容，请在<a class="ae my" href="https://rajeshi.medium.com" rel="noopener">媒体</a>上关注我，并订阅我的<a class="ae my" href="https://www.youtube.com/channel/UCgfW-cxlW7NlpbOscKJYkfA" rel="noopener ugc nofollow" target="_blank"> YouTube频道</a></h2><p id="4e6b" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">有疑问吗？通过<a class="ae my" href="https://twitter.com/izrajesh" rel="noopener ugc nofollow" target="_blank">推特</a>联系我</p><h2 id="8805" class="nb ku in bd kv nc nd dn kz ne nf dp ld kg ng nh lh kk ni nj ll ko nk nl lp nm bi translated">更多内容请访问<a class="ae my" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> PlainEnglish.io </a>。</h2><p id="8f48" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">报名参加我们的<a class="ae my" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">免费每周简讯</strong> </a>。关注我们<a class="ae my" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">推特</strong> </a>，<a class="ae my" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io">LinkedIn</strong></a><strong class="jx io">，</strong><a class="ae my" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="jx io">YouTube</strong></a><strong class="jx io">，以及</strong> <a class="ae my" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">不和谐</strong> </a> <strong class="jx io">。</strong></p><h2 id="3e9e" class="nb ku in bd kv nc nd dn kz ne nf dp ld kg ng nh lh kk ni nj ll ko nk nl lp nm bi translated">对扩展您的软件启动感兴趣吗？检查<a class="ae my" href="https://circuit.ooo/?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank">电路</a>。</h2><p id="77b0" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我们提供免费的专家建议和定制解决方案，帮助您建立对您的技术产品或服务的认知和采用。</p></div></div>    
</body>
</html>