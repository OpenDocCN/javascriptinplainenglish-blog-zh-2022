<html>
<head>
<title>How to Schedule and Run Recurring Cron Jobs in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Node.js中调度和运行重复的Cron作业</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-schedule-and-run-recurring-cron-jobs-in-node-js-91d679868179?source=collection_archive---------10-----------------------#2022-08-02">https://javascript.plainenglish.io/how-to-schedule-and-run-recurring-cron-jobs-in-node-js-91d679868179?source=collection_archive---------10-----------------------#2022-08-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="3939" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">Cron作业用于创建以特定时间间隔运行的脚本。让我们看看它们在Node.js中是如何工作的</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/4efe13084e78ba29bba25abd71b96499.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F2z9oAOQTa9xUtbzTgyffw.png"/></div></div></figure><p id="6a36" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这是编程中的一个常见要求，必须设置某些东西以特定的时间间隔运行。例如，您可能希望每30分钟处理一次数据库，或者您可能希望每周发送一次电子邮件。我们通常的做法是使用cron jobs。在Node.js中，我们还可以设置cron作业以特定的时间间隔运行。让我们看看它是如何工作的。</p><h1 id="37ca" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">Cron作业如何在Node.js中工作</h1><p id="460d" class="pw-post-body-paragraph ko kp in kq b kr mc jo kt ku md jr kw kx me kz la lb mf ld le lf mg lh li lj ig bi translated">在Node.js中创建cron作业的最佳方式是使用名为<code class="fe mh mi mj mk b">node-schedule</code>的包。确保安装了Node.js，然后在项目文件夹中运行以下命令来安装它:</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="efc8" class="mp ll in mk b gy mq mr l ms mt">npm i node-schedule</span></pre><p id="90b6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe mh mi mj mk b">node-schedule</code>基本上允许我们使用<code class="fe mh mi mj mk b">cron</code>格式的时间来设置重复性工作。<code class="fe mh mi mj mk b">cron</code>格式是JavaScript中的一组6个字符，每个字符代表一个不同的时间元素。我们也可以使用星号作为通配符。格式的顺序如下所示:</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="58f6" class="mp ll in mk b gy mq mr l ms mt">*    *    *    *    *    *<br/>┬    ┬    ┬    ┬    ┬    ┬<br/>│    │    │    │    │    │<br/>│    │    │    │    │    └ day of week (0 - 7) (0 or 7 is Sun)<br/>│    │    │    │    └───── month (1 - 12)<br/>│    │    │    └────────── day of month (1 - 31)<br/>│    │    └─────────────── hour (0 - 23)<br/>│    └──────────────────── minute (0 - 59)<br/>└───────────────────────── second (0 - 59, OPTIONAL)</span></pre><p id="842b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">理解<code class="fe mh mi mj mk b">cron</code>格式最简单的方法是，如果我们给出最基本的格式，即<code class="fe mh mi mj mk b">* * * * *</code>，它被翻译成含义为<code class="fe mh mi mj mk b">every month</code>的<code class="fe mh mi mj mk b">every day of the week</code>或<code class="fe mh mi mj mk b">every day of month</code>的<code class="fe mh mi mj mk b">every hour</code>或<code class="fe mh mi mj mk b">every minute</code>的<code class="fe mh mi mj mk b">every second</code>。所以本质上，<code class="fe mh mi mj mk b">* * * * *</code>在<code class="fe mh mi mj mk b">node-schedule</code>中每秒都在运行。</p><p id="2b54" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果我们开始定义数字而不是星星，那么我们就可以开始限制事情发生的频率。例如，<code class="fe mh mi mj mk b">00 30 10 * * 1</code>将定义一个作业，当小时为<strong class="kq io"> 10 </strong>分钟为<strong class="kq io"> 30 </strong>秒钟为<strong class="kq io"> 00 </strong>时，该作业在每月<strong class="kq io">的<strong class="kq io">一周的第一天</strong>运行</strong>在每月的每<strong class="kq io">天运行。</strong></p><p id="9e0d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">因此，基本上该作业将在每周一上午10:30运行。</p><h1 id="32c3" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">Cron作业中使用的其他符号</h1><p id="ccc8" class="pw-post-body-paragraph ko kp in kq b kr mc jo kt ku md jr kw kx me kz la lb mf ld le lf mg lh li lj ig bi translated">我们还可以在cron jobs中使用其他一些符号，当您第一次看到它们时，可能会感到困惑。</p><ul class=""><li id="5b3b" class="mu mv in kq b kr ks ku kv kx mw lb mx lf my lj mz na nb nc bi translated">破折号(<code class="fe mh mi mj mk b">-</code> ) -可以用来表示一个范围，例如<code class="fe mh mi mj mk b">2-5</code>表示<code class="fe mh mi mj mk b">2,3,4,5</code>。<strong class="kq io">举例</strong> : <code class="fe mh mi mj mk b">00 30 10 * * 1-4</code>。</li><li id="9344" class="mu mv in kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">问号(<code class="fe mh mi mj mk b">?</code>)——可以用在一周的<strong class="kq io">天</strong>或一月的<strong class="kq io">天</strong>中，如果一个都不重要的话。例如，如果我们希望某个东西在一个月中的某一天触发，但是我们不在乎那天是星期几——那么我们将星期几设置为T1。<strong class="kq io">举例</strong> : <code class="fe mh mi mj mk b">00 30 10 * * ?</code>。</li><li id="3cb9" class="mu mv in kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">正斜杠(<code class="fe mh mi mj mk b">/</code> ) -用于定义系列。例如，给<code class="fe mh mi mj mk b">*/5</code>一个小时的值代表<code class="fe mh mi mj mk b">0,5,10,15,20</code>。如果您给定一个数字作为第一个参数，它将定义起始数字。即小时字段中的<code class="fe mh mi mj mk b">2/5</code>代表<code class="fe mh mi mj mk b">2,7,12,17,22</code>。<strong class="kq io">举例</strong> : <code class="fe mh mi mj mk b">00 30 */5 * * 1</code>。</li><li id="9637" class="mu mv in kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">逗号(<code class="fe mh mi mj mk b">,</code> ) -表示一系列数字，即<code class="fe mh mi mj mk b">2,3,5,7</code>。<strong class="kq io">举例</strong> : <code class="fe mh mi mj mk b">00 30 5 * 4,5,6 1</code>。</li></ul><h1 id="8bdd" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">在Node.js中设置cron作业</h1><p id="5531" class="pw-post-body-paragraph ko kp in kq b kr mc jo kt ku md jr kw kx me kz la lb mf ld le lf mg lh li lj ig bi translated">既然我们对如何格式化cron作业有了一些了解，那么让我们看看如何创建一个。假设我们想使用前面的例子，创建一个cron作业，在每周一上午10:30运行。我们将使用的格式是<code class="fe mh mi mj mk b">00 30 10 * * 1</code>。在您的项目中创建一个名为<code class="fe mh mi mj mk b">scheduler.js</code>的文件，并将以下代码放入其中:</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="05f3" class="mp ll in mk b gy mq mr l ms mt">import schedule from 'node-schedule'<br/>schedule.scheduleJob('00 30 10 * * 1', async function() {<br/>    // This will run every Monday at 10:30;<br/>    console.log('hey!');<br/>});</span></pre><p id="ec21" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">以上<code class="fe mh mi mj mk b">function() ...</code>中的任何内容将在每周一上午10:30运行。这种情况下，<code class="fe mh mi mj mk b">console.log('hey!')</code>。要启动该脚本，您可以直接从命令行运行它，如下所示:</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="fa0f" class="mp ll in mk b gy mq mr l ms mt">node scheduler.js</span></pre><p id="7b49" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在我们的作业将在星期一的任何时候运行，时间是上午10:30。</p><h1 id="478e" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">在Node.js中持续运行cron作业</h1><p id="6c23" class="pw-post-body-paragraph ko kp in kq b kr mc jo kt ku md jr kw kx me kz la lb mf ld le lf mg lh li lj ig bi translated">这段代码很好，但是它意味着您必须保持您的<code class="fe mh mi mj mk b">node scheduler.js</code>会话活动。如果您想在后台运行这样的cron作业而不必担心它，最好使用<code class="fe mh mi mj mk b">pm2</code>来保持它持续运行。<code class="fe mh mi mj mk b">pm2</code>启动Node.js程序，并让它保持运行，这样你就不用担心了。您可以在终端中安装<code class="fe mh mi mj mk b">pm2</code>,如下所示:</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="a251" class="mp ll in mk b gy mq mr l ms mt">npm install pm2 -g</span></pre><p id="a89c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">然后，要运行您的<code class="fe mh mi mj mk b">scheduler.js</code>文件并保持它持久运行，请在终端中运行以下命令:</p><pre class="kd ke kf kg gt ml mk mm mn aw mo bi"><span id="cef6" class="mp ll in mk b gy mq mr l ms mt">pm2 start scheduler.js</span></pre><p id="ab1a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在我们的<code class="fe mh mi mj mk b">scheduler.js</code>文件正在后台运行，将在每周一上午10:30启动——所以你不必担心。</p><h1 id="06a4" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">结论</h1><p id="d874" class="pw-post-body-paragraph ko kp in kq b kr mc jo kt ku md jr kw kx me kz la lb mf ld le lf mg lh li lj ig bi translated">Cron作业需求一直都在出现，因此在Node.js中拥有这一功能非常有用。Cron作业可以用来做很多事情，比如整理文件结构、发送电子邮件或定期处理大量数据。我希望你喜欢这个指南。<a class="ae ni" href="https://fjolt.com/" rel="noopener ugc nofollow" target="_blank">点击此处</a>了解更多网络技巧。</p></div><div class="ab cl nj nk hr nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ig ih ii ij ik"><p id="0a79" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="nq">更多内容看</em> <a class="ae ni" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="nq">说白了。报名参加我们的</em> <a class="ae ni" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="nq">免费周报</em> </strong> </a> <em class="nq">。关注我们关于</em><a class="ae ni" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="nq">Twitter</em></strong></a><em class="nq">和</em><a class="ae ni" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="nq">LinkedIn</em></strong></a><em class="nq">。查看我们的</em> <a class="ae ni" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="nq">社区不和谐</em> </strong> </a> <em class="nq">，加入我们的</em> <a class="ae ni" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="nq">人才集体</em> </strong> </a> <em class="nq">。</em></strong></a></p></div></div>    
</body>
</html>