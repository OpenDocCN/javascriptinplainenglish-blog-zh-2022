<html>
<head>
<title>Small but Useful Habits to maintain a Node.js app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">维护Node.js应用程序的小而有用的习惯</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/small-but-useful-habits-on-a-node-js-app-9c87d37786c0?source=collection_archive---------10-----------------------#2022-04-29">https://javascript.plainenglish.io/small-but-useful-habits-on-a-node-js-app-9c87d37786c0?source=collection_archive---------10-----------------------#2022-04-29</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><p id="19c6" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">找到好的资源从头创建一个应用程序相对容易，但如何随着时间的推移维护它则完全是另一回事。我觉得它需要两样东西:一个这样做的真诚愿望，和一些帮助我们的工具。</p><p id="3ab8" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">过时的依赖和意大利面条陷阱是我将要提到的两个例子。</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj km"><img src="../Images/59ec471e589362fcf0750710a181c8ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lzo_rGp3cn0rSzFJvaRkJw.jpeg"/></div></div><figcaption class="ky kz gk gi gj la lb bd b be z dk">Photo by <a class="ae lc" href="https://unsplash.com/@nmsilva" rel="noopener ugc nofollow" target="_blank">Nuno Silva</a></figcaption></figure><h1 id="948d" class="ld le ir bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">npm已过时</h1><p id="e98f" class="pw-post-body-paragraph jo jp ir jq b jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh mf kj kk kl ik bi translated">(或<code class="fe mg mh mi mj b">yarn outdated</code>或<code class="fe mg mh mi mj b">pnpm outdated</code>)</p><p id="e9af" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">👉找出你过时的依赖。</p><p id="d751" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">可能是我用的最多的一个。</p><blockquote class="mk ml mm"><p id="3c9b" class="jo jp mn jq b jr js jt ju jv jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk kl ik bi translated"><em class="ir">我确信保持依赖关系最新是我们工作</em>  <em class="ir">的一部分。没有人会要求你这么做，但是作为一个开发者，这属于“你签署的隐含的东西”。</em></p></blockquote><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj mr"><img src="../Images/236e6afebf9a5e098b5d41ab396075a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xcuWValYaaAkbApSN1cyKw.png"/></div></div><figcaption class="ky kz gk gi gj la lb bd b be z dk">Exemple of output, with all three possibilities: new major / minor / patch versions.</figcaption></figure><p id="95b2" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">现在你可以转到你的<code class="fe mg mh mi mj b">package.json</code>文件，删除任何你想要的依赖项，然后重新运行<code class="fe mg mh mi mj b">npm install</code>。或者:</p><h1 id="d23d" class="ld le ir bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">NPM-检查-更新</h1><p id="ed04" class="pw-post-body-paragraph jo jp ir jq b jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh mf kj kk kl ik bi translated">👉轻松删除依赖组。</p><p id="dd4f" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">Github回购:<a class="ae lc" href="https://github.com/raineorshine/npm-check-updates" rel="noopener ugc nofollow" target="_blank">https://github.com/raineorshine/npm-check-updates</a></p><p id="581a" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我有一个脚本示例:</p><pre class="kn ko kp kq gu ms mj mt mu aw mv bi"><span id="dbab" class="mw le ir mj b gz mx my l mz na">// package.json</span><span id="6b5b" class="mw le ir mj b gz nb my l mz na">{<br/>  "name": "my-node-api",<br/>  "scripts": {<br/>    "bump-to-patch-versions": "npx npm-check-updates -u --target patch"<br/>  }<br/>}</span></pre><p id="1459" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">以上面的截图为例，假设我可以将<code class="fe mg mh mi mj b">dayjs</code>升级到新的补丁版本(<code class="fe mg mh mi mj b">v1.1.11</code>)，运行下面的命令会自动为你完成:</p><pre class="kn ko kp kq gu ms mj mt mu aw mv bi"><span id="ca42" class="mw le ir mj b gz mx my l mz na">&gt; npm run bump-to-patch-versions</span></pre><p id="b894" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">还有其他一些依赖关系:</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj nc"><img src="../Images/23c852dc7ce49161752da418846d487e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0EjDReLvfFg0nFHiV3qEkA.png"/></div></div><figcaption class="ky kz gk gi gj la lb bd b be z dk">Packages still at a 0.x version are marked in red.</figcaption></figure><p id="aa2e" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">还是关于保持最新的话题，值得看看像<a class="ae lc" href="https://github.blog/2022-02-08-improving-developer-experience-dependabot-alerts/" rel="noopener ugc nofollow" target="_blank">依赖机器人</a>或<a class="ae lc" href="https://github.com/renovatebot/renovate" rel="noopener ugc nofollow" target="_blank">翻新</a>这样的机器人。</p><h1 id="063f" class="ld le ir bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">npm审计</h1><p id="1b41" class="pw-post-body-paragraph jo jp ir jq b jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh mf kj kk kl ik bi translated">👉意识到可能的安全漏洞。</p><p id="a728" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">这是一个很好的实践，不时运行。当您对该命令有信心时，您甚至可以将其作为CI工作流中的一个新步骤。</p><p id="2d7c" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">输出示例:</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj nd"><img src="../Images/966ade049e220dccdd70142a8591ed8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*40FV7RBijN80twaapskiPg.png"/></div></div></figure><p id="3cc3" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">这个易受攻击的“jake”包是什么，为什么我的node_modules中有它？快速<code class="fe mg mh mi mj b">npm why jake</code>可以有所帮助。</p><p id="0e2d" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">这里的“jake”似乎是我实际使用的“vite-plugin-pwa”的依赖项:</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj nd"><img src="../Images/4e8ad5f449231bb5d7cfc9a1c27e9895.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VkJLqCRqH7ftActCvmViCQ.png"/></div></div></figure><p id="f761" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我们很幸运，对于这一个，我们可以运行<code class="fe mg mh mi mj b">npm audit fix</code>让npm在你的package-lock.json中增加一些版本。(这并不妨碍我们检查已经做了什么，并寻找可能的回归！)</p><h1 id="029e" class="ld le ir bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">从属巡洋舰</h1><p id="13ab" class="pw-post-body-paragraph jo jp ir jq b jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh mf kj kk kl ik bi translated">👉可视化模块之间的依赖关系。</p><p id="468f" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">Github回购:<a class="ae lc" href="https://github.com/sverweij/dependency-cruiser" rel="noopener ugc nofollow" target="_blank">https://github.com/sverweij/dependency-cruiser</a></p><p id="81cf" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">将你的代码分成不同的模块通常被认为是一个好的实践，并且<strong class="jq is">保持模块之间相对独立</strong>。</p><p id="0fd2" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我将选择一个模块(蓝色)并查看它的依赖项(黄色和橙色):</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj ne"><img src="../Images/160af38d61210079fd60f945f5dbf2a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3x8A3BYiQyd94l4ZpjUxTQ.png"/></div></div></figure><p id="aaac" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">现在，我可以问自己，这个“bankAccount”模块取决于另外两个模块:“transactions”和“bankSync”。嗯，可能不是，所以我可能想清除这些依赖，组织不同的代码，等等。</p><p id="3c46" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我用来生成此图的完整脚本:</p><pre class="kn ko kp kq gu ms mj mt mu aw mv bi"><span id="d0a3" class="mw le ir mj b gz mx my l mz na">depcruise \<br/>  -x "(^node_modules|__tests__|logger.ts|errors.ts)" \<br/>  --focus "^src/modules/bankAccount" \<br/>  --ts-config ./tsconfig.json \<br/>  --output-type dot \<br/>  'src/modules' | dot -T svg &gt; dependencygraph.svg</span></pre><p id="1203" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">为了更进一步，我知道可以根据你所在的文件设置一些特定的<strong class="jq is"> ESLint规则</strong>来限制导入模式，也许用<a class="ae lc" href="https://eslint.org/docs/rules/no-restricted-imports" rel="noopener ugc nofollow" target="_blank">https://eslint.org/docs/rules/no-restricted-imports</a>(我还没试过)。</p><h1 id="691e" class="ld le ir bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">jscpd</h1><p id="06fb" class="pw-post-body-paragraph jo jp ir jq b jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh mf kj kk kl ik bi translated">👉找到重复的代码片段。</p><p id="f284" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">Github回购:<a class="ae lc" href="https://github.com/kucherenko/jscpd" rel="noopener ugc nofollow" target="_blank">https://github.com/kucherenko/jscpd</a></p><pre class="kn ko kp kq gu ms mj nf bn ng nh bi"><span id="2519" class="ni le ir mj b be nj nk l nl na">npm install -D jscpd</span></pre><p id="c036" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我有一个脚本示例:</p><pre class="kn ko kp kq gu ms mj nf bn ng nh bi"><span id="b1dd" class="ni le ir mj b be nj nk l nl na">// package.json<br/>{<br/>  "name": "my-node-api",<br/>  "scripts": {<br/>    "jscpd": "jscpd --ignore \"src/testUtils/*,**/__tests__/*.ts\" src"<br/>  }<br/>}</span></pre><p id="96e1" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">如果你没有我这么幸运，你可能会得到一些结果，形式是:</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj nm"><img src="../Images/110b2975ee1a4b5c928a65147486d6fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CO_0R4sA7zIHDbJqyHLs4Q.png"/></div></div></figure><p id="b42c" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">结尾有一个总结:</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj nn"><img src="../Images/6b1cd99e5d3b045bddffb031eef953d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bCv4OKsQQy7l9gMv6zWZcw.png"/></div></div></figure><p id="f08c" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我并不是暗示所有的重复都是不好的，事实上，他们中的一些被团队认可和接受。然而，有时它们是无意的，是由于编码或审查过程中的疏忽造成的。这就是<code class="fe mg mh mi mj b">jscpd</code>发挥作用的地方👍</p><h1 id="23ac" class="ld le ir bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">ts-未使用-出口</h1><p id="7187" class="pw-post-body-paragraph jo jp ir jq b jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh mf kj kk kl ik bi translated">👉发现未使用的出口。<br/> <em class="mn">(如果使用TypeScript) </em></p><p id="2387" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">Github回购:<a class="ae lc" href="https://github.com/pzavolinsky/ts-unused-exports" rel="noopener ugc nofollow" target="_blank">https://github.com/pzavolinsky/ts-unused-exports</a></p><p id="db59" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我有一个脚本示例:</p><pre class="kn ko kp kq gu ms mj mt mu aw mv bi"><span id="6a03" class="mw le ir mj b gz mx my l mz na">// package.json</span><span id="0470" class="mw le ir mj b gz nb my l mz na">{<br/>  "name": "my-node-api",<br/>  "scripts": {<br/>    "find-unused-exports": "ts-unused-exports ./tsconfig.json --excludeDeclarationFiles"<br/>  }<br/>}</span></pre><p id="bd23" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">输出示例:</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj no"><img src="../Images/b647926802538ce3ad6ce821489918ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_bG5ciruFWLbU0SoL1i5Tw.png"/></div></div></figure><p id="8f90" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">这并不多，但当我每月运行一次时，我通常会发现2-3个文件值得一看！</p><p id="9ad2" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">另一个回购协议似乎也是如此:<a class="ae lc" href="https://github.com/nadeesha/ts-prune" rel="noopener ugc nofollow" target="_blank">https://github.com/nadeesha/ts-prune</a></p></div><div class="ab cl np nq hv nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ik il im in io"><p id="69eb" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">今天到此为止，很可能还有很多类似的快速提示，我可能会在未来更新这篇文章！</p><p id="3bf3" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">感谢阅读我的文章。:)</p><p id="faaf" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><em class="mn">更多内容请看</em><a class="ae lc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jq is"><em class="mn">plain English . io</em></strong></a><em class="mn">。报名参加我们的</em> <a class="ae lc" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jq is"> <em class="mn">免费周报</em> </strong> </a> <em class="mn">。关注我们关于</em><a class="ae lc" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jq is"><em class="mn">Twitter</em></strong></a><em class="mn">和</em><a class="ae lc" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jq is"><em class="mn">LinkedIn</em></strong></a><em class="mn">。加入我们的</em> <a class="ae lc" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jq is"> <em class="mn">社区不和谐</em> </strong> </a> <em class="mn">。</em></p></div></div>    
</body>
</html>