<html>
<head>
<title>How to Monitor Errors in a Web App?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何监控Web应用程序中的错误？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-monitor-errors-in-a-web-app-f14ff18f5ac3?source=collection_archive---------9-----------------------#2022-05-18">https://javascript.plainenglish.io/how-to-monitor-errors-in-a-web-app-f14ff18f5ac3?source=collection_archive---------9-----------------------#2022-05-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f415" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">错误监控是一剂良药</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/05d5b352573fe408f84dd8ef5361b228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ui3IWCiNLVkzDyQJ"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@dav420?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">David Pupaza</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e2f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们编写的web应用程序出现错误时，我们需要一些措施来报告这些错误。但是浏览器并没有统一的API来监控所有的错误，所以本文将为大家介绍几种常见的错误监控方法。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="35bb" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">试着…接住</h1><p id="e139" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated"><code class="fe mw mx my mz b">try...catch</code>语句标记了一个<code class="fe mw mx my mz b">try</code>块和一个<code class="fe mw mx my mz b">catch</code>块。如果<code class="fe mw mx my mz b">try</code>块中的代码抛出异常，那么<code class="fe mw mx my mz b">catch</code>块中的代码将被执行。</p><p id="594b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是它只能捕捉同步运行时错误。<strong class="ky ir">语法错误和非等待异步错误不会被捕获。</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><h1 id="177c" class="lz ma iq bd mb mc nc me mf mg nd mi mj jw ne jx ml jz nf ka mn kc ng kd mp mq bi translated">window.onerror</h1><p id="36d9" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated"><code class="fe mw mx my mz b">window.onerror</code>只能捕捉那些JavaScript运行时错误，除了那些发生在Promises中的错误。这是一个非常老的API，可以在IE环境中使用。</p><p id="20e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是它的语法:</p><pre class="kg kh ki kj gt nh mz ni nj aw nk bi"><span id="baf9" class="nl ma iq mz b gy nm nn l no np">window.onerror = function(message, source, lineno, colno, error) {}</span></pre><ul class=""><li id="c832" class="nq nr iq ky b kz la lc ld lf ns lj nt ln nu lr nv nw nx ny bi translated"><code class="fe mw mx my mz b">message</code>:错误信息(字符串)。可作为<code class="fe mw mx my mz b">event</code>(原文如此！)在HTML <code class="fe mw mx my mz b">onerror=""</code>处理程序中。</li><li id="7c04" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated"><code class="fe mw mx my mz b">source</code>:引发错误的脚本的URL(字符串)</li><li id="12d9" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated"><code class="fe mw mx my mz b">lineno</code>:出现错误的行号(数字)</li><li id="2cdf" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated"><code class="fe mw mx my mz b">colno</code>:发生错误的行的列号(数字)</li><li id="20c2" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated"><code class="fe mw mx my mz b">error</code> : <a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" rel="noopener ugc nofollow" target="_blank">错误对象</a>(对象)。如果没有相应的错误对象，可能是<code class="fe mw mx my mz b">null</code>。</li></ul><p id="3c26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当该函数返回true时，默认事件处理程序将被阻止触发，并且不会向控制台输出任何错误。</p><h1 id="030d" class="lz ma iq bd mb mc nc me mf mg nd mi mj jw ne jx ml jz nf ka mn kc ng kd mp mq bi translated">window.addEventListener('error ')</h1><p id="cd20" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated"><code class="fe mw mx my mz b">window.addEventListener</code>不仅可以捕获<code class="fe mw mx my mz b">window.onerror</code>的错误，还可以捕获网络请求错误或资源(如<code class="fe mw mx my mz b"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img" rel="noopener ugc nofollow" target="_blank">&lt;img&gt;</a></code>或<code class="fe mw mx my mz b"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script" rel="noopener ugc nofollow" target="_blank">&lt;script&gt;</a></code>)加载错误。</p><p id="6f25" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是由于来自网络请求和资源加载的错误不会冒泡，因此需要在捕获阶段对它们进行监控。即<code class="fe mw mx my mz b"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#parameters" rel="noopener ugc nofollow" target="_blank">addEventListener</a></code>的第三个参数需要设置为true。</p><p id="0786" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">比如下面这个简单的例子:</p><pre class="kg kh ki kj gt nh mz ni nj aw nk bi"><span id="993f" class="nl ma iq mz b gy nm nn l no np">&lt;img /&gt;<br/>&lt;script&gt;<br/>  window.addEventListener(<br/>    'error',<br/>    (error) =&gt; {<br/>      // Event {isTrusted: true, type: 'error', target: img, …}<br/>      console.log('error: ', error);<br/>    },<br/>    <strong class="mz ir">true</strong><br/>  );</span><span id="4f21" class="nl ma iq mz b gy oe nn l no np">document.querySelector('img').src = '/test.png';<br/>&lt;/script&gt;</span></pre><h1 id="cad0" class="lz ma iq bd mb mc nc me mf mg nd mi mj jw ne jx ml jz nf ka mn kc ng kd mp mq bi translated">element.onerror</h1><p id="9734" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">对于特定的元素，我们也可以绑定一个<code class="fe mw mx my mz b">onerror</code>处理程序。</p><p id="6197" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是一个简单的例子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="b3f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以看到这两个错误的<code class="fe mw mx my mz b">currentTarget</code>是不同的。</p><h1 id="4bf2" class="lz ma iq bd mb mc nc me mf mg nd mi mj jw ne jx ml jz nf ka mn kc ng kd mp mq bi translated">window . addevent listener(' unhandled rejection ')</h1><p id="5950" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">尽管您可以为每个承诺配置<code class="fe mw mx my mz b">.catch</code>或错误处理回调，但总有您错过的时候。那么我们需要一个统一的方法来捕捉承诺错误。</p><p id="d65d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的方法都不能捕获Promise错误。浏览器为我们提供了<code class="fe mw mx my mz b">unhandledrejection</code>事件来捕捉承诺中出现的错误。</p><p id="819d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是它的语法:</p><pre class="kg kh ki kj gt nh mz ni nj aw nk bi"><span id="be0b" class="nl ma iq mz b gy nm nn l no np">window.addEventListener('unhandledrejection', (event) =&gt; {<br/>  const { promise, reason } = event;<br/>});</span></pre><p id="c259" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意回调中的<code class="fe mw mx my mz b"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/PromiseRejectionEvent" rel="noopener ugc nofollow" target="_blank">event</a></code>，它有以下两个属性:</p><ul class=""><li id="9037" class="nq nr iq ky b kz la lc ld lf ns lj nt ln nu lr nv nw nx ny bi translated"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/PromiseRejectionEvent/promise" rel="noopener ugc nofollow" target="_blank">承诺</a>:被拒绝的JavaScript <code class="fe mw mx my mz b"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" rel="noopener ugc nofollow" target="_blank">Promise</a></code>。</li><li id="e503" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/PromiseRejectionEvent/reason" rel="noopener ugc nofollow" target="_blank">原因</a>:表示承诺被拒绝原因的值或<code class="fe mw mx my mz b"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" rel="noopener ugc nofollow" target="_blank">Object</a></code>，传递给<code class="fe mw mx my mz b"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/reject" rel="noopener ugc nofollow" target="_blank">Promise.reject()</a></code>。</li></ul><p id="a113" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当你不希望这种错误输出到控制台时，那么你可以在回调里面调用<code class="fe mw mx my mz b">event.preventDefault();</code>。</p><p id="e01c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是一个简单的例子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><h1 id="c402" class="lz ma iq bd mb mc nc me mf mg nd mi mj jw ne jx ml jz nf ka mn kc ng kd mp mq bi translated">结论</h1><p id="a116" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">为了达到预期的效果，可能需要结合使用上述几种错误捕获方法。但是<code class="fe mw mx my mz b">window.addEventListener('error')</code>包含了<code class="fe mw mx my mz b">window.onerror</code>可以捕捉的错误，建议先用前者。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="77f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">今天就到这里。我是Zachary，我将继续输出与web开发相关的故事。如果你喜欢这样的故事，想支持我，请考虑成为 <a class="ae kv" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="of">中等会员</em> </a> <em class="of">。每月5美元，你可以无限制地访问媒体内容。如果你通过</em> <a class="ae kv" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="of">我的链接</em> </a> <em class="of">报名，我会得到一点佣金。</em></p><p id="9ba1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你的支持对我来说非常重要——谢谢。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="437d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="of">更多内容请看</em> <a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="of">说白了就是</em> </strong> </a> <em class="of">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="of">免费每周简讯</em> </strong> </a> <em class="of">。关注我们</em> <a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="of">推特</em> </strong> </a> <em class="of">和</em><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="of">LinkedIn</em></strong></a><em class="of">。查看我们的</em> <a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="of">社区不和谐</em> </strong> </a> <em class="of">加入我们的</em> <a class="ae kv" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="of">人才集体</em> </strong> </a> <em class="of">。</em></p></div></div>    
</body>
</html>