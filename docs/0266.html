<html>
<head>
<title>Use Session Storage to Persist State within a React Component</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用会话存储来保持React组件中的状态</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/use-session-storage-to-persist-state-within-a-react-component-206867ef2269?source=collection_archive---------0-----------------------#2022-01-16">https://javascript.plainenglish.io/use-session-storage-to-persist-state-within-a-react-component-206867ef2269?source=collection_archive---------0-----------------------#2022-01-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="4ece" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当页面会话结束时，sessionStorage中的数据将被清除。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/246788371fc21ab2de34f57f01271382.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PQwsfRxoie48IATC"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@lautaroandreani?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Lautaro Andreani</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="347e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我正在做的项目中，我创建了一个小小的React组件横幅。它包含一个图标、一些文本、一些不同的背景颜色和一个关闭按钮(🌱下面我就简化一下例子)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi kz"><img src="../Images/7340d7a8151e8b5166431aa51b624f73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vnx-nKKjEaWC5YKPAJL22Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">A simple Banner component with a close button</figcaption></figure><p id="c3b7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如上所述，这个横幅组件非常简单。但是，我发现在点击<strong class="jm io">关闭按钮</strong>“x”并刷新页面后，虽然不应该，但是横幅又重新出现了！💥</p><p id="3dfb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">好了，现在的重点是防止这种行为。我想到了用一个<strong class="jm io">简单流行的React解决方案</strong>带原生<strong class="jm io">本地存储</strong>或者<strong class="jm io">会话存储</strong>来持久化这个外观状态。✂️</p></div><div class="ab cl la lb hr lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ig ih ii ij ik"><p id="f613" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是这种情况下哪个更好呢？研究了一些资料来源后，我得出了结论。👇</p><p id="f8d4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">🌸<strong class="jm io"> sessionStorage </strong>访问当前原点的session Storage <strong class="jm io">对象</strong>，类似于<strong class="jm io"> localStorage，</strong>不同的是<strong class="jm io"> localStorage </strong>中的数据不会过期，而<strong class="jm io"> sessionStorage </strong>中的数据会在页面会话结束时被清空。</p><p id="fabc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我的例子中，我实际需要的是<strong class="jm io"> *sessionStorage* </strong>，因为除了一些值之外，没有重要的数据需要存储和检索。所以我做了这个👇(下面是简化的例子)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lh"><img src="../Images/ec52f39b347b9b369575b00c351e71c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*te2AVqqZS-Dg2dV5op4FZA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Banner Component with “appearance” state and “defaultValue” for sessionStorage</figcaption></figure><p id="348c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当然，下面的关闭按钮是这样的👇</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi li"><img src="../Images/3d92d41bbe72f6eb844fe049858640f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2AwRWt0qr9XkHrxxjgvU8g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Close button which sets sessionStorage item object with key “banner-info”</figcaption></figure><p id="9471" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">是的，在点击关闭按钮并检查应用程序后👇</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lj"><img src="../Images/a948233fbd36b07a588fc5f4a48590fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KOK14fwBU22c1GwluiXDqA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Session Storage Item object is created after button click</figcaption></figure><p id="7fd6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">之后，我用<strong class="jm io"> useEffect </strong>检查是否有会话存储对象值，如果有，那么<strong class="jm io">不要显示</strong>横幅，类似如下。👇</p><pre class="kj kk kl km gt lk ll lm ln aw lo bi"><span id="d752" class="lp lq in ll b gy lr ls l lt lu"><em class="lv">Object.values(defaultValue).every((value) =&gt; value !== “ ” &amp;&amp; setShow(false));</em></span></pre><p id="297a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">并渲染横幅:<code class="fe lw lx ly ll b"><em class="lv">{show &amp;&amp; &lt;Banner /&gt;}</em></code></p><p id="e1f1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi">🤔</p></div><div class="ab cl la lb hr lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ig ih ii ij ik"><p id="c27a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有用吗？是的，但那是d*，为什么？因为就像我说的，没有<strong class="jm io">重要的数据</strong>需要存储和检索，我所需要的只是决定<strong class="jm io">是否显示</strong>横幅<strong class="jm io"> 🦜 </strong>！<strong class="jm io">为什么要把那些没用的数据</strong>(详情，图标… ) <strong class="jm io">保存到会话存储？感谢我的同事。:)</strong></p><p id="ac8b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我所需要的就是使用一个布尔状态，并像下面这样更新它</p><pre class="kj kk kl km gt lk ll lm ln aw lo bi"><span id="f4d7" class="lp lq in ll b gy lr ls l lt lu"><strong class="ll io"><em class="lv">sessionStorage.setItem(“banner-info”, true)</em></strong></span></pre><p id="d190" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">并呈现如下👇</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/174053a1e25b1ef133e6466ed09ef37b.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*yVegARwVXKJ0DrBGm81-VQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Render <strong class="bd ma">nothing</strong> if the session storage value exists!</figcaption></figure><p id="1db1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">就是这样！移除了<strong class="jm io"> defaultValue </strong>状态，移除了<strong class="jm io"> useEffect，</strong>只需<strong class="jm io"> </strong>使用<strong class="jm io">真/假</strong>到<strong class="jm io"> </strong>保持那个外观状态🍭，甜美简单。</p></div><div class="ab cl la lb hr lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ig ih ii ij ik"><p id="2b5c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以上是一个简单的<strong class="jm io"> sessionStorage </strong>用法示例，希望它有趣且有用，如果你对我的其他文章感兴趣，这里有一些链接:🧚‍♂️</p><div class="mb mc gp gr md me"><a href="https://xiaominzhu.medium.com/hide-and-replace-sticky-element-on-scrolling-in-a-react-way-8bc3f04e2a81" rel="noopener follow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd io gy z fp mj fr fs mk fu fw im bi translated">以反应方式隐藏和替换滚动时的粘性元素</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">—棘手但有趣🍡</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">xiaominzhu.medium.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms ks me"/></div></div></a></div><div class="mb mc gp gr md me"><a href="https://xiaominzhu.medium.com/create-a-pagination-in-a-react-way-df5c6fe1e0c7" rel="noopener follow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd io gy z fp mj fr fs mk fu fw im bi translated">以反应方式创建分页</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">—一个漂亮的分页🧚‍♂️怎么样？</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">xiaominzhu.medium.com</p></div></div><div class="mn l"><div class="mt l mp mq mr mn ms ks me"/></div></div></a></div><div class="mb mc gp gr md me"><a href="https://xiaominzhu.medium.com/lets-play-with-hyperlinks-338d1be1f6d7" rel="noopener follow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd io gy z fp mj fr fs mk fu fw im bi translated">让我们玩超链接吧</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">—创建指向页面部分的链接很简单，但是如果您有一个固定的页眉呢？</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">xiaominzhu.medium.com</p></div></div><div class="mn l"><div class="mu l mp mq mr mn ms ks me"/></div></div></a></div><div class="mb mc gp gr md me"><a href="https://medium.com/geekculture/css-trick-add-colour-and-linear-gradient-to-a-background-image-2dd0fe6125a8" rel="noopener follow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd io gy z fp mj fr fs mk fu fw im bi translated">Css技巧:给背景图片添加颜色和线性渐变</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">—一个可以节省您时间的css技巧🦋</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">medium.com</p></div></div><div class="mn l"><div class="mv l mp mq mr mn ms ks me"/></div></div></a></div><div class="mb mc gp gr md me"><a rel="noopener  ugc nofollow" target="_blank" href="/prevent-validatedomnesting-button-descendant-error-21d9a34e5984"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd io gy z fp mj fr fs mk fu fw im bi translated">如何防止React中嵌套<button>后代错误</button></h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">你熟悉这个错误吗？💻</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="mn l"><div class="mw l mp mq mr mn ms ks me"/></div></div></a></div><div class="mb mc gp gr md me"><a href="https://medium.com/geekculture/prevent-line-breaks-with-css-68a9f066db60" rel="noopener follow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd io gy z fp mj fr fs mk fu fw im bi translated">用CSS防止换行</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">—reactcomponent🧚中的css技巧</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">medium.com</p></div></div><div class="mn l"><div class="mx l mp mq mr mn ms ks me"/></div></div></a></div><div class="mb mc gp gr md me"><a href="https://medium.com/geekculture/react-email-validation-with-dialog-overlay-472ee564d585" rel="noopener follow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd io gy z fp mj fr fs mk fu fw im bi translated">用对话框覆盖反应电子邮件验证</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">—电子邮件验证有时令人头疼，🧊</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">medium.com</p></div></div><div class="mn l"><div class="my l mp mq mr mn ms ks me"/></div></div></a></div><div class="mb mc gp gr md me"><a rel="noopener  ugc nofollow" target="_blank" href="/find-the-nearest-location-in-a-react-way-9ed51a999807"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd io gy z fp mj fr fs mk fu fw im bi translated">以反应的方式找到最近的位置</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">—️地理定位API</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="mn l"><div class="mz l mp mq mr mn ms ks me"/></div></div></a></div><div class="mb mc gp gr md me"><a rel="noopener  ugc nofollow" target="_blank" href="/sourcing-json-data-with-gatsby-source-filesystem-and-graphql-6fc7cef2a49e"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd io gy z fp mj fr fs mk fu fw im bi translated">用gatsby-source-filesystem和GraphQL获取JSON数据</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">学习盖茨比第二步</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="mn l"><div class="na l mp mq mr mn ms ks me"/></div></div></a></div><div class="mb mc gp gr md me"><a rel="noopener  ugc nofollow" target="_blank" href="/learn-by-doing-use-gatsby-to-create-your-first-site-af7bfb7a8a6f"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd io gy z fp mj fr fs mk fu fw im bi translated">边做边学——使用Gatsby创建您的第一个网站</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">一步一步来，是的。</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="mn l"><div class="nb l mp mq mr mn ms ks me"/></div></div></a></div><div class="mb mc gp gr md me"><a rel="noopener  ugc nofollow" target="_blank" href="/5-react-hook-libraries-you-could-use-d7f13066ebba"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd io gy z fp mj fr fs mk fu fw im bi translated">您可以使用的5个React钩子库</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">大三学生的建议——试一试。</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="mn l"><div class="na l mp mq mr mn ms ks me"/></div></div></a></div><div class="mb mc gp gr md me"><a rel="noopener  ugc nofollow" target="_blank" href="/from-music-to-web-development-my-junior-path-7421e0ddd65"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd io gy z fp mj fr fs mk fu fw im bi translated">从音乐到网络开发-我的道路</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">从一个交响乐团的音乐家到一个网页开发者。</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="mn l"><div class="nc l mp mq mr mn ms ks me"/></div></div></a></div><p id="4744" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lv">更多内容尽在</em> <a class="ae ky" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="lv">说白了. io </em> </strong> </a> <em class="lv">。报名参加我们的</em> <a class="ae ky" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="lv">免费周报</em> </strong> </a> <em class="lv">。在我们的</em> <a class="ae ky" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="lv">社区获得独家访问写作机会和建议</em> </strong> </a> <em class="lv">。</em></p></div></div>    
</body>
</html>