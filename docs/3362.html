<html>
<head>
<title>How to Fetch From an API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从API中提取</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-program-a-card-game-971bb69a7283?source=collection_archive---------15-----------------------#2022-08-22">https://javascript.plainenglish.io/how-to-program-a-card-game-971bb69a7283?source=collection_archive---------15-----------------------#2022-08-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="edfc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">应用程序编程接口(API)是两个应用程序相互通信的一种方式。每个API都有文档解释它能做什么以及如何使用它。有很多免费的公共API，其中一个就是这个<a class="ae ki" href="https://www.deckofcardsapi.com/" rel="noopener ugc nofollow" target="_blank">卡片组API </a>。</p><p id="7ba0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">开始任何纸牌游戏，我们需要得到一副牌，洗牌，并分发第一轮。根据API的文档，我们可以通过调用一个特定的URL来获得一副新牌并洗牌。它看起来像这样:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/a115b26bdb3bbb2c106e8d31832a6c70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GTWT3wzQwWhXQJ9BSV_m4g.png"/></div></div></figure><p id="f809" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe kv kw kx ky b"><a class="ae ki" href="https://developer.mozilla.org/en-US/docs/Web/API/fetch" rel="noopener ugc nofollow" target="_blank">fetch</a></code>命令开始从给定的URL获取数据的异步过程。异步进程是从当前函数中分离出来并独立运行的进程。这意味着在下一行代码运行之前，结果可能还没有准备好。为了处理这个问题，<code class="fe kv kw kx ky b">fetch</code>命令返回一个<code class="fe kv kw kx ky b">Promise</code>对象，这只是一个占位符，以便代码可以继续运行。一旦<code class="fe kv kw kx ky b">fetch</code>完成，它将用实际结果替换<code class="fe kv kw kx ky b">Promise</code>对象。</p><p id="6edd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从URL获取的数据将采用<a class="ae ki" href="https://www.w3schools.com/js/js_json_intro.asp" rel="noopener ugc nofollow" target="_blank"> JavaScript对象符号(JSON) </a>格式。这本质上是存储JavaScript对象的一种简化方式。为了在我们的代码中使用这些数据，我们需要使用<code class="fe kv kw kx ky b">.json</code>将它从JSON转换成普通的JavaScript:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/f160e0e38773e794f82f6714e613e64c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ku-YMk5INR5mgKa9W64qaw.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk"><em class="ld">Note: JavaScript will ignore the white space between the fetch command and the then call, so it is common to see it written with line breaks to improve readability.</em></figcaption></figure><p id="f61a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因为<code class="fe kv kw kx ky b">fetch</code>命令是异步的，我们需要告诉<code class="fe kv kw kx ky b">fetchCardDeck</code>函数在试图转换数据之前等待<code class="fe kv kw kx ky b">fetch</code>完成。我们通过使用回调函数调用<code class="fe kv kw kx ky b">.then</code>来实现这一点。在这个例子中，我们使用一个匿名回调函数，它从<code class="fe kv kw kx ky b">fetch</code>获取响应，并对其调用<code class="fe kv kw kx ky b">.json</code>。结果将是一个来自API的卡片叠对象，我们可以在代码中使用它。</p><p id="658f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦我们得到了洗好的牌，下一步就是根据游戏规则开始发牌。同样，我们需要等到卡片组数据准备好之后再尝试使用它，因此我们使用另一个<code class="fe kv kw kx ky b">.then</code>调用:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/1c79ab7a2bba7f3a1a44e842177de14e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rH9MUE2Z0FlUk-nrMgpITA.png"/></div></div></figure><p id="c353" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这第二个<code class="fe kv kw kx ky b">.then</code>将等待第一个<code class="fe kv kw kx ky b">.then</code>的结果。它将接受第一个<code class="fe kv kw kx ky b">.then</code>的结果，也就是JavaScript格式的<code class="fe kv kw kx ky b">cardDeck</code>对象，并执行一个匿名回调函数，将<code class="fe kv kw kx ky b">cardDeck</code>发送给下一个函数<code class="fe kv kw kx ky b">dealCards</code>。</p><p id="a5ee" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，我们可以在我们的主函数中调用<code class="fe kv kw kx ky b">fetchCardDeck</code>…</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/dab7f9aa79806cbddc81193c605395c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_t9hvLP3CKlRTUI2UTN_lA.png"/></div></div></figure><p id="7ad0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">…我们已经准备好编写一个纸牌游戏了！</p><pre class="kk kl km kn gt le ky lf lg aw lh bi"><span id="5bb6" class="li lj in ky b gy lk ll l lm ln">function fetchCardDeck () {<br/>    fetch(API_URL)<br/>    <!-- -->.then(response =&gt; response.json())<br/>    .then(cardDeck =&gt; dealCards(cardDeck));<br/>}<br/>fetchCardDeck();</span></pre></div><div class="ab cl lo lp hr lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ig ih ii ij ik"><p id="dd95" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lv">更多内容看</em> <a class="ae ki" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="lv">说白了。报名参加我们的</em> <a class="ae ki" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="lv">免费周报</em> </strong> </a> <em class="lv">。关注我们关于</em> <a class="ae ki" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="lv">推特</em> </strong> </a>，<a class="ae ki" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="lv">LinkedIn</em></strong></a><em class="lv">，</em><a class="ae ki" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="lv">YouTube</em></strong></a><em class="lv">，</em> <a class="ae ki" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="lv">不和</em> </strong> </a> <em class="lv">。对增长黑客感兴趣？检查</em> <a class="ae ki" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="lv">电路</em> </strong> </a> <em class="lv">。</em></strong></a></p></div></div>    
</body>
</html>