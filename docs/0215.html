<html>
<head>
<title>Writing Pretty Code in JavaScript Can Choke You</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript写漂亮的代码会让你窒息</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/writing-pretty-code-in-javascript-can-choke-you-a1847865c6ce?source=collection_archive---------22-----------------------#2022-01-12">https://javascript.plainenglish.io/writing-pretty-code-in-javascript-can-choke-you-a1847865c6ce?source=collection_archive---------22-----------------------#2022-01-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/e4437063b4116330237d07cc2dca0939.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*y4Gn_Re-li7r-F0c"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@juanjodev02?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Juanjo Jaramillo</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2072" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">事实证明，如果不小心的话，还有更多方法可以扼杀JavaScript。当然，我并不是说要有一个死循环。你可以在这里找到更多的<a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/how-to-choke-the-javascript-with-a-simple-function-4dc0cae5fe03"/>。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="2421" class="lh li in ld b gy lj lk l ll lm">const N = 10,000,000<br/>const <strong class="ld io">v</strong> = [0, 0]<br/>const obj = {}</span><span id="e5a6" class="lh li in ld b gy ln lk l ll lm">console.time()<br/>for (let i = 0; i &lt; N; i++) {<br/>  obj[<strong class="ld io">v</strong>] = 0<br/>}<br/>console.timeEnd()</span></pre><p id="7a96" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">考虑一下上面的幼稚代码，我运行了1000万次。相信我，一千万不是一个大数目。当我将Node.js与其他语言进行比较时，例如。Rust，我通常不会看到明显的差异，直到它达到近10亿次运行。</p><p id="a42a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">做个猜测，上面的代码在我的电脑上需要2.6秒。这很难让人相信。<code class="fe lo lp lq ld b">v</code>是一个数组，你怎么能把<code class="fe lo lp lq ld b">v</code>作为对象的键呢？根据文档，<code class="fe lo lp lq ld b">v</code>会在幕后为我投成一串，所以和<code class="fe lo lp lq ld b">obj[v.toString()] = 0</code>差不多。是这样吗？</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="4c86" class="lh li in ld b gy lj lk l ll lm">const N = 10,000,000<br/>const <strong class="ld io">v</strong> = [0, 0]<br/>const obj = {}</span><span id="28cb" class="lh li in ld b gy ln lk l ll lm">console.time()<br/>for (let i = 0; i &lt; N; i++) {<br/>  obj[<strong class="ld io">v.toString()</strong>] = 0<br/>}<br/>console.timeEnd()</span></pre><p id="6164" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">再猜一个，上面的代码在我的电脑上需要1.3秒。所以<code class="fe lo lp lq ld b">v</code>显然和<code class="fe lo lp lq ld b">v.toString()</code>不一样。也许铸造需要努力决定铸造什么类型？可能吧，但是还是太久了，1秒多。让我向你展示我期望得到的结果:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="0e68" class="lh li in ld b gy lj lk l ll lm">const N = 10,000,000<br/>const obj = {}</span><span id="85e8" class="lh li in ld b gy ln lk l ll lm">console.time()<br/>for (let i = 0; i &lt; N; i++) {<br/>  obj[<strong class="ld io">0</strong>] = 0<br/>}<br/>console.timeEnd()</span></pre><p id="9931" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我把<code class="fe lo lp lq ld b">v</code>换成了固定的数字<code class="fe lo lp lq ld b">0</code>。实际上，没有人会使用常量，但是我在这里只是测试性能，所以我不会使用随机数。猜测一下，这一块需要23ms，比一个数递增1000万次(12ms)多一点。</p><h2 id="ad31" class="lh li in bd lr ls lt dn lu lv lw dp lx kl ly lz ma kp mb mc md kt me mf mg mh bi translated">失误？</h2><p id="ea0e" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">是的，我确实犯了一个错误。感谢Ski J在<a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/run-javascript-code-one-magnitude-faster-using-webassembly-448d470eb77d">这里</a>指出。谁告诉你可以用一个物体做钥匙的？很有效，不是吗？我认为这是编写“漂亮”代码的捷径。是的，事实证明漂亮并不等同于高效——在这种情况下，远非高效，而是高效的反义词。现在我想知道我用JavaScript写的“漂亮”代码中有多少带有这种惊喜。</p><p id="61c7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mn">更多内容请看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="mn">plain English . io</em></strong></a><em class="mn">。报名参加我们的</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="mn">免费周报</em> </strong> </a> <em class="mn">。在我们的</em> <a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="mn">社区</em> </strong> </a> <em class="mn">获得独家获得写作机会和建议。</em></p></div></div>    
</body>
</html>