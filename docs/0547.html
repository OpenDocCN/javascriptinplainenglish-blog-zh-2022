<html>
<head>
<title>How to Load Data Before Your Angular App Starts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Angular应用程序启动前加载数据</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-load-data-before-your-angular-app-starts-71083cf56132?source=collection_archive---------2-----------------------#2022-01-31">https://javascript.plainenglish.io/how-to-load-data-before-your-angular-app-starts-71083cf56132?source=collection_archive---------2-----------------------#2022-01-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="329b" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用APP_INITIALIZER</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/347df6f1fa807c9cc3d50d7d445dff77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LWs9jmptZHAW-Wmu"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@dtopkin1?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Dayne Topkin</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e97c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在应用程序启动之前，是否必须加载配置文件来设置一些应用程序属性或加载一些数据？我们来看看有角的怎么做。在我们开始之前，先快速回顾一下Angular应用程序如何通过6个步骤启动:</p><h1 id="b57d" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">自举过程</h1><ol class=""><li id="900e" class="mh mi in kv b kw mj kz mk lc ml lg mm lk mn lo mo mp mq mr bi translated">加载index.html</li><li id="b1f7" class="mh mi in kv b kw ms kz mt lc mu lg mv lk mw lo mo mp mq mr bi translated">加载Angular、其他库和应用程序代码</li><li id="3c10" class="mh mi in kv b kw ms kz mt lc mu lg mv lk mw lo mo mp mq mr bi translated">执行main.ts文件</li><li id="54f2" class="mh mi in kv b kw ms kz mt lc mu lg mv lk mw lo mo mp mq mr bi translated">加载应用模块</li><li id="d68d" class="mh mi in kv b kw ms kz mt lc mu lg mv lk mw lo mo mp mq mr bi translated">加载应用程序组件</li><li id="64cf" class="mh mi in kv b kw ms kz mt lc mu lg mv lk mw lo mo mp mq mr bi translated">流程模板</li></ol><p id="33f4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">HTML文件有<code class="fe mx my mz na b">&lt;app-root&gt;&lt;/app-root&gt;</code>标签，Angular在这里注入我们的应用程序。</p><p id="48a1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Angular基于模块和DI(依赖注入)系统。所以在<code class="fe mx my mz na b">main.ts</code>中，我们有<code class="fe mx my mz na b">bootstrapModule()</code>，它将主应用程序模块作为一个参数，并为给定的平台创建它的一个实例:</p><p id="9283" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe mx my mz na b">main.ts</code></p><pre class="kd ke kf kg gt nb na nc nd aw ne bi"><span id="15a8" class="nf lq in na b gy ng nh l ni nj">import { enableProdMode } from '@angular/core';<br/>import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';</span><span id="f627" class="nf lq in na b gy nk nh l ni nj">import { AppModule } from './app/app.module';<br/>import { environment } from './environments/environment';</span><span id="e5a2" class="nf lq in na b gy nk nh l ni nj">if (environment.production) {<br/>  enableProdMode();<br/>}</span><span id="4a03" class="nf lq in na b gy nk nh l ni nj">platformBrowserDynamic().bootstrapModule(AppModule)<br/>  .catch(err =&gt; console.error(err));</span></pre><p id="37ab" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">App module(与任何其他Angular module一样)包含声明、导入、提供程序，还包含入口组件，这是一个默认的AppComponent。</p><pre class="kd ke kf kg gt nb na nc nd aw ne bi"><span id="342e" class="nf lq in na b gy ng nh l ni nj">bootstrap: [AppComponent]</span></pre><p id="8888" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后，组件被加载并呈现在页面上。现在我们已经了解了这个过程，让我们回到主题。app启动前如何加载数据？考虑到开头列出的步骤，我们可以说我们必须在步骤4和5之间进行干预。</p><ul class=""><li id="e49c" class="mh mi in kv b kw kx kz la lc nl lg nm lk nn lo no mp mq mr bi translated">(4)加载应用模块</li><li id="f726" class="mh mi in kv b kw ms kz mt lc mu lg mv lk mw lo no mp mq mr bi translated">→在providers数组中使用APP_INITIALIZER标记</li><li id="88e4" class="mh mi in kv b kw ms kz mt lc mu lg mv lk mw lo no mp mq mr bi translated">(5)加载应用程序组件</li></ul><h1 id="0025" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">APP_INITIALIZER令牌</h1><p id="8a0d" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc np le lf lg nq li lj lk nr lm ln lo ig bi translated">它是阿迪令牌，可以用来提供一个或多个初始化函数。在<code class="fe mx my mz na b">app.module.ts</code>中，我们必须通过以下方式提供它:</p><pre class="kd ke kf kg gt nb na nc nd aw ne bi"><span id="3d2e" class="nf lq in na b gy ng nh l ni nj">import { NgModule, APP_INITIALIZER } from '@angular/core';<br/>// other imports...</span><span id="be42" class="nf lq in na b gy nk nh l ni nj">@NgModule({<br/> imports: [BrowserModule],<br/> declarations: [AppComponent],<br/> bootstrap: [AppComponent],<br/> providers: [{<br/>   <strong class="na io">provide: APP_INITIALIZER,<br/>   useFactory: () =&gt; appConfigFactory<br/>   deps: [AppInitService],<br/>   multi: true</strong><br/>  }]<br/> })<br/>export class AppModule {}</span></pre><p id="9aca" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在providers数组中，我们传入APP_INITIALIZER令牌，并在<code class="fe mx my mz na b">useFactory</code>属性中定义一个名为<code class="fe mx my mz na b">appConfigFactory</code>(当然名称由您决定)的函数。数组可以是空的，但是你可以在这里传递任何你需要的服务。更准确地说，是工厂功能所依赖的服务。<code class="fe mx my mz na b">multi: true</code>意味着我们可以定义更多的应用初始化器。</p><p id="f9da" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Angular 的<a class="ae ks" href="https://github.com/angular/angular/blob/13.2.0/packages/core/src/application_init.ts#L86-L87" rel="noopener ugc nofollow" target="_blank">源代码中是这样定义令牌的:</a></p><pre class="kd ke kf kg gt nb na nc nd aw ne bi"><span id="7e7e" class="nf lq in na b gy ng nh l ni nj">export const APP_INITIALIZER =<br/>    new InjectionToken&lt;ReadonlyArray&lt;() =&gt; Observable&lt;unknown&gt;| Promise&lt;unknown&gt;| void&gt;&gt;('Application Initializer');</span></pre><p id="6ba4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这告诉我们，我们必须回报一个承诺或一个可观察的。</p><h2 id="61a1" class="nf lq in bd lr ns nt dn lv nu nv dp lz lc nw nx mb lg ny nz md lk oa ob mf oc bi translated">工厂(初始化)功能</h2><blockquote class="od oe of"><p id="78d8" class="kt ku og kv b kw kx jo ky kz la jr lb oh ld le lf oi lh li lj oj ll lm ln lo ig bi translated">提供的函数在应用程序启动时注入，并在应用程序初始化期间执行。如果这些函数中的任何一个返回一个承诺或一个可观察值，那么直到承诺被解析或可观察值被完成，初始化才完成。</p></blockquote><p id="bded" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">上述工厂函数的一个基本示例如下所示。(注意，该功能也可以直接在<code class="fe mx my mz na b">app.module.ts</code>文件中定义，而不是在单独的文件中定义)</p><pre class="kd ke kf kg gt nb na nc nd aw ne bi"><span id="8ea9" class="nf lq in na b gy ng nh l ni nj">import { AppInitService } from './../services/app-init.service';</span><span id="7ae4" class="nf lq in na b gy nk nh l ni nj">export function appConfigFactory(appInitService: AppInitService) {<br/>  return (): Promise&lt;any&gt; =&gt; {<br/>    return appInitService.init()<br/>  }<br/>}</span></pre><p id="e895" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">还请注意，我们在<code class="fe mx my mz na b">deps</code>数组中定义的<code class="fe mx my mz na b">AppInitService</code>被用在工厂函数中，在这里我们从它调用一个‘init()’方法。在那里你可以实现任何你需要的逻辑。例如，您可以使用httpClient加载一个包含一些数据的JSON文件来配置您的应用程序。</p><h1 id="6ca9" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">结论</h1><p id="581b" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc np le lf lg nq li lj lk nr lm ln lo ig bi translated">我们学习了如何在模块中利用APP_INITIALIZER令牌及其初始化函数，以便在应用程序组件被初始化和呈现之前执行一些步骤。这比直接在组件和组件模板中处理逻辑/加载文件更好。</p><p id="aacc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">资源/实例:</strong></p><p id="2608" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><a class="ae ks" href="https://angular.io/api/core/APP_INITIALIZER" rel="noopener ugc nofollow" target="_blank">棱角分明的文档</a></p><p id="573c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">【Angular应用的编译时与运行时配置</p><p id="bec8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><a class="ae ks" href="https://www.pluralsight.com/guides/bootstrapping-an-application-in-angular" rel="noopener ugc nofollow" target="_blank">在Angular中引导应用</a></p><p id="1434" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="og">更多内容看</em> <a class="ae ks" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="og">说白了。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="og">免费周报</em> </strong> </a> <em class="og">。在我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="og">社区不和谐</em> </strong> </a> <em class="og">获得独家获取写作机会和建议。</em></strong></a></p></div></div>    
</body>
</html>