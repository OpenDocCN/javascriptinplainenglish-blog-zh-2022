<html>
<head>
<title>Manage Context-Based Parameters in Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Express中管理基于上下文的参数</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/manage-context-based-parameters-in-express-e65f6c889427?source=collection_archive---------3-----------------------#2022-10-15">https://javascript.plainenglish.io/manage-context-based-parameters-in-express-e65f6c889427?source=collection_archive---------3-----------------------#2022-10-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/ce220a31f0eeac62f597735668e0e26e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O_KiWzEBt216Ph1d"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@polarmermaid?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Anne Nygård</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c7ab" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当涉及到为任何应用程序设计代码结构时，一个人可以采取许多方法，所以今天我将分享我最喜欢的方法之一，用于创建express应用程序并在更隔离的环境中管理其控制器</p><h1 id="2805" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">什么是基于上下文的路线？</h1><p id="8565" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">基于上下文的路由可以定义为控制器功能比请求和响应对象更加独立。一个常规方法，可以用在我们不能访问请求和响应对象的其他代码位置</p><h2 id="5bc2" class="mb kz in bd la mc md dn le me mf dp li kl mg mh lm kp mi mj lq kt mk ml lu mm bi translated">典型的快速路线</h2><p id="60bd" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">一个典型的express路由看起来就像下图，我们需要从express传递请求和响应对象，稍后用于从请求对象获取参数并将响应对象返回给客户端</p><figure class="mo mp mq mr gt jo gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/5dbe1d15c96d924c5fb6bc1d462646e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*vdHQmCpeGv1CSYJdGdS6VQ.png"/></div></figure><p id="77ab" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但是，如果我们想使用控制器中的功能，以便在应用程序中的任何其他地方进行访问，那么理想的方法是将代码放在公共文件中，然后更新控制器中的引用，并在新的位置调用该方法</p><h2 id="b830" class="mb kz in bd la mc md dn le me mf dp li kl mg mh lm kp mi mj lq kt mk ml lu mm bi translated">我们如何构建上下文路由器？</h2><p id="a7a7" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">从上下文开始，我们需要首先构造响应类型。在一般的应用程序中，我们可以有三种类型的响应</p><ul class=""><li id="9dd1" class="ms mt in kc b kd ke kh ki kl mu kp mv kt mw kx mx my mz na bi translated">成功/错误响应</li><li id="4481" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated">重定向响应</li><li id="b397" class="ms mt in kc b kd nb kh nc kl nd kp ne kt nf kx mx my mz na bi translated">文件响应</li></ul><figure class="mo mp mq mr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ng"><img src="../Images/50cda0588fac1af6be9961aa609f5185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ibxntfr6nthxe5RWir26tw.png"/></div></div></figure><p id="623b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们创建了三个不同的类来处理普通响应、重定向响应和下载或文件响应。我们稍后会用到这些类</p><p id="ba63" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们来创建第二块拼图，即承诺处理器。我们需要一个地方来添加所有应用程序的所有默认设置，所以让我们创建该文件并将其命名为<code class="fe nh ni nj nk b">requestHandler</code></p><figure class="mo mp mq mr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/8ef43f98f9c78fd8dae2738a06548c84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FkAuAUYFXO43yHVU3femlQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">requestProcessor.js</figcaption></figure><p id="a457" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们现在创建了另一个类<code class="fe nh ni nj nk b">ManagePromiseHandler</code>,我们在验证所有参数是否正确之后运行输入承诺，然后根据我们之前创建的响应类型处理输出</p><p id="7231" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们有了两个重要的东西，让我们创建一个实际的处理器，并将文件命名为<code class="fe nh ni nj nk b">processor</code>，在这里我们将从请求中析构所有字段，并将其分配给上下文变量，我们将把该变量传递给控制器，如<code class="fe nh ni nj nk b">body</code>和<code class="fe nh ni nj nk b">query</code></p><figure class="mo mp mq mr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nm"><img src="../Images/fa735e57f5e1d0f0ebdc84eed6c861a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9WTxZBXJGw13Zlh7fvhIjg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">process.js</figcaption></figure><p id="2e6e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们已经有了所有的东西，所以让我们改变路线和它的控制器，使用新的方法来处理它</p><h2 id="a9b7" class="mb kz in bd la mc md dn le me mf dp li kl mg mh lm kp mi mj lq kt mk ml lu mm bi translated">路线变更</h2><p id="49db" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">现在，任何控制器都没有请求或响应参数，取而代之的是，它们将所有的值放在一个对象中，我们需要将控制器作为参数传递</p><figure class="mo mp mq mr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/77bc6d86becea4d66fe952717a1258bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E4HJjP7qgCp_XSateLr21g.png"/></div></div></figure><p id="0145" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">需要注意的一点是，控制器的返回应该是前面定义的响应格式之一。现在，该路由应该可以正常工作了</p><blockquote class="no np nq"><p id="cc61" class="ka kb nr kc b kd ke kf kg kh ki kj kk ns km kn ko nt kq kr ks nu ku kv kw kx ig bi translated">你可以使用下面的结构来传递数据</p></blockquote><pre class="mo mp mq mr gt nv nk nw nx aw ny bi"><span id="b171" class="mb kz in nk b gy nz oa l ob oc">const controller = ({ name }) =&gt; {</span><span id="7e88" class="mb kz in nk b gy od oa l ob oc">    return new SimpleSuccessResponse({</span><span id="24ee" class="mb kz in nk b gy od oa l ob oc">      message: 'success',</span><span id="c50f" class="mb kz in nk b gy od oa l ob oc">      name</span><span id="750b" class="mb kz in nk b gy od oa l ob oc">   })</span><span id="b4a3" class="mb kz in nk b gy od oa l ob oc">}</span></pre><h2 id="a1af" class="mb kz in bd la mc md dn le me mf dp li kl mg mh lm kp mi mj lq kt mk ml lu mm bi translated">处理程序错误</h2><p id="c9da" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">现在，下一个问题是我们如何处理错误响应。理想情况下，您可以单独管理错误响应，但让我们也创建一个类似的错误处理方法。我们将从创建一个<code class="fe nh ni nj nk b">CustomError</code>文件开始，或者我们也可以将它放入响应中</p><figure class="mo mp mq mr gt jo gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/fccc545b3a4730ddd7b7483f03e06810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*IU1VbBjYZhOzrCayeMLPTA.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">ErrorResponse</figcaption></figure><p id="8790" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们有了error类，让我们创建一个将在全局级别处理错误的中间件，我们将基于输入错误生成响应，并且为了跟踪错误堆栈，我们可以使用serialize-error包</p><figure class="mo mp mq mr gt jo gh gi paragraph-image"><div class="gh gi of"><img src="../Images/0e4773565f2107d11e9b164615424602.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*1G4MBfMAPntTLk-Iiav6qg.png"/></div></figure><p id="3605" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在Express应用程序的底部，我们可以包括以下格式的错误</p><pre class="mo mp mq mr gt nv nk nw nx aw ny bi"><span id="37e8" class="mb kz in nk b gy nz oa l ob oc">app.use(errorHandler)</span><span id="57bb" class="mb kz in nk b gy od oa l ob oc">// to use it<br/>    throw new ErrorResponse('No data found')<br/>and the error will be handled</span></pre><p id="6fa7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这应该就是错误处理</p><h2 id="81a6" class="mb kz in bd la mc md dn le me mf dp li kl mg mh lm kp mi mj lq kt mk ml lu mm bi translated">结论</h2><p id="82d3" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">有几种方法可以构建您的代码库，但这是我喜欢的大多数应用程序中的版本，如果您喜欢并在您的项目中使用它，那么您可以找到源代码<a class="ae jz" href="https://github.com/Piyush-Use-Personal/express-context" rel="noopener ugc nofollow" target="_blank"/></p><p id="0af8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">编码快乐！</p><p id="25f1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nr">更多内容尽在</em> <a class="ae jz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="nr">说白了. io </em> </strong> </a> <em class="nr">。报名参加我们的</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="nr">免费周报</em> </strong> </a> <em class="nr">。关注我们关于</em> <a class="ae jz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="nr">推特</em> </strong> </a>，<a class="ae jz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="nr">LinkedIn</em></strong></a><em class="nr">，</em><a class="ae jz" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="nr">YouTube</em></strong></a><em class="nr">，</em> <a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="nr">不和</em> </strong> </a> <em class="nr">。对增长黑客感兴趣？检查</em> <a class="ae jz" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="nr">电路</em> </strong> </a> <em class="nr">。</em></p></div></div>    
</body>
</html>