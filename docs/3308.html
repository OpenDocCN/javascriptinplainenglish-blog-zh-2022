<html>
<head>
<title>A Practical Way to Manage Page State in a React App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React应用程序中管理页面状态的实用方法</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/a-practical-way-to-manage-page-state-in-a-react-app-c542828076ab?source=collection_archive---------4-----------------------#2022-08-17">https://javascript.plainenglish.io/a-practical-way-to-manage-page-state-in-a-react-app-c542828076ab?source=collection_archive---------4-----------------------#2022-08-17</a></blockquote><div><div class="fc ic id ie if ig"/><div class="ih ii ij ik il"><div class=""/><div class=""><h2 id="b181" class="pw-subtitle-paragraph jl in io bd b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc dk translated">通过使用历史API存储状态来管理React应用程序中的页面状态。</h2></div><figure class="ke kf kg kh gu ki gi gj paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gi gj kd"><img src="../Images/7e2798d6bb1c202ab9ed24589aeda560.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TYeZH-peq4yS_eWh.jpg"/></div></div><figcaption class="kp kq gk gi gj kr ks bd b be z dk">from tsh.io</figcaption></figure><h2 id="b724" class="kt ku io bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">前言</h2><p id="c61a" class="pw-post-body-paragraph lp lq io lr b ls lt jp lu lv lw js lx lc ly lz ma lg mb mc md lk me mf mg mh ih bi translated">React里有很多状态管理库，比如Redux，Rematch，反冲，当然你也可以使用React context来管理页面状态。这些都很有用，但是有一个问题——当我们刷新页面的时候，页面状态会丢失，页面状态不可共享。例如，如果您在React应用程序列表页面中过滤一些数据，并希望与可以直接看到结果的人共享页面URL，那么您不能只通过状态管理来实现它。</p><p id="8241" class="pw-post-body-paragraph lp lq io lr b ls mi jp lu lv mj js lx lc mk lz ma lg ml mc md lk mm mf mg mh ih bi translated">本文将介绍如何使用History API来增强React状态，以便可以共享状态，并且在刷新页面后页面显示不会改变。</p><h2 id="0292" class="kt ku io bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">具有URL的持久状态</h2><p id="8b67" class="pw-post-body-paragraph lp lq io lr b ls lt jp lu lv lw js lx lc ly lz ma lg mb mc md lk me mf mg mh ih bi translated">大部分npm模块在React应用中使用localStorage来持久化页面状态，像【npmjs.com】redux-persist—NPM、【npmjs.com】use-persisted-state—NPM。通过使用localStorage，我们可以存储复杂的数据或大型数据，并且在刷新页面时，我们可以恢复状态，这对用户来说是一种更好的体验，特别是在移动页面上。</p><p id="f22d" class="pw-post-body-paragraph lp lq io lr b ls mi jp lu lv mj js lx lc mk lz ma lg ml mc md lk mm mf mg mh ih bi translated">对于大多数列表页面，我们只需要保存一些过滤动作的状态，我们可以使用一个URL来存储状态。假设我们只需要存储一个字段，我们可以使用这个React挂钩:</p><pre class="ke kf kg kh gu mo mp mq mr aw ms bi"><span id="f865" class="kt ku io mp b gz mt mu l mv mw">const useHistory = () =&gt; {<br/>  const { pathname, search } = window.location;<br/>  const queryParams = new URLSearchParams(search);<br/>  const [filter, setFilter] = React.useState(queryParams.get("filter") || "");<br/>  return [<br/>    text,<br/>    function setData(val) {<br/>      setFilter(val);<br/>      queryParams.set("filter", val);<br/>      history.replaceState({}, "", `${pathname}?${queryParams.toString()}`);<br/>    }<br/>  ];<br/>};</span></pre><p id="9def" class="pw-post-body-paragraph lp lq io lr b ls mi jp lu lv mj js lx lc mk lz ma lg ml mc md lk mm mf mg mh ih bi translated">一旦使用钩子函数，它将获得URL查询<code class="fe mx my mz mp b">filter</code>来初始化过滤器变量，我们可以使用setData来存储状态，它会将状态存储到URL。</p><p id="27ac" class="pw-post-body-paragraph lp lq io lr b ls mi jp lu lv mj js lx lc mk lz ma lg ml mc md lk mm mf mg mh ih bi translated">有一个React应用程序演示:</p><figure class="ke kf kg kh gu ki"><div class="bz fq l di"><div class="na nb l"/></div></figure><p id="fec5" class="pw-post-body-paragraph lp lq io lr b ls mi jp lu lv mj js lx lc mk lz ma lg ml mc md lk mm mf mg mh ih bi translated">通过使用URL来保持状态，我们可以共享链接(CodePen不共享，因为它使用iframe来呈现结果页面)。</p><h2 id="1cff" class="kt ku io bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">结论</h2><p id="0020" class="pw-post-body-paragraph lp lq io lr b ls lt jp lu lv lw js lx lc ly lz ma lg mb mc md lk me mf mg mh ih bi translated">我们可以使用localStorage来持久化状态，但也可以使用URL来实现。如果我们需要与一些预设的过滤器/选项共享页面URL，使用URL来存储状态会很方便。如果状态数据非常大，我们可以用一个短id保存到后端SQL，这样就可以和其他人共享了。</p><p id="6086" class="pw-post-body-paragraph lp lq io lr b ls mi jp lu lv mj js lx lc mk lz ma lg ml mc md lk mm mf mg mh ih bi translated">我们使用<code class="fe mx my mz mp b">URLSearchParams</code>来解析URL查询并设置字段，您可以通过参考这篇文章了解更多关于解析查询的信息:</p><div class="nc nd gq gs ne nf"><a href="https://levelup.gitconnected.com/4-ways-to-get-value-from-query-string-f11034f06148" rel="noopener  ugc nofollow" target="_blank"><div class="ng ab fp"><div class="nh ab ni cl cj nj"><h2 class="bd ip gz z fq nk fs ft nl fv fx in bi translated">从查询字符串中获取值的4种方法</h2><div class="nm l"><h3 class="bd b gz z fq nk fs ft nl fv fx dk translated">URLSearchParams，Regex，Array.prototype.reduce，qs包。</h3></div><div class="nn l"><p class="bd b dl z fq nk fs ft nl fv fx dk translated">levelup.gitconnected.com</p></div></div><div class="no l"><div class="np l nq nr ns no nt kn nf"/></div></div></a></div></div><div class="ab cl nu nv hs nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ih ii ij ik il"><p id="27e8" class="pw-post-body-paragraph lp lq io lr b ls mi jp lu lv mj js lx lc mk lz ma lg ml mc md lk mm mf mg mh ih bi translated"><em class="ob">更多内容请看</em><a class="ae mn" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lr ip"><em class="ob">plain English . io</em></strong></a><em class="ob">。报名参加我们的</em> <a class="ae mn" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lr ip"> <em class="ob">免费周报</em> </strong> </a> <em class="ob">。关注我们关于</em><a class="ae mn" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="lr ip"><em class="ob">Twitter</em></strong></a><a class="ae mn" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="lr ip"><em class="ob">LinkedIn</em></strong></a><em class="ob"/><a class="ae mn" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="lr ip"><em class="ob">YouTube</em></strong></a><em class="ob"/><a class="ae mn" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="lr ip"><em class="ob">不和</em> </strong> </a> <em class="ob">。</em></p></div></div>    
</body>
</html>