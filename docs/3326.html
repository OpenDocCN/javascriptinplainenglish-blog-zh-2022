<html>
<head>
<title>10 Ways to Speed Up JavaScript Loading</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">加速JavaScript加载的10种方法</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/10-ways-to-speed-up-javascript-loading-235892adbcf?source=collection_archive---------11-----------------------#2022-08-18">https://javascript.plainenglish.io/10-ways-to-speed-up-javascript-loading-235892adbcf?source=collection_archive---------11-----------------------#2022-08-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f68e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">JavaScript是导致网站加载时间过长的最大因素之一。以下是加快JavaScript加载速度的方法。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/214dc0f273b8de8d56d560a3f9977049.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cgwZzarBbCtCM-TvLwTK4A.png"/></div></div></figure><p id="f17e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在许多现代网站中，有大量的JavaScript。事实上，根据HTTP档案，平均桌面页面有超过500千字节的JavaScript。问题是JavaScript下载和解析都需要时间，这使得网站加载速度慢了很多，因此影响了用户的保留，因为如果网站加载时间太长，用户就会离开。幸运的是，有一些简单的方法可以减少你在网站上加载的JavaScript代码量，并且让你加载的JavaScript代码加载得更快，这就是我们今天要讨论的。</p><h1 id="459c" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">如何让你的JavaScript加载更快</h1><h2 id="102b" class="mf lo iq bd lp mg mh dn lt mi mj dp lx la mk ml lz le mm mn mb li mo mp md mq bi translated">1.惰性装载</h2><p id="3159" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">当用户第一次访问网站时，并不是所有的JavaScript都需要即时加载。例如，您可以在页面底部设置电子邮件注册提示。除非用户向下滚动到那里，否则没有必要加载。</p><p id="872b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，许多web开发人员使用一种叫做惰性加载的技术。延迟加载不是一次加载所有的JavaScript，而是卸载一些JavaScript。有多种不同形式的延迟加载。</p><p id="cb77" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">例如，对于不需要立即激活但仍然应该很快激活的元素，您可以使用<code class="fe mw mx my mz b">requestIdleCallback()</code>等到页面空闲。</p><p id="624f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">或者，正如我们已经讨论过的，如果页面下方有一个交互元素，您可以等待，直到用户使用<code class="fe mw mx my mz b">intersectionObserver</code>向下滚动到该元素。</p><p id="5bfc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，问题仍然存在:你如何在以后加载代码？最好的方法之一是动态的<code class="fe mw mx my mz b">import()</code>，它是<a class="ae na" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules" rel="noopener ugc nofollow" target="_blank"> ECMAScript模块(ESM) </a>的一部分。通过运行<code class="fe mw mx my mz b">import()</code>函数，动态导入可以帮助您随时加载脚本。例如，这将在浏览器空闲时加载一个脚本:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ac96" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">另一个选择是简单地在脚本上使用<code class="fe mw mx my mz b">async</code>或<code class="fe mw mx my mz b">defer</code>属性。这种技术不太灵活，但这是一种让脚本等待DOM组装完成的简单方法。</p><h2 id="e09f" class="mf lo iq bd lp mg mh dn lt mi mj dp lx la mk ml lz le mm mn mb li mo mp md mq bi translated">2.缩小</h2><p id="bdd1" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">缩小是一种提高性能的简单方法。这通常是使用自动化挖掘器来完成的，如<a class="ae na" href="https://terser.org/" rel="noopener ugc nofollow" target="_blank"> Terser </a>或<a class="ae na" href="https://esbuild.github.io/" rel="noopener ugc nofollow" target="_blank"> ESBuild </a>。这些工具通过删除空格、长变量名和其他对开发有帮助但在生产中会增加脚本大小的内容，从本质上缩小了代码。例如，假设我用Terser精简了这段代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="b1ec" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">输出将是:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="a2ff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这减少了67个字节，从203个字节减少到136个字节！这一点点不会产生明显的差异，但对于较大的脚本，缩小会产生相当大的影响。</p><h2 id="95fa" class="mf lo iq bd lp mg mh dn lt mi mj dp lx la mk ml lz le mm mn mb li mo mp md mq bi translated">3.集束</h2><p id="a066" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">脚本大小并不是唯一重要的事情。请求计数也是如此，因为每个请求都会增加开销。基本上，您希望将脚本数量保持在最低水平。然而，分割代码通常是保持代码整洁的一种代码实践。幸运的是，像迷你编辑器一样，有自动化的工具来解决这个问题。这些被称为捆扎机。Bundlers分析你的代码，看看哪些脚本是互相导入的，弄清楚怎么组合。最知名的捆绑机有<a class="ae na" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> Webpack </a>、<a class="ae na" href="https://www.rollupjs.org/guide/en/" rel="noopener ugc nofollow" target="_blank"> Rollup </a>和<a class="ae na" href="https://vitejs.dev/" rel="noopener ugc nofollow" target="_blank"> Vite </a>。</p><p id="d42f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用bundler的另一个优点是大多数bundler也可以作为构建工具，这样可以很容易地完成诸如缩小和类型脚本编译之类的事情。更多关于捆扎机的信息，请查看我的文章。</p><h2 id="e3fd" class="mf lo iq bd lp mg mh dn lt mi mj dp lx la mk ml lz le mm mn mb li mo mp md mq bi translated">4.代码拆分</h2><p id="9834" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">您可能会惊讶，这是捆绑后的权利。"我捆绑我的代码仅仅是为了把它分开？"不一定。其实这是bundlers的一个特点。虽然减少请求数量很好，但你不希望用户必须一次加载网站上的所有代码。您可以通过为每个页面创建一个新的完整包来解决这个问题，但是这会抵消缓存的一些好处(我们将在后面讨论)。</p><p id="ed48" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了解决这个问题，我们有代码分割。代码拆分结合了绑定和延迟加载的优点，同时确保不会加载页面的任何不必要的代码。bundler通过分析导入映射来执行代码分割，并找出哪些脚本需要包含在自己的包中。大多数绑定器都是自动完成的，尽管编写更容易分析的代码会有所帮助(例如，尽可能使用静态导入)。</p><h2 id="df5d" class="mf lo iq bd lp mg mh dn lt mi mj dp lx la mk ml lz le mm mn mb li mo mp md mq bi translated">5.树摇晃</h2><p id="6778" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">捆扎机的另一个共同特征是摇晃树木。您可以导入库的一部分，但不需要其余部分。然而，如果你这样做而不摇晃树，最终用户将会加载整个库，这会增加很多JavaScript。摇树解决了这个问题；支持树抖动的捆绑器会自动移除库的未使用部分，这大大减少了您导入的代码。</p><p id="1190" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">例如，看看Lodash(具体来说是lodash-es)，这是一个大型的JavaScript实用程序库。整个模块几乎缩小了100千字节，但是如果您只是使用<code class="fe mw mx my mz b">intersect()</code>函数，您将只导入2.7千字节的代码。现在，在Lodash的例子中，有只包含单个函数的包，但是如果你正在使用大量的函数，这些包可能会更烦人，而且许多库不这样做。</p><h2 id="8bf7" class="mf lo iq bd lp mg mh dn lt mi mj dp lx la mk ml lz le mm mn mb li mo mp md mq bi translated">6.ECMAScript模块</h2><p id="70e0" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">对于前面提到的许多功能来说，ECMAScript模块(ESM)非常有用，甚至是必不可少的。ESM是一个模块规范，旨在规范如何在不同文件之间共享代码。在ESM之前，有一些相互冲突的标准，如CommonJS和UMD，它们甚至不受浏览器的本地支持。ESM统一了这些标准，并提供了有助于树摇动等功能的语法(注意我在前面说过如何使用lodash-es而不是标准lodash)。此外，由于浏览器本身支持ESM，因此您不需要沉重的polyfill即可使用ESM。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="feb0" class="mf lo iq bd lp mg mh dn lt mi mj dp lx la mk ml lz le mm mn mb li mo mp md mq bi translated">7.加拿大</h2><p id="1465" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">在你自己的服务器上托管静态文件是没有意义的。使用完整的服务器进行实际的服务器端计算会增加您的成本、开发复杂性和网站加载时间。相反，cdn是更好的解决方案。CDN(内容交付网络)是一个服务器网络，旨在快速、廉价地提供静态文件。您可以从数十台或数百台服务器(取决于CDN)提供文件，而不是仅从一台服务器提供服务，这样可以减少延迟，因为服务器离用户更近。</p><p id="5652" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，cdn通常会为您配置缓存和压缩等功能，从而节省时间。CDN的一些流行例子是<a class="ae na" href="https://www.cloudflare.com/cdn/" rel="noopener ugc nofollow" target="_blank"> Cloudflare CDN </a>和亚马逊<a class="ae na" href="https://aws.amazon.com/cloudfront/" rel="noopener ugc nofollow" target="_blank"> CloudFront </a>。</p><h2 id="7aba" class="mf lo iq bd lp mg mh dn lt mi mj dp lx la mk ml lz le mm mn mb li mo mp md mq bi translated">8.贮藏</h2><p id="acaa" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">虽然首次加载体验很重要，但你也需要考虑网站回头客的性能。一种显著提高重复访问速度的方法是通过缓存。浏览器缓存的工作原理是保存网站资源的副本并使用该副本，而不是再次下载。这意味着重复访问感觉几乎是瞬间的。</p><p id="ea13" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要设置缓存，您需要在您缓存的资源的响应中设置<a class="ae na" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control" rel="noopener ugc nofollow" target="_blank"> Cache-Control </a>头。如果您使用的是CDN，这可能会自动为您配置。如果你不是，这是足够简单的设置。</p><h2 id="23b4" class="mf lo iq bd lp mg mh dn lt mi mj dp lx la mk ml lz le mm mn mb li mo mp md mq bi translated">9.压缩</h2><p id="a53b" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">我相信你一定遇到过<code class="fe mw mx my mz b">.zip</code>或<code class="fe mw mx my mz b">.tag.gz</code>文件。您可能还知道，除了将目录转换为文件之外，它们还会减小文件的大小。大小的减小是通过压缩完成的。压缩的工作原理是运行一种算法，通过收缩重复的语句和根据使用的算法做一些其他事情来找到使文件变小的方法。有许多流行的压缩算法，如deflate、lz4、Brotli和Zstandard。zip和gzipped文件使用压缩是deflate。</p><p id="0f28" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">实现压缩可能有点难，但是有一些简单的方法可以做到。最简单的方法是使用自动压缩文件的CDN，就像我们在第7点讨论的那样。实现压缩的另一个简单方法是运行支持压缩的文件服务器。</p><p id="d6ca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然而，如果你不能做到这些，还有一些其他的解决方案。很多构建工具/捆绑器都有插件，可以自动生成压缩格式的文件，你可以让浏览器自动解压。浏览器使用<code class="fe mw mx my mz b">Accept-Encoding</code>头告诉你它支持什么压缩算法，你的服务器使用<code class="fe mw mx my mz b">Content-Encoding</code>头告诉浏览器在响应中使用什么压缩算法。</p><p id="eacc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">更多信息，请查看<a class="ae na" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Compression" rel="noopener ugc nofollow" target="_blank"> MDN关于HTTP压缩的文章</a>。</p><h2 id="3dea" class="mf lo iq bd lp mg mh dn lt mi mj dp lx la mk ml lz le mm mn mb li mo mp md mq bi translated">10.灯塔&amp;自动化绩效审计</h2><p id="259c" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">Lighthouse 是一个帮助你自动审核网站性能的工具，还有一些其他的类别，比如SEO和可访问性。这对于发现性能问题非常有帮助，并提供了解决这些问题的简单方法。如果你有Chrome或者其他基于Chrome的浏览器，Lighthouse应该默认可用。如果您正在使用另一个浏览器，您可以下载该扩展或使用<a class="ae na" href="https://pagespeed.web.dev/" rel="noopener ugc nofollow" target="_blank"> PageSpeed Insights </a>。PageSpeed Insights还提供来自真实用户的数据，如果你想了解用户的真实体验，这些数据会很有帮助。</p><h1 id="b9ad" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">结论</h1><p id="a516" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">有了这些建议，你应该可以在你的网站上获得巨大的性能收益，转化为更多的保留和转化。感谢阅读！</p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><p id="edea" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="nk">原载于2022年8月18日https://byteofdev.com</em><a class="ae na" href="https://byteofdev.com/posts/speed-up-javascript-loading/" rel="noopener ugc nofollow" target="_blank"><em class="nk"/></a><em class="nk">。</em></p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><p id="b2d5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="nk">更多内容请看</em><a class="ae na" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="nk">plain English . io</em></strong></a><em class="nk">。报名参加我们的</em> <a class="ae na" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="nk">免费周报</em> </strong> </a> <em class="nk">。关注我们关于</em><a class="ae na" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="nk">Twitter</em></strong></a><a class="ae na" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="nk">LinkedIn</em></strong></a><em class="nk"/><a class="ae na" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="nk">YouTube</em></strong></a><em class="nk"/><a class="ae na" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="nk">不和</em> </strong> </a> <em class="nk">。</em></p></div></div>    
</body>
</html>