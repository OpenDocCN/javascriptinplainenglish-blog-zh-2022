<html>
<head>
<title>Build a jsPDF Download Status Indicator Using React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用反应构建jsPDF下载状态指示器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-jspdf-download-status-indicator-613cff7a938d?source=collection_archive---------4-----------------------#2022-05-01">https://javascript.plainenglish.io/react-jspdf-download-status-indicator-613cff7a938d?source=collection_archive---------4-----------------------#2022-05-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="17e7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">当使用jsPDF.html()时，如何为您的用户提供一个现代的UX</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/8c17074b08c05289290ef1cf7f4e89a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*bsNFnqddECYD1g8RWXdzFg.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk">A successful download</figcaption></figure><h1 id="ca26" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">问题是</h1><p id="048f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我最近一直在使用jsPDF库来创建网页的PDF快照。这是非常无缝的，但是我意识到当页面快照是“处理/格式化”时，没有UI反馈来告诉用户某件事实际上正在发生——这是糟糕的UX！</p><p id="0495" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我找不到一个清晰简单的方法来显示负载或状态指示器。通过结合jsPDF、快速反应和一点承诺知识，我们可以创建一个简单的现代UX来解决这个问题。</p><p id="d7a3" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">如果您想直接跳到代码上，请到这里来！</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="7c0d" class="kr ks iq bd kt ku ms kw kx ky mt la lb jw mu jx ld jz mv ka lf kc mw kd lh li bi translated">解决方案</h1><p id="7bd2" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们将使用jsPDF库来生成和保存我们的PDF，用热吐司来显示我们的通知，并把它作为我们选择的JavaScript UI框架。</p><h2 id="6325" class="mx ks iq bd kt my mz dn kx na nb dp lb ls nc nd ld lw ne nf lf ma ng nh lh ni bi translated">doc.html()和doc.save()</h2><p id="e7fe" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated"><code class="fe nj nk nl nm b">.html()</code>是JsPDF从HTML元素生成PDF的方式。<code class="fe nj nk nl nm b">.html</code>方法通常调用回调来保存(下载)新生成的PDF。这里有一个简单的例子；</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="5c6b" class="mx ks iq nm b gy nr ns l nt nu">//Generate and save a PDF of the current page body called savedPDF.pdf</span><span id="4627" class="mx ks iq nm b gy nv ns l nt nu">doc.html(document.body, {<br/>        callback: function (pdf) {<br/>          pdf.save("savedPDF");<br/>        }<br/>      })</span></pre><p id="d7dd" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">最初，在查看这段代码时，我尝试通过回调设置loading/error/completed useStates，但是很快就变得混乱了。有一种更简单的方式——<strong class="ll ir">使用诺言</strong>。</p><h2 id="61a0" class="mx ks iq bd kt my mz dn kx na nb dp lb ls nc nd ld lw ne nf lf ma ng nh lh ni bi translated">HTMLWorker承诺</h2><p id="7a7a" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果您查看JsPDF库的typescript索引文件，您可以找到<code class="fe nj nk nl nm b">.html()</code>方法的类型和定义。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/a2598698ac9d3dd88a1df40cb9e708fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*qjFT9CNd_5W2LFTYq5gnUw.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk">.html() method definition</figcaption></figure><p id="c46e" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">这告诉我们，我们需要提供一个字符串或HTMLElement作为我们的第一个参数，并且我们可以选择使用HTMLOptions界面中的任何方法——这就是<code class="fe nj nk nl nm b">callback: (){}</code>保存pdf的来源。</p><p id="71ab" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">您还会注意到<code class="fe nj nk nl nm b">.html()</code>方法返回了一个HTMLWorker类型。这实际上只是一个带有一些扩展的标准JS Promise。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/00df6d2c7a720616ae6fe62d36f88ef7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*Eyqik3istfg_KPlXnCa65w.png"/></div></figure><p id="7f5c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">就像任何其他承诺一样，这将从待定变为已解决或已拒绝。我们可以使用这些状态来显示通知。</p><h2 id="1ba3" class="mx ks iq bd kt my mz dn kx na nb dp lb ls nc nd ld lw ne nf lf ma ng nh lh ni bi translated">显示通知</h2><p id="a747" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">反应热吐司是一个非常简单的小库，用于显示吐司通知。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/8efc34f2670b67bb68935ddc2d8280eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*neIuKwlFz8tcEMNpvi-5Lg.png"/></div></figure><p id="32d6" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">敬酒有很多种方式，但我们将重点介绍以JS Promise为参数的<code class="fe nj nk nl nm b">toast.promise()</code>方法。<br/>一旦我们给了它一个承诺，toast库就会根据承诺的状态 <strong class="ll ir"> <em class="nz">整理出它应该显示什么<em class="nz">。</em> </em></strong></p><p id="fa3c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir"><em class="nz"/></strong><em class="nz">—显示微调器<br/> </em> <strong class="ll ir"> <em class="nz">已解决</em> </strong> <em class="nz"> —显示绿色勾号<br/> </em> <strong class="ll ir"> <em class="nz">已拒绝</em> </strong> <em class="nz"> —显示红色叉号<br/> </em>(如果您愿意，这些当然是完全可定制的)</p><p id="916e" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">所以我们需要做的就是给<code class="fe nj nk nl nm b">toast.promise()</code>一个有效的承诺，比如由<code class="fe nj nk nl nm b">doc.html()</code>返回的承诺。使用与上面相同的代码，我们可以这样做:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="ca5f" class="mx ks iq nm b gy nr ns l nt nu">toast.promise(<br/>      doc.html(document.body, {<br/>        callback: function (pdf) {<br/>          pdf.save("savedPDF");<br/>        }<br/>      }),<br/>      //Custom messages to show the user<br/>      {<br/>        loading: "Downloading file...",<br/>        error: "Download failed. Please try again.",<br/>        success: "Download successful"<br/>      }<br/>    );</span></pre><p id="45e4" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">最后一步是在React组件返回的JSX中的某处包含一个<code class="fe nj nk nl nm b">&lt;Toaster/&gt;</code>组件。</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="6c74" class="mx ks iq nm b gy nr ns l nt nu">return &lt;div&gt;<br/>    &lt;div&gt;Content here&lt;/div&gt;<br/>    &lt;Toaster/&gt;<br/>&lt;/div&gt;</span></pre><p id="87e0" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir">就是这样！</strong></p><p id="8d87" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">如果你想看完整的工作示例，请查看这个CodeSandbox。感谢阅读。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><p id="0a10" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">如果你喜欢这篇文章或者觉得它有用，请随意。或者，你可以在这里的Medium  <a class="ae mk" href="https://jamesmbrightman.medium.com/membership" rel="noopener"> <em class="nz">上支持我</em> </a> <em class="nz">或者给我买一杯</em> <a class="ae mk" href="https://ko-fi.com/jamesbrightman" rel="noopener ugc nofollow" target="_blank"> <em class="nz">咖啡</em> </a> <em class="nz">！非常感谢所有的支持。</em></p><p id="67a1" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><em class="nz">更多内容请看</em> <a class="ae mk" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir"> <em class="nz">说白了。报名参加我们的</em> <a class="ae mk" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir"> <em class="nz">免费周报</em> </strong> </a> <em class="nz">。关注我们关于</em><a class="ae mk" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir"><em class="nz">Twitter</em></strong></a><em class="nz">和</em><a class="ae mk" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir"><em class="nz">LinkedIn</em></strong></a><em class="nz">。加入我们的</em> <a class="ae mk" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir"> <em class="nz">社区不和谐</em> </strong> </a> <em class="nz">。</em></strong></a></p></div></div>    
</body>
</html>