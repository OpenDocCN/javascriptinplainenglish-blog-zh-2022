<html>
<head>
<title>Immutability in JavaScript: An In-Depth Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中的不变性:深入指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/3-ways-to-make-your-properties-immutable-in-javascript-681712b95bc9?source=collection_archive---------3-----------------------#2022-03-27">https://javascript.plainenglish.io/3-ways-to-make-your-properties-immutable-in-javascript-681712b95bc9?source=collection_archive---------3-----------------------#2022-03-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="add7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">深入分析JavaScript不变性原则。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1286bf771025eeb08247fbd28a55ab32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QkUoxe57C95rWrSz"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@orwhat?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Richard Horvath</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="7fb9" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">概观</h1><p id="260b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在工作中，我们会写很多常量来表示这个属性的值是不能修改的。这是第一原则，这也是软件工程被推崇的地方，也有利于重构。</p><p id="7b9b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">本文将深入讨论如何维护真正不可变的数据，并提供在不同场景中维护不可变数据结构的强大方法</p><h1 id="1c6f" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">对象.冻结</h1><p id="4620" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">你首先想到的是使用<code class="fe mp mq mr ms b"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze" rel="noopener ugc nofollow" target="_blank">Object.freeze</a></code>方法，因为它看起来足够简单，很大程度上满足了我们的要求。这是它的使用说明</p><blockquote class="mt"><p id="9c8c" class="mu mv iq bd mw mx my mz na nb nc mj dk translated">方法冻结一个对象。冻结的对象不能再被改变；冻结对象可防止向其添加新属性、删除现有属性、更改现有属性的可枚举性、可配置性或可写性，以及更改现有属性的值。</p><p id="23cf" class="mu mv iq bd mw mx my mz na nb nc mj dk translated">此外，冻结对象还可以防止其原型被更改。<code class="fe mp mq mr ms b">freeze()</code>返回传入的同一个对象。</p></blockquote><p id="87ed" class="pw-post-body-paragraph lo lp iq lq b lr nd jr lt lu ne ju lw lx nf lz ma mb ng md me mf nh mh mi mj ij bi translated">这里有一个演示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="e57e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">从例子中我们可以看到，<code class="fe mp mq mr ms b">prop</code>的值没有被更改为33，这很好，但是我们希望系统抛出一个错误，这很简单，就像在例子中，声明‘你的文件中的严格代码’来将其更改为<code class="fe mp mq mr ms b">strict mode</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/95d8f9955b5514114588c5b0f0ff1bfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/1*LF9S-n7uCO5JFuLbaXHEug.gif"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">use strict</figcaption></figure><p id="aa32" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">虽然这种模式可以实现数据的不变性，但是结果只在编译时产生，有没有更好的方法？请看下文。</p><h1 id="abd6" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">对象.定义属性</h1><blockquote class="mt"><p id="99d5" class="mu mv iq bd mw mx my mz na nb nc mj dk translated">静态方法<code class="fe mp mq mr ms b">Object.defineProperty()</code>直接在对象上定义一个新的属性，或者修改对象上已有的属性，返回对象。</p></blockquote><figure class="nl nm nn no np kk"><div class="bz fp l di"><div class="nq nj l"/></div></figure><p id="d475" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">上面的代码显示的效果和<code class="fe mp mq mr ms b">Object.freeze</code>一样。通过设置可写属性使<code class="fe mp mq mr ms b">obj</code>对象成为不可变数据，我们在一定程度上达到了我们的目的。</p><p id="0797" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">不幸的是，错误只在编译时抛出(尽管可以设置严格模式在运行时抛出错误)，当然，对于这种情况，我封装了一个非常简单的方法</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nj l"/></div></figure><p id="d429" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这个方法将在<code class="fe mp mq mr ms b">window</code>上全局挂载一个公共的惟一值。如果您试图修改它，将会抛出一个错误。</p><p id="19af" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你的数据结构是一个对象或者一个数组，尝试定义<code class="fe mp mq mr ms b">observer</code>来深度截取对象或者重写数组原型使其成为一个破坏性的方法(<code class="fe mp mq mr ms b">push, pop, unshift, splice</code> ) delete</p><h1 id="be12" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">类型脚本—只读</h1><p id="292e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">以上两种方法都很棒，也解决了我们的需求，但是为了追求完美，建议你使用TypeScript提供的<code class="fe mp mq mr ms b">readonly</code>或者<code class="fe mp mq mr ms b"> generic Readonly</code>或者速记<code class="fe mp mq mr ms b">as const</code></p><p id="9d7f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><code class="fe mp mq mr ms b">readonly</code>或者<code class="fe mp mq mr ms b">(as const)</code>有什么好处？</p><ul class=""><li id="d587" class="nr ns iq lq b lr mk lu ml lx nt mb nu mf nv mj nw nx ny nz bi translated">只读标识符将数据类型附加为只读</li><li id="8774" class="nr ns iq lq b lr oa lu ob lx oc mb od mf oe mj nw nx ny nz bi translated">readonly限制修改深层对象和多维数组的值</li><li id="3e0e" class="nr ns iq lq b lr oa lu ob lx oc mb od mf oe mj nw nx ny nz bi translated">readonly发生在运行时，这意味着它为我们提供了更完美的开发体验</li><li id="2a74" class="nr ns iq lq b lr oa lu ob lx oc mb od mf oe mj nw nx ny nz bi translated">可用于ES6级</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/5efe0f0ac1d95b476aa9b8f09a9f9624.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*vmnVDL1etKCJbjuayoyHlw.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">TypeScript — readonly</figcaption></figure><p id="4afc" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">值得一提的是<code class="fe mp mq mr ms b">readonly</code>对数组类型数据有一些优化，你不能使用对数组有破坏性的方法，这真的很棒！</p><h1 id="b10e" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">总结</h1><ul class=""><li id="1ab7" class="nr ns iq lq b lr ls lu lv lx og mb oh mf oi mj nw nx ny nz bi translated">当不使用TypeScript时，可以使用<code class="fe mp mq mr ms b">Object.defineProperty</code>拦截<code class="fe mp mq mr ms b">setter</code>并抛出错误，达到数据不变性和警告的效果</li><li id="d8cd" class="nr ns iq lq b lr oa lu ob lx oc mb od mf oe mj nw nx ny nz bi translated">如果您正在使用TypeScript，强烈建议您使用as const或readonly，<code class="fe mp mq mr ms b">Readonly (generic)</code>内置类型来修饰数据结构，以在运行时和编译时获得最佳结果</li></ul><h1 id="c913" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">了解更多信息</h1><div class="oj ok gp gr ol om"><a href="https://betterprogramming.pub/how-to-write-clean-typescript-code-eda1716eead1" rel="noopener  ugc nofollow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd ir gy z fp or fr fs os fu fw ip bi translated">如何编写干净的类型脚本代码</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">掌握如何编写优雅的TypeScript代码的8个知识点</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">better编程. pub</p></div></div><div class="ov l"><div class="ow l ox oy oz ov pa kp om"/></div></div></a></div><div class="oj ok gp gr ol om"><a href="https://medium.com/weekly-webtips/improve-your-bad-react-and-typescript-programming-habits-f4a4bf7a9105" rel="noopener follow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd ir gy z fp or fr fs os fu fw ip bi translated">改善你的不良反应和打字习惯</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">改掉你不良的编程习惯，做一个自律的人</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">medium.com</p></div></div><div class="ov l"><div class="pb l ox oy oz ov pa kp om"/></div></div></a></div><p id="40e4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><em class="pc">更多内容请看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir"><em class="pc">plain English . io</em></strong></a><em class="pc">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir"> <em class="pc">免费周报</em> </strong> </a> <em class="pc">。关注我们关于</em><a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir"><em class="pc">Twitter</em></strong></a><em class="pc">和</em><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir"><em class="pc">LinkedIn</em></strong></a><em class="pc">。加入我们的</em> <a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir"> <em class="pc">社区不和谐</em> </strong> </a> <em class="pc">。</em></p></div></div>    
</body>
</html>