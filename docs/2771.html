<html>
<head>
<title>How to Make Real-Time Multiplayer WebXR Experiences — part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何制作实时多人WebXR体验—第1部分</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-make-real-time-multiplayer-webxr-experiences-part-1-c5317765fd63?source=collection_archive---------5-----------------------#2022-07-03">https://javascript.plainenglish.io/how-to-make-real-time-multiplayer-webxr-experiences-part-1-c5317765fd63?source=collection_archive---------5-----------------------#2022-07-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="21ba" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何使用Websockets、React Three Fiber和DynamoDB来允许多个用户同时进行交互。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/f8b4f76d7a3ac028d3f69cf9d0093c19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fnjy_GJNKXZWtFDZadiu1A.jpeg"/></div></div></figure><h1 id="5231" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">介绍</h1><p id="6ee6" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">实时多人WebXR体验对互联网的未来来说是一个真正令人兴奋的前景，我们开始看到随着技术的发展如何使用它们(例如T2的术语‘元宇宙’)。</p><p id="5284" class="pw-post-body-paragraph lg lh in li b lj md jo ll lm me jr lo lp mf lr ls lt mg lv lw lx mh lz ma mb ig bi translated">在最近发布了关于<a class="ae mc" href="https://jamesmiller.blog/create-cross-device-compatible-webxr-experiences/" rel="noopener ugc nofollow" target="_blank">如何创建跨设备工作的WebXR体验</a>之后，我想更进一步，解释将这些设备上的用户连接在一起的实际步骤。</p><p id="2f8b" class="pw-post-body-paragraph lg lh in li b lj md jo ll lm me jr lo lp mf lr ls lt mg lv lw lx mh lz ma mb ig bi translated">我制作了我的合作伙伴(戴着一个<a class="ae mc" href="https://amzn.to/3nwTwKl" rel="noopener ugc nofollow" target="_blank"> Oculus Quest 2 </a>)、一个示例用户(<a class="ae mc" href="https://amzn.to/3nzh3tQ" rel="noopener ugc nofollow" target="_blank"> Macbook Pro Desktop </a>)和我自己(戴着一个<a class="ae mc" href="https://ebay.us/IrdbDh" rel="noopener ugc nofollow" target="_blank"> HoloLens 2 </a>)在共享的XR空间与一个3D模型交互的gif，见下图。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/a965a4dbc96e64f0a7961b712a3515ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gVY8KKyKM5vNSbR45w_AqQ.gif"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk">As a side note, I’m writing a library called <a class="ae mc" href="https://github.com/JamesMillerBlog/wrapper.js" rel="noopener ugc nofollow" target="_blank">Wrapper.js</a> that hopefully will help make creating collaborative WebXR experiences like the above easier.</figcaption></figure></div><div class="ab cl mn mo hr mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ig ih ii ij ik"><h1 id="964b" class="ko kp in bd kq kr mu kt ku kv mv kx ky jt mw ju la jw mx jx lc jz my ka le lf bi translated">概观</h1><p id="0f5d" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">这个web应用程序是如何构建的，以及开发它所使用的技术有很多需要理解的地方，本节将解释这些信息。</p><p id="ac8a" class="pw-post-body-paragraph lg lh in li b lj md jo ll lm me jr lo lp mf lr ls lt mg lv lw lx mh lz ma mb ig bi translated">为了充分利用这些信息，理解三个要点很重要:</p><h2 id="58ba" class="mz kp in bd kq na nb dn ku nc nd dp ky lp ne nf la lt ng nh lc lx ni nj le nk bi translated">这个概念</h2><p id="3a65" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">这个例子的工作原理是创建一个可以在不同设备上呈现的应用程序，为每个设备创建一个唯一的标识符(例如，通过用户登录)，在数据库中实时存储该设备的位置数据，然后在WebGL中呈现所有用户的数据。</p><p id="4ed7" class="pw-post-body-paragraph lg lh in li b lj md jo ll lm me jr lo lp mf lr ls lt mg lv lw lx mh lz ma mb ig bi translated">下图显示了这一概念如何在混合现实耳机(<a class="ae mc" href="https://ebay.us/IrdbDh" rel="noopener ugc nofollow" target="_blank"> HoloLens 2 </a>)、虚拟现实耳机(<a class="ae mc" href="https://amzn.to/3nwTwKl" rel="noopener ugc nofollow" target="_blank"> Oculus Quest 2 </a>)和笔记本电脑(<a class="ae mc" href="https://amzn.to/3nzh3tQ" rel="noopener ugc nofollow" target="_blank"> Macbook Pro </a>)中发挥作用。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nl"><img src="../Images/74857c08e182726277b88a9fab2a82cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cC0chfuvwUhyKB2iC5veXA.jpeg"/></div></div></figure><p id="636e" class="pw-post-body-paragraph lg lh in li b lj md jo ll lm me jr lo lp mf lr ls lt mg lv lw lx mh lz ma mb ig bi translated">对其工作原理的概括描述如下:</p><ol class=""><li id="2d5f" class="nm nn in li b lj md lm me lp no lt np lx nq mb nr ns nt nu bi translated">用户在他们的设备上访问网站，并使用他们的凭证登录，网站将根据他们的设备进行渲染(多亏了WebXR API)。</li><li id="015b" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb nr ns nt nu bi translated">当他们在环境中移动时，他们的移动坐标被实时发送到数据库，并根据他们的用户名进行存储。</li><li id="9f4f" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb nr ns nt nu bi translated">通过将其他用户的移动数据渲染到3D场景中，他们可以看到在环境中移动的其他用户。</li></ol><h2 id="91f9" class="mz kp in bd kq na nb dn ku nc nd dp ky lp ne nf la lt ng nh lc lx ni nj le nk bi translated">技术堆栈</h2><p id="7c77" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">由于这原本是为<a class="ae mc" href="https://github.com/JamesMillerBlog/wrapper.js" rel="noopener ugc nofollow" target="_blank"> Wrapper.js </a>编写的，所以它坚持使用了<a class="ae mc" href="https://www.terraform.io/" rel="noopener ugc nofollow" target="_blank"> Terraform </a>、<a class="ae mc" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>和<a class="ae mc" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a>。</p><p id="4e2f" class="pw-post-body-paragraph lg lh in li b lj md jo ll lm me jr lo lp mf lr ls lt mg lv lw lx mh lz ma mb ig bi translated">下图对此做了进一步的详细说明。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nl"><img src="../Images/82e7344ce2db84c2e14d262fcff2975b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X1aGKvoADwujkHia4_DxlQ.jpeg"/></div></div></figure><p id="b87e" class="pw-post-body-paragraph lg lh in li b lj md jo ll lm me jr lo lp mf lr ls lt mg lv lw lx mh lz ma mb ig bi translated">以下是对这三个类别的进一步解释:</p><h2 id="6c1b" class="mz kp in bd kq na nb dn ku nc nd dp ky lp ne nf la lt ng nh lc lx ni nj le nk bi translated"><strong class="ak">地形</strong></h2><p id="f9d5" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">作为代码库的基础架构管理除后端逻辑之外的所有云基础架构:</p><ul class=""><li id="6333" class="nm nn in li b lj md lm me lp no lt np lx nq mb oa ns nt nu bi translated"><strong class="li io">Amazon API Gateway</strong>(HTTP和Websocket实现)，无服务器框架中的lambda函数部署到该网关。</li><li id="baae" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb oa ns nt nu bi translated"><strong class="li io"> DynamoDB </strong>用于存储前端通过HTTP和Websocket请求向API网关提交和检索的数据。</li><li id="beb3" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb oa ns nt nu bi translated"><strong class="li io">亚马逊S3 </strong>，用于部署Next.js导出的前端静态文件</li><li id="a4e9" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb oa ns nt nu bi translated"><strong class="li io"> Cloudfront </strong>，内容交付网络(CDN)允许在边缘访问您的内容，也允许您使用自定义域名访问您的内容。</li><li id="f39f" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb oa ns nt nu bi translated"><strong class="li io"> Route53 </strong>，将你的域名分配给你的云前端CDN和API网关的DNS记录。</li><li id="4abc" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb oa ns nt nu bi translated">亚马逊证书管理器，为你的域名生成SSL证书。</li><li id="e5e6" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb oa ns nt nu bi translated"><strong class="li io"> AWS Cognito </strong>是一项管理用户登录信息的服务，用作联合身份以授权web应用的前端登录和数据的后端访问。</li></ul><h2 id="e1d1" class="mz kp in bd kq na nb dn ku nc nd dp ky lp ne nf la lt ng nh lc lx ni nj le nk bi translated"><strong class="ak">无服务器框架</strong></h2><p id="bba4" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">作为代码库的基础设施，用于管理后端逻辑Lambdas的本地开发和部署:</p><ul class=""><li id="e617" class="nm nn in li b lj md lm me lp no lt np lx nq mb oa ns nt nu bi translated"><strong class="li io"> Lambda函数</strong>部署到API网关(在Terraform中创建)并执行Node.js中编写的后端逻辑。</li></ul><h2 id="01c7" class="mz kp in bd kq na nb dn ku nc nd dp ky lp ne nf la lt ng nh lc lx ni nj le nk bi translated"><strong class="ak"> Next.js </strong></h2><p id="50d1" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">React框架将所有前端2D和3D逻辑构建到一个易于导航的组件架构中。</p><ul class=""><li id="9d0a" class="nm nn in li b lj md lm me lp no lt np lx nq mb oa ns nt nu bi translated"><strong class="li io"> AWS Amplify </strong>是一个用于前端的库，提供开箱即用的组件和助手功能，使用户登录变得简单而安全。</li><li id="2a55" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb oa ns nt nu bi translated">Zustand 是一个库，帮助你在你的应用程序中实现简单的全局状态管理。</li><li id="590d" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb oa ns nt nu bi translated"><strong class="li io"> React-Three-XR </strong>是一个允许React-Three-Fiber应用利用WebXR API的库。</li><li id="20f7" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb oa ns nt nu bi translated"><strong class="li io"> React-Three-Fiber </strong>，一个让Three.js集成到React组件简单、快速、高效的库。</li><li id="2f1a" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb oa ns nt nu bi translated"><strong class="li io"> Three.js </strong>是一个允许你通过使用WebGL在浏览器中创建3D内容的库。</li><li id="91ab" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb oa ns nt nu bi translated"><strong class="li io"> React </strong>是一个允许你组件化你的JavaScript的库。</li></ul><h2 id="11c6" class="mz kp in bd kq na nb dn ku nc nd dp ky lp ne nf la lt ng nh lc lx ni nj le nk bi translated">应用程序流程</h2><p id="9031" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">如果您计划在本例中何时使用这些技术，它看起来会像下面的图表。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ob"><img src="../Images/895b1af4bcb1f7c9ec636f7d20d9381d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KntG5ahZWT0J2vgxqKxcoA.jpeg"/></div></div></figure><p id="62de" class="pw-post-body-paragraph lg lh in li b lj md jo ll lm me jr lo lp mf lr ls lt mg lv lw lx mh lz ma mb ig bi translated">如果您从图的底部开始，您可以看到所有前端文件都被静态导出并托管在<strong class="li io"> S3存储桶</strong>上。</p><p id="189a" class="pw-post-body-paragraph lg lh in li b lj md jo ll lm me jr lo lp mf lr ls lt mg lv lw lx mh lz ma mb ig bi translated">这些文件随后通过<strong class="li io"> Cloudfront CDN </strong>分发，由<strong class="li io"> AWS证书管理器</strong>分配SSL证书，并提供带有<strong class="li io"> Amazon Route 53 </strong>的自定义域名。</p><p id="2002" class="pw-post-body-paragraph lg lh in li b lj md jo ll lm me jr lo lp mf lr ls lt mg lv lw lx mh lz ma mb ig bi translated">此时，第1步开始:</p><ul class=""><li id="77ca" class="nm nn in li b lj md lm me lp no lt np lx nq mb oa ns nt nu bi translated">用户通过访问域名在他们的设备上打开网站(例如<a class="ae mc" href="https://ebay.us/IrdbDh" rel="noopener ugc nofollow" target="_blank">全息透镜2 </a>)。</li><li id="d761" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb oa ns nt nu bi translated">此时，<strong class="li io"> React-Three-XR </strong>根据设备的能力(在这种情况下是混合现实耳机)呈现网站。</li></ul><p id="4ff0" class="pw-post-body-paragraph lg lh in li b lj md jo ll lm me jr lo lp mf lr ls lt mg lv lw lx mh lz ma mb ig bi translated">接下来是第二步:</p><ul class=""><li id="9140" class="nm nn in li b lj md lm me lp no lt np lx nq mb oa ns nt nu bi translated">用户使用前端的<strong class="li io"> AWS Amplify </strong>库登录到他们的<strong class="li io"> AWS Cognito </strong>账户。</li><li id="e277" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb oa ns nt nu bi translated">登录后，网站现在有了使用该设备的人的唯一标识符。</li></ul><p id="8c7f" class="pw-post-body-paragraph lg lh in li b lj md jo ll lm me jr lo lp mf lr ls lt mg lv lw lx mh lz ma mb ig bi translated">一旦用户成功登录并唯一地标识了自己，这就为第3步做好了准备:</p><ul class=""><li id="5a62" class="nm nn in li b lj md lm me lp no lt np lx nq mb oa ns nt nu bi translated">用户可以与两种API进行交互——HTTP和WebSockets 。</li><li id="3d4a" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb oa ns nt nu bi translated">调用一次<strong class="li io"> HTTP </strong> API来获取用户的图像，然后可以在WebGL: <br/> -一旦调用了API，就会触发一个<strong class="li io"> lambda </strong>，它使用用户的登录详细信息来查询数据库中的信息。<br/>-<strong class="li io">Amazon dynamo db</strong>数据库存储了与用户登录凭证相关的信息，比如个人资料图片URL。</li><li id="f2b6" class="nm nn in li b lj nv lm nw lp nx lt ny lx nz mb oa ns nt nu bi translated"><strong class="li io"> WebSocket </strong> API在前端需要更新数据库以及数据库有更新时被调用:<br/> -当用户在3D世界中移动时，他们的位置坐标被实时提交给<strong class="li io"> WebSocket </strong> API。<br/> -一旦API被触发，一个<strong class="li io">λ</strong>函数获取提交的数据并将其保存到<strong class="li io"> DynamoDB </strong>数据库中。<br/> -一旦数据被保存到数据库中，所有数据将被返回到前端，在那里3D渲染器将所有物体的位置数据可视化。</li></ul></div><div class="ab cl mn mo hr mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ig ih ii ij ik"><h1 id="7703" class="ko kp in bd kq kr mu kt ku kv mv kx ky jt mw ju la jw mx jx lc jz my ka le lf bi translated">结论</h1><p id="eaef" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">我尽力简化了这篇文章中的概念，以帮助理解实时多人WebXR体验的过程。</p><p id="0786" class="pw-post-body-paragraph lg lh in li b lj md jo ll lm me jr lo lp mf lr ls lt mg lv lw lx mh lz ma mb ig bi translated">在下一篇文章中，我将详细介绍用于实时呈现多个用户位置的实际代码。</p><p id="68b5" class="pw-post-body-paragraph lg lh in li b lj md jo ll lm me jr lo lp mf lr ls lt mg lv lw lx mh lz ma mb ig bi translated">同时，希望你喜欢这篇文章，玩得开心。:D</p><p id="2848" class="pw-post-body-paragraph lg lh in li b lj md jo ll lm me jr lo lp mf lr ls lt mg lv lw lx mh lz ma mb ig bi translated"><em class="oc">更多内容请看</em><a class="ae mc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="li io"><em class="oc">plain English . io</em></strong></a><em class="oc">。报名参加我们的</em> <a class="ae mc" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="li io"> <em class="oc">免费周报</em> </strong> </a> <em class="oc">。关注我们关于</em><a class="ae mc" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="li io"><em class="oc">Twitter</em></strong></a><em class="oc">和</em><a class="ae mc" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="li io"><em class="oc">LinkedIn</em></strong></a><em class="oc">。查看我们的</em> <a class="ae mc" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="li io"> <em class="oc">社区不和谐</em> </strong> </a> <em class="oc">加入我们的</em> <a class="ae mc" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="li io"> <em class="oc">人才集体</em> </strong> </a> <em class="oc">。</em></p></div></div>    
</body>
</html>