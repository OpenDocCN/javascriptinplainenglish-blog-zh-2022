<html>
<head>
<title>Vue’s Composition API Has Serious Issues</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue的合成API有严重的问题</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/vues-composition-api-has-serious-issues-4ce71a0a1f36?source=collection_archive---------1-----------------------#2022-05-20">https://javascript.plainenglish.io/vues-composition-api-has-serious-issues-4ce71a0a1f36?source=collection_archive---------1-----------------------#2022-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/672f3b8999a9adc5d54a6f95edde7f4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BXzplnYsbD6HKc93"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Source: energepic.com</figcaption></figure><p id="f423" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">上个月，我发表了一篇<a class="ae la" href="https://medium.com/p/999bb8c556bf" rel="noopener">有争议的文章</a>，其中我讨论了许多使用Vue编写和扩展web应用程序的缺点。</p><p id="5b26" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">许多回复都提到了新的<strong class="ke ir">组合API </strong>作为这些问题的潜在解决方案。我承认当我写这篇文章时，我对它只是一知半解，所以我决定对它进行更彻底的研究。</p><p id="f635" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一开始看起来很有希望。旨在简化逻辑重用和改进TypeScript支持的复合API在概念上让我想起了React钩子。事实上，Vue团队说钩子是组合API的一个很大的灵感来源。</p><p id="e009" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我相信它和Hooks的相似性意味着我可以很快学会新的API，并且会像我喜欢Hooks一样喜欢它。<strong class="ke ir">我在这两方面都错了。</strong></p><p id="ba84" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">但是在我讨论这些问题之前，我将试图为组合API及其动机辩护。</p><h1 id="ad0e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">混血儿…很乱</h1><p id="f17e" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">在旧版本的Vue中，在组件之间重用逻辑的唯一方式是mixin。Mixins允许您定义方法、计算属性和其他可重用的代码，您可以通过简单的导入从任何组件调用这些代码。</p><p id="d6a8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">起初，这似乎是一个好的解决方案，但是mixins有一些严重的缺陷。基本上，将大量代码混合在一起创建一个组件只会导致一片混乱。</p><p id="eee9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了解决逻辑重用的问题，React引入了函数组件和Hooks API，而不是mixins，React社区立即接受了这些组件。</p><p id="4299" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Vue的最新解决方案是Composition API，它从Hooks中汲取了大量灵感。高级方法是相同的——创建可以从任何组件导入并使用的少量反应式逻辑，就好像该逻辑是组件本身固有的一样。</p><p id="2e94" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我真的很乐观，这个新的API将解决Vue的主要问题。的确，在很大程度上……但是它也创造了更多的问题。</p><h1 id="a779" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">学起来不容易</h1><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/5e07014a0f0edc0cf5da305d4bbc0e6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BPbt2kW8_OpyuoEg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Source: valamis.com</figcaption></figure><p id="3497" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">你可能会认为受Hooks启发的API对喜欢Hooks的开发人员来说很熟悉。从高层次来看，的确如此。但是经过更深入的研究，我清楚地认识到这两个API是根本不同的。</p><p id="973f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我学习Composition API的第一个小时，充满了迷茫和挫败感。我很快意识到，因为Vue具有真正的反应能力React所缺乏的——这个新的API需要一个与Hooks完全不同的心智模型。</p><p id="1738" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">更重要的是，尽管React只有几个基本的钩子，但Composition API引入了无数不同的实用函数，用于创建反应变量、监视这些变量、基于这些变量进行计算，以及在组件生命周期的不同点运行代码。</p><p id="eefb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">例如，创建反应变量有两种方法:<code class="fe mj mk ml mm b">ref</code>和<code class="fe mj mk ml mm b">reactive</code>。有什么区别？<code class="fe mj mk ml mm b">reactive</code>不能控制原语，而<code class="fe mj mk ml mm b">ref</code>可以控制原语和原语，但是<code class="fe mj mk ml mm b">ref</code>没有深度反应。此外，你要负责跟踪哪些变量是反应性的，以及它们是否是深度反应性的。</p><p id="9a9b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">另一方面，React只有一个钩子和一个非常简单的API来实现这个目的:<code class="fe mj mk ml mm b">useState</code>。(<code class="fe mj mk ml mm b">useReducer</code>也有，但是<code class="fe mj mk ml mm b">useState</code>在大多数情况下都是你需要的。)</p><p id="aefc" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果想在复合API中观察一个反应性变量怎么办？您可以使用<code class="fe mj mk ml mm b">watch</code>，它可以观察refs、reactive对象或getter (computed)函数——但是要观察reactive对象的属性，您需要使用getter函数。如果您想在反应变量改变时立即运行副作用<em class="mn">和</em>，您需要使用<code class="fe mj mk ml mm b">watchEffect</code>。</p><p id="ece0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">React的对应版本是<code class="fe mj mk ml mm b">useEffect</code>，它也有一些令人困惑的怪癖，但公开了一个简单得多的API。</p><p id="6586" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在也有三种完全不同的方式来定义Vue组件:选项API、带有<code class="fe mj mk ml mm b">setup()</code>函数的组合API和带有神奇的<code class="fe mj mk ml mm b">&lt;script setup&gt;</code>简写的组合API。这意味着你必须做出更多的决定，这些决定可能会导致不一致或者将来后悔。</p><p id="5999" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因此，虽然组合API确实提供了大量的灵活性和实用性，但它也引入了复杂性和陡峭的学习曲线。</p><p id="345f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">但是有些人会——而且许多人已经这样做了——公开接受这个新的API。这很好。当掌握后，我确信它和钩子一样强大。</p><p id="807a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这里更大的担忧是这一切对Vue的未来意味着什么。</p><h1 id="6e77" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">分裂的房子</h1><p id="29e2" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">组合API在很大程度上解决了它想要解决的许多问题。然而许多Vue开发者仍然拒绝采用它。他们认为，对于他们的用例来说，它的好处根本不值得学习曲线和增加复杂性的成本。那些采用它的人通常只是部分采用，而让他们的许多组件使用Options API。</p><p id="d7fa" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">所以，Vue有点分裂了。一方是开发人员，他们喜欢它简单的选项API，认为很少或没有必要采用一个API来解决他们没有的问题。</p><p id="3298" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">另一方面，开发人员迫切需要更大的可伸缩性和改进的TypeScript支持，并将复合API视为更现代的反应式UI开发方法。</p><p id="11cc" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">并且都想使用同一个库。</p><p id="03a1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">目前，以及在可预见的未来，这是可能的。这两种API都受支持，并且在同一个项目中兼容。</p><p id="d765" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">但是一个分裂的家庭是站不住脚的。当React发布Hooks时，很明显这是React团队希望库走的方向——而且(几乎)每个人都喜欢它。那些不只是离开反应为其他图书馆如Vue。</p><p id="2caa" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然而，Vue的团队似乎不确定他们想要什么。从长远来看，继续支持和开发两种完全不同的API是不可持续的。</p><p id="a43d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当然，这些都不意味着Vue注定要失败。相反，这是尤雨溪和他的公司为Vue书写新的前进道路的黄金机会。但很难想象有哪一个不会让很多人不高兴。</p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><p id="f5a0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="mn">更多内容请看</em><a class="ae la" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir"><em class="mn">plain English . io</em></strong></a><em class="mn">。报名参加我们的</em> <a class="ae la" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> <em class="mn">免费周报</em> </strong> </a> <em class="mn">。关注我们关于</em><a class="ae la" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir"><em class="mn">Twitter</em></strong></a><em class="mn">和</em><a class="ae la" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir"><em class="mn">LinkedIn</em></strong></a><em class="mn">。查看我们的</em> <a class="ae la" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> <em class="mn">社区不和谐</em> </strong> </a> <em class="mn">加入我们的</em> <a class="ae la" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> <em class="mn">人才集体</em> </strong> </a> <em class="mn">。</em></p></div></div>    
</body>
</html>