<html>
<head>
<title>How to Manage Fragile Legacy Code?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何管理脆弱的遗留代码？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-manage-fragile-legacy-code-675fca7e8fc6?source=collection_archive---------20-----------------------#2022-01-28">https://javascript.plainenglish.io/how-to-manage-fragile-legacy-code-675fca7e8fc6?source=collection_archive---------20-----------------------#2022-01-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e5c341d2f9d52fb1888e8b31b477c2d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u51YxvhSViYbhiUYKKpo1A.jpeg"/></div></div></figure><p id="f21b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">欢迎来到现实世界！做完所有过于简化的学习例子后，你就开始了你的第一份IT工作。很有可能在做了一些准备工作后，你会意识到你正在做的项目中有一些讨厌的旧代码。如果你幸运的话，你的团队中有人试图保护你不要冒险进入那个黑暗的领域，但你可以肯定这不会永远持续下去。在某些时候，你需要面对现实——你的许多日常工作将包括维护遗留代码库。</p><p id="f92b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们看看如何让这种体验尽可能易于管理。</p><h1 id="ecdf" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">浏览代码</h1><p id="24ab" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">获取代码，并稍微钻研一下。现有的代码可能会令人困惑，文件可能会太大，一切都可能会感觉一团糟。首先，您可以关注文件结构来寻找模式。在一个历史悠久且很少关注一致性的项目中，你很可能会发现以一种看似随机的方式使用了相互竞争的设计。在这种情况下，只是试图找出它有多糟糕，并将系统化留到以后。</p><p id="1a23" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看完代码后，让我们评估文档的状态。应该有某种自述文件。也许它已经过时了，但至少它提到了创建代码库时使用的思想。你可以尝试更新信息，因为你发现一些过时的零件。一个很好的开始是整合你在电子邮件和其他关于项目的交流中收到的信息，并确保它在自述文件中得到反映和链接。此外，确保你定期更新它，以便项目中的下一个人有一个更容易的开始。</p><h1 id="7c2e" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">弄清楚建造过程</h1><p id="ef80" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">我最近完成了一个角度升级课程，它的最后一次更新是在三年前。第一个视频是在Angular 4上，这个版本太旧了，与最新的Node.js和芯片组架构存在兼容性问题。在我可以在我的机器上构建它之前，我经历了一连串的强制升级——这只是在一个小的示例项目中。您在现实世界中继承的项目可能会处于更糟糕的状态。</p><p id="b200" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望您成功构建项目所需要的是</p><ol class=""><li id="31c9" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv me mf mg mh bi translated">自述文件或其他文档中涉及的内容，</li><li id="ee8d" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">仍然是最新的，而且</li><li id="f826" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">按预期工作。</li></ol><p id="2e72" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最有可能的是，你的项目将无法满足这些要点，让你自己去解决。如果失败，您可以搜索错误并查看是什么导致了它。</p><p id="893d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果文档中没有任何有帮助的内容，那么下一个要检查的地方就是<code class="fe mn mo mp mq b">package.json</code>。在<code class="fe mn mo mp mq b">"scripts"</code>中可以有一些类似构建的命令。在最糟糕的情况下，您可以搜索任何过去流行的构建工具的痕迹，并从事一种JavaScript考古学:</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/993abb77faa913818684ace3d29cd59e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NwtFPdcxc_dIQOSe"/></div></div></figure><h1 id="25b1" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">和部署</h1><p id="da7c" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">那也很有趣。不知道你的系统在哪里运行是非常令人沮丧的:它让你担心如果它们崩溃了会发生什么。我们有一个内部聊天机器人，我们几个月都搞不清楚它住在哪里。对于更关键的系统来说，这些信息应该更容易获得，但是这些事情通常需要比预期更多的时间。</p><p id="1b1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">了解生产部署的所有细节可能会花费大量时间。您可能会因为没有正确的用户、缺少某些领域的凭据，以及必须仔细检查一切以避免损坏而被阻止。恭喜你！您可以在您的机器上进行代码更改，以使其投入生产。你的工作会产生影响。</p><h1 id="3391" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">调查现有质量保证(QA)措施:</h1><p id="0c78" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">类似于你为构建所做的，试着找到任何存在的东西</p><p id="9525" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果没有记录并且没有在<code class="fe mn mo mp mq b">package.json</code>的脚本中定义，您可以搜索一些过去常见的工具。</p><ul class=""><li id="bc0b" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv mv mf mg mh bi translated">综合测试:量角器<strong class="ka ir">、</strong>硒</li><li id="47e7" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv mv mf mg mh bi translated">单元测试:茉莉<strong class="ka ir">、</strong>摩卡、西农</li><li id="b488" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv mv mf mg mh bi translated">林挺:jslint <strong class="ka ir">，</strong> jshint，tslint</li></ul><p id="e967" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果在过去有任何自动化QA措施的痕迹，尽可能地重用它们。过去开发人员建立的所有东西都有真正的价值，如果把它们都扔掉，那将是一种耻辱。</p><h1 id="09cd" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">建立冒烟测试</h1><p id="4cd1" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">如果你正在修复一个旧的引擎，在第一次尝试时，你将在没有任何负载的情况下启动它，看看它是否能在不燃烧的情况下工作。这就是所谓的烟雾测试——只要我们看不到烟雾，一切都很好。遗留代码也是如此:当您没有任何东西来彻底测试应用程序时，您至少可以构建它并查看应用程序是否正确启动。在您能够自动运行更复杂的测试之前，您最好将自己限制在简单的更改上，并使用相同的基本过程来确保一切都按预期运行。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/115ae26ab9fba8ac937831b1bf7e8459.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FfQql7VTP7f63zyk"/></div></div></figure><h1 id="9c34" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">从微小的改变开始</h1><p id="d120" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">项目复兴过程进行得相当顺利；您现在已经准备好开始执行代码更改了。从小事做起，从没人会注意到的事情做起。你可以</p><ul class=""><li id="bffb" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv mv mf mg mh bi translated">更新某库的补丁版本，</li><li id="1afb" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv mv mf mg mh bi translated">重命名一些局部变量，或者</li><li id="e659" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv mv mf mg mh bi translated">在一个地方重构出一些烦人的反模式。</li></ul><p id="5188" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">记住你的目标是做出一个几乎肯定没有副作用的改变。</p><h1 id="dee5" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">部署到生产环境</h1><p id="4e8d" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">用您的小改动构建代码，并将其部署到所有环境中，直到生产环境。你的目标是为这个恢复的过程做一个例子——将代码变更从你的头脑中传递到客户的机器上。它本身就够有挑战性了；这就是为什么我们保持我们的变化范围最小化。你的目标是在这个过程中给你自己和利益相关者信心。</p><h1 id="645b" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">添加集成测试</h1><p id="29bd" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">最有可能的是，您将不得不从头开始构建集成测试。我指的是那些检查所有东西都集成并一起工作的测试。另一个名字是端到端(e2e ),因为你经常同时测试前端和后端。您应该从这里开始，因为当您开始新的交易时，如果应用程序失败，您是否正确计算了增值税并不重要。首先，为许多页面开发简单的测试比只为少数页面开发精确的测试更有意义。一个简单的测试，如访问一个路由并检查关键界面元素是否仍然存在，可以提供很多价值——这可以捕捉到一些页面完全断开的情况。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ae30b591adceaaad383bd41add6c873e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X7tHLd0T0QC8s2zf"/></div></div></figure><h1 id="6658" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">设置并开始添加单元测试</h1><p id="4980" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">一旦您知道应用程序正在按预期启动，您就可以进入细节并查看所有的单元——类、函数等。-正在按预期工作。您可以从用户界面级别测试它们，但是端到端测试是:</p><ul class=""><li id="9497" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv mv mf mg mh bi translated">写得慢—在正确的位置获取正确的数据需要大量时间</li><li id="411e" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv mv mf mg mh bi translated">运行缓慢—运行数据库、后端和浏览器会占用大量资源</li></ul><p id="b162" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您不希望将所有可以想象的边缘情况都塞进您的集成设置中，而是希望为更多的细节建立一个单独的测试。你想要单元测试。他们:</p><ul class=""><li id="3e1b" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv mv mf mg mh bi translated">比e2e跑快几个数量级</li><li id="0510" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv mv mf mg mh bi translated">与后端和数据库断开连接</li><li id="68ff" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv mv mf mg mh bi translated">允许测试应用程序的原子部分，而不管周围的代码和工作流</li></ul><p id="6134" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">想了解更多？在这里你可以找到我写单元测试的理由。</p><h1 id="b0d5" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">Lint代码</h1><p id="74d5" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Linters是代码的静态分析，旨在指出常见问题的根源。有一个常规的检查来检查你的代码并告诉你这里一切都好，这很好。<a class="ae mw" href="https://eslint.org/" rel="noopener ugc nofollow" target="_blank"> eslint </a>，一个流行的JavaScript和TypeScript的linter，允许很多配置。您可以将配置设置为只捕捉最有问题的问题，修复整个代码库，并将其与您的代码编辑器集成。为了从设置中获得更多的价值，您可以继续迭代配置——打开或关闭不同的规则，并添加特定于框架的插件。这样，您将能够使您的代码更有可能随着时间的推移而改进；而且同时每一步都会很小，不会一下子占用你太多时间。</p><h1 id="0d7e" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">强制编码风格</h1><p id="fdac" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">坚持相同的格式会使代码更容易阅读:这样，就不会有格式怪异的地方因为错误的原因吸引你的注意。代码库中的一致性带来了一种有序感，并使人们更容易信任项目的当前状态。编码风格会引发很多激烈的讨论。我不太关心特定的格式；我只想做同样的事情，不管是谁什么时候写的代码，我喜欢自动应用的风格。幸运的是，现在我们有固执己见的工具，如<a class="ae mw" href="https://prettier.io/" rel="noopener ugc nofollow" target="_blank">prettle</a>，它可以在一瞬间格式化整个项目，只留下几个选项供团队内部讨论。因此，您可以将格式化本身和无休止的讨论外包给外部工具！</p><p id="c5ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，让我们做一些最后的热身工作。您可以尝试将一些依赖项从一个补丁版本更新到一个较新的版本，例如，从版本1.2.3更新到1.2.4。您的代码可能使用了它所使用的每一个第三方库的旧版本。升级它们需要大量的工作，这样做是一项不错的投资:新版本通常会有一些新功能、安全补丁和更多在线资料。即使是补丁升级也是一个不小的变化，我们在这里做了所有的工作，我们应该期待两个结果之一:</p><ul class=""><li id="3a72" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv mv mf mg mh bi translated">更新后失败，但被我们的一个验证层捕获，或者</li><li id="ba85" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv mv mf mg mh bi translated">一切都很好——无论是在测试中，还是在部署后的生产中。</li></ul><p id="e6bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">确保你不要急于更新！一次做一个，发布，等待反馈。记住，你是在教人们相信你的改变，你最不需要的就是一些回归。</p><h1 id="09d3" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">做出最微小、最直接的面向用户的改进</h1><p id="f61f" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">到目前为止，你的工作对用户来说几乎是不可见的——除非你设法在某个时候中断了生产。所有基础设施就绪后，您就可以交付一些价值了！选择你能找到的最小和最简单的问题——某页上的一个打字错误或按钮上的一个空白。你的目标是向你自己和其他人证明你可以在不破坏任何东西的情况下修复问题和交付代码变更。不要因为试图做一些令人印象深刻的事情而搞砸了。</p><h1 id="1ec1" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">设置持续集成(CI)</h1><p id="2fce" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">如果项目真的起死回生，更多的变更请求将会到来。在这种情况下，建立持续集成是有意义的。如果你有兴趣了解更多，请在<a class="ae mw" href="https://strawpoll.com/jezdjoe8u" rel="noopener ugc nofollow" target="_blank">调查</a>中告诉我。</p><h1 id="45cf" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">下一步是什么？</h1><p id="02c2" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">恭喜你！您是遗留代码的新联系人。享受你新获得的工作保障——工作必须完成，而且没有人愿意去做。这是一个很好的机会来仔细检查你的薪酬是否符合市场水平，是否涵盖了你为公司提供的价值- <a class="ae mw" href="https://how-to.dev/how-to-get-a-pay-raise-in-it" rel="noopener ugc nofollow" target="_blank">点击这里阅读更多信息</a>。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><p id="772c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ne">最初发布于</em><a class="ae mw" href="https://how-to.dev/how-to-manage-fragile-legacy-code" rel="noopener ugc nofollow" target="_blank"><em class="ne">https://how-to . dev</em></a><em class="ne">。</em></p><p id="c0ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ne">更多内容看</em> <a class="ae mw" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="ne">说白了。报名参加我们的</em> <a class="ae mw" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="ne">免费周报</em> </strong> </a> <em class="ne">。在我们的</em> <a class="ae mw" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="ne">社区不和谐</em> </strong> </a> <em class="ne">获得独家获取写作机会和建议。</em></strong></a></p></div></div>    
</body>
</html>