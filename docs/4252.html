<html>
<head>
<title>How to Use Context API in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React中使用上下文API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-context-api-in-react-4d6293c9e032?source=collection_archive---------8-----------------------#2022-11-14">https://javascript.plainenglish.io/how-to-use-context-api-in-react-4d6293c9e032?source=collection_archive---------8-----------------------#2022-11-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/5e21e8998682c53e7a51bcb3c2e6dd12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ua6mUKpdR_DBuxWk"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@flowforfrank?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ferenc Almasi</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="cf72" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">什么是语境？</strong> <br/>在外行人的术语中，语境的意思是“<em class="ky">某事发生或导致某事发生的情况</em>”。</p><p id="391a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">React中上下文的重要性<br/> </strong>根据上面的定义，React上下文将提供一个封装，在这个封装中，变量发生了变化，我们在相同的上下文中访问相同的变量。这里要注意的重要一点是，这种封装可以包含多个组件，因此有助于组件之间的变量共享或从顶部到底部组件的变量传播，反之亦然。</p><p id="375f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们尝试实现一个基本场景，以便更好地理解这一点。</p><p id="ba09" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">用例</strong></p><p id="b670" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将实现一个基本的计数器应用程序。</p><figure class="la lb lc ld gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi kz"><img src="../Images/f534ef0dc10b9ceec5cbb8f72615204f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r0Pmvhe2GAnPtkpO-BPwBA.png"/></div></div></figure><p id="41cd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">用户点击“增加计数器”按钮后，计数器值增加1。</p><figure class="la lb lc ld gt jo gh gi paragraph-image"><div class="gh gi le"><img src="../Images/70c01e427a0bf8c0de997e37fddda2d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*II7l9B5qdpFCqSS6971jyQ.png"/></div></figure><p id="20e1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里需要注意的重要一点是，显示值的按钮和标题在不同的组件中，我们在组件之间实时共享值。</p><p id="8b82" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们看看如何实现用例</p><ul class=""><li id="d820" class="lf lg in kc b kd ke kh ki kl lh kp li kt lj kx lk ll lm ln bi translated">首先，我们将做react应用程序的基础搭建</li></ul><pre class="la lb lc ld gt lo lp lq bn lr ls bi"><span id="c66b" class="lt lu in lp b be lv lw l lx ly">npx create react-app counter template=typescript</span></pre><p id="134c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上述命令将创建一个基本的React应用程序。</p><p id="7d67" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我们将创建两个基本组件。</p><p id="2c66" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">割台组件</strong></p><pre class="la lb lc ld gt lo lp lq bn lr ls bi"><span id="b6a7" class="lt lu in lp b be lv lw l lx ly">// Header.tsx<br/><br/>const Header = () =&gt; {<br/>    return(<br/>        &lt;h1&gt;Counter value is &lt;/h1&gt;<br/>    )<br/>}<br/><br/>export default Header;</span></pre><p id="a253" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">车身部件</strong></p><pre class="la lb lc ld gt lo lp lq bn lr ls bi"><span id="c7dc" class="lt lu in lp b be lv lw l lx ly"><br/>// Body.tsx<br/><br/>const Body = () =&gt; {<br/>    const incCounter = () =&gt; {<br/>        <br/>    }<br/>    return(<br/>        &lt;button onClick={incCounter}&gt;<br/>            Increase Counter<br/>        &lt;/button&gt;<br/>    )<br/>}<br/><br/>export default Body</span></pre><p id="e8a4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">更新App.tsx </strong>,删除返回块中的所有代码</p><pre class="la lb lc ld gt lo lp lq bn lr ls bi"><span id="40b7" class="lt lu in lp b be lv lw l lx ly">// App.tsx<br/> <br/>return (<br/>    &lt;&gt;<br/>      &lt;Header/&gt;<br/>      &lt;Body/&gt;<br/>    &lt;/&gt;<br/>  );</span></pre><p id="552f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们已经有了基本的结构，现在我们将深入实现上下文。</p><ol class=""><li id="b308" class="lf lg in kc b kd ke kh ki kl lh kp li kt lj kx lz ll lm ln bi translated">创建一个名为CounterContext.tsx的文件，并添加以下代码</li></ol><pre class="la lb lc ld gt lo lp lq bn lr ls bi"><span id="1b79" class="lt lu in lp b be lv lw l lx ly">import { createContext, useState } from "react";<br/><br/>// Step 1<br/>const CounterContext = createContext({<br/>counter : 0,<br/>handleCounter : () =&gt; {}<br/>});<br/><br/>// Step 2<br/>const CounterProvider = ({children}:{children:any}) =&gt; {<br/>// Step 3<br/>const [counter,setCounter] = useState(0);<br/>//Step 4<br/>const handleCounter = () =&gt; {<br/>setCounter((prevValue:any) =&gt; prevValue + 1);<br/>}<br/>//Step 5<br/>const counterObj = {counter,handleCounter}<br/>// Step 6<br/>return(<br/>&lt;CounterContext.Provider value={counterObj}&gt;<br/>{children}<br/>&lt;/CounterContext.Provider&gt;<br/>)<br/>}<br/>// Step 7<br/>export { CounterProvider , CounterContext}</span></pre><p id="32d5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">不要被这么多行代码吓倒，因为这是上下文的基本要点，我们将一步一步地检查每一行。</p><ol class=""><li id="487e" class="lf lg in kc b kd ke kh ki kl lh kp li kt lj kx lz ll lm ln bi translated">在<strong class="kc io">步骤1 </strong>中，我们使用名为反上下文的<strong class="kc io"> createContext </strong>创建了上下文。createContext是react提供的一种方法，它有助于创建一个上下文，其中所有组件都封装在需要访问或共享变量的地方。这里要注意的另一件事是，createContext应该公开我们需要在封装组件中访问的变量和方法，例如，在我们的示例中，counter变量和handleCounter方法被公开。</li><li id="1e75" class="lf lg in kc b kd ma kh mb kl mc kp md kt me kx lz ll lm ln bi translated">在步骤1中创建的上下文有一个提供者反应组件。使用这个提供者的优点是，它提供了一个包装器，我们可以在其中包装所有想要订阅上下文更改的组件。在<strong class="kc io">步骤2 </strong>中，我们创建了一个名为<strong class="kc io"> CounterProvider </strong>的函数，它返回一个react Provider组件。</li><li id="a385" class="lf lg in kc b kd ma kh mb kl mc kp md kt me kx lz ll lm ln bi translated">在<strong class="kc io">步骤3 </strong>中，我们简单地创建了一个计数器变量，并使用setCounter为其创建了useState钩子和setter。</li><li id="90a6" class="lf lg in kc b kd ma kh mb kl mc kp md kt me kx lz ll lm ln bi translated">在<strong class="kc io">步骤4 </strong>中，我们创建了handleCounter方法，该方法将触发计数器变量的setter。</li><li id="e619" class="lf lg in kc b kd ma kh mb kl mc kp md kt me kx lz ll lm ln bi translated"><strong class="kc io">第5步</strong>是真正的业务，在这里我们定义了属性、方法，我们需要将这些属性、方法公开给我们包装了Provider的组件。请注意，步骤1中定义的对象结构应该与此处定义的对象结构匹配，否则将出现类型不匹配错误。您可以将步骤1中定义的结构视为别名，将步骤5中定义的结构视为真正的实现。</li><li id="7d77" class="lf lg in kc b kd ma kh mb kl mc kp md kt me kx lz ll lm ln bi translated">在步骤2中返回的提供程序反应组件需要一个value provider，我们在其中传递了在步骤5中定义的对象，这样就可以在封闭组件中使用该对象。</li><li id="89e3" class="lf lg in kc b kd ma kh mb kl mc kp md kt me kx lz ll lm ln bi translated">最后，在<strong class="kc io">步骤7 </strong>中，我们导出了这样创建的上下文和提供者，可以在外部访问它们。</li></ol><p id="08da" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过上面提到的步骤，我们已经完成了CounterContext的实现，在大多数情况下，这是所需的7个基本步骤，棘手的用例和复杂性可能会有所不同。</p><p id="c86d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，让我们使用这个创建的上下文来实现我们的用例。</p><ul class=""><li id="136c" class="lf lg in kc b kd ke kh ki kl lh kp li kt lj kx lk ll lm ln bi translated">一旦我们准备好CounterProvider组件，我们将在App.tsx中使用它，并如下所示将其包装在Header和Body组件周围。我们将围绕我们希望在其中访问上下文的组件包装提供程序。</li></ul><pre class="la lb lc ld gt lo lp lq bn lr ls bi"><span id="a3d5" class="lt lu in lp b be lv lw l lx ly"> return (<br/>    &lt;CounterProvider&gt;<br/>      &lt;Header/&gt;<br/>      &lt;Body/&gt;<br/>    &lt;/CounterProvider&gt;<br/>  );</span></pre><p id="7554" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们更改Body组件以触发计数器变量的更改。</p><ul class=""><li id="8a3e" class="lf lg in kc b kd ke kh ki kl lh kp li kt lj kx lk ll lm ln bi translated">车身部件</li></ul><pre class="la lb lc ld gt lo lp lq bn lr ls bi"><span id="3f26" class="lt lu in lp b be lv lw l lx ly">import { useContext } from "react";<br/>import { CounterContext} from './CounterContext';<br/><br/>const Body = () =&gt; {<br/><br/>const { handleCounter} = useContext(CounterContext); // Step 1<br/>const incCounter = () =&gt; {       // Step 2<br/>handleCounter();<br/>}<br/>return(<br/>&lt;button onClick={incCounter}&gt;<br/>Increase Counter<br/>&lt;/button&gt;<br/>)<br/>}<br/><br/>export default Body</span></pre><ol class=""><li id="d5e7" class="lf lg in kc b kd ke kh ki kl lh kp li kt lj kx lz ll lm ln bi translated">在<strong class="kc io">步骤1 </strong>中，我们使用的是由reactor提供的useContext api。它接受一个参数，即上下文的名称。传入上下文名称后，它将返回在value prop中传递的对象或属性，同时返回Provider组件。在我们的例子中，它会像——</li></ol><pre class="la lb lc ld gt lo lp lq bn lr ls bi"><span id="4e6e" class="lt lu in lp b be lv lw l lx ly"> &lt;CounterContext.Provider value={counterObj}&gt;<br/>            {children}<br/>        &lt;/CounterContext.Provider&gt;</span></pre><p id="3c01" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们使用析构获得handleCounter属性。</p><p id="71fb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2.在<strong class="kc io">步骤2 </strong>中，我们通过点击按钮调用handleCounter。如果您还记得handleCounter方法是我们在中使用setCounter设置新的计数器值的方法。因此，在单击Button时，上下文中的计数器变量将被更新。</p><p id="2663" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，让我们在header组件中进行更改，以订阅对counter变量所做的更改</p><ul class=""><li id="7807" class="lf lg in kc b kd ke kh ki kl lh kp li kt lj kx lk ll lm ln bi translated">表头组件</li></ul><p id="835f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一旦生产者更新了这个值，我们就需要在其他组件中使用相同的值。让我们对Header组件进行一些更改。</p><pre class="la lb lc ld gt lo lp lq bn lr ls bi"><span id="f335" class="lt lu in lp b be lv lw l lx ly">import { useContext } from "react";<br/>import { CounterContext } from "./CounterContext";<br/>const Header = () =&gt; {<br/>const { counter } = useContext(CounterContext);   // Step 1 <br/>return(<br/>&lt;h1&gt;Counter value is - {counter}&lt;/h1&gt;           // Step 2 <br/>)<br/>}<br/>export default Header;</span></pre><ol class=""><li id="3b7b" class="lf lg in kc b kd ke kh ki kl lh kp li kt lj kx lz ll lm ln bi translated">在<strong class="kc io">第1步</strong>中，我们再次使用了useContext api，这一次我们得到了一个计数器变量，它是点击Body组件中的按钮后的更新值。</li><li id="73a1" class="lf lg in kc b kd ma kh mb kl mc kp md kt me kx lz ll lm ln bi translated">在<strong class="kc io">步骤2 </strong>中，我们显示计数器变量。</li></ol><p id="e697" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是我们如何使用Context和useContext api在reaction中将值从一个组件传递给另一个组件。</p><p id="5071" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你可以在<a class="ae jz" href="https://github.com/Avinash219/Context_Tutorial" rel="noopener ugc nofollow" target="_blank">回购</a>找到完整的代码片段。</p><p id="f460" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你有任何进一步的疑问，请及时和我联系。</p></div><div class="ab cl mf mg hr mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ig ih ii ij ik"><p id="b613" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">关于我——我是一个编程爱好者，喜欢阅读和写作前端设计、JavaScript和UI/UX相关的东西。点击<a class="ae jz" href="https://medium.com/@avinash.dev21987" rel="noopener">这里</a>阅读我所有的文章，并让我知道你的反馈。</p></div><div class="ab cl mf mg hr mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ig ih ii ij ik"><p id="7402" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">更多内容看</em> <a class="ae jz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="ky">说白了。报名参加我们的</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="ky">免费周报</em> </strong> </a> <em class="ky">。关注我们关于</em> <a class="ae jz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="ky">推特</em></strong></a><a class="ae jz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="ky">LinkedIn</em></strong></a><em class="ky"/><a class="ae jz" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="ky">YouTube</em></strong></a><em class="ky"/><a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="ky">不和</em> </strong> </a> <em class="ky">。对增长黑客感兴趣？检查</em> <a class="ae jz" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="ky">电路</em> </strong> </a> <em class="ky">。</em></strong></a></p></div></div>    
</body>
</html>