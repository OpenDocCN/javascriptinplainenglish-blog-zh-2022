<html>
<head>
<title>Create Videos from Code Snippets with this Node.js Script</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js脚本从代码片段创建视频</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-videos-from-code-snippets-with-this-node-js-script-35ccc88dec1c?source=collection_archive---------14-----------------------#2022-01-04">https://javascript.plainenglish.io/create-videos-from-code-snippets-with-this-node-js-script-35ccc88dec1c?source=collection_archive---------14-----------------------#2022-01-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="4764" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当我在制作我的游戏Devlog视频时，我想知道是否有什么方法可以自动将我的代码片段转换成视频，以便我可以将它们添加到我的Devlog中，但我找不到任何解决方案，所以我放弃了这个想法。</p><p id="dde2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">几周前，我在玩<a class="ae ki" href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" rel="noopener ugc nofollow" target="_blank"> AST </a>和用<code class="fe kj kk kl km b">Babel</code>通过<code class="fe kj kk kl km b">Node.js</code>渲染<code class="fe kj kk kl km b">React</code>的时候，突然想到用木偶师打开一个无头浏览器，并用我的代码片段记录一个页面。</p><p id="586b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">目标是让结果看起来像下面的GIF。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi kn"><img src="../Images/cdbd3bbe2359a73d67f9e4052470ca3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*KYc9DaxZURWFGmo1.gif"/></div></figure><h1 id="1922" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">让我们开始编码吧</h1><p id="89d4" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">我将首先使用<code class="fe kj kk kl km b">node</code>创建一个通过终端运行的<code class="fe kj kk kl km b">script.js</code>。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="5b4c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我的代码将使用<code class="fe kj kk kl km b">ES Modules</code>，所以我将安装<a class="ae ki" href="https://www.npmjs.com/package/esm" rel="noopener ugc nofollow" target="_blank"> esm </a>，这样我就可以像<code class="fe kj kk kl km b">node -r esm src/script.js my_file.js</code>一样运行我的脚本。</p><p id="2b87" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于<code class="fe kj kk kl km b">generateVideo</code>功能，我将按照<a class="ae ki" href="https://github.com/puppeteer/puppeteer/blob/v13.0.1/docs/api.md#class-puppeteer" rel="noopener ugc nofollow" target="_blank">木偶师的快速启动示例</a>打开一个无头浏览器，然后用<a class="ae ki" href="https://github.com/prasanaworld/puppeteer-screen-recorder#example" rel="noopener ugc nofollow" target="_blank">木偶师屏幕记录器</a>开始记录。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="ba08" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这将打开一个无头浏览器标签，设置HTML为<code class="fe kj kk kl km b">&lt;p&gt;Hello World&lt;/p&gt;</code>并制作一个1秒钟的视频。这不是我想要的，但我会实现的。</p><h1 id="db30" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">呈现React组件</h1><p id="7783" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">现在我将创建一个函数，该函数接收代码片段作为参数，然后使用<a class="ae ki" href="https://prismjs.com/" rel="noopener ugc nofollow" target="_blank"> Prism.js </a>以HTML格式呈现漂亮的语法高亮代码。</p><p id="d20f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用<code class="fe kj kk kl km b">Prism.highlight</code>,我可以传递一个代码字符串，并获得一个带有语法高亮代码的HTML，以及将<code class="fe kj kk kl km b">React</code>组件呈现为一个HTML字符串的<code class="fe kj kk kl km b">renderToStaticMarkup</code>。我这里不需要<code class="fe kj kk kl km b">React</code>，但是由于整个创意是从<code class="fe kj kk kl km b">React</code>和<code class="fe kj kk kl km b">Babel</code>开始的，所以我保留了下来。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="6657" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">除了<code class="fe kj kk kl km b">code</code>，<code class="fe kj kk kl km b">generateHtml</code>函数还接收<code class="fe kj kk kl km b">currentLine</code>和<code class="fe kj kk kl km b">totalLines</code>作为参数。<code class="fe kj kk kl km b">currentLine</code>将用于高亮显示当前代码行，而<code class="fe kj kk kl km b">totalLines</code>将显示左边的行号。</p><h1 id="3744" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">反应组分</h1><p id="652e" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated"><code class="fe kj kk kl km b">CodeHighlighter</code>的基本实现我将简单地返回一个<code class="fe kj kk kl km b">code</code>标签，并将<code class="fe kj kk kl km b">dangerouslySetInnerHTML</code>设置为Prism.js HTML。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="b95e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上面的代码仍然缺少行荧光笔和行号，为此我将使用<code class="fe kj kk kl km b">totalLines</code>变量创建行号，使用<code class="fe kj kk kl km b">currentLine</code>创建一个全角的<code class="fe kj kk kl km b">div</code>并用<code class="fe kj kk kl km b">margin-top</code> CSS属性移动它。在GitHub 上查看这个<code class="fe kj kk kl km b">React</code>组件<a class="ae ki" href="https://github.com/blopa/code-video-creator/blob/fc6836c497d5dd0a13a00f1f779fd2d482ebc611/src/CodeHighlighter.jsx" rel="noopener ugc nofollow" target="_blank">的完整代码。</a></p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="ef3b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，在脚本中，我可以获得语法高亮显示的HTML字符串，并将其设置为无头浏览器HTML。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="ly lz l"/></div></figure><h1 id="1b0d" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">逐行显示代码</h1><p id="2be1" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">现在，我将所有代码转储到<code class="fe kj kk kl km b">React</code>组件中，但理想情况下，代码应该逐行显示，为此，我将遍历<code class="fe kj kk kl km b">lines</code>数组，然后逐行添加到一个新数组中，并将其传递给<code class="fe kj kk kl km b">generateHtml</code>函数。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="47d7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是可行的，但问题是如果代码太长，那么浏览器需要向下滚动以跟随新行，为此我需要使用循环<code class="fe kj kk kl km b">index</code>变量来跟踪当前行，并使用木偶师的<code class="fe kj kk kl km b">page.evaluate()</code>使用页面的<code class="fe kj kk kl km b">window</code>对象向下滚动页面。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="ly lz l"/></div></figure><h1 id="31c9" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">结论</h1><p id="20c8" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">你可以在我的GitHub repo的git hash<a class="ae ki" href="https://github.com/blopa/code-video-creator/tree/d595cf30cec13021fb857f9acb83a853e26610d7" rel="noopener ugc nofollow" target="_blank">d 595 cf 30 CEC 13021 FB 857 f 9 ACB 83 a 853 e 26610d 7</a>中访问这篇博文的完整代码。</p><p id="e199" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该项目从这段代码开始，但现在已经有所增长，repo的<code class="fe kj kk kl km b">main</code>分支中的当前代码对每个字母都有打字效果，这使它变得更好。在<a class="ae ki" href="https://github.com/blopa/code-video-creator/" rel="noopener ugc nofollow" target="_blank"> code-video-creator </a>项目页面上，你可以自由地钻研代码。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi kn"><img src="../Images/372c332d5c8e54c3d4f39d13b2a37bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*wY_mFnlShHwA7SJF.gif"/></div></figure><p id="b990" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我希望这对你有所启发，如果你有任何问题，请留下评论。下一集再见！</p></div><div class="ab cl ma mb hr mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ig ih ii ij ik"><p id="94a6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mh">原载于</em><a class="ae ki" href="https://pablo.gg/en/blog/coding/create-videos-from-code-snippets-with-this-nodejs-script/" rel="noopener ugc nofollow" target="_blank"><em class="mh">https://pablo . gg</em></a></p><p id="ff4a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mh">更多内容请看</em><a class="ae ki" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="mh">plain English . io</em></a><em class="mh">。报名参加我们的</em> <a class="ae ki" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="mh">免费周报</em> </a> <em class="mh">。在我们的</em> <a class="ae ki" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <em class="mh">社区获得独家写作机会和建议</em> </a> <em class="mh">。</em></p></div></div>    
</body>
</html>