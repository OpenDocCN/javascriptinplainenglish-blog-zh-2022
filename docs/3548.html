<html>
<head>
<title>What Are Debounce and Throttle?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是去抖和节流？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/what-are-debounce-and-throttle-8908dc7c5a62?source=collection_archive---------11-----------------------#2022-09-06">https://javascript.plainenglish.io/what-are-debounce-and-throttle-8908dc7c5a62?source=collection_archive---------11-----------------------#2022-09-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="10bb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何在TypeScript中编码去抖和节流</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4f56f83d2c12eb2f810118ff26f9fe15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F-j5mY99ludEIFxo"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@pixelfreund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ralph Hutter</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="140d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在一些前端教程中，你可能听说过去抖和节流，那么在哪些情况下使用呢？为什么要用？</p><p id="7310" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">事实上，它们都是为了防止高频操作触发可能的性能问题。</p><p id="111b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在触发事件后的<code class="fe ls lt lu lv b">N</code>秒内，仅执行一次去抖，如果在<code class="fe ls lt lu lv b">N</code>秒内再次触发，将重新开始计时。</p><p id="f78c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是JavaScript代码:</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="23bf" class="ma mb iq lv b gy mc md l me mf">const debounce = (func, ms) =&gt; {<br/>  let timer;<br/>  return (...args) =&gt; {<br/>    if (timer) clearTimeout(timer);<br/>    timer = setTimeout(() =&gt; {<br/>      func(...args);<br/>    }, ms);<br/>  };<br/>};</span></pre><p id="1e4a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在这里巧妙的使用了闭包，把<code class="fe ls lt lu lv b">setTimeout</code>的返回值保存在闭包里，然后返回一个新的函数。当这个新函数被频繁调用时，它会检查是否有有效的<code class="fe ls lt lu lv b">timer</code>，如果有，清除上一个定时器，然后重新生成定时器。</p><p id="17c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，我们返回的函数是一个箭头函数，也就是说它的<code class="fe ls lt lu lv b">this</code>不变，所以当我们调用<code class="fe ls lt lu lv b">func</code>时，它也被直接调用。如果您希望在调用时改变原始函数<code class="fe ls lt lu lv b">this</code>的点，您可以这样做:</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="64c4" class="ma mb iq lv b gy mc md l me mf">const debounce = (func, ms) =&gt; {<br/>  let timer;<br/>  return function (...args) {<br/>    if (timer) clearTimeout(timer);<br/>    timer = setTimeout(() =&gt; {<br/>      func.apply(this, ...args);<br/>    }, ms);<br/>  };<br/>};</span></pre><p id="41ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看一下上面的代码，我们返回一个传统的函数，这意味着它的<code class="fe ls lt lu lv b">this</code>取决于你如何调用它。然后我们用<code class="fe ls lt lu lv b">func.apply(this, ...args);</code>把这个<code class="fe ls lt lu lv b">this</code>传递给原函数。但是注意，如果你的原函数是一个箭头函数，那么这个就不行。</p><p id="f359" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">综上所述，我会推荐使用第一种方式，使用箭头函数定义原函数。这样,<code class="fe ls lt lu lv b">this</code>指向的所有函数都是明确的，你的代码也更加简洁易懂。</p><p id="ffa8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是添加了一点魔法的打字稿:</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="6800" class="ma mb iq lv b gy mc md l me mf">const debounce = &lt;F extends (...args: any[]) =&gt; void&gt;(func: F, ms: number) =&gt; {<br/>  let timer: ReturnType&lt;typeof setTimeout&gt;;<br/>  return (...args: Parameters&lt;F&gt;) =&gt; {<br/>    if (timer) clearTimeout(timer);<br/>    timer = setTimeout(() =&gt; {<br/>      func(...args);<br/>    }, ms);<br/>  };<br/>};</span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><p id="1261" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来说一下节流，它只会在<code class="fe ls lt lu lv b">N</code>秒内执行一次，在<code class="fe ls lt lu lv b">N</code>秒内重新触发也不会有影响。也就是说，它只是稀释了执行频率。</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="8641" class="ma mb iq lv b gy mc md l me mf">const throttle = (func, ms) =&gt; {<br/>  let timer;<br/>  return (...args) =&gt; {<br/>    if (timer) return;<br/>    timer = setTimeout(() =&gt; {<br/>      func(...args);<br/>      timer = null;<br/>    }, ms);<br/>  };<br/>};</span></pre><p id="a1b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可以看出，它和去抖的区别在于，如果有一个有效的定时器，函数就会退出，而去抖是清除最后一个定时器。</p><p id="2eee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">this</code>的问题也是一样，这里就不赘述了，不过还是建议用箭头函数。</p><p id="cfa4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是添加了一点魔法的打字稿:</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="ceef" class="ma mb iq lv b gy mc md l me mf">const throttle = &lt;F extends (...args: any[]) =&gt; void&gt;(func: F, ms: number) =&gt; {<br/>  let timer: ReturnType&lt;typeof setTimeout&gt; | null;<br/>  return (...args: Parameters&lt;F&gt;) =&gt; {<br/>    if (timer) return;<br/>    timer = setTimeout(() =&gt; {<br/>      func(...args);<br/>      timer = null;<br/>    }, ms);<br/>  };<br/>};</span></pre><p id="f49c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后说一下哪些情况下可以用。在实时修改编辑器的情况下可以使用去抖动，如果有修改，将重新计时。或者当调整浏览器窗口大小时，监听器功能可以去抖。节流可用于浏览器滚动监听器事件或视频回放事件，例如，每隔<code class="fe ls lt lu lv b">1s</code>计算一次。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><p id="fabd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不是中等会员？<a class="ae kv" href="https://medium.com/@hibrandonevans/membership" rel="noopener">在这里支持我</a>成为其中一员。</p><p id="9691" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><p id="9efc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mn">更多内容尽在</em> <a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="mn">说白了. io </em> </strong> </a> <em class="mn">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="mn">免费周报</em> </strong> </a> <em class="mn">。关注我们关于</em> <a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="mn">推特</em> </strong> </a>，<a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="mn">LinkedIn</em></strong></a><em class="mn">，</em><a class="ae kv" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="mn">YouTube</em></strong></a><em class="mn">，</em> <a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="mn">不和</em> </strong> </a> <em class="mn">。</em></p></div></div>    
</body>
</html>