<html>
<head>
<title>How to Fix the “__dirname is not defined in ES module scope” Error in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何修复JavaScript中的“__dirname未在ES模块作用域中定义”错误</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-dirname-is-not-defined-in-es-module-scope-41acd96e122d?source=collection_archive---------7-----------------------#2022-11-20">https://javascript.plainenglish.io/javascript-dirname-is-not-defined-in-es-module-scope-41acd96e122d?source=collection_archive---------7-----------------------#2022-11-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="2ada" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">了解如何轻松修复JavaScript中的“__dirname未在ES模块范围内定义”错误。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/eb997bfc97eeb44adbb5a8463e07d747.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JnO9quC9Bk-qL-IzSPKY8g.png"/></div></div></figure><p id="cc61" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当我们试图访问ES模块中的<code class="fe lk ll lm ln b">__dirname</code>全局变量时，JavaScript中出现“__dirname未在ES模块范围内定义”错误。<code class="fe lk ll lm ln b">__dirname</code>和<code class="fe lk ll lm ln b">__filename</code>全局变量是在CommonJS模块中定义的，而不是在es模块中。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/dbe97e3ece10e394f8f8b3c3f6e915d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/0*1yueOzKXfqd5n7Am.png"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">The “__dirname is not defined in ES module scope” error occurring in JavaScript.</figcaption></figure><p id="d12d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们可以通过使用某些函数创建一个自定义的<code class="fe lk ll lm ln b">__dirname</code>变量来修复“_ _ dirname is not defined in ES module scope”错误，该变量的工作方式就像全局变量一样，直接包含文件当前工作的完整路径。</p><p id="3d47" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe lk ll lm ln b">index.js</code></p><pre class="kd ke kf kg gt lt ln lu bn lv lw bi"><span id="7997" class="lx ly in ln b be lz ma l mb mc">import path from 'path';<br/>import { fileURLToPath } from 'url';<br/><br/>const __filename = fileURLToPath(import.meta.url);<br/>const __dirname = path.dirname(__filename);<br/><br/>// C:/cb/cb-js<br/>console.log(__dirname);<br/><br/>// C:\cb\cb-js\index.html<br/>console.log(path.join(__dirname, 'index.html'));</span></pre><p id="f7dc" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe lk ll lm ln b">import.meta</code>对象包含与某个模块相关联的上下文特定的元数据，例如模块的文件URL。</p><pre class="kd ke kf kg gt lt ln lu bn lv lw bi"><span id="273f" class="lx ly in ln b be lz ma l mb mc">// file:///C:/cb/cb-js/index.js<br/>console.log(import.meta.url);</span></pre><p id="20cf" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">因此，我们从<code class="fe lk ll lm ln b">url</code>模块获取当前模块的文件URL，并将其传递给<code class="fe lk ll lm ln b">fileURLToPath</code>函数，以将其转换为文件路径。<code class="fe lk ll lm ln b">fileURLToPath</code>返回完全解析的、特定于平台的Node.js文件路径。</p><pre class="kd ke kf kg gt lt ln lu bn lv lw bi"><span id="02da" class="lx ly in ln b be lz ma l mb mc">// C:\cb\cb-js\index.js<br/>console.log(fileURLToPath('file:///C:/cb/cb-js/index.js'));</span></pre><p id="e131" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">获取文件路径后，我们从<code class="fe lk ll lm ln b">path</code>模块将它传递给<code class="fe lk ll lm ln b">dirname</code>方法，以从文件路径中获取完整的目录路径。</p><pre class="kd ke kf kg gt lt ln lu bn lv lw bi"><span id="2623" class="lx ly in ln b be lz ma l mb mc">// C:\cb\cb-js<br/>console.log(path.dirname('C:\\cb\\cb-js\\index.js'));</span></pre><p id="526f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这样，我们现在有了自己的<code class="fe lk ll lm ln b">__dirname</code>和<code class="fe lk ll lm ln b">__filename</code>变量。</p><p id="a79e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这是从我电脑上的一个文件中记录它们的输出。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi md"><img src="../Images/f978c6a91167a0a2b7de16b6e5eb0318.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/0*i-JY-825DZvucCET.png"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">Logging the <code class="fe lk ll lm ln b">__dirname</code> and <code class="fe lk ll lm ln b">__filename</code> variables to the console.</figcaption></figure><p id="9e44" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe lk ll lm ln b">__filename</code>包含当前模块文件的绝对路径。</p><p id="1569" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe lk ll lm ln b">__dirname</code>包含当前模块文件目录的绝对路径。</p><h1 id="6275" class="me ly in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">为<code class="fe lk ll lm ln b">__dirname</code>和<code class="fe lk ll lm ln b">__filename</code>创建实用程序</h1><p id="36a9" class="pw-post-body-paragraph ko kp in kq b kr mv jo kt ku mw jr kw kx mx kz la lb my ld le lf mz lh li lj ig bi translated">如果我们经常访问<code class="fe lk ll lm ln b">__dirname</code>和<code class="fe lk ll lm ln b">__filename</code>变量，我们可以抽象出在实用程序模块中创建它们的逻辑，避免不必要的重复。</p><p id="61e9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe lk ll lm ln b">file-dir-name.js</code></p><pre class="kd ke kf kg gt lt ln lu bn lv lw bi"><span id="eb0a" class="lx ly in ln b be lz ma l mb mc">import { fileURLToPath } from 'url';<br/>import { dirname } from 'path';<br/><br/>export default function fileDirName(meta) {<br/>  const __filename = fileURLToPath(meta.url);<br/>  const __dirname = dirname(__filename);<br/>  return { __dirname, __filename };<br/>}</span></pre><p id="330e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们将能够在项目中的各种其他模块文件中使用这个实用程序。</p><p id="9b34" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe lk ll lm ln b">index.js</code></p><pre class="kd ke kf kg gt lt ln lu bn lv lw bi"><span id="3e0d" class="lx ly in ln b be lz ma l mb mc">import fileDirName from './file-dir-name.js';<br/><br/>const { __dirname, __filename } = fileDirName(import.meta);<br/><br/>// C:\cb\cb-js<br/>console.log(__dirname);<br/><br/>// C:\cb\cb-js\index.js<br/>console.log(__filename);</span></pre></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><p id="a329" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">【codingbeautydev.com】原载于<a class="ae ni" href="https://cbdev.link/e8944f" rel="noopener ugc nofollow" target="_blank"><em class="nh"/></a></p><h1 id="be6e" class="me ly in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">JavaScript做的每一件疯狂的事情</h1><p id="e18c" class="pw-post-body-paragraph ko kp in kq b kr mv jo kt ku mw jr kw kx mx kz la lb my ld le lf mz lh li lj ig bi translated">一本关于JavaScript微妙的警告和鲜为人知的部分的迷人指南。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/143ee152ba78025ea8643ba5b9726a20.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*YS5Oub8REWy8vnOEqBnsyQ.png"/></div></figure><p id="7d6e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><a class="ae ni" href="https://cbdev.link/d3c4eb" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">报名</strong> </a>立即免费领取一份。</p></div></div>    
</body>
</html>