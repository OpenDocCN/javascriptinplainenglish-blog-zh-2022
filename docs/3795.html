<html>
<head>
<title>React-Hook-Form Library | Common Use Cases</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React-Hook-Form库|常见用例</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/common-use-cases-of-react-hook-form-b7cf961a42f6?source=collection_archive---------5-----------------------#2022-09-27">https://javascript.plainenglish.io/common-use-cases-of-react-hook-form-b7cf961a42f6?source=collection_archive---------5-----------------------#2022-09-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="0556" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">因为绝对没有人喜欢创建和重建带有验证的复杂表单</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/fd9404d78ae55eaacd03ecc617f4535a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mQRUAN3dcyOa4CGH0FhBnw.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">失败是成功之母 — — failure is the mother of success</figcaption></figure></div><div class="ab cl ks kt hr ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ig ih ii ij ik"><p id="3496" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">表单状态管理一直让我头疼，错误处理，验证规则，表单重置。。。好在这几年有很多好的解决方案，比如<a class="ae lv" href="https://formik.org/" rel="noopener ugc nofollow" target="_blank"><em class="lw">Formik</em></a><a class="ae lv" href="https://react-hook-form.com/" rel="noopener ugc nofollow" target="_blank"><em class="lw">react-hook-form</em></a><a class="ae lv" href="https://final-form.org/react" rel="noopener ugc nofollow" target="_blank"><em class="lw">react-final-form</em></a><a class="ae lv" href="https://reakit.io/" rel="noopener ugc nofollow" target="_blank"><em class="lw">Reakit</em></a>等等。</p><p id="13ed" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">因为最近有人问我是否知道React-Hook-Form，而且因为我从未使用过它，所以我决定从这个钩子开始，创建一个简单的表单，这样我就可以更好地理解它，当然，我会像我的其他文章一样与您分享本文中的步骤🙌</p></div><div class="ab cl ks kt hr ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ig ih ii ij ik"><p id="df73" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">让我先展示一下最终结果应该是什么样子，这样我们心中就有了一个清晰的想法。对于该表单，我将提供用户名和密码作为输入字段，城市作为选择字段:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lx"><img src="../Images/9024bfccef9e645727aed3daf886d91e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aAg0JedzJOYtWzaiqXZf_Q.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">end result form with validation</figcaption></figure><p id="1421" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">首先，让我们创建所有没有功能的输入字段和按钮。应用程序结构相当简单，父组件<strong class="lb io"> App </strong>包含子组件<strong class="lb io"> Country </strong>(用黄色标出)。</p><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="7d14" class="md me in lz b gy mf mg l mh mi">// <strong class="lz io">App</strong><br/>import Country from "./Country";<br/>import ...</span><span id="903f" class="md me in lz b gy mj mg l mh mi">export default function <strong class="lz io">App</strong>() {<br/>    return (<br/>     &lt;div className="App"&gt;<br/>         &lt;form onSubmit={...} &gt;<br/>           &lt;fieldset&gt;<br/>             &lt;legend&gt;User Profile&lt;/legend&gt;<br/>             &lt;div className="..."&gt;<br/>              &lt;label&gt;First Name: &lt;/label&gt;<br/>              &lt;input .../&gt;<br/>             &lt;/div&gt;<br/>             &lt;div className="..."&gt;<br/>              &lt;label&gt;Last Name: &lt;/label&gt;<br/>              &lt;input ... /&gt;<br/>             &lt;/div&gt;<br/>             &lt;div className="..."&gt;<br/>              &lt;label&gt;Password: &lt;/label&gt;<br/>              &lt;input ... /&gt;<br/>             &lt;/div&gt;<br/>             &lt;div className="..."&gt;<br/>               &lt;<strong class="lz io">Country</strong> /&gt;<br/>             &lt;/div&gt;</span><span id="d284" class="md me in lz b gy mj mg l mh mi">             &lt;input type="submit" value="Submit" /&gt;<br/>             &lt;button onClick={...}&gt;Reset partial&lt;/button&gt;<br/>           &lt;/fieldset&gt;<br/>         &lt;/form&gt;<br/>    &lt;/div&gt;<br/>)}<br/></span><span id="18ca" class="md me in lz b gy mj mg l mh mi">// <strong class="lz io">Country</strong><br/>const Country = () =&gt; {<br/>   return (<br/>    &lt;&gt;<br/>     &lt;label&gt;City: &lt;/label&gt;<br/>     &lt;div&gt;<br/>      &lt;select&gt;<br/>        &lt;option value=""&gt;Select&lt;/option&gt;<br/>        &lt;option value="Hongkong"&gt;Hongkong&lt;/option&gt;<br/>        &lt;option value="Shenzhen"&gt;Shenzhen&lt;/option&gt;<br/>        &lt;option value="Shanghai"&gt;Shanghai&lt;/option&gt;<br/>      &lt;/select&gt;</span><span id="5dd1" class="md me in lz b gy mj mg l mh mi">      &lt;button type="button" onClick={...}&gt;Get values&lt;/button&gt;<br/>     &lt;/div&gt;<br/>    &lt;/&gt;<br/>  )};</span><span id="bdd3" class="md me in lz b gy mj mg l mh mi">export default Country;</span></pre><p id="9d9e" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">当用React开发时，我们通常创建一个<strong class="lb io">受控表单</strong>，这意味着我们使用React直接处理数据，而不是让React隐式处理数据。</p><p id="c3ab" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">例如，我们可以使用一些React <strong class="lb io">内置的</strong>钩子，比如<em class="lw"> useState </em>来存储每个字段的值。当用户输入时，我们需要获取更新，并通过捕获一些事件处理程序将它们应用到字段值，这就是受控表单的用武之地。</p><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="1b73" class="md me in lz b gy mf mg l mh mi">const [<strong class="lz io">password</strong>, setPassword] = useState("");<br/>const handlePasswordChange = (e) =&gt; <strong class="lz io">setPassword</strong>(e.target.value);</span><span id="f6e5" class="md me in lz b gy mj mg l mh mi">&lt;input type="password" name="password" value={<strong class="lz io">password</strong>} onChange={handlePasswordChange} /&gt;</span></pre><p id="3edf" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">形式简单就可以了。但是，如果我们遇到复杂的表单，比如有几个步骤的表单、联动效果、多层结构等。，这意味着我们需要更多的useState、useEffect等。钩子，以及更多的onChange，onClick等。经手人。需要添加到表单中的字段越多，需要创建的处理程序和状态就越多。这将增加我们代码的长度，增加它的不可读性。</p><p id="0501" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">为了防止类似的事情发生，我们可以使用React Hook表单库，这将帮助我们创建轻便、强大、灵活、可采用和可扩展的表单，并具有用户友好的验证，直观、功能完整的API在构建表单时提供无缝体验。</p><blockquote class="mk ml mm"><p id="cfb4" class="kz la lw lb b lc ld jo le lf lg jr lh mn lj lk ll mo ln lo lp mp lr ls lt lu ig bi translated">React Hook Form是一个没有任何依赖关系的微型库，它最大限度地减少了验证计算，减少了您需要编写的代码量，同时删除了不必要的重新渲染，并且可以在没有其他依赖关系的情况下轻松采用。</p></blockquote></div><div class="ab cl ks kt hr ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ig ih ii ij ik"><p id="4915" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">要使用react-hook-form，我们需要<strong class="lb io">导入</strong>和<strong class="lb io">调用</strong><strong class="lb io"><em class="lw">使用Form </em> </strong>钩子。当我们这样做时，目的是设置表单管理和状态，它们将在链接到表单的所有字段之间共享。useForm返回一个<strong class="lb io">对象</strong>，其中包含有用的函数(<strong class="lb io"> <em class="lw"> register </em> </strong>，<em class="lw"> setValue </em>，<em class="lw"> getValues </em>，<em class="lw"> handleSubmit等。</em>)。</p><p id="b0d8" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">👉我们将首先析构并试用<strong class="lb io">寄存器</strong>。</p><p id="d21e" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated"><strong class="lb io"><em class="lw">* Register</em></strong><em class="lw">是一个回调函数，它返回一些</em> <strong class="lb io"> <em class="lw">道具</em> </strong> <em class="lw">并将它们注入到输入中，以便我们可以控制和读取输入，它允许我们将一个输入连接到由</em> <strong class="lb io"> <em class="lw"> useForm()定义的表单，</em> </strong> <em class="lw">它返回4个重要属性:</em></p><p id="037f" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated"><code class="fe mq mr ms lz b"><em class="lw">onChange</em></code> <em class="lw">道具订阅输入变更事件。</em></p><p id="4f01" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated"><code class="fe mq mr ms lz b"><em class="lw">onBlur</em></code> <em class="lw">道具订阅输入模糊事件。</em></p><p id="d734" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated"><code class="fe mq mr ms lz b"><em class="lw">ref</em></code> <em class="lw">为钩形登记输入参考。</em></p><p id="451d" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated"><code class="fe mq mr ms lz b"><em class="lw">name</em></code> <em class="lw">输入正在注册的名称。</em></p><p id="2df2" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">现在让我们更新输入字段并添加一个提交处理程序，调用register函数并提供输入的名称:</p><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="4ea4" class="md me in lz b gy mf mg l mh mi">import { <strong class="lz io">useForm</strong> } from "react-hook-form";</span><span id="e88c" class="md me in lz b gy mj mg l mh mi">export default function App() {<br/>  const { <strong class="lz io">register, handleSubmit</strong> } = useForm();<br/>  return (<br/>       ...<br/>      &lt;form onSubmit={<strong class="lz io">handleSubmit</strong>((values) =&gt; console.log("Values",    values))}<br/>        &lt;input {...<strong class="lz io">register</strong>("firstName")} /&gt;<br/>        &lt;input {...register("lastName")}/&gt;<br/>        &lt;input {...register("password")}/&gt;<br/>        &lt;input {...register("city")}/&gt;</span><span id="dfca" class="md me in lz b gy mj mg l mh mi">        &lt;input type="submit" value="Submit" /&gt;<br/>      &lt;/form&gt;<br/>       ...  <br/>)}</span></pre><p id="2b06" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">现在，当我们提交表单时，我们将在控制台中看到所有的值，如下所示，将它集成到我们的表单中真的很容易。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mt"><img src="../Images/376af898696aa325ee7bc60aa95c0c8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ps1O88b5iLzOG2gifk1w2A.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">register Input values</figcaption></figure></div><div class="ab cl ks kt hr ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ig ih ii ij ik"><p id="4cf8" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">下一步，我们可以对输入字段执行<strong class="lb io">验证</strong>，验证可以通过<strong class="lb io">将带有<strong class="lb io">所需规则</strong>的</strong> <strong class="lb io">对象</strong>作为<strong class="lb io">参数</strong>传递给寄存器函数来定义。</p><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="b7a3" class="md me in lz b gy mf mg l mh mi">// firstName validation<br/>&lt;input {...register("<strong class="lz io">firstName</strong>", <br/>  {<br/>    <strong class="lz io">required</strong>: "First name is required"<br/>  })} /&gt;</span><span id="a0eb" class="md me in lz b gy mj mg l mh mi">// lastName validation<br/>&lt;input {...register("<strong class="lz io">lastName</strong>", <br/>  { <br/>    <strong class="lz io">required</strong>: true,<br/>    <strong class="lz io">minLength</strong>: { <br/>        <strong class="lz io">value</strong>: 3, <br/>        <strong class="lz io">message</strong>: "Last name is required and should be at least 3 characters" }<br/>  })} /&gt;</span></pre><p id="118b" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">现在刷新页面，将firstName字段留空，在lastName字段中只键入一个字符，然后提交表单。在此过程中，将首先执行验证，这包括检查寄存器函数中定义的<strong class="lb io">验证规则</strong>。(在我们的例子中:必需的<em class="lw">消息</em>，<em class="lw">最小长度</em> …)</p><p id="e316" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">🎈请注意，根本没有<strong class="lb io">的</strong> <strong class="lb io">重新呈现</strong>，但是我们在提交后关注了正确的输入(<strong class="lb io">名字</strong>输入字段)，这实际上导致了验证错误。</p><p id="4324" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">👉这是因为react-hook-form中的渲染处理得相当好，如果我们不订阅错误状态，它不会触发重新渲染！</p><p id="a4da" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">为了查看错误消息，我们可以简单地订阅错误，使用<a class="ae lv" href="https://react-hook-form.com/api/useform/formstate" rel="noopener ugc nofollow" target="_blank"> <strong class="lb io"> formState </strong> </a>并在适当的输入下呈现它们。</p><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="48ef" class="md me in lz b gy mf mg l mh mi">const { register<strong class="lz io">, </strong>handleSubmit, <strong class="lz io">formState: { errors }</strong>} = useForm();</span><span id="5e9d" class="md me in lz b gy mj mg l mh mi">&lt;input {...register("<strong class="lz io">lastName</strong>", {...})} /&gt;<br/>&lt;p&gt;{<strong class="lz io">errors</strong>.<strong class="lz io">lastName</strong>?.<strong class="lz io">message</strong>}&lt;/p&gt;</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mu"><img src="../Images/e0373834b61c680f21091bbd09b78175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LF42FJMY-Ul-GLM-mVvzyQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">reading and rendering errors with formState</figcaption></figure></div><div class="ab cl ks kt hr ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ig ih ii ij ik"><p id="cf92" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">但是，建议在useForm中提供<strong class="lb io">默认值</strong>，输入的默认值在用户与组件交互前首次呈现组件时用作初始值。</p><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="58b4" class="md me in lz b gy mf mg l mh mi">const defaultValues = {<br/>   firstName: “Lola”,<br/>   lastName: “Zhu”,<br/>   password: “”,<br/>   <strong class="lz io">city: “Hongkong”</strong><br/>};</span><span id="2e91" class="md me in lz b gy mj mg l mh mi">const {...} = <strong class="lz io">useForm</strong>({ <strong class="lz io">defaultValues </strong>});</span></pre><p id="1546" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">现在刷新页面，我们应该看到:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mv"><img src="../Images/53f27a66434cb516f660694945a639e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*li01qTFHRGdcMiXK0Ukg-w.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">default values provided</figcaption></figure><p id="3b9c" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">我们还可以设置表单的<strong class="lb io">模式</strong>，该模式可以控制触发验证的时机。如果我们希望用户尽快察觉到错误，我们可以使用“<strong class="lb io"> all </strong>”:</p><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="e59d" class="md me in lz b gy mf mg l mh mi">const {...} = useForm({ <br/>  defaultValues<strong class="lz io">,</strong> <br/>  <strong class="lz io">mode</strong>: "all" <em class="lw">// 👉 onChange | onBlur | onSubmit | onTouched | all<br/></em>});</span></pre></div><div class="ab cl ks kt hr ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ig ih ii ij ik"><p id="4e2a" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">到目前为止一切看起来都很好，但是如果我们想多次订阅某个特定的输入值呢？比如我们想使用指定的输入，并用它做一些事情……我们可以使用<strong class="lb io"> watch </strong> API。</p><blockquote class="mk ml mm"><p id="778b" class="kz la lw lb b lc ld jo le lf lg jr lh mn lj lk ll mo ln lo lp mp lr ls lt lu ig bi translated">该方法将监视指定的输入并返回它们的值。这对于呈现输入值以及根据条件确定要呈现的内容非常有用。</p></blockquote><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="d833" class="md me in lz b gy mf mg l mh mi">const { ..., <strong class="lz io">watch </strong>} = useForm({ ... });</span></pre><p id="9b7f" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">默认情况下，当你在输入字段中输入一些东西时，react-hook-form不会触发任何重新呈现，但是通过调用<strong class="lb io"> watch </strong>函数，我们可以订阅输入，当我们<em class="lw"> console.log </em> watch时，我们会看到所有的值。</p><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="2302" class="md me in lz b gy mf mg l mh mi">console.log(“watch”, watch());</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mw"><img src="../Images/e806e877486b9a5914236f20b79fdb9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g3WVq05Ov700t9In4Y-OVQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">console.log(“watch”, watch())</figcaption></figure><p id="8880" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">我们还可以“<strong class="lb io">观察</strong>指定的输入并返回它们的值:</p><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="de03" class="md me in lz b gy mf mg l mh mi">const password_value = { password: watch(“password”)};</span><span id="65f0" class="md me in lz b gy mj mg l mh mi">const watchFields = watch([“password”, “city”]);</span><span id="086c" class="md me in lz b gy mj mg l mh mi">console.log(“watch”, password_value, watchFields);</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mx"><img src="../Images/a32a591d4a2df91976a6d3b7a7b9e1ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cDzaB_bTEMrD5eDZ_DS7QQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">console.log watch values</figcaption></figure><p id="6d6f" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">👀注意:</p><ul class=""><li id="a6c3" class="my mz in lb b lc ld lf lg li na lm nb lq nc lu nd ne nf ng bi translated"><em class="lw"> Watch将在应用程序或表单的根目录下触发重新呈现，如果遇到性能问题，请考虑使用回调或</em><a class="ae lv" href="https://react-hook-form.com/api/usewatch" rel="noopener ugc nofollow" target="_blank"><em class="lw">use Watch</em></a><em class="lw">API。</em></li><li id="87ec" class="my mz in lb b lc nh lf ni li nj lm nk lq nl lu nd ne nf ng bi translated"><em class="lw">还有一个</em><strong class="lb io"><em class="lw">get values</em></strong><em class="lw">helper API用于读取输入值，</em> <code class="fe mq mr ms lz b"><em class="lw">watch</em></code> <em class="lw">和</em> <code class="fe mq mr ms lz b"><em class="lw">getValues</em></code> <em class="lw">的区别在于</em> <code class="fe mq mr ms lz b"><em class="lw">getValues</em></code> <em class="lw"> </em> <strong class="lb io"> <em class="lw">不会触发</em> </strong> <em class="lw">重新渲染或订阅输入变化。</em></li></ul><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="5afd" class="md me in lz b gy mf mg l mh mi"><em class="lw">// {firstName:"Lola",lastName:"Zhu",password:"...",city:"Hongkong"}<br/></em>const values = <strong class="lz io">getValues()</strong>;</span><span id="bbcc" class="md me in lz b gy mj mg l mh mi"><em class="lw">// "Hongkong"<br/></em>const singleValue = <strong class="lz io">getValues("city")</strong>; </span><span id="374a" class="md me in lz b gy mj mg l mh mi"><em class="lw">// ["Lola","Zhu","Hongkong"]<br/></em>const multipleValues = <strong class="lz io">getValues(["firstName", "lastName", "city"])</strong>;</span></pre></div><div class="ab cl ks kt hr ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ig ih ii ij ik"><p id="b9ec" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">还记得上面我们将<strong class="lb io"> Country </strong>组件作为子组件吗？为了从子组件中访问表单方法和状态，我们可以像往常一样传递props，但是由于react中有一个<strong class="lb io"> useContext </strong>钩子，我们在react-hook-form库中也有一个钩子:<a class="ae lv" href="https://react-hook-form.com/api/useformcontext" rel="noopener ugc nofollow" target="_blank"> <em class="lw"> useFormContext </em> </a>，它的行为与React的useContext非常相似。</p><p id="f9b6" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">useFormContext旨在用于<strong class="lb io">深度嵌套结构</strong>中，在这种情况下传递props变得不方便，它允许我们访问表单上下文，并获得<strong class="lb io"> useForm </strong>提供的表单方法和状态，而不必再次调用钩子。</p><p id="6053" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">为了使用useFormContext，我们在将表单数据发送给子代和孙代的级别使用<strong class="lb io"><em class="lw">form provider</em></strong><em class="lw"/>包装器，并使用<strong class="lb io"><em class="lw">useFormContext</em></strong>钩子访问它们。</p><ul class=""><li id="93dc" class="my mz in lb b lc ld lf lg li na lm nb lq nc lu nd ne nf ng bi translated">在应用程序组件中导入FormProvider:</li></ul><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="e95b" class="md me in lz b gy mf mg l mh mi">import { useForm, <strong class="lz io">FormProvider</strong> } from "react-hook-form";</span><span id="3059" class="md me in lz b gy mj mg l mh mi">export default function App() {<br/>  const { register<strong class="lz io">, </strong>getValues, ...} = useForm();<br/>  return (<br/>       ...<br/>        &lt;<strong class="lz io">FormProvider</strong> {...{register, getValues}}&gt; <br/>          &lt;form onSubmit={handleSubmit(...)}&gt;<br/>            &lt;Country /&gt;<br/>          &lt;/form&gt;<br/>        &lt;/<strong class="lz io">FormProvider</strong>&gt;<br/>  )}</span></pre><ul class=""><li id="96c5" class="my mz in lb b lc ld lf lg li na lm nb lq nc lu nd ne nf ng bi translated">在子组件<strong class="lb io"> Country: </strong>中检索所有带有<strong class="lb io"> useFormContext </strong>的钩子方法</li></ul><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="b9c2" class="md me in lz b gy mf mg l mh mi">import { <strong class="lz io">useFormContext</strong> } from "react-hook-form";</span><span id="5cb6" class="md me in lz b gy mj mg l mh mi">const Country = () =&gt; {<br/>     <em class="lw">// retrieve hook methods</em>   <br/>   const {<strong class="lz io">register</strong>, <strong class="lz io">getValues</strong>} = useFormContext();<br/>   return (<br/>     &lt;&gt;<br/>       &lt;label&gt;City: &lt;/label&gt;<br/>       &lt;div&gt;<br/>          &lt;select {...<strong class="lz io">register</strong>("city", { required: "Please select city" })}&gt;<br/>           &lt;option value=""&gt;Select&lt;/option&gt;<br/>           &lt;option value="Hongkong"&gt;Hongkong&lt;/option&gt;<br/>           &lt;option value="Shenzhen"&gt;Shenzhen&lt;/option&gt;<br/>           &lt;option value="Shanghai"&gt;Shanghai&lt;/option&gt;<br/>          &lt;/select&gt;<br/>         &lt;button type="button" onClick={() =&gt; {<br/>           const values = <strong class="lz io">getValues</strong>(); <em class="lw"><br/>           </em>const singleValue = getValues("city");<em class="lw"><br/>           </em>const multipleValues = getValues(<br/>["password", "lastName","city"]);<br/>           // console.log(values, singleValue, multipleValues);<br/>          }}&gt;Get values&lt;/button&gt;<br/>       &lt;/div&gt;<br/>     &lt;/&gt;<br/>)};</span><span id="6b17" class="md me in lz b gy mj mg l mh mi">export default Country;</span></pre></div><div class="ab cl ks kt hr ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ig ih ii ij ik"><p id="9f9a" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">不错！最后一个有用的API是<a class="ae lv" href="https://react-hook-form.com/api/useform/reset" rel="noopener ugc nofollow" target="_blank"> <strong class="lb io"> reset </strong> </a>，它重置所有表单状态、字段引用和订阅。</p><p id="4b64" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">🍭Reset听起来可能很简单，但实际上，用户希望如何重置表单有很多不同的情况。比如有时候我们想把表单重置到初始状态或者重置/更新状态，或者用一些部分值重置表单等等。</p><p id="960b" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">在我们的示例中，App组件中有一个重置按钮，我将尝试实现其中一些情况:</p><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="766c" class="md me in lz b gy mf mg l mh mi">&lt;button onClick={...}&gt;Reset partial&lt;/button&gt;</span></pre><ul class=""><li id="9087" class="my mz in lb b lc ld lf lg li na lm nb lq nc lu nd ne nf ng bi translated">第一种情况:将表单复位到<strong class="lb io">初始</strong>状态。*<em class="lw">reset提供的第一个参数实际上是可选的</em>，这意味着如果我们执行不带任何参数的函数(reset())，react-hook-form会将表单重置回您提供的默认值。当未提供defaultValues时，将调用HTML原生<a class="ae lv" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/reset" rel="noopener ugc nofollow" target="_blank">重置</a> API来恢复表单。</li></ul><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="d635" class="md me in lz b gy mf mg l mh mi">const { ...,reset } = useForm();</span><span id="4bc6" class="md me in lz b gy mj mg l mh mi">const resetForm = () =&gt; <strong class="lz io">reset</strong>();<br/>&lt;button onClick={resetForm}&gt;Reset&lt;/button&gt;</span></pre><ul class=""><li id="a28c" class="my mz in lb b lc ld lf lg li na lm nb lq nc lu nd ne nf ng bi translated">第二种情况:重置和更新表单值。* <em class="lw">如果我们想将整个表单重置为不同的值，而且还要更新默认值，那么我们可以供给</em> <strong class="lb io"> <em class="lw">值。</em> </strong>当值被提供后，点击reset按钮，<strong class="lb io">不仅UI中的</strong>值会被更新，而且存储在react-hook-form中的我们的defaultValue也会被反映出来，在我们下面的代码中，重置后，城市将是“上海”而不是默认的“香港”。</li></ul><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="87da" class="md me in lz b gy mf mg l mh mi">const resetForm = () =&gt; {<br/> reset((formValues) =&gt; ({<br/> …formValues,<br/> city: “Shanghai”<br/> }));<br/>}<br/>&lt;button onClick={resetForm}&gt;Reset partial&lt;/button&gt;</span></pre><ul class=""><li id="e339" class="my mz in lb b lc ld lf lg li na lm nb lq nc lu nd ne nf ng bi translated">第三种情况:抓取所有东西<strong class="lb io">部分</strong>重置形态。* <em class="lw">我们可以将上面解释的getValues API与Reset API </em>结合起来。这意味着我们可以对表单中当前的内容进行<em class="lw">浅层合并</em>并合并我们想要应用的值。</li></ul><p id="9351" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">👉<em class="lw">在这种情况下，其他输入值保持不变，但</em> <strong class="lb io"> <em class="lw">名</em> </strong> <em class="lw">被重置为“迷你”。</em></p><pre class="kd ke kf kg gt ly lz ma mb aw mc bi"><span id="4239" class="md me in lz b gy mf mg l mh mi">const resetForm = () =&gt; {<br/>    reset({<br/>        ...getValues,<br/>        <strong class="lz io">firstName</strong>: "<strong class="lz io">Mini</strong>",<br/>     });<br/>}<br/>&lt;button onClick={resetForm}&gt;Reset partial&lt;/button&gt;</span></pre></div><div class="ab cl ks kt hr ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ig ih ii ij ik"><p id="d7b7" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">不错！到目前为止，我想我已经介绍了一些常用的API，还有更多我正在不断学习的定制钩子(例如，<a class="ae lv" href="https://react-hook-form.com/api/usecontroller" rel="noopener ugc nofollow" target="_blank"> useController </a>、<a class="ae lv" href="https://react-hook-form.com/api/usewatch" rel="noopener ugc nofollow" target="_blank"> useWatch </a>、<a class="ae lv" href="https://react-hook-form.com/api/useformstate" rel="noopener ugc nofollow" target="_blank"> useFormState </a>、<a class="ae lv" href="https://react-hook-form.com/api/usefieldarray" rel="noopener ugc nofollow" target="_blank"> useFieldArray </a>)，以及更多的方法(例如，<a class="ae lv" href="https://react-hook-form.com/api/useform/setfocus" rel="noopener ugc nofollow" target="_blank"> setFocus </a>、<a class="ae lv" href="https://react-hook-form.com/api/useform/getfieldstate" rel="noopener ugc nofollow" target="_blank"> getFieldState </a>、<a class="ae lv" href="https://react-hook-form.com/api/useform/resetfield" rel="noopener ugc nofollow" target="_blank"> resetField </a>、<a class="ae lv" href="https://react-hook-form.com/api/useform/setvalue" rel="noopener ugc nofollow" target="_blank"> setValue)但是希望这个例子能激发您尝试这个库🙌</a></p><p id="fca2" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">就是这样！你可以在这里找到完整的代码<a class="ae lv" href="https://codesandbox.io/s/react-hook-form-example-uhp977?file=/src/App.js" rel="noopener ugc nofollow" target="_blank"/>，玩玩吧:)感谢你的时间！⏰</p><p id="184c" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">如果你也对我的其他文章感兴趣，这里有一些链接:</p><div class="nm nn gp gr no np"><a rel="noopener  ugc nofollow" target="_blank" href="/a-shopping-list-with-react-hook-usereducer-310a3b6578"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd io gy z fp nu fr fs nv fu fw im bi translated">用React Hook useReducer创建购物清单</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">带有useReducer React挂钩的购物清单——一个让useReducer更容易理解的小练习。</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od km np"/></div></div></a></div><div class="nm nn gp gr no np"><a rel="noopener  ugc nofollow" target="_blank" href="/create-a-simple-react-custom-hook-fc733d7b977a"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd io gy z fp nu fr fs nv fu fw im bi translated">创建一个简单的React自定义挂钩</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">关于如何创建一个简单的React自定义钩子的教程</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ny l"><div class="oe l oa ob oc ny od km np"/></div></div></a></div><div class="nm nn gp gr no np"><a rel="noopener  ugc nofollow" target="_blank" href="/create-a-simple-express-server-node-js-for-react-application-e2b2bd0c7e93"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd io gy z fp nu fr fs nv fu fw im bi translated">为React应用程序创建一个简单的Express服务器(Node.js)</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">关于如何创建一个简单的Express服务器(Node.js)、将其连接到React应用程序以及解决错误的教程…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ny l"><div class="of l oa ob oc ny od km np"/></div></div></a></div><div class="nm nn gp gr no np"><a href="https://xiaominzhu.medium.com/react-functional-components-using-refs-a5ad1d2817d4" rel="noopener follow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd io gy z fp nu fr fs nv fu fw im bi translated">使用引用对功能组件进行反应</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">forwardRef和useImperativeHandle的示例</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">xiaominzhu.medium.com</p></div></div><div class="ny l"><div class="og l oa ob oc ny od km np"/></div></div></a></div><div class="nm nn gp gr no np"><a href="https://medium.com/geekculture/update-parent-state-from-child-component-with-react-context-api-a56cf3742428" rel="noopener follow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd io gy z fp nu fr fs nv fu fw im bi translated">用React上下文将状态从子节点更新到父节点</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">— React Context提供了一种通过组件树传递数据的方法，而不必在…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">medium.com</p></div></div><div class="ny l"><div class="oh l oa ob oc ny od km np"/></div></div></a></div></div><div class="ab cl ks kt hr ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ig ih ii ij ik"><p id="b365" class="pw-post-body-paragraph kz la in lb b lc ld jo le lf lg jr lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated"><em class="lw">更多内容请看</em><a class="ae lv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lb io"><em class="lw">plain English . io</em></strong></a><em class="lw">。报名参加我们的</em> <a class="ae lv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb io"> <em class="lw">免费周报</em> </strong> </a> <em class="lw">。关注我们关于</em><a class="ae lv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="lb io"><em class="lw">Twitter</em></strong></a><a class="ae lv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="lb io"><em class="lw">LinkedIn</em></strong></a><em class="lw"/><a class="ae lv" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="lb io"><em class="lw">YouTube</em></strong></a><em class="lw"/><a class="ae lv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="lb io"><em class="lw">不和</em> </strong> </a> <em class="lw">。对增长黑客感兴趣？检查</em> <a class="ae lv" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb io"> <em class="lw">电路</em> </strong> </a> <em class="lw">。</em></p></div></div>    
</body>
</html>