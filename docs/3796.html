<html>
<head>
<title>Same-Origin Page Communication Across Tabs Is So Easy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跨选项卡的同源页面通信非常容易</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/same-origin-page-communication-across-tabs-is-so-easy-16471a235d6c?source=collection_archive---------6-----------------------#2022-09-27">https://javascript.plainenglish.io/same-origin-page-communication-across-tabs-is-so-easy-16471a235d6c?source=collection_archive---------6-----------------------#2022-09-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8a21" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用广播通道API轻松处理同源页面之间的通信。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/712f56cae8a6e8cac114b77f76ce8876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AaLo6dyZZ3cjKnP-"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@domenicoloia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Domenico Loia</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="57a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在开发web项目时，您可能会遇到相同来源的页面之间进行通信的情况。对于这个场景，我们可以使用localStorage和Storage事件来解决同源页面之间的通信问题。另外，我们还可以使用<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API" rel="noopener ugc nofollow" target="_blank">广播通道API </a>来解决这个问题。也许你对广播频道API还比较陌生，没关系，本文将详细介绍API。</p><h1 id="9a34" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">1.广播频道API简介</h1><p id="3905" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API" rel="noopener ugc nofollow" target="_blank">广播通道API </a>可以实现不同浏览器窗口、标签页，或者同一原点下iframes下的浏览器上下文之间的简单通信。通过创建侦听通道的BroadcastChannel对象，可以接收发送到该通道的所有消息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/d1da10af3c833b95590baf2a43c56f75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FZ92fLjJ8VZltq_7eZwbeQ.png"/></div></div></figure><p id="cb15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经了解了广播通道API的作用，让我们看看如何使用它:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/0645b5cab3f02f2dd4b330a54eb827e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2QxjSDBQ9GpvCLVdWUxeRQ.jpeg"/></div></div></figure><p id="651f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从上图可以看出，广播通道API使用起来非常简单。除了支持发送字符串，<strong class="ky ir">这个API还可以发送其他对象，比如Blob、File、ArrayBuffer、Array等对象</strong>。但是，需要注意的是，在实际项目中，我们还需要考虑它的兼容性:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/94229a81eddc44d449cf49f238eb45f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QchtyoFXzyYaplHxrdAm4A.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo from <a class="ae kv" href="https://caniuse.com/?search=Broadcast%20Channel%20API" rel="noopener ugc nofollow" target="_blank">caniuse.com</a></figcaption></figure><p id="119f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在IE 11及以下版本中，不支持广播通道API。在这种情况下，可以考虑使用现成的<a class="ae kv" href="https://github.com/JSmith01/broadcastchannel-polyfill" rel="noopener ugc nofollow" target="_blank">broadcast-channel-poly fill</a>或者基于localStorage和Storage事件来实现。</p><h1 id="f4c3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">2.广播频道API使用场景</h1><p id="785e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">使用<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API" rel="noopener ugc nofollow" target="_blank">广播通道API </a>，我们可以轻松实现同源页面之间的一对多通信。此API的一些使用场景如下:</p><ul class=""><li id="85fa" class="ms mt iq ky b kz la lc ld lf mu lj mv ln mw lr mx my mz na bi translated">实现同源页面之间的数据同步；</li><li id="4dcf" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated">同步其他选项卡页面中的用户操作。</li></ul><p id="810c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了让您更好地掌握广播通道API，我们举两个具体的例子。</p><h2 id="9392" class="ng lt iq bd lu nh ni dn ly nj nk dp mc lf nl nm me lj nn no mg ln np nq mi nr bi translated">2.1背景色与BroadcastChannel API同步</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/9eae985b1fd262a7760b11b6a7bbf6b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*HNJ1r18XfB19ZVkYtBUmUw.gif"/></div></div></figure><p id="f213" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的例子中，我们已经在不同的选项卡中打开了<strong class="ky ir">data-sync.html</strong>页面，它有一个颜色选择输入框来设置页面的背景。当我们在任何一个打开的页面中设置新的背景颜色时，其他页面的背景颜色也会自动更新。</p><p id="5e37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用广播信道API可以容易地实现上述功能。对应于此示例的完整代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h2 id="cab1" class="ng lt iq bd lu nh ni dn ly nj nk dp mc lf nl nm me lj nn no mg ln np nq mi nr bi translated">2.2同步其他选项卡页面中的用户操作</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/17367e98eac399bcc121047dfe4b9a31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*_Lnl-StloRGxcHvxDg7S8g.gif"/></div></div></figure><p id="079f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的例子中，我们已经在不同的标签中打开了<strong class="ky ir">status-sync.html</strong>页面。当通过按钮切换登录状态时，两个不同选项卡中页面的登录状态会自动同步。</p><p id="3939" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对应于此示例的完整代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h1 id="5f90" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">3.摘要</h1><p id="7d1b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API" rel="noopener ugc nofollow" target="_blank">广播频道API </a>是一个非常简单的API，它包含一个用于内部跨上下文通信的接口。在支持此API的浏览器中，我们可以使用此API轻松地在相同来源的页面之间进行通信。对于不支持此API的浏览器，我们可以考虑使用localStorage和Storage事件来解决同源页面之间的通信问题。</p><p id="ac55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" rel="noopener ugc nofollow" target="_blank">的邮件API </a>和<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API" rel="noopener ugc nofollow" target="_blank">的广播频道API </a>有什么区别呢？一个重要的区别是postMessage API可以用来在不同的来源之间传递消息。</p><p id="00ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于广播频道API的相关内容就介绍到这里。如果你在阅读方面有什么问题，请给我留言。</p></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="c3ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想学习打字稿，那么就不要错过<strong class="ky ir">掌握打字稿</strong>系列。</p><ul class=""><li id="1df0" class="ms mt iq ky b kz la lc ld lf mu lj mv ln mw lr mx my mz na bi translated"><a class="ae kv" href="https://medium.com/frontend-canteen/what-are-k-t-and-v-in-typescript-generics-9fabe1d0f0f3" rel="noopener"><strong class="ky ir">TypeScript泛型中的K、T、V是什么？</strong>T13】</a></li><li id="257c" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated"><a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/using-typescript-mapped-types-like-a-pro-be10aef5511a"> <strong class="ky ir">使用TypeScript像Pro一样映射类型</strong> </a></li><li id="3b5a" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated"><a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/use-typescript-conditional-types-like-a-pro-7baea0ad05c5"> <strong class="ky ir">使用TypeScript条件类型像亲</strong> </a></li><li id="5fd2" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated"><a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/using-typescript-intersection-types-like-a-pro-a55da6a6a5f7"> <strong class="ky ir">使用TypeScript交集类型像亲</strong> </a></li><li id="5d29" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated"><a class="ae kv" href="https://levelup.gitconnected.com/using-typescript-infer-like-a-pro-f30ab8ab41c7" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">使用打字稿推断像亲</strong> </a></li><li id="d056" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated"><a class="ae kv" href="https://medium.com/javascript-in-plain-english/how-to-use-typescript-template-literal-types-like-a-pro-2e02a7db0bac" rel="noopener"> <strong class="ky ir">使用TypeScript模板字面类型像亲</strong> </a></li><li id="f23a" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated"><a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/15-utility-types-that-every-typescript-developer-should-know-6cf121d4047c"> <strong class="ky ir">打字稿可视化:15种最常用的实用类型</strong> </a></li><li id="847f" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated"><a class="ae kv" href="https://levelup.gitconnected.com/10-things-you-need-to-know-about-typescript-classes-f58c57869266" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">关于类型脚本类你需要知道的10件事</strong> </a></li><li id="54ed" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated"><a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/purpose-of-declare-keyword-in-typescript-8431d9db2b10"><strong class="ky ir"/></a>中‘declare’关键字的用途</li><li id="d2cc" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated"><a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/no-more-confusion-about-typescripts-any-and-unknown-98c4b53f8924"> <strong class="ky ir">不再混淆打字稿的“任何”和“未知”</strong> </a></li></ul><div class="ob oc gp gr od"><div role="button" tabindex="0" class="ab bv gv cb fp oe of bn og kp ex"><div class="oh l"><div class="ab q"><div class="l di"><img alt="Bytefer" class="l de bw oi oj fe" src="../Images/238cf2afd3c689b50719951ba2fd880d.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*krjVh9VFhDEcMUif4Ewt-A.png"/><div class="fb bw l oi oj fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated">拜特弗</p></div></div><div class="om on gw l"><h2 class="bd ir ts ms fp tt fr fs tu fu fw ip bi translated">掌握打字稿系列</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi tv au tw tx ty qi tz an eh ei ua ub uc el em eo de bk ep" href="https://medium.com/@bytefer/list/mastering-typescript-series-688ee7c12807?source=post_page-----16471a235d6c--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="ud l fo"><span class="bd b dl z dk">47 stories</span></div></div></div><div class="oz dh pa fp ab pb fo di"><div class="di or bv os ot"><div class="dh l"><img alt="" class="dh" src="../Images/8fba4cad7ae795f6abed5234e33e0356.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*l87u8lL_MzD5n4z_"/></div></div><div class="di or bv ou ov ow"><div class="dh l"><img alt="" class="dh" src="../Images/373c978fed504a3c38f0fdb5b617fedb.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*94uN4q2Of_fg3WaQ"/></div></div><div class="di bv ox oy ow"><div class="dh l"><img alt="" class="dh" src="../Images/a8ea3e3ecad1c2d2697107f3ce466e42.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*tGza_iE2o--HjQwD"/></div></div></div></div></div><p id="479f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<a class="ae kv" href="https://medium.com/@bytefer" rel="noopener"> Medium </a>或<a class="ae kv" href="https://twitter.com/Tbytefer" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我，阅读更多关于TS和JS的内容！</p></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="ea99" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="pg">更多内容请看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="pg">plain English . io</em></strong></a><em class="pg">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="pg">免费周报</em> </strong> </a> <em class="pg">。关注我们关于</em><a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="pg">Twitter</em></strong></a><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="pg">LinkedIn</em></strong></a><em class="pg"/><a class="ae kv" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="pg">YouTube</em></strong></a><em class="pg"/><a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="pg">不和</em> </strong> </a> <em class="pg">。对增长黑客感兴趣？检查</em> <a class="ae kv" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="pg">电路</em> </strong> </a> <em class="pg">。</em></p></div></div>    
</body>
</html>