<html>
<head>
<title>Useful JavaScript Promise Implementations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">有用的JavaScript承诺实现</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/useful-javascript-promise-implementations-f9bfb254d92d?source=collection_archive---------11-----------------------#2022-07-04">https://javascript.plainenglish.io/useful-javascript-promise-implementations-f9bfb254d92d?source=collection_archive---------11-----------------------#2022-07-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f2b2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用JavaScript承诺的三种独特方式</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/093135cc4833b704174f1402f31cb273.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uQr5fPU8s9dXbuxrlxjsAA.png"/></div></div></figure><p id="2d0c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">作为JavaScript开发人员，我们喜欢承诺。我们可以用它们来等待事件，比如HTTP响应。我们还可以将它们与JavaScript定时器、数据库调用等结合使用。</p><p id="a8a9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里有三个你以前可能没有想到的JavaScript承诺的用例。</p><h1 id="77f1" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">1.睡眠定时器/延迟执行</h1><p id="e1a3" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">许多语言都有办法让当前线程休眠一段特定的时间。例如，Python中的<code class="fe mk ml mm mn b">time</code>库公开了<code class="fe mk ml mm mn b">time.sleep</code>，它在指定的秒数内停止执行。JavaScript提供了类似的机制，但是它有一些奇怪的地方。</p><p id="d407" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果查看JavaScript文档，您会发现一个<code class="fe mk ml mm mn b">setTimeout</code>函数，它在指定的毫秒数后执行回调。您可以这样使用它:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mo"><img src="../Images/8ebeba04c56a6d72664caf4bb96f61bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*McDJ5-bDrAzZahSkvaP3fg.png"/></div></div></figure><p id="3cbe" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这段代码定义了单击按钮时的回调:</p><ol class=""><li id="6eb6" class="mp mq iq kt b ku kv kx ky la mr le ms li mt lm mu mv mw mx bi translated">将按钮文本设置为<code class="fe mk ml mm mn b">Activating button</code>。</li><li id="9961" class="mp mq iq kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">等待1秒钟。</li><li id="312a" class="mp mq iq kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">将按钮文本设置为<code class="fe mk ml mm mn b">Button activated</code>。</li><li id="6604" class="mp mq iq kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">等待1秒钟。</li><li id="f30b" class="mp mq iq kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">将按钮文本设置为<code class="fe mk ml mm mn b">Button deactivated</code>。</li></ol><p id="74a3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可能会看到这个解决方案会变得多么糟糕。您将不得不在<code class="fe mk ml mm mn b">setTimeout</code>的回调中保留嵌套代码。相反，您可以编写一个小函数，结合使用<code class="fe mk ml mm mn b">setTimeout</code>和JavaScript来实现一个类似但更简洁的解决方案。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/ce59135b38ab18cf7cd27cb7dd4f84b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pd5YUskTv1_xOmXLfmoCJg.png"/></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk">JavaScript equivalent to sleep.</figcaption></figure><p id="9d16" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">在</strong> <code class="fe mk ml mm mn b"><strong class="kt ir">sleep()</strong></code> <strong class="kt ir">的引擎盖下发生了什么？</strong></p><ol class=""><li id="5a88" class="mp mq iq kt b ku kv kx ky la mr le ms li mt lm mu mv mw mx bi translated">用回调创建一个新的承诺对象</li><li id="f6c2" class="mp mq iq kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated">回调使用一个<code class="fe mk ml mm mn b">resolve</code>参数，该参数应该在<code class="fe mk ml mm mn b">Promise</code>解析时调用。</li><li id="2b58" class="mp mq iq kt b ku my kx mz la na le nb li nc lm mu mv mw mx bi translated"><code class="fe mk ml mm mn b">setTimeout</code>被调用，在<code class="fe mk ml mm mn b">ms</code>毫秒后调用<code class="fe mk ml mm mn b">resolve</code>函数。</li></ol><p id="6367" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我们的异步函数中，我们可以调用<code class="fe mk ml mm mn b">await sleep(...)</code>，它告诉JavaScript在继续之前等待承诺被解决。</p><h1 id="8e0a" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">2.单发事件</h1><p id="ae33" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">有时，您可能希望事件侦听器只被调用一次。你只是在等待用户做一些事情。注册网站时，他们通常会让你滚动到条款和条件的底部，然后你才能点击“我同意”按钮；即使您向上滚动，您仍然可以单击“我同意”按钮。这是一个单一火灾事件的例子。</p><p id="6926" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了简单起见，我将使用一个简单的按钮来举例。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/16fd31f5fb6c1e08c6bcbfe5727639e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gDOtzFmxEGS-GXMAB8QT4w.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/bda26647d0616b95feeeb49592536426.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hks3cpOHlhVTFVSUTtIGxQ.png"/></div></figure><p id="e220" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当上述代码在同一网页上运行时:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/6a0352eab48bcd9d4d6844ffeddfab4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*WmP0yv8K3tmd0eAcR2Vb0w.gif"/></div></div></figure><h1 id="7406" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">3.动画片</h1><p id="3eea" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated"><em class="nj"> ⚠️警告:在可以使用CSS的情况下，避免使用JavaScript制作动画。浏览器中的JavaScript是单线程的，因此将JavaScript用于动画会占用宝贵的资源。</em></p><p id="fd93" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">类似于我们用promises开发的<code class="fe mk ml mm mn b">sleep</code> hack，你可以使用Promises来设置完美定时的动画。为了简单起见，让我们用一个从左向右移动一个<code class="fe mk ml mm mn b">div</code>的例子。</p><p id="d604" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">HTML的设置应该非常简单。我们将创建一个<code class="fe mk ml mm mn b">div</code>元素作为容器，另一个<code class="fe mk ml mm mn b">div</code>元素将被激活。我们还将添加一个按钮来启动/加速动画。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/a9d8d957dd786a71d43a67e74bdca588.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w98LFoZ94pfPhmuYCfS4TQ.png"/></div></figure><p id="3376" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">CSS很简单。当子元素(<code class="fe mk ml mm mn b">#object</code>)被绝对定位时，<code class="fe mk ml mm mn b">#container</code>元素将被相对定位。对象的<code class="fe mk ml mm mn b">left</code>位置最初将是<code class="fe mk ml mm mn b">0</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/136610df96b78f0fff74d2317b435702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rfg5S_gE0fK45RU3PwtJhA.png"/></div></figure><p id="e743" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在对于JavaScript，我们将有一个名为<code class="fe mk ml mm mn b">move</code>的函数，它将对象向右移动。17毫秒后，我们将解决承诺。我用17毫秒以每秒60帧的速度更新动画。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/99b41d38a8ad782095e54c8d6eedd845.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7gy2O4sIvQiZvnqd1y363Q.png"/></div></figure><p id="aa71" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在再次循环之前，<code class="fe mk ml mm mn b">start</code>函数将为<code class="fe mk ml mm mn b">move()</code>函数解析<code class="fe mk ml mm mn b">await</code>。动画将如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/9e8827b00a94fdc48ae37c2212a479a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*lZzCM1VSv8rjwsDKbH7jrg.gif"/></div></div></figure><p id="80eb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="nj">注意:我的解决方案使用了执行1000次的for循环。您可以对无限动画使用无限while循环，或者在对象移动一定数量的像素时退出动画循环。</em></p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="ecf1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你喜欢这篇文章，看看更多这样的文章。</p><div class="nr ns gp gr nt nu"><a rel="noopener  ugc nofollow" target="_blank" href="/jquery-sucks-stop-using-it-454f51fb398"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">jQuery糟透了:停止使用它</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">以下是为什么停止使用jQuery是最好的选择。</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="od l"><div class="oe l of og oh od oi kp nu"/></div></div></a></div><div class="nr ns gp gr nt nu"><a rel="noopener  ugc nofollow" target="_blank" href="/web-development-a-roadmap-to-success-5ed8439c72a2"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">Web开发:成功的路线图</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">成为一名优秀的web开发人员只需要十个步骤。这很简单，我会告诉你怎么做。</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="od l"><div class="oj l of og oh od oi kp nu"/></div></div></a></div><div class="nr ns gp gr nt nu"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-really-implement-the-sleep-function-in-javascript-621b4ed1e618"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">如何在JavaScript中真正实现sleep()函数</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">如何用JavaScript实现sleep()函数的指南(正确方法)。</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="od l"><div class="ok l of og oh od oi kp nu"/></div></div></a></div><div class="nr ns gp gr nt nu"><a rel="noopener  ugc nofollow" target="_blank" href="/stop-using-logical-or-use-null-coalescing-instead-f7668c96b0db"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">停止使用逻辑OR，使用？？代替</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">你可以在很多事情上使用逻辑操作符，但是不要在任何事情上都使用它们！我们现在有更好的东西了。</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="od l"><div class="ol l of og oh od oi kp nu"/></div></div></a></div><p id="95af" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="nj">更多内容请看</em><a class="ae om" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="nj">plain English . io</em></strong></a><em class="nj">。报名参加我们的</em> <a class="ae om" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="nj">免费周报</em> </strong> </a> <em class="nj">。关注我们关于</em><a class="ae om" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="nj">Twitter</em></strong></a><em class="nj">和</em><a class="ae om" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="nj">LinkedIn</em></strong></a><em class="nj">。查看我们的</em> <a class="ae om" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="nj">社区不和谐</em> </strong> </a> <em class="nj">加入我们的</em> <a class="ae om" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="nj">人才集体</em> </strong> </a> <em class="nj">。</em></p></div></div>    
</body>
</html>