<html>
<head>
<title>How to Add Route Guard for Angular Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为角度应用添加路由保护</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-add-route-guard-for-angular-applications-309f3b0ca845?source=collection_archive---------6-----------------------#2022-01-03">https://javascript.plainenglish.io/how-to-add-route-guard-for-angular-applications-309f3b0ca845?source=collection_archive---------6-----------------------#2022-01-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/7f87b9dfd1c713015e314993d3b5eacd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mZuwMFh7kvF94gxchReSkg.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@markuswinkler?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Markus Winkler</a> on <a class="ae jz" href="https://unsplash.com/s/photos/protect?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d501" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在angular应用程序中，有时您可能需要将某些页面/路径限制给用户。例如，可能有一个只能由登录用户访问的页面。因此，如果我们能够阻止用户在没有登录系统的情况下进入这个页面，那就太好了。这种功能可以通过路由保护来实现。</p><p id="2eb4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">angular提供了几种路由器防护装置，每一种都有不同的用途。在这里，我们将重点关注路由器防护最常见的使用案例，即使用<strong class="kc io"> canActivate </strong> route guard阻止某些用户访问应用程序的特定路由。</p><p id="4fe7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们开始旅程吧。</p><ol class=""><li id="f12c" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">使用以下命令创建一个新的角度项目。</li></ol><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="32a2" class="lq lr in lm b gy ls lt l lu lv"><strong class="lm io"><em class="lw">ng new &lt;projectName&gt;</em></strong></span></pre><p id="4c90" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2.让我们添加两个组件来比较有和没有路由器防护的变化。执行以下命令。</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="7865" class="lq lr in lm b gy ls lt l lu lv"><strong class="lm io"><em class="lw">ng g c home<br/>ng g c user</em></strong></span></pre><p id="5288" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">主页是公开的，而用户页面只允许登录的用户使用。</p><p id="166e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.创建服务。这就是验证用户的逻辑所在。使用以下命令创建服务。你可以给任何你想要的名字。</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="8766" class="lq lr in lm b gy ls lt l lu lv"><strong class="lm io"><em class="lw">ng g s auth</em></strong></span></pre><p id="3515" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">4.让我们创建路由器防护。下面的命令可以做到这一点。它会问你想用什么路由器保护。选择激活。</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="1764" class="lq lr in lm b gy ls lt l lu lv"><strong class="lm io"><em class="lw">ng g g auth</em></strong></span></pre><p id="1141" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，您将能够将下面的TS文件命名为auth.guard.ts。</p><figure class="lh li lj lk gt jo"><div class="bz fp l di"><div class="lx ly l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">auth.guard.ts</figcaption></figure><p id="ed30" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">5.接下来，让我们向auth-service添加一个简单的逻辑。</p><figure class="lh li lj lk gt jo"><div class="bz fp l di"><div class="lx ly l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">auth.service.ts</figcaption></figure><p id="d36c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这只是一个非常简单的代码，只有一个布尔变量。但这是您可以编写实际逻辑来检查用户是否经过身份验证的地方。</p><p id="e932" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">6.现在我们可以在canActivate内部检查这个。</p><figure class="lh li lj lk gt jo"><div class="bz fp l di"><div class="lx ly l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">auth.guard.ts</figcaption></figure><p id="9dfd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">授权服务已被注入到授权保护中。如果用户已登录，则canActivate返回true，否则返回false。我为未授权的标准添加了console.log()。</p><p id="7393" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">6.最后，我们必须为我们的路由添加auth-guard。</p><figure class="lh li lj lk gt jo"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="f1c3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如开头所述，/home路由是公共的，/user路由是受限的。所以我们要做的就是为上面定义的路线添加<strong class="kc io"><em class="lw">can activate:[auth guard]</em></strong>。就是这样！</p><p id="f35d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们验证一下这是否有效。我已经删除了app.component.html的所有HTML，除了<strong class="kc io"><em class="lw">&lt;router-outlet&gt;&lt;/router-outlet&gt;</em></strong>以便于可视化结果。</p><p id="4c1b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">执行以下命令来运行项目。</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="cbd7" class="lq lr in lm b gy ls lt l lu lv">ng serve</span></pre><p id="82e2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">把<a class="ae jz" href="http://localhost:4200/home" rel="noopener ugc nofollow" target="_blank">http://localhost:4200/home</a>放到浏览器上。我们可以看到以下内容。</p><figure class="lh li lj lk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lz"><img src="../Images/14b7d40ea1269c3801f273ffaf61ebf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*APtXYj2Qp6deIGxvADOSmg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">home page</figcaption></figure><p id="918b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在检查一下<a class="ae jz" href="http://localhost:4200/home" rel="noopener ugc nofollow" target="_blank">http://localhost:4200/u</a>ser。我们将得到下面的输出。</p><figure class="lh li lj lk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ma"><img src="../Images/3f305532cf234306f43e87d3e1465f3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xvzGk1M7XWc3sUKH3On3Xw.png"/></div></div></figure><p id="f617" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，它不允许我们进入用户页面。它也在控制台中显示“未授权”。按预期工作。</p><p id="17df" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在将auth-service中的<strong class="kc io"> <em class="lw"> loggedIn </em> </strong>变量改为<strong class="kc io"> <em class="lw"> true </em> </strong>。现在它应该允许访问用户页面。</p><figure class="lh li lj lk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mb"><img src="../Images/74fd54c0426184be2a87b5a39bc41499.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9f_E_BqChzuhpmKD6g850Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">user page</figcaption></figure><p id="675c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">是的，有效！。</p><p id="873a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请注意，不建议这样做来增加我们应用程序的安全性。这种安全性必须在服务器端实现。这对于改善用户在这类事情上的体验很有帮助。</p><p id="750c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以在这里找到工作示例。</p><div class="mc md gp gr me mf"><a href="https://github.com/Kanchana46/angular-auth-guard.git" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab fo"><div class="mh ab mi cl cj mj"><h2 class="bd io gy z fp mk fr fs ml fu fw im bi translated">GitHub-kanchana 46/angular-auth-guard</h2><div class="mm l"><h3 class="bd b gy z fp mk fr fs ml fu fw dk translated">此项目是使用Angular CLI版本8.3.19生成的。为开发服务器运行ng serve。导航到…</h3></div><div class="mn l"><p class="bd b dl z fp mk fr fs ml fu fw dk translated">github.com</p></div></div><div class="mo l"><div class="mp l mq mr ms mo mt jt mf"/></div></div></a></div><p id="0554" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">编码快乐！</p><p id="8dd8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="lw">更多内容看</em> <a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="lw">说白了. io </em> </strong> </a> <strong class="kc io"> <em class="lw">。</em> </strong> <em class="lw">报名参加我们的</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="lw">免费每周简讯</em> </strong> </a> <strong class="kc io"> <em class="lw">。</em> </strong> <em class="lw">在我们的</em><strong class="kc io"><em class="lw"/></strong><a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="lw">社区不和谐</em> </strong> </a> <strong class="kc io"> <em class="lw">中获得独家写作机会和建议。</em>T47】</strong></p></div></div>    
</body>
</html>