<html>
<head>
<title>Catch TypeScript Errors in Next.js Before Building Your App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在构建应用程序之前，捕获Next.js中的TypeScript错误</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/catch-typescript-errors-in-nextjs-before-building-your-app-df129682ee5c?source=collection_archive---------2-----------------------#2022-03-11">https://javascript.plainenglish.io/catch-typescript-errors-in-nextjs-before-building-your-app-df129682ee5c?source=collection_archive---------2-----------------------#2022-03-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="e228" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">自动执行任务以捕捉Next.js中的类型错误</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/a17aebc4199182d85e481b240bc1e556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uaa_I0UW0uaWFQ_nVG2OYQ.jpeg"/></div></div></figure><p id="fe62" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">最近，我们在西北图书馆的开发团队已经在我们的UI应用程序中过渡到类型脚本。当开发环境看起来运行良好时，我们已经遇到了两次CI构建失败的“陷阱”。这是一个简单的解决方案，但可能会节省你一点时间和挠头。</p><h1 id="d824" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">问题</h1><p id="9a6d" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">应用程序代码库在本地开发模式下成功运行，但是当被推送到应用程序的CI ( <a class="ae lk" href="https://en.wikipedia.org/wiki/Continuous_integration" rel="noopener ugc nofollow" target="_blank">持续集成</a>)管道时，在暂存基础上构建会失败。</p><p id="5576" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">嗯。我们像一个负责任的开发人员一样运行Next.js的预连线<code class="fe mi mj mk ml b">next lint</code>脚本，一切都没问题。我们尝试Next.js的<code class="fe mi mj mk ml b">next build</code>脚本，它就在那里；构建失败。</p><h1 id="f81a" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated"><strong class="ak">手动解决方案</strong></h1><p id="9188" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">一个解决方案是记得在每次<code class="fe mi mj mk ml b">git</code>提交之前手动运行<code class="fe mi mj mk ml b">next build</code>，因为<code class="fe mi mj mk ml b">next build</code>似乎在某种程度上捕捉到了打字错误。(至少我自己)记得每次手动运行这个的机会？不太好。</p><h1 id="9650" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">或者…自动化解决方案</h1><p id="1301" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">如何在Next.js中自动执行这项任务，在为pull请求推送代码之前捕捉类型错误，甚至不去想它？</p><p id="77cb" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">一种选择是设置<em class="mm">一个</em> <a class="ae lk" href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks#:~:text=The%20pre%2Dcommit%20hook%20is,to%20inspect%20in%20the%20code." rel="noopener ugc nofollow" target="_blank"> <em class="mm">预提交钩子</em> </a> <em class="mm">。</em></p><p id="ab28" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在实际提交发生之前，预提交挂钩将在<code class="fe mi mj mk ml b">git commit</code>运行。</p><p id="2074" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">一个常见的用例是运行测试(单元或集成)，作为提交前的钩子动作，以自动化测试覆盖率的保证。然而，我们想要的是在git提交发生之前将<em class="mm">类型检查</em>添加到代码中。</p><p id="9f4e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如前所述，默认的Next.js配置是预先绑定了一个<code class="fe mi mj mk ml b">next lint</code>命令的。该命令将根据您的<a class="ae lk" href="https://eslint.org/" rel="noopener ugc nofollow" target="_blank"> ESLint配置</a>捕获JavaScript错误，但是ESLint配置不会自动识别TypeScript，即使在使用TypeScript引导您的Next.js应用程序时也是如此。</p><h1 id="ba5a" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">代码</h1><p id="6dbf" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">让我们添加一些代码来帮助解决这个问题。这是假设您的Next.js应用程序配置为使用TypeScript。如果是这样，您将可以访问TypeScript <a class="ae lk" href="https://www.typescriptlang.org/docs/handbook/compiler-options.html" rel="noopener ugc nofollow" target="_blank">命令行编译器工具</a>、<code class="fe mi mj mk ml b">tsc</code>。</p><p id="1c8f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">将下面一行添加到您的<code class="fe mi mj mk ml b">package.json</code>文件的<code class="fe mi mj mk ml b">scripts</code>块中:</p><pre class="kd ke kf kg gt mn ml mo mp aw mq bi"><span id="7e86" class="mr lm in ml b gy ms mt l mu mv">”ts-lint”: “tsc — noEmit — incremental — watch”,</span></pre><p id="943d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe mi mj mk ml b">ts-lint</code>可以叫任何东西，仅供参考。</p><p id="aa26" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这个命令说，<em class="mm">“类型检查代码，但是不要在文件或任何东西中创建类型定义。在我开发“</em>的时候，也要继续关注代码和类型检查。</p><p id="6334" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe mi mj mk ml b">package.json</code>的<code class="fe mi mj mk ml b">scripts</code>座现在应该是这样的:</p><pre class="kd ke kf kg gt mn ml mo mp aw mq bi"><span id="f6d8" class="mr lm in ml b gy ms mt l mu mv">"scripts": {<br/>  "build": "next build",<br/>  "dev": "next dev",<br/>  "lint": "next lint",<br/>  ...<br/>  "ts-lint": "tsc --noEmit --incremental --watch",<br/>  ...<br/>},</span></pre><p id="ab06" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">尝试在您的终端中手动运行<code class="fe mi mj mk ml b">ts-lint</code>。有打字错误吗？搞定他们。</p><h1 id="ca3d" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">添加预提交挂钩</h1><p id="d984" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">现在让我们建立一个预提交钩子。</p><p id="6659" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">第一步，安装<code class="fe mi mj mk ml b">husky</code> <a class="ae lk" href="https://www.npmjs.com/package/husky" rel="noopener ugc nofollow" target="_blank"> NPM包</a>作为你的应用程序的开发依赖。</p><pre class="kd ke kf kg gt mn ml mo mp aw mq bi"><span id="c881" class="mr lm in ml b gy ms mt l mu mv">npm install -D husky</span><span id="46c1" class="mr lm in ml b gy mw mt l mu mv">// or via yarn<br/>yarn add -D husky</span></pre><p id="840a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">Husky是一个轻量级的助手，可以与提交工作流结合在一起。</p><p id="f6aa" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们来做一个哈士奇一旦安装后的快速配置。更多细节或手动配置，请查看文档。哦，在运行下面的命令之前，确保您的<code class="fe mi mj mk ml b">package.json</code>文件已经保存。</p><p id="ad78" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">根据您使用的是<code class="fe mi mj mk ml b">npm</code>还是<code class="fe mi mj mk ml b">yarn</code>，这里有一段来自<code class="fe mi mj mk ml b">husky</code>文档的关于如何运行自动化配置的片段:</p><pre class="kd ke kf kg gt mn ml mo mp aw mq bi"><span id="bb6d" class="mr lm in ml b gy ms mt l mu mv"># NPM<br/>npx husky-init &amp;&amp; npm install</span><span id="a5e9" class="mr lm in ml b gy mw mt l mu mv"># Yarn 1<br/>npx husky-init &amp;&amp; yarn</span><span id="be76" class="mr lm in ml b gy mw mt l mu mv"># Yarn 2<br/>yarn dlx husky-init --yarn2 &amp;&amp; yarn</span></pre><p id="e9de" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">运行这个<code class="fe mi mj mk ml b">husky-init</code>配置脚本做了几件事:</p><ol class=""><li id="ddc8" class="mx my in kq b kr ks ku kv kx mz lb na lf nb lj nc nd ne nf bi translated">修改您的<code class="fe mi mj mk ml b">package.json</code>文件，将<code class="fe mi mj mk ml b">husky</code>添加到您的<code class="fe mi mj mk ml b">scripts</code>块中，这允许它的执行。</li><li id="aeb7" class="mx my in kq b kr ng ku nh kx ni lb nj lf nk lj nc nd ne nf bi translated">在您的项目根目录下创建一个<code class="fe mi mj mk ml b">.husky</code>目录，其中包含您想要运行的预提交钩子。您也可以(我们也将)编辑它。</li></ol><p id="35d7" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">默认情况下，自动husky配置创建命令<code class="fe mi mj mk ml b">npm run test</code>。对于本文的例子，让我们将<code class="fe mi mj mk ml b">npm run test</code>改为对我们的代码进行类型检查。</p><h1 id="ff6d" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">添加预提交命令</h1><p id="8757" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">现在将下面的新命令添加到我们的<code class="fe mi mj mk ml b">package.json</code>文件<code class="fe mi mj mk ml b">scripts</code>块中。它看起来与上面的<code class="fe mi mj mk ml b">ts-lint</code>命令非常相似，除了这个命令不监视我们的代码。一次搞定。</p><pre class="kd ke kf kg gt mn ml mo mp aw mq bi"><span id="91e5" class="mr lm in ml b gy ms mt l mu mv">"ts-lint-commit-hook": "tsc --noEmit --incremental",</span></pre><p id="5e91" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在打开项目中的<code class="fe mi mj mk ml b">.husky/pre-commit</code>文件，让我们更新<code class="fe mi mj mk ml b">husky</code>的预提交命令:</p><pre class="kd ke kf kg gt mn ml mo mp aw mq bi"><span id="14fb" class="mr lm in ml b gy ms mt l mu mv">#!<em class="mm">/bin/sh<br/></em>. "$(dirname "$0")/_/husky.sh"</span><span id="4589" class="mr lm in ml b gy mw mt l mu mv">// OLD<br/><em class="mm"># npm run test</em></span><span id="2bb0" class="mr lm in ml b gy mw mt l mu mv"><em class="mm">// NEW<br/>npm run ts-lint-commit-hook</em></span></pre><p id="2df9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">仅此而已。现在，随着每次提交，您的TypeScript代码将进行类型检查，以确保在您的代码进入任何CI工作流之前，它不包含任何类型错误。如果失败了，你会比你的队友更早知道。😁</p><p id="da58" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">看看我们正在为西北图书馆知识库构建的一个新的数字收藏应用程序中的<a class="ae lk" href="https://github.com/nulib/dc-nextjs" rel="noopener ugc nofollow" target="_blank">工作实现</a>，它使用Next.js、<a class="ae lk" href="https://www.radix-ui.com/" rel="noopener ugc nofollow" target="_blank"> Radix </a>、<a class="ae lk" href="https://stitches.dev/" rel="noopener ugc nofollow" target="_blank"> Stitches </a>，以及我们正在构建的一个<a class="ae lk" href="https://github.com/nulib/design-system" rel="noopener ugc nofollow" target="_blank">新设计系统</a>。</p><div class="nl nm gp gr nn no"><a href="https://github.com/nulib/dc-nextjs" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd io gy z fp nt fr fs nu fu fw im bi translated">GitHub-nulib/DC-NextJS:NextJS数字收藏的游乐场</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">运行开发服务器:用浏览器打开http://localhost:3000。您可以通过修改…开始编辑页面</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">github.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc km no"/></div></div></a></div><h1 id="2784" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">Next.js功能强大</h1><p id="cf3b" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">Next.js是一个强大的下一代平台，用于构建基于React的项目。结合通过TypeScript中的类型检查减少错误，您可以构建任何东西，从静态单页应用程序、组件库、节点API到混合服务器端呈现的应用程序，即使没有数百万页也有数千页。</p></div><div class="ab cl od oe hr of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="ig ih ii ij ik"><p id="4ac1" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="mm">更多内容看</em> <a class="ae lk" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="mm">说白了就是</em> </strong> </a> <em class="mm">。报名参加我们的</em> <a class="ae lk" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="mm">免费每周简讯</em> </strong> </a> <em class="mm">。关注我们</em><a class="ae lk" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="mm">Twitter</em></strong></a><em class="mm">和</em><a class="ae lk" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="mm">LinkedIn</em></strong></a><em class="mm">。加入我们的</em> <a class="ae lk" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="mm">社区不和谐</em> </strong> </a> <em class="mm">。</em></p><h2 id="7ead" class="mr lm in bd ln ok ol dn lr om on dp lv kx oo op lx lb oq or lz lf os ot mb ou bi translated">进一步阅读</h2><div class="nl nm gp gr nn no"><a rel="noopener  ugc nofollow" target="_blank" href="/typescript-made-easy-a-guide-to-your-first-type-safe-app-with-next-js-wundergraph-and-prisma-e197a59e2b30"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd io gy z fp nt fr fs nu fu fw im bi translated">轻松编写类型脚本:使用Next.js、WunderGraph和Prisma编写第一个类型安全应用程序的指南</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">是时候抛开恐惧，学习TypeScript了。让我们给你第一次“发现！”瞬间通过建立一个完整的…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="nx l"><div class="ov l nz oa ob nx oc km no"/></div></div></a></div></div></div>    
</body>
</html>