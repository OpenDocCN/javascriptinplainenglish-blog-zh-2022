<html>
<head>
<title>Fixing React-Native android release build</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">修复React-原生android发布版本</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-native-android-release-build-crashes-fa93f07a2ba4?source=collection_archive---------1-----------------------#2022-07-01">https://javascript.plainenglish.io/react-native-android-release-build-crashes-fa93f07a2ba4?source=collection_archive---------1-----------------------#2022-07-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="9c72" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">Android发布版本在启动时崩溃，但在开发模式下运行良好。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/647d7685af9e6a01fcf3950e6ffe99e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3dSbKnAoEaE27fUx_VyvCg.jpeg"/></div></div></figure><p id="ea60" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">经过几个月的精心研发，你的应用终于可以发布了。充满无限的兴奋和成就感，你期待着向世界介绍你的百万美元的应用程序。然后你按照<a class="ae lk" href="https://reactnative.dev/docs/signed-apk-android" rel="noopener ugc nofollow" target="_blank"> React-Native官方指南</a>中提到的每一步，生成一个生产就绪的<code class="fe ll lm ln lo b">.apk</code>文件，用于在发布到谷歌Play商店之前测试你的应用。</p><p id="87f5" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">然后，在终端中运行以下命令，编译并生成一个生产构建<code class="fe ll lm ln lo b">.apk</code>文件；生成的文件将位于<code class="fe ll lm ln lo b">android/app/build/outputs/apk/release/app-release.apk</code>下。</p><pre class="kd ke kf kg gt lp lo lq lr aw ls bi"><span id="ac20" class="lt lu in lo b gy lv lw l lx ly">cd android</span><span id="9034" class="lt lu in lo b gy lz lw l lx ly">./gradlew assembleRelease</span></pre><p id="bc1c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">生成<code class="fe ll lm ln lo b">.apk</code>文件后，你把它安装在你的Android设备上，只要你打开应用，它就崩溃了。</p><p id="42ab" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">你不知道哪里出了问题；您开始重新检查，看看您是否遗漏了React-Native文档中提到的任何步骤；你开始在StackOverflow和Github上搜索解决方案，尝试所有你发现的随机解决方案。你感到沮丧，紧张，充满了自我怀疑。冒名顶替综合症爆发了，你后悔选择了React-Native而不是其他移动开发框架。</p></div><div class="ab cl ma mb hr mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ig ih ii ij ik"><p id="2b61" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io">TL；DR: </strong>在看了很多关于StackOverflow和GitHub问题的回答和评论后，我也有类似的感觉。以下是我在寻找和修复发布版本问题时遵循的步骤。</p><h1 id="55e0" class="mh lu in bd mi mj mk ml mm mn mo mp mq jt mr ju ms jw mt jx mu jz mv ka mw mx bi translated"><strong class="ak">使用Logcat CLI确定问题</strong></h1><p id="2f0a" class="pw-post-body-paragraph ko kp in kq b kr my jo kt ku mz jr kw kx na kz la lb nb ld le lf nc lh li lj ig bi translated">将您的设备连接到您的机器(确保USB调试在上<strong class="kq io">)并在您的终端上运行以下命令。</strong></p><pre class="kd ke kf kg gt lp lo lq lr aw ls bi"><span id="bd64" class="lt lu in lo b gy lv lw l lx ly">adb logcat '*:E'</span></pre><p id="98e0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">点击了解更多关于<strong class="kq io"> Logcat CLI语法</strong> <a class="ae lk" href="https://developer.android.com/studio/command-line/logcat" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="87b5" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在运行logcat工具来记录系统日志之后，我遇到了两个导致应用程序崩溃的问题。</p><p id="daf1" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io"> 1。找不到要加载的DSO:libjsexecutor . so</strong></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nd"><img src="../Images/6c4055897f5997de761b3bda3c376ae0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kWZI7ICdeeuONY0AaZd-8A.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk"><strong class="bd ni">java.lang.UnsatisfiedLinkError</strong>: couldn’t find DSO to load: <strong class="bd ni">libjsexecutor.so</strong></figcaption></figure><p id="2722" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我通过在GitHub注释<a class="ae lk" href="https://github.com/facebook/react-native/issues/25537#issuecomment-1104619909" rel="noopener ugc nofollow" target="_blank">这里</a>提到的<code class="fe ll lm ln lo b">build.gradle</code>文件中的<code class="fe ll lm ln lo b">project.ext.react</code>数组内添加<code class="fe ll lm ln lo b">enableVmCleanup: false</code>解决了libjsexecutor.so错误。</p><pre class="kd ke kf kg gt lp lo lq lr aw ls bi"><span id="5698" class="lt lu in lo b gy lv lw l lx ly">project.ext.react = [<br/>    enableHermes: true,     // clean and rebuild if changing<br/>    <strong class="lo io">enableVmCleanup: false, </strong>//this<br/>]</span></pre><p id="4b4c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">2.<strong class="kq io"> java.lang.RuntimeException:无法加载脚本。</strong></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nj"><img src="../Images/16a4b117da5656595e92e9002e69b35d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ACDTvBaEPpki9A8-3zUuyw.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk"><strong class="bd ni">java.lang.RuntimeException</strong>: Unable to load script. Make sure you’re either running Metro (run ‘npx react-native start’) or that your bundle <strong class="bd ni">‘index.android.bundle’ </strong>is packaged correctly for release.</figcaption></figure><p id="4afe" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">要解决此问题，请遵循以下步骤</p><ul class=""><li id="e824" class="nk nl in kq b kr ks ku kv kx nm lb nn lf no lj np nq nr ns bi translated">如果文件已经存在，从<code class="fe ll lm ln lo b">android/app/src/main/assets</code>中删除<code class="fe ll lm ln lo b">index.android.bundle</code>，或者只运行下面的命令(确保您在项目的根目录下)。</li></ul><pre class="kd ke kf kg gt lp lo lq lr aw ls bi"><span id="e122" class="lt lu in lo b gy lv lw l lx ly">rm android/app/src/main/assets/index.android.bundle</span></pre><ul class=""><li id="0447" class="nk nl in kq b kr ks ku kv kx nm lb nn lf no lj np nq nr ns bi translated">运行下面给出的命令来生成你的android包，这将在<code class="fe ll lm ln lo b">android/app/src/main/assets</code>中生成<code class="fe ll lm ln lo b">index.android.bundle</code>文件</li></ul><pre class="kd ke kf kg gt lp lo lq lr aw ls bi"><span id="b097" class="lt lu in lo b gy lv lw l lx ly">npx react-native bundle \<br/>--platform android \<br/>--dev false \<br/>--entry-file index.js \<br/>--bundle-output android/app/src/main/assets/index.android.bundle</span></pre><ul class=""><li id="6c6f" class="nk nl in kq b kr ks ku kv kx nm lb nn lf no lj np nq nr ns bi translated">现在运行下面的命令来生成一个发布版本</li></ul><pre class="kd ke kf kg gt lp lo lq lr aw ls bi"><span id="0509" class="lt lu in lo b gy lv lw l lx ly">cd android<br/>./gradlew clean<br/>./gradlew assembleRelease</span></pre><p id="2faa" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">希望这将修复你的应用程序的崩溃问题，你的应用程序应该准备好部署。</p><p id="f2fe" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="nt">随时提供任何反馈和改进，编码快乐……</em></p></div></div>    
</body>
</html>