<html>
<head>
<title>How to hide your API keys and tokens in React to protect your application.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React中隐藏API键和令牌来保护应用程序？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/keep-your-application-secure-discover-how-to-hide-your-api-keys-and-tokens-in-react-364bb5a45372?source=collection_archive---------0-----------------------#2022-12-23">https://javascript.plainenglish.io/keep-your-application-secure-discover-how-to-hide-your-api-keys-and-tokens-in-react-364bb5a45372?source=collection_archive---------0-----------------------#2022-12-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ec85" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在带有Vite和nodejs的Reactjs中使用环境变量</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e10e1cebbe7652e9713668bb50c9eeac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QLhCcvgNjAyMpCjQ"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@moneyphotos?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">regularguy.eth</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b4a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您是否注意到一些应用程序在其源代码中有API密钥、令牌或其他可见的敏感凭证？或者您自己的应用程序？</p><p id="1ead" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">嗯，这可能很危险，会使您的服务处于危险之中。</p><p id="f6f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">API密钥、令牌和其他敏感凭证用于验证和授权对服务和API的访问。如果这些数据在应用程序的源代码中公开，任何可以看到您的代码的人都可以访问它，并使用它来代表您执行未经授权的操作。</p><p id="1d41" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，通过公开您的凭据，您允许第三方使用它们，这可能会影响您的服务的性能或质量，甚至对它们进行攻击。</p><p id="f819" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本教程将向我们展示如何隐藏您的API密钥、令牌和其他敏感凭证。</p><h2 id="398d" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">如何隐藏敏感数据？</h2><p id="6fd7" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">实现这一点的一些方法有:</p><ul class=""><li id="878a" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">使用环境变量</li><li id="f261" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">使用代理服务器或后端平台即服务(BaaS)</li><li id="143a" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">使用安全的托管平台</li></ul><p id="d120" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过这种方式，您可以保护服务的安全性，防止它们受到危害。</p><p id="d2ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们将看到如何通过为React应用程序构建一个小型后端来隐藏敏感凭证。</p><h2 id="0e5d" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">在与Vite反应中使用环境变量</h2><p id="801c" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在本教程中，我们将添加一个<a class="ae kv" href="https://openweathermap.org/" rel="noopener ugc nofollow" target="_blank"> OpenWeather </a> APY键作为环境变量。</p><p id="19ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">具体来说，我们将使用<a class="ae kv" href="https://openweathermap.org/current" rel="noopener ugc nofollow" target="_blank">天气API </a>，这是一个提供天气数据的服务，在一定数量的请求之后，它开始对请求进行收费，所以我们不希望这个API密钥对公众可用。</p><p id="4174" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要在React with Vite中配置环境变量，我们可以遵循以下步骤:</p><p id="ca4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1 —使用<a class="ae kv" href="https://openweathermap.org/current" rel="noopener ugc nofollow" target="_blank"> Vite </a>创建您的React应用程序。我将使用TypeScript，但如果你愿意，你也可以使用JavaScript。</p><p id="db08" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2 —在项目的根目录下创建一个<code class="fe ne nf ng nh b">.env</code>文件。这个文件应该包含您希望在应用程序中使用的环境变量。</p><pre class="kg kh ki kj gt ni nh nj bn nk nl bi"><span id="ad89" class="nm lt iq nh b be nn no l np nq">API_KEY=784dc6d4eXXXXXXXXb14460d3a356565<br/>PORT=3001</span></pre><p id="f174" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦我们创建了我们的<code class="fe ne nf ng nh b">.env</code>文件，我们一定不能忘记将它附加到git的<code class="fe ne nf ng nh b">.gitignore</code>文件，否则，我们的API密匙将会暴露在存储库中。</p><p id="ce87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3—在Vite中，要访问环境变量，我们需要通过<code class="fe ne nf ng nh b">import.meta.env</code>来访问它们。这将返回一个包含Vite已知的可用环境变量的对象。</p><p id="9b23" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建的变量必须有前缀<code class="fe ne nf ng nh b">VITE_</code>，或者可以是覆盖默认配置选项<a class="ae kv" href="https://vitejs.dev/config/shared-options.html#envprefix" rel="noopener ugc nofollow" target="_blank"> envPrefix </a>的另一个前缀。</p><pre class="kg kh ki kj gt ni nh nj bn nk nl bi"><span id="ab41" class="nm lt iq nh b be nn no l np nq">const API_KEY = import.meta.env.VITE_API_KEY</span></pre><p id="cb9f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">4 —现在我们将创建一个简单的应用程序，它将获取天气API来检索城市的温度。</p><pre class="kg kh ki kj gt ni nh nj bn nk nl bi"><span id="b30c" class="nm lt iq nh b be nn no l np nq">import { useEffect, useState } from "react"<br/>import { ResponseWeather } from "../types"<br/><br/>const API_KEY = import.meta.env.VITE_API_KEY<br/><br/>import "./App.css"<br/><br/>function App() {<br/> const [weather, setWeather] = useState&lt;ResponseWeather | null&gt;(null)<br/><br/> useEffect(() =&gt; {<br/>   const options = {<br/>     method: "GET",<br/>     url: `https://api.openweathermap.org/data/2.5/weather?lat=43.7001&amp;lon=-79.4163&amp;appid=${API_KEY}`)<br/>     headers: {<br/>      "Content-Type": "application/json",<br/>     },<br/>  }<br/><br/>  axios.request(options).then(response =&gt; {<br/>   setWeather(response.data)<br/>  })<br/><br/> }, [])<br/><br/> if (!weather) return null<br/><br/> return (<br/>  &lt;div className='App'&gt;<br/>   &lt;h1&gt;{weather?.name}&lt;/h1&gt;<br/>   &lt;h2&gt;{Math.floor(weather?.main.temp - 273.15)} °C&lt;/h2&gt;<br/>   &lt;i&gt;<br/>     &lt;img<br/>       src={`http://openweathermap.org/img/wn/${weather?.weather[0].icon}@2x.png`}<br/>       alt={weather?.weather[0].description}<br/>      /&gt;<br/>   &lt;/i&gt;<br/>   &lt;p&gt;{weather?.weather[0].main}&lt;/p&gt;<br/>  &lt;/div&gt;<br/> )<br/>}<br/><br/>export default App   </span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/d4db64d46299a3677cfac87daf1aa610.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xYYyn1Ypog0SmYAL1XWPtw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Fetch Weather API</figcaption></figure><p id="42d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经用一个环境变量隐藏了我们的API键，并确保了<code class="fe ne nf ng nh b">.env</code>文件没有上传到存储库中，我们已经完成了一半的工作。</p><p id="5eb5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">更新:</strong>尽管保证应用程序安全的工作还不到一半，但这是我们在客户端能做的全部工作。确保我们没有在公开的存储库中保存项目的密钥或敏感变量。因为这将是另一个易受攻击的访问途径，所以有人可能无法访问web上的应用程序，但可能能够以某种方式找到项目的存储库。</p><p id="6dbe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们为什么这么说呢？因为我们的API密钥在最终版本中仍然是公开的，如果我们在浏览器中检查我们的应用程序，我们会发现API密钥的值，所以完全隐藏该值的唯一方法是在服务器端创建一个后端服务。</p><p id="29cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个后端将负责向Openweather服务和我们的客户端发出请求，也就是说，我们的React应用程序将查询这个后端。</p><h2 id="6cb5" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">创建后端服务</h2><p id="f894" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">要创建我们的后端，我们需要设置一个服务器，我们可以向它发出请求。</p><p id="ccd9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1 —我们将安装以下库:</p><pre class="kg kh ki kj gt ni nh nj bn nk nl bi"><span id="95d6" class="nm lt iq nh b be nn no l np nq">pnpm express cors dotenv axios</span></pre><p id="fc4c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们使用Typescript的情况下，我们还需要</p><pre class="kg kh ki kj gt ni nh nj bn nk nl bi"><span id="5ee7" class="nm lt iq nh b be nn no l np nq">pnpm ts-node @types/express @types/cors @types/dotenv @types/node</span></pre><ul class=""><li id="833b" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated"><a class="ae kv" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> express </a>创建服务器</li><li id="ce99" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><a class="ae kv" href="https://github.com/expressjs/cors#readme" rel="noopener ugc nofollow" target="_blank"> cors </a>实现不同域之间的资源共享。</li><li id="231c" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><a class="ae kv" href="https://github.com/motdotla/dotenv#readme" rel="noopener ugc nofollow" target="_blank"> dotenv </a>加载环境变量。</li><li id="de9f" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><a class="ae kv" href="https://axios-http.com/" rel="noopener ugc nofollow" target="_blank"> axios </a>获取数据。</li></ul><p id="6b73" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2 —我们在项目的根目录下创建一个名为<code class="fe ne nf ng nh b">api.ts</code>的文件。我们还借此机会向<code class="fe ne nf ng nh b">package.json</code>添加一个新命令来提升我们的服务器。</p><pre class="kg kh ki kj gt ni nh nj bn nk nl bi"><span id="9941" class="nm lt iq nh b be nn no l np nq">"scripts": {<br/>  "server": "npx ts-node api.ts",<br/>  ...<br/>}</span></pre><p id="035b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3 —我们创建服务器，并使我们将在React中使用的端点可用。</p><pre class="kg kh ki kj gt ni nh nj bn nk nl bi"><span id="f6db" class="nm lt iq nh b be nn no l np nq">import express from "express"<br/>import { Request, Response } from "express"<br/>import * as dotenv from "dotenv"<br/>import cors from "cors"<br/>import axios from "axios"<br/><br/>dotenv.config()<br/><br/>const app = express()<br/><br/>app.use(cors())<br/><br/>app.get("/api/weather", (req: Request, res: Response) =&gt; {<br/> const options = {<br/>  method: "GET",<br/>  url: `https://api.openweathermap.org/data/2.5/weather?lat=43.7001&amp;lon=-79.4163&amp;appid=${process.env.VITE_API_KEY}`,<br/>  headers: {<br/>   "Content-Type": "application/json",<br/>  },<br/> }<br/><br/> axios<br/>  .request(options)<br/>  .then(response =&gt; {<br/>   res.json(response.data)<br/>  })<br/>  .catch(err =&gt; {<br/>   console.log(err)<br/>  })<br/>})<br/><br/>app.listen(process.env.VITE_PORT, () =&gt; console.log(`Server on port ${process.env.VITE_PORT || 3001}`))</span></pre><p id="53f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们有了后端服务，我们的API密钥对客户端是完全隐藏的。我们可以根据需要添加更多的安全层，例如，在cors中，只添加托管我们的应用程序的域，并且只有该域可以发出请求。</p><p id="ee6b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">4 —我们使用以下命令启动服务器</p><pre class="kg kh ki kj gt ni nh nj bn nk nl bi"><span id="8f82" class="nm lt iq nh b be nn no l np nq">pnpm run server</span></pre><p id="755c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们只需要将React中请求的URL替换为后端中的URL。我们不再需要在React中检索API键。</p><pre class="kg kh ki kj gt ni nh nj bn nk nl bi"><span id="e627" class="nm lt iq nh b be nn no l np nq">// Before<br/>url: `https://api.openweathermap.org/data/2.5/weather?lat=43.7001&amp;lon=-79.4163&amp;appid=${API_KEY}`)<br/><br/>// After<br/> url: "http://localhost:3001/api/weather"</span></pre><p id="31d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样！我们的应用程序继续照常工作，只是我们不再在客户端公开API密钥。</p><p id="e305" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://github.com/ljaviertovar/data-safe-react/tree/main" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">这里回购。</strong>T3】</a></p><h2 id="1278" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">结论</h2><p id="c09c" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">总之，隐藏敏感数据是一件相对容易的事情，只要遵循上面提到的步骤，我们就可以避免重大风险和复杂性。</p><p id="b7ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这将有助于你保持你的项目安全。</p><p id="163f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">阅读更多:</strong></p><div class="ns nt gp gr nu nv"><a href="https://blog.bitsrc.io/how-to-auth-login-with-github-and-google-in-a-react-and-backend-app-77423565b506" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd ir gy z fp oa fr fs ob fu fw ip bi translated">如何在React和后端应用程序中使用GitHub和Google认证登录</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">实现社交登录:分步指南</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">blog.bitsrc.io</p></div></div><div class="oe l"><div class="of l og oh oi oe oj kp nv"/></div></div></a></div><div class="ns nt gp gr nu nv"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-set-up-a-graphql-server-and-client-in-next-js-step-by-step-guide-98a18088d7c6"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd ir gy z fp oa fr fs ob fu fw ip bi translated">如何在Next.js分步指南中设置GraphQL服务器和客户端</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">用Next.js和GraphQL构建简单的Web应用程序</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="oe l"><div class="ok l og oh oi oe oj kp nv"/></div></div></a></div><p id="0fe2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">想联系作者？<br/> </strong>喜欢在<a class="ae kv" href="https://twitter.com/ljaviertovar" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上与世界各地的朋友联系。</p><p id="6fad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ol">更多内容看</em> <a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ol">说白了。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ol">免费周报</em> </strong> </a> <em class="ol">。关注我们关于</em> <a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ol">推特</em> </strong> </a>，<a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ol">LinkedIn</em></strong></a><em class="ol">，</em><a class="ae kv" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ol">YouTube</em></strong></a><em class="ol">，以及</em> <a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ol">不和</em> </strong> </a> <strong class="ky ir"> <em class="ol">。</em> </strong></strong></a></p><p id="d0f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ol">有兴趣缩放你的软件启动</em> </strong> <em class="ol">？检查出</em> <a class="ae kv" href="https://circuit.ooo/?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ol">电路</em> </strong> </a> <em class="ol">。</em></p></div></div>    
</body>
</html>