<html>
<head>
<title>How to Send Cookies from Express to a Front-End Application in Production</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Cookies从Express发送到生产中的前端应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-send-cookies-from-express-to-a-front-end-application-in-production-9273a4f3ce72?source=collection_archive---------3-----------------------#2022-02-21">https://javascript.plainenglish.io/how-to-send-cookies-from-express-to-a-front-end-application-in-production-9273a4f3ce72?source=collection_archive---------3-----------------------#2022-02-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="514d" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何在HTTPS协议中通过快速会话包将cookies从快速应用程序发送到前端。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi kc"><img src="../Images/95d6a04baaadd989092eb0f4cfe90378.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*3Iaa7FSlnWJYRyM6FLARKQ.jpeg"/></div></figure><p id="73e3" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在本文中，我将解释如何通过快速会话包将cookies从快速应用程序发送到HTTPS协议的前端。</p><p id="39ac" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">如果您曾经尝试过在Express和React这样的前端应用程序中使用cookie，您一定会发现在设置cookie时，您必须在应用程序的不同部分考虑相当多的选项。错误地设置其中一个选项会导致cookie问题。更糟糕的是，错误信息不太清楚。</p><p id="92f2" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">我们将探索的第一组选项是cookie选项中的<em class="lg">安全</em>和<em class="lg">相同站点</em>选项。<em class="lg"> samesite </em>属性允许在第三方域(在本例中是您的前端应用程序)上设置cookies。这里有几个选项，但在这种情况下，最好将samesite设置为“none”，这允许在第三方网站上设置cookies。</p><p id="9b11" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">出于安全原因，大多数浏览器要求您随时将<em class="lg"> secure </em>选项设置为true，您可以将<em class="lg"> samesite </em>设置为“none”来执行HTTPS协议。因此您必须在HTTPS环境中托管您的应用程序。这意味着在使用HTTP协议的本地环境(localhost)中，您可能无法在解耦的应用程序中设置cookies。因此，你必须找到另一个替代品，也许是代理。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lh"><img src="../Images/2b19fe7fc7f528b0a9c78bbde57cc62d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9sbAUU3KCoPnp7ZoEMIH0Q.png"/></div></div></figure><p id="2a46" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">以上是您的快速会话中间件应该如何设置。<strong class="km io">注意cookie对象中的sameSite和secure选项是如何设置的。</strong></p><p id="63c5" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">另一个需要注意的选项是信任代理选项。大多数PAAS，例如Heroku，使用负载平衡器。基本上，负载平衡器是一种将网络请求分发到其他服务器的服务器。Express大多数情况下会查看req.socket.remoteAddress以查看请求是否来自HTTP或HTTPS连接，并且大多数情况下设置负载平衡器的方式是通过HTTP转发请求，因为它们与它们转发请求的服务器之间的通信通常在同一个VPC内。所以Express看到请求来自一个不安全的HTTP地址。但是幸运的是，我们可以告诉express查看x-forwarded头，看看原始请求来自哪里。这可以通过将信任代理设置为1来实现。因此，express将前端IP视为x-forwarded标头中最左侧的条目。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/23cee93d88dbb0c1e2a653da8f4cefa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*7H-cQMXJhTbXutqpIYL_ZA.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Setting the trust proxy option to 1</figcaption></figure><p id="7757" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">以上是如何设置信任代理选项。</p><p id="f54b" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><strong class="km io">注意:所有这些都应该在定义您的任何路线之前完成。</strong></p><p id="2df4" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">现在，我们需要在前端应用程序中包含一个选项。大多数情况下，当向一个URL发送请求时，cookie集会自动发送，但是在这种情况下，我们向另一个URL上的web服务器发送请求，因此需要您明确地告诉您用来发送请求的包发送cookie。在Axios、fetch和其他HTTP客户端包中，这可以通过将withCredentials选项设置为true来实现。</p><p id="faa2" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">因为您将前端和后端应用程序托管在两个不同的安全(HTTPS)域上。你通常遇到的第一个问题是<a class="ae lr" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="noopener ugc nofollow" target="_blank"> <em class="lg"> cors </em> </a> <em class="lg"> </em>问题。许多开发人员通常设置cors来将源响应头设置为通配符(*)。</p><pre class="kd ke kf kg gt ls lt lu lv aw lw bi"><span id="0b74" class="lx ly in lt b gy lz ma l mb mc">Access-Control-Allow-Origin: *</span></pre><p id="5215" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">如果您在Express app.use(cors())中像这样设置cors，这意味着您正在将access-control-response-origin头设置为通配符。</p><p id="4bd7" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">将cors设置为通配符会在将cookies设置为第三方域(您的前端应用程序)时产生问题。这是因为大多数浏览器<strong class="km io">不允许用通配符(*) origin头响应的服务器设置cookie</strong>，这是出于安全原因。因此，您必须显式设置原点，如果您使用的是cors包，只需将中间件中的原点选项设置为:</p><p id="1491" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><code class="fe md me mf lt b">app.use(cors({origin: “https://your-url.com"}))</code></p><p id="b8b0" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">要了解更多关于cors的信息，你可以<a class="ae lr" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="noopener ugc nofollow" target="_blank">点击这里</a>，我认为MDN在解释它方面做得很好。</p><p id="e7ea" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">同样出于安全原因，在express应用程序上还有一件事要做，您还必须通过将凭据选项设置为true来告诉cors接受凭据。因此，对于cors选项，它应该是这样的:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/b886c8672d7c7d4b8972f257781c812c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*xg4jGlDCWZ66ud78_Zv9Pw.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">This is how your cors option should look like</figcaption></figure><p id="26f9" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">我有一个youtube视频，其中我解释了如何从express应用程序到react前端设置cookies。在视频中，我还解释了如何在本地和生产中做到这一点。视频链接如下:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="faa3" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><em class="lg">更多内容请看</em><a class="ae lr" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="km io"><em class="lg">plain English . io</em></strong></a><em class="lg">。报名参加我们的</em> <a class="ae lr" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="km io"> <em class="lg">免费周报</em> </strong> </a> <em class="lg">。关注我们关于</em><a class="ae lr" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="km io"><em class="lg">Twitter</em></strong></a><em class="lg">和</em><a class="ae lr" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="km io"><em class="lg">LinkedIn</em></strong></a><em class="lg">。加入我们的</em> <a class="ae lr" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="km io"> <em class="lg">社区不和谐</em> </strong> </a> <em class="lg">。</em></p></div></div>    
</body>
</html>