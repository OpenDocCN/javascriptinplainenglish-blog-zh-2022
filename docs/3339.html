<html>
<head>
<title>Manage API Version in an Express App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">管理Express应用程序中的API版本</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/manage-api-version-in-express-app-8f3bca44a33c?source=collection_archive---------3-----------------------#2022-08-20">https://javascript.plainenglish.io/manage-api-version-in-express-app-8f3bca44a33c?source=collection_archive---------3-----------------------#2022-08-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="bf12" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用查询字符串、文件或基于路径的方法管理您的API版本</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/f302be3330a2fc0c5e992bc8a18aa8ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XeWZ2mx5piuT3Cgy"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@chuttersnap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">CHUTTERSNAP</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="6be6" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">介绍</h1><p id="6040" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">对于任何企业应用程序来说，在将多个应用程序与单个数据源进行通信时，API都是必不可少的一部分。因为我们要处理多个应用程序，所以我们自然需要为它们维护API版本。</p><p id="ecb9" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">版本的一般使用情况是，当您有一个移动应用程序和一个web应用程序，您需要对后端进行一些修复，但也需要对前端进行更改，这样您就可以使用版本控制的强大功能来自动更新它们，而无需进行太多更改。</p><p id="e142" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">有几种方法可以管理一个API版本，我们今天将讨论这一点。</p><h2 id="bc44" class="mm ku in bd kv mn mo dn kz mp mq dp ld lu mr ms lf ly mt mu lh mc mv mw lj mx bi translated">样板文件</h2><p id="76ef" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">让我们为示例应用程序创建一个样板文件，然后我们将为每种方法添加示例。我们将研究这些方法:</p><ul class=""><li id="50c9" class="my mz in ln b lo mh lr mi lu na ly nb mc nc mg nd ne nf ng bi translated">途径</li><li id="9f9e" class="my mz in ln b lo nh lr ni lu nj ly nk mc nl mg nd ne nf ng bi translated">文件</li><li id="c781" class="my mz in ln b lo nh lr ni lu nj ly nk mc nl mg nd ne nf ng bi translated">查询字符串</li></ul><p id="5cb7" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">因此，我们为它们创建单独的文件，并将它们的路径添加到测试中:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/ba0875048d63ad7b0a7a5761f2b7677f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*dxAVUj6LRDqg2p_ADLWWgQ.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Boilerplate app for all types of versioning</figcaption></figure><h2 id="f995" class="mm ku in bd kv mn mo dn kz mp mq dp ld lu mr ms lf ly mt mu lh mc mv mw lj mx bi translated">基于路线的版本控制</h2><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/8b990a47f05a6395b0789dd028f8b86a.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*2Hj6lZe_ymuA1Bc7ucfYHg.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Route folder structure</figcaption></figure><p id="cd70" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">对于任何版本可维护的途径来说，这都是理想的解决方案，在这种途径中，我们为每个版本定义一个对应的文件夹，并为特定的API版本维护定义相应的文件。</p><p id="4b80" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">这种方法被广泛使用，并且更加稳定，因为每条路径都有自己的文件，并且属于特定的文件夹。这种方法的唯一常见问题是不容易找到路由的控制器，您需要在文件夹中找到特定API的其他版本。因为您可以很容易地使用代码编辑器搜索来找到版本，所以问题较少，并且被广泛接受。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi no"><img src="../Images/f1a9e76cf0304d9d43a2e0d3e14c0a01.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*6ZU2X6kwwfxUd-C7b3aTzQ.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Importing and using route</figcaption></figure><p id="a6f4" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">这就是我们导入和使用路线的方式。每条路线都有自己的一组路线，并且可以位于嵌套层中。</p><p id="118a" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">对于任何路由，版本号将在开始处。例如，</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="3788" class="mm ku in nq b gy nu nv l nw nx">GET /api/v1/company/:companyId/employee/:employeeId/status</span></pre><h2 id="5842" class="mm ku in bd kv mn mo dn kz mp mq dp ld lu mr ms lf ly mt mu lh mc mv mw lj mx bi translated">文件级路由</h2><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/d04824eace4fff70d05d686616b2cb99.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*ZR_RURbHD_sCBQgWVla-hQ.png"/></div></figure><p id="d54e" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">这种方法非常松散，但创建起来很快。在这种方法中，我们将为所有版本维护相同的文件。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ny"><img src="../Images/b8a67780a3e900d573b3b040553ac59a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PG2x0i8yp5tR91EcUMdFyw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">File-based structure</figcaption></figure><p id="2a6d" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">对于任何路由，版本号都会在末尾。例如，</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="cd64" class="mm ku in nq b gy nu nv l nw nx">GET /api/company/:companyId/employee/:employeeId/v1/status</span></pre><h2 id="9f13" class="mm ku in bd kv mn mo dn kz mp mq dp ld lu mr ms lf ly mt mu lh mc mv mw lj mx bi translated">查询基于字符串的路线</h2><p id="9c56" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">这种方法与上面两种不同，因为您不需要添加路由定义，而是接受一个版本并根据该版本分配控制器。这种方法已经在市场上取得了进展，因为它只是后端级别的更改，指向API的任何版本或更改默认版本。</p><p id="48f8" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">在这种方法中，我们不需要遵循任何文件夹结构，但是我们可以随心所欲地定义路由:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/091de09edc72409fa40e5855482adf6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*buQvNDiAM6GuM5p5-nxksQ.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">manage the version using QS</figcaption></figure><p id="7210" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">这里，我们创建了一个<code class="fe oa ob oc nq b">registerController</code>方法，该方法根据控制器对象获取版本，并根据输入返回正确的控制器。下面是<code class="fe oa ob oc nq b">registerController</code>的实现:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi od"><img src="../Images/bcb00599579c49255d9a8c9aecbd6b85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*xFGN-XIywvkwJ_Y7VKKT5g.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Implementation of register controller</figcaption></figure><p id="71e3" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">我们正在检查是否有正确的查询字符串，然后将默认值分配给控制器。我们需要传递参数，因为返回值应该是可执行的。</p><p id="422e" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">这种路由实现的一个例子是:</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="3bc8" class="mm ku in nq b gy nu nv l nw nx">GET /api/company/:companyId/employee/:employeeId/status?_v=1.0.0<br/>GET /api/company/:companyId/employee/:employeeId/status?_v=2.0.0</span></pre><p id="2468" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">这种方法应该放在最后，因为其他中间件应该在这之前执行。</p><h2 id="fc42" class="mm ku in bd kv mn mo dn kz mp mq dp ld lu mr ms lf ly mt mu lh mc mv mw lj mx bi translated">结论</h2><p id="a716" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">你也可以在你的项目中使用和实现许多其他的想法，但是每一种方法都是某种东西的衍生物。</p><p id="0954" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">希望你喜欢这个新知识。您可以在这里找到本文的源代码:</p><div class="of og gp gr oh oi"><a href="https://github.com/Piyush-Use-Personal/manage-express-version" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd io gy z fp on fr fs oo fu fw im bi translated">GitHub-Piyush-使用-个人/管理-快速-版本</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">github.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow km oi"/></div></div></a></div></div><div class="ab cl ox oy hr oz" role="separator"><span class="pa bw bk pb pc pd"/><span class="pa bw bk pb pc pd"/><span class="pa bw bk pb pc"/></div><div class="ig ih ii ij ik"><p id="ede5" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated"><em class="oe">更多内容看</em> <a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ln io"> <em class="oe">说白了。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ln io"> <em class="oe">免费周报</em> </strong> </a> <em class="oe">。关注我们关于</em> <a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ln io"> <em class="oe">推特</em></strong></a><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ln io"><em class="oe">LinkedIn</em></strong></a><em class="oe"/><a class="ae ks" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ln io"><em class="oe">YouTube</em></strong></a><em class="oe"/><a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="ln io"><em class="oe">不和</em> </strong> </a> <em class="oe">。</em></strong></a></p></div></div>    
</body>
</html>