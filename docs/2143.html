<html>
<head>
<title>CORS: An Introduction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CORS:简介</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/cors-an-introduction-c1a251e780f7?source=collection_archive---------11-----------------------#2022-05-17">https://javascript.plainenglish.io/cors-an-introduction-c1a251e780f7?source=collection_archive---------11-----------------------#2022-05-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b61e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">什么是<strong class="ak">跨源资源共享</strong> ( <strong class="ak"> CORS </strong>)，它是如何工作的，如何利用全栈开发中最大的误差源</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/751ec4bfa11955f61959dbccc3ec1c46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zj_w7Rs2IvKrgZstvk5oHQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@markusspiske" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae kv" href="https://unsplash.com/s/photos/bugs-in-programming" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1741" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你曾经有过开发全栈网站的经验，你可能会接触到跨源资源共享(CORS)。</p><p id="1fcf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当您在机器上开发并测试后端如何响应前端(反之亦然)时，会发生很多次CORS错误，从而阻止整个代码运行。</p><p id="7c25" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">许多开发人员在没有真正了解他们正在处理什么以及应该如何管理它的情况下处理它。理解CORS也很重要，因为现在它已经在大多数浏览器中实现了。</p><p id="0c2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，让我们来发现它是什么。</p><h2 id="5231" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">什么是CORS？</h2><p id="eecd" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">CORS是一个首字母缩写词，意思是跨原产地资源共享。</p><p id="0fcb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这意味着每次你试图在你的网站上，用一个X网址，从一个Y网址请求各种资源。一个典型的例子是foo.com的<em class="mq">网站</em>向bar.com的<em class="mq">网站</em>请求想要的图片。</p><p id="5280" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它基于HTTP协议，其机制基于协议提供的报头。它检查请求实体是否有权获得所请求的资源。</p><p id="0727" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每次在Javascript中执行<em class="mq"> fetch() </em>或<em class="mq"> XMLHTTPRequest </em>时，你都在使用CORS。</p><h2 id="5167" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">它是如何工作的？</h2><p id="6353" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">CORS机制，根据主要的和编程的规则，如果调用实体可以检索它想要的图像，到它需要的数据集。</p><p id="f119" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这可以通过操纵源(域、端口、方案)或一些其他设置来完成，包括所需数据的类型或请求的类型。</p><p id="47a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，您可以将它视为一个过滤器，根据您的需要只接受某些类型的请求。</p><p id="1b27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要完全理解这种机制，您需要知道一些要点。它们是:</p><p id="9c59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">同源政策</strong></p><p id="81bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">几乎每个浏览器都采用了CORS带来的隐私政策。该特定政策的要点是同源政策。</p><p id="6757" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这意味着CORS允许来自相同来源的请求，并与它们自由共享资源。它还会阻止来自外部URL的任何内容，除非符合某些要求。</p><p id="bd58" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">预检</strong></p><p id="9167" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个简单的概念。这意味着某些类型的信息是完全不允许的，因此根本无法生成响应。</p><p id="097b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通常，一些像PUT或PATCH这样的方法是从服务器上预加载的，所以没有人能接触到这些内容。这只能从服务器本身进行更改，或者在可能的情况下通过更改请求进行更改。</p><p id="caa6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">访问控制允许来源</strong></p><p id="280c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">服务器使用这个特定术语来检查传入的请求是否来自有权检索资源的客户端。</p><p id="cb97" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它通常是一个URL列表或一个通配符。</p><p id="7052" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当服务器收到请求时，它会生成响应，并动态设置这个特定的属性。此时，服务器需要检查请求的来源是否与响应相同。</p><p id="fd42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果是，则没有问题，并且发送响应。否则，浏览器中会出现一个控制台错误，但只有一些安全问题的详细信息。所以，如果你不了解CORS，这很难调试。</p><p id="ad31" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果参数是通配符，则接受每个原点，但在其他音高中有一些限制。</p><p id="dc3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个接受请求的例子，因为源是允许的。</p><p id="a1a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请求:</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="828d" class="ls lt iq ms b gy mw mx l my mz">POST /doc HTTP/1.1<br/>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:71.0)<br/>Accept-Language: en-us,en;q=0.5<br/>Content-Length: 55<br/><strong class="ms ir">Origin: https://foo.example</strong><br/><br/>--- DATA STREAM ---</span></pre><p id="32f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">回应:</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="5718" class="ls lt iq ms b gy mw mx l my mz">HTTP/1.1 <strong class="ms ir">200 </strong>OK<br/>Date: Mon, 01 Dec 2008 01:15:40 GMT<br/><strong class="ms ir">Access-Control-Allow-Origin: https://foo.example</strong><br/><br/>--- DATA STREAM ---</span></pre><p id="d3ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">否则，将会显示404错误，并且没有与客户端共享的数据。</p><p id="c96c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">访问控制允许方法</strong></p><p id="8fcf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它与我们讨论的最后一个pitch相同，但它指的是HTTP方法。它完全按照前面讨论的音高工作。</p><p id="d240" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个可能的不同方法的列表。这可能是我们正在讨论的响应行的一个示例:</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="d1f9" class="ls lt iq ms b gy mw mx l my mz"><strong class="ms ir">Access-Control-Allowed-Methods: GET, POST, HEADER, PUT, PATCH</strong></span></pre><p id="f8dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，如果我发出一个删除请求，它会被系统预先触发并产生一个错误。否则，它将传递此控制并继续创建响应。</p><p id="f051" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">其他可能的CORS“过滤器”</strong></p><p id="6045" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以设置许多其他CORS音高，以避免收到服务器可以手动解决的不相关请求。以下是最著名的几个:</p><ul class=""><li id="12d5" class="na nb iq ky b kz la lc ld lf nc lj nd ln ne lr nf ng nh ni bi translated"><code class="fe nj nk nl ms b">Access-Control-Allowed-Headers</code></li><li id="8c94" class="na nb iq ky b kz nm lc nn lf no lj np ln nq lr nf ng nh ni bi translated"><code class="fe nj nk nl ms b"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Language" rel="noopener ugc nofollow" target="_blank">Acc</a>ess-Control-Max-Age</code></li><li id="3337" class="na nb iq ky b kz nm lc nn lf no lj np ln nq lr nf ng nh ni bi translated"><code class="fe nj nk nl ms b">Accept-Language</code></li><li id="0fdd" class="na nb iq ky b kz nm lc nn lf no lj np ln nq lr nf ng nh ni bi translated"><code class="fe nj nk nl ms b">Content-Language</code></li><li id="e93c" class="na nb iq ky b kz nm lc nn lf no lj np ln nq lr nf ng nh ni bi translated"><code class="fe nj nk nl ms b">Content-Type</code></li><li id="93a1" class="na nb iq ky b kz nm lc nn lf no lj np ln nq lr nf ng nh ni bi translated"><code class="fe nj nk nl ms b">Range</code></li></ul><h2 id="f38a" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">为什么CORS会产生这么多错误？</h2><p id="da45" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">正如我们前面说过的，当请求中应该包含的内容与请求中写入的内容不匹配时，就会产生CORS错误。</p><p id="e58d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很多时候，开发人员倾向于忘记CORS，因为它看起来很容易，而且在通过HTTP对服务器或API请求进行编程时，没有人关心它。</p><p id="b94e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，如果你在Node中编程，要把CORS添加到你的网站中，你只需要两行代码就足够了，以后你可以完全忘记它。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="aeaa" class="ls lt iq ms b gy mw mx l my mz">const express = require('express');<br/>const cors = require('cors');</span><span id="ce31" class="ls lt iq ms b gy nr mx l my mz">app = express();<br/>app.use(cors());</span></pre><p id="cc06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了管理这些错误，存在许多与CORS相关的问题的StackOverflow答案。大多数时候，他们依赖于降低规则的限制性，从而降低网站的安全性。</p><p id="592e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，如果你需要解决一个CORS错误，也要注意安全部分。</p><h2 id="0c4c" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">资源</h2><ul class=""><li id="31e5" class="na nb iq ky b kz ml lc mm lf ns lj nt ln nu lr nf ng nh ni bi translated"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="noopener ugc nofollow" target="_blank">CORS官方文件</a></li><li id="b1c3" class="na nb iq ky b kz nm lc nn lf no lj np ln nq lr nf ng nh ni bi translated"><a class="ae kv" href="https://www.youtube.com/watch?v=4KHiSt0oLJ0" rel="noopener ugc nofollow" target="_blank">100秒内CORS</a></li></ul><h2 id="338c" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">想要连接吗？</h2><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="8f69" class="ls lt iq ms b gy mw mx l my mz">Twitter: <a class="ae kv" href="https://twitter.com/MatteoPossamai_" rel="noopener ugc nofollow" target="_blank">https://twitter.com/MatteoPossamai_</a></span></pre><p id="5e7d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mq">更多内容请看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="mq">plain English . io</em></strong></a><em class="mq">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="mq">免费周报</em> </strong> </a> <em class="mq">。关注我们关于</em><a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="mq">Twitter</em></strong></a><em class="mq">和</em><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="mq">LinkedIn</em></strong></a><em class="mq">。查看我们的</em> <a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="mq">社区不和谐</em> </strong> </a> <em class="mq">加入我们的</em> <a class="ae kv" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="mq">人才集体</em> </strong> </a> <em class="mq">。</em></p></div></div>    
</body>
</html>