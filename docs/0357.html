<html>
<head>
<title>A Better Way to Use Angular Forms</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用角形的更好方法</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/a-better-way-to-use-angular-forms-cd22a5a0488a?source=collection_archive---------2-----------------------#2022-01-21">https://javascript.plainenglish.io/a-better-way-to-use-angular-forms-cd22a5a0488a?source=collection_archive---------2-----------------------#2022-01-21</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><figure class="gm go jp jq jr js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj jo"><img src="../Images/1079924e48b70cdb9d4bd6eed65686d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*00xfTW6s8CEYYEjAwLRL9g.png"/></div></div></figure><p id="4e21" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated"><em class="kx">“强权即公理”——你知道是谁</em>。不过这是真的！尽管角形很强大，但它也给控制器造成了巨大的混乱。FormBuilder，FormGroup，FormControl，保存逻辑，更新逻辑——近乎疯狂。今天，我将向您展示如何管理表单并带来一些理智。</p><p id="8761" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">进入服务——它们是可注射的，并在您需要时提供。那为什么不用服务来管理表单呢？那我们开始吧。</p><h2 id="32f6" class="ky kz ir bd la lb lc dn ld le lf dp lg kk lh li lj ko lk ll lm ks ln lo lp lq bi translated">第一步:接口</h2><p id="f3a0" class="pw-post-body-paragraph jz ka ir kb b kc lr ke kf kg ls ki kj kk lt km kn ko lu kq kr ks lv ku kv kw ik bi translated">首先，我们需要创建接口。在这个演示中，我将创建两个界面— <code class="fe lw lx ly lz b">Actor</code>是最终的实体，<code class="fe lw lx ly lz b">ActorCreateInput</code>是表单输入的形状。</p><figure class="mb mc md me gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj ma"><img src="../Images/82dc570f01192447fc40becf0e94442c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fXsERDmcvxVVNVOX5M7Byg.png"/></div></div></figure><h2 id="1c9b" class="ky kz ir bd la lb lc dn ld le lf dp lg kk lh li lj ko lk ll lm ks ln lo lp lq bi translated">第二步:服务</h2><p id="532f" class="pw-post-body-paragraph jz ka ir kb b kc lr ke kf kg ls ki kj kk lt km kn ko lu kq kr ks lv ku kv kw ik bi translated">创建一个ActorCreateFormService，它不是在根注入的，这意味着<code class="fe lw lx ly lz b">{ providedIn: 'root' }</code>没有传递给装饰者:</p><figure class="mb mc md me gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj mf"><img src="../Images/ffc9aa3e7c588b85e3ff60be94f4deab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pw7lD3qcIJFtqNRB48QcrA.png"/></div></div></figure><p id="514d" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">到目前为止，所有的事情都是不言自明的。在这个阶段，该服务除了创建FormGroup并将其分配给<code class="fe lw lx ly lz b">form</code>类属性之外，什么也不做。我添加了一些方便的方法来检索表单值和有效性。</p><p id="c3b6" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">为了保存或更新actors，我们需要连接HTTP服务。假设我们有一个ActorApiService来完成这项工作。所以把它注入:</p><pre class="mb mc md me gu mg lz mh mi aw mj bi"><span id="5e50" class="ky kz ir lz b gz mk ml l mm mn">constructor(<br/>    private fb: FormBuilder,<br/>    <strong class="lz is">private actorApiService: ActorApiService</strong>,<br/>) {}</span></pre><p id="8ecf" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">现在让我们编写一些创建和更新参与者的方法:</p><figure class="mb mc md me gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj mo"><img src="../Images/c2d7ef391328c8754b5966abde2e4ed9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ES7oRDFPYvsf0oWMsQ4LpQ.png"/></div></div></figure><p id="9165" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">我们需要最后一个方法来从数据库加载一个actor并填写表单。当一个演员需要剪辑时，这将派上用场。</p><figure class="mb mc md me gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj mp"><img src="../Images/e93e8b72f5d96408e30ca08ac35793c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MQK8C8ehux7c2kDCOLfa8g.png"/></div></div></figure><h2 id="ee86" class="ky kz ir bd la lb lc dn ld le lf dp lg kk lh li lj ko lk ll lm ks ln lo lp lq bi translated">第三步:控制器</h2><p id="cfe0" class="pw-post-body-paragraph jz ka ir kb b kc lr ke kf kg ls ki kj kk lt km kn ko lu kq kr ks lv ku kv kw ik bi translated">现在让我们看看如何在组件中使用它。因为我们没有在<code class="fe lw lx ly lz b">root</code>中提供，所以需要在正确的范围内提供(通常在组件内):</p><figure class="mb mc md me gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj mq"><img src="../Images/bc9027f1ea3d33dcd4c24eade1df4d5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k2P_z0jRdW3NKYba7kLTuA.png"/></div></div></figure><figure class="mb mc md me gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj mr"><img src="../Images/dc7e0c14f637548354f67750cc34c5a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R865woRb_yAtM6toNHiNJw.png"/></div></div></figure><p id="01fb" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">注意控制器有多干净。此外，您可以在其他地方使用相同的表单服务。</p><h2 id="d3b0" class="ky kz ir bd la lb lc dn ld le lf dp lg kk lh li lj ko lk ll lm ks ln lo lp lq bi translated">最后一步:抽象服务</h2><p id="534b" class="pw-post-body-paragraph jz ka ir kb b kc lr ke kf kg ls ki kj kk lt km kn ko lu kq kr ks lv ku kv kw ik bi translated">我们还没完。如果你仔细观察，表单服务有一些可重用的部分，我们也可以用于其他表单，例如— MovieCreateFormService。所以，让我们把表单类更进一步，使它变得抽象<code class="fe lw lx ly lz b">AbstractFormService</code>。它不再需要包含<code class="fe lw lx ly lz b">@Injectable()</code>装饰器:(为了简洁，省略了一些代码)。</p><figure class="mb mc md me gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj ms"><img src="../Images/0dcf3e8e22616b18eddc04e7074e975f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gdl3ZCh9DaVvrW68v1paIQ.png"/></div></div></figure><p id="e31b" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">现在创建并扩展MovieCreateFormService:</p><figure class="mb mc md me gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj mt"><img src="../Images/e74a155b5f668006b5c59538f3a32ad5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u_dqV4kIuDAF17iHuPK96Q.png"/></div></div></figure><p id="b30e" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">仅此而已，你只需要重写4个方法就可以让你的表单生效。它自动处理表单提交后的保存、更新和重置。您现在可以像使用<code class="fe lw lx ly lz b">ActorCreateFormService</code>一样使用<code class="fe lw lx ly lz b">MovieCreateFormService</code>。</p><h2 id="8a96" class="ky kz ir bd la lb lc dn ld le lf dp lg kk lh li lj ko lk ll lm ks ln lo lp lq bi translated">最后的想法</h2><p id="1243" class="pw-post-body-paragraph jz ka ir kb b kc lr ke kf kg ls ki kj kk lt km kn ko lu kq kr ks lv ku kv kw ik bi translated">你认为这种方法怎么样？我敢打赌，这种模式将在整个应用程序中节省大量loc(代码行)。但是请分享您对潜在问题和改进的想法。</p><p id="88b5" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">感谢阅读！</p><h2 id="8a12" class="ky kz ir bd la lb lc dn ld le lf dp lg kk lh li lj ko lk ll lm ks ln lo lp lq bi translated">完整代码</h2><figure class="mb mc md me gu js"><div class="bz fq l di"><div class="mu mv l"/></div></figure><p id="40bb" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated"><em class="kx">更多内容请看</em><a class="ae mw" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kb is"><em class="kx">plain English . io</em></strong></a><em class="kx">。报名参加我们的</em> <a class="ae mw" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kb is"> <em class="kx">免费周报</em> </strong> </a> <em class="kx">。在我们的</em> <a class="ae mw" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kb is"> <em class="kx">社区</em> </strong> </a> <em class="kx">获得独家获得写作机会和建议。</em></p></div></div>    
</body>
</html>