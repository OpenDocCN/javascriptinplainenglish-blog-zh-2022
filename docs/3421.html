<html>
<head>
<title>A Simple Way to Load Data Before Page Load in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angularä¸­é¡µé¢åŠ è½½å‰åŠ è½½æ•°æ®çš„ç®€å•æ–¹æ³•</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://javascript.plainenglish.io/simple-way-of-loading-data-before-page-load-in-angular-f98c079cff55?source=collection_archive---------0-----------------------#2022-08-26">https://javascript.plainenglish.io/simple-way-of-loading-data-before-page-load-in-angular-f98c079cff55?source=collection_archive---------0-----------------------#2022-08-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/e6b7efce652747532d6a004d36a2a152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P35ZAeA3Bc3FGDCx-cWbkQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@mike_van_den_bos" rel="noopener ugc nofollow" target="_blank">Mike van den Bos</a> on <a class="ae jz" href="https://unsplash.com/photos/jf1EomjlQi0" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a4f3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æ‚¨å¯èƒ½å·²ç»åœ¨app.componentçš„ngOnInitå‡½æ•°ä¸­å°è¯•è¿‡è¿™æ ·åšï¼Œä½†æ˜¯æ„è¯†åˆ°æ‚¨çš„æ•°æ®éœ€è¦æ›´å¿«åœ°åŠ è½½ã€‚æ‚¨å¯èƒ½ä¹Ÿå°è¯•è¿‡å®ç°è§£æå™¨ï¼Œä½†æ˜¯æ„è¯†åˆ°å®ƒä»¬æ›´é€‚åˆäºå•ç‹¬çš„è·¯ç”±ç¯å¢ƒã€‚è¿™é‡Œæœ‰å¦ä¸€ç§åœ¨é¡µé¢åŠ è½½ä¹‹å‰åŠ è½½æ•°æ®çš„æ–¹æ³•ï¼Œä½ å¯èƒ½è¿˜ä¸çŸ¥é“:è¿™ä¸ª<strong class="kc io"> APP_INITIALIZER </strong></p><h2 id="d243" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated"><strong class="ak">å®šä¹‰</strong></h2><p id="c00c" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">åœ¨æ·±å…¥ç ”ç©¶ä»£ç ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£APP_INITIALIZERæ˜¯ä»€ä¹ˆä»¥åŠå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><p id="8db1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">APP_INITIALIZERæ ‡è®°å…è®¸æ‚¨ä¸ºåº”ç”¨ç¨‹åºæä¾›é¢å¤–çš„åˆå§‹åŒ–å‡½æ•°ã€‚æ‚¨å¯èƒ½å·²ç»ä»åç§°ä¸­äº†è§£åˆ°ï¼Œåˆå§‹åŒ–å‡½æ•°æ˜¯åœ¨åº”ç”¨ç¨‹åºåˆå§‹åŒ–æœŸé—´æ‰§è¡Œçš„ã€‚è¿™äº›å‡½æ•°çš„è¿”å›ç±»å‹å¿…é¡»æ˜¯voidã€Promiseæˆ–Observableã€‚å¦‚æœä»è¿™äº›å‡½æ•°ä¸­çš„ä»»ä½•ä¸€ä¸ªè¿”å›äº†ä¸€ä¸ªæ‰¿è¯ºæˆ–ä¸€ä¸ªå¯è§‚å¯Ÿå€¼ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºåªæœ‰åœ¨å®ƒä»¬å®Œæˆä¹‹åæ‰è¢«åˆå§‹åŒ–ã€‚</p><p id="a5c0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æ›´ç®€å•åœ°è¯´ï¼Œæˆ‘å–œæ¬¢æŠŠå®ƒçœ‹ä½œæ˜¯å®šä¹‰ä¸€ä¸ªâ€œå¯åŠ¨â€é˜¶æ®µï¼Œåœ¨è¿™ä¸ªé˜¶æ®µï¼Œä½ å¯ä»¥ç¡®ä¿åœ¨ç”¨æˆ·å¼€å§‹ä¸å®ƒäº¤äº’ä¹‹å‰ï¼Œä½ çš„åº”ç”¨ç¨‹åºæ­£å¸¸è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰æ ¸å¿ƒæ•°æ®éƒ½å·²åŠ è½½ã€‚</p><p id="3be1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ä¸‹é¢æ˜¯ä¸€äº›å¯ä»¥åœ¨åˆå§‹åŒ–å‡½æ•°ä¸­åŠ è½½å†…å®¹çš„ä¾‹å­:</p><ul class=""><li id="225f" class="lw lx in kc b kd ke kh ki kl ly kp lz kt ma kx mb mc md me bi translated">ç¿»è¯‘</li><li id="7e71" class="lw lx in kc b kd mf kh mg kl mh kp mi kt mj kx mb mc md me bi translated">ç»è¿‡éªŒè¯çš„ç”¨æˆ·æ•°æ®</li><li id="fd86" class="lw lx in kc b kd mf kh mg kl mh kp mi kt mj kx mb mc md me bi translated">é…ç½®æ•°æ®</li></ul><h2 id="93af" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated"><strong class="ak">ä¸¾ä¾‹</strong></h2><p id="d47d" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">ä¸ºäº†ç®€å•èµ·è§ï¼Œè®©æˆ‘ä»¬ä»¥åŠ è½½å½“å‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·çš„æ•°æ®ä¸ºä¾‹ã€‚</p><p id="fea7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">å¤§å¤šæ•°webåº”ç”¨ç¨‹åºåœ¨å±å¹•çš„å³ä¸Šè§’æ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„ä¸ªäººèµ„æ–™å›¾ç‰‡å’Œå§“åï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å®ç°ä¸€äº›ç±»ä¼¼çš„ä¸œè¥¿ã€‚æˆ‘å°†ä¸ºCSSä½¿ç”¨å…¨æ–°çš„è§’åº¦å®‰è£…(14.1)å’ŒBootstrap 5:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="2ea6" class="ky kz in mp b gy mt mu l mv mw">ng new angular-app-initializer --routing --style=scss<br/>cd angular-app-initializer<br/>npm install --save bootstrap</span></pre><p id="00ae" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ç°åœ¨æ‰“å¼€æ‚¨çš„<code class="fe mx my mz mp b">styles.scss</code>å¹¶å¯¼å…¥å¼•å¯¼ç¨‹åº:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="a21d" class="ky kz in mp b gy mt mu l mv mw"><em class="na">// src/styles.scss</em></span><span id="7163" class="ky kz in mp b gy nb mu l mv mw">@import '~bootstrap/scss/bootstrap';</span></pre><blockquote class="nc nd ne"><p id="2a7d" class="ka kb na kc b kd ke kf kg kh ki kj kk nf km kn ko ng kq kr ks nh ku kv kw kx ig bi translated">å¦‚æœæ‚¨ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„Angularï¼Œä¸€äº›å¯¼å…¥å’Œè¯­æ³•å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œæ‰€ä»¥å¦‚æœæ‚¨éµå¾ªä»£ç ï¼Œè¯·æ³¨æ„è¿™ä¸€ç‚¹ã€‚</p></blockquote><h2 id="5586" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated"><strong class="ak">å¥ å®šåŸºç¡€</strong></h2><p id="3ea6" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">è®©æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªè´Ÿè´£æä¾›å½“å‰ç”¨æˆ·æ•°æ®çš„æœåŠ¡ï¼Œç°åœ¨çœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·çš„:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="200c" class="ky kz in mp b gy mt mu l mv mw"><em class="na">// src/app/service/user.service.ts</em></span><span id="274c" class="ky kz in mp b gy nb mu l mv mw">import { <em class="na">Injectable</em><strong class="mp io"><em class="na"> </em></strong>} from '@angular/core';<br/><br/>@Injectable({<br/>  providedIn: 'root'<br/>})<br/>export class UserService {<br/>  private _data: IUserData = {<br/>    name: 'guest',<br/>    avatar: 'assets/no-avatar.png' <em class="na">// grab a random avatar image and put it in your assets folder</em><br/>  }<br/><br/>  get data(): IUserData {<br/>    return this._data;<br/>  }<br/>}<br/><br/>export interface IUserData {<br/>  name: string,<br/>  avatar: string<br/>}</span></pre><p id="229a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">è¿™å°†æ˜¯æˆ‘ä»¬æ•°æ®çš„é»˜è®¤å€¼ï¼Œç›´åˆ°æˆ‘ä»¬è¯·æ±‚è·å–å®é™…çš„å½“å‰ç”¨æˆ·æ•°æ®ã€‚</p><p id="2ba7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">è®©æˆ‘ä»¬åˆ©ç”¨è¿™äº›æ•°æ®ï¼Œå¹¶å°†å…¶æ˜¾ç¤ºåœ¨å±å¹•çš„å³ä¸Šè§’ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†ç›´æ¥åœ¨AppComponentä¸­è¿™æ ·åšã€‚</p><p id="8e38" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬æ³¨å…¥æˆ‘ä»¬çš„ç”¨æˆ·æœåŠ¡:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="13c3" class="ky kz in mp b gy mt mu l mv mw"><em class="na">// src/app/app.component.ts</em></span><span id="bd76" class="ky kz in mp b gy nb mu l mv mw">import { Component } from '@angular/core';<br/>import { UserService } from './service/user.service';<br/><br/>@Component({<br/>  selector: 'app-root',<br/>  templateUrl: './app.component.html',<br/>  styleUrls: ['./app.component.scss']<br/>})<br/>export class AppComponent {<br/>  constructor(public userService: UserService) {<br/>  }<br/>}</span></pre><p id="83c2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ç„¶åå¯¹äºHTML:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="cdcb" class="ky kz in mp b gy mt mu l mv mw"><em class="na">// src/app/app.component.html</em></span><span id="6941" class="ky kz in mp b gy nb mu l mv mw">&lt;nav class="navbar navbar-light bg-light"&gt;<br/>  &lt;div class="container"&gt;<br/>    &lt;a class="navbar-brand"&gt;MyApp&lt;/a&gt;<br/>    &lt;div class="d-flex align-items-center"&gt;<br/>      <strong class="mp io">&lt;p class="mb-0"&gt;{{userService.data.name}}&lt;/p&gt;<br/>      &lt;img src="{{userService.data.avatar}}"<br/>           class="ms-2 rounded-circle"<br/>           style="width: 60px"&gt;</strong><br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/nav&gt;<br/>&lt;main class="container py-4"&gt;<br/>  &lt;h1&gt;Dashboard&lt;/h1&gt;<br/>  &lt;p&gt;Dashboard content goes here...&lt;/p&gt;<br/>&lt;/main&gt;</span></pre><p id="e56b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æˆ‘å¼ºè°ƒäº†æ˜¾ç¤ºç”¨æˆ·å§“åå’Œä¸ªäººèµ„æ–™å›¾ç‰‡çš„é‡è¦éƒ¨åˆ†ã€‚</p><p id="61a3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ç°åœ¨æˆ‘ä»¬å·²ç»å¥ å®šäº†åŸºç¡€ï¼Œå‰©ä¸‹è¦åšçš„å°±æ˜¯å®ç°ä¸€ä¸ªè·å–å®é™…ç”¨æˆ·æ•°æ®çš„å‡½æ•°ï¼Œç„¶åçœ‹çœ‹æˆ‘ä»¬å°†åœ¨ä½•æ—¶ä½•åœ°è°ƒç”¨å®ƒã€‚</p><p id="e189" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æˆ‘ä¸æ‰“ç®—ä¸ºæ­¤ä½¿ç”¨å®é™…çš„åç«¯æœåŠ¡ï¼Œè€Œæ˜¯åœ¨æˆ‘ä»¬çš„assetsæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªJSONæ–‡ä»¶ï¼Œæˆ‘ä»¬å°†åœ¨è¿™é‡Œå¯¹æ•°æ®è¿›è¡Œç¡¬ç¼–ç :</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="9a61" class="ky kz in mp b gy mt mu l mv mw"><em class="na">// src/assets/user.json</em></span><span id="b2d8" class="ky kz in mp b gy nb mu l mv mw">{<br/>  "name": "Dragos Becsan",<br/>  "avatar": "assets/avatar.jpg" <em class="na">// grab another avatar image and put it in your assets folder - remove this comment</em><br/>}</span></pre><p id="5503" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æˆ‘ä»¬å°†å®šä¹‰è´Ÿè´£è·å–<code class="fe mx my mz mp b">UserService</code>ä¸­æ•°æ®çš„å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="18fd" class="ky kz in mp b gy mt mu l mv mw"><em class="na">// src/app/service/user.service.ts</em></span><span id="e6b6" class="ky kz in mp b gy nb mu l mv mw">import { <em class="na">Injectable</em><strong class="mp io"><em class="na"> </em></strong>} from '@angular/core';<br/><strong class="mp io">import { HttpClient } from '@angular/common/http';<br/>import { Observable } from 'rxjs';<br/>import { delay, tap } from 'rxjs/operators';</strong><br/><br/>@Injectable({<br/>  providedIn: 'root'<br/>})<br/>export class UserService {<br/>  private _data: IUserData = {<br/>    name: 'guest',<br/>    avatar: 'assets/no-avatar.png'<br/>  };<br/><br/>  <strong class="mp io">constructor(private http: HttpClient) {<br/>  }<br/><br/>  public loadData(): Observable&lt;IUserData&gt; {<br/>    return this.http.get&lt;IUserData&gt;('./assets/user.json')<br/>    .pipe(<br/>      delay(1000)</strong>, // to mimic an actual HTTP request sent to a backend service<br/><strong class="mp io">      tap((response: IUserData) =&gt; this._data = response)<br/>    );<br/>  }</strong><br/><br/>  get data(): IUserData {<br/>    return this._data;<br/>  }<br/>}<br/><br/>export interface IUserData {<br/>  name: string,<br/>  avatar: string<br/>}</span></pre><p id="1733" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ä¸è¦å¿˜è®°å¯¼å…¥<code class="fe mx my mz mp b">AppModule</code>ä¸­çš„<code class="fe mx my mz mp b">HttpClientModule</code>ã€‚</p><h2 id="d5d8" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated"><strong class="ak">å®ç°APP_INITIALIZER </strong></h2><p id="6fed" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">æ­£å¦‚æˆ‘ä»¬åœ¨å®šä¹‰éƒ¨åˆ†å­¦åˆ°çš„ï¼ŒAPP_INITIALIZERè®©æˆ‘ä»¬å®šä¹‰é¢å¤–çš„åˆå§‹åŒ–å‡½æ•°ï¼Œæ‰€ä»¥ç°åœ¨è®©æˆ‘ä»¬åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ªã€‚</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="9af3" class="ky kz in mp b gy mt mu l mv mw"><em class="na">// src/app/initializer/app.initializer.ts</em></span><span id="76c6" class="ky kz in mp b gy nb mu l mv mw">import { Observable } from 'rxjs';<br/>import { IUserData, UserService } from '../service/user.service';<br/><br/>export function initializeAppFactory(userService: UserService): () =&gt; Observable&lt;IUserData&gt; {<br/>  return () =&gt; userService.loadData()<br/>}</span></pre><blockquote class="nc nd ne"><p id="5bb2" class="ka kb na kc b kd ke kf kg kh ki kj kk nf km kn ko ng kq kr ks nh ku kv kw kx ig bi translated">æ‚¨å¯ä»¥éšæ„å‘½åæ–‡ä»¶å’Œå‡½æ•°ã€‚æˆ‘é€šå¸¸åšæŒä½¿ç”¨ä¸€ä¸ªæ›´é€šç”¨çš„åå­—ï¼Œå› ä¸ºæˆ‘é€šå¸¸ä½¿ç”¨ä¸€ä¸ª<code class="fe mx my mz mp b">forkJoin</code>åœ¨ä¸€ä¸ªå‡½æ•°ä¸­åŠ è½½æˆ‘éœ€è¦çš„æ‰€æœ‰ä¸œè¥¿ã€‚å¦‚æœä½ å–œæ¬¢ç”¨ä¸åŒçš„æ–¹å¼ï¼Œä½ å¯ä»¥ï¼Œä¾‹å¦‚ï¼Œå°†è¿™ä¸ªå‘½åä¸º<code class="fe mx my mz mp b">loadUserDataFactory</code>æˆ–ç±»ä¼¼çš„åå­—(å› ä¸ºè¿™æ˜¯å®ƒå”¯ä¸€åšçš„äº‹æƒ…)ï¼Œç„¶ååˆ›å»ºå•ç‹¬çš„å‡½æ•°æ¥åŠ è½½ä½ å¯èƒ½éœ€è¦çš„ä»»ä½•å…¶ä»–æ•°æ®ã€‚</p></blockquote><p id="f0c0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ç°åœ¨å”¯ä¸€è¦åšçš„å°±æ˜¯å°†è¿™ä¸ªå‡½æ•°æ ‡è®°ä¸ºAPP_INITIALIZERï¼Œè¿™æ ·Angularå°±çŸ¥é“åœ¨APPåˆå§‹åŒ–æœŸé—´æ‰§è¡Œå®ƒã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»¥ä¸‹æä¾›è€…æ·»åŠ åˆ°AppModuleä¸­çš„<strong class="kc io"> providers </strong>æ•°ç»„ä¸­:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="fdcc" class="ky kz in mp b gy mt mu l mv mw"><em class="na">// src/app/app.module.ts</em></span><span id="8f87" class="ky kz in mp b gy nb mu l mv mw">...</span><span id="0785" class="ky kz in mp b gy nb mu l mv mw">providers: [<br/>  {<br/>    provide: <strong class="mp io"><em class="na">APP_INITIALIZER</em></strong>,<br/>    useFactory: initializeAppFactory,<br/>    deps: [UserService],<br/>    multi: true<br/>  }<br/>],</span><span id="7640" class="ky kz in mp b gy nb mu l mv mw">...</span></pre><p id="7ac5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ä»…æ­¤è€Œå·²ã€‚å¦‚æœæ‚¨ç°åœ¨åˆ·æ–°é¡µé¢ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°å¤§çº¦1ç§’é’Ÿçš„ç©ºç™½é¡µé¢(å› ä¸ºæˆ‘ä»¬åœ¨è·å–JSONæ–‡ä»¶æ—¶å¢åŠ äº†å»¶è¿Ÿ)ï¼Œä¹‹åé¡µé¢å°†åŠ è½½å®é™…çš„ç”¨æˆ·åå’Œå¤´åƒ(åœ¨user.jsonæ–‡ä»¶ä¸­æŒ‡å®šçš„é‚£äº›),æ˜¾ç¤ºåœ¨å³ä¸Šè§’ã€‚</p><h2 id="0efc" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated"><strong class="ak">éœ€è¦è€ƒè™‘çš„äº‹æƒ…</strong></h2><ul class=""><li id="d0e2" class="lw lx in kc b kd lr kh ls kl ni kp nj kt nk kx mb mc md me bi translated">å¯èƒ½éœ€è¦æ³¨æ„çš„æœ€é‡è¦çš„äº‹æƒ…æ˜¯ï¼Œå¦‚æœä»ä»»ä½•åˆå§‹åŒ–å‡½æ•°è¿”å›çš„å¯è§‚å¯Ÿå€¼å‡ºé”™ï¼Œåº”ç”¨ç¨‹åºå°†ä¸å†è¢«åˆå§‹åŒ–ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡é‡å‘½åæˆ–ä¸´æ—¶åˆ é™¤<code class="fe mx my mz mp b">user.json</code>æ–‡ä»¶æ¥çœ‹åˆ°è¿™ä¸€ç‚¹ï¼Œè¿™å°†å¯¼è‡´Observableå¤±è´¥å¹¶å‡ºç°404é”™è¯¯ã€‚å› æ­¤ï¼Œä½ å°†åœç•™åœ¨æœ€åˆçš„ç©ºç™½é¡µä¸Šã€‚<br/>ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œè¯·å§‹ç»ˆç¡®ä¿ä½¿ç”¨<code class="fe mx my mz mp b">catchError</code>æ“ä½œç¬¦æ•è·ä»»ä½•æ½œåœ¨çš„é”™è¯¯ï¼Œå¹¶ä¸ºæ‚¨çš„æ•°æ®æä¾›é»˜è®¤å€¼æˆ–å°†ç”¨æˆ·é‡å®šå‘åˆ°ç‰¹å®šçš„é”™è¯¯é¡µé¢ï¼Œåœ¨é‚£é‡Œæ‚¨å¯ä»¥ä¸ºä»–ä»¬æä¾›å‡ºé”™çš„è¯¦ç»†ä¿¡æ¯ä»¥åŠå¦‚ä½•ç»§ç»­å‰è¿›ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œé‡å®šå‘åˆ°ä¸€ä¸ªé”™è¯¯é¡µé¢å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·â€” <em class="na">å¦‚æœæ‚¨æƒ³å°è¯•ä¸€ä¸‹ï¼Œä¸è¦å¿˜è®°æ·»åŠ </em> <code class="fe mx my mz mp b"><em class="na">Router</em></code> <em class="na">ä½œä¸ºä¾èµ–é¡¹ï¼Œæ–¹æ³•æ˜¯åœ¨AppModuleä¸­æ›´æ–°æä¾›è€…çš„</em> <code class="fe mx my mz mp b"><em class="na">deps</em></code> <em class="na">é”®ï¼Œå¹¶åˆ›å»ºæ–°é¡µé¢åŠå…¶è·¯ç”±</em>:</li></ul><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="a48e" class="ky kz in mp b gy mt mu l mv mw"><em class="na">// src/app/initializer/app.initializer.ts</em></span><span id="4b8a" class="ky kz in mp b gy nb mu l mv mw">import { from, Observable } from 'rxjs';<br/>import { UserService } from '../service/user.service';<br/>import { catchError } from 'rxjs/operators';<br/>import { Router } from '@angular/router';<br/><br/>export function initializeAppFactory(userService: UserService, router: Router): () =&gt; Observable&lt;any&gt; {<br/>  return () =&gt; userService.loadData().pipe(<br/>    catchError(() =&gt; from(router.navigate(['/error'])))<br/>  );<br/>}</span></pre><ul class=""><li id="7ef5" class="lw lx in kc b kd ke kh ki kl ly kp lz kt ma kx mb mc md me bi translated">ä½ çœ‹åˆ°çš„1ç§’é’Ÿçš„ç©ºç™½é¡µå®é™…ä¸Šæ˜¯<code class="fe mx my mz mp b">index.html</code>ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µçš„åŸå› æ˜¯ï¼Œç”±äºåº”ç”¨ç¨‹åºç›´åˆ°å¯è§‚å¯Ÿçš„å®Œæˆæ‰è¢«åˆå§‹åŒ–ï¼Œæ‰€ä»¥<code class="fe mx my mz mp b">&lt;app-root&gt;</code>å…ƒç´ æ²¡æœ‰è¢«å¡«å……ï¼Œæ‰€ä»¥ä½ çœ‹ä¸åˆ°ä»»ä½•ä¸œè¥¿ã€‚æˆ‘é€šå¸¸åšçš„æ˜¯æ·»åŠ ä¸€ä¸ªåŠ è½½å›¾åƒ/æ–‡æœ¬ä½œä¸º<code class="fe mx my mz mp b">&lt;app-root&gt;</code>å…ƒç´ çš„å­å…ƒç´ ã€‚å½“åº”ç”¨ç¨‹åºå®Œæˆåˆå§‹åŒ–æ—¶ï¼Œæ‚¨æ”¾åœ¨<code class="fe mx my mz mp b">&lt;app-root&gt;</code>ä¸­çš„ä»»ä½•å†…å®¹éƒ½å°†è¢«è¦†ç›–ã€‚ä¸‹é¢æˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥è¯•è¯•ã€‚å¦‚æœä½ æƒ³è¯•éªŒä¸€ä¸‹ï¼Œå¯ä»¥è€ƒè™‘åœ¨initializeAppFactoryå‡½æ•°ä¸­å¢åŠ å¯è§‚å¯Ÿå¯¹è±¡çš„å»¶è¿Ÿã€‚</li></ul><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="4a5e" class="ky kz in mp b gy mt mu l mv mw"><em class="na">// src/index.html</em></span><span id="a762" class="ky kz in mp b gy nb mu l mv mw">...</span><span id="73de" class="ky kz in mp b gy nb mu l mv mw">&lt;app-root&gt;<br/>  &lt;div class="vh-100 d-flex align-items-center justify-content-center"&gt;<br/>    &lt;p class="h2"&gt;Loading...&lt;/p&gt;<br/>  &lt;/div&gt;<br/>&lt;/app-root&gt;</span><span id="3d83" class="ky kz in mp b gy nb mu l mv mw">...</span></pre><ul class=""><li id="f095" class="lw lx in kc b kd ke kh ki kl ly kp lz kt ma kx mb mc md me bi translated">ä¹ æƒ¯ä½¿ç”¨RxJS(é™¤éä½ ä½¿ç”¨æ‰¿è¯º),å› ä¸ºä½ ç»å¸¸éœ€è¦ä½¿ç”¨ä¸€å †RxJSå‡½æ•°å’Œæ“ä½œç¬¦æ¥è·å¾—æ­£ç¡®çš„ç»“æœã€‚<code class="fe mx my mz mp b">forkJoin</code>ã€<code class="fe mx my mz mp b">iif</code>ã€<code class="fe mx my mz mp b">switchMap</code>ã€<code class="fe mx my mz mp b">map</code>ã€<code class="fe mx my mz mp b">catchError</code>ã€<code class="fe mx my mz mp b">tap</code>æ˜¯æˆ‘åœ¨è¿™ç§æƒ…å†µä¸‹ç»å¸¸ä½¿ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªè€ƒè™‘äº†ç”¨æˆ·ç™»å½•çš„æƒ…å†µï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·å®é™…ä¸Šæ˜¯ä¸€ä¸ªå®¢äººå‘¢ï¼Ÿåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›åšæŒä½¿ç”¨æˆ‘ä»¬å®šä¹‰çš„é»˜è®¤æ•°æ®ã€‚åœ¨å•ä¸ªæµä¸­å®ç°è¿™ä¸€ç‚¹çš„ä¸€ç§æ–¹æ³•ç±»ä¼¼äºè¿™æ ·â€” <em class="na">è¯·è®°ä½ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå®ƒåœ¨å½“å‰é¡¹ç›®ä¸­ä¸ä¼šå¼€ç®±å³ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰ä¸€èµ·å®šä¹‰ä»»ä½•</em><code class="fe mx my mz mp b"><em class="na">authService</em></code><em class="na"/>:</li></ul><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="45b1" class="ky kz in mp b gy mt mu l mv mw"><em class="na">// src/app/service/user.service.ts</em></span><span id="7c1e" class="ky kz in mp b gy nb mu l mv mw">...</span><span id="952e" class="ky kz in mp b gy nb mu l mv mw">public loadData(): Observable&lt;IUserData&gt; {<br/>  return iif(<br/>    () =&gt; this.authService.isLoggedIn,<br/>    this.http.get&lt;IUserData&gt;('./assets/user.json'),<br/>    of({name: 'guest', avatar: 'assets/no-avatar.png'})<br/>  ).pipe(<br/>    tap((output: IUserData) =&gt; this._data = output),<br/>  );<br/>}</span><span id="8756" class="ky kz in mp b gy nb mu l mv mw">...</span></pre><h2 id="ddca" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">èµ„æº:</h2><p id="8c2d" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated"><a class="ae jz" href="https://angular.io/api/core/APP_INITIALIZER" rel="noopener ugc nofollow" target="_blank">https://angular.io/api/core/APP_INITIALIZER</a>T17<a class="ae jz" href="https://www.learnrxjs.io/learn-rxjs/operators" rel="noopener ugc nofollow" target="_blank">https://www.learnrxjs.io/learn-rxjs/operators</a></p></div><div class="ab cl nl nm hr nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ig ih ii ij ik"><p id="c31e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">éå¸¸æ„Ÿè°¢ä½ ä¸€ç›´åšæŒåˆ°æœ€åï¼ğŸ‰</p><p id="c18f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">å¦‚æœä½ è§‰å¾—è¿™ä¸ªæ•™ç¨‹å¾ˆæœ‰ç”¨ï¼Œè¯·ç‚¹å‡»æ‹æ‰‹æŒ‰é’®ï¼Œè·Ÿæˆ‘æ¥è·å–æ›´å¤šç±»ä¼¼çš„å†…å®¹ã€‚</p><p id="3378" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">å¦‚æœæœ‰ä»»ä½•å»ºè®®ï¼Œç‰¹åˆ«æ˜¯ä½ å¸Œæœ›æˆ‘åœ¨æˆ‘çš„ç®€å†ä¸­åˆ—å‡ºçš„æŠ€æœ¯ï¼Œæˆ‘éƒ½æ„¿æ„æ¥å—ï¼Œæ‰€ä»¥å¦‚æœä½ æœ‰ä»»ä½•æ„è§ï¼Œè¯·éšæ—¶å‘è¡¨ã€‚</p></div><div class="ab cl nl nm hr nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ig ih ii ij ik"><p id="28af" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="na">æ›´å¤šå†…å®¹è¯·çœ‹</em><a class="ae jz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="na">plain English . io</em></strong></a><em class="na">ã€‚æŠ¥åå‚åŠ æˆ‘ä»¬çš„</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="na">å…è´¹å‘¨æŠ¥</em> </strong> </a> <em class="na">ã€‚å…³æ³¨æˆ‘ä»¬å…³äº</em><a class="ae jz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="na">Twitter</em></strong></a><a class="ae jz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="na">LinkedIn</em></strong></a><em class="na"/><a class="ae jz" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="na">YouTube</em></strong></a><em class="na"/><a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="na">ä¸å’Œ</em> </strong> </a> <em class="na">ã€‚</em></p></div></div>    
</body>
</html>