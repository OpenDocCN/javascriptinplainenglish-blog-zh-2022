<html>
<head>
<title>The Ultimate Guide to Loading JavaScript Scripts (defer, async)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">加载JavaScript脚本的终极指南(延迟、异步)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-ultimate-guide-to-loading-javascript-scripts-defer-async-dea871fa6774?source=collection_archive---------3-----------------------#2022-01-02">https://javascript.plainenglish.io/the-ultimate-guide-to-loading-javascript-scripts-defer-async-dea871fa6774?source=collection_archive---------3-----------------------#2022-01-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="bc7a" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">理解在HTML解析过程中遇到<script>标签时会发生什么&lt;/root&gt;</script></h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/18470283385aa4c68b1b238e9e1fece5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Qq6cx2D4Wvx-fm_l"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo By <a class="ae ks" href="https://www.instagram.com/lemike16/" rel="noopener ugc nofollow" target="_blank">Mike van den Bos</a></figcaption></figure><p id="39f2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">今天我们讨论在HTML文件中加载脚本。如果我们想在我们的网站上提供一个动态的和交互式的体验，我们需要使用JavaScript来实现。</p><p id="23d2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">与CSS文件不同，我们可以在head元素之外加载脚本。我们可以将它们加载到头部、正文中，甚至在正文的结束标记之后——这有时会产生意想不到的后果。</p><p id="d92f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了理解这一点，我们需要对浏览器如何向用户呈现和显示网站有一个大致的了解。</p><p id="8937" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最终，它从浏览器从web服务器接收HTML文件开始。这个HTML文件只是一种标记语言。它告诉浏览器应该显示的内容。</p><p id="75b1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后浏览器读取HTML文件并逐行解析它——这非常重要。当浏览器遇到一个<code class="fe lp lq lr ls b">&lt;script&gt;</code>元素时，它停止解析HTML文档。换句话说，它没有加载网页的其余部分。相反，它关注脚本，下载脚本，并执行脚本。脚本执行后，浏览器将继续解析HTML文档的其余部分。显然，如果涉及到多个脚本，那么这个过程将会重复。</p><p id="3d37" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这可能会有问题。如果您的脚本正在操作DOM——或者更改网站的可见组件——您希望确保那些被操作的组件已经被呈现。否则，该组件将不存在，您的脚本也不会按预期运行。</p><p id="8ffa" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了清楚起见，假设您的脚本<code class="fe lp lq lr ls b">changetitle.js</code>将h1元素更改为<code class="fe lp lq lr ls b">“Hello World”</code>。</p><pre class="kd ke kf kg gt lt ls lu lv aw lw bi"><span id="8c8a" class="lx ly in ls b gy lz ma l mb mc">&lt;h1&gt; This is a title &lt;/h1&gt;<br/>&lt;script src="changetitle.js&gt;&lt;/script&gt;</span></pre><p id="bf24" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这个非常普通的示例代码中，h1元素在脚本执行时已经存在。该脚本将按预期运行。</p><pre class="kd ke kf kg gt lt ls lu lv aw lw bi"><span id="f512" class="lx ly in ls b gy lz ma l mb mc">&lt;script src="changetitle.js&gt;&lt;/script&gt;<br/>&lt;h1&gt; This is a title &lt;/h1&gt;</span></pre><p id="a4c3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">相比之下，在这个示例代码中，脚本将执行并创建一个错误。h1元素尚不存在。如何改变一个尚不存在的元素的文本？<em class="md">不能</em>。</p><p id="87b6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因此，如果您的脚本操作DOM，请确保在呈现所有被操作的组件之后加载您的脚本。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi me"><img src="../Images/b6ab057f4c5319a36e4c91171b45273e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-qRBbW4vnWC4ctTjwwkkXA.png"/></div></div></figure><p id="0cbd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您关注项目教程，您可能会经常发现开发人员在主体的结束标记之后(如图所示)甚至在主体的结束标记之前导入他们的脚本。这确保了在您的脚本开始播放之前，整个web页面都已呈现。</p><p id="031e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你的脚本在幕后工作，你可以把它们放在样式表旁边的head元素中。如果你有任何错误，就像上面显示的那样把它带下来。</p><p id="e6c5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这就是脚本导入的基本过程。现在让我们深入一点。HTML为脚本标签提供了两个非常有用的属性:<code class="fe lp lq lr ls b">async</code>和<code class="fe lp lq lr ls b">defer</code>。</p><h1 id="f6d4" class="mf ly in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">推迟</h1><p id="d202" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated">前面提到过，浏览器遇到脚本时，会暂停HTML解析，专注于脚本。首先，浏览器将下载脚本。然后浏览器会执行这个脚本。你可以把它想成一个两部分的过程。脚本执行后，HTML解析将继续。</p><p id="a9c1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">使用defer属性，当浏览器遇到脚本元素时，它将继续解析HTML文档，同时下载脚本。只有在解析了整个HTML文档之后，才会执行脚本。</p><p id="eea5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这意味着该脚本可能操作的所有DOM组件都将及时呈现。不会出现错误，因为脚本是在整个DOM渲染完毕后执行的。</p><p id="3bf8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您可能会想:这与上面的示例代码有什么不同？这与紧接在<code class="fe lp lq lr ls b">&lt;/body&gt;</code>之前或之后加载脚本有何不同。</p><p id="26d6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因为下载的原因不一样。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi me"><img src="../Images/b6ab057f4c5319a36e4c91171b45273e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-qRBbW4vnWC4ctTjwwkkXA.png"/></div></div></figure><p id="a206" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在本例中，在<code class="fe lp lq lr ls b">&lt;/body&gt;</code>之后，浏览器将需要时间来下载脚本和额外的时间来执行脚本。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nb"><img src="../Images/8cce3269a2bdc25ad948b35ca62058b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sZHV1K95FbRDPjf-3N8FGA.png"/></div></div></figure><p id="980a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在本例中，浏览器一遇到脚本就会立即下载。使用defer标记，浏览器可以在脚本下载时继续解析文档的其余部分。</p><p id="15cd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">与前面的示例代码类似，这个脚本将在整个DOM呈现后执行。但是，与前面的示例代码不同，脚本已经被加载了。脚本只需要执行。这确实节省了时间，因为脚本的下载与HTML解析是并行进行的。浏览器本质上是多任务的。</p><p id="22e6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你不相信的话，<a class="ae ks" href="https://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html" rel="noopener ugc nofollow" target="_blank">《与网络一起成长》</a>提供了华丽的图片来帮助你理解这一点。</p><p id="a82d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">同样，因为值得一提，这些脚本标签可以放在HTML标签中的任何地方。</p><h1 id="75c2" class="mf ly in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">异步ˌ非同步(asynchronous)</h1><p id="9d30" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated"><code class="fe lp lq lr ls b">async</code>是另一个非常有用的属性。</p><p id="d631" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">与defer属性类似，当浏览器遇到脚本标签时，HTML解析不会暂停。当浏览器解析HTML文档的其余部分时，脚本将被同时下载。</p><p id="8765" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">与defer属性不同，脚本的执行不会保存到最后。相反，一旦脚本被下载，脚本就会被执行。这类似于加载没有任何属性的脚本。唯一的主要好处是在HTML解析的同时下载脚本。它节省时间。</p><p id="5f50" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">正如在本文中反复提到的，您希望确保脚本可能执行的任何DOM操作只影响已经呈现的DOM组件。</p><p id="777f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">再一次，<a class="ae ks" href="https://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html" rel="noopener ugc nofollow" target="_blank">与网络一起成长</a>提供了华丽的图表来帮助你理解这一点。</p><p id="83db" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在你知道了。感谢您的阅读。</p><p id="8d21" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="md">更多内容看</em> <a class="ae ks" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="md">说白了. io </em> </strong> </a> <strong class="kv io"> <em class="md">。</em> </strong> <em class="md">报名参加我们的</em><strong class="kv io"><em class="md"/></strong><a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="md">免费每周简讯</em> </strong> </a> <strong class="kv io"> <em class="md">。</em> </strong> <em class="md">在我们的</em><strong class="kv io"><em class="md"/></strong><a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="md">社区不和谐</em> </strong> </a> <strong class="kv io"> <em class="md">中获得独家写作机会和建议。</em>T45】</strong></p></div></div>    
</body>
</html>