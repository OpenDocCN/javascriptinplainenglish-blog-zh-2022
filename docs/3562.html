<html>
<head>
<title>How to Implement a Perfect Function.prototype.bind()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何实现一个完美的Function.prototype.bind()</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-implement-a-perfect-function-prototype-bind-56519ebd0e74?source=collection_archive---------12-----------------------#2022-09-07">https://javascript.plainenglish.io/how-to-implement-a-perfect-function-prototype-bind-56519ebd0e74?source=collection_archive---------12-----------------------#2022-09-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5e47" class="pw-subtitle-paragraph jr ip iq bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">通过制作更好的多孔填料来学习</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/3c799799eb329fbc382d9ee6a97a4ca1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l0yQV_mWb29FsbVz"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">Photo by <a class="ae kz" href="https://unsplash.com/@opollophotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Geometric Photography</a> on <a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="aaf6" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在JavaScript中，<code class="fe jn jo jp jq b">Function.prototype.bind()</code>将创建一个绑定到<code class="fe jn jo jp jq b">this</code>的新函数。我们可以在创建和调用新函数时传递参数。参数序列保持不变。</p><p id="8683" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">下面是一个例子:</p><pre class="kk kl km kn gt lw jq lx ly aw lz bi"><span id="abdd" class="ma mb iq jq b gy mc md l me mf">const test = {<br/>  x: 42,<br/>  getX: function () {<br/>    return this.x;<br/>  },<br/>};</span><span id="9e92" class="ma mb iq jq b gy mg md l me mf">const unboundGetX = test.getX;<br/>// The function gets invoked at the global scope<br/>console.log(unboundGetX()); // undefined</span><span id="f26e" class="ma mb iq jq b gy mg md l me mf">const boundGetX = unboundGetX.bind(test);<br/>console.log(boundGetX()); // 42</span></pre><p id="9c20" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">由于不是在严格模式下，默认情况下<code class="fe jn jo jp jq b">this</code>被替换为<code class="fe jn jo jp jq b"><a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis" rel="noopener ugc nofollow" target="_blank">globalThis</a></code>。一旦启用严格模式，<code class="fe jn jo jp jq b">this</code>将指向<code class="fe jn jo jp jq b">null</code>或<code class="fe jn jo jp jq b">undefined</code>。</p><pre class="kk kl km kn gt lw jq lx ly aw lz bi"><span id="11e8" class="ma mb iq jq b gy mc md l me mf">'use strict';</span><span id="a3df" class="ma mb iq jq b gy mg md l me mf">const test = {<br/>  x: 42,<br/>  getX: function () {<br/>    return this.x;<br/>  },<br/>};</span><span id="e59c" class="ma mb iq jq b gy mg md l me mf">const unboundGetX = test.getX;<br/>// TypeError: Cannot read properties of undefined (reading 'x')<br/>console.log(unboundGetX());</span></pre><p id="4d7e" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">除了这些，<code class="fe jn jo jp jq b">bind</code>返回的新函数也可以作为构造函数实例化一个新对象。</p><p id="39e4" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">然后将这些特征结合起来，形成一个相对完整的聚合填充:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="51e9" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">来分析一下，首先我们得到原函数的<code class="fe jn jo jp jq b">this</code>和<code class="fe jn jo jp jq b">prototype</code>，返回一个<code class="fe jn jo jp jq b">boundFunction</code>。</p><p id="ad78" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">这个<code class="fe jn jo jp jq b">boundFunction</code>就是重点。先看它的功能体。我们用<code class="fe jn jo jp jq b">Function.prototype.apply()</code>的方法来改变调用函数的<code class="fe jn jo jp jq b">this</code>，其实就是原函数的<code class="fe jn jo jp jq b">this</code>。</p><p id="695f" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们用<code class="fe jn jo jp jq b">this instanceof boundFunction ? this : that</code>作为<code class="fe jn jo jp jq b">apply</code>指向的<code class="fe jn jo jp jq b">this</code>，是为了确定<code class="fe jn jo jp jq b">new</code>当前是否被使用，如果被使用，<code class="fe jn jo jp jq b">this instanceof boundFunction</code>将返回<code class="fe jn jo jp jq b">true</code>。</p><p id="2692" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">还要注意，我们通过检查它的<code class="fe jn jo jp jq b">prototype</code>是否是一个对象来确定原始函数是否可以作为一个<code class="fe jn jo jp jq b">constructor</code>使用。如果是，将返回函数的原型指向由<code class="fe jn jo jp jq b">Object.create(Prototype)</code>创建的新对象。这样做的原因是为了不丢失<code class="fe jn jo jp jq b">new</code>上的原始函数原型的属性。</p><p id="efdd" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">到目前为止，我们编写的polyfill已经完成。比较完整，<a class="ae kz" href="https://tc39.es/ecma262/#sec-function.prototype.bind" rel="noopener ugc nofollow" target="_blank">规范</a>中还有一些复杂的细节没有实现，但是达到了它的教学目的。</p><p id="7884" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">希望这有所帮助，感谢阅读！</p><p id="81e5" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><em class="mj">不是中等会员？</em> <a class="ae kz" href="https://medium.com/@hibrandonevans/membership" rel="noopener"> <em class="mj">支持我这里</em> </a> <em class="mj">合二为一。</em></p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="5ad9" class="pw-post-body-paragraph la lb iq lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><em class="mj">更多内容看</em> <a class="ae kz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lc ir"> <em class="mj">说白了。报名参加我们的</em> <a class="ae kz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lc ir"> <em class="mj">免费周报</em> </strong> </a> <em class="mj">。关注我们关于</em> <a class="ae kz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="lc ir"> <em class="mj">推特</em> </strong> </a>，<a class="ae kz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="lc ir"><em class="mj">LinkedIn</em></strong></a><em class="mj">，</em><a class="ae kz" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="lc ir"><em class="mj">YouTube</em></strong></a><em class="mj">，以及</em> <a class="ae kz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="lc ir"> <em class="mj">不和</em> </strong> </a> <em class="mj">。</em></strong></a></p></div></div>    
</body>
</html>