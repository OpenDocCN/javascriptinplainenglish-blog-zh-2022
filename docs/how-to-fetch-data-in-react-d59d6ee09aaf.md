# å¦‚ä½•åœ¨ React ä¸­è·å–æ•°æ®

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/how-to-fetch-data-in-react-d59d6ee09aaf?source=collection_archive---------1----------------------->

## åœ¨ React ä¸­ä» API è·å–æ•°æ®çš„ 5 ç§æ–¹æ³•(é™„ç¤ºä¾‹)

![](img/f7d66a13726abdf32132ee65827bac71.png)

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºåœ¨ React ä¸­ä» API è·å–æ•°æ®çš„äº”ç§ä¸åŒæ–¹å¼:

1.  è·å– API
2.  å¼‚æ­¥ç­‰å¾…è¯­æ³•
3.  Axios åº“
4.  è‡ªå®šä¹‰æŒ‚é’©(ä½¿ç”¨ Fetch)
5.  React æŸ¥è¯¢åº“

åœ¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨éšæœºæ•°æ®ç”Ÿæˆå™¨ã€‚API ç«¯ç‚¹å¦‚ä¸‹:[https://random-data-api.com/api/food/random_food](https://random-data-api.com/api/food/random_food)ï¼Œå®ƒè¿”å›å…³äºä¸åŒé£Ÿç‰©çš„éšæœºæ•°æ®ğŸ˜‹ã€‚

# 1.è·å– API

**è·å– API** å¯èƒ½æ˜¯ React ä¸­è·å–æ•°æ®çš„æœ€åŸºæœ¬æ–¹å¼ã€‚
è¿™ä¸ªå·¥å…·å†…ç½®åœ¨å¤§å¤šæ•°ç°ä»£æµè§ˆå™¨çš„çª—å£å¯¹è±¡(window.fetch)ä¸Šï¼Œå…è®¸æˆ‘ä»¬ä½¿ç”¨`GET`ã€`POST`å’Œå…¶ä»–æ–¹æ³•å‘å‡º HTTP è¯·æ±‚ã€‚

è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåä¸º`getData()`çš„ç®­å¤´å‡½æ•°ï¼Œå®ƒä½¿ç”¨ fetch å‘å‡ºä¸€ä¸ªç®€å•çš„`GET`è¯·æ±‚ã€‚

```
const getData = () => {
 return fetch('[https://random-data-api.com/api/food/random_food](https://random-data-api.com/api/food/random_food)')
  .then((response) => response.json())
  .then((data) => console.log(data));
};
```

è¿™ä¸ªå‡½æ•°å°† URL ç«¯ç‚¹ä¼ é€’ç»™ fetch æ–¹æ³•ï¼Œç„¶åæ¥å—`Response`å¯¹è±¡ï¼Œå°†ç»“æœè½¬æ¢æˆ JSON å¯¹è±¡å¹¶æ‰“å°åˆ°æ§åˆ¶å°ã€‚

ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè®©æˆ‘ä»¬å°è¯•ä½¿ç”¨`fetch()`æ¥æ˜¾ç¤ºç»„ä»¶å†…éƒ¨çš„ä¸€äº›æ•°æ®:

Fetch API example

åœ¨è¿™ä¸ª`App`ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†å¯åŠ¨è¯·æ±‚å¹¶è¿”å›æ‰¿è¯ºçš„`fetchFood()`å‡½æ•°ã€‚å½“è¯·æ±‚å®Œæˆæ—¶ï¼Œç”¨`Response`å¯¹è±¡è§£ææ‰¿è¯ºã€‚å¦‚æœå“åº”æˆåŠŸï¼Œ(`response.ok`)ï¼Œæˆ‘ä»¬ä½¿ç”¨`json()`æ–¹æ³•å°†å“åº”è½¬æ¢æˆ JSON æ•°æ®ã€‚è¿™å°†è¿”å›ä¸€ä¸ªåŒ…å«æˆ‘ä»¬ä»éšæœºé£Ÿå“ API ä¸­è·å–çš„æ•°æ®çš„æ‰¿è¯ºã€‚åœ¨`then()`æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`setFood()`å°†é£Ÿç‰©çš„çŠ¶æ€è®¾ç½®ä¸ºæ–°æ•°æ®ã€‚

ä½†æ˜¯ï¼Œå¦‚æœè¯·æ±‚ç”±äºç½‘ç»œé—®é¢˜è€Œå¤±è´¥ï¼Œåˆ™æ‰¿è¯ºä¼šè¢«æ‹’ç»ã€‚
ä½¿ç”¨ fetchï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å¤„ç†é”™è¯¯ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠ›å‡º`response`ä½œä¸ºè¦ç”±`catch`å›è°ƒå¤„ç†çš„é”™è¯¯ï¼Œè¿™é‡Œæˆ‘ä»¬å°†çŠ¶æ€ä¸­â€œerrorâ€çš„å€¼è®¾ç½®ä¸ºæ‰¿è¯ºçš„é”™è¯¯å€¼ã€‚

å½“æ‰¿è¯ºå…‘ç°æ—¶ï¼Œæ— è®ºæˆåŠŸä¸å¦ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“å®ƒä¸å†è£…è½½ã€‚
æˆ‘ä»¬ä½¿ç”¨`.finally()`å›è°ƒå°†`loading`è®¾ç½®ä¸º falseï¼Œå› æ­¤æˆ‘ä»¬ä¸å†çœ‹åˆ°æˆ‘ä»¬çš„åŠ è½½æ–‡æœ¬ã€‚

å¦‚æœè¯·æ±‚æˆåŠŸï¼Œæˆ‘ä»¬å°†åœ¨é¡µé¢ä¸Šçœ‹åˆ°æ•°æ®ã€‚å¦åˆ™ï¼Œå°†æ˜¾ç¤ºå¸¦æœ‰é”™è¯¯çŠ¶æ€çš„â€œé”™è¯¯â€å­—æ ·ã€‚

ä¸ºäº†åœ¨æˆ‘ä»¬çš„ååº”ç»„ä»¶æŒ‚è½½åå‘å‡ºè¿™ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬åœ¨`useEffect()`ä¸­è°ƒç”¨`fetchFood()`å‡½æ•°ï¼Œå¹¶ç¡®ä¿æä¾›ä¸€ä¸ªç©ºçš„ä¾èµ–æ•°ç»„ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿™æ ·æˆ‘ä»¬çš„è¯·æ±‚åªå‘å‡ºä¸€æ¬¡ã€‚

ç‚¹å‡»â€œæ–°ç›˜â€æŒ‰é’®ï¼Œæˆ‘ä»¬å†æ¬¡è°ƒç”¨`fetchFood()`åŠŸèƒ½ï¼Œæå‡ºæ–°çš„è¯·æ±‚ï¼Œè·å–æ–°çš„æ•°æ®ã€‚

# 2.å¼‚æ­¥ç­‰å¾…è¯­æ³•

`async/await`è¯­æ³•éå¸¸é€‚åˆ`fetch()`ï¼Œå› ä¸ºå®ƒé€šè¿‡æ‰¿è¯ºç®€åŒ–äº†å·¥ä½œã€‚

ä¸»è¦çš„å¥½å¤„æ˜¯ï¼Œå®ƒå…è®¸æˆ‘ä»¬åˆ é™¤`then()`å›è°ƒï¼Œå¹¶ç®€å•åœ°å–å›å¼‚æ­¥è§£æçš„æ•°æ®ã€‚

äº‹å®ä¸Šï¼Œ`await`è¡¨è¾¾å¼é€šè¿‡æš‚åœæ‰§è¡Œç›´åˆ°è¿”å›çš„æ‰¿è¯ºè¢«å®ç°æˆ–æ‹’ç»ï¼Œä½¿å¾—æ‰¿è¯ºè¿”å›å‡½æ•°è¡¨ç°å¾—å¥½åƒå®ƒä»¬æ˜¯åŒæ­¥çš„ã€‚

å½“æˆ‘ä»¬æå‡ºè¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`fetch()`å‰é¢æ·»åŠ `await`ï¼Œç­‰å¾…æ‰¿è¯ºä¸ç»“æœè¾¾æˆä¸€è‡´ã€‚

è¦ä½¿ç”¨è¿™ä¸ªè¯­æ³•ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨`async`å†…éƒ¨è°ƒç”¨å®ƒï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»åœ¨`getchData()`å‡½æ•°å‰é¢æ·»åŠ `async` ã€‚

è®©æˆ‘ä»¬ç”¨è¿™ä¸ªæ–°è¯­æ³•é‡å†™æˆ‘ä»¬çš„`getData()`:

```
*async* function getData() {
 try { 
  const response = await fetch('[https://random-data-api.com/api/food/random_food](https://random-data-api.com/api/food/random_food)');
  if (!response.ok) {
   throw new Error(`HTTP error: ${response.status}`);
  }
  const data = await response.json();
  console.log(data);
 } catch (error) {
  console.error(`Something went wrong: ${error}`);
 }
}
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥å¯¹æˆ‘ä»¬çš„`App`ç»„ä»¶è¿›è¡ŒåŒæ ·çš„é‡æ„ã€‚

Async-await example

`fetchFood()`ç°åœ¨æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œå› ä¸ºå®ƒç”¨`async`å…³é”®å­—æ ‡è®°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ é™¤å›è°ƒï¼Œç®€å•åœ°å–å›å¼‚æ­¥è§£æçš„æ•°æ®ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨`useEffect`é’©å­æ—¶ï¼Œæ•ˆæœåŠŸèƒ½ä¸èƒ½è¢«`async`å®ç°ã€‚

# 3.Axios åº“

Axios æ˜¯ä¸€ä¸ªåŸºäºæ‰¿è¯ºçš„ Javascript åº“ï¼Œç”¨äºæ‰§è¡Œ HTTP è¯·æ±‚ã€‚å®ƒçš„å·¥ä½œæ–¹å¼ä¸ Fetch API éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯ä¸»è¦çš„å¥½å¤„æ˜¯å®ƒå·²ç»å°†ç»“æœä½œä¸º JSON å¯¹è±¡è¿”å›ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å¯¹å…¶è¿›è¡Œè½¬æ¢ã€‚

è¦ä½¿ç”¨è¿™ä¸ªåº“ï¼Œæˆ‘ä»¬å¿…é¡»ç”¨ npm å®‰è£…å®ƒ:

```
npm install axios
```

æˆ‘ä»¬ç°åœ¨å¯ä»¥å°†å…¶å¯¼å…¥åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œå¹¶åœ¨ç›¸åŒçš„å‡½æ•°`getData()`ä¸­ä½¿ç”¨ï¼Œè€Œä¸æ˜¯`fetch()`æ–¹æ³•:

```
import axios from "axios"const getData = () => {
 return axios.get('[https://random-data-api.com/api/food/random_food](https://random-data-api.com/api/food/random_food)')
  .then((response) => console.log(response.data));
};
```

ä½¿ç”¨ Axiosï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™æ›´å°‘çš„ä»£ç ï¼Œæ­¤å¤–ï¼Œè¿™ä¸ªåº“åŒ…å«äº†è®¸å¤šç®€å•çš„ Fetch æ‰€æ²¡æœ‰çš„å·¥å…·å’Œç‰¹æ€§ã€‚

è®©æˆ‘ä»¬ä¹Ÿä½¿ç”¨ Axios ä¿®æ”¹`App`ç»„ä»¶ã€‚

Axios example

ä¸`fetch()`æ–¹æ³•ç›¸æ¯”ï¼Œè¿™ç§æ–¹æ³•æ›´ç®€å•æ˜äº†ã€‚

# 4.è‡ªå®šä¹‰é’©å­(useFetch)

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¥è‡ª`react-fetch-hook`åº“çš„`useFetch`é’©å­æ¥è¿›ä¸€æ­¥ç®€åŒ–æ•°æ®è·å–ã€‚
è¿™å·²ç»åŒ…æ‹¬äº†æˆ‘ä»¬å¯ä»¥ç”¨æ¥å¤„ç†é”™è¯¯çš„å±æ€§ï¼Œæ¯”å¦‚`isLoading`å’Œ`error`ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»ç”¨ npm å®‰è£…åº“:

```
npm install react-fetch-hook
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒå¯¼å…¥åˆ°ç»„ä»¶ä¸­:

```
import useFetch from "react-fetch-hook";
```

Custom hooks (useFetch) example

ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†ç«¯ç‚¹ URL ä¼ é€’ç»™å¯¹è±¡çš„`useFetch`é’©å­å’Œææ„å‡½æ•°`data, isLoading, error`ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åœ¨æ¸²æŸ“ä¸­ä½¿ç”¨å®ƒä»¬ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨æœ¬åœ°çŠ¶æ€ä¸­å¤„ç†æ•°æ®ã€åŠ è½½å’Œé”™è¯¯ï¼Œè€Œæ˜¯ç›´æ¥ä»æˆ‘ä»¬çš„è¯·æ±‚ä¸­è·å–å®ƒä»¬ã€‚

# 5.ååº”æŸ¥è¯¢

æˆ‘æœ€å–œæ¬¢åœ¨ React ä¸­è·å–æ•°æ®çš„æ–¹å¼æ˜¯ä½¿ç”¨`react-query`åº“ã€‚å®ƒæ”¯æŒç¼“å­˜å’Œé‡æ–°æå–ï¼Œå¸®åŠ©å¼€å‘äººå‘˜æ”¹å–„æ•´ä½“ç”¨æˆ·ä½“éªŒï¼Œå¹¶ä½¿æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ›´å¿«ã€‚

è®©æˆ‘ä»¬å®‰è£…å®ƒ:

```
npm i react-query
```

é¦–å…ˆï¼Œåœ¨`index.js`æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»ç”¨ä»`react-query`å¯¼å…¥çš„`QueryClientProvider`åŒ…è£…æˆ‘ä»¬çš„`App`ç»„ä»¶ï¼Œå¹¶å°†å®¢æˆ·ç«¯å®ä¾‹ä¼ é€’ç»™å®ƒ:

```
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import { QueryClient, QueryClientProvider } from "react-query";
import { ReactQueryDevtools } from "react-query/devtools";
import App from "./App";*// Create a client* const queryClient = new QueryClient();const rootElement = document.getElementById("root");
const root = createRoot(rootElement);root.render(
  *// Provide the client to your App* <StrictMode>
    <QueryClientProvider client={queryClient}>
      <App />
      <ReactQueryDevtools initialIsOpen={false} /
    </QueryClientProvider>
  </StrictMode>
);
```

React Query æä¾›äº†ä¸€ä¸ªå®šåˆ¶çš„é’©å­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ä¹‹é—´é‡ç”¨å®ƒæ¥è·å–æ•°æ®ã€‚

å®ƒè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†`ReactQueyDevtools`ï¼Œä¸€ç§æ§åˆ¶ä½•æ—¶ã€å¦‚ä½•ä»¥åŠå¤šä¹…è·å–ä¸€æ¬¡æ•°æ®çš„å¥½æ–¹æ³•ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªåº“åœ¨æˆ‘ä»¬çš„`App`ç»„ä»¶ä¸­çš„è¿è¡Œæƒ…å†µã€‚

ä¸ºäº†è·å–æ•°æ®ï¼Œæˆ‘ä»¬ä»`react-query`è°ƒç”¨`useQuery`é’©å­ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªæƒŸä¸€çš„æŸ¥è¯¢é”®(åœ¨æœ¬ä¾‹ä¸­ä¸ºâ€œrandom-foodâ€)å’Œä¸€ä¸ªæŸ¥è¯¢ç”¨æ¥è·å–æ•°æ®çš„å‡½æ•°:

ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ææ„è¿”å›çš„å¯¹è±¡ï¼Œå¹¶åœ¨æ¸²æŸ“ä¸­ä½¿ç”¨æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯ã€‚

React Queryï¼Œé¦–å…ˆå°è¯•ä»å…¶ç¼“å­˜ä¸­æä¾›æˆ‘ä»¬çš„æ•°æ®ï¼Œç„¶åï¼Œå¦‚æœæˆ‘ä»¬çš„ API çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™åœ¨åå°æ›´æ–°æ•°æ®ä»¥æ˜¾ç¤ºå˜åŒ–ã€‚

äº‹å®ä¸Šï¼Œé€šè¿‡å¼•ç”¨æˆ‘ä»¬åœ¨é’©å­ä¸­ä¼ é€’çš„æŸ¥è¯¢é”®ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°æå–ã€éªŒè¯æˆ–é‡ç½®æŸ¥è¯¢ï¼Œå¦‚`refetchData`å‡½æ•°æ‰€ç¤º:

```
const refetchData = () => {
  queryClient.invalidateQueries("random-food");
};
```

React Query ç»å¸¸è¢«æè¿°ä¸º React ç¼ºå°‘çš„æ•°æ®è·å–åº“ï¼Œå› ä¸ºå®ƒä½¿ React åº”ç”¨ç¨‹åºä¸­çš„è·å–ã€ç¼“å­˜ã€åŒæ­¥å’Œæ›´æ–°æœåŠ¡å™¨çŠ¶æ€å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œè¯»åˆ°å®ƒæ‰€æœ‰çš„ä¼˜ç‚¹[ã€‚](https://tanstack.com/query/v4/docs/overview?from=reactQueryV3&original=https://react-query-v3.tanstack.com/overview)

## **ç»“è®º**

æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½æ•™ä¼šä½ ä¸€äº›ä¸œè¥¿ã€‚å¦‚æœä½ çŸ¥é“ä» API è·å–æ•°æ®çš„å…¶ä»–æ–¹æ³•ï¼Œè¯·åœ¨è¯„è®ºä¸­æ·»åŠ ï¼

*è€ƒè™‘* [***æˆä¸ºä¸­ç­‰æˆå‘˜***](https://ebelinggianmarco.medium.com/membership)**å¦‚æœä½ å–œæ¬¢çœ‹è¿™æ ·çš„æ•…äº‹ï¼Œå¹¶ä¸”æƒ³å¸®åŠ©æˆ‘è¿™ä¸ªä½œå®¶ã€‚æ¯æœˆ 5 ç¾å…ƒï¼Œä½ å¯ä»¥æ— é™åˆ¶åœ°è®¿é—®åª’ä½“å†…å®¹ã€‚å¦‚æœä½ é€šè¿‡* [***æˆ‘çš„é“¾æ¥æ³¨å†Œï¼Œæˆ‘ä¼šå¾—åˆ°ä¸€ç‚¹ä½£é‡‘ã€‚***](https://ebelinggianmarco.medium.com/membership)*

**æ›´å¤šå†…å®¹è¯·çœ‹* [***è¯´ç™½äº†å°±æ˜¯***](https://plainenglish.io/) *ã€‚æŠ¥åå‚åŠ æˆ‘ä»¬çš„* [***å…è´¹æ¯å‘¨ç®€è®¯***](http://newsletter.plainenglish.io/) *ã€‚å…³æ³¨æˆ‘ä»¬*[***Twitter***](https://twitter.com/inPlainEngHQ)*å’Œ*[***LinkedIn***](https://www.linkedin.com/company/inplainenglish/)*ã€‚æŸ¥çœ‹æˆ‘ä»¬çš„* [***ç¤¾åŒºä¸å’Œè°***](https://discord.gg/GtDtUAvyhW) *åŠ å…¥æˆ‘ä»¬çš„* [***äººæ‰é›†ä½“***](https://inplainenglish.pallet.com/talent/welcome) *ã€‚**