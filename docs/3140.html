<html>
<head>
<title>The Progress Dialog Doesn’t Hide if Loading Strings are Enclosed in Double Quotes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如果加载字符串用双引号括起来，进度对话框不会隐藏</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-progress-dialog-didnt-hide-if-loading-strings-enclosed-in-double-quotes-14b74ab4078d?source=collection_archive---------13-----------------------#2022-08-03">https://javascript.plainenglish.io/the-progress-dialog-didnt-hide-if-loading-strings-enclosed-in-double-quotes-14b74ab4078d?source=collection_archive---------13-----------------------#2022-08-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c60c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">这都是关于验证数据和显示错误。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/7f1384c5b56a6b266903e1dc767bfc4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4LN_weDyae02GJmNiChKNQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@mike_van_den_bos?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Mike van den Bos</a> on <a class="ae kv" href="https://unsplash.com/s/photos/loading?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1a78" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">嘿，你今天过得好吗？希望如此！</p><p id="ecd1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是“让我们切入正题”系列中的另一篇文章，我在这里告诉你关于解决GitHub上的ChesslaBlab问题的最重要的事情。</p><div class="ls lt gp gr lu lv"><a href="https://programarivm.medium.com/solving-issues-on-github-in-few-words-e63a115a3260" rel="noopener follow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">用几句话解决GitHub上的问题</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">让我们开门见山吧</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">programarivm.medium.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj kp lv"/></div></div></a></div><p id="cb9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">今天，使用JavaScript、React和Redux Toolkit的一些编程已经修复了下面的bug。</p><div class="ls lt gp gr lu lv"><a href="https://github.com/chesslablab/redux-chess/issues/316" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">如果加载用双引号括起来的FEN字符串，进度对话框不会隐藏</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">github.com</p></div></div><div class="me l"><div class="mk l mg mh mi me mj kp lv"/></div></div></a></div><p id="73dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如你在下面的GIF中看到的，当输入一个意外的输入值时，进度对话框没有隐藏，比如用双引号括起来的FEN字符串。相反，国际象棋服务器会用一个确认消息来响应:“服务器不能识别命令。您提供了有效的参数吗？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ml"><img src="../Images/3ec337fa364cb8c5486ba5636a56210f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*irTkWSnXqHEmqqTGgmLFLg.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk"><strong class="bd mm">Figure 1</strong>. Command not recognized by the server. Did you provide valid parameters?</figcaption></figure><p id="d43c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这都是关于验证和显示错误消息。</p><p id="3f29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应该帮助用户识别、诊断和从错误中恢复。根据Jakob Nielsen的<a class="ae kv" href="https://www.nngroup.com/articles/ten-usability-heuristics/" rel="noopener ugc nofollow" target="_blank">交互设计的一般原则</a>，每当像这样的错误由于错误的数据输入而发生时，应该用简单的英语显示用户友好的消息。</p><p id="c30c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但这也关乎安全。</p><p id="102d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们试着更好地理解<a class="ae kv" href="https://github.com/chesslablab/chess-server" rel="noopener ugc nofollow" target="_blank"> PHP象棋服务器</a>如何与客户端交互，请在本地运行服务器。</p><pre class="kg kh ki kj gt mn mo mp mq aw mr bi"><span id="d162" class="ms mt iq mo b gy mu mv l mw mx">$ php cli/ws-server.php <br/>Welcome to PHP Chess Server<br/>Commands available:<br/>/accept {"jwt":"&lt;string&gt;"} Accepts a request to play a game.<br/>/draw {"action":["accept","decline","propose"]} Allows to offer a draw.<br/>/heuristics Takes a balanced heuristic picture of the current game.<br/>/heuristics_bar {"fen":"&lt;string&gt;"} Takes an expanded heuristic picture of the current position.<br/>/leave {"action":["accept"]} Allows to leave a game.<br/>/legal_sqs {"position":"&lt;string&gt;"} Returns the legal squares of a piece.<br/>/online_games Returns the online games waiting to be accepted.<br/>/play_fen {"fen":"&lt;string&gt;"} Plays a chess move in shortened FEN format.<br/>/random_checkmate {"turn":"&lt;string&gt;","items":"&lt;string&gt;"} Starts a random checkmate position.<br/>/random_game Starts a random game.<br/>/rematch {"action":["accept","decline","propose"]} Allows to offer a rematch.<br/>/resign {"action":["accept"]} Allows to resign a game.<br/>/gm Returns a computer generated response to the current position.<br/>/restart {"hash":"&lt;string&gt;"} Restarts a game.<br/>/start {"mode":["analysis","gm","fen","pgn","play","stockfish"],"fen":"&lt;string&gt;","movetext":"&lt;string&gt;","color":["w","b"],"settings":"&lt;string&gt;"} Starts a new game.<br/>/stockfish {"options":{"Skill Level":"int"},"params":{"depth":"int"}} Returns Stockfish's response to the current position.<br/>/takeback {"action":["accept","decline","propose"]} Allows to manage a takeback.<br/>/undo Undoes the last move.</span><span id="66ee" class="ms mt iq mo b gy my mv l mw mx">Listening to commands...</span></pre><p id="83d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，打开一个<a class="ae kv" href="https://github.com/vi/websocat" rel="noopener ugc nofollow" target="_blank"> websocat </a>会话。</p><pre class="kg kh ki kj gt mn mo mp mq aw mr bi"><span id="66bc" class="ms mt iq mo b gy mu mv l mw mx">$ ./websocat ws://localhost:8080</span></pre><p id="27fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，如果提供了不存在的命令或错误的参数，服务器会响应一个<code class="fe mz na nb mo b">validate</code>响应。</p><pre class="kg kh ki kj gt mn mo mp mq aw mr bi"><span id="e490" class="ms mt iq mo b gy mu mv l mw mx">/start fen ""rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNR w KQkq e6""</span><span id="26ee" class="ms mt iq mo b gy my mv l mw mx">{"validate":"Command not recognized by the server. Did you provide valid parameters?"}</span></pre><p id="46ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，上面的命令类似于下面的命令，因为<code class="fe mz na nb mo b">/start_fen</code>提供了两个参数，而不是预期的一个。</p><pre class="kg kh ki kj gt mn mo mp mq aw mr bi"><span id="2895" class="ms mt iq mo b gy mu mv l mw mx">/start fen "foo" "bar"</span><span id="edc4" class="ms mt iq mo b gy my mv l mw mx">{"validate":"Command not recognized by the server. Did you provide valid parameters?"}</span></pre><p id="90e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">值得一提的是，如果输入一个包含无效FEN字符串的语法正确的命令，服务器将做出不同的响应，如下例所示。</p><pre class="kg kh ki kj gt mn mo mp mq aw mr bi"><span id="f62b" class="ms mt iq mo b gy mu mv l mw mx">/start fen "foo"</span><span id="b1bd" class="ms mt iq mo b gy my mv l mw mx">{"\/start":{"mode":"fen","message":"This FEN string could not be loaded."}}</span></pre><p id="f418" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果对FEN字符串中的双引号进行转义，客户端将得到完全相同的响应。</p><pre class="kg kh ki kj gt mn mo mp mq aw mr bi"><span id="f189" class="ms mt iq mo b gy mu mv l mw mx">/start fen "\"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNR w KQkq e6\""</span><span id="86d7" class="ms mt iq mo b gy my mv l mw mx">{"\/start":{"mode":"fen","message":"This FEN string could not be loaded."}}</span></pre><p id="f1cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">问题是，这两种是不同类型的错误消息。前者由无效命令触发，而后者由无效FEN字符串触发。尽管如此，验证逻辑已经在服务器端实现了。</p><p id="27a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到目前为止，React应用程序还没有识别出<code class="fe mz na nb mo b">validate</code>响应——那些服务器在收到语法错误的命令时发送的响应。因此，如果你检查关闭这个问题的公关，你会发现它归结为在<code class="fe mz na nb mo b">WsEvent.js</code>实施<code class="fe mz na nb mo b">onValidate()</code>事件。</p><div class="ls lt gp gr lu lv"><a href="https://github.com/chesslablab/redux-chess/pull/325" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">问题/316如果加载用双引号括起来的fen字符串，进度对话框不会隐藏…</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">将此建议添加到可以作为单次提交应用的批处理中。此建议无效，因为没有更改…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">github.com</p></div></div><div class="me l"><div class="nc l mg mh mi me mj kp lv"/></div></div></a></div><p id="1ea1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，React Redux应用程序引入了一个名为<code class="fe mz na nb mo b">MODE_UNDEFINED</code>的新游戏模式，每当出现意外原因时，它都会切换到该模式。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ml"><img src="../Images/d8fa7e60769467c23e446d97ce23084a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*OoDSDdgNeiSVA8Ubs0Nr1g.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk"><strong class="bd mm">Figure 2</strong>. Whoops! Something went wrong, please try again with different data.</figcaption></figure><p id="ea1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有人可能会说，最好使用JavaScript对双引号进行转义，这样用户就会看到“这个FEN字符串无法加载”而不是“呜呜！出现错误，请使用不同的数据重试。但至少React Redux应用程序现在可以识别<code class="fe mz na nb mo b">validate</code>事件了。</p><p id="d7cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nd">更多内容看</em> <a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nd">说白了就是io </em> </strong> </a> <em class="nd">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nd">免费周报</em> </strong> </a> <em class="nd">。关注我们上</em> <a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nd">推特</em></strong></a><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="nd">领英</em></strong></a><strong class="ky ir"><em class="nd"/></strong><em class="nd">和</em> <a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nd">不和谐</em> </strong> </a> <strong class="ky ir"> <em class="nd">。</em>T50】</strong></p></div></div>    
</body>
</html>