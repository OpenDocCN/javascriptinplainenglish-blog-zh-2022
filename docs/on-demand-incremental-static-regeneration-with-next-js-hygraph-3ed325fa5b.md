# ä½¿ç”¨ Next.js & Hygraph æŒ‰éœ€å¢é‡é™æ€å†ç”Ÿ

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/on-demand-incremental-static-regeneration-with-next-js-hygraph-3ed325fa5b?source=collection_archive---------3----------------------->

![](img/665a148dd72e0ead5344d06e0d5c57a1.png)

Photo by [AltumCode](https://unsplash.com/@altumcode?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

å¯¹äºæˆ‘çš„[ä¸ªäººç½‘ç«™](https://nextglabs.com)ï¼Œæˆ‘ä½¿ç”¨ [Hygraph](https://hygraph.com) (åˆå GraphCMS)ä½œä¸ºä¸€ä¸ªæ— å¤´ CMSã€‚æˆ‘ä½¿ç”¨æœåŠ¡å™¨ç«¯å‘ˆç°(SSR)æ¥è·å–å’Œç”Ÿæˆé™æ€é¡µé¢è·¯ç”±å’Œå†…å®¹ã€‚

Next.js å…è®¸æˆ‘ä»¬åœ¨æ„å»ºåº”ç”¨ç¨‹åºåæ›´æ–°é™æ€é¡µé¢ã€‚å¤šäºäº†å¢é‡é™æ€å†ç”Ÿ(ISR ),æˆ‘ä»¬å¯ä»¥åœ¨æ¯é¡µçš„åŸºç¡€ä¸Šä½¿ç”¨é™æ€ç”Ÿæˆ**,è€Œä¸éœ€è¦é‡å»ºæ•´ä¸ªç«™ç‚¹ï¼**

æœ‰äº† ISRï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ‰©å±•åˆ°æ•°ç™¾ä¸‡é¡µçš„åŒæ—¶è·å¾—é™æ€çš„å¥½å¤„ã€‚

ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä½¿ç”¨äº†`revalidate`é€‰é¡¹ï¼Œæ¯ 60 åˆ†é’Ÿé‡æ–°ç”Ÿæˆä¸€æ¬¡é™æ€é¡µé¢(ç¬¬ 22 è¡Œ)ã€‚

![](img/d6ee4ea0cad3fca9f299d00899faa15c.png)

ISR â€” Revalidate option for dynamic routes

æœ€è¿‘ï¼Œæˆ‘åœ¨ hygraph ä¸Šæ›´æ–°äº†æˆ‘çš„ç½‘ç«™çš„ä¸€äº›å†…å®¹ï¼Œå‘ç°å¦‚æœä¿¡æ¯éœ€è¦ç«‹å³æ›´æ–°ï¼Œæˆ‘çš„è®¿é—®è€…å°†ä¸å¾—ä¸ç­‰å¾…é•¿è¾¾ 60 åˆ†é’Ÿ(æœ€åçš„æƒ…å†µ)æ‰èƒ½çœ‹åˆ°æ›´æ–°çš„æ•°æ®ã€‚**å¤ªå¯æ€•äº†**ï¼

ä¸ºäº†ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä½¿ç”¨äº†**æŒ‰éœ€é™æ€é‡æ–°éªŒè¯ã€‚**è¿™æ„å‘³ç€*æ›´æ–°çš„*é™æ€é¡µé¢ä»…åœ¨ Hygraph ä¸Šçš„å†…å®¹æ›´æ–°æ—¶é‡æ–°ç”Ÿæˆã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚

# å¦‚ä½•è®¾ç½®æŒ‰éœ€é™æ€é‡æ–°éªŒè¯

## 1.åˆ›å»º ISR é‡æ–°éªŒè¯ API è·¯çº¿

Next.js ISR Revalidate API Route

ä½¿ç”¨æ‚¨é€‰æ‹©çš„ç§˜å¯†å°†ç§˜å¯†`REVALIDATE_TOKEN`æ·»åŠ åˆ°`.env`æ–‡ä»¶ä¸­æ˜¯éå¸¸å¿…è¦çš„ã€‚

> **âš ï¸é‡è¦æç¤º:**å¦‚æœä½ åœ¨ hygraph ä¸­ä½¿ç”¨çš„é”®ä¸æ˜¯`slug`ï¼Œä½ å¿…é¡»æ›´æ–°ç¬¬ 17 è¡Œçš„ä»£ç ã€‚

## 2.åˆ›å»ºä¸€ä¸ª Hygraph ç½‘é¡µæŒ‚é’©

æ¥ä¸‹æ¥ï¼Œæˆ‘éœ€è¦åœ¨ Hygraph ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„ webhookï¼Œå®ƒå°†åœ¨é¡µé¢é‡æ–°å‘å¸ƒ(å†…å®¹æ›´æ”¹)æ—¶è°ƒç”¨æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ API ç«¯ç‚¹ã€‚

ç™»å½•ä½ çš„ Hygraph å¸æˆ·ï¼Œç„¶åä»ä¾§è¾¹æ (å·¦ä¸‹æ–¹)é€‰æ‹© Webhooks æ ‡ç­¾ã€‚ç°åœ¨ç‚¹å‡»â€œåˆ›å»ºâ€æŒ‰é’®ã€‚

æŒ‰ç…§ä»¥ä¸‹æ–¹å¼è®¾ç½® webhookï¼Œç¡®ä¿æ ¹æ®æ‚¨çš„ç”¨ä¾‹é€‰æ‹©æ­£ç¡®çš„å†…å®¹æ¨¡å‹ã€‚å¯¹äºæˆ‘çš„ä¸ªäººç½‘ç«™ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯`Page`æ¨¡å¼ã€‚å½“`Published`é¡µé¢å‘å¸ƒæˆ–å–æ¶ˆå‘å¸ƒæ—¶ï¼Œè§¦å‘ webhookã€‚

å¿…é¡»å¯ç”¨`Include payload`é€‰é¡¹**æ¥å‘é€æˆ‘ä»¬æƒ³è¦é‡æ–°éªŒè¯çš„é¡µé¢`slug`ä»¥åŠè¯·æ±‚ã€‚ç„¶åï¼Œé‡æ–°éªŒè¯ç«¯ç‚¹å¤„ç†è¯·æ±‚æ­£æ–‡ã€‚**

**![](img/2599fc8144ca7e3d61b86bb51f922a06.png)**

**Next.js ISR â€” hygraph Webhook Setup**

> ****âš ï¸é‡è¦æç¤º:**ç¡®ä¿ç”¨ä½ çš„ç½‘ç«™åŸºæœ¬ URL æ›¿æ¢`YOUR_WEBSITE`ï¼Œç”¨ä½ åœ¨`.env`æ–‡ä»¶ä¸­å®šä¹‰çš„ç§˜å¯†ä»¤ç‰Œæ›¿æ¢`YOUR_SECRET`ã€‚**

## **3.ä» getStaticProps ä¸­åˆ é™¤é‡æ–°éªŒè¯é€‰é¡¹**

**åœ¨`pages/[slug].tsx`ä¸­ï¼Œä½ éœ€è¦ç§»é™¤`revalidate`é€‰é¡¹ï¼Œå¦‚æœä½ ä»¥å‰ç”¨è¿‡çš„è¯ã€‚å…¶å€¼é»˜è®¤ä¸º`false`ã€‚**

## **4.éƒ¨ç½²å’Œæµ‹è¯•**

**æ„å»ºå’Œéƒ¨ç½²åº”ç”¨ç¨‹åºã€‚æ‚¨è¿˜å¿…é¡»åœ¨æ‚¨çš„ä¸»æœºä¸Šè®¾ç½®`REVALIDATE_TOKEN` ç¯å¢ƒå˜é‡ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Vercelï¼Œè¯·æŸ¥çœ‹[ç¯å¢ƒå˜é‡](https://vercel.com/docs/concepts/projects/environment-variables)æ–‡æ¡£ã€‚**

**åœ¨ä½ çš„ä¸€ä¸ªé¡µé¢ä¸Šåšä¸€ä¸ªå¾®å°çš„å†…å®¹æ”¹å˜ã€‚é‡æ–°éªŒè¯åº”è¯¥å¼€å§‹ï¼Œé™æ€å†…å®¹ç«‹å³é‡æ–°ç”Ÿæˆï¼**

## **5.è§£å†³çº·äº‰**

**å¦‚æœæ‚¨é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ‚¨å¯ä»¥åœ¨ Hygraph ä¸­æ£€æŸ¥ webhook æ—¥å¿—ã€‚å“åº”åº”è¯¥æ˜¯å¸¦æœ‰`{ revalidated: true }`çš„`200`ã€‚**

**å¦‚æœæ²¡æœ‰ï¼Œæ‚¨å¯ä»¥è¿›ä¸€æ­¥è°ƒæŸ¥å¤±è´¥çš„ webhook äº‹ä»¶çš„åŸå› ã€‚**

**ä¸€äº›å¯èƒ½çš„åŸå› :URL ä¸æ­£ç¡®ï¼Œwebhook URL å’Œ/æˆ–ç¯å¢ƒå˜é‡ä¸­çš„æœºå¯†ä¸¢å¤±æˆ–ä¸æ­£ç¡®ã€‚**

**å¦‚æœæ‚¨ä»ç„¶ä¸èƒ½è§£å†³é—®é¢˜ï¼Œè¯·è”ç³»æˆ‘ã€‚æˆ‘å¾ˆä¹æ„å¸®å¿™ğŸ˜Š**

# **æºä»£ç **

**ä½ å¯ä»¥åœ¨è¿™ä¸ªåº“é‡Œæ‰¾åˆ°æˆ‘çš„ç½‘ç«™[çš„æºä»£ç ã€‚å¦‚æœä½ æƒ³æ”¯æŒæˆ‘ï¼Œä¸€å®šè¦æ‰“ç¢ğŸ‘ğŸ¼æŒ‰é’®ï¼Œå°½å¯èƒ½å¤šçš„æ¬¡æ•°ï¼Œå¹¶å¯åŠ¨â­ä»“åº“](https://github.com/nextglabs/nextglabs.com)**

****å¦‚æœä½ å–œæ¬¢é˜…è¯»åª’ä½“ä¸Šçš„ä¼˜è´¨å†…å®¹ï¼Œè¯·å…³æ³¨æˆ‘å¹¶è®¢é˜…ï¼Œä»¥ä¾¿åœ¨æˆ‘å‘å¸ƒæ—¶è‡ªåŠ¨æ¥æ”¶æˆ‘çš„æ•…äº‹ã€‚ç¼–ç å¿«ä¹ï¼** ğŸ¥³**

**[](/become-the-worst-software-engineer-ever-a-humorous-take-c4d9eb3fc492) [## æˆä¸ºæœ‰å²ä»¥æ¥æœ€å·®çš„è½¯ä»¶å·¥ç¨‹å¸ˆ:ä¸€ä¸ªå¹½é»˜çš„ç¬‘è¯

### ğŸ’¡è¿™ä¸ªæ•…äº‹åªæ˜¯ä¸ºäº†å¹½é»˜ã€‚æˆ‘ä»¬éƒ½éœ€è¦æ—¶ä¸æ—¶åœ°å¼€å¼€ç©ç¬‘ï¼Œæ‰¾ç‚¹ä¹å­ã€‚æ‰€ä»¥ä¸è¦â€¦

javascript.plainenglish.io](/become-the-worst-software-engineer-ever-a-humorous-take-c4d9eb3fc492) [](https://medium.com/next-generation-web/how-to-build-test-react-query-components-in-typescript-9527dc9924da) [## å¦‚ä½•åœ¨ Typescript ä¸­æ„å»ºå’Œæµ‹è¯•ååº”æŸ¥è¯¢ç»„ä»¶

### React-Query å¤ªç‰›äº†ï¼ä½†æ˜¯æµ‹è¯•ä½¿ç”¨å®ƒçš„ç»„ä»¶å¯èƒ½æœ‰ç‚¹æ£˜æ‰‹ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•æ— ç—›æµ‹è¯•â€¦

medium.com](https://medium.com/next-generation-web/how-to-build-test-react-query-components-in-typescript-9527dc9924da) [](/how-to-get-fired-as-a-software-engineer-fast-e99e6fe0d908) [## è½¯ä»¶å·¥ç¨‹å¸ˆå¦‚ä½•è¢«ç‚’ï¼Œå¿«ã€‚

### æˆ‘ä»¥è‡ªç”±èŒä¸šè€…çš„èº«ä»½ä¸ºä¸€å®¶ä¸­å‹å…¬å¸å·¥ä½œï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡é›‡ä½£æ–°çš„è½¯ä»¶å·¥ç¨‹å¸ˆæ¥æ‰©å¤§æˆ‘ä»¬çš„å›¢é˜Ÿã€‚ä½†æ˜¯â€¦

javascript.plainenglish.io](/how-to-get-fired-as-a-software-engineer-fast-e99e6fe0d908) 

*æ›´å¤šå†…å®¹è¯·çœ‹*[***plain English . io***](https://plainenglish.io/)*ã€‚æŠ¥åå‚åŠ æˆ‘ä»¬çš„* [***å…è´¹å‘¨æŠ¥***](http://newsletter.plainenglish.io/) *ã€‚å…³æ³¨æˆ‘ä»¬å…³äº*[***Twitter***](https://twitter.com/inPlainEngHQ)*å’Œ*[***LinkedIn***](https://www.linkedin.com/company/inplainenglish/)*ã€‚æŸ¥çœ‹æˆ‘ä»¬çš„* [***ç¤¾åŒºä¸å’Œè°***](https://discord.gg/GtDtUAvyhW) *åŠ å…¥æˆ‘ä»¬çš„* [***äººæ‰é›†ä½“***](https://inplainenglish.pallet.com/talent/welcome) *ã€‚***