<html>
<head>
<title>2 History Tips to Improve Page Experience</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">改善页面体验的两个历史技巧</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/two-tips-of-history-to-improve-page-experience-947223666f71?source=collection_archive---------10-----------------------#2022-06-30">https://javascript.plainenglish.io/two-tips-of-history-to-improve-page-experience-947223666f71?source=collection_archive---------10-----------------------#2022-06-30</a></blockquote><div><div class="fc ic id ie if ig"/><div class="ih ii ij ik il"><div class=""/><div class=""><h2 id="a31d" class="pw-subtitle-paragraph jl in io bd b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc dk translated">使用历史记录的scroll restore属性和pushState/replaceState的状态参数来恢复滚动位置。</h2></div><figure class="ke kf kg kh gu ki gi gj paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gi gj kd"><img src="../Images/cec3f262e57581bfa753546a3751b267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-_9RNlQ-cZW0ORje"/></div></div><figcaption class="kp kq gk gi gj kr ks bd b be z dk">Photo by <a class="ae kt" href="https://unsplash.com/@alxbcr?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Alex Bachor</a> on <a class="ae kt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="5448" class="ku kv io bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">前言</h2><p id="4263" class="pw-post-body-paragraph lq lr io ls b lt lu jp lv lw lx js ly ld lz ma mb lh mc md me ll mf mg mh mi ih bi translated">当我们使用chrome前往浏览器页面时，当我们返回时，页面无法恢复到原来的浏览位置，这让我们非常恼火。有时候chrome手动刷新页面后会自动恢复到之前的位置，这也是不尽如人意的。</p><h2 id="3e3d" class="ku kv io bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">刷新页面时滚动到页面顶部</h2><p id="d5c1" class="pw-post-body-paragraph lq lr io ls b lt lu jp lv lw lx js ly ld lz ma mb lh mc md me ll mf mg mh mi ih bi translated">在现代浏览器中，当我们刷新页面时，它会自动滚动到页面的上一个浏览位置。</p><figure class="ke kf kg kh gu ki gi gj paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gi gj mj"><img src="../Images/3dc2165e46b1a074c4b74f49a8212341.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*aNkxmV7UXUNH6E391E6hmQ.gif"/></div></div></figure><p id="c283" class="pw-post-body-paragraph lq lr io ls b lt mk jp lv lw ml js ly ld mm ma mb lh mn md me ll mo mg mh mi ih bi translated">在某些情况下，我们希望在不自动滚动的情况下刷新页面，例如表单页面、需要显示实时数据的列表页面等。</p><p id="55f8" class="pw-post-body-paragraph lq lr io ls b lt mk jp lv lw ml js ly ld mm ma mb lh mn md me ll mo mg mh mi ih bi translated">众所周知，我们可以用scrollTo API滚动到页面顶部:</p><pre class="ke kf kg kh gu mp mq mr ms aw mt bi"><span id="7189" class="ku kv io mq b gz mu mv l mw mx">window.scrollTo({top: 0})</span></pre><p id="50ad" class="pw-post-body-paragraph lq lr io ls b lt mk jp lv lw ml js ly ld mm ma mb lh mn md me ll mo mg mh mi ih bi translated">如果你不知道<a class="ae kt" href="https://developer.mozilla.org/en-US/docs/Web/API/History/scrollRestoration" rel="noopener ugc nofollow" target="_blank">history . scroll restore API</a>，这可能是实现滚动到页面顶部的一个实用方法。加载页面时，使用scrollTo API重置滚动位置。有时它可能不会像预期的那样工作，它可能会导致页面滚动两次。现在你可以试试这个:</p><pre class="ke kf kg kh gu mp mq mr ms aw mt bi"><span id="c29d" class="ku kv io mq b gz mu mv l mw mx"><a class="ae kt" href="https://developer.mozilla.org/en-US/docs/Web/API/History/scrollRestoration" rel="noopener ugc nofollow" target="_blank">history.scrollRestoration</a> = 'manual'; </span></pre><figure class="ke kf kg kh gu ki gi gj paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gi gj mj"><img src="../Images/6bab59f7d0f0938696c4598971bb144e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*cvcd8KTn2N02th8y4HuXtA.gif"/></div></div></figure><p id="6aa1" class="pw-post-body-paragraph lq lr io ls b lt mk jp lv lw ml js ly ld mm ma mb lh mn md me ll mo mg mh mi ih bi translated">有了这个API，你再也不用担心页面滚动的问题了。</p><h2 id="8ffb" class="ku kv io bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">恢复单页应用程序中的滚动位置</h2><p id="41f9" class="pw-post-body-paragraph lq lr io ls b lt lu jp lv lw lx js ly ld lz ma mb lh mc md me ll mf mg mh mi ih bi translated">单页应用让用户不用加载整页就可以使用网站，可能会有更好的体验。在单页应用程序中，异步加载页面数据会导致浏览器无法恢复到以前的位置。在某些情况下，部分元素滚动而不是整页滚动。我们必须自己处理滚动，不能依赖于浏览器的行为。</p><p id="7eb6" class="pw-post-body-paragraph lq lr io ls b lt mk jp lv lw ml js ly ld mm ma mb lh mn md me ll mo mg mh mi ih bi translated">有很多方法可以解决这个问题，比如使用localStorage，或者JavaScript全局变量。当然还有更便捷的方式，借助历史的国家属性。</p><p id="bee9" class="pw-post-body-paragraph lq lr io ls b lt mk jp lv lw ml js ly ld mm ma mb lh mn md me ll mo mg mh mi ih bi translated">当使用history.pushState/history.replaceState,时，它接受三个参数。</p><pre class="ke kf kg kh gu mp mq mr ms aw mt bi"><span id="f824" class="ku kv io mq b gz mu mv l mw mx">replaceState(stateObj, unused, url);<br/>pushState(state, unused, url);</span></pre><p id="b654" class="pw-post-body-paragraph lq lr io ls b lt mk jp lv lw ml js ly ld mm ma mb lh mn md me ll mo mg mh mi ih bi translated"><strong class="ls ip">状态</strong>参数是一个JavaScript对象，它与pushState或replaceState创建的新历史条目相关联。可以通过history.state来访问，所以我们可以在参数中存储页面滚动位置。</p><p id="b5d6" class="pw-post-body-paragraph lq lr io ls b lt mk jp lv lw ml js ly ld mm ma mb lh mn md me ll mo mg mh mi ih bi translated">离开页面时，存储位置:</p><pre class="ke kf kg kh gu mp mq mr ms aw mt bi"><span id="c098" class="ku kv io mq b gz mu mv l mw mx">// save the position<br/>const positionState = {<br/>  scrollX: window.scrollX, <br/>  scrollY: window.scrollY,<br/>}<br/>window.history.replaceState(Object.assign({}, window.history.state, positionState);<br/>// go to next page<br/>window.history.pushState({}, '', nextPageUrl);</span></pre><p id="2224" class="pw-post-body-paragraph lq lr io ls b lt mk jp lv lw ml js ly ld mm ma mb lh mn md me ll mo mg mh mi ih bi translated">加载页面数据后，恢复位置:</p><pre class="ke kf kg kh gu mp mq mr ms aw mt bi"><span id="760c" class="ku kv io mq b gz mu mv l mw mx">// when data loaded and rendered<br/>const positionState = window.history.state;<br/>window.scrollTo(positionState.scrollX, positionState.scrollY)</span></pre><p id="6a15" class="pw-post-body-paragraph lq lr io ls b lt mk jp lv lw ml js ly ld mm ma mb lh mn md me ll mo mg mh mi ih bi translated">与Javascript全局变量存储位置相比，这种方法的一个优点是当一个页面被重复访问时，可以正确地恢复滚动位置。比如从A页到B页，再转到A页，历史中会有三条记录，每条都有对应的状态。但是如果使用JavaScript全局变量，就很难区分页面a上的滚动位置记录。</p><h2 id="067b" class="ku kv io bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">结论</h2><p id="70be" class="pw-post-body-paragraph lq lr io ls b lt lu jp lv lw lx js ly ld lz ma mb lh mc md me ll mf mg mh mi ih bi translated">不同的web app页面可能存在不同的问题，但是合理使用history . scroll restore和history.state可以大大改善页面体验。您可以使用history . scroll restore关闭浏览器的默认还原行为，或者使用history.state自定义还原滚动位置的行为。</p><p id="b289" class="pw-post-body-paragraph lq lr io ls b lt mk jp lv lw ml js ly ld mm ma mb lh mn md me ll mo mg mh mi ih bi translated"><em class="my">更多内容请看</em><a class="ae kt" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ls ip"><em class="my">plain English . io</em></strong></a><em class="my">。报名参加我们的</em> <a class="ae kt" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ls ip"> <em class="my">免费周报</em> </strong> </a> <em class="my">。关注我们关于</em><a class="ae kt" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ls ip"><em class="my">Twitter</em></strong></a><em class="my">和</em><a class="ae kt" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ls ip"><em class="my">LinkedIn</em></strong></a><em class="my">。查看我们的</em> <a class="ae kt" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ls ip"> <em class="my">社区不和谐</em> </strong> </a> <em class="my">加入我们的</em> <a class="ae kt" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="ls ip"> <em class="my">人才集体</em> </strong> </a> <em class="my">。</em></p></div></div>    
</body>
</html>