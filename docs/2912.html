<html>
<head>
<title>How to Work With “Selection” &amp; “Cursor”</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用“选择”和“光标”</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-work-with-selection-cursor-175dfe7d8be6?source=collection_archive---------2-----------------------#2022-07-14">https://javascript.plainenglish.io/how-to-work-with-selection-cursor-175dfe7d8be6?source=collection_archive---------2-----------------------#2022-07-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="0496" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">关于“选择”和“光标”的教程</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0e573d04c387e94af9cd4c5dbec44c98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qu9wqZA9eKOYTLe_"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@patrickian4?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Patrick Fore</a> on <a class="ae ky" href="https://unsplash.com/s/photos/selection?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2544" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在web开发中，有时候我们会和“选择”和“光标”打交道。也许是关于突出显示文本，控制光标的位置，或者更高级的东西，如处理编辑器…我已经加入了一个项目，关于一个需要选择的编辑器。我将在本文中讨论它。</p><h1 id="1411" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">什么是“选择”和“光标”？</h1><p id="2c49" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">这里是“选择”——选择文本或元素。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mc"><img src="../Images/15d725f4d16e1cb415e5dd0fe77c8011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4CNCULniK6_bFpziHTRkuA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Selection</figcaption></figure><p id="4530" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">而“光标”是输入区中闪烁的垂直线(或水平线)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi md"><img src="../Images/7b287ae5a1f2032ade8d09598c09b77f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*bVIdXqKkE5-nc8EEg43ZBA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Cursor</figcaption></figure><p id="2a08" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但这只是从用户角度的定义，从开发者角度，我们有两个重要的对象不得不提:<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Selection" rel="noopener ugc nofollow" target="_blank">选择</a>和<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Range" rel="noopener ugc nofollow" target="_blank">范围</a>。这是两个具有许多属性和方法的对象。要了解更多信息，您可以查看官方文档。在这里，我为他们引用一段简短的介绍:</p><ol class=""><li id="bbf6" class="me mf in jm b jn jo jr js jv mg jz mh kd mi kh mj mk ml mm bi translated"><strong class="jm io"> "selection" </strong>对象代表用户选择的文本范围或插入符号的当前位置。它表示页面上的文本选择，可能跨越多个元素。通常由用户在文本上拖动鼠标生成。</li><li id="3659" class="me mf in jm b jn mn jr mo jv mp jz mq kd mr kh mj mk ml mm bi translated"><strong class="jm io"> Range </strong>对象表示包含节点和部分文本节点的文档片段。通过<code class="fe ms mt mu mv b">range</code>a对象获得的<code class="fe ms mt mu mv b">selection</code>对象是我们操作光标的焦点。</li></ol><p id="d790" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要获取对象<code class="fe ms mt mu mv b">selection</code>，我们可以使用window中的方法<code class="fe ms mt mu mv b">getSelection</code>。这里有一个例子:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="d111" class="na la in mv b gy nb nc l nd ne">window.getSelection();</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/761f7b180c481b0f6853b6b3268711ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*5vRrcGuCxE_avBiYz8A9rg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Object selection from window</figcaption></figure><p id="20d5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在实际情况中，我并不经常直接与对象<code class="fe ms mt mu mv b">selection</code>打交道。因为我经常使用用户选择的<code class="fe ms mt mu mv b">range</code>。为了得到这个<code class="fe ms mt mu mv b">range</code>,我们只需要调用一个简单的代码:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="8a62" class="na la in mv b gy nb nc l nd ne">const selection = window.getSelection();<br/>selection.getRangeAt(0);</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/4c05de3a3533d5c3ee412886de6b5087.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*mlOmEhmxpOfXQsIYYEYKdA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Object from range</figcaption></figure><p id="9093" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在上面的代码中，我们需要带数字的<code class="fe ms mt mu mv b">getRangeAt</code>,因为在一些浏览器(Firefox)中，用户可以选择多个文本。使用<code class="fe ms mt mu mv b">selection</code>和<code class="fe ms mt mu mv b">range</code>，我们将使用两个主要对象:普通输入(input，textarea)和可编辑元素。在下一部分，我会用它们做一些例子。</p><h1 id="3a24" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">普通输入(输入和文本区域)</h1><p id="9adb" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">在这一部分，我们将通过一些简单的例子来使用输入和文本区域。因为它们几乎是一样的，所以我将用textarea做例子。为了开始我们的示例，我们需要创建一个包含ID为的textarea的简短HTML。在我的代码中，我将id设置为“textbox”。事情就是这么简单:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="1668" class="na la in mv b gy nb nc l nd ne">&lt;textarea id="textbox"&gt;One Two Three&lt;/textarea&gt;</span></pre><p id="958b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在接下来的例子中，我将创建一些函数来运行它。你可以在控制台运行这个功能，或者把它绑定到按钮上……总之你喂得很好。</p><p id="9cb9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">选择一个范围</strong></p><p id="a933" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">第一个例子是一个简单的活动，选择一个文本。为了在输入中选择文本，我们有一个来自HMTLInputElement的方法<code class="fe ms mt mu mv b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/setSelectionRange" rel="noopener ugc nofollow" target="_blank">setSelectionRange</a></code>。如果要使用它，只需要用两个参数<code class="fe ms mt mu mv b">positionStart</code>和<code class="fe ms mt mu mv b">positionEnd</code>从HTMLInputElement调用它。根据输入字符的索引，在你想要选择的区域有起始位置和终止位置。下面是一个示例代码，其textarea的ID为“textbox”:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="1019" class="na la in mv b gy nb nc l nd ne">function selectText() {<br/>  const textbox = document.getElementById('textbox');<br/>  textbox.focus();<br/>  textbox.setSelectionRange(0, 3);<br/>}</span></pre><p id="9259" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面是我用这个函数得到的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/1f0954cbc8ae68a8597d9ee220bc792c.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*nSKkbnvKsmhFsbRoAfETNw.png"/></div></figure><p id="7382" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以看到前三个字符(一个)被选中。如果你想选择所有的文本，你可以像这样调用方法<code class="fe ms mt mu mv b">select</code><code class="fe ms mt mu mv b">textbox.select()</code>。如果你只是想把光标放在一个位置，让用postionStart调用<code class="fe ms mt mu mv b">setSelectionRange</code>，positionEnd是你想放光标的位置。这是我给他们的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/31f7825860d38e649bbb35cd50c04b89.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*PSV2MkRwY2G8-NeJmrRAIQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Put cursor position</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/072afb70d372adddbf2aa930316cf00b.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*PF6HmceOB1q_U4pE1OWCJg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Select all text of input</figcaption></figure><p id="1632" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">获取位置起点和位置终点</strong></p><p id="fa0b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以上是一些修改输入选择的方法。如果你想在某个输入中得到当前位置选择的开始和结束，你可以用属性<code class="fe ms mt mu mv b">selectionStart</code>和<code class="fe ms mt mu mv b">selectionEnd</code>试试。它会帮助你得到那个值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/d97822d9769201823c68279827e4f249.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*T_Yky3M6wDzVYlWTlQM6mw.png"/></div></figure><p id="c19e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">修改选中的文本</strong></p><p id="b7df" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">处理完选定的范围后，我们将转到一个重要的方法来替换选定范围的文本。为此，我们可以使用方法<code class="fe ms mt mu mv b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/setRangeText" rel="noopener ugc nofollow" target="_blank">setRangeText</a></code>。如果您只想用另一个文本替换所选的文本，您只需要调用只有一个参数的方法，即您想要替换的单词。如果你想用位置开始和结束来替换文本，你只需要再填充两个参数位置开始和结束。以下是替换选定文本和按位置替换文本的两个函数示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="5bcc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以下是其中两个函数的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/93666995dfbf453fc2530eba7d6fa7d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*imgMO6HKYy9K4zuuj6XXMQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Replace selected text</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/c6c346a8908696ee81710599bbe22b08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sKhYb1OKkiXfLg2q5m2d0g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Replace by postion</figcaption></figure><p id="61c3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于HTMLInputElement，有一些基本的示例可供选择。这是我用灵活的元素修改后的完整代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="8be9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我想和你分享一些关于如何在普通输入中使用选择的简单例子。在下一部分中，我们将使用内容可编辑的元素。</p><h1 id="27c1" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">内容可编辑元素</h1><p id="1203" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">在开始使用它之前，我认为我们需要了解内容可编辑元素。你以前用过编辑器吗？许多编辑器使用内容可编辑元素构建。要使内容成为可编辑的元素，我们只需要创建一个HTML元素(div，span…)并启用该元素的属性<code class="fe ms mt mu mv b">contenteditable="true"</code>，或者CSS属性<code class="fe ms mt mu mv b">-webkit-user-modify</code>。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="59ee" class="na la in mv b gy nb nc l nd ne">&lt;div <!-- -->contenteditable="true" id="editor"&gt;Here is content editable element&lt;/div&gt;</span></pre><p id="86ca" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">或者使用CSS:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="52c4" class="na la in mv b gy nb nc l nd ne">div {<br/>    -webkit-user-modify: read-write;<br/>}</span></pre><p id="c80f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它看起来像一个普通的输入:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/090f81cc3f72f142b2ba28f2b83f428a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*FIyM__NznRpNxiJ538XRXA.png"/></div></figure><p id="b021" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果它看起来像正常的输入，为什么我们需要它？如此简单，有了内容可编辑的元素，我们可以做出更高级的东西，从粗体、斜体、下划线……到变量、链接和表格。很多东西！在上面，我已经提到了<code class="fe ms mt mu mv b">getSelection</code>和<code class="fe ms mt mu mv b">range</code>。但是我们使用的是HTMLInputElement的方法，而不是<code class="fe ms mt mu mv b">getSelection</code>和<code class="fe ms mt mu mv b">range</code>。因为这是使用HTMLInputElement的好方法。我们将把它们用于内容可编辑的元素。我们走吧。</p><p id="a19d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">选中一个区域</strong></p><p id="97a1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">像前一部分一样，我们将从选定的区域开始工作。因为内容可编辑元素的选择比表单复杂得多，所以我们需要不止一个步骤来选择一个区域。对于正常输入，我们只需要定位选择的开始和结束。但是对于内容可编辑元素，我们需要两个步骤来制作一个<code class="fe ms mt mu mv b">range</code>并将其应用于选择。这只是一个简单的例子:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="b916" class="na la in mv b gy nb nc l nd ne">range.setStart(startNode, startOffset);<br/>range.setEnd(endtNode, endOffset);<br/>selection.removeAllRanges();<br/>selection.addRange(range);</span></pre><p id="15f2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因为一个元素内部可以有很多节点。这就是为什么我们需要两步来设置开始和结束节点的开始和结束位置。在开始一个有多个子节点的元素之前，我认为我们应该用一个有一个子节点的元素做一个简单的例子。只需使用我们在上面创建的<code class="fe ms mt mu mv b">div</code>标签。下面是选择具有开始和结束位置的区域的JavaScript代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="6e06" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们尝试使用这个函数来选择元素中的“内容”。结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/670aadd0b28f3e4f2355353e4a1cd8aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*qADD9NCA8tcw2yzjdgLc7g.png"/></div></div></figure><p id="ab5b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它工作了。在这个例子中，我对<code class="fe ms mt mu mv b">setStart</code>和<code class="fe ms mt mu mv b">setEnd</code>使用了<code class="fe ms mt mu mv b">firstChild</code>，因为我们的元素只有一个子节点。现在我们将移动到一个有许多子节点元素，也就是“富文本”。</p><p id="ddba" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">在富文本中选择了一个区域</strong></p><p id="1414" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我认为我们需要更新一下，例如我们的div <code class="fe ms mt mu mv b">editor</code>如下所示:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="4962" class="na la in mv b gy nb nc l nd ne">&lt;div id="editor" contenteditable="true" id="editor"&gt;Hello, my name is &lt;b&gt;Tasy&lt;/b&gt;. And you?&lt;/div&gt;</span></pre><p id="5af6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我认为理解这个元素的DOM结构是一个很好的开端。首先，我们可以使用属性<code class="fe ms mt mu mv b">childNodes</code>来获取这个元素的子节点:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/880c8a8316492e2de002a3798d4089c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*o-1puieZfhT4QNCGm7ce4g.png"/></div></figure><p id="619d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">根据结果，我们可以看到这个元素有三个子节点。我们可以看到下面的图像来更容易地理解它:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/23e719527b0f66bcb95300271184311c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AkOkU3OgwVS4vfp_fqx_qg.png"/></div></div></figure><p id="159b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们举个简单的例子。选择包含“我的名字是Tasy”的文本。这个元素中有三个子节点(text、bold、text)。“我的名字是”在第一个节点。第二个节点中的“Tasy”。根据前面的示例，我们可以看到，我们的范围可以从位置为6的第一个节点开始，到位置为3的第二个节点结束。下面是实现这一点的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="413e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">来测试一下吧！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/31a16dc7acfd0b4d652cb47d9e5d7844.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*MhjPEw3YtIuRZ4IeYWd2Rw.png"/></div></figure><p id="bae9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们得到了这个错误。因为我们在第二个子节点中没有偏移量为4的子节点。让我们尝试用#text元素替换第二个节点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/85b1281a3229720cf846148782cc4c90.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*sksbe9w3KcbEOMe6TEJR4A.png"/></div></figure><p id="13df" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">感谢上帝。有用！这意味着方法<code class="fe ms mt mu mv b">setEnd</code>和<code class="fe ms mt mu mv b">setStart</code>中的第二个参数是子方法的偏移量。如果我们想访问某个元素内部的内容，我们应该使用这个元素的子元素。下面我画一个简单的树。我希望它能帮助你更容易理解我们的例子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/2d748fbbe4b2d8e65b49debcc3e6f88f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QC_nUOg8fkrFJss-2Wp03g.png"/></div></div></figure><p id="5586" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">按照这个结构，我想你可以找到自己的方式来选择任何你想要的区域。</p><p id="9a3d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">删除并替换选中的文本</strong></p><p id="eb48" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是本文的最后一部分。我将向您展示修改所选内容的一种方法。为此，我们需要使用Range的方法。第一种方法是<code class="fe ms mt mu mv b">deleteContents</code>，它允许我们删除选定的内容。让我们用这段代码试一试:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="4d27" class="na la in mv b gy nb nc l nd ne">const range = document.getSelection().getRangeAt(0);<br/>range.deleteContents();</span></pre><p id="f74c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/48fdae8d5549b9db4f469a5dc33926e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*ytKkpw82utibE7INuU5RZA.png"/></div></figure><p id="ab0a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">选定的文本已被删除。这很容易。在下一个例子中，我将向您展示用其他内容替换所选内容的方法。在开始这样做之前，我想我们可以注意到Range的内容和Node的内容几乎是一样的。这意味着我们可以在Range的内容中插入一个节点。如果你想在选中的内容后插入新的内容，你可以使用Node作为参数的方法<code class="fe ms mt mu mv b">insertNode</code>。现在，让我们尝试替换本例中的选定内容:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="0586" class="na la in mv b gy nb nc l nd ne">const range = document.getSelection().getRangeAt(0);<br/>const newText = document.createTextNode('I am');<br/>range.deleteContents();<br/>range.insertNode(newText);</span></pre><p id="b51c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这个例子中，我用上面的源代码中的“我是”替换了“我的名字是”。我们来看一个结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/7435717753d6f809d4be9399098ef0c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*8m9keWlKcdS3c5NwmegfXw.png"/></div></figure><p id="49cc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们为替换选择中的多个元素的情况再举一个例子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/ee50ac992f28ed19778c74cb6010e6c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*-mHrTEdNTc4JMg9ZD_etew.png"/></div></div></figure><p id="4ca5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它仍然有效。这意味着我们可以将这种方式应用于两种情况。除此之外，我认为在进入下一部分之前，我们需要知道一件小事。在第一个例子中，当我们用“我是”替换“我的名字”时，它不仅替换了内容，还创建了一个新的文本元素。我拍了一张照片来比较运行我们的代码前后的子节点:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/d8f763c91541942cf020de2bd4b8633d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EjQjKpiiBJZMEJ8e5NNwLA.png"/></div></div></figure><p id="ed52" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们记住它以避免意想不到的问题。让我们进入下一部分。</p><p id="9dd9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">将选中的文本换行</strong></p><p id="cf00" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在以上示例中，我们学习了替换选定内容的方法。在这一部分，我们将学到一件重要的事情。您是否在编辑器中使文本变成粗体、斜体或改变颜色？在这一部分，我们将学习一种方法。基于我们在上一部分所做的关于如何替换所选文本的工作。我们只需要了解一件事，获取选定内容的方法。然后将这些内容放入一个元素中，我们想在删除旧内容后将其插入到范围中。下面是将所选内容颜色更改为绿色的示例代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="8aa1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以在这里看到结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/bd0032cea63bab04ba77effcfc47b7be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*8tHpGf1ydmcpGXHoXY5_jQ.png"/></div></figure><p id="5bf8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">选定的文本颜色已更改为绿色。当然，我们不仅改变了文本的颜色，还创建了一个新的元素(就像上面的例子)。下面是运行我们的代码后的子节点:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/b7068e8d619ca25962c9417f5296fd61.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*wLiVO8SUw-28XJ9J0veYyA.png"/></div></figure><p id="7e96" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以看到，又有一个节点被创建并添加到子节点列表中。在该节点中，我们可以看到两个子节点，分别是之前选择的<code class="fe ms mt mu mv b">text</code>和<code class="fe ms mt mu mv b">b</code>。我想我可以用这张纸条来结束这一部分。这也是关于如何使用内容可编辑元素的最后一部分。</p><h1 id="f6ab" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">结论</h1><p id="daa8" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">过去，我有机会在我以前的公司从事一个项目。在这个项目中，我们的目标是构建一个具有多种功能的编辑器。由于流程开发很弱，我们选择并切换了许多库来构建这个编辑器。每次遇到问题，我们只能在谷歌上搜索，希望找到解决方案。我想如果我把时间花在学习<code class="fe ms mt mu mv b">selection</code>和<code class="fe ms mt mu mv b">range</code>上，我会做得更好。</p><p id="b260" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以我想我可以写一篇关于如何与<code class="fe ms mt mu mv b">selection</code>和<code class="fe ms mt mu mv b">range</code>合作的简单文章。我希望这篇文章对你有所帮助。在这里阅读更多关于选择和范围的内容:</p><div class="oc od gp gr oe of"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Range" rel="noopener  ugc nofollow" target="_blank"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd io gy z fp ok fr fs ol fu fw im bi translated">范围-网络APIs | MDN</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">Range接口表示文档的片段，它可以包含节点和部分文本节点。</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">developer.mozilla.org</p></div></div><div class="oo l"><div class="op l oq or os oo ot ks of"/></div></div></a></div><div class="oc od gp gr oe of"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Selection" rel="noopener  ugc nofollow" target="_blank"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd io gy z fp ok fr fs ol fu fw im bi translated">选择-Web API | MDN</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">本节中使用的其他关键术语。选区的锚点是选区的起点。当做决定时…</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">developer.mozilla.org</p></div></div><div class="oo l"><div class="ou l oq or os oo ot ks of"/></div></div></a></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/283c14a3fb619fdbeaa309ad8a1007b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N5Gtq7zjlU27Afr6"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@annoand?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Anders Nord</a> on <a class="ae ky" href="https://unsplash.com/s/photos/draw?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="dfad" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">谢谢你的阅读。</p><p id="dbeb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通过<a class="ae ky" href="https://www.linkedin.com/in/thaisangnguyen3894/" rel="noopener ugc nofollow" target="_blank">领英</a>或<a class="ae ky" href="https://twitter.com/tasyit" rel="noopener ugc nofollow" target="_blank">推特</a>与我联系。</p></div><div class="ab cl ov ow hr ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="ig ih ii ij ik"><p id="b462" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="pc">更多内容请看</em><a class="ae ky" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="pc">plain English . io</em></strong></a><em class="pc">。报名参加我们的</em> <a class="ae ky" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="pc">免费周报</em> </strong> </a> <em class="pc">。关注我们关于</em><a class="ae ky" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="pc">Twitter</em></strong></a><strong class="jm io"><em class="pc"/></strong><em class="pc">和</em><strong class="jm io"><em class="pc"/></strong><a class="ae ky" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="pc">LinkedIn</em></strong></a><em class="pc">。查看我们的</em> <a class="ae ky" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="pc">社区不和谐</em> </strong> </a> <em class="pc">加入我们的</em> <a class="ae ky" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="pc">人才集体</em> </strong> </a> <em class="pc">。</em></p></div></div>    
</body>
</html>