<html>
<head>
<title>Create a Pre-commit Git Hook to Check and Fix Your JavaScript/TypeScript Code Automatically</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建一个预提交Git挂钩来自动检查和修复您的JavaScript/TypeScript代码</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-a-pre-commit-git-hook-to-check-and-fix-your-javascript-typescript-code-b04de61834bd?source=collection_archive---------0-----------------------#2022-08-14">https://javascript.plainenglish.io/create-a-pre-commit-git-hook-to-check-and-fix-your-javascript-typescript-code-b04de61834bd?source=collection_archive---------0-----------------------#2022-08-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="77dd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用ESLint、Prettier、lint-staged和Husky提高代码质量</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/08ae9b5c15f8563146e1fbb6dc465eb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8JouceB741q1Ji45"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk">Photo by Vishal Jadhav from <a class="ae kr" href="https://unsplash.com/photos/xBmmFz2psKw" rel="noopener ugc nofollow" target="_blank">Unsplash</a>.</figcaption></figure><p id="cfd8" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在一个项目中有一个统一的编码风格是很重要的，特别是对于一个JavaScript/TypeScript项目。这是因为JavaScript是一种非常灵活的语言，而TypeScript在语法上不太灵活，但在格式上仍然非常灵活。假设代码的某一部分使用2个空格进行缩进，而另一部分使用4个空格。嗯，你可能会认为这样的林挺只是装饰性的(我不同意)，linters也可以检查语法，并帮助你用通用的行业标准提高代码质量。</p><p id="e632" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">手工检查代码质量和编码风格很麻烦。幸运的是，有了Git钩子，它可以自动完成，如果林挺不能被传递，作者将不能创建提交。对于JavaScript/TypeScript项目，有一些成熟的包可用于林挺和管理Git挂钩。在这篇文章中，我们将介绍如何使用<strong class="ku ir"> ESLint </strong>、<strong class="ku ir">beauty</strong>、<strong class="ku ir"> lint-staged </strong>和<strong class="ku ir"> Husky </strong>创建一个Git预提交钩子来检查JavaScript/TypeScript代码。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="2d6b" class="lv lw iq bd lx ly lz dn ma mb mc dp md lb me mf mg lf mh mi mj lj mk ml mm mn bi translated">安装和配置ESLint</h2><p id="6ff4" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">ESLint 比本文中使用的其他软件包更复杂。建议先查看<a class="ae kr" href="https://lynn-kwong.medium.com/use-eslint-to-make-your-javascript-typesript-code-more-professional-1170bbdff32b" rel="noopener">这篇文章</a>找ESLint，特别是如果你想用它来检查TypeScript代码的话。那个帖子可以帮你解决你为项目设置ESLint时的各种问题。</p><p id="a473" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">如果您只想快速设置ESLint，可以运行此命令，使用向导安装和配置ESLint:</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="046f" class="lv lw iq mu b gy my mz l na nb">$ <strong class="mu ir">npm init </strong><a class="ae kr" href="http://twitter.com/eslint/config" rel="noopener ugc nofollow" target="_blank"><strong class="mu ir">@eslint/config</strong></a></span></pre><p id="56e8" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">选择最适合您项目的选项，<code class="fe nc nd ne mu b">package.json</code>文件将相应更新。将根据您的选择自动创建一个<code class="fe nc nd ne mu b"><a class="ae kr" href="https://gist.github.com/lynnkwong/a3300c1b8e0a38348a619bfafcb6812d#file-1170bbdff32b-eslintrc-1-js" rel="noopener ugc nofollow" target="_blank"><em class="nf">.eslintrc.js</em></a></code>文件。你需要做一些改变来满足你的需求。这是将在这篇文章中使用的<code class="fe nc nd ne mu b"><a class="ae kr" href="https://gist.github.com/lynnkwong/a3300c1b8e0a38348a619bfafcb6812d#file-1170bbdff32b-eslintrc-1-js" rel="noopener ugc nofollow" target="_blank"><em class="nf">.eslintrc.js</em></a></code>文件。更多细节可以在<a class="ae kr" href="https://lynn-kwong.medium.com/use-eslint-to-make-your-javascript-typesript-code-more-professional-1170bbdff32b" rel="noopener"> ESLint帖子</a>中找到。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="1810" class="lv lw iq bd lx ly lz dn ma mb mc dp md lb me mf mg lf mh mi mj lj mk ml mm mn bi translated">安装和配置更漂亮</h2><p id="d59a" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">如果您的项目只有JavaScript和TypeScript代码，ESLint通常就足够了，因为它可以执行语法和格式检查。然而，如果你的项目也有HTML和CSS文件，你也需要安装一个专门的代码格式化工具<a class="ae kr" href="https://github.com/prettier/prettier" rel="noopener ugc nofollow" target="_blank">。此外，由于大多数ide中都有pretty(比如</a><a class="ae kr" href="https://levelup.gitconnected.com/some-tips-to-make-your-vs-code-more-efficient-db77ec7071f8" rel="noopener ugc nofollow" target="_blank"> VS Code </a>)，所以使用pretty比ESLint更便于自动格式化代码。</p><p id="6b91" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">运行以下命令来安装更漂亮的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="2cf5" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">请注意，除了更漂亮的包之外，还安装了两个ESLint包，因此它可以很好地与ESLint一起工作，因为这两个包在代码格式化方面有一些重叠。</p><p id="b1b2" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">大多数情况下,“更漂亮”的默认设置已经足够了。但是，如果您的项目需要一些特殊的样式，您可以将它们添加到项目根文件夹中一个名为<code class="fe nc nd ne mu b">.prettierrc.json</code>的文件中。如果选项不太多，可以直接在命令行上添加。检查<a class="ae kr" href="https://prettier.io/docs/en/options.html" rel="noopener ugc nofollow" target="_blank">此链接</a>了解所有更漂亮的格式选项。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="4eb5" class="lv lw iq bd lx ly lz dn ma mb mc dp md lb me mf mg lf mh mi mj lj mk ml mm mn bi translated">安装和配置lint-staged</h2><p id="eff9" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">默认情况下，像ESLint和Prettier这样的linters会检查项目中的所有文件。然而，这是非常低效的。当创建提交时，我们只希望linters检查被更改或暂存的文件。文件被暂存意味着您已经运行<code class="fe nc nd ne mu b">git add</code>将其添加到<a class="ae kr" href="https://lynn-kwong.medium.com/understand-different-git-states-and-the-corresponding-file-states-fc62348e81d7" rel="noopener">暂存区</a>。这就是<em class="nf"> lint-staged </em>包的亮点，它让我们只lint被暂存的文件。</p><p id="dfa0" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">要安装<em class="nf"> lint-staged </em>，运行以下命令:</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="8ac0" class="lv lw iq mu b gy my mz l na nb">$ <strong class="mu ir">npm install --save-dev lint-staged</strong></span></pre><p id="ea13" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">要配置<em class="nf"> lint-staged </em>，您可以在<code class="fe nc nd ne mu b">package.json</code>中创建一个名为<code class="fe nc nd ne mu b">lint-staged</code>的新对象，或者在项目文件夹中创建一个名为<code class="fe nc nd ne mu b"><a class="ae kr" href="https://github.com/okonet/lint-staged#configuration" rel="noopener ugc nofollow" target="_blank">.lintstagedrc.json</a></code>的新文件。如果您有复杂的设置，后者更好。但是，我们将使用前者，因为只有少数设置:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="0391" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这里我们为<em class="nf"> lint-staged </em>定义三个任务。默认情况下，<em class="nf"> lint-staged </em>将同时运行任务<a class="ae kr" href="https://github.com/okonet/lint-staged#task-concurrency" rel="noopener ugc nofollow" target="_blank">和</a>。所以，如果同一个文件被不同的任务修改，就要格外注意了。由于比赛条件，结果可能是不可预测的。我们应该确保不同棉条的设置没有冲突。如果有必要，我们可以通过在命令行上为<code class="fe nc nd ne mu b">lint-staged</code>使用<code class="fe nc nd ne mu b">--concurrent false</code>来禁用并发性:</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="0c0c" class="lv lw iq mu b gy my mz l na nb"># Run the tasks concurrently:<br/>$ <strong class="mu ir">npx lint-staged</strong></span><span id="7332" class="lv lw iq mu b gy ni mz l na nb"># Run the tasks sequentially:<br/>$ <strong class="mu ir">npx lint-staged --concurrent false</strong></span></pre><p id="47d5" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">请注意，当一个任务失败时，所有其他任务都将被跳过或终止。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="bee9" class="lv lw iq bd lx ly lz dn ma mb mc dp md lb me mf mg lf mh mi mj lj mk ml mm mn bi translated">安装和配置Husky</h2><p id="8c06" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">上面我们用<code class="fe nc nd ne mu b">npx</code>手动运行了<em class="nf">皮棉暂存</em>。如果我们想在创建提交之前实施林挺，我们应该在<a class="ae kr" href="https://lynn-kwong.medium.com/use-pre-commit-commit-msg-and-pre-push-git-hooks-to-fix-your-python-code-asap-77d80d3ce412" rel="noopener">预提交Git挂钩</a>中运行<em class="nf"> lint-staged </em>。预提交挂钩实际上只是一个在提交创建之前运行的可运行脚本。在预提交钩子中我们可以有任何代码，林挺代码是一个完美的用例。</p><p id="5d34" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">有三种方法可以为预提交钩子中的<em class="nf"> lint-staged </em>添加林挺代码:</p><ul class=""><li id="b55b" class="nj nk iq ku b kv kw ky kz lb nl lf nm lj nn ln no np nq nr bi translated"><a class="ae kr" href="https://lynn-kwong.medium.com/use-pre-commit-commit-msg-and-pre-push-git-hooks-to-fix-your-python-code-asap-77d80d3ce412" rel="noopener">手动创建一个预提交钩子</a>并添加上面的命令来运行其中的<em class="nf"> lint-staged </em>。这有点麻烦，因为您需要手动将预提交钩子复制到<code class="fe nc nd ne mu b">.git/hooks/</code>文件夹。</li><li id="063f" class="nj nk iq ku b kv ns ky nt lb nu lf nv lj nw ln no np nq nr bi translated">使用<a class="ae kr" href="https://github.com/observing/pre-commit" rel="noopener ugc nofollow" target="_blank">预提交安装程序</a>。如果我们只有预提交钩子，而没有其他类型的Git钩子，比如<em class="nf"> commit-msg </em>或<em class="nf"> pre-push </em>，这就很方便了。</li><li id="2463" class="nj nk iq ku b kv ns ky nt lb nu lf nv lj nw ln no np nq nr bi translated">使用<a class="ae kr" href="https://typicode.github.io/husky/#/" rel="noopener ugc nofollow" target="_blank">哈士奇</a>！Husky支持所有的Git挂钩。这是目前在JavaScript/TypeScript项目中管理Git挂钩最流行的方法，并将在本文中使用。</li></ul><p id="4001" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">要安装<em class="nf"> husky </em>并使用<em class="nf"> husky </em>初始化项目，运行以下命令:</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="e01a" class="lv lw iq mu b gy my mz l na nb">$ <strong class="mu ir">npx husky-init &amp;&amp; npm install</strong></span></pre><p id="7774" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">一个名为<code class="fe nc nd ne mu b">.husky</code>的新文件夹将在您的项目文件夹中创建，其中包括一个带有下划线“<code class="fe nc nd ne mu b">_</code>”的特殊文件夹和一个模板<em class="nf">预提交</em>钩子。此外，<code class="fe nc nd ne mu b">package.json</code>中增加了一个名为<code class="fe nc nd ne mu b">prepare</code>的新脚本，运行<code class="fe nc nd ne mu b">husky install</code>命令。<code class="fe nc nd ne mu b"><a class="ae kr" href="https://docs.npmjs.com/cli/v8/using-npm/scripts#life-cycle-scripts" rel="noopener ugc nofollow" target="_blank">prepare</a></code> <a class="ae kr" href="https://docs.npmjs.com/cli/v8/using-npm/scripts#life-cycle-scripts" rel="noopener ugc nofollow" target="_blank">脚本</a>会在打包之前创建<code class="fe nc nd ne mu b">.husky</code>文件夹。</p><p id="103c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">让我们在<code class="fe nc nd ne mu b">.husky</code>文件夹的预提交钩子中添加运行<em class="nf"> lint-staged </em>的命令:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="2c71" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这个<em class="nf"> </em>预提交挂钩将在您在当前项目中创建提交之前被调用。我们还需要将它添加到项目文件夹中，这样当它被推送到远程存储库时，它将在项目中保持不变。不用担心，不会被<code class="fe nc nd ne mu b">husky install</code>命令覆盖。</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="0d99" class="lv lw iq mu b gy my mz l na nb">$ <strong class="mu ir">git add package.json</strong><br/>$ <strong class="mu ir">git add package-lock.json<br/></strong>$<strong class="mu ir"> git add .husky/pre-commit<br/></strong>$ <strong class="mu ir">git commit</strong></span></pre><p id="d2d1" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">现在，当您试图为一个文件创建一个与上面所示的<em class="nf"> lint-staged </em>定义的模式相匹配的提交时，预提交钩子将被自动调用。并且只检查暂存文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><p id="839b" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">干杯！我们现在已经在项目中成功地建立了一个Git预提交挂钩，它为这个项目强制执行了一个编码和格式化标准。现在，如果有人试图添加违反linters定义的规则的文件，他/她将无法提交。一开始你可能会讨厌它，但随着时间的推移，你会爱上它，尤其是当你的团队中有一些新成员还不知道你的团队的编码风格时。这将使你的代码库不容易出错，更容易维护，阅读起来更愉快。</p><p id="f01f" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">帖子里介绍的所有代码都可以在<a class="ae kr" href="https://github.com/lynnkwong/js-ts-git-hooks" rel="noopener ugc nofollow" target="_blank">这个回购</a>里找到。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="7cc6" class="lv lw iq bd lx ly lz dn ma mb mc dp md lb me mf mg lf mh mi mj lj mk ml mm mn bi translated">相关文章:</h2><ul class=""><li id="8791" class="nj nk iq ku b kv mo ky mp lb nx lf ny lj nz ln no np nq nr bi translated"><a class="ae kr" href="https://lynn-kwong.medium.com/use-eslint-to-make-your-javascript-typesript-code-more-professional-1170bbdff32b" rel="noopener">使用ESLint让你的JavaScript/typescript代码更加专业</a></li><li id="9170" class="nj nk iq ku b kv ns ky nt lb nu lf nv lj nw ln no np nq nr bi translated"><a class="ae kr" href="https://lynn-kwong.medium.com/use-pre-commit-commit-msg-and-pre-push-git-hooks-to-fix-your-python-code-asap-77d80d3ce412" rel="noopener">使用预提交、提交消息和预推送git挂钩尽快修复您的Python代码</a></li></ul><p id="9f7c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><em class="nf">更多内容请看</em><a class="ae kr" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ku ir"><em class="nf">plain English . io</em></strong></a><em class="nf">。报名参加我们的</em> <a class="ae kr" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ku ir"> <em class="nf">免费周报</em> </strong> </a> <em class="nf">。关注我们关于</em> <a class="ae kr" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ku ir"> <em class="nf">推特</em></strong></a><a class="ae kr" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ku ir"><em class="nf">领英</em></strong></a><strong class="ku ir"><em class="nf"/></strong><em class="nf">和</em> <a class="ae kr" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ku ir"> <em class="nf">不和</em> </strong> </a> <strong class="ku ir"> <em class="nf">。</em>T45】</strong></p></div></div>    
</body>
</html>