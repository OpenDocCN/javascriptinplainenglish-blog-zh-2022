<html>
<head>
<title>Redux Thunk vs Redux Saga: All You Need to Know</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Redux Thunk vs Redux Saga:你需要知道的一切</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/redux-thunk-vs-redux-saga-all-you-need-to-know-ecb06eb7e34e?source=collection_archive---------5-----------------------#2022-08-20">https://javascript.plainenglish.io/redux-thunk-vs-redux-saga-all-you-need-to-know-ecb06eb7e34e?source=collection_archive---------5-----------------------#2022-08-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5d51" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">您需要了解的关于Redux Thunk和Redux Saga的一切，以便为您的项目选择正确的React中间件。</h2></div><p id="0148" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在过去，我一直在我的项目中使用Redux Thunk，但最近我开始接触Redux Saga，发现它最初有点让人不知所措。但是我越理解它，就越开始欣赏它。因此，我想写这篇文章来教育和通知那些尝试Redux Saga或试图选择正确的React中间件的人。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/44f55582977c48d4a7262973fce7a937.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/0*ymDk6_x7coKJB1Cs"/></div></figure><h2 id="e979" class="lj lk iq bd ll lm ln dn lo lp lq dp lr ko ls lt lu ks lv lw lx kw ly lz ma mb bi translated"><strong class="ak">为什么Redux？</strong></h2><p id="a294" class="pw-post-body-paragraph kf kg iq kh b ki mc jr kk kl md ju kn ko me kq kr ks mf ku kv kw mg ky kz la ij bi translated">随着项目规模的扩大，在组件之间传递数据总是一件痛苦的事情，因此Redux通过拥有一个Redux store来拯救您，它是您的组件的唯一真实来源。可以把它想象成一个单独的数据类，这样每个组件都可以访问相同的数据，一个组件所做的任何更改都会反映到所有其他组件中。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mh"><img src="../Images/62e7281eff5b65540b74aa35cbf6639d.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*8cgFwGQFO5P0vqfDOW3beA.png"/></div></div></figure><p id="8679" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Redux通常会用到以下东西:</p><ul class=""><li id="8e73" class="mm mn iq kh b ki kj kl km ko mo ks mp kw mq la mr ms mt mu bi translated">行动</li><li id="4bdc" class="mm mn iq kh b ki mv kl mw ko mx ks my kw mz la mr ms mt mu bi translated">还原剂</li><li id="f175" class="mm mn iq kh b ki mv kl mw ko mx ks my kw mz la mr ms mt mu bi translated">动作创作者/工人传奇</li><li id="e6b7" class="mm mn iq kh b ki mv kl mw ko mx ks my kw mz la mr ms mt mu bi translated">Redux商店</li></ul><p id="e78b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Redux的工作方式如下图所示:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi na"><img src="../Images/1963ee3bbc231880f1cfa128172978dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*AXupiOtXrgt2MWbGjB1G1Q.png"/></div></figure></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h2 id="3e09" class="lj lk iq bd ll lm ln dn lo lp lq dp lr ko ls lt lu ks lv lw lx kw ly lz ma mb bi translated"><strong class="ak">什么是Redux Thunk？</strong></h2><p id="2ed8" class="pw-post-body-paragraph kf kg iq kh b ki mc jr kk kl md ju kn ko me kq kr ks mf ku kv kw mg ky kz la ij bi translated">Redux Thunk是一个使用动作创建器的中间件。这些动作创建者返回一个函数(thunk ),该函数将商店的分派方法作为参数，并在API或副作用完成后使用该方法分派同步动作。</p><p id="aeb4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是一个使用thunk的动作创建器的简单例子。它接受dispatch和getState作为参数，然后稍后触发一个操作。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/9191d13168b79fbc9b53282b995b2876.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*poXySueVkvkATkPLUOcxLw.png"/></div></figure><h2 id="7cc2" class="lj lk iq bd ll lm ln dn lo lp lq dp lr ko ls lt lu ks lv lw lx kw ly lz ma mb bi translated">【Redux Thunk是如何工作的？</h2><p id="03c2" class="pw-post-body-paragraph kf kg iq kh b ki mc jr kk kl md ju kn ko me kq kr ks mf ku kv kw mg ky kz la ij bi translated">下面是Redux-Thunk如何工作的逐步过程:</p><ol class=""><li id="8e36" class="mm mn iq kh b ki kj kl km ko mo ks mp kw mq la nj ms mt mu bi translated"><em class="nk">检查输入动作是什么:</em></li></ol><p id="3353" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果是常规动作对象，Redux Thunk不做任何事情，动作对象由存储的reducer处理。</p><p id="f610" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.如果动作是一个函数，Redux Thunk调用它并将其传递给存储的dispatch和getState方法以及任何额外的参数(例如，Axios)。</p><p id="2ea9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.函数运行后，thunk会调度动作，动作会相应地更新状态。</p><p id="7874" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是它的一个小例子:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi nl"><img src="../Images/b19bd01a1a92738ba108c0d8e0d04f20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9kiftfkzwdH7MN56UU-qIw.png"/></div></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/99778de6edf1bb9ed1883c9e26ef1cb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*8JB6lXUVIb9DfQXw.jpg"/></div></figure></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h2 id="33ee" class="lj lk iq bd ll lm ln dn lo lp lq dp lr ko ls lt lu ks lv lw lx kw ly lz ma mb bi translated"><strong class="ak">什么是Redux Saga？</strong></h2><p id="e791" class="pw-post-body-paragraph kf kg iq kh b ki mc jr kk kl md ju kn ko me kq kr ks mf ku kv kw mg ky kz la ij bi translated">Redux Saga也是一个中间件库，帮助我们处理API调用或副作用。Redux Saga使用了一个名为“生成器”的ES6功能，它可以帮助我们编写异步代码，并且它还使用工人Saga而不是动作创建者。</p><p id="49e7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">生成器</strong>是ECMA脚本6附带的函数。使用它们最好的一点是，生成器函数可以在执行过程中暂停，甚至可以退出，以后再重新进入。下面是生成器方法的语法:</p><pre class="lc ld le lf gt nn no np nq aw nr bi"><span id="82f7" class="lj lk iq no b gy ns nt l nu nv"><em class="nk">function* functionName() {}</em></span></pre><p id="a403" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">生成器方法是一个迭代器，所以它有一个内置的next()方法。当您触发next()时，会调用下一个yield方法，该方法会返回一个值和一个done属性，该属性会告诉您上一个yield是否已被调用。这样你就可以用一种更加可控和同步的方式来控制执行。下面是一个生成器方法如何工作的小例子:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/1567c1d48e55a83e29f230501f5baf78.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*pgC8jvcMyaSVF9PrTraIgQ.png"/></div></figure><h2 id="1d7c" class="lj lk iq bd ll lm ln dn lo lp lq dp lr ko ls lt lu ks lv lw lx kw ly lz ma mb bi translated">【Redux Saga是如何运作的？</h2><p id="b7a6" class="pw-post-body-paragraph kf kg iq kh b ki mc jr kk kl md ju kn ko me kq kr ks mf ku kv kw mg ky kz la ij bi translated">Redux Saga监听分派的动作，并触发API调用或您编写的任何其他副作用。它在动作到达你的reducer之前就捕获了它，所以在Redux状态设置之前你可以做任何你想做的事情。因为它在reducer之前捕获它，所以一旦你完成了你的工作，比如API调用等等。，您调度另一个动作，reducer现在将监听从该动作调度的这个动作。</p><p id="41bf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="nk">注意:</em> </strong> <em class="nk">理想情况下，我们不应该使用saga监听和调度的相同动作，因为这可能会导致下游出现问题。</em></p><p id="7f7a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在Saga提供了多种触发动作的方式，最常见的是<strong class="kh ir"> put: </strong></p><pre class="lc ld le lf gt nn no np nq aw nr bi"><span id="35ce" class="lj lk iq no b gy ns nt l nu nv">yield put({ type: 'SET_LOADING', isLoading: true });</span></pre><p id="023e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，您也可以使用<strong class="kh ir">调用来调用服务:</strong></p><pre class="lc ld le lf gt nn no np nq aw nr bi"><span id="80b1" class="lj lk iq no b gy ns nt l nu nv">yield call(searchRequest, { data: { searchBody } });</span></pre><p id="a6ac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Redux Saga还提供了多种现成的解决方案来监听每个动作，只监听最后一个动作，等等。你可以在这里阅读它们<a class="ae nx" href="https://redux-saga.js.org/docs/api/" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="lc ld le lf gt nn no np nq aw nr bi"><span id="fe0b" class="lj lk iq no b gy ns nt l nu nv">yield takeEvery('UPDATE_STATUS', updateStatus);<br/>yield takeLatest('UPDATE_STATUS', updateStatus);<br/>yield takeLeading('UPDATE_STATUS', updateStatus);<br/>yield takeMaybe('UPDATE_STATUS', updateStatus);</span></pre></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h2 id="7522" class="lj lk iq bd ll lm ln dn lo lp lq dp lr ko ls lt lu ks lv lw lx kw ly lz ma mb bi translated">【Redux Thunk和Redux Saga的区别</h2><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/74b735b1ea828c96202e253dc3cfa9ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*2s_fYPZGMzWAIHOH.jpg"/></div></figure><p id="9884" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">1 — Thunk使用回调方法，而Saga几乎使用一个单独的线程，您可以很好地控制它。因此，如果您在thunk中不使用异步await，您可能会陷入回调地狱，而saga没有这个问题。</p><p id="b62c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2-在Thunk中，动作创建者可能持有大量逻辑，因此开始变得复杂和不纯，而在Saga中，工人Saga只负责API调用等副作用。</p><p id="da4e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3-Saga使用一种称为发电机的ES6概念。简单地调用一个生成器方法不会触发该方法，而是需要调用next()来按顺序触发各种产出。Thunk没有这些问题，因为它不使用迭代器或生成器。</p><p id="91ee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4 —使用Saga，您可以更容易地测试您的异步数据流。call和put方法返回JavaScript对象。因此，您可以通过等式比较简单地测试您的saga函数产生的每个值。另一方面，Redux Thunk返回的是承诺，更难测试。测试Thunks通常需要对fetch API、axios请求或其他函数进行复杂的模拟。有了Redux Saga，你不需要模仿用效果包装的函数。这使得测试变得清晰、易读、易于编写。</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h2 id="c28c" class="lj lk iq bd ll lm ln dn lo lp lq dp lr ko ls lt lu ks lv lw lx kw ly lz ma mb bi translated"><strong class="ak">两者之间如何选择</strong></h2><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/0d8139ecf0e35276d8270aa54b4a212f.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/0*3Q8dUIPJX8_MC17a.png"/></div></figure><p id="48ff" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这两种中间件各有优缺点。现在来看如何选择使用哪种中间件是非常主观的，但是您可以在决定时记住一些事情。</p><ul class=""><li id="e8bf" class="mm mn iq kh b ki kj kl km ko mo ks mp kw mq la mr ms mt mu bi translated">如果你的项目是小型到中型的，Thunk会很好的工作，因为动作创建者不会做太多的工作，它会保持轻量级。</li><li id="65ed" class="mm mn iq kh b ki mv kl mw ko mx ks my kw mz la mr ms mt mu bi translated"><strong class="kh ir"> Thunk </strong>自带的样板代码较少，所以如果担心包的大小，Thunk是更好的选择。</li><li id="7bb9" class="mm mn iq kh b ki mv kl mw ko mx ks my kw mz la mr ms mt mu bi translated"><strong class="kh ir"> Saga </strong>需要更多的学习曲线，因为它使用了更新的概念，如<em class="nk">生成器方法</em>，这可能会让一些人一开始就感到困惑。</li><li id="40e5" class="mm mn iq kh b ki mv kl mw ko mx ks my kw mz la mr ms mt mu bi translated"><strong class="kh ir"> Saga </strong>确实提供了许多现成的方法来处理各种问题，这些问题需要在thunk架构中进行大量的编码，例如，如果在短时间内多次触发相同的操作，例如刷新按钮，假设使用Saga，您可以使用<em class="nk"> takeLatest </em>并仅处理最新的操作，而在thunk中，您需要跟踪状态以了解现有的刷新是否正在进行，然后阻止更新的请求。</li><li id="3878" class="mm mn iq kh b ki mv kl mw ko mx ks my kw mz la mr ms mt mu bi translated">另外，<strong class="kh ir"> Saga </strong>更容易测试，因为Saga文件只处理API调用等副作用。因此相对更容易测试，而Thunk中的动作创建者会有很多逻辑。</li></ul><h2 id="05ea" class="lj lk iq bd ll lm ln dn lo lp lq dp lr ko ls lt lu ks lv lw lx kw ly lz ma mb bi translated"><strong class="ak">结论</strong></h2><p id="2d8b" class="pw-post-body-paragraph kf kg iq kh b ki mc jr kk kl md ju kn ko me kq kr ks mf ku kv kw mg ky kz la ij bi translated">这两种中间件各有优缺点。您可以根据需求和上面提到的两个中间件之间的差异来决定哪一个适合您。</p><p id="1a4b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当谈到编码时，通常没有错误的答案，你可以使用任何东西完成几乎任何事情。唯一要考虑的是带宽和截止日期，所以要明智地选择。</p><p id="8c50" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你喜欢这篇文章，也可以看看我的其他文章:</p><div class="oa ob gp gr oc od"><a rel="noopener  ugc nofollow" target="_blank" href="/all-about-importing-methods-in-javascript-d8d84fbd30d3"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">关于在JavaScript中导入方法的所有内容</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">知道在什么情况下使用什么语法。</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="om l"><div class="on l oo op oq om or lh od"/></div></div></a></div><div class="oa ob gp gr oc od"><a href="https://medium.com/geekculture/jss-or-css-what-to-use-and-why-829dc117a5ba" rel="noopener follow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">JSS或CSS…用什么，为什么？</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">如果你们没有听说过JSS，它的CSS是JS风格的。它真的很受欢迎，并且在几个月内非常方便…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">medium.com</p></div></div><div class="om l"><div class="os l oo op oq om or lh od"/></div></div></a></div><div class="oa ob gp gr oc od"><a rel="noopener  ugc nofollow" target="_blank" href="/must-know-javascript-features-in-2022-80c0655a6e98"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">2022年必知的JavaScript特性</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">使用这些功能，您可以减少代码并使其更具可读性。</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="om l"><div class="ot l oo op oq om or lh od"/></div></div></a></div></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="6b89" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nk">更多内容请看</em><a class="ae nx" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="nk">plain English . io</em></strong></a><em class="nk">。报名参加我们的</em><strong class="kh ir"><em class="nk"/></strong><a class="ae nx" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="nk">免费周报</em> </strong> </a> <em class="nk">。关注我们关于</em> <a class="ae nx" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> <em class="nk">推特</em> </strong> </a>，<a class="ae nx" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> <em class="nk">领英</em> </strong> </a> <em class="nk">，</em><a class="ae nx" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="nk">YouTube</em></strong></a><em class="nk">，以及</em> <a class="ae nx" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> <em class="nk">不和</em> </strong> </a> <em class="nk">。</em></p></div></div>    
</body>
</html>