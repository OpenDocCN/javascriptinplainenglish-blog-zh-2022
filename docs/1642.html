<html>
<head>
<title>My Experience with the Web Share API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我对Web Share API的体验</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/my-experience-with-the-web-share-api-b76a95a2b3bf?source=collection_archive---------17-----------------------#2022-04-07">https://javascript.plainenglish.io/my-experience-with-the-web-share-api-b76a95a2b3bf?source=collection_archive---------17-----------------------#2022-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="dd1e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">吸取的教训。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/409347513e3044fafd7cebf9c4a3df56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gFzR9wmdGoG0d8JF"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@thombradley?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Thom Bradley</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="a3ed" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">背景</h1><p id="0da7" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在过去的几年里，我一直在开发一个web应用程序，最近我决定用Svelte重写它。作为该过程的一部分，我必须重新实现与其他用户共享页面的能力。为了做到这一点，我依赖于<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Share_API" rel="noopener ugc nofollow" target="_blank">网络共享API </a>。</p><p id="7ebd" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">虽然浏览器支持不是最好的，但它是在足够多的移动设备上提供功能的良好开端，这是我的主要目标。</p><h1 id="14c7" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">问题是</h1><p id="77c1" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在这个重新实现的过程中，我遇到了一个场景，这个标题并不是在所有情况下都被使用。在查看了分享功能的<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/share" rel="noopener ugc nofollow" target="_blank">文档后，它指出浏览器可能会忽略该标题。</a></p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="f248" class="mu kx iq mq b gy mv mw l mx my">await navigator.share({<br/>  title: document.title, // ignored by Safari on iOS<br/>  url: window.location.href,<br/>});</span></pre><p id="b734" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">对我来说，最主要的问题是——这个头衔从何而来？对于某些页面，标题会正确显示，而其他时候，当它被明确定义时，它会显示为<code class="fe mz na nb mq b">undefined</code>。在绞尽脑汁了一会儿之后，我终于找到了问题的原因。</p><h1 id="e1e9" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">解决方案</h1><p id="b915" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">至少当它来到iOS上的Safari时，传递到函数中的标题根本没有被使用(文档警告可能会发生这种情况)。相反，Safari似乎会单独调用传入的URL来检索文档的标题。在我的例子中，我试图分享的页面是在认证之后的。无论Safari使用什么机制来加载该页面，都不会使用最初加载该页面时使用的授权头。</p><p id="bb39" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我做了一些额外的研究，并确定这是因为太容易通过欺骗标题来误导共享链接的接收者。为了提高安全性，它将信任通过URL生成的标题，而不是传递给<code class="fe mz na nb mq b">navigator.share</code>函数的标题。</p><h1 id="3137" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">结论</h1><p id="eebe" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果您尝试使用Web共享API，如果您还想共享页面标题，请确保传入的URL不在身份验证之后。如果是在身份验证之后，至少要确保页面的标题仍然填充有适当的标题，以供Web共享API使用。</p><p id="bb76" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><em class="nc">更多内容请看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir"><em class="nc">plain English . io</em></strong></a><em class="nc">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir"> <em class="nc">免费周报</em> </strong> </a> <em class="nc">。关注我们关于</em><a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir"><em class="nc">Twitter</em></strong></a><em class="nc">和</em><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir"><em class="nc">LinkedIn</em></strong></a><em class="nc">。加入我们的</em> <a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir"> <em class="nc">社区不和谐</em> </strong> </a> <em class="nc">。</em></p></div></div>    
</body>
</html>