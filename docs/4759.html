<html>
<head>
<title>Angular: Access the Template-Driven Or Reactive Form inside a Directive to manipulate the form’s controls</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular:在指令中访问模板驱动的或反应式的表单，以操作表单的控件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/angular-access-the-template-driven-or-reactive-form-inside-a-directive-to-manipulate-the-forms-2ec4122455be?source=collection_archive---------3-----------------------#2022-12-31">https://javascript.plainenglish.io/angular-access-the-template-driven-or-reactive-form-inside-a-directive-to-manipulate-the-forms-2ec4122455be?source=collection_archive---------3-----------------------#2022-12-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="ced7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当您希望在指令中添加一些跨窗体的常见行为并重用这些行为时，访问指令中的窗体来操作其控件是非常有用的。</p><p id="4a32" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了说明如何做到这一点，我举了一个简单的例子。假设您有一个切换按钮，在单击时显示/隐藏一个表单。</p><ol class=""><li id="9f4b" class="ki kj in jm b jn jo jr js jv kk jz kl kd km kh kn ko kp kq bi translated">最初，窗体是隐藏的。</li><li id="fb5f" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated">点击切换按钮，表单显示出来。填写表格。</li><li id="56c7" class="ki kj in jm b jn kr jr ks jv kt jz ku kd kv kh kn ko kp kq bi translated">再次点击切换按钮。我们期望窗体的控件被重置，窗体再次被隐藏。</li></ol><p id="af8f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面是一个模板驱动和反应式表单的小演示。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi kw"><img src="../Images/7bffbf8fac9ddf6ceba06aa78b598cc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*CMi2le5ZHkDsqJL9lXLdyA.gif"/></div></div></figure><p id="1be0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这就是<strong class="jm io">反应形式</strong>的样子。在反应式表单中，我们显示了3个文本框。</p><p id="7034" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里要注意的要点是:</p><p id="9423" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">= &gt;用于切换布尔类属性<strong class="jm io">值的“切换反应形式”按钮是可见的</strong>。</p><p id="1e61" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">= &gt;我们定义了带有选择器<strong class="jm io"> resetForm的<strong class="jm io"> ResetFormDirective </strong>的<form>元素。</form></strong>我们已经将<strong class="jm io"> isVisible属性</strong>作为@Input()传递给指令。</p><p id="744f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">= &gt;当<strong class="jm io"> isVisible </strong>为false时，我们已经使用<strong class="jm io">【hidden】</strong>属性隐藏了表单控件(而不是<form>元素本身)。我们不想使用<strong class="jm io"> *ngIf </strong>从DOM中清除表单控件，相反我们更喜欢隐藏它，因为否则很难在指令中访问表单控件。</form></p><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="080f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">转到<strong class="jm io">模板驱动表单</strong>，这里我们显示2个下拉列表。</p><p id="d960" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">列表1 </strong>和<strong class="jm io">列表2 </strong>是两个数组属性，用于填充两个下拉列表中的数据。</p><p id="72f6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里要注意的要点(非常类似于反应式)是:</p><p id="ba22" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">= &gt;用于切换布尔类属性<strong class="jm io">值的“切换模板表单”按钮是可见的</strong>。</p><p id="302d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">= &gt;我们定义了带有选择器<strong class="jm io"> resetForm的<strong class="jm io"> ResetFormDirective </strong>的<form>元素。</form></strong>我们已经将<strong class="jm io"> isVisible属性</strong>作为@Input()传递给指令。</p><p id="7a74" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">= &gt;当<strong class="jm io"> isVisible </strong>为false时，我们已经使用<strong class="jm io">【hidden】</strong>属性隐藏了表单控件(而不是<form>元素本身)。我们不想使用<strong class="jm io"> *ngIf </strong>从DOM中清除表单控件，相反我们更喜欢隐藏它，因为否则很难在指令中访问表单控件。</form></p><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="d237" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后移动到<strong class="jm io">复位方向</strong>。</p><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="2b28" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因为我们在反应式和模板驱动的表单中都重复使用这个指令，为了访问这两种类型的表单，我们添加了2个<strong class="jm io"> @ContentChild() </strong>属性。</p><pre class="kx ky kz la gt lk ll lm bn ln lo bi"><span id="78b9" class="lp lq in ll b be lr ls l lt lu">@ContentChild(FormGroupDirective) form: FormGroupDirective;<br/>@ContentChild(NgForm) tempForm: NgForm;</span></pre><p id="1ac0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">@ content child(formgroup directive)Form</strong>用于访问反应式表单，<strong class="jm io">@ content child(ng Form)tempForm</strong>用于访问模板驱动式表单。</p><p id="bd7a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面是<strong class="jm io"> tempForm </strong> property的样子。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lv"><img src="../Images/a76718f6260cd37fbc253af3ad6a5159.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eahIkLeB47IsK4-cxZgyew.png"/></div></div></figure><p id="ab1c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面是<strong class="jm io">表单</strong>属性的样子。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lw"><img src="../Images/1de71e7028925ea379959b3543eb7dd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8UjFRH3IBmc_cchUmD_k4A.png"/></div></div></figure><p id="4b9e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> resetFormControls() </strong>以上面两张截图中的<strong class="jm io"> FormGroup </strong>为参数，将FormGroup下所有<strong class="jm io"> FormControl </strong>的值重置为空字符串。</p><p id="75f0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">整个逻辑都在<strong class="jm io"> ngOnChanges </strong>生命周期钩子中。</p><pre class="kx ky kz la gt lk ll lm bn ln lo bi"><span id="a291" class="lp lq in ll b be lr ls l lt lu">ngOnChanges(changes: SimpleChanges) {<br/>    if (!changes.isVisible.currentValue) {<br/>      if (this.tempForm &amp;&amp; this.tempForm.form) {<br/>        console.log(this.tempForm);<br/>        if (Object.keys(this.tempForm.form.controls).length) {<br/>          this.resetFormControls(this.tempForm.form);<br/>        }<br/>      }<br/>      if (this.form &amp;&amp; this.form.form) {<br/>        console.log(this.form);<br/>        this.resetFormControls(this.form.form);<br/>      }<br/>    }<br/>  }</span></pre><p id="bdbf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">表单最初是隐藏的，即<strong class="jm io"> isVisible </strong>属性的初始值为假。当用户单击切换按钮时，<strong class="jm io"> isVisible </strong>属性被设置为true，表单可见。用户填写表单。</p><p id="5069" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当用户再次点击切换按钮时，我们期望@Input() <strong class="jm io"> isVisible </strong>的值为<strong class="jm io"> false </strong>。因此，将满足<strong class="jm io"> ngOnChanges() </strong>中的以下条件。</p><pre class="kx ky kz la gt lk ll lm bn ln lo bi"><span id="f27e" class="lp lq in ll b be lr ls l lt lu">if (!changes.isVisible.currentValue) {<br/><br/>}</span></pre><p id="02a1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦我们进入了IF语句，我们就编写了两个逻辑——一个用于反应式表单，另一个用于模板驱动表单。</p><p id="be1f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面几行代码是模板驱动的表单。我们正在将<strong class="jm io">@ content child(ng form)tempForm</strong>属性内的<strong class="jm io"> FormGroup </strong>作为参数传递给<strong class="jm io"> resetFormControls() </strong>，只有当我们确定<strong class="jm io">属性没有被定义</strong>并且<strong class="jm io">tempForm</strong>内的控件属性不是空数组时。</p><pre class="kx ky kz la gt lk ll lm bn ln lo bi"><span id="f47d" class="lp lq in ll b be lr ls l lt lu"> if (this.tempForm &amp;&amp; this.tempForm.form) {<br/>        console.log(this.tempForm);<br/>        if (Object.keys(this.tempForm.form.controls).length) {<br/>          this.resetFormControls(this.tempForm.form);<br/>        }<br/>      }</span></pre><p id="9ea1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面几行代码是针对反应式表单的。我们将把<strong class="jm io">@ content child(FormGroup directive)form</strong>属性中的<strong class="jm io"> FormGroup </strong>作为参数传递给<strong class="jm io"> resetFormControls()。</strong></p><pre class="kx ky kz la gt lk ll lm bn ln lo bi"><span id="96bb" class="lp lq in ll b be lr ls l lt lu">if (this.form &amp;&amp; this.form.form) {<br/>console.log(this.form);<br/>this.resetFormControls(this.form.form);<br/>}</span></pre><p id="ffc3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在下面的<strong class="jm io"> resetFormControls() </strong>中，我们首先使用<strong class="jm io">object . keys(form . controls)</strong>检索了FormGroup的所有FormControl的名称列表。</p><p id="7079" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，我们将遍历这个FormControl名称列表，并将FormControl的值设置为一个空字符串。</p><pre class="kx ky kz la gt lk ll lm bn ln lo bi"><span id="ed4e" class="lp lq in ll b be lr ls l lt lu">resetFormControls(form) {<br/>Object.keys(form.controls).forEach((control: string) =&gt; {<br/>form.get(control).setValue(‘’);<br/>});<br/>}</span></pre><p id="70ab" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">或者，如果表单的初始值可用，您可以直接调用FormGroup上的<strong class="jm io"> reset() </strong>，将表单的初始值作为参数传递。否则你可以遍历所有的FormControl并重置值，就像我们在这个例子中所做的那样。</p><p id="773c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以在下面找到完整的工作示例。</p><div class="lx ly gp gr lz ma"><a href="https://stackblitz.com/edit/angular-ppcvjv?file=src/app/reset-form.directive.ts" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab fo"><div class="mc ab md cl cj me"><h2 class="bd io gy z fp mf fr fs mg fu fw im bi translated">角形(叉形)堆叠</h2><div class="mh l"><h3 class="bd b gy z fp mf fr fs mg fu fw dk translated">一个基于rxjs，tslib，jquery，core-js，zone.js，bootstrap，popper.js，@angular/core的angular-cli项目…</h3></div><div class="mi l"><p class="bd b dl z fp mf fr fs mg fu fw dk translated">stackblitz.com</p></div></div><div class="mj l"><div class="mk l ml mm mn mj mo lg ma"/></div></div></a></div><h2 id="b6bd" class="mp lq in bd mq mr ms dn mt mu mv dp mw jv mx my mz jz na nb nc kd nd ne nf ng bi translated">更多内容请访问<a class="ae nh" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> PlainEnglish.io </a>。</h2><p id="3aa9" class="pw-post-body-paragraph jk jl in jm b jn ni jp jq jr nj jt ju jv nk jx jy jz nl kb kc kd nm kf kg kh ig bi translated"><em class="nn">报名参加我们的</em> <a class="ae nh" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="nn">免费周报</em> </strong> </a> <em class="nn">。关注我们关于</em><a class="ae nh" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="nn">Twitter</em></strong></a>，<a class="ae nh" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="nn">LinkedIn</em></strong></a><strong class="jm io"><em class="nn">，</em></strong><a class="ae nh" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><em class="nn">YouTube</em><strong class="jm io"><em class="nn">，以及</em></strong><em class="nn"/></a><a class="ae nh" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="nn">不和</em> </strong> </a>T49】</p><h2 id="a759" class="mp lq in bd mq mr ms dn mt mu mv dp mw jv mx my mz jz na nb nc kd nd ne nf ng bi translated">希望扩大你的科技创业公司的知名度和采用率吗？检查<a class="ae nh" href="https://circuit.ooo/?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank">电路</a>。</h2></div></div>    
</body>
</html>