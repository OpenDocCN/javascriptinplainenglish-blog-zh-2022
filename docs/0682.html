<html>
<head>
<title>JavaScript: forEach and Async/Await Done Correctly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript: forEach和Async/Await已正确完成</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-foreach-and-async-await-done-correctly-49cc04a3df04?source=collection_archive---------8-----------------------#2022-02-07">https://javascript.plainenglish.io/javascript-foreach-and-async-await-done-correctly-49cc04a3df04?source=collection_archive---------8-----------------------#2022-02-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ba5e6c2d8200af63f1830c3aa82ad088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gb9v6LpyEaeBFXcIJ0Rqug.jpeg"/></div></div></figure><p id="e569" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您曾经尝试过在arr.forEach中使用async/await，您可能会发现您的应用程序中有一些奇怪的和意想不到的副作用。</p><p id="8185" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这主要是因为arr.forEach期望同步函数，而不是异步函数。这个基本上意味着它不会像你所期望的那样“等待”。</p><p id="ba8b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">考虑下面的代码</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="f34f" class="lf lg iq lb b gy lh li l lj lk">async function someAsyncFunction(value) {<br/> //Simulate a promise that returns a value<br/>  const randomDelay = Math.random() * (100 - 10) + 10;<br/>  setTimeout(() =&gt; console.log(value), randomDelay);<br/>}</span><span id="bb74" class="lf lg iq lb b gy ll li l lj lk">const values = [100, 200, 300];<br/>values.forEach(async (val) =&gt; {<br/>  await someAsyncFunction(val);<br/>});</span></pre><p id="2445" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最初，您会期望输出</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="21ea" class="lf lg iq lb b gy lh li l lj lk">100<br/>200<br/>300</span></pre><p id="175e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是运行几次代码，您会遇到不同的输出。</p><h1 id="c0e6" class="lm lg iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">如何解决问题</h1><p id="f485" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">既然你已经看到了像上面这样做的奇怪的怪癖，你实际上怎样才能正确地做呢？让我们来看看</p><h1 id="3412" class="lm lg iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">Promise.all()</h1><p id="d420" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">我发现正确做这件事的最好和最干净的方法是使用<strong class="ka ir"> <em class="mo"> Promise.all() </em> </strong>。以下代码将产生您所期望的结果:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="ba1a" class="lf lg iq lb b gy lh li l lj lk">async function someAsyncFunction(value) {<br/>  return new Promise((resolve, reject) =&gt; {<br/>    setTimeout(() =&gt; {<br/>      resolve(`Promise resolved`)<br/>    }, 100)<br/>  })<br/>}<br/>const values = [100, 200, 300];<br/>const testFunction = async () =&gt; {<br/> return await Promise.all(<br/>    values.map(async (val) =&gt; {<br/>      return await someAsyncFunction(val);<br/>    })<br/>  );<br/>}</span><span id="a097" class="lf lg iq lb b gy ll li l lj lk">const run = async () =&gt; {<br/>  const test = await testFunction();<br/>  console.log(test);<br/>}</span><span id="8afa" class="lf lg iq lb b gy ll li l lj lk">run();</span></pre><p id="79a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在这里找到代码:<a class="ae mp" href="https://jsfiddle.net/xbkevnfz/" rel="noopener ugc nofollow" target="_blank">https://jsfiddle.net/xbkevnfz/</a></p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><p id="38c1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢阅读，我希望你喜欢这篇文章，如果是的话，请点击按钮或订阅来支持我。</p><p id="405d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你还不是一个中等成员，考虑成为一个！你可以从成千上万的作者那里获得像这样的好内容！它有助于支持作家，你也有机会通过写作赚钱。<em class="mo"> </em> <a class="ae mp" href="https://nickychristensen.medium.com/membership" rel="noopener"> <strong class="ka ir">在这里注册每月只需5美元。</strong>T13】</a></p><p id="adea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="mo">如果您想订阅我的所有内容，</em> </strong> <a class="ae mp" href="https://nickychristensen.medium.com/subscribe" rel="noopener"> <strong class="ka ir"> <em class="mo">您可以在这里做</em> </strong> </a></p><div class="mx my gp gr mz na"><a rel="noopener  ugc nofollow" target="_blank" href="/stop-using-momentjs-for-dates-this-is-the-better-alternative-2709afb229a0"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">停止使用Moment.js来表示日期——这是更好的选择</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">在JavaScript中使用Date对象可能会非常麻烦！如果你没有使用现成的数据库，你可以…</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no jw na"/></div></div></a></div><div class="mx my gp gr mz na"><a href="https://blog.bitsrc.io/10-things-tips-i-would-tell-my-younger-self-as-a-frontend-developer-and-a-human-being-7959fb8eaf96" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">作为开发人员，我会给年轻时的自己10个建议</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">作为一名前端开发人员和一个普通人，我会给自己的10样东西！</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">blog.bitsrc.io</p></div></div><div class="nj l"><div class="np l nl nm nn nj no jw na"/></div></div></a></div><div class="mx my gp gr mz na"><a href="https://medium.com/front-end-weekly/a-closer-look-on-array-reduce-with-useful-examples-34f222664e66" rel="noopener follow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">通过有用的示例进一步了解array.reduce()</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">提高您的javascript技能，并通过一些有用的示例学习如何使用Array.prototype.reduce()</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">medium.com</p></div></div><div class="nj l"><div class="nq l nl nm nn nj no jw na"/></div></div></a></div><div class="mx my gp gr mz na"><a rel="noopener  ugc nofollow" target="_blank" href="/typescript-generics-explained-in-2-minutes-c95e49783347"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">用2分钟的时间用例子解释了类型脚本泛型</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">深入探究类型脚本泛型</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="nj l"><div class="nr l nl nm nn nj no jw na"/></div></div></a></div><p id="305c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="mo">如果你想找个时间和我聊聊，请关注我的</em></strong><a class="ae mp" href="https://twitter.com/nickycdk" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="mo">Twitter</em></strong></a><strong class="ka ir"><em class="mo">|</em></strong><a class="ae mp" href="https://www.linkedin.com/in/dknickychristensen/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="mo">LinkedIn</em></strong></a><strong class="ka ir"><em class="mo">或者直接访问我的</em> </strong> <a class="ae mp" href="https://nickychristensen.dk/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="mo">网站</em> </strong> </a> <strong class="ka ir"> <em class="mo">(丹麦文)<em class="mo"/></em></strong></p><p id="7609" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mo">更多内容请看</em><a class="ae mp" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="mo">plain English . io</em></strong></a><em class="mo">。报名参加我们的</em> <a class="ae mp" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="mo">免费每周简讯</em> </strong> </a> <em class="mo">。在我们的</em> <a class="ae mp" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="mo">社区不和谐</em> </strong> </a> <em class="mo">中获得独家写作机会和建议。</em></p></div></div>    
</body>
</html>