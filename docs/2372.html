<html>
<head>
<title>How Users Can Modify Your JavaScript Variables From Browser Console</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用户如何从浏览器控制台修改您的JavaScript变量</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/did-you-know-that-users-can-modify-your-javascript-variables-from-browser-console-e7537ce85d62?source=collection_archive---------7-----------------------#2022-06-02">https://javascript.plainenglish.io/did-you-know-that-users-can-modify-your-javascript-variables-from-browser-console-e7537ce85d62?source=collection_archive---------7-----------------------#2022-06-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="5c60" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">你不会相信弄乱客户端脚本有多容易。如果您也在前端使用JS进行后端调用，请继续阅读！</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/5ce911ad5b20c9151c519a95848e0746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1yntPy7Q_WbnBO27"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/es/@mitchel3uo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Mitchell Luo</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d16c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">几乎所有现在建立的网站都有一些JavaScript代码在里面运行。你不会相信弄乱这些脚本有多容易。如果您也使用客户端JS进行后端调用，请继续阅读！</p><p id="8c51" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">大多数浏览器中的JavaScript(在MS Edge和Chrome中测试)以这样的方式管理其内存分区，即显示的HTML文件中的<code class="fe lp lq lr ls b">console</code>和其余脚本将在相同的环境中运行。如果您想作为开发人员测试一些东西，比如变量的最终值，这是很好的。但是它会导致一些你可能不喜欢的用户行为。</p><p id="4f7d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">尤其是因为你所有的客户端代码都可以在开发者选项的“源代码”标签中轻松访问。看看<a class="ae ks" href="https://github.com" rel="noopener ugc nofollow" target="_blank">GitHub.com</a>的客户端源代码:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lt"><img src="../Images/070aabb8632ca52eafbc9c1a064c3aba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UALJT2C2AWJ7PeWg0lzpag.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Client-side Source Code of GitHub’s website</figcaption></figure><p id="b8ae" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我将向您展示一些可以演示问题的场景，然后讨论有助于降低相关风险的最佳实践。</p><p id="e241" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我将使用<code class="fe lp lq lr ls b">setTimeout</code>来模拟代码任何部分执行中的任何延迟。如果您的web应用程序进行API调用或执行某种复杂的处理，执行时间可能长达1秒，那么您的情况可能与这里显示的情况相匹配。</p><h1 id="035e" class="lu lv in bd lw lx ly lz ma mb mc md me jt mf ju mg jw mh jx mi jz mj ka mk ml bi translated">在HTML中访问浏览器变量<script/></h1><h2 id="b6ee" class="mm lv in bd lw mn mo dn ma mp mq dp me lc mr ms mg lg mt mu mi lk mv mw mk mx bi translated">从浏览器控制台引入变量</h2><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="5df4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您在浏览器中运行上面的文件，您将看到您所期望的:使用一个从未定义的变量的引用错误。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi na"><img src="../Images/a6e8d6f876e4a88eca0e81823c0eb2d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aOHjYCeslptu6W7jwh5hJw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Reference Error is thrown for trying to use an undefined variable</figcaption></figure><p id="292d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是看看如果我及时定义变量会发生什么:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi na"><img src="../Images/32e9c9b910f71d4eedba56bc27ef9ca3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mXzNJ6aLwZUzbsFvMsfe6g.gif"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Introducing a variable from the browser console</figcaption></figure><p id="3fcf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我进行了这个实验，看看控制台和脚本是否共享相同的内存空间。我认为他们不会，因为这可能会引起安全问题。但是当我看到输出时，</p><p id="fda9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="nb">我的脑子被炸了！</em></p><p id="1053" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我开始测试这个的极限。接下来，我尝试修改当前脚本使用的变量:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="b7f3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">就在我眼前，我看到自己用欺诈性的价值观攻击自己的代码:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi na"><img src="../Images/0007e0e4604f5f73823e0a7ebf0b8df3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*e_e8F8gY4Mumv7cTzEXHJA.gif"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Modifying a script variable from browser console</figcaption></figure><p id="ded2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以这显然是一个安全隐患！但真的是这样吗？我们做的大部分工作都是在函数内部。这也适用于函数中声明的变量吗？</p><h2 id="be2f" class="mm lv in bd lw mn mo dn ma mp mq dp me lc mr ms mg lg mt mu mi lk mv mw mk mx bi translated">改变函数中的变量</h2><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="41f7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是预期的输出:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi na"><img src="../Images/57e023f211465d6fa99e20ee888ac708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S2CFUW5JIlAe6uHsoDOaZA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">The expected output of the script without any intrusions</figcaption></figure><p id="22a9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这就是我试图弄乱<code class="fe lp lq lr ls b">function f1()</code>的变量时发生的事情:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi na"><img src="../Images/dbb7ab2c1a6203227210f5c72cb41948.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*A8G3Rb_2VnFOzhAmj7Hyog.gif"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">The browser console was not able to budge a `let` variable inside a function</figcaption></figure><p id="2117" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">像母亲一样，函数<code class="fe lp lq lr ls b">f1</code>保护了它的子变量！只要函数还活着，外人就永远无法破坏函数的变量。一旦函数开始执行，它将按预期工作。当然，如果函数在页面加载时没有立即开始执行，浏览器控制台攻击者可以重写整个函数(大多数应用程序都是这种情况)。</p><h2 id="b1df" class="mm lv in bd lw mn mo dn ma mp mq dp me lc mr ms mg lg mt mu mi lk mv mw mk mx bi translated">从浏览器控制台修改全部功能</h2><p id="fee1" class="pw-post-body-paragraph kt ku in kv b kw nc jo ky kz nd jr lb lc ne le lf lg nf li lj lk ng lm ln lo ig bi translated">我们的很多功能都是从用户交互中调用的。考虑:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="f4d4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">看看这位母亲在拯救她的孩子时是如何死去的:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi na"><img src="../Images/146ff0facdac1ce98eac5c6d16cb8502.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*J7E8lRQKO7y_ozFW10Do7g.gif"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Function definition perishes to the browser-console attacker</figcaption></figure><p id="5013" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">至少，母亲英勇地死去了…或者她死了吗？</p><p id="f7b6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe lp lq lr ls b">let</code>变量以及<code class="fe lp lq lr ls b">var</code>和<code class="fe lp lq lr ls b">const</code>变量的作用域受限于函数的定义，正如我们在本文中了解到的:</p><div class="nh ni gp gr nj nk"><a href="https://avikalpgupta.medium.com/var-let-const-and-undeclared-variables-in-javascript-32d3c72442ba" rel="noopener follow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd io gy z fp np fr fs nq fu fw im bi translated">JavaScript中的var、let、const和未声明的变量</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">关于JavaScript中不同的变量声明以及相关的最佳实践，您需要了解的一切…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">avikalpgupta.medium.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny km nk"/></div></div></a></div><p id="c26d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果我们在函数中使用了一个未声明的变量呢？该变量会给浏览器控制台攻击者带来风险吗？让我们看看。</p><h2 id="f001" class="mm lv in bd lw mn mo dn ma mp mq dp me lc mr ms mg lg mt mu mi lk mv mw mk mx bi translated">从浏览器控制台修改函数中的变量</h2><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="e385" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这里，<code class="fe lp lq lr ls b">a</code>显然是一个未声明的变量，而<code class="fe lp lq lr ls b">b</code>是用<code class="fe lp lq lr ls b">var</code>声明的。我们确信<code class="fe lp lq lr ls b">b</code>会受到保护，但是<code class="fe lp lq lr ls b">a</code>安全吗？</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi na"><img src="../Images/827274e5a3c189807dbbc4acaa0785ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yjLGaBoQGua-i8x2pijToA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Normal Expected output of the code</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi na"><img src="../Images/d6914e217a8a75ee85ab8a8e9147f234.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Dti2vV8lCA4HUPxeJ--TaQ.gif"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">When happens when we try to modify the variables inside the function</figcaption></figure><p id="9ce5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">正如我们所担心的，<code class="fe lp lq lr ls b">a</code>被修改了。</p><h1 id="ce36" class="lu lv in bd lw lx ly lz ma mb mc md me jt mf ju mg jw mh jx mi jz mj ka mk ml bi translated">如何编写安全的JavaScript客户端代码</h1><p id="0584" class="pw-post-body-paragraph kt ku in kv b kw nc jo ky kz nd jr lb lc ne le lf lg nf li lj lk ng lm ln lo ig bi translated">但是我们如何保护我们的代码免受这样的风险呢？从我们所做的实验来看，答案是清楚的！</p><h2 id="aa86" class="mm lv in bd lw mn mo dn ma mp mq dp me lc mr ms mg lg mt mu mi lk mv mw mk mx bi translated">保护变量</h2><ol class=""><li id="49a3" class="nz oa in kv b kw nc kz nd lc ob lg oc lk od lo oe of og oh bi translated">始终使用限定了作用域的变量！这意味着，总是声明你的变量(使用<code class="fe lp lq lr ls b">var</code>、<code class="fe lp lq lr ls b">let</code>或<code class="fe lp lq lr ls b">const</code>)。事实上，<a class="ae ks" href="https://medium.com/p/32d3c72442ba" rel="noopener">这篇文章</a>推荐我们在每种情况下都使用<code class="fe lp lq lr ls b">let</code>和<code class="fe lp lq lr ls b">const</code>。</li><li id="f4e1" class="nz oa in kv b kw oi kz oj lc ok lg ol lk om lo oe of og oh bi translated">使用<code class="fe lp lq lr ls b">const</code>定义不变参数以保证不变性。这甚至可以在全球范围内工作！这里有一个例子:</li></ol><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="5a99" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当浏览器控制台攻击者试图修改您的常量时，会发生以下情况:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi na"><img src="../Images/df5e4461780f7fb6a7dce432712b9de3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*UXO3YWgWWLwarJdaxlCJ1Q.gif"/></div></div></figure><p id="dd5b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">绝对安全！</p><h2 id="e2ff" class="mm lv in bd lw mn mo dn ma mp mq dp me lc mr ms mg lg mt mu mi lk mv mw mk mx bi translated">保护功能</h2><p id="dcb0" class="pw-post-body-paragraph kt ku in kv b kw nc jo ky kz nd jr lb lc ne le lf lg nf li lj lk ng lm ln lo ig bi translated">还是那句话，<code class="fe lp lq lr ls b">const</code>就是答案！与其直接定义函数，不如创建<strong class="kv io">匿名</strong>函数并将它们赋给<strong class="kv io">常量</strong>更安全。原因:</p><ol class=""><li id="5a30" class="nz oa in kv b kw kx kz la lc on lg oo lk op lo oe of og oh bi translated"><code class="fe lp lq lr ls b">const</code>会确保函数的常量值是不可变的</li><li id="cec9" class="nz oa in kv b kw oi kz oj lc ok lg ol lk om lo oe of og oh bi translated">分配一个匿名函数将确保您和您的团队成员只使用<code class="fe lp lq lr ls b">const</code>值来调用函数，而不是意外地调用函数名而不是它被分配到的<code class="fe lp lq lr ls b">const</code>。</li></ol><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="aa0c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">回想一下，我们也可以使用箭头语法来定义匿名函数:</p><pre class="kd ke kf kg gt oq ls or os aw ot bi"><span id="864c" class="mm lv in ls b gy ou ov l ow ox">const f1 = () =&gt; {<br/>    // function code here<br/>}</span></pre></div><div class="ab cl oy oz hr pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="ig ih ii ij ik"><h1 id="2c80" class="lu lv in bd lw lx pf lz ma mb pg md me jt ph ju mg jw pi jx mi jz pj ka mk ml bi translated">结论</h1><p id="e88f" class="pw-post-body-paragraph kt ku in kv b kw nc jo ky kz nd jr lb lc ne le lf lg nf li lj lk ng lm ln lo ig bi translated">在本文中，我们看到了对客户端JavaScript代码中的变量和函数可能进行的攻击。如果这些变量在任何API调用中被发送到后端，那么这些攻击会非常严重。我们看到了如何使用三个原则来保护我们的代码免受此类攻击:</p><ol class=""><li id="503f" class="nz oa in kv b kw kx kz la lc on lg oo lk op lo oe of og oh bi translated">始终声明您使用的任何变量(最好使用<code class="fe lp lq lr ls b">let</code>或<code class="fe lp lq lr ls b">const</code>)</li><li id="014d" class="nz oa in kv b kw oi kz oj lc ok lg ol lk om lo oe of og oh bi translated">确保任何全局可访问的值都被定义为<code class="fe lp lq lr ls b">const</code></li><li id="f782" class="nz oa in kv b kw oi kz oj lc ok lg ol lk om lo oe of og oh bi translated">将函数定义为分配给<code class="fe lp lq lr ls b">const</code>的匿名函数，尤其是在全局范围内。</li></ol></div><div class="ab cl oy oz hr pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="ig ih ii ij ik"><p id="fb7a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你喜欢这篇文章，请点击几下“拍手”按钮。与喜欢阅读它的朋友分享。</p><p id="0087" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我写关于网络开发、企业家精神和生产力的文章。如果你对这些话题感兴趣，可以考虑关注我。</p><p id="2bb3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="nb">更多内容看</em> <a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nb">说白了就是io </em> </strong> </a> <em class="nb">。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nb">免费周报</em> </strong> </a> <em class="nb">。关注我们关于</em><a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nb">Twitter</em></strong></a><em class="nb">和</em><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nb">LinkedIn</em></strong></a><em class="nb">。查看我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nb">社区不和谐</em> </strong> </a> <em class="nb">加入我们的</em> <a class="ae ks" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nb">人才集体</em> </strong> </a> <em class="nb">。</em></p></div></div>    
</body>
</html>