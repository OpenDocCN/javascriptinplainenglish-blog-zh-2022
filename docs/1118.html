<html>
<head>
<title>Build a Solid and Secure Login Workflow in NextJS with Strapi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Strapi在NextJS中构建一个可靠且安全的登录工作流</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-a-solid-and-secure-login-workflow-in-next-js-with-strapi-part-1-concept-and-setup-5155ebe622bb?source=collection_archive---------3-----------------------#2022-03-04">https://javascript.plainenglish.io/build-a-solid-and-secure-login-workflow-in-next-js-with-strapi-part-1-concept-and-setup-5155ebe622bb?source=collection_archive---------3-----------------------#2022-03-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0400" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第1部分:用NextJS和Strapi构建可靠、安全和可伸缩的登录系统的概念和设置。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/bf8690525d89572b9a1dc4806a65658a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bzq7WNSqKoAwMTf9CBWeDQ.png"/></div></div></figure><p id="1023" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在过去的3个月里，我们使用<a class="ln lo ep" href="https://medium.com/u/ace2e82e28e6?source=post_page-----5155ebe622bb--------------------------------" rel="noopener" target="_blank">Strapi</a>(【https://strapi.io/】T2)作为后端，在NextJS中从零开始构建了一个完整的电子商务，在这个开发过程中，我们遇到了一些问题，我们需要大量的试验和错误来实现我们一直在寻找的行为，因为Strapi(尤其是v. 4)并不总是很好地正确记录。无论如何，我们能够克服困难，我们记录了我们的发展道路。和我们的项目一样，我们从最烦人的任务开始:<strong class="kt ir">构建一个可靠、安全、可伸缩、可靠和可重用的登录工作流</strong></p><p id="86f3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Strapi 提供了一个内置的用户管理和登录系统，可以通过社交登录进行扩展。不幸的是，大部分教程都涉及了这个系统与外部库的使用(例如<a class="ae lp" rel="noopener ugc nofollow" target="_blank" href="/passwordless-authentication-in-next-js-with-nextauth-js-and-mongodb-19760c79184"> next-auth </a>)，并且文档并不总是与v. 4保持同步，所以我们决定在本教程中分享我们的经验。</p><p id="6cd2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">由于构建生产就绪的登录系统是一项漫长而复杂的任务，我们将本教程分为3个部分:</p><ul class=""><li id="d5ef" class="lq lr iq kt b ku kv kx ky la ls le lt li lu lm lv lw lx ly bi translated">第1部分:概念和设置</li><li id="9dce" class="lq lr iq kt b ku lz kx ma la mb le mc li md lm lv lw lx ly bi translated"><a class="ae lp" href="https://popeating.medium.com/build-a-solid-and-secure-login-workflow-in-next-js-with-strapi-part-2-register-and-login-4971cc7176f5" rel="noopener">第2部分:注册和登录</a></li><li id="ae12" class="lq lr iq kt b ku lz kx ma la mb le mc li md lm lv lw lx ly bi translated"><a class="ae lp" href="https://popeating.medium.com/build-a-solid-and-secure-login-workflow-in-next-js-with-strapi-part-3-social-login-and-password-7409bfad28fb" rel="noopener">第3部分:社交登录和密码重置</a></li></ul><p id="b839" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您还可以下载或克隆这个项目的存储库，以便跟进:</p><div class="me mf gp gr mg mh"><a href="https://github.com/popeating/fullcomm" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd ir gy z fp mm fr fs mn fu fw ip bi translated">GitHub - popeating/fullcomm</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">github.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv kp mh"/></div></div></a></div><h2 id="eecf" class="mw mx iq bd my mz na dn nb nc nd dp ne la nf ng nh le ni nj nk li nl nm nn no bi translated">基本概念</h2><p id="4966" class="pw-post-body-paragraph kr ks iq kt b ku np jr kw kx nq ju kz la nr lc ld le ns lg lh li nt lk ll lm ij bi translated">Strapi提供开箱即用的用户注册和登录功能(两者都使用社交网络提供商)。Strapi API为所有主要的登录任务(注册、登录、密码提醒等等)公开端点，一旦用户通过身份验证，Strapi提供一个JWT，可以用于所有其他可能需要它的请求(例如，在我们的例子中，通过身份验证的用户可以查询订单以获得他们过去的订单列表，或者通过身份验证的用户可以访问特殊优惠，情况是无限的)。它还提供了通过电子邮件确认注册的能力(我们使用了一部分，但在本教程中也有)。</p><p id="ccfc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如前所述，在成功登录后，Strapi向客户端发送回一个JWT，如果我们想要持久化我们的会话，我们需要存储它，并且我们需要将它安全地存储在一个httpOnly cookie中(<a class="ae lp" href="https://indepth.dev/posts/1382/localstorage-vs-cookies" rel="noopener ugc nofollow" target="_blank">更多关于http only cookie</a>)，这样它就可以被(例如)getServerSideProps访问。HttpOnly cookies只能由服务器设置，所以我们需要在我们的前端和Strapi后端之间有一个中间件来处理它。我们选择NextJS 中包含的<a class="ae lp" href="https://nextjs.org/docs/api-routes/introduction" rel="noopener ugc nofollow" target="_blank"> API路由，并且我们还使用了一个上下文来集中每个与登录相关的功能和状态。</a></p><p id="fbcc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">起初看起来很复杂，但是(在我们看来)这是处理登录过程最有效和最安全的方式。最基本的工作流程如下:</p><ul class=""><li id="f964" class="lq lr iq kt b ku kv kx ky la ls le lt li lu lm lv lw lx ly bi translated">带有登录表单的组件将通过上下文函数发布数据</li><li id="9f2e" class="lq lr iq kt b ku lz kx ma la mb le mc li md lm lv lw lx ly bi translated">上下文函数将获取数据，并将其发送到NextJS API</li><li id="e366" class="lq lr iq kt b ku lz kx ma la mb le mc li md lm lv lw lx ly bi translated">NextJS API将数据发送给Strapi API</li><li id="81d3" class="lq lr iq kt b ku lz kx ma la mb le mc li md lm lv lw lx ly bi translated">Strapi API验证数据并回复NextJS API(让我们假设这是一次成功的登录)</li><li id="7ce8" class="lq lr iq kt b ku lz kx ma la mb le mc li md lm lv lw lx ly bi translated">NextJS API读取响应，设置httpOnly cookie，并将确认发送回上下文</li><li id="6124" class="lq lr iq kt b ku lz kx ma la mb le mc li md lm lv lw lx ly bi translated">初始组件用登录的数据重新组合(或重定向到某个地方)</li></ul><h2 id="88e0" class="mw mx iq bd my mz na dn nb nc nd dp ne la nf ng nh le ni nj nk li nl nm nn no bi translated">工具和先决条件</h2><p id="bc46" class="pw-post-body-paragraph kr ks iq kt b ku np jr kw kx nq ju kz la nr lc ld le ns lg lh li nt lk ll lm ij bi translated">我们试图使用最少的库来开发这个项目，对于我们使用的前端(除了NextJS):</p><ul class=""><li id="b227" class="lq lr iq kt b ku kv kx ky la ls le lt li lu lm lv lw lx ly bi translated"><a class="ae lp" href="https://www.npmjs.com/package/axios" rel="noopener ugc nofollow" target="_blank"> axios </a>(访问API)</li><li id="1785" class="lq lr iq kt b ku lz kx ma la mb le mc li md lm lv lw lx ly bi translated"><a class="ae lp" href="https://react-hook-form.com/" rel="noopener ugc nofollow" target="_blank"> react-hook-form </a>(验证和管理表单)</li><li id="6951" class="lq lr iq kt b ku lz kx ma la mb le mc li md lm lv lw lx ly bi translated"><a class="ae lp" href="https://www.npmjs.com/package/cookie" rel="noopener ugc nofollow" target="_blank"> cookie </a>(解析并序列化cookie)</li><li id="a159" class="lq lr iq kt b ku lz kx ma la mb le mc li md lm lv lw lx ly bi translated"><a class="ae lp" href="https://tailwindcss.com/" rel="noopener ugc nofollow" target="_blank">顺风CSS </a>(造型用)</li></ul><p id="0073" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于后端，我们只使用了全新安装的Strapi v4</p><p id="789c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要跟进这个项目，您需要:</p><ul class=""><li id="8dbb" class="lq lr iq kt b ku kv kx ky la ls le lt li lu lm lv lw lx ly bi translated">良好的React和NextJS知识</li><li id="47e6" class="lq lr iq kt b ku lz kx ma la mb le mc li md lm lv lw lx ly bi translated">对反应环境有很好的理解，</li><li id="9af6" class="lq lr iq kt b ku lz kx ma la mb le mc li md lm lv lw lx ly bi translated">熟悉NextJS API路线</li><li id="08bc" class="lq lr iq kt b ku lz kx ma la mb le mc li md lm lv lw lx ly bi translated">Strapi的基本知识</li><li id="b376" class="lq lr iq kt b ku lz kx ma la mb le mc li md lm lv lw lx ly bi translated">顺风CSS的基础知识</li><li id="8336" class="lq lr iq kt b ku lz kx ma la mb le mc li md lm lv lw lx ly bi translated">对登录工作流程有很好的了解</li><li id="c00b" class="lq lr iq kt b ku lz kx ma la mb le mc li md lm lv lw lx ly bi translated">已安装SQLite数据库</li></ul><h2 id="8dac" class="mw mx iq bd my mz na dn nb nc nd dp ne la nf ng nh le ni nj nk li nl nm nn no bi translated">安装和配置Strapi</h2><p id="517c" class="pw-post-body-paragraph kr ks iq kt b ku np jr kw kx nq ju kz la nr lc ld le ns lg lh li nt lk ll lm ij bi translated">我们将Strapi和NextJS安装在同一个本地机器上，但是它可以稍后部署在不同的服务器上，或者部署在具有不同端口或域名的同一台服务器上。</p><p id="4b89" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用默认的SQLite数据库安装Strapi 的<a class="ae lp" href="https://docs.strapi.io/developer-docs/latest/getting-started/quick-start.html" rel="noopener ugc nofollow" target="_blank">新副本</a></p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="72d5" class="mw mx iq nv b gy nz oa l ob oc"><strong class="nv ir">npx create-strapi-app@latest my-project --quickstart</strong></span></pre><p id="4950" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">安装完成后，打开地址<code class="fe od oe of nv b">http://localhost:1337/admin</code>并配置您的用户。</p><p id="7226" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">转到设置-&gt;高级设置:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/e0ff591d9765c91e166bccba478b0e8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wSO7Z3K2RNc5NTJhv-MAVg.png"/></div></div></figure><p id="15eb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并激活“启用注册”和“启用电子邮件确认”，还将<em class="oh">重置密码页面</em>设置为<code class="fe od oe of nv b">http://localhost:3000/user/resetpassword</code>并将<em class="oh">重定向url </em>设置为<code class="fe od oe of nv b">http://localhost:3000/user</code>(稍后将详细介绍)。</p><p id="2935" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，转到设置-&gt;角色，并选择公共:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/ed4b037145beda680122edfcaa3591c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zR15aDA3OQwwhE4J7oakvw.png"/></div></div></figure><p id="8d97" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<em class="oh">授权</em>部分选择<em class="oh">用户-权限</em>并全部启用。<br/>返回角色并选择已验证:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/e352baef3281270c2bf654d3ce376b88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0teTLEG6atz15Cbyyouzww.jpeg"/></div></div></figure><p id="26b7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<em class="oh">用户权限</em>部分至少为用户启用“me”端点</p><p id="6595" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为Strapi配置电子邮件插件，您需要创建(或者编辑，如果已经存在的话)一个配置文件<code class="fe od oe of nv b">/config/plugin.js</code>。</p><p id="ba0c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是我们使用sendmail的配置(你可以在<a class="ae lp" href="https://docs.strapi.io/developer-docs/latest/plugins/email.html#configure-the-plugin" rel="noopener ugc nofollow" target="_blank">https://docs . strapi . io/developer-docs/latest/plugins/email . html # configure-the-plugin</a>上找到更多关于配置电子邮件插件的信息)。<br/>请务必添加真实的电子邮件地址</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="e381" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">服务器重新启动后，通过进入设置-&gt;电子邮件插件-&gt;配置并发送测试电子邮件来检查配置是否正常:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/a5dbcfb8508ac15c527bd46fe6709dc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qgv2TFEZvzdr1hJrnQ3Anw.jpeg"/></div></div></figure><p id="9440" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您还需要在设置-&gt;电子邮件模板中配置电子邮件模板。您应该配置一个真实的电子邮件地址，以便一切正常工作。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/ce41aa2d2239cec7b9bc59d1f0bae7a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EjDrZXZJwfHYSkWQhjgu2A.jpeg"/></div></div></figure><p id="c381" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">配置谷歌登录</strong></p><p id="97f6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您希望您的用户使用第三方提供商(如谷歌或脸书)登录，您需要在Strapi中使用您需要在登录提供商网站上获得的一些数据来配置它。在本指南中，我将展示如何配置谷歌登录和脸书登录，但基本上，每个供应商将遵循相同的模式。<br/>进入<a class="ae lp" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>，使用你的谷歌凭证登录或注册。<br/>创建一个新项目，并随意命名(我们使用了nextLogin):</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/390d05b3e42e3b309120a010b55bdd7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8dL5XN2uZrYTcsMgif9-ig.jpeg"/></div></div></figure><p id="39e4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">项目准备就绪后，选择它并转到API &amp; Services dashboard:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/e13983cf527dce18abb8d1037f79c422.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v_YCb4Ef7i6qxGMm965y5g.jpeg"/></div></div></figure><p id="09e5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">配置OAuth同意屏幕，选择外部并填写所有必填字段，当请求时添加以下范围:。<em class="oh"> /auth/userinfo.email </em>和<em class="oh">。/auth/userinfo.profile，</em>保存，然后点击“发布应用”发布应用</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/775a9bcc19a31fb54ad3c73a5e0af2fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yqgPTAkL5q388BMOAt4klg.png"/></div></div></figure><p id="190d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">点击<em class="oh">凭证</em>创建凭证，然后点击<em class="oh">创建凭证</em>并选择OAuth客户端ID</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/bffa1c0e48d2a22a7f5cae43d003522c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BtbxP2b7huBCnDImIUOSDw.jpeg"/></div></div></figure><p id="ffe0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">填写必填信息，添加<code class="fe od oe of nv b">http://localhost:1337/api/connect/google/callback</code>为授权重定向URI</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/4aa56b9c106c71d3d4743fafc1ebebad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p47_Ir36bnnOYOCmjihzkQ.jpeg"/></div></div></figure><p id="ffe2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">保存并获取凭证(客户端ID和客户端密码)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/6f10df37b51a7b7c4a9690746a224d82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fYZKBdY53oz6GwGuazP8jQ.jpeg"/></div></div></figure><p id="cc7e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有了凭证，回到你的Strapi面板，进入设置-&gt;提供商并启用谷歌:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/4d04cfc7d9337e63036a626318e05333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7hkk_-WVrCiJx0RhdlmeBg.png"/></div></div></figure><p id="27b3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">粘贴客户端ID、客户端密码，将重定向URL设置为<code class="fe od oe of nv b">http://localhost:3000/user/googleCallback</code>(这将是Strapi API稍后使用Google提供的访问令牌调用的页面)，并检查您添加到云控制台的重定向URL是否与此处显示的相同。</p><p id="d47c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">配置脸书登录</strong></p><p id="5839" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">脸书登录配置非常相似，你需要在<a class="ae lp" href="https://developers.facebook.com/" rel="noopener ugc nofollow" target="_blank"> Meta上为开发者</a>创建一个新的消费应用(或者使用你已经有的应用)。</p><p id="7538" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">登录后，点击“创建应用”，然后选择“消费者”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/74471b7735ae568985771098e063f805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pKQmg7a2AMAxlDtFgznCOw.png"/></div></div></figure><p id="cd3b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在表格中填写所需信息，然后选择“脸书登录”作为产品:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/fa94f676c5ebac68606f080aee99742d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w8PrT8gWhCEvAvKCusOs8w.png"/></div></div></figure><p id="4860" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在接下来的步骤中，选择Web，将域设置为<code class="fe od oe of nv b">http://localhost:3000</code>并保存，您现在可以点击菜单<em class="oh">设置- &gt;基本</em>，在这里您可以获得您的应用ID和应用密码:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/efe784ad4e2966d5e88283572c69d0b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-vdYLiV03JyF135o_lyFqg.png"/></div></div></figure><p id="7b5a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦你得到了它们，回到Strapi并像你为Google所做的那样配置脸书:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/903bf38ccf9802d641a1c060054524cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EJl8V1IoCCkn9a7ori4ONQ.png"/></div></div></figure><p id="116a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这次使用<code class="fe od oe of nv b">http://localhost:3000/user/facebookCallback</code>作为你的重定向网址。</p><p id="a68f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您需要配置更多的提供者，只需遵循这种模式:在提供者站点上创建密钥，将它们添加到Strapi，如果提供者需要回调URL，您可以在Strapi前端重定向URL中使用<code class="fe od oe of nv b">http://localhost:1337/connect/[provider]/callback</code> <br/>，使用类似于<code class="fe od oe of nv b">http://localhost:3000/user/[provider]Callback</code>(每个提供者都需要一个这样的URL)。</p><h2 id="440e" class="mw mx iq bd my mz na dn nb nc nd dp ne la nf ng nh le ni nj nk li nl nm nn no bi translated">设置和配置NextJS</h2><p id="beb4" class="pw-post-body-paragraph kr ks iq kt b ku np jr kw kx nq ju kz la nr lc ld le ns lg lh li nt lk ll lm ij bi translated">我们从一个新的NextJS应用程序开始，使用这个命令创建一个应用程序(随意更改应用程序名称)</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="2c31" class="mw mx iq nv b gy nz oa l ob oc">npx create-next-app fullcomm</span></pre><p id="6f9a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">安装所需的模块:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="f04e" class="mw mx iq nv b gy nz oa l ob oc">npm install axios<br/>npm install cookie<br/>npm install react-hook-form</span></pre><p id="d9c3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">安装和配置顺风CSS:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="6200" class="mw mx iq nv b gy nz oa l ob oc">npm install -D tailwindcss postcss autoprefixer<br/>npx tailwindcss init -p<br/>npm install @tailwindcss/forms</span></pre><p id="d5c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">编辑tailwind.config.js，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="2c6d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">清空文件<code class="fe od oe of nv b">style/global.css</code>,添加以下几行:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="78af" class="mw mx iq nv b gy nz oa l ob oc">@tailwind base;<br/>@tailwind components;<br/>@tailwind utilities;</span></pre><p id="8fe9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">清洁文件<code class="fe od oe of nv b">pages/index.js</code>并保持如下状态:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="4d4b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">删除<code class="fe od oe of nv b">pages/api/hello.js</code>和<code class="fe od oe of nv b">styles/Home.module.css</code>，从<code class="fe od oe of nv b">pages/_app.js</code>中删除其引用</p><p id="bd24" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创建<code class="fe od oe of nv b">.env.local</code>并向其添加以下行:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="fbdc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这样你应该有一个空白的画布来开始编码。<br/>运行<code class="fe od oe of nv b">npm run dev</code>如果一切正确，如果你打开地址<code class="fe od oe of nv b">http://localhost:3000</code>你应该得到一个白色的页面，上面有家。</p><p id="0e9a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，我们将准备一个用于初始化所有axios连接的实用程序，创建文件<code class="fe od oe of nv b">lib/api.js</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="8276" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们基本上导出了两个初始化axios的函数，以连接到Strapi ( <em class="oh"> instance </em>)和连接到NextJS API ( <em class="oh"> linstance </em>)。每当我们需要获取或发送到API端点时，这两个连接将与我们的项目一起使用。</p><p id="5e6d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我们开始编码之前，我们需要设置一个上下文(<a class="ae lp" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank">https://reactjs.org/docs/context.html</a>)，它将包装我们所有的应用程序，这个上下文将保存所有的数据、状态、功能、偏好等等，这些都将对我们所有的页面和组件可用。</p><p id="fe2c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们从在<code class="fe od oe of nv b">context/user.js</code>中创建一个空的提供者开始:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="fdb7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们创建了一个<em class="oh"> dummy </em>状态和一个<em class="oh"> dummyfunction </em>，它们将可用于项目中的所有页面和组件，我们还导入了<em class="oh"> linstance </em>，因为稍后我们将向需要它的提供者添加更多的函数(例如登录和注销函数)。<br/>为了将提供者传播给所有孩子，我们需要将我们的应用程序包装在其中，这可以通过修改<code class="fe od oe of nv b">pages/_app.js</code>，通过导入<code class="fe od oe of nv b">UserProvider</code>并将应用程序包装在其中来实现:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="cf97" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们选择将所有与用户相关的操作保存在一个上下文中，这样我们就可以在任何时候从任何组件中访问它们，不管它是如何嵌套的。例如，我们将在上下文中有一个函数，它将检查用户是否登录，每次我们需要时，可以从每个页面或单个组件调用它。我们还遵循一种设计，其中所有上下文函数在<em class="oh"> return </em>中发送回复，并且不执行任何动作(如重定向或接口修改)，这样任何组件或页面都负责获得响应、对其进行处理并执行所需的动作。</p><p id="47b1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在下一部分，我们将开始编写我们的应用程序，我们将允许用户注册到我们的网站，并在确认电子邮件地址后使用用户名(或电子邮件)和密码登录。</p><p id="18f6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="oh">更多内容请看</em><a class="ae lp" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="oh">plain English . io</em></strong></a><em class="oh">。报名参加我们的</em> <a class="ae lp" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="oh">免费周报</em> </strong> </a> <em class="oh">。关注我们关于</em><a class="ae lp" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="oh">Twitter</em></strong></a><em class="oh">和</em><strong class="kt ir"><em class="oh"/></strong><a class="ae lp" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="oh">LinkedIn</em></strong></a><em class="oh">。加入我们的</em> <a class="ae lp" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="oh">社区</em> </strong> </a> <em class="oh">。</em></p></div></div>    
</body>
</html>