<html>
<head>
<title>The File System Access API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">文件系统访问API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-file-system-access-api-385379cd16f6?source=collection_archive---------7-----------------------#2022-01-28">https://javascript.plainenglish.io/the-file-system-access-api-385379cd16f6?source=collection_archive---------7-----------------------#2022-01-28</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><figure class="gm go jp jq jr js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj jo"><img src="../Images/3701c6cbc37268aed4b7debbcd9e7ae4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bzwjt1l9mbEr_kq_"/></div></div><figcaption class="jz ka gk gi gj kb kc bd b be z dk">Photo by <a class="ae kd" href="https://unsplash.com/@heapdump?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Patrick Lindenberg</a> on <a class="ae kd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3043" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">我在这里转载我的一篇旧文章。第一次出版是在2021年2月的<a class="ae kd" href="https://www.patreon.com/posts/file-system-api-47257691" rel="noopener ugc nofollow" target="_blank">帕特里翁。我将在一篇新文章中提到它，所以没有人必须通过</a><a class="ae kd" href="https://www.patreon.com/posts/file-system-api-47257691" rel="noopener ugc nofollow" target="_blank"> Patreon </a>来阅读它。</p><p id="1eb9" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">本周，我玩了一下<code class="fe lc ld le lf b">File System Access API</code>:这个功能允许你创建可以与用户本地设备上的文件进行交互的web应用。用户授予web应用程序访问权限后，该API允许他们直接读取或保存对用户设备上的文件和文件夹的更改。</p><p id="5d4f" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">我想用Construct 3复制一个文本编辑器，其功能类似于由<a class="ae kd" href="https://github.com/GoogleChromeLabs" rel="noopener ugc nofollow" target="_blank"> Google Chrome Labs </a>开发的编辑器(<a class="ae kd" href="https://googlechromelabs.github.io/text-editor/" rel="noopener ugc nofollow" target="_blank">文本编辑器</a>)。我也遵循了这个指南:<a class="ae kd" href="https://web.dev/file-system-access/" rel="noopener ugc nofollow" target="_blank"> <em class="lg">文件系统访问API:简化对本地文件的访问</em> </a>。</p><p id="7fac" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">当然，我也在<a class="ae kd" href="https://github.com/el3um4s" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上分享了整件事。</p><p id="f337" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">让我们开始:</p><figure class="li lj lk ll gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj lh"><img src="../Images/e60dcf8a2a4f6b12d7b80f35cab48b49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lJM9f8h1RqiOy7Zw3yBS5Q.jpeg"/></div></div></figure><p id="183f" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">现在，我省略了使用<code class="fe lc ld le lf b">File System Access API</code>的一些“边缘”方面，并把重点放在两个模块上:<code class="fe lc ld le lf b"><a class="ae kd" href="https://github.com/el3um4s/construct-demo/blob/master/javascript/008-text-editor/source/files/scripts/managefiles.js" rel="noopener ugc nofollow" target="_blank">manageFiles.js</a></code>和<code class="fe lc ld le lf b"><a class="ae kd" href="https://github.com/el3um4s/construct-demo/blob/master/javascript/008-text-editor/source/files/scripts/filesystemaccess.js" rel="noopener ugc nofollow" target="_blank">fileSystemAccess.js</a></code>。在最后你可以找到一些功能:</p><ul class=""><li id="cc2e" class="lm ln ir kg b kh ki kl km kp lo kt lp kx lq lb lr ls lt lu bi translated">打开文件</li><li id="f7a3" class="lm ln ir kg b kh lv kl lw kp lx kt ly kx lz lb lr ls lt lu bi translated">写</li><li id="c7f2" class="lm ln ir kg b kh lv kl lw kp lx kt ly kx lz lb lr ls lt lu bi translated">保存方式</li><li id="4318" class="lm ln ir kg b kh lv kl lw kp lx kt ly kx lz lb lr ls lt lu bi translated">保存文件</li><li id="bf85" class="lm ln ir kg b kh lv kl lw kp lx kt ly kx lz lb lr ls lt lu bi translated">loadFromFile</li><li id="34c8" class="lm ln ir kg b kh lv kl lw kp lx kt ly kx lz lb lr ls lt lu bi translated">getNewFileHandle</li></ul><h1 id="c82d" class="ma mb ir bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">打开文件</h1><figure class="li lj lk ll gu js"><div class="bz fq l di"><div class="my mz l"/></div></figure><p id="612b" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">为了简单起见，我省略了对错误处理的解释。切入点是<code class="fe lc ld le lf b"><a class="ae kd" href="https://wicg.github.io/file-system-access/#api-showopenfilepicker" rel="noopener ugc nofollow" target="_blank">window.showOpenFilePicker()</a></code>。当被调用时，它显示一个文件选择器对话框，并提示用户选择一个文件。在他们选择一个文件后，API返回一个文件句柄数组。可选参数允许您影响文件选取器的行为，例如，允许用户选择多个文件、目录或不同的文件类型。在没有指定任何选项的情况下，文件选取器允许用户选择单个文件。</p><figure class="li lj lk ll gu js"><div class="bz fq l di"><div class="my mz l"/></div></figure><p id="0336" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">我将一个数组<code class="fe lc ld le lf b"><a class="ae kd" href="https://wicg.github.io/file-system-access/#filesystemfilehandle" rel="noopener ugc nofollow" target="_blank">FileSystemFileHandle</a></code>赋给<code class="fe lc ld le lf b">Globals.fileHandle</code>。在本例中，它是一个单元素数组，包含与文件交互所需的属性和方法。</p><p id="003c" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated"><strong class="kg is">注意:</strong>我还没有实现跟踪所有打开文件的方法，但只有一个。然而，这样做将允许你实现一个最近文件列表<em class="lg">作为打开你最近处理的文件的快捷方式。</em></p><p id="edf0" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">现在，从句柄中，您可以通过</p><figure class="li lj lk ll gu js"><div class="bz fq l di"><div class="my mz l"/></div></figure><p id="b226" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">然后你可以阅读它的内容。</p><figure class="li lj lk ll gu js"><div class="bz fq l di"><div class="my mz l"/></div></figure><h1 id="3d8e" class="ma mb ir bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">写</h1><figure class="li lj lk ll gu js"><div class="bz fq l di"><div class="my mz l"/></div></figure><p id="2b86" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">第二个功能是<code class="fe lc ld le lf b">write</code>，允许你将文本修改直接保存到文件中。为此，您可以使用<code class="fe lc ld le lf b"><a class="ae kd" href="https://wicg.github.io/file-system-access/#api-filesystemwritablefilestream" rel="noopener ugc nofollow" target="_blank">FileSystemWritableFileStream</a></code>接口。然后，您可以通过调用</p><figure class="li lj lk ll gu js"><div class="bz fq l di"><div class="my mz l"/></div></figure><p id="2e05" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">现在，您可以将文件的内容写入流中。</p><figure class="li lj lk ll gu js"><div class="bz fq l di"><div class="my mz l"/></div></figure><p id="b92d" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">最后你可以关闭文件并将内容写入磁盘:<code class="fe lc ld le lf b">await writable.close()</code>。</p><p id="00db" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated"><strong class="kg is">注意</strong>:在流关闭之前，更改不会写入磁盘。</p><h1 id="53ca" class="ma mb ir bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">保存方式</h1><figure class="li lj lk ll gu js"><div class="bz fq l di"><div class="my mz l"/></div></figure><p id="0083" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">从现在开始一切都简单了。<em class="lg">另存为</em>使用<code class="fe lc ld le lf b">getNewFileHandle()</code>获取文件名和保存文件的位置。然后你可以调用<code class="fe lc ld le lf b">write()</code>来...写文件。</p><h1 id="835b" class="ma mb ir bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">保存文件</h1><figure class="li lj lk ll gu js"><div class="bz fq l di"><div class="my mz l"/></div></figure><p id="c91b" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated"><code class="fe lc ld le lf b">saveFile</code>更简单。如果你正在编辑一个文件，它叫做<code class="fe lc ld le lf b">write</code>。如果你正在处理一个新文件，它叫做<code class="fe lc ld le lf b">saveAs</code>。</p><h1 id="a43b" class="ma mb ir bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">loadFromFile</h1><figure class="li lj lk ll gu js"><div class="bz fq l di"><div class="my mz l"/></div></figure><p id="05a8" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">最后<code class="fe lc ld le lf b">loadFromFile</code>将文件重新加载到上次保存之前的状态。</p><p id="c701" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">就这样，我完成了基本结构。然而，没有简单的方法将所有这些与我们的编辑器集成。为此，您需要一个新模块:<code class="fe lc ld le lf b">manageFiles.js</code>。</p><h1 id="67cb" class="ma mb ir bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">manager files . js</h1><figure class="li lj lk ll gu js"><div class="bz fq l di"><div class="my mz l"/></div></figure><p id="0443" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">我只关注两个功能，<code class="fe lc ld le lf b">insertText</code>和<code class="fe lc ld le lf b">getText</code>。他们都使用</p><figure class="li lj lk ll gu js"><div class="bz fq l di"><div class="my mz l"/></div></figure><p id="28d2" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">此代码允许您访问构造3文本框。第一个修改包含的文本，第二个读取它。这是允许C3正确显示元素内容所必需的。</p><p id="387c" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">以下函数除了通过连接到实际编辑器来调用<code class="fe lc ld le lf b">FileSystemAccess</code>模块的函数外，什么也不做。</p><p id="3f8b" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated">感谢阅读！敬请关注更多内容。</p></div><div class="ab cl na nb hv nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ik il im in io"><p id="9ef0" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated"><strong class="kg is"> <em class="lg">不要错过我的下一篇文章——注册我的</em> </strong> <a class="ae kd" href="https://medium.com/subscribe/@el3um4s" rel="noopener"> <strong class="kg is"> <em class="lg">中型邮件列表</em> </strong> </a></p><div class="nh ni gq gs nj nk"><a href="https://el3um4s.medium.com/membership" rel="noopener follow" target="_blank"><div class="nl ab fp"><div class="nm ab nn cl cj no"><h2 class="bd is gz z fq np fs ft nq fv fx iq bi translated">使用我的推荐链接— Samuele加入Medium</h2><div class="nr l"><h3 class="bd b gz z fq np fs ft nq fv fx dk translated">读一读萨缪尔(以及Medium上成千上万其他作家)的所有故事。不是中型成员？加入这里，一块…</h3></div><div class="ns l"><p class="bd b dl z fq np fs ft nq fv fx dk translated">el3um4s.medium.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny jx nk"/></div></div></a></div></div><div class="ab cl na nb hv nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ik il im in io"><p id="9e15" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated"><em class="lg">原载于2021年2月8日</em><a class="ae kd" href="https://blog.stranianelli.com/file-system-access-api-english/" rel="noopener ugc nofollow" target="_blank"><em class="lg">https://blog.stranianelli.com</em></a>。</p><p id="3a1d" class="pw-post-body-paragraph ke kf ir kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ik bi translated"><em class="lg">多内容于</em> <a class="ae kd" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kg is"> <em class="lg">通俗易懂</em> </strong> </a> <em class="lg">。报名参加我们的</em> <a class="ae kd" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kg is"> <em class="lg">免费周报</em> </strong> </a> <em class="lg">。在我们的</em> <a class="ae kd" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kg is"> <em class="lg">社区不和谐</em> </strong> </a> <em class="lg">获得独家写作机会和建议。</em></p></div></div>    
</body>
</html>