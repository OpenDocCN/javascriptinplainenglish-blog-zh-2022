<html>
<head>
<title>How to Parse Excel files with JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用JavaScript解析Excel文件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-parse-excel-files-with-javascript-114752b6aa1d?source=collection_archive---------2-----------------------#2022-12-12">https://javascript.plainenglish.io/how-to-parse-excel-files-with-javascript-114752b6aa1d?source=collection_archive---------2-----------------------#2022-12-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/533cb861bfb892d022a73923bafd65c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HQjSGvXXEefBdtOZop6SMw.png"/></div></div></figure><p id="1e96" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">今天，我们来谈谈如何使用JS来解析excel文件。当然，直接使用诸如<a class="ae kw" href="https://www.npmjs.com/package/exceljs" rel="noopener ugc nofollow" target="_blank"> exceljs </a>和<a class="ae kw" href="https://sheetjs.com/" rel="noopener ugc nofollow" target="_blank"> SheetJS </a>之类的库并不有趣。相反，我们来谈谈JS如何解析Excel表。</p><p id="8810" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，本文主要讨论xlsx格式的Excel表格，并未探讨其他格式。</p><h2 id="3e40" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">什么是excel电子表格文件</h2><p id="81a0" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">首先，要解析excel文件，您必须首先了解它是如何存储数据的。经过各种可能的搜索，我终于在GG中找到了答案:excel文件实际上是一个zip包！所以我很快创建了一个新的xlsx文件，并在其中创建了两张新的工作表。两页资料如下:<br/>这是第1页:</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/32fe39f69abf5ae2b2fc679c9daa2906.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*WLe1fTJv3nsFjTwtgJnLyg.png"/></div></figure><p id="f571" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是第2页:</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/02c8067e48a0f2415cda9338c71cac9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:564/format:webp/1*O7F27XPYzjOCYnkhuvR6HA.png"/></div></figure><p id="42e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后使用zip解压缩:</p><pre class="lw lx ly lz gt mb mc md bn me mf bi"><span id="8c78" class="mg ky iq mc b be mh mi l mj mk">unzip test.xlsx -d test</span></pre><p id="f31f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后通过树我们得到这样一个目录结构:</p><pre class="lw lx ly lz gt mb mc md bn me mf bi"><span id="3ff1" class="mg ky iq mc b be mh mi l mj mk">test<br/>├── [Content_Types].xml<br/>├── _rels<br/>├── docProps<br/>│   ├── app.xml<br/>│   ├── core.xml<br/>│   └── custom.xml<br/>└── xl<br/>    ├── _rels<br/>    │   └── workbook.xml.rels<br/>    ├── sharedStrings.xml<br/>    ├── styles.xml<br/>    ├── theme<br/>    │   └── theme1.xml<br/>    ├── workbook.xml<br/>    └── worksheets<br/>        ├── sheet1.xml<br/>        └── sheet2.xml</span></pre><p id="1129" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">啊哈，干得好，都是xml文件。</p><p id="8ec1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我们打开xml进行查找时，我们可以看到有几个非常显眼的文件，即工作表下的sheet1.xml和sheet2.xml，以及workbook.xml。其他样式和主题乍一看与样式相关，_rels感觉就像是内部引用。让我们先看看这两张纸的xml文件，看看猜测是否正确。粘贴工作表1.xml:</p><pre class="lw lx ly lz gt mb mc md bn me mf bi"><span id="e6b7" class="mg ky iq mc b be mh mi l mj mk">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;<br/>&lt;worksheet <br/>    xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"<br/>    xmlns:xdr="http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing"<br/>    xmlns:x14="http://schemas.microsoft.com/office/spreadsheetml/2009/9/main"<br/>    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"<br/>    xmlns:etc="http://www.wps.cn/officeDocument/2017/etCustomData"&gt;<br/>    &lt;sheetPr/&gt;<br/>    &lt;dimension ref="A1:C7"/&gt;<br/>    &lt;sheetViews&gt;<br/>        &lt;sheetView workbookViewId="0"&gt;<br/>            &lt;selection activeCell="D5" sqref="A3:D5"/&gt;<br/>        &lt;/sheetView&gt;<br/>    &lt;/sheetViews&gt;<br/>    &lt;sheetFormatPr defaultColWidth="9.23076923076923" defaultRowHeight="16.8" outlineLevelRow="6" outlineLevelCol="2"/&gt;<br/>    &lt;sheetData&gt;<br/>        &lt;row r="1" spans="1:3"&gt;<br/>            &lt;c r="A1"&gt;<br/>                &lt;v&gt;1&lt;/v&gt;<br/>            &lt;/c&gt;<br/>            &lt;c r="C1"&gt;<br/>                &lt;v&gt;2&lt;/v&gt;<br/>            &lt;/c&gt;<br/>        &lt;/row&gt;<br/>        &lt;row r="2" spans="1:3"&gt;<br/>            &lt;c r="A2"&gt;<br/>                &lt;v&gt;1&lt;/v&gt;<br/>            &lt;/c&gt;<br/>            &lt;c r="C2"&gt;<br/>                &lt;v&gt;2&lt;/v&gt;<br/>            &lt;/c&gt;<br/>        &lt;/row&gt;<br/>        &lt;row r="6" spans="1:3"&gt;<br/>            &lt;c r="A6"&gt;<br/>                &lt;v&gt;1&lt;/v&gt;<br/>            &lt;/c&gt;<br/>            &lt;c r="C6"&gt;<br/>                &lt;v&gt;2&lt;/v&gt;<br/>            &lt;/c&gt;<br/>        &lt;/row&gt;<br/>        &lt;row r="7" spans="1:3"&gt;<br/>            &lt;c r="A7"&gt;<br/>                &lt;v&gt;1&lt;/v&gt;<br/>            &lt;/c&gt;<br/>            &lt;c r="C7"&gt;<br/>                &lt;v&gt;2&lt;/v&gt;<br/>            &lt;/c&gt;<br/>        &lt;/row&gt;<br/>    &lt;/sheetData&gt;<br/>    &lt;pageMargins left="0.75" right="0.75" top="1" bottom="1" header="0.5" footer="0.5"/&gt;<br/>    &lt;headerFooter/&gt;<br/>&lt;/worksheet&gt;</span></pre><p id="6115" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我相信每个人都看过了，sheetData是excel表中的数据，<row>代表行，其中r是行号的索引，行中的<c>应该是单元格，而<v>对应于单元格中的值，r是单元格的位置，比如A7代表a列中的第7行。<br/>另外还有几个很明显的属性，比如dimension，可以看作是表的大小范围，从A1单元格到C7单元格形成一个方框。&lt;工作表视图&gt;应存储页面上的信息，而&lt;选择&gt;应代表所选表格的内容。<br/>工作簿存储工作表信息:</v></c></row></p><pre class="lw lx ly lz gt mb mc md bn me mf bi"><span id="b783" class="mg ky iq mc b be mh mi l mj mk">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;<br/>&lt;workbook <br/>    xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"&gt;<br/>    &lt;fileVersion appName="xl" lastEdited="3" lowestEdited="5" rupBuild="9302"/&gt;<br/>    &lt;workbookPr/&gt;<br/>    &lt;bookViews&gt;<br/>        &lt;workbookView windowHeight="16360" activeTab="1"/&gt;<br/>    &lt;/bookViews&gt;<br/>    &lt;sheets&gt;<br/>        &lt;sheet name="Sheet1" sheetId="1" r:id="rId1"/&gt;<br/>        &lt;sheet name="Sheet2" sheetId="2" r:id="rId2"/&gt;<br/>    &lt;/sheets&gt;<br/>    &lt;calcPr calcId="144525"/&gt;<br/>&lt;/workbook&gt;</span></pre><p id="1eda" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在查看了剩余的几个XML之后，存储的信息非常清晰，例如:</p><pre class="lw lx ly lz gt mb mc md bn me mf bi"><span id="b6ea" class="mg ky iq mc b be mh mi l mj mk">· The information of the file program and the file name are stored in the app<br/>· The author's information and creation and modification time are saved in core<br/>· The rels file is also in xml format, storing some other xml references<br/>· theme stores the colors and fonts defined in the table<br/>· [Content_Types] contains references to all files, which are estimated to be parsed entry files</span></pre><h1 id="fdad" class="ml ky iq bd kz mm mn mo lc mp mq mr lf ms mt mu li mv mw mx ll my mz na lo nb bi translated">JS实现步骤</h1><p id="5dad" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">既然我们已经知道了excel文件是如何存储数据的，那么我们就很清楚如何使用js来解析它。主要有三个步骤:</p><ol class=""><li id="14d4" class="nc nd iq ka b kb kc kf kg kj ne kn nf kr ng kv nh ni nj nk bi translated">使用js解压缩excel文件</li><li id="ee0c" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">获取工作表文件的内容，然后解析xml数据</li><li id="6179" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">将数据转换成我们想要的形状</li></ol><p id="ace9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们练习一下:</p><h2 id="fa5a" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">ZIP解压缩</h2><p id="aebf" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">直接使用jszip获取:</p><pre class="lw lx ly lz gt mb mc md bn me mf bi"><span id="8e9e" class="mg ky iq mc b be mh mi l mj mk">document.querySelector('#file').addEventListener('change', async e =&gt; {<br/>    const file = e.target.files[0];<br/>    if (!file) return;<br/>    const zip = await JSZip.loadAsync(file);<br/>    const sheetXML = await zip.files['xl/worksheets/sheet1.xml'].async('string');<br/>});</span></pre><p id="59fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">快速修复，现在sheetXML就是我们刚刚看到的sheet1.xml中的数据。</p><h2 id="e8ba" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">XML解析</h2><p id="5f9e" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">然后，我们可以解析XML内容并取出数据。xml解析的原理非常简单，就像html解析一样。为了理解这个原理，让我们直接构建一个开源库来帮助:</p><pre class="lw lx ly lz gt mb mc md bn me mf bi"><span id="1cfa" class="mg ky iq mc b be mh mi l mj mk">import convert from 'xml-js';<br/><br/>const result = convert.xml2json(sheetXML, { compact: true, spaces: 4 });</span></pre><p id="8409" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我们得到一串类似这样的JSON(一些内容被删除):</p><pre class="lw lx ly lz gt mb mc md bn me mf bi"><span id="9633" class="mg ky iq mc b be mh mi l mj mk">{<br/>    "_declaration": {<br/>        "_attributes": {}<br/>    },<br/>    "worksheet": {<br/>        "_attributes": {},<br/>        "sheetPr": {},<br/>        "dimension": {<br/>            "_attributes": {<br/>                "ref": "A1:C7"<br/>            }<br/>        },<br/>        "sheetData": {<br/>            "row": [<br/>                {<br/>                    "_attributes": {<br/>                        "r": "1",<br/>                        "spans": "1:3"<br/>                    },<br/>                    "c": [<br/>                        {<br/>                            "_attributes": {<br/>                                "r": "A1"<br/>                            },<br/>                            "v": {<br/>                                "_text": "1"<br/>                            }<br/>                        },<br/>                        {<br/>                            "_attributes": {<br/>                                "r": "C1"<br/>                            },<br/>                            "v": {<br/>                                "_text": "2"<br/>                            }<br/>                        }<br/>                    ]<br/>                },<br/>                {<br/>                    "_attributes": {<br/>                        "r": "7",<br/>                        "spans": "1:3"<br/>                    },<br/>                    "c": [<br/>                        {<br/>                            "_attributes": {<br/>                                "r": "A7"<br/>                            },<br/>                            "v": {<br/>                                "_text": "1"<br/>                            }<br/>                        },<br/>                        {<br/>                            "_attributes": {<br/>                                "r": "C7"<br/>                            },<br/>                            "v": {<br/>                                "_text": "2"<br/>                            }<br/>                        }<br/>                    ]<br/>                }<br/>            ]<br/>        }<br/>    }<br/>}</span></pre><p id="9266" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们只需要取出sheetData中的数据，然后根据内部属性生成我们想要的数据格式。</p><h1 id="632a" class="ml ky iq bd kz mm mn mo lc mp mq mr lf ms mt mu li mv mw mx ll my mz na lo nb bi translated">总结</h1><p id="d3e7" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">excel文件的本质是一个zip包。我们只需要经过zip解压缩、XML解析和数据处理这三个步骤，就可以使用JS读取其中的数据。当然还有很多细节，但如果只是简单的excel模板，不妨自己试试。</p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><p id="a4ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nx">报名参加我们的</em> <a class="ae kw" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="nx">免费周报</em> </strong> </a> <em class="nx">。关注我们关于</em><a class="ae kw" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="nx">Twitter</em></strong></a>，<a class="ae kw" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="nx">LinkedIn</em></strong></a><em class="nx">，</em><a class="ae kw" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="nx">YouTube</em></strong></a><em class="nx">，以及</em> <a class="ae kw" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="nx">不和</em> </strong> </a> <strong class="ka ir"> <em class="nx">。</em>T41】</strong></p><p id="b82a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="nx">有兴趣缩放你的软件启动</em> </strong> <em class="nx">？检查</em> <a class="ae kw" href="https://circuit.ooo?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="nx">电路</em> </strong> </a> <em class="nx">。</em></p></div></div>    
</body>
</html>