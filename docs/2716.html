<html>
<head>
<title>How I Created A Secure, Self-Hosted Survey In Minutes With React + SurveyJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何使用React + SurveyJS在几分钟内创建一个安全的自主调查</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-i-created-a-secure-self-hosted-survey-in-minutes-with-react-surveyjs-9adc15207af2?source=collection_archive---------0-----------------------#2022-06-29">https://javascript.plainenglish.io/how-i-created-a-secure-self-hosted-survey-in-minutes-with-react-surveyjs-9adc15207af2?source=collection_archive---------0-----------------------#2022-06-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="a9da" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">在一个注重隐私的世界里，完全拥有调查数据的重要性。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/5ec86816a286c015f3849d76100314e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZXVX7ARXGcvlGQKM"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk"><a class="ae ks" href="https://unsplash.com/photos/fPxOowbR6ls" rel="noopener ugc nofollow" target="_blank">Photo by Matthew Henry</a></figcaption></figure><p id="d6df" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在线问卷调查——无论是针对教育部门、医疗保健还是简单的员工反馈——经常会要求回答者<strong class="kv io">提供必须保证匿名和隐私的信息</strong>,这样，作为调查者的您就可以合法合规并确保诚实的答案。</p><p id="f8e2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因此，你用来创建和主持调查的软件需要比第三方的SaaS黑箱平台更T2，因为知识产权法，你无法参与、监控或改进实际服务。</p><p id="3057" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了证明这一点，我们将使用<a class="ae ks" href="https://bit.ly/3amErbh" rel="noopener ugc nofollow" target="_blank"> SurveyJS </a>构建一个调查，这是一个快速、通用、免费和开源(麻省理工学院许可)的JavaScript库，用于表格和调查，它是自托管的，让您保留对受访者数据的完全所有权，<em class="lp">而不会放弃隐私，或者被锁定到一个您无法控制的服务。</em></p><p id="25bf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是首先…让我们来处理一个明显的问题。</p><h1 id="d666" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">“隐私”？我为什么要在乎？</h1><p id="2ac4" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">即使调查是在知情同意的情况下匿名进行的，你也不能逃脱责任。</p><p id="fd93" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">即使您只存储聚合数据，小样本也可能会无意中识别出个人，从而导致不良后果。此外，大多数国家/地区都有管理所收集数据的存储和安全的法律(HIPAA、FERPA、GDPR)，这意味着您要对您保管的任何存储的个人信息负责，包括在保留期结束时对其进行<strong class="kv io">安全销毁</strong>，并提供证据<em class="lp">。</em></p><p id="cfe7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">确保个人隐私和法律合规性的最简单方法是<strong class="kv io">自行主持</strong>调查。您可以在自己的基础设施上运行调查并完全存储响应<em class="lp"/>,从而在没有任何第三方参与的情况下完全控制服务器和客户端之间的数据流。</p><p id="b3e2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">至于好处呢？怎么样……</p><p id="e62a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">SurveyJS作为客户端库分发，用于<a class="ae ks" href="https://www.npmjs.com/package/survey-react-ui" rel="noopener ugc nofollow" target="_blank"> React </a>、<a class="ae ks" href="https://www.npmjs.com/package/survey-angular" rel="noopener ugc nofollow" target="_blank"> Angular </a>、<a class="ae ks" href="https://www.npmjs.com/package/survey-vue-ui" rel="noopener ugc nofollow" target="_blank"> Vue.js </a>、<a class="ae ks" href="https://bit.ly/3amEsMn" rel="noopener ugc nofollow" target="_blank"> Knockout </a>，当然还有<a class="ae ks" href="https://bit.ly/3yK8HFh" rel="noopener ugc nofollow" target="_blank"> jQuery </a>。对于后端，您也有完全的选择自由，因为任何服务器+数据库的组合都与SurveyJS完全兼容，只要它支持JSON、文本或BLOB字段的存储和处理。</p><p id="81a8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">SurveyJS如此松散耦合的事实意味着您可以完全按照您想要的方式保护和管理下面的每一层软件和硬件；SSL、防火墙、纯Linux，尽情发挥吧。此外，您不必在实际的调查应用程序代码中做任何更改来符合未来的法规。</p><p id="4ac5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，SurveyJS支持<a class="ae ks" href="https://en.wikipedia.org/wiki/Webhook" rel="noopener ugc nofollow" target="_blank">web hooks</a>；这意味着在受访者完成调查后，您可以完全控制如何处理数据。您通常希望<a class="ae ks" href="https://bit.ly/3nMxfbr" rel="noopener ugc nofollow" target="_blank">将它存储在数据库</a>中，在需要时向法律机构发布，并在您完成构建业务/内部指标后删除它。</p><blockquote class="mn mo mp"><p id="d7c4" class="kt ku lp kv b kw kx jo ky kz la jr lb mq ld le lf mr lh li lj ms ll lm ln lo ig bi translated"><strong class="kv io">注意:</strong>虽然不是特定于调查，但在内部完全控制数据也意味着您可以在需要知道的基础上管理对数据的访问，从而确保最低权限策略。</p></blockquote><h1 id="374e" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">2.定制和可扩展性。</h1><p id="118c" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">您可以使用自定义CSS和包含的主题，使您的调查看起来很棒，并以您品牌自己的设计语言脱颖而出，而不是由第三方供应商提供的相同默认设置。</p><p id="fae5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">SurveyJS也是可扩展的，具有第三方JavaScript组件，如<a class="ae ks" href="https://github.com/SortableJS/Sortable" rel="noopener ugc nofollow" target="_blank"> SortableJS </a>、<a class="ae ks" href="https://www.npmjs.com/package/react-tag-box" rel="noopener ugc nofollow" target="_blank"> react-tag-box </a>等。您可以混合搭配不同库中的组件，以获得您想要的确切功能。</p><p id="c3aa" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">还有一个特性:使用REST API<a class="ae ks" href="https://bit.ly/3bZhKdq" rel="noopener ugc nofollow" target="_blank">填充选项，您可以在调查/表单模式本身</a>中定义，不需要任何用于异步XHR的JavaScript代码。</p><h1 id="d07d" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">3.避免供应商锁定。</h1><p id="f036" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">当第三方解决方案的性能标准下降，而他们却不断提高价格时，你难道不讨厌吗？如果他们不再支持您所依赖的技术，该怎么办？</p><p id="58ef" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这种情况下，你没有追索权。你完全依赖于供应商来获得业务关键数据，因为你被太多的依赖关系锁定在一个糟糕的选择上，而且SaaS支持的软件从来不是100%独立于供应商的，所以如果你想将业务转移到其他地方，你总是会产生成本。</p><p id="900c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">自主管理SurveyJS解决方案给了你真正的自由，不仅使长期规划成为可能，而且使<em class="lp">可行</em>。</p><h1 id="2f45" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">好吧。那么我该怎么做呢？</h1><p id="17c2" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">这是游戏计划。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mt"><img src="../Images/8fa4e05eb0946c04de443a3a1d5a380c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wW3GoGXgsdUfU0OKsbR5zQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">The SurveyJS offering consists of four individual products, as you can see, but we’re only concerned with our server, and the client-side SurveyJS Library.</figcaption></figure><p id="9810" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们的调查将使用实现SurveyJS库的React组件来构建，基于一个将请求代理回真实服务器的Express后端。</p><p id="707a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">SurveyJS使用数据驱动的方法——这意味着您将把调查定义为用JSON编写的数据模型(一个<em class="lp">模式</em>), React应用程序通过Express REST API从后端检索该数据模型，并使用模板呈现调查。完成后，它将以同样的方式发送调查响应(也作为JSON ),您的后端会将其添加到数据库中。</p><blockquote class="mn mo mp"><p id="8bb1" class="kt ku lp kv b kw kx jo ky kz la jr lb mq ld le lf mr lh li lj ms ll lm ln lo ig bi translated"><strong class="kv io">注:<em class="in"> </em> </strong>要获得灵感，请随意查看SurveyJS提供的用于Node.js、ASP.NET MVC和PHP的<a class="ae ks" href="https://bit.ly/3P8D1jT" rel="noopener ugc nofollow" target="_blank">示例服务</a>，以帮助您快速启动并运行后端。请注意，这些只是作为指南，不建议按原样用于生产。</p></blockquote><p id="c54a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在安全性方面，下面是我们在这个代码示例中确保的内容:</p><ol class=""><li id="dca5" class="mu mv in kv b kw kx kz la lc mw lg mx lk my lo mz na nb nc bi translated">适当的验证，以消除调查响应中触发恶意行为的恶意HTML。</li><li id="7ddc" class="mu mv in kv b kw nd kz ne lc nf lg ng lk nh lo mz na nb nc bi translated">防范常见的攻击媒介，如XSS和CSRF。</li><li id="8ecb" class="mu mv in kv b kw nd kz ne lc nf lg ng lk nh lo mz na nb nc bi translated">使用后端将请求代理回实际的服务器，作为一种web过滤器。</li></ol><p id="1c70" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你不是<em class="lp">自主主持本次调查，你不能做的三件事。</em></p><p id="d42c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以让我们来看看代码。</p><h2 id="377d" class="ni lr in bd ls nj nk dn lw nl nm dp ma lc nn no mc lg np nq me lk nr ns mg nt bi translated">1.该模式</h2><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="206c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是一个非常标准的学生课程调查，带有一点条件逻辑，从数据安全/隐私的角度来看，这是一个理想的案例研究，因为这些信息在美国可能受到FERPA的保护。</p><p id="62a4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们的第一层保护是使用正则表达式进行验证，确保响应中不允许出现潜在的跨站点脚本(XSS)攻击。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/ad1337f87751a059aa0bee776139f1cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/0*1U4tArCCiS4tKn3I"/></div></figure><p id="3206" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们也将在后端防止这种情况，但同时，SurveyJS提供了一个健壮的验证系统，您可以使用正则表达式在JSON模式本身中定义该系统，避免了在React前端增加任何额外代码的需要。</p><p id="58ed" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">此外，这种验证是很好的UX设计，让回答者即时反馈他们做错了什么，而不是等到调查发送出去。</p><h2 id="65be" class="ni lr in bd ls nj nk dn lw nl nm dp ma lc nn no mc lg np nq me lk nr ns mg nt bi translated">2.前端</h2><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="ed6e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，我们从后端(<code class="fe nx ny nz oa b">getSchema()</code>)检索模式，并使用模板根据该模式呈现调查。然后，我们使用SurveyJS对webhooks的支持(<code class="fe nx ny nz oa b">onComplete</code>触发器)将我们的受访者提交的调查结果发布到后端，这些结果将被添加到数据库中。</p><p id="1838" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了防止CSRF攻击，我们利用cookies作为授权在后端生成CSRF令牌(这就是<code class="fe nx ny nz oa b">getCSRFToken()</code>在第一次加载时所做的)，然后我们用它来发出合法的POST请求(在<code class="fe nx ny nz oa b">addToDatabase()</code>)。</p><p id="ba2c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">此外，这里我们有第二层针对XSS攻击的保护——简单地使用React的默认<a class="ae ks" href="https://reactjs.org/docs/introducing-jsx.html#embedding-expressions-in-jsx" rel="noopener ugc nofollow" target="_blank">数据绑定</a>和花括号通过JSX呈现数据，并让React净化HTML。</p><blockquote class="mn mo mp"><p id="5d0f" class="kt ku lp kv b kw kx jo ky kz la jr lb mq ld le lf mr lh li lj ms ll lm ln lo ig bi translated">像处理XSS/CSRF攻击这样的服务器端安全措施超出了作为客户端库的SurveyJS的范围。在这个代码示例中包含它们只是为了让您了解一个完整的自托管调查实例应该是什么样子。</p></blockquote><h2 id="5c46" class="ni lr in bd ls nj nk dn lw nl nm dp ma lc nn no mc lg np nq me lk nr ns mg nt bi translated">3.后端</h2><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="767a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们在这里实现了CSRF保护策略的其余部分，使用CORS中间件来确保请求只有在满足以下条件时才被视为合法:</p><p id="0698" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">a)…事先沟通以获得批准的CSRF令牌，</p><p id="29c6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">b)…正在使用那个<em class="lp">相同的</em>令牌，并且</p><p id="599b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">c)…是否<em class="lp">只是来自一个被批准的原始URL列表中的</em>(我们将它们存储在dotenv的allowed_origins变量中)</p><p id="a2a7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您使用SurveyJS提供的<a class="ae ks" href="https://github.com/surveyjs/surveyjs-nodejs" rel="noopener ugc nofollow" target="_blank"> Node.js后端示例</a>，请注意，我们在这里仅使用客户端cookies进行授权，而该示例通过<a class="ae ks" href="https://www.npmjs.com/package/express-session" rel="noopener ugc nofollow" target="_blank"> express-session </a>包使用会话(服务器<em class="lp">和</em>客户端)。</p><p id="2278" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">就这样结束了！启动Express API服务器和React应用程序，并尝试一下！</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ob"><img src="../Images/a4b4402f99b4232a7798de63ab553188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xdhjXKE0nNOvIYoA"/></div></div></figure><h1 id="2a88" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">权力，回到你的手中。</h1><p id="dcff" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">如果您希望以合法合规的方式为您的调查收集数据，并保护您的受访者的匿名和隐私，有一些职业和道德行为准则<em class="lp">必须</em>考虑在内，并且几个活动部分必须协调工作。这些都是非常不同的任务，涉及非常不同的学科。</p><p id="4311" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">希望您现在已经理解了如何使用survey js——免费、开源，并在非常宽松的MIT许可下——将使您能够做到这一点，并解决这些关于隐私、数据所有权、定制和供应商锁定的问题。</p><p id="a260" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">别忘了<em class="lp">还要</em>起草一份全面的隐私政策！</p></div><div class="ab cl oc od hr oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ig ih ii ij ik"><p id="3c8c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lp">更多内容看</em> <a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lp">说白了。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lp">免费周报</em> </strong> </a> <em class="lp">。关注我们关于</em><a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="lp">Twitter</em></strong></a><em class="lp">和</em><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="lp">LinkedIn</em></strong></a><em class="lp">。查看我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lp">社区不和谐</em> </strong> </a> <em class="lp">，加入我们的</em> <a class="ae ks" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lp">人才集体</em> </strong> </a> <em class="lp">。</em></strong></a></p></div></div>    
</body>
</html>