<html>
<head>
<title>How to Handle Errors in SwaggerUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何处理SwaggerUI中的错误</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-handle-errors-in-swaggerui-2e2f5344acb?source=collection_archive---------19-----------------------#2022-01-25">https://javascript.plainenglish.io/how-to-handle-errors-in-swaggerui-2e2f5344acb?source=collection_archive---------19-----------------------#2022-01-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="eaa5" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">SwaggerUI中的错误处理指南。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi kc"><img src="../Images/5771357fe7c6c510ff44994c330e47b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*iHB6hDMaW48VjTbsjyhbzg.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">SmartBear Software, Inc.</figcaption></figure><p id="fcee" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">错误处理是当今现代单页面应用程序的一个重要方面。错误处理指的是对不同种类错误的预测、检测和解决。从版本<a class="ae ll" href="https://www.npmjs.com/package/swagger-ui/v/4.3.0" rel="noopener ugc nofollow" target="_blank"><em class="lk">v 4 . 3 . 0</em></a><em class="lk">，</em> <a class="ae ll" href="https://github.com/swagger-api/swagger-ui" rel="noopener ugc nofollow" target="_blank"> <em class="lk">开始，SwaggerUIs</em></a><em class="lk">错误处理能力有了很大的提高，并允许swaggeri集成器轻松集成他们的自定义错误处理程序。</em></p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="ea05" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">最初的SwaggerUI错误处理包括用命令性的<code class="fe lt lu lv lw b">try/catch</code>语句包装每个类组件的每个render方法，并在抛出错误时显示<code class="fe lt lu lv lw b">Fallback</code>组件。除了显示回退组件，<code class="fe lt lu lv lw b">console.error</code>还用于在浏览器控制台中显示捕获的错误。这个解决方案需要将每个功能组件包装成类组件，以确保组件具有<code class="fe lt lu lv lw b">render</code>方法。</p><p id="9d0e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">React 16引入了一个<a class="ae ll" href="https://reactjs.org/docs/error-boundaries.html" rel="noopener ugc nofollow" target="_blank">错误边界</a>的新概念。不再需要创建一个定制的解决方案来捕捉React应用程序中的错误，因为我们有一个标准化的方法来做这件事。</p><p id="5829" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了充分利用新的错误边界，我不得不重写swagger ui<a class="ae ll" href="https://github.com/swagger-api/swagger-ui/tree/master/src/core/plugins/view" rel="noopener ugc nofollow" target="_blank">视图插件</a>，所有其他插件都基于它。引入了一个叫做<code class="fe lt lu lv lw b">safe-render</code>的新插件，允许对SwaggerUI组件应用可配置的错误边界。</p><h2 id="8e35" class="lx ly in bd lz ma mb dn mc md me dp mf kx mg mh mi lb mj mk ml lf mm mn mo mp bi translated">查看插件</h2><p id="b350" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">视图插件<strong class="kq io">公共API没有改变</strong>，我只是添加了一个额外的util函数<code class="fe lt lu lv lw b">getDisplayName</code>，用于访问React组件名称。</p><pre class="kd ke kf kg gt mv lw mw mx aw my bi"><span id="20cf" class="lx ly in lw b gy mz na l nb nc">{<br/>  rootInjects: {<br/>    getComponent: memGetComponent,<br/>    makeMappedContainer: memMakeMappedContainer,<br/>    render: render(getSystem, getStore, getComponent, getComponents),<br/>  },<br/>  fn: {<br/>    getDisplayName,<br/>  },<br/>}</span></pre><p id="c178" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe lt lu lv lw b">view</code>插件不再负责错误处理逻辑。重写插件有几个积极的副作用，比如使SwaggerUI渲染更快，简化React开发工具中的React组件树:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/df0aa1681c626c4f515c8f041eb67a27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*2vcYXqYZS9o_zy7JVYmifA.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Before refactor</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/1c280c264d8281ee5e8a53c2e97a2089.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*gZtEQdsDiS-7mQL7jDqc2g.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">After refactor</figcaption></figure><h2 id="c814" class="lx ly in bd lz ma mb dn mc md me dp mf kx mg mh mi lb mj mk ml lf mm mn mo mp bi translated">安全渲染插件</h2><p id="328c" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">这个插件单独负责SwaggerUI中的错误处理逻辑。接受应受错误边界保护的组件名称列表。</p><p id="aa59" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">它的公共API如下所示:</p><pre class="kd ke kf kg gt mv lw mw mx aw my bi"><span id="1a2e" class="lx ly in lw b gy mz na l nb nc">{<br/>  fn: {<br/>    componentDidCatch,<br/>    withErrorBoundary: withErrorBoundary(getSystem),<br/>  },<br/>  components: {<br/>    ErrorBoundary,<br/>    Fallback,<br/>  },<br/>}</span></pre><p id="6655" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">安全渲染插件由<a class="ae ll" href="https://github.com/swagger-api/swagger-ui/blob/78f62c300a6d137e65fd027d850981b010009970/src/core/presets/base.js" rel="noopener ugc nofollow" target="_blank">基础</a>和<a class="ae ll" href="https://github.com/swagger-api/swagger-ui/tree/78f62c300a6d137e65fd027d850981b010009970/src/standalone" rel="noopener ugc nofollow" target="_blank">独立</a> SwaggerUI预设自动使用，并且应该始终作为最后一个插件使用，因为所有组件都已经为SwaggerUI所知。该插件定义了应受错误边界保护的默认组件列表:</p><pre class="kd ke kf kg gt mv lw mw mx aw my bi"><span id="47af" class="lx ly in lw b gy mz na l nb nc">[<br/>  "App",<br/>  "BaseLayout",<br/>  "VersionPragmaFilter",<br/>  "InfoContainer",<br/>  "ServersContainer",<br/>  "SchemesContainer",<br/>  "AuthorizeBtnContainer",<br/>  "FilterContainer",<br/>  "Operations",<br/>  "OperationContainer",<br/>  "parameters",<br/>  "responses",<br/>  "OperationServers",<br/>  "Models",<br/>  "ModelWrapper",<br/>  "Topbar",<br/>  "StandaloneLayout",<br/>  "onlineValidatorBadge"<br/>]</span></pre><p id="f349" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如下所示，通过使用带有配置选项的安全渲染插件，可以保护额外的组件。如果你是一个SwaggerUI集成者，并且你维护着一些带有额外定制组件的插件，这将变得非常方便。</p><pre class="kd ke kf kg gt mv lw mw mx aw my bi"><span id="d5ed" class="lx ly in lw b gy mz na l nb nc">const swaggerUI = SwaggerUI({<br/>  url: "<a class="ae ll" href="https://petstore.swagger.io/v2/swagger.json" rel="noopener ugc nofollow" target="_blank">https://petstore.swagger.io/v2/swagger.json</a>",<br/>  dom_id: '#swagger-ui',<br/>  plugins: [<br/>    () =&gt; ({<br/>      components: {<br/>        MyCustomComponent1: () =&gt; 'my custom component',<br/>      },<br/>    }),<br/>    SwaggerUI.plugins.SafeRender({<br/>      fullOverride: true, // only the component list defined here will apply (not the default list)<br/>      componentList: [<br/>        "MyCustomComponent1",<br/>      ],<br/>    }),<br/>  ],<br/>});</span></pre><h2 id="0acf" class="lx ly in bd lz ma mb dn mc md me dp mf kx mg mh mi lb mj mk ml lf mm mn mo mp bi translated">componentDidCatch</h2><p id="d35e" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">这个静态函数在组件抛出错误后被调用。<br/>它接收两个参数:</p><ol class=""><li id="95eb" class="nf ng in kq b kr ks ku kv kx nh lb ni lf nj lj nk nl nm nn bi translated"><code class="fe lt lu lv lw b">error</code> -抛出的错误。</li><li id="f8d2" class="nf ng in kq b kr no ku np kx nq lb nr lf ns lj nk nl nm nn bi translated"><code class="fe lt lu lv lw b">info</code> -具有componentStack键的对象，该键包含关于哪个组件抛出了错误的<a class="ae ll" href="https://reactjs.org/docs/error-boundaries.html#component-stack-traces" rel="noopener ugc nofollow" target="_blank">信息。</a></li></ol><p id="3a5f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">它与错误边界<a class="ae ll" href="https://reactjs.org/docs/react-component.html#componentdidcatch" rel="noopener ugc nofollow" target="_blank">componentiddcatch生命周期方法</a>具有完全相同的签名，除了它是一个静态函数而不是一个类方法。</p><p id="b862" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">componentDidCatch的默认实现使用<code class="fe lt lu lv lw b">console.error</code>来显示收到的错误:</p><pre class="kd ke kf kg gt mv lw mw mx aw my bi"><span id="e2d7" class="lx ly in lw b gy mz na l nb nc">export const componentDidCatch = console.error;</span></pre><p id="89ae" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了利用您自己的错误处理逻辑(例如<a class="ae ll" href="https://www.bugsnag.com/" rel="noopener ugc nofollow" target="_blank"> bugsnag </a>，创建一个新的SwaggerUI插件来覆盖componentDidCatch:</p><pre class="kd ke kf kg gt mv lw mw mx aw my bi"><span id="c6d7" class="lx ly in lw b gy mz na l nb nc"><strong class="lw io">const</strong> BugsnagErrorHandlerPlugin <strong class="lw io">=</strong> () <strong class="lw io">=&gt;</strong> {<br/>  <em class="lk">// init bugsnag</em><br/><br/>  <strong class="lw io">return</strong> {<br/>    fn: {<br/>      componentDidCatch <strong class="lw io">=</strong> (error, info) <strong class="lw io">=&gt;</strong> {<br/>        Bugsnag.notify(error);<br/>        Bugsnag.notify(info);<br/>      },<br/>    },<br/>  };<br/>};</span></pre><h2 id="2627" class="lx ly in bd lz ma mb dn mc md me dp mf kx mg mh mi lb mj mk ml lf mm mn mo mp bi translated">withErrorBoundary</h2><p id="b3eb" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">该功能是特设的(高阶组件)。它将一个特定的组件包装到<code class="fe lt lu lv lw b">ErrorBoundary</code>组件中。可以通过一个插件系统覆盖它，以控制ErrorBoundary组件如何包装组件。在99.9%的情况下，你不需要重写这个函数，但是如果你要重写，请先阅读这个函数的源代码。</p><h2 id="7af7" class="lx ly in bd lz ma mb dn mc md me dp mf kx mg mh mi lb mj mk ml lf mm mn mo mp bi translated">撤退</h2><p id="55b3" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">当错误边界捕捉到错误时，将显示该组件。它可以通过插件系统被覆盖。它的默认实现很简单:</p><pre class="kd ke kf kg gt mv lw mw mx aw my bi"><span id="becf" class="lx ly in lw b gy mz na l nb nc">import React from "react"<br/>import PropTypes from "prop-types"</span><span id="a580" class="lx ly in lw b gy nt na l nb nc">const Fallback = ({ name }) =&gt; (<br/>  &lt;div className="fallback"&gt;<br/>    😱 &lt;i&gt;Could not render { name === "t" ? "this component" : name }, see the console.&lt;/i&gt;<br/>  &lt;/div&gt;<br/>)<br/>Fallback.propTypes = {<br/>  name: PropTypes.string.isRequired,<br/>}<br/>export default Fallback</span></pre><p id="8199" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">请随意覆盖它以符合您的外观和感觉:</p><pre class="kd ke kf kg gt mv lw mw mx aw my bi"><span id="af82" class="lx ly in lw b gy mz na l nb nc">const CustomFallbackPlugin = () =&gt; ({<br/>  components: {<br/>    Fallback: ({ name } ) =&gt; `This is my custom fallback. ${name} failed to render`,<br/>  },<br/>});</span><span id="c166" class="lx ly in lw b gy nt na l nb nc">const swaggerUI = SwaggerUI({<br/>  url: "<a class="ae ll" href="https://petstore.swagger.io/v2/swagger.json" rel="noopener ugc nofollow" target="_blank">https://petstore.swagger.io/v2/swagger.json</a>",<br/>  dom_id: '#swagger-ui',<br/>  plugins: [<br/>    CustomFallbackPlugin,<br/>  ]  <br/>});</span></pre><h2 id="ebe3" class="lx ly in bd lz ma mb dn mc md me dp mf kx mg mh mi lb mj mk ml lf mm mn mo mp bi translated">误差边界</h2><p id="7d45" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">这是实现React错误边界的组件。使用引擎盖下的<code class="fe lt lu lv lw b">componentDidCatch</code>和<code class="fe lt lu lv lw b">Fallback</code>。在99.9%的情况下，您不需要覆盖这个组件，但是如果您需要，请先阅读这个组件的源代码。</p><h2 id="f7a3" class="lx ly in bd lz ma mb dn mc md me dp mf kx mg mh mi lb mj mk ml lf mm mn mo mp bi translated">行为的改变</h2><p id="6e7e" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">在SwaggerUI的早期版本中，几乎所有的组件都受到了保护，当抛出错误时，会显示<code class="fe lt lu lv lw b">Fallback</code> component。这在SwaggerUI v4.3.0中有所改变。现在只有由<code class="fe lt lu lv lw b">safe-render</code>插件定义的组件受到保护并显示回退。如果SwaggerUI React组件树中某处的一个小组件无法呈现并抛出一个错误，该错误会冒泡到最近的错误边界，该错误边界会显示<code class="fe lt lu lv lw b">Fallback</code>组件并调用<code class="fe lt lu lv lw b">componentDidCatch</code>。</p><p id="2d7b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果你对更多的技术细节感兴趣，这里是在SwaggerUI中引入新的错误处理的<a class="ae ll" href="https://github.com/swagger-api/swagger-ui/pull/7761/files" rel="noopener ugc nofollow" target="_blank"> PR </a>。</p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="4aff" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="lk">原载于2022年1月25日https://vladimirgorej.com</em><em class="lk"/><a class="ae ll" href="https://vladimirgorej.com/blog/swagger-ui-error-handling/" rel="noopener ugc nofollow" target="_blank"><em class="lk">。</em></a></p><p id="610d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="lk">更多内容看</em> <a class="ae ll" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lk">说白了就是</em> </strong> </a> <em class="lk">。报名参加我们的</em> <a class="ae ll" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lk">免费周报</em> </strong> </a> <em class="lk">。在我们的</em> <a class="ae ll" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lk">社区不和谐</em> </strong> </a> <em class="lk">获得独家获取写作机会和建议。</em></p></div></div>    
</body>
</html>