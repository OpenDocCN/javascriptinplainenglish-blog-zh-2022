<html>
<head>
<title>Node.js Module and Export Shenanigans</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js模块和导出诡计</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/nodejs-module-and-export-shenanigans-d8ba9d087b88?source=collection_archive---------4-----------------------#2022-06-11">https://javascript.plainenglish.io/nodejs-module-and-export-shenanigans-d8ba9d087b88?source=collection_archive---------4-----------------------#2022-06-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="be2d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">琐事:</strong>假设我们有一个包含以下内容的<code class="fe ki kj kk kl b">test.js</code>文件:</p><pre class="km kn ko kp gt kq kl kr ks aw kt bi"><span id="2156" class="ku kv in kl b gy kw kx l ky kz">console.log(arguments);</span></pre><p id="b2fd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">输出会是什么？</p><figure class="km kn ko kp gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi la"><img src="../Images/beeb04807eb4a5b12e4e43130fcee457.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rggh33GW-cxTLqwADFPpJg.jpeg"/></div></div><figcaption class="li lj gj gh gi lk ll bd b be z dk">image_credit — NodeJS — The Complete Guide (incl. MVC, REST APIs, GraphQL)</figcaption></figure><p id="9f4b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">输出将是这样的:</p><pre class="km kn ko kp gt kq kl kr ks aw kt bi"><span id="550c" class="ku kv in kl b gy kw kx l ky kz">[Arguments] {<br/>  '0': {},<br/>  '1': [Function: require] {<br/>    resolve: [Function: resolve] { paths: [Function: paths] },<br/>    main: Module {<br/>      id: '.',<br/>      path: '/Users/ayesha/nodejs',<br/>      exports: {},<br/>      filename: '/Users/ayesha/nodejs/test-module.js',<br/>      loaded: false,<br/>      children: [],<br/>      paths: [Array]<br/>    },<br/>    extensions: [Object: null prototype] {<br/>      '.js': [Function (anonymous)],<br/>      '.json': [Function (anonymous)],<br/>      '.node': [Function (anonymous)]<br/>    },<br/>    cache: [Object: null prototype] {<br/>      '/Users/ayesha/modejs/test-module.js': [Module]<br/>    }<br/>  },<br/>  '2': Module {<br/>    id: '.',<br/>    path: '/Users/ayesha/nodejs',<br/>    exports: {},<br/>    filename: '/Users/ayesha/nodejs/test-module.js',<br/>    loaded: false,<br/>    children: [],<br/>    paths: [<br/>      '/Users/ayesha/nodejs/node_modules',<br/>      '/Users/ayesha/node_modules',<br/>      '/Users/node_modules',<br/>      '/node_modules'<br/>    ]<br/>  },<br/>  '3': '/Users/ayesha/nodejs/test-module.js',<br/>  '4': '/Users/ayesha/nodejs'<br/>}</span></pre><p id="3d8d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以基本上，当Node.js执行一个文件时，它把它放在一个函数中。这些是Node.js发送给这个函数的参数。所以，上面的文件被解释为:</p><pre class="km kn ko kp gt kq kl kr ks aw kt bi"><span id="b689" class="ku kv in kl b gy kw kx l ky kz">//function (exports, module, require, __filename, __dirname) {</span><span id="a2eb" class="ku kv in kl b gy lm kx l ky kz">console.log(arguments);</span><span id="3155" class="ku kv in kl b gy lm kx l ky kz">// return module.exports</span><span id="081d" class="ku kv in kl b gy lm kx l ky kz">//}</span></pre><p id="c5a8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">注释掉的行是节点在执行前添加的行。并且它还返回<code class="fe ki kj kk kl b">module.exports</code>对象。</p><p id="9ff8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以，当我们写<code class="fe ki kj kk kl b">exports.somevariable = 5</code>时，我们使用的是Node传递给函数的参数。返回也是自动的，我们不需要显式地返回任何东西，Node会为我们做的。</p><p id="7681" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这就是为什么我们要添加API或变量来暴露给<code class="fe ki kj kk kl b">module.exports</code>对象。事实上，参数<code class="fe ki kj kk kl b">exports</code>是<code class="fe ki kj kk kl b">module.exports</code>的别名。我们可以通过<code class="fe ki kj kk kl b">exports</code>或<code class="fe ki kj kk kl b">module.exports</code>公开变量或API，因为<code class="fe ki kj kk kl b">module</code>也作为参数发送给我们。然而，需要注意的是——我们不能做类似于<code class="fe ki kj kk kl b">export = () =&gt; {}</code>的事情，因为我们在这里没有给一个对象赋值——我们实质上破坏了模块和导出之间的赋值引用。但是我们被允许这样做<code class="fe ki kj kk kl b">module.exports = () =&gt; {}</code>，因为Node将返回<code class="fe ki kj kk kl b">module.exports</code>并且我们可以改变我们返回的内容。</p><p id="c947" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">类似地，当我们使用<code class="fe ki kj kk kl b">require()</code>时，也是在使用<code class="fe ki kj kk kl b">require</code>参数。</p><p id="2757" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Node对它执行的每个文件都这样做。</p><h1 id="4892" class="ln kv in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">导出— 4种方式</h1><h2 id="2a20" class="ku kv in bd lo mk ml dn ls mm mn dp lw jv mo mp ma jz mq mr me kd ms mt mi mu bi translated">简单对象导出:</h2><p id="87fb" class="pw-post-body-paragraph jk jl in jm b jn mv jp jq jr mw jt ju jv mx jx jy jz my kb kc kd mz kf kg kh ig bi translated">所以现在，在我们的<code class="fe ki kj kk kl b">test.js</code>文件中——如果我们想要暴露一些变量，我们可以这样做——</p><pre class="km kn ko kp gt kq kl kr ks aw kt bi"><span id="92e0" class="ku kv in kl b gy kw kx l ky kz">exports.val1 = 20;<br/>exports.val2 = 'test';</span></pre><p id="2cd3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果我们有另一个文件——</p><pre class="km kn ko kp gt kq kl kr ks aw kt bi"><span id="ec04" class="ku kv in kl b gy kw kx l ky kz">const testApi = require('./test');<br/>console.log(testApi.val1, testApi.val2);<br/>//20 'test'</span></pre><p id="db42" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于这样的简单导出——我们不需要使用<code class="fe ki kj kk kl b">module.exports</code>,我们可以使用<code class="fe ki kj kk kl b">exports</code>,如上例所示。当我们想要使用这些来自<code class="fe ki kj kk kl b">test.js</code>的公开值时，我们简单地导入它们，并得到一个简单的对象作为回报。</p><h2 id="2966" class="ku kv in bd lo mk ml dn ls mm mn dp lw jv mo mp ma jz mq mr me kd ms mt mi mu bi translated">数组导出:</h2><p id="89d1" class="pw-post-body-paragraph jk jl in jm b jn mv jp jq jr mw jt ju jv mx jx jy jz my kb kc kd mz kf kg kh ig bi translated">当顶层API是数组时，我们可以直接赋给<code class="fe ki kj kk kl b">module.exports</code>。例如，我们称之为<code class="fe ki kj kk kl b">test2.js</code>:</p><pre class="km kn ko kp gt kq kl kr ks aw kt bi"><span id="c3f7" class="ku kv in kl b gy kw kx l ky kz">module.exports = [23,33,55];</span></pre><p id="3cb3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，当我们导入这个类时，我们直接得到整个数组。</p><pre class="km kn ko kp gt kq kl kr ks aw kt bi"><span id="5d5d" class="ku kv in kl b gy kw kx l ky kz">const arrayImport = require('./test2.js');<br/>console.log(arrayImport)<br/>//[ 23, 33, 55 ]</span></pre><h2 id="5a4e" class="ku kv in bd lo mk ml dn ls mm mn dp lw jv mo mp ma jz mq mr me kd ms mt mi mu bi translated">字符串导出:</h2><p id="c2b2" class="pw-post-body-paragraph jk jl in jm b jn mv jp jq jr mw jt ju jv mx jx jy jz my kb kc kd mz kf kg kh ig bi translated">这是完全不言自明的。当我们想导出一个字符串时，我们也直接将它赋给<code class="fe ki kj kk kl b">module.exports</code></p><h2 id="1e92" class="ku kv in bd lo mk ml dn ls mm mn dp lw jv mo mp ma jz mq mr me kd ms mt mi mu bi translated">函数导出:</h2><p id="41fb" class="pw-post-body-paragraph jk jl in jm b jn mv jp jq jr mw jt ju jv mx jx jy jz my kb kc kd mz kf kg kh ig bi translated">这种出口非常有用。当我们的顶级API是一个函数时，我们使用它。例如，考虑下面的代码<code class="fe ki kj kk kl b">test3.js</code>:</p><pre class="km kn ko kp gt kq kl kr ks aw kt bi"><span id="1cd4" class="ku kv in kl b gy kw kx l ky kz">module.exports = (param1, param2) =&gt; `${param1} + ${param2} = ${param1+param2}`;</span></pre><p id="187e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们这样使用这个函数:</p><pre class="km kn ko kp gt kq kl kr ks aw kt bi"><span id="da89" class="ku kv in kl b gy kw kx l ky kz">const sum = require('./test3.js');<br/>console.log(sum(13, 10));<br/>//13 + 10 = 23</span></pre><p id="80b4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">希望这对理解Node.js中的模块和导出有所帮助。</p><p id="d91b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="na">更多内容尽在</em> <a class="ae nb" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="na">说白了. io </em> </strong> </a> <em class="na">。报名参加我们的</em> <a class="ae nb" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="na">免费周报</em> </strong> </a> <em class="na">。关注我们关于</em> <a class="ae nb" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="na">推特</em> </strong> </a> <em class="na">和</em><a class="ae nb" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="na">LinkedIn</em></strong></a><em class="na">。查看我们的</em> <a class="ae nb" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="na">社区不和谐</em> </strong> </a> <em class="na">加入我们的</em> <a class="ae nb" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="na">人才集体</em> </strong> </a> <em class="na">。</em></p></div></div>    
</body>
</html>