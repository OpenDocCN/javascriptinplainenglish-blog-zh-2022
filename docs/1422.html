<html>
<head>
<title>React useEffect Hook Usages You Must Know</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你必须知道的钩子用法</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-useeffect-hook-usages-you-must-know-45157805fb98?source=collection_archive---------5-----------------------#2022-03-23">https://javascript.plainenglish.io/react-useeffect-hook-usages-you-must-know-45157805fb98?source=collection_archive---------5-----------------------#2022-03-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="1e2b" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">学习React中useEffect钩子的实际用法，以及如何通过各种用例管理组件的副作用。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/d9e2edea2eb58cb59ab37950ed630509.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X8P41BiBkw1N4kIW"/></div></div></figure><p id="629a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">React是一个基于JavaScript的用户界面库。React组件是独立的可重用代码逻辑片段，具有自己的UI。多个组件一起创建一个有意义的工作React应用程序。</p><p id="468b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们可以用两种方式创建组件，使用类或函数。随着JavaScript开发人员对函数的了解越来越多，我们看到许多React开发人员适应基于函数的组件，而不是基于类的组件。</p><p id="57d9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">从React 16.8版本开始，React得到了一个令人兴奋的新特性，叫做<a class="ae lk" href="https://www.youtube.com/watch?v=CvNvRaS3u60" rel="noopener ugc nofollow" target="_blank">钩子</a>。React提供了许多标准的内置钩子来管理状态、隔离副作用、创建引用、提高性能等。我们还可以创建<a class="ae lk" href="https://www.youtube.com/watch?v=nt-TB3f5kp4" rel="noopener ugc nofollow" target="_blank">自定义钩子</a>，这只是访问许多React特性的JavaScript函数。</p><p id="f252" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在本文中，我们将讨论一个最常用的内置React挂钩<code class="fe ll lm ln lo b">useEffect</code>。我们将通过实际的使用案例来学习它的用法。</p><h1 id="ab52" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">useEffect挂钩</h1><p id="55ff" class="pw-post-body-paragraph ko kp in kq b kr mh jo kt ku mi jr kw kx mj kz la lb mk ld le lf ml lh li lj ig bi translated">组件的结果是用呈现逻辑(用JSX写的)在用户界面上呈现“某些东西”。许多因素驱动渲染逻辑，</p><ul class=""><li id="8e89" class="mm mn in kq b kr ks ku kv kx mo lb mp lf mq lj mr ms mt mu bi translated">状态值在组件内部定义和更新。</li><li id="bfa7" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated">props值被传递给组件。</li><li id="c1ae" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated">副作用。</li></ul><p id="c043" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在，有哪些<code class="fe ll lm ln lo b">side effects</code>？如果你以前在编程的环境中没有听说过，那也没关系。这里就让我们来破一破，了解一下。</p><ul class=""><li id="ca4e" class="mm mn in kq b kr ks ku kv kx mo lb mp lf mq lj mr ms mt mu bi translated">副作用可以是负责改变组件状态的任何效果(编程逻辑)。如果状态改变，组件会重新呈现。例如，一个典型的副作用是进行API调用并更改组件的本地状态来存储API响应数据。</li><li id="cfb1" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated">此外，可能会有副作用，可能不会更新状态值，也不会影响渲染逻辑。例如，您在浏览器控制台上记录一个文本，或者在浏览器的本地存储中存储一些内容。请注意，其中一些我们可以使用<code class="fe ll lm ln lo b">useRef</code>钩子来完成，我们将在以后的文章中学习。</li></ul><p id="b1c3" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">所以，副作用是我们应该从渲染中分离出来的。<code class="fe ll lm ln lo b">useEffect</code>钩子通过将它从渲染逻辑中分离出来来帮助执行副作用。</p><pre class="kd ke kf kg gt na lo nb nc aw nd bi"><span id="72a9" class="ne lq in lo b gy nf ng l nh ni">useEffect(callback, [dependencies]);</span></pre><p id="8074" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">useEffect挂钩有两个参数，</p><ul class=""><li id="ec00" class="mm mn in kq b kr ks ku kv kx mo lb mp lf mq lj mr ms mt mu bi translated">定义和清除副作用的回调函数。</li><li id="9b65" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated">一个可选的依赖数组，确保何时运行回调函数中定义的副作用。</li></ul><h1 id="0e1a" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">useEffect挂钩的用法</h1><p id="395f" class="pw-post-body-paragraph ko kp in kq b kr mh jo kt ku mi jr kw kx mj kz la lb mk ld le lf ml lh li lj ig bi translated">我们传递给<code class="fe ll lm ln lo b">useEffect</code>钩子的回调函数运行副作用。默认情况下，React会在组件的每次渲染时运行它。但是，在每个渲染上运行副作用可能会非常昂贵，而且会影响性能。我们可以使用传递给useEffect钩子的依赖数组参数来控制它。</p><p id="8e0f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在这一节中，我们将学习useEffect钩子的六种用法来运行和清理副作用。</p><h1 id="b5b0" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">1.副作用运行<code class="fe ll lm ln lo b">After Every</code>渲染</h1><p id="5eec" class="pw-post-body-paragraph ko kp in kq b kr mh jo kt ku mi jr kw kx mj kz la lb mk ld le lf ml lh li lj ig bi translated">第一种是默认情况。如果不将依赖数组传递给useEffect钩子，回调函数将在每次渲染时执行。因此<code class="fe ll lm ln lo b">React</code>会在每次渲染后运行它定义的副作用。</p><p id="d4ba" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这不是一个经常使用的用例场景。我们可能总是想控制副作用的发生。</p><pre class="kd ke kf kg gt na lo nb nc aw nd bi"><span id="8a89" class="ne lq in lo b gy nf ng l nh ni">useEffect(() =&gt; {<br/>  // Side Effect<br/>});</span></pre><h1 id="1506" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">2.初始渲染后副作用运行<code class="fe ll lm ln lo b">Only Once</code></h1><p id="2336" class="pw-post-body-paragraph ko kp in kq b kr mh jo kt ku mi jr kw kx mj kz la lb mk ld le lf ml lh li lj ig bi translated">您可能希望在初始渲染后只运行一次副作用。典型的情况是获取数据，进行API调用，并在初始呈现后将响应存储在状态变量中。您不想再次进行此API调用。</p><p id="2bd3" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">您可以将一个空数组作为第二个参数传递给useEffect钩子来处理这个用例。</p><p id="93ed" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在这种情况下，副作用仅在组件的初始渲染后运行一次。</p><pre class="kd ke kf kg gt na lo nb nc aw nd bi"><span id="5c6b" class="ne lq in lo b gy nf ng l nh ni">useEffect(() =&gt; {<br/>  // Side Effect<br/>}, []);</span></pre><h1 id="6a88" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">3.<code class="fe ll lm ln lo b">State Value</code>变化后的副作用</h1><p id="f607" class="pw-post-body-paragraph ko kp in kq b kr mh jo kt ku mi jr kw kx mj kz la lb mk ld le lf ml lh li lj ig bi translated">您可能需要根据状态值运行副作用。例如，您可能会有一个副作用，即根据口语(英语、西班牙语、印地语、泰米尔语等)准备一条问候消息。).这里，口语值存储在一个状态变量中。</p><p id="a024" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">每当我们选择一种口语，状态就会更新。随着状态值的更新，您希望重新创建问候消息。为了解决这个用例，您必须将状态变量作为依赖数组的一部分传递给useEffect钩子。</p><pre class="kd ke kf kg gt na lo nb nc aw nd bi"><span id="4a06" class="ne lq in lo b gy nf ng l nh ni">useEffect(() =&gt; {<br/>  // Side Effect<br/>}, [state]);</span></pre><p id="f6b5" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在这种情况下，副作用将在每次状态变量的值改变时运行。如果多个状态变量影响副作用，可以在依赖数组中以逗号分隔的形式传递它们。</p><pre class="kd ke kf kg gt na lo nb nc aw nd bi"><span id="7c36" class="ne lq in lo b gy nf ng l nh ni">useEffect(() =&gt; {<br/>  // Side Effect<br/>}, [state1, state2, state3]);</span></pre><h1 id="3dbb" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">4.<code class="fe ll lm ln lo b">Props Value</code>改变后副作用运行</h1><p id="b979" class="pw-post-body-paragraph ko kp in kq b kr mh jo kt ku mi jr kw kx mj kz la lb mk ld le lf ml lh li lj ig bi translated">就像状态一样，我们也可以把道具作为依赖来运行副作用。在这种情况下，每当作为依赖项传递的道具发生变化时，副作用就会运行。</p><p id="cd39" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">您可以像前面的例子一样，以逗号分隔的依赖关系来传递多个属性。</p><pre class="kd ke kf kg gt na lo nb nc aw nd bi"><span id="7c4c" class="ne lq in lo b gy nf ng l nh ni">useEffect(() =&gt; {<br/>  // Side Effect<br/>}, [props]);</span></pre><h1 id="7e76" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">5.<code class="fe ll lm ln lo b">Props and State Value</code>改变后副作用运行</h1><p id="57c5" class="pw-post-body-paragraph ko kp in kq b kr mh jo kt ku mi jr kw kx mj kz la lb mk ld le lf ml lh li lj ig bi translated">如果您需要在每次状态和道具组合发生变化时运行副作用，该怎么办？当副作用取决于状态和道具值时，可能会出现这种用例。在这种情况下，您需要将state和props变量作为依赖项传递。</p><pre class="kd ke kf kg gt na lo nb nc aw nd bi"><span id="793f" class="ne lq in lo b gy nf ng l nh ni">useEffect(() =&gt; {<br/>  // Side Effect<br/>}, [props, state]);</span></pre><h1 id="f66a" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">6.副作用<code class="fe ll lm ln lo b">Cleanup</code></h1><p id="444a" class="pw-post-body-paragraph ko kp in kq b kr mh jo kt ku mi jr kw kx mj kz la lb mk ld le lf ml lh li lj ig bi translated">到目前为止，我们已经看到了如何以及何时运行副作用。同样重要的是，我们要清理掉影响应用程序性能的副作用。每个副作用都不一样。因此，副作用的清除策略会有所不同。</p><p id="e47e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">例如，如果使用<code class="fe ll lm ln lo b">setTimeout</code>函数运行定时器有副作用，就需要通过调用<code class="fe ll lm ln lo b">clearTimeout</code>函数来清除它。但是我们怎么做呢？</p><p id="ed8e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了清理副作用，您需要从我们传递给useEffect钩子的回调函数中返回一个函数。您必须将副作用清除逻辑放在返回的函数中。</p><pre class="kd ke kf kg gt na lo nb nc aw nd bi"><span id="5f46" class="ne lq in lo b gy nf ng l nh ni">useEffect(() =&gt; {<br/>  // Side Effect</span><span id="3e6a" class="ne lq in lo b gy nj ng l nh ni">return () =&gt; {<br/>    // Side Effect Cleanup<br/>  }<br/>}[props, state]);</span></pre><p id="a7c5" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">有几点需要注意，</p><ul class=""><li id="7f9e" class="mm mn in kq b kr ks ku kv kx mo lb mp lf mq lj mr ms mt mu bi translated">每次初始渲染后都会调用清理功能来清理之前的副作用，然后运行后续的副作用。</li><li id="9bc0" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated">当组件卸载时，cleanup函数被调用。</li></ul><h1 id="a718" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">结论</h1><p id="30b3" class="pw-post-body-paragraph ko kp in kq b kr mh jo kt ku mi jr kw kx mj kz la lb mk ld le lf ml lh li lj ig bi translated">以上就是关于<code class="fe ll lm ln lo b">useEffect</code>钩子的用法。我希望这篇文章对你有所帮助。</p><p id="5b2c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">但是等等，还没完，真的！如果你想通过动手项目继续了解它，我会把这个YouTube视频教程留给你。我希望你也喜欢它。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="fa6b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="nm">请</em> <a class="ae lk" href="https://www.youtube.com/tapasadhikary?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank"> <em class="nm">订阅</em> </a> <em class="nm">未来内容</em>🔥🔥🔥</p><h1 id="508e" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">在我们结束之前…</h1><p id="5471" class="pw-post-body-paragraph ko kp in kq b kr mh jo kt ku mi jr kw kx mj kz la lb mk ld le lf ml lh li lj ig bi translated">我分享我的知识，</p><ul class=""><li id="ce80" class="mm mn in kq b kr ks ku kv kx mo lb mp lf mq lj mr ms mt mu bi translated">🌐Web开发(JavaScript、ReactJS、Next.js、Node.js等等……)</li><li id="e0a5" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated">🛡️网络安全公司</li><li id="2d0e" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated">💼职业发展</li><li id="a99c" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated">🌱开源</li><li id="30c0" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated">✍️内容创作</li></ul><p id="29bf" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">让我们连接起来，</p><ul class=""><li id="a8fa" class="mm mn in kq b kr ks ku kv kx mo lb mp lf mq lj mr ms mt mu bi translated"><a class="ae lk" href="https://twitter.com/tapasadhikary" rel="noopener ugc nofollow" target="_blank">在Twitter上关注</a></li><li id="7437" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated"><a class="ae lk" href="https://www.youtube.com/tapasadhikary?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank">订阅我的YouTube频道</a></li><li id="25fb" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated"><a class="ae lk" href="https://github.com/atapas" rel="noopener ugc nofollow" target="_blank">GitHub上的侧项目</a></li><li id="c9e7" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated"><a class="ae lk" href="https://www.showwcase.com/community/react.js" rel="noopener ugc nofollow" target="_blank"> Showwcase React社区</a></li></ul></div><div class="ab cl nn no hr np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ig ih ii ij ik"><p id="efe7" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="nm">原载于</em><a class="ae lk" href="https://blog.greenroots.info/react-useeffect-hook-usages-you-must-know" rel="noopener ugc nofollow" target="_blank"><em class="nm">https://blog . greenroots . info</em></a><em class="nm">。</em></p><p id="52d0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="nm">更多内容请看</em><a class="ae lk" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="nm">plain English . io</em></strong></a><em class="nm">。报名参加我们的</em> <a class="ae lk" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="nm">免费周报</em> </strong> </a> <em class="nm">。关注我们关于</em><a class="ae lk" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="nm">Twitter</em></strong></a><em class="nm">和</em><strong class="kq io"><em class="nm"/></strong><a class="ae lk" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="nm">LinkedIn</em></strong></a><em class="nm">。加入我们的</em> <a class="ae lk" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="nm">社区</em> </strong> </a> <em class="nm">。</em></p></div></div>    
</body>
</html>