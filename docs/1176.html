<html>
<head>
<title>How To Secure Your NGINX Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何保护你的NGINX服务器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-secure-your-nginx-server-3359dfce8b8b?source=collection_archive---------0-----------------------#2022-03-08">https://javascript.plainenglish.io/how-to-secure-your-nginx-server-3359dfce8b8b?source=collection_archive---------0-----------------------#2022-03-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0d24" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">关于如何保护NGINX服务器的简要指南</h2></div><p id="ab97" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">安全</strong>变得越来越重要。现代软件在帮助我们开发安全软件方面变得越来越好，但最重要的是，我们必须做一些额外的努力来为我们的产品获得更多的安全性。今天，我想给你一个简单的指导，告诉你如何保护你的<a class="ae lb" href="https://www.nginx.com/" rel="noopener ugc nofollow" target="_blank"> NGINX </a>服务器。</p><p id="3b5e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本指南基于安装在Linux机器上的Express (Node.js)示例，从头开始。这意味着我们将在配置NGINX配置之前安装NGINX，Node.js。</p><p id="6e01" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不要担心，一切都会尽可能的简单。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/bf2973663f601431bb3691690788c7e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m6XtCLaSCqVLE8T6"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">Photo by <a class="ae lb" href="https://unsplash.com/@lucabravo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Luca Bravo</a> on <a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7950" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们需要一个服务器。对于本指南，我在<a class="ae lb" href="https://aws.amazon.com/free" rel="noopener ugc nofollow" target="_blank"> AWS </a>上获得了一个新鲜的<a class="ae lb" href="https://aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank"> EC2 </a>实例(Ubuntu Server 20.04 LTS) <strong class="kh ir">。你可以使用你喜欢的任何东西，但是我猜你已经有一个服务器在运行了，否则，你就不会在这里了，对吗？</strong></p><h1 id="5e1b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">安装NGINX</h1><p id="0251" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">假设你已经连接到你的服务器，我们将安装NGINX并设置它。</p><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="978c" class="mu lt iq mq b gy mv mw l mx my">$ sudo apt update<br/>$ sudo apt install nginx nginx-extras -y<br/>$ sudo systemctl enable nginx<br/>$ sudo systemctl restart nginx</span></pre><p id="cdda" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们检查一下是否一切都好。</p><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="9804" class="mu lt iq mq b gy mv mw l mx my">$ sudo systemctl status nginx</span></pre><p id="25b0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">终端中的输出应该是这样的:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi mz"><img src="../Images/6a9df305f0644916d5e5d09fd2644ece.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cs52I8Cv57aB9BaUktoFZQ.png"/></div></div></figure><h1 id="be6a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">安装Node.js</h1><p id="a95b" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">正如我所说的，我将基于Node.js来演示这一点，你基本上可以通过使用<code class="fe na nb nc mq b">/var/www/html</code>来跳过这一部分。</p><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="7c87" class="mu lt iq mq b gy mv mw l mx my">$ sudo curl -sL https://deb.nodesource.com/setup_14.x | sudo bash -<br/>$ sudo apt install nodejs -y</span></pre><p id="0013" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们通过执行以下命令来检查是否一切正常</p><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="d1d7" class="mu lt iq mq b gy mv mw l mx my">$ node  -v<br/>v14.19.0</span></pre><h1 id="e1f4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">设置Express服务器</h1><p id="4e64" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">别担心，我会尽量简单。</p><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="5489" class="mu lt iq mq b gy mv mw l mx my">$ npm init -y<br/>$ npm install express</span></pre><p id="cb69" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在让我们创建我们的<code class="fe na nb nc mq b">index.js</code>。</p><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="2170" class="mu lt iq mq b gy mv mw l mx my">$ nano index.js</span></pre><p id="ea9c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我们添加了一个非常简单的Express示例代码:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">index.js</figcaption></figure><h1 id="66c1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">配置NGINX</h1><p id="90fe" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">因此，首先我向您展示了一种在NGINX上使用Node.js服务器应用程序的非常标准的方法，没有任何安全性，因为我看到它们在互联网上广泛传播。跟我呆在一起。</p><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="173b" class="mu lt iq mq b gy mv mw l mx my">$ nano /etc/nginx/sites-available/default</span></pre><p id="112e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我们将把内容替换为:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">/etc/nginx/sites-available/default</figcaption></figure><p id="4de6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这段代码告诉NGINX将端口80指向运行在端口3000上的ExpressJS服务器。</p><p id="323f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，让我们重新启动NGINX服务来看看我们的变化。</p><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="a2a9" class="mu lt iq mq b gy mv mw l mx my">$ sudo systemctl restart nginx</span></pre><p id="b2a0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我将运行我们的快速应用程序:</p><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="7430" class="mu lt iq mq b gy mv mw l mx my">$ node index.js</span></pre><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi mz"><img src="../Images/abc31c8d77f7ed52aaf331b868a47ac2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dUAO4Y_o3SfJHQXFGnLdBQ.png"/></div></div></figure><p id="f343" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">服务器正在运行，NGINX已经设置好，所以我要在浏览器上访问我的服务器。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nf"><img src="../Images/ece33de647f258cb9f69874e4284881e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jSpccUsim1pXPG1aoh-pZQ.png"/></div></div></figure><p id="0415" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一切按预期运行。现在让我们看看响应头。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi ng"><img src="../Images/ec79858ad94b13d1655ef098b84cfff2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MfT6AShy-xphQAVl3SUsQw.png"/></div></div></figure><p id="7933" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们在这里看到的是我们暴露的大量敏感数据。例如，如果黑客知道服务器构建在什么样的框架或NGINX版本上，情况会变得很危险。所以让我们去掉这些易受攻击的数据。</p><h1 id="7dd0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">保护我们的NGINX配置</h1><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="1486" class="mu lt iq mq b gy mv mw l mx my">$ nano /etc/nginx/sites-available/default</span></pre><p id="4e9e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我们将用以下内容替换所有配置:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="d90b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们在第13行到第20行添加了一系列配置，以提高我们的服务器安全性。</p><h2 id="35bc" class="mu lt iq bd lu nh ni dn ly nj nk dp mc ko nl nm me ks nn no mg kw np nq mi nr bi translated">说明</h2><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="762d" class="mu lt iq mq b gy mv mw l mx my">Line 14: server_tokens off;</span></pre><p id="6557" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将删除NGINX版本号。默认情况下，它的选项是启用的。</p><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="47bb" class="mu lt iq mq b gy mv mw l mx my">Line 15: proxy_hide_header X-powered-by;</span></pre><p id="e0af" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将删除响应报头<code class="fe na nb nc mq b">x-powered-by</code>。基于我们的例子，我们删除了我们的服务器在ExpressJS上运行的信息。</p><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="c5ae" class="mu lt iq mq b gy mv mw l mx my">Line 16: proxy_hide_header X-Runtime;</span></pre><p id="6b8e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">X-Runtime HTTP响应头用于提供应用程序处理每个请求所需的时间。这种行为可被用于收集攻击，在这种攻击中，值可用于确认一条信息(如用户名)是否有效。</p><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="681b" class="mu lt iq mq b gy mv mw l mx my">Line 17: add_header X-XSS-Protection "1; mode=block";</span></pre><p id="99d0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该标题启用了内置于最新web浏览器中的跨站点脚本(XSS)过滤器。</p><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="7691" class="mu lt iq mq b gy mv mw l mx my">Line 18: add_header X-Frame-Options "deny";</span></pre><p id="b170" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该标题不允许浏览器在框架或iframe中呈现页面。</p><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="a3bc" class="mu lt iq mq b gy mv mw l mx my">Line 19: add_header X-Content-Type-Options "nosniff";</span></pre><p id="b55f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个标题在大多数浏览器上禁用了内容类型嗅探。</p><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="b18d" class="mu lt iq mq b gy mv mw l mx my">Line 20: more_clear_headers Server;</span></pre><p id="fd39" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这一行是类固醇的第14行。它完全删除了响应头<code class="fe na nb nc mq b">server</code>，所以我们甚至没有暴露我们的服务器运行在NGINX上的事实。这一行使得第14行变得多余，但是我想向您展示这两个选项。</p><p id="35fe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们再次重启我们的NGINX服务器，不要忘记重启我们的Express服务器。</p><pre class="ld le lf lg gt mp mq mr ms aw mt bi"><span id="48ec" class="mu lt iq mq b gy mv mw l mx my">$ sudo systemctl restart nginx<br/>$ node index.js</span></pre><p id="37eb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们再次查看我们的响应头。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi ng"><img src="../Images/56bed71b3db25340a64b8667653746c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eKQUL5a_TguwGqXssdCJAQ.png"/></div></div></figure><p id="9d43" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很好，我们不再暴露易受攻击的信息，同时我们添加了一些帮助我们保护服务器的标题。</p><p id="3724" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢您阅读我关于如何保护NGINX服务器的文章。有更多的方法可以最小化这样的风险，但是我希望这给你一个好的开始。</p><p id="d251" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">干杯！</p></div><div class="ab cl ns nt hu nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="ij ik il im in"><p id="1bd4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望你喜欢读这篇文章。如果你愿意支持我成为一名作家，可以考虑注册<a class="ae lb" href="https://medium.com/@hellokevinvogel/membership" rel="noopener">成为</a>的媒体成员。每月只需5美元，你就可以无限制地使用Medium。</p><p id="4cc3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">想支持我？<a class="ae lb" href="https://www.buymeacoffee.com/hellokevinvogel" rel="noopener ugc nofollow" target="_blank">给我买杯咖啡。</a></p></div><div class="ab cl ns nt hu nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="ij ik il im in"><h1 id="14a9" class="ls lt iq bd lu lv nz lx ly lz oa mb mc jw ob jx me jz oc ka mg kc od kd mi mj bi translated">接下来阅读</h1><div class="oe of gp gr og oh"><a href="https://blog.bitsrc.io/solid-principles-in-typescript-153e6923ffdb" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">打字稿中的坚实原则</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">TypeScript对用JavaScript编写干净的代码产生了巨大的影响。但是总有办法…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">blog.bitsrc.io</p></div></div><div class="oq l"><div class="or l os ot ou oq ov lm oh"/></div></div></a></div><div class="oe of gp gr og oh"><a href="https://blog.devgenius.io/object-orientated-programming-oop-in-typescript-c1066941f5ee" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">TypeScript中的面向对象编程(OOP)</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">TypeScript对JavaScript中面向对象编程的实现有很大的影响。今天，我想谈谈…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">blog.devgenius.io</p></div></div><div class="oq l"><div class="ow l os ot ou oq ov lm oh"/></div></div></a></div><div class="oe of gp gr og oh"><a href="https://blog.bitsrc.io/10-quick-typescript-one-liners-128a2721345" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">10个快速打印的一行程序</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">将提高生产力的JavaScript / TypeScript一行程序</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">blog.bitsrc.io</p></div></div><div class="oq l"><div class="ox l os ot ou oq ov lm oh"/></div></div></a></div><p id="62ac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="oy">更多内容请看</em><a class="ae lb" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="oy">plain English . io</em></strong></a><em class="oy">。报名参加我们的</em> <a class="ae lb" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> <em class="oy">免费周报</em> </strong> </a> <em class="oy">。关注我们关于</em><a class="ae lb" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="oy">Twitter</em></strong></a><em class="oy">和</em><a class="ae lb" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="oy">LinkedIn</em></strong></a><em class="oy">。加入我们的</em> <a class="ae lb" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> <em class="oy">社区不和谐</em> </strong> </a> <em class="oy">。</em></p></div></div>    
</body>
</html>