<html>
<head>
<title>A Powerful Trick to Batch Promises Using Async Generators in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在JavaScript中使用异步生成器批量承诺的强大技巧</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/a-powerful-trick-to-batch-promises-using-async-generators-in-javascript-6032f872676f?source=collection_archive---------8-----------------------#2022-05-30">https://javascript.plainenglish.io/a-powerful-trick-to-batch-promises-using-async-generators-in-javascript-6032f872676f?source=collection_archive---------8-----------------------#2022-05-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="84f3" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">关于如何在JavaScript中使用异步生成器批量承诺的教程。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/178f4780a6daecf0af5e6976c68316ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nm1hHwFnUcBnosBLdT3-Fw.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@aaronphs?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Aaron Thomas</a> on <a class="ae ks" href="https://unsplash.com/@aaronphs?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1401" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当您必须迭代一个集合并在每次迭代中执行昂贵的异步任务时，批处理非常有用。<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for-await...of#iterating_over_async_generators" rel="noopener ugc nofollow" target="_blank">异步发生器</a>使得这个非常容易实现。</p><p id="9c50" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这个例子中，我们将查看一个简单的带有可调整并发限制(一次批处理的任务数)的数组块批处理。我们将使用名为<code class="fe lp lq lr ls b">Task</code>的类型来表示返回<code class="fe lp lq lr ls b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" rel="noopener ugc nofollow" target="_blank">Promise</a></code>的异步计算。</p><p id="22d4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe lp lq lr ls b">Task</code>是任何返回承诺的函数。承诺并不是天生懒惰的，它们一建立起来就开始执行。将它们封装在一个函数中，可以让我们控制何时执行这个承诺。</p><h1 id="ad67" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">实施:</h1><ul class=""><li id="dfce" class="ml mm in kv b kw mn kz mo lc mp lg mq lk mr lo ms mt mu mv bi translated">给定一个数组<code class="fe lp lq lr ls b">Tasks</code>，我们想要在我们的并发限制(批处理大小)的“步骤”中迭代它，我们将为此使用一个简单的for循环。</li><li id="fd10" class="ml mm in kv b kw mw kz mx lc my lg mz lk na lo ms mt mu mv bi translated">我们希望能够并发执行该批任务并等待它们。我们可能需要使用<code class="fe lp lq lr ls b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all" rel="noopener ugc nofollow" target="_blank">Promise.all</a></code>方法，在异步函数和<code class="fe lp lq lr ls b">await</code>批处理任务的执行上下文中完成。</li><li id="a7d6" class="ml mm in kv b kw mw kz mx lc my lg mz lk na lo ms mt mu mv bi translated">可选地，我们想要附加一个回调，当我们的任务批处理成功时，我们可以调用这个回调。</li><li id="29b5" class="ml mm in kv b kw mw kz mx lc my lg mz lk na lo ms mt mu mv bi translated">最后，当一批任务完成时，我们希望通知消费者任务已经完成，这样他们就可以继续他们的异步迭代。</li></ul><p id="1b32" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这最后一点是<code class="fe lp lq lr ls b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*" rel="noopener ugc nofollow" target="_blank">Async Generators</a></code>可以帮助我们变魔术的地方！他们允许我们在异步生成器函数中使用<code class="fe lp lq lr ls b">await</code>语法(使用<code class="fe lp lq lr ls b">async function*</code>语法声明)。这就释放了异步迭代承诺并一个接一个地<code class="fe lp lq lr ls b">await</code>它们的能力。</p><p id="830f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下面是我们计划的执行情况:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="4f0c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe lp lq lr ls b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*" rel="noopener ugc nofollow" target="_blank">Async Generators</a></code>也让我们<code class="fe lp lq lr ls b">yield</code>将这些期待的值传递给生成器函数的消费者。这允许他们使用简洁的<code class="fe lp lq lr ls b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for-await...of" rel="noopener ugc nofollow" target="_blank">for await (...)</a></code>循环语法异步迭代数据🎉</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="6bcd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这个堆栈展示了我们的任务批处理程序的一个简单实现。尽情享受吧！</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nd nc l"/></div></figure><p id="0ae6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您可以进一步使用基于池的方法进行批处理，使用<code class="fe lp lq lr ls b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/race" rel="noopener ugc nofollow" target="_blank">Promise.race</a></code>方法来检测和填充任务池中的空白点。:D</p><p id="cf15" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请随时联系我，让我知道它是如何为你工作的；)</p><p id="c08f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">快乐工程！</p></div><div class="ab cl ne nf hr ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ig ih ii ij ik"><p id="82cf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> <em class="nl">如需更多此类文章更新请订阅</em> </strong> <a class="ae ks" href="https://www.bytelimes.com/#/portal/signup/free" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nl">我的免费简讯</em> </strong> </a> <strong class="kv io"> <em class="nl">。</em> </strong></p><p id="bc92" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="nl">更多内容看</em> <a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nl">说白了。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nl">免费每周简讯</em> </strong> </a> <em class="nl">。关注我们</em> <a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nl">推特</em> </strong> </a> <em class="nl">和</em><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nl">LinkedIn</em></strong></a><em class="nl">。查看我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nl">社区不和谐</em> </strong> </a> <em class="nl">加入我们的</em> <a class="ae ks" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nl">人才集体</em> </strong> </a> <em class="nl">。</em></strong></a></p></div></div>    
</body>
</html>