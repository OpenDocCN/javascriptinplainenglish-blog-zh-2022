<html>
<head>
<title>Let’s Add Swift Guards to JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们给JavaScript添加Swift Guards</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/lets-add-swift-guards-to-javascript-42767b99a3ba?source=collection_archive---------12-----------------------#2022-06-21">https://javascript.plainenglish.io/lets-add-swift-guards-to-javascript-42767b99a3ba?source=collection_archive---------12-----------------------#2022-06-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/2c871de92f9ac00c699545d12a1da725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KUe64K_tsY2vt-29"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@clemhlrdt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Clément Hélardot</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><blockquote class="ka kb kc"><p id="93d7" class="kd ke kf kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">“如果所有其他人都接受了党强加的谎言——如果所有的记录都讲述了同样的故事——那么这个谎言就会成为历史，成为真理。共产党的口号是“谁控制了过去，谁就控制了未来；谁控制了现在，谁就控制了过去””，——《1984》，乔治·奥威尔</p></blockquote><p id="1058" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated"><a class="ae jz" href="https://medium.com/@coderaiser/how-to-extend-javascript-parser-with-a-new-keyword-36d79be21ef8" rel="noopener">上次</a>我们给JavaScript添加了<code class="fe lf lg lh li b">fn</code>关键字，让我们试试更复杂的:【Swift的卫士。</p><p id="d76f" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">下面是一个简短的例子:</p><pre class="lj lk ll lm gt ln li lo lp aw lq bi"><span id="6a2f" class="lr ls in li b gy lt lu l lv lw">fn hello() {<br/>    guard (text !== "world") else {<br/>        return "";<br/>    }<br/>        <br/>    return "Hello " + text;<br/>}</span></pre><p id="500e" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">这是JavaScript版本:</p><pre class="lj lk ll lm gt ln li lo lp aw lq bi"><span id="307e" class="lr ls in li b gy lt lu l lv lw">function hello() {<br/>    if (!(text !== 'world')) {<br/>        return '';<br/>    }<br/><br/>    return 'Hello ' + text;<br/>}</span></pre><p id="befc" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">如你所见，<code class="fe lf lg lh li b">guard</code>做的是反转一个表达式，所以它不像<code class="fe lf lg lh li b">IfStatement</code> + <code class="fe lf lg lh li b">UnaryExpression</code>。听起来很有趣不是吗:)？我们走吧！</p><h1 id="6ecf" class="lx ls in bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">添加保护关键字</h1><p id="1488" class="pw-post-body-paragraph kd ke in kg b kh mu kj kk kl mv kn ko lc mw kr ks ld mx kv kw le my kz la lb ig bi translated">首先，我们需要添加一个新的关键字类型:</p><pre class="lj lk ll lm gt ln li lo lp aw lq bi"><span id="1412" class="lr ls in li b gy lt lu l lv lw">function newSpeak(Parser) {<br/>    Parser.acorn.keywordTypes.guard = new TokenType('guard', {<br/>        keyword: 'guard',<br/>    });<br/>}</span></pre><p id="af66" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">然后，我们应该在关键字列表中添加一个新的关键字(如前一篇文章所述)。</p><pre class="lj lk ll lm gt ln li lo lp aw lq bi"><span id="8733" class="lr ls in li b gy lt lu l lv lw">function newSpeak(Parser) {   <br/>    Parser.acorn.keywordTypes.guard = new TokenType('guard', {<br/>        keyword: 'guard',<br/>    });<br/>    <br/>    return class extends Parser {<br/>        parse() {<br/>            this.keywords = addKeyword('guard', keywords);<br/>            return super.parse();<br/>        }<br/>    }</span><span id="467f" class="lr ls in li b gy mz lu l lv lw">}</span></pre><p id="4ac5" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">然后我们需要<code class="fe lf lg lh li b">parseStatement</code>:</p><pre class="lj lk ll lm gt ln li lo lp aw lq bi"><span id="4fa8" class="lr ls in li b gy lt lu l lv lw">class extends Parser {<br/>        parseStatement(context, topLevel, exports) {<br/>            if (this.type === Parser.acorn.keywordTypes.guard) {<br/>                return this.parseGuard(context, topLevel, exports);<br/>            }<br/><br/>            return super.parseStatement(context, topLevel, exports);<br/>        }<br/>        <br/>        parseGuard() {<br/>            this.next();<br/><br/>            const node = this.startNode();<br/>            <br/>            this.expect(tt.parenL);<br/>            <br/>            node.test = {<br/>                type: 'UnaryExpression',<br/>                operator: '!',<br/>                prefix: true,<br/>                argument: this.parseExpression(),<br/>            };<br/>            this.expect(tt.parenR);<br/>            this.expect(tt._else);<br/>    <br/>            node.consequent = this.parseStatement();<br/>            node.alternate = null;<br/>            <br/>            return this.finishNode(node, 'IfStatement');<br/>        }<br/>    };</span></pre><p id="5032" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">在<code class="fe lf lg lh li b">parseGuard</code>中实际做的是用<code class="fe lf lg lh li b">UnaryExpression</code> not创建一个新的<code class="fe lf lg lh li b">IfStatement</code>，它具有从代码中解析的原始表达式。</p><p id="08dc" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">它不应该有任何<code class="fe lf lg lh li b">else</code>，所以<code class="fe lf lg lh li b">alternate</code>是<code class="fe lf lg lh li b">null</code>，<code class="fe lf lg lh li b">consequent</code>是传递给<code class="fe lf lg lh li b">guard</code>的原始语句。</p><p id="7822" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">整个代码将是这样的:</p><pre class="lj lk ll lm gt ln li lo lp aw lq bi"><span id="65fd" class="lr ls in li b gy lt lu l lv lw">const {TokenType, tokTypes: tt} = require(<a class="ae jz" href="https://github.com/acornjs/acorn" rel="noopener ugc nofollow" target="_blank">'acorn'</a>);</span><span id="a0fb" class="lr ls in li b gy mz lu l lv lw">const {print} = require(<a class="ae jz" href="https://github.com/coderaiser/putout" rel="noopener ugc nofollow" target="_blank">'putout'</a>);<br/>const {Parser} = require('acorn');</span><span id="62dd" class="lr ls in li b gy mz lu l lv lw">function newSpeak(Parser) {<br/>    Parser.acorn.keywordTypes.fn = new TokenType('fn', {<br/>        keyword: 'fn',<br/>    });<br/>    <br/>    Parser.acorn.keywordTypes.guard = new TokenType('guard', {<br/>        keyword: 'guard',<br/>    });<br/>    <br/>    return class extends Parser {<br/>        parse() {<br/>            const keywords = addKeyword('fn', this.keywords);<br/>            this.keywords = addKeyword('guard', keywords);<br/>            <br/>            return super.parse();<br/>        }<br/>        parseStatement(context, topLevel, exports) {<br/>            if (this.type === Parser.acorn.keywordTypes.fn) {<br/>                this.type = Parser.acorn.keywordTypes.function;<br/>            }<br/>            <br/>            if (this.type === Parser.acorn.keywordTypes.guard) {<br/>                return this.parseGuard(context, topLevel, exports);<br/>            }<br/><br/>            return super.parseStatement(context, topLevel, exports);<br/>        }<br/>        <br/>        parseGuard() {<br/>            this.next();<br/><br/>            const node = this.startNode();<br/>            <br/>            this.expect(tt.parenL);<br/>            <br/>            node.test = {<br/>                type: 'UnaryExpression',<br/>                operator: '!',<br/>                prefix: true,<br/>                argument: this.parseExpression(),<br/>            };<br/>            this.expect(tt.parenR);<br/>            this.expect(tt._else);<br/>    <br/>            node.consequent = this.parseStatement();<br/>            node.alternate = null;<br/>            <br/>            return this.finishNode(node, 'IfStatement');<br/>        }<br/>    };<br/>};<br/><br/>function addKeyword(keyword, keywords) {<br/>    const str = keywords<br/>        .toString()<br/>        .replace(')$', `|${keyword})$`)<br/>        .slice(1, -1);<br/>    <br/>    return RegExp(str);<br/>}<br/><br/>const {stringify} = JSON;<br/><br/>const MyParser = Parser.extend(<br/>    newSpeak,<br/>);<br/><br/>const ast = MyParser.parse(`<br/>    fn hello() {<br/>        guard (text !== "world") else {<br/>            return ""<br/>        }<br/>        <br/>        return "Hello " + text<br/>    }<br/>`);<br/><br/>console.log(stringify(ast, null, 4));<br/><br/>console.log(print(ast));<br/>// returns<br/>`<br/>function hello() {<br/>    if (!(text !== 'world')) {<br/>        return '';<br/>    }<br/><br/>    return 'Hello ' + text;<br/>}<br/>`</span></pre><p id="fac0" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">今天就到这里吧！如果你有关于新代码构造的想法，只需在<a class="ae jz" href="https://github.com/coderaiser/goldstein" rel="noopener ugc nofollow" target="_blank"><strong class="kg io">Goldstein</strong></a><strong class="kg io"/>资源库中创建一个问题，它包含一个新的<strong class="kg io"> JavaScript </strong>编译器，没有限制😏。</p><p id="ccfd" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated"><em class="kf">更多内容请看</em><a class="ae jz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kg io"><em class="kf">plain English . io</em></strong></a><em class="kf">。报名参加我们的</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kg io"> <em class="kf">免费周报</em> </strong> </a> <em class="kf">。关注我们关于</em><a class="ae jz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kg io"><em class="kf">Twitter</em></strong></a><em class="kf">和</em><a class="ae jz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kg io"><em class="kf">LinkedIn</em></strong></a><em class="kf">。查看我们的</em> <a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kg io"> <em class="kf">社区不和谐</em> </strong> </a> <em class="kf">加入我们的</em> <a class="ae jz" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kg io"> <em class="kf">人才集体</em> </strong> </a> <em class="kf">。</em></p></div></div>    
</body>
</html>