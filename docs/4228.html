<html>
<head>
<title>Chromium-Powered Taint Tracking</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">铬动力污点追踪</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/chromium-powered-taint-tracking-21922692da91?source=collection_archive---------9-----------------------#2022-11-10">https://javascript.plainenglish.io/chromium-powered-taint-tracking-21922692da91?source=collection_archive---------9-----------------------#2022-11-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/24981e78f8df37e9fd6de2fda9023af3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*am5TciZJmlrFc_sJeSnC1g.png"/></div></div></figure><p id="6ebe" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这一章中，我将讨论Chromium驱动的污点跟踪。我修改了V8和bink，以提供一种方式来观察给定流程中从变量<code class="fe kt ku kv kw b">x</code>到变量<code class="fe kt ku kv kw b">y</code>的信息传输，即污点跟踪。</p><h1 id="008f" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak"> 1。特色</strong></h1><ul class=""><li id="30ef" class="lv lw in jx b jy lx kc ly kg lz kk ma ko mb ks mc md me mf bi translated">跟踪数据从出生到死亡，以及它参与的所有操作。</li><li id="8285" class="lv lw in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">跟踪JS APIs和DOM APIs、调用者、参数和返回。</li><li id="70cb" class="lv lw in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">跟踪控制流，什么数据与控制流相关，以及数据如何影响控制流的方向。</li><li id="063a" class="lv lw in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">跟踪数据流，哪些数据与数据流相关，以及数据如何影响数据流的方向。</li><li id="a4eb" class="lv lw in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">跟踪可能影响控制流方向的API。</li><li id="a522" class="lv lw in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">跟踪可能影响数据流方向的API。</li><li id="09bd" class="lv lw in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">跟踪JavaScript和DOM树之间的交互。</li></ul><h1 id="d566" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak"> 2。挂钩V8 </strong></h1><p id="b0f0" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">基本原理是信息流技术。信息论语境中的信息流是在给定过程中，信息从变量x到变量y的传递。所以我将这项技术嵌入到铬合金中。因为它是web应用程序的运行时环境，无论你想知道什么行为，你都能看到！</p><h2 id="95fa" class="mo ky in bd kz mp mq dn ld mr ms dp lh kg mt mu ll kk mv mw lp ko mx my lt mz bi translated">2.1跟踪字节码中的行为</h2><p id="c259" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">V8是用C++语言和面向对象方法实现的。HeapObject是V8中堆管理对象的基类。我们在HeapObject中添加了一个指针成员来存储对象的行为。当创建一个对象时，我们记录这个对象的生产者。当对象参与计算时，我们更新它的行为。例如，当一个对象被传入一个函数时(在V8中，一个函数也是一个HeapObject对象)，我们更新函数的行为来记录这个函数是对象的消费者。我们还将更新这个对象的行为来记录它的转换。</p><h2 id="f6c9" class="mo ky in bd kz mp mq dn ld mr ms dp lh kg mt mu ll kk mv mw lp ko mx my lt mz bi translated"><strong class="ak"> 2.2跟踪机器代码中的行为</strong></h2><p id="5c73" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">解释器和JIT是V8中两个不同的执行单元。解释器是用OOP设计的，所以我们可以直接操作HeapObjcet的指针成员来跟踪、更新和传播行为。但在JIT模式下，V8使用推测性优化技术，删除无用信息，我们的行为也被删除。为了确保行为可用，我们重写了JIT的近2000个内置函数(这是V8的术语，内部方法)。</p><h2 id="6ffc" class="mo ky in bd kz mp mq dn ld mr ms dp lh kg mt mu ll kk mv mw lp ko mx my lt mz bi translated"><strong class="ak"> 2.3在GC中维护行为</strong></h2><p id="f172" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">最初，我没有将行为存储在HeapObject中，而是单独存储。这样我们就需要保持行为的生命周期与owner对象一致，在V8 GC收集owner的时候也要释放它的行为。有这样一个困难:当两个或多个所有者对象引用同一个行为，并且在一个对象被V8收集后，我们不能立即释放该行为，因为另一个对象仍在引用该行为，我们必须遍历V8堆，并确保在该行为被释放前没有引用。</p><p id="67ff" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，我在HeapObject类中创建了一个新的成员变量来存储行为，这样行为就和V8的其他内部对象一样，由V8 GC管理，不需要额外的关注。</p><h1 id="1246" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak"> 3。挂钩闪烁</strong></h1><p id="f3f0" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">我对Blink做了和V8几乎一样的修改。以下是我们为Blink增加的重要功能。</p><h2 id="b083" class="mo ky in bd kz mp mq dn ld mr ms dp lh kg mt mu ll kk mv mw lp ko mx my lt mz bi translated"><strong class="ak"> 3.1反馈</strong></h2><p id="b8ac" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">反馈是web应用程序在Blink中运行时产生的行为。在Blink中收集行为，然后反馈给V8跟踪引擎，所以它被称为反馈。简单来说:V8中收集的行为叫trace，Blink中收集的行为叫feedback。</p><h2 id="5dcd" class="mo ky in bd kz mp mq dn ld mr ms dp lh kg mt mu ll kk mv mw lp ko mx my lt mz bi translated"><strong class="ak"> 3.2令牌解析器</strong></h2><p id="8718" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">当V8的一个HeapObject进入Blink时，很可能会改变DOM，所以Blink会重新渲染DOM树。Token Parser会删除或忽略HeapObject携带的行为，所以我们重写了Token Parser的大部分内容，以确保V8的trace和Blink的反馈能够正确交互。</p><h2 id="4c54" class="mo ky in bd kz mp mq dn ld mr ms dp lh kg mt mu ll kk mv mw lp ko mx my lt mz bi translated"><strong class="ak">3.3 V8和闪烁之间的传输行为</strong></h2><p id="cfc9" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">Blink和V8都使用弱/强引用机制，因此我们还必须确保反馈和跟踪之间的引用关系与它们的所有者相同。Blink使用包装器类来管理自身和V8之间的引用，因此我们重写了包装器类，以确保包装器可以在Blink与V8交互期间管理反馈和跟踪的生命周期。</p><h1 id="2486" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak"> 4。成就</strong></h1><h2 id="fb53" class="mo ky in bd kz mp mq dn ld mr ms dp lh kg mt mu ll kk mv mw lp ko mx my lt mz bi translated"><strong class="ak"> 4.1为DOM-XSS生成漏洞</strong></h2><p id="c5c8" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">一般来说，利用依赖于上下文。这意味着当攻击者想要进行DOM-XSS时，他需要知道什么是输入，以及输入如何在接收器中流动。最后，他需要打破水槽周围的语法。我的工具得到的行为包含了描述从输入到接收的数据传播的所有必要信息。因此，我们使用抽象语法树FSM来生成可以正确触发XSS的漏洞。我已经通过工具向SRC提交了一些bug。</p><h2 id="2ceb" class="mo ky in bd kz mp mq dn ld mr ms dp lh kg mt mu ll kk mv mw lp ko mx my lt mz bi translated"><strong class="ak"> 4.2 Web app行为分析</strong></h2><p id="97f1" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">我们知道嵌入Chrome的应用非常普遍，我的工具可以帮助应用所有者捕捉他们的应用行为。有了这些行为，你就可以知道哪里是耗时的，比如为什么你的记忆经常保持在高临界状态。因此，您可以优化您的应用程序以获得更好的用户体验，并且还可以发现应用程序中的逻辑问题。</p><p id="222d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">好了，这部分就到此为止了。下次再见，保重！</p><p id="c851" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你有任何问题，请联系我。<strong class="jx io">微信</strong> : qq9123013 <strong class="jx io">邮箱</strong>:<a class="ae nb" href="mailto:v8blink@outlook.com" rel="noopener ugc nofollow" target="_blank">v8blink@outlook.com</a></p></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><p id="5ae0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="na">更多内容看</em> <a class="ae nb" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="na">说白了。报名参加我们的</em> <a class="ae nb" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="na">免费周报</em> </strong> </a> <em class="na">。关注我们关于</em> <a class="ae nb" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="na">推特</em> </strong> </a>，<a class="ae nb" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="na">LinkedIn</em></strong></a><em class="na">，</em><a class="ae nb" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="na">YouTube</em></strong></a><em class="na">，以及</em> <a class="ae nb" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="na">不和</em> </strong> </a> <em class="na">。对增长黑客感兴趣？检查</em> <a class="ae nb" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="na">电路</em> </strong> </a> <em class="na">。</em></strong></a></p></div></div>    
</body>
</html>