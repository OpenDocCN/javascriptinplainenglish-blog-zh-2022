# React useEffect æŒ‚é’©æœªæ–­å¼€ï¼›ä½ çš„ä»£ç æ˜¯

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/reactjs-useeffect-is-not-broken-your-code-is-5d0a80b24b53?source=collection_archive---------0----------------------->

## useEffect é’©å­åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹æœ‰ä¸€ä¸ªâ€œdouble-callâ€bugï¼Œä½†ä¸æ˜¯ bugï¼›è¿™æ˜¯ä¸€ä¸ªç‰¹ç‚¹ã€‚

![](img/976023e8db7270cf9ff813d700c79056.png)

æ‚¨æ­£åœ¨ä½¿ç”¨ React 18ï¼Œå¹¶ä¸”å·²ç»è½¬ç§»åˆ°åŠŸèƒ½ç»„ä»¶ã€‚ç„¶åï¼Œæ‚¨æ„è¯†åˆ°æ²¡æœ‰åŠæ³•æ§åˆ¶ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸èƒ½åœ¨å‡½æ•°ä¸­è¦†ç›–å‡½æ•°ï¼

ä½ å»è°·æ­Œæ‰¾åˆ°äº†`**useEffect**`é’©å­ï¼Œå¹¶æ„è¯†åˆ°å½“ä½ ä½¿ç”¨ä¸€ä¸ªç©ºçš„ä¾èµ–æ•°ç»„æ—¶ï¼Œ`useEffect`é’©å­çš„è¡Œä¸ºå°±åƒæ˜¯`**componentDidMount**`æ–¹æ³•ã€‚ä½†æ˜¯åªæœ‰ä¸€ä¸ªé—®é¢˜:`useEffect`è°ƒç”¨ä½ çš„å‡½æ•°ä¸¤æ¬¡ï¼

# é‚£ä¹ˆé—®é¢˜å‡ºåœ¨å“ªé‡Œï¼Ÿ

![](img/bdff8a7190a749a133a4eca8cd787c64.png)

Simple counter for the number of times useEffect is called

ä¸Šé¢çš„ TSX ä»£ç åˆ›å»ºäº†ä¸€ä¸ªåä¸º`count`çš„çŠ¶æ€å˜é‡ï¼Œå¹¶ä¸”åªæœ‰åœ¨ç»„ä»¶æŒ‚è½½åæ‰ä¼šç”Ÿæ•ˆã€‚æ•ˆæœå°†`count`å¢åŠ `1`ã€‚å½“æˆ‘ä»¬å‘ˆç°è¯¥ç»„ä»¶æ—¶ï¼Œæ‚¨ä¼šçœ‹åˆ°ä»¥ä¸‹é¡µé¢:

![](img/b06b70c45e88e3368f4e4e5016a2f8f5.png)

`useEffect`è¢«è°ƒç”¨ä¸¤æ¬¡ã€‚ä¸€ä¸ªç®€å•ä½†ç³Ÿç³•çš„è§£å†³æ–¹æ¡ˆæ˜¯åˆ é™¤ä¸¥æ ¼æ¨¡å¼:

![](img/a41a986208baffffbbdb293ac095d9fe.png)

Strict mode is commented out

ç¦ç”¨ä¸¥æ ¼æ¨¡å¼æ˜¯ä¸€ä¸ªç³Ÿç³•çš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºå®ƒå¸®åŠ©æ‚¨è°ƒè¯•ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚å¯¹ä½ æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Ÿç»§ç»­è¯»ã€‚

# æ¸…ç†æ‚¨çš„ç»„ä»¶

`useEffect`é’©å­è¢«è°ƒç”¨ä¸¤æ¬¡ï¼Œå› ä¸º React æŒ‚è½½ã€å¸è½½ã€ç„¶åé‡æ–°æŒ‚è½½ç»„ä»¶ï¼Œä»¥æ•æ‰ç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¸­çš„å¸¸è§é”™è¯¯ã€‚

ä½ çš„é—®é¢˜çš„æ ¹æºæ˜¯ä½ æ²¡æœ‰æ¸…ç†ä½ çš„ç»„ä»¶ï¼å½“ React ç»„ä»¶é‡æ–°æŒ‚è½½æ—¶ï¼Œåº”è¯¥æœ‰æ•ˆåœ°é‡ç½®å®ƒ:åº”è¯¥æ¸…é™¤æ‰€æœ‰é—´éš”ï¼Œåº”è¯¥åˆ é™¤äº‹ä»¶ä¾¦å¬å™¨ï¼Œåº”è¯¥é‡ç½®çŠ¶æ€å˜é‡ã€‚

ä½ ä¼ é€’ç»™`useEffect`çš„å‡½æ•°åº”è¯¥`return`æ¸…ç†å‡½æ•°:

![](img/a600c80d80bbe444b62bdd45038c5377.png)

Notice the **return** in the callback to useEffect

ç°åœ¨ï¼Œå½“æ‚¨è¿è¡Œä¸Šé¢çš„ä»£ç æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°`count`åªå¢åŠ ä¸€æ¬¡:

![](img/b911da010a6a9b0353c2c54460b6c31d.png)

Use effect is only invoked 1 time

# ä½†æ˜¯æˆ‘ä¸æƒ³æ¸…ç†æˆ‘çš„ç»„ä»¶ï¼

ä½ åº”è¯¥è¿™ä¹ˆåšã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä¸€äº›æ›´æœ‰é—®é¢˜çš„ä»£ç ã€‚ä½ æœ‰ä¸€ä¸ªæ¯ç§’é’Ÿé€’å¢ä¸€æ¬¡çš„è®¡æ—¶å™¨ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`setInterval`:

![](img/475c9afcc0c0aeb2a80d9320052f1743.png)

å¦‚æœæ‚¨çš„ç»„ä»¶é‡æ–°å®‰è£…ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æ—¶é’Ÿå°†ä»¥ä¸¤å€çš„é€Ÿåº¦é€’å¢æ—¶é—´:

![](img/374cc6a22c02e65b7b059370e0ccb171.png)

Notice how the timer skips every other number

è¿™æ ·åšçš„å¦ä¸€ä¸ªå‰¯ä½œç”¨æ˜¯ï¼Œå¦‚æœä½ å¸è½½ç»„ä»¶ï¼Œéšè—å®ƒï¼Œæˆ–è€…ä½¿ç”¨`react-router`å¯¼èˆªç¦»å¼€é¡µé¢ï¼Œä½ çš„è®¡æ—¶å™¨å°†ä»ç„¶è¿è¡Œã€‚å¦‚ä½ æ‰€çŸ¥ï¼Œæµè§ˆå™¨ä¸­çš„ JavaScript æ˜¯å•çº¿ç¨‹çš„ã€‚å› æ­¤ï¼Œè¿™ä¸ªè®¡æ—¶å™¨å°†å ç”¨å®è´µçš„è®¡ç®—å’Œæµè§ˆå™¨èµ„æºã€‚ä½ çš„é¡µé¢ä¼šå˜æ…¢ï¼Œç”¨æˆ·ä½“éªŒä¼šå˜å·®ï¼ŒSafari ä¼šç»™å‡ºè¿™ä¸ªè­¦å‘Š:

![](img/f2e4c8132858eecc29f90d77820a7eff.png)

è¿™åŒæ ·é€‚ç”¨äºäº‹ä»¶ä¾¦å¬å™¨ã€‚äº‹ä»¶ä¾¦å¬å™¨æœ‰è‡ªå·±çš„çº¿ç¨‹æ¥ä¾¦å¬äº‹ä»¶ã€‚ä½†æ˜¯å¦‚æœä½ æœ‰ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œå›è°ƒåœ¨ä¸» JavaScript çº¿ç¨‹ä¸­è¿è¡Œï¼Œå†æ¬¡å ç”¨å®è´µçš„èµ„æºã€‚è¿™ä¼šå½±å“ç«™ç‚¹çš„å“åº”èƒ½åŠ›ï¼Œå¹¶å¯èƒ½ä¸ºæ›´é‡è¦çš„äº‹ä»¶é€ æˆç“¶é¢ˆã€‚

ä¸è¦å¿˜è®°åœ¨ä½¿ç”¨å®Œç»„ä»¶åæ¸…ç†å®ƒä»¬ï¼Œç¥ç¼–ç æ„‰å¿«ï¼ğŸ‘

[](/stop-using-for-loops-use-iterators-instead-javascript-62682c74427d) [## åœæ­¢ä½¿ç”¨ For å¾ªç¯ï¼Œæ”¹ç”¨è¿­ä»£å™¨

### For å¾ªç¯ä¸å†æ˜¯ JavaScript ä¸­è¿­ä»£æ•°ç»„çš„æœ€ä½³æ–¹å¼ã€‚ç›¸åï¼Œä½¿ç”¨æ•°ç»„è¿­ä»£å™¨å‡½æ•°ã€‚è¿™é‡Œâ€¦

javascript.plainenglish.io](/stop-using-for-loops-use-iterators-instead-javascript-62682c74427d) [](https://medium.com/@thesoggywaffle/please-stop-writing-sh-t-javascript-ba8fd4e1cd9e) [## è¯·åœæ­¢ç¼–å†™ Sh*t JavaScript

### ä½ åšé”™äº†ä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•å¼¥è¡¥ã€‚

medium.com](https://medium.com/@thesoggywaffle/please-stop-writing-sh-t-javascript-ba8fd4e1cd9e) [](/the-correct-way-to-use-ionicons-in-your-reactjs-project-3b65c97d5b1) [## åœ¨ React é¡¹ç›®ä¸­ä½¿ç”¨ Ionicons çš„æ­£ç¡®æ–¹æ³•

### HTML ä¸­çš„ IonIcons å¾ˆå®¹æ˜“ï¼Œä½†åœ¨ React ä¸­å´å¾ˆéš¾ã€‚å°½ç®¡ç¼ºå°‘æ–‡æ¡£ï¼Œæˆ‘è¿˜æ˜¯å¼„æ˜ç™½äº†ï¼

javascript.plainenglish.io](/the-correct-way-to-use-ionicons-in-your-reactjs-project-3b65c97d5b1) 

*æ›´å¤šå†…å®¹çœ‹*[**o**](https://plainenglish.io/)**ã€‚æŠ¥åå‚åŠ æˆ‘ä»¬çš„* [***å…è´¹å‘¨æŠ¥***](http://newsletter.plainenglish.io/) *ã€‚å…³æ³¨æˆ‘ä»¬å…³äº*[***Twitter***](https://twitter.com/inPlainEngHQ)*å’Œ*[***LinkedIn***](https://www.linkedin.com/company/inplainenglish/)*ã€‚æŸ¥çœ‹æˆ‘ä»¬çš„* [***ç¤¾åŒºä¸å’Œè°***](https://discord.gg/GtDtUAvyhW) *ï¼ŒåŠ å…¥æˆ‘ä»¬çš„* [***äººæ‰é›†ä½“***](https://inplainenglish.pallet.com/talent/welcome) *ã€‚**