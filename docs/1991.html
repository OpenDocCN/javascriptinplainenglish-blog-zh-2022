<html>
<head>
<title>Simple Caching in Vue 3 &amp; Vuex with IndexedDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Vue 3和Vuex中使用IndexedDB进行简单缓存</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/vue-3-with-vuex-for-simple-caching-with-indexeddb-aec46e9df9de?source=collection_archive---------1-----------------------#2022-05-05">https://javascript.plainenglish.io/vue-3-with-vuex-for-simple-caching-with-indexeddb-aec46e9df9de?source=collection_archive---------1-----------------------#2022-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d520" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何避免在Vue 3和Vuex中使用IndexedDB过多地通过网络请求相同的数据。</h2></div><p id="5ac2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我假设您希望避免通过网络请求相同的数据，次数超过需要的次数。嗯，我也是。感谢上帝，有很多方法可以避免这种情况。让我向您展示如何在Vue 3和Vuex中使用IndexedDB实现这一点。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/9843b8db5843e171abf6b563efcd0e09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*74vFL6Tm6pIrhdz7WHPb4w.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Vue 3 — yes</figcaption></figure><h2 id="9d7a" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">语境</h2><p id="217d" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">假设我们有一个Vue 3 SPA，由于技术原因，它必须每x秒从一个API中提取数据。<br/>这些数据只是从一个id到一个名字的“转换”。API请求和响应可能如下所示:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="637a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以它基本上只是一个键和一个值。<br/>现在如果我每隔x秒就请求相同的数据，那就有点浪费了。如果我刷新页面，同样的事情也会发生。所以理想情况下，我只想请求一次id 12345的翻译。这就是IndexedDB发挥作用的地方。</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h2 id="61dc" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">索引b</h2><p id="ba9a" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated"><a class="ae my" href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API" rel="noopener ugc nofollow" target="_blank"> IndexedDB </a>基本上只是一个存在于浏览器中的对象存储，它允许你保存大量的数据，你可以通过保存在下的键来检索这些数据。在本例中，我将简单地将数据保存如下:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mz"><img src="../Images/f102e1ad3ecab6575e96016167e1c6ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5GJppoclZHgoV1-j4HcbCg.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">IndexedDB example</figcaption></figure><p id="4e48" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，IndexedDB的API并不是最酷的。但幸运的是，有一些优秀的人已经创建了一个名为<a class="ae my" href="https://www.npmjs.com/package/idb" rel="noopener ugc nofollow" target="_blank"> idb </a>的小npm模块。只需安装:</p><p id="2af8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe na nb nc nd b">npm install idb</code></p><p id="c00b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这使得工作起来稍微容易一些。根据文档中的示例，我们可以创建一个如下所示的小帮助文件:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">idb helper file</figcaption></figure><p id="793d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们现在就可以填充Vuex商店了。</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h2 id="9d67" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">Vuex</h2><p id="bd6c" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">让我们假设您已经安装了Vuex，那么您可以创建一个如下所示的商店:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Vuex store</figcaption></figure><p id="747d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这家商店有我们需要的4个元素:</p><ol class=""><li id="a374" class="ne nf iq kh b ki kj kl km ko ng ks nh kw ni la nj nk nl nm bi translated">一个名为<code class="fe na nb nc nd b">translations</code>的属性，我们将使用它保存我们所有的翻译供以后使用。</li><li id="62bb" class="ne nf iq kh b ki nn kl no ko np ks nq kw nr la nj nk nl nm bi translated">一个突变做了两件事。如果我们没有翻译，它将被放入indexed db+translations数组中。</li><li id="7a81" class="ne nf iq kh b ki nn kl no ko np ks nq kw nr la nj nk nl nm bi translated">将检索IndexedDB中存在的所有翻译并将它们插入翻译数组的操作。该操作可以作为应用程序生命周期中的首要任务之一来执行。这实际上是检索我们以前保存的翻译。</li><li id="ec23" class="ne nf iq kh b ki nn kl no ko np ks nq kw nr la nj nk nl nm bi translated">返回翻译数组的简单getter。</li></ol></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h2 id="da7a" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ko ma mb mc ks md me mf kw mg mh mi mj bi translated">Vue 3</h2><p id="232a" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">现在，为了将这一切联系起来，这里有一个App.vue文件的简单示例(使用了Vuestic UI组件库)</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Vue 3 composition api</figcaption></figure><p id="2246" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们可以显示以前检索到的所有翻译，而无需向API发出HTTP请求。<br/>上面的例子缺少一些代码来检索我们需要的新翻译，但这应该足以满足您自己的用例。插入一些样本数据后，结果如下:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ns"><img src="../Images/f5695c36bbd2d4d642607b229f3d2c28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*juRNgEY06r1ZBZpR0Mij4Q.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">An example app with the 3 pieces from above</figcaption></figure></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><p id="4b22" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">idb包使它足够好用，使用这种模式缓存数据没有问题。关于何时删除“翻译”仍需制定策略。</p><p id="4cb1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个题目到此为止。感谢您的阅读。</p><p id="9cd2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nt">更多内容看</em> <strong class="kh ir"> <em class="nt"> </em> </strong> <a class="ae my" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> <em class="nt">说白了. io </em> </strong> </a> <em class="nt">。报名参加我们的</em> <a class="ae my" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> <em class="nt">免费周报</em> </strong> </a> <em class="nt">。关注我们关于</em><a class="ae my" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="nt">Twitter</em></strong></a><em class="nt">和</em><a class="ae my" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="nt">LinkedIn</em></strong></a><em class="nt">。加入我们的</em> <a class="ae my" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> <em class="nt">社区不和谐</em> </strong> </a> <em class="nt">。</em></p></div></div>    
</body>
</html>