<html>
<head>
<title>😠My Boss: You Have Been Working for 5 Years, but Why Do You Still Make This Simple Mistake?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">😠我的老板:你已经工作5年了，但是为什么你仍然犯这个简单的错误？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/my-boss-you-have-been-working-for-5-years-but-why-do-you-still-make-this-simple-mistake-7a5f2c4fab4e?source=collection_archive---------1-----------------------#2022-09-27">https://javascript.plainenglish.io/my-boss-you-have-been-working-for-5-years-but-why-do-you-still-make-this-simple-mistake-7a5f2c4fab4e?source=collection_archive---------1-----------------------#2022-09-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="dc38" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">这可能是每个人都犯过的错误</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/434138ef03b7e7f5738287847e3e2a8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TjNQyiKyfP0M7IHQ"/></div></div></figure><p id="d8a4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我的朋友Lily已经工作了5年，她过去一直是一名前端工程师。</p><p id="f585" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">很不幸，她被老板批评了，因为她在工作中犯了一个错误，这是一个很简单却容易被忽视的问题。</strong></p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="7d90" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">此<strong class="ak">错误的描述</strong></h1><p id="314b" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">问题大概是这样的。</p><p id="65cc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Lily负责公司的一个重要项目，其中一个模块是显示一条与<strong class="kt ir">数字</strong>相关的信息。</p><p id="ef41" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是后端工程师接口返回的信息<strong class="kt ir">(只是一个例子)</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="7d6c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">朋友们，我们调用<code class="fe mt mu mv mw b">getInfo</code>接口会返回什么信息？会是<code class="fe mt mu mv mw b">123456789123456789</code>吗？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/0ec135080ed36f88b9e884a830df9111.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*926RCwWWjSiBWmvc.png"/></div></div></figure><p id="63cb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通过chrome浏览器的调试工具可以看到，似乎一切都和我们想象的结果一样<code class="fe mt mu mv mw b">123456789123456789</code>。</p><p id="68a5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">但是页面上显示的结果是</strong> <code class="fe mt mu mv mw b"><strong class="kt ir">123456789123456780</strong></code> <strong class="kt ir">，最后一位是0而不是9 </strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/3809bcc6129134285ece715456f6b0e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tF7Vm-ZTmZzI4ByT.png"/></div></div></figure><p id="e7f5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">到底是怎么回事？这太奇怪了。</strong></p><h1 id="1485" class="lu lv iq bd lw lx mz lz ma mb na md me jw nb jx mg jz nc ka mi kc nd kd mk ml bi translated">原因分析</h1><p id="2ac7" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">我尝试分析返回的位数，发现只有位数超过16位时，才会出现后几位不一致的问题。</p><p id="df2c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">是因为数字太大，出现了精度损失吗？</strong></p><p id="332d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"/><code class="fe mt mu mv mw b"><strong class="kt ir">Java</strong></code><strong class="kt ir">语言中的Long类型是64位，难道</strong> <code class="fe mt mu mv mw b"><strong class="kt ir">Long</strong></code> <strong class="kt ir">类型中的</strong> <code class="fe mt mu mv mw b"><strong class="kt ir">JavaScript</strong></code> <strong class="kt ir">语言小于64位？</strong></p><p id="1d3a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Omg，<code class="fe mt mu mv mw b">JavaScript</code>好像没有<code class="fe mt mu mv mw b">Long</code>类型的数据！</p><p id="9be7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">其实在<code class="fe mt mu mv mw b">JavaScript</code>中，我们用一个数字来表示类型号的值。</p><p id="5444" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">数字类型的总长度为64位。这64位大致是这样分配的，其中53位代表小数，10位代表指数位，1位代表符号位。因此，数字整数的表示范围是<code class="fe mt mu mv mw b">-2^53 ~ 2^53</code>。</p><p id="77e3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们试着在控制台上用JavaScript打印出最大值和最小值。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/51ecbafe7150aab18764872ce5a4d3d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/0*D3I3CJG3m4SK47Rb.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/b7c7aa7e6255ed52a33564a09453cf09.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/0*VK7LZTXebK200tcZ.png"/></div></figure><p id="1127" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在其他语言中，如Java，Long类型占用64个二进制位，最大值为9223372036854774807(2⁶-1)，长度约为19位。</p><p id="8b57" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe mt mu mv mw b">JavaScript</code>中，由于数字类型的值也包含小数，所以最大值为9007199254740993 (2^53 - 1)，长度约为16位。</p><p id="2d1f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">所以当Java向JSON返回超过16个</strong>位<strong class="kt ir">的长类型字段时，前端JavaScript得到的数据会因为溢出而失去精度。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/c04989c890018f46037c233c113947da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/0*5Z3snGy6JmJfYDyo.png"/></div></figure><h1 id="f51b" class="lu lv iq bd lw lx mz lz ma mb na md me jw nb jx mg jz nc ka mi kc nd kd mk ml bi translated">如何解决这个问题？</h1><p id="9349" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">也许我们可以尝试在前端解决这个问题，但我认为我们应该寻求后端工程师的帮助。</p><p id="2ecb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">我们应该将可能超出范围的数值型(Long)变量转换为字符串型(string)。</strong></p><h1 id="7940" class="lu lv iq bd lw lx mz lz ma mb na md me jw nb jx mg jz nc ka mi kc nd kd mk ml bi translated">最后</h1><p id="ca8f" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated"><strong class="kt ir">感谢阅读。</strong>我期待着<strong class="kt ir"> </strong>您的关注和阅读更多高质量的文章。</p><div class="nh ni gp gr nj nk"><a rel="noopener  ugc nofollow" target="_blank" href="/i-lost-a-job-opportunity-just-because-of-promise-all-be396f6efe87"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">“我失去了一个工作机会，只是因为承诺。所有”</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">一次让我好难过的面试经历。</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny kp nk"/></div></div></a></div><div class="nh ni gp gr nj nk"><a rel="noopener  ugc nofollow" target="_blank" href="/interviewer-what-happened-to-npm-run-xxx-cdcb37dbaf44"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">采访者:“npm跑xxx”怎么了？</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">一个大多数人都不知道的秘密。</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="nt l"><div class="nz l nv nw nx nt ny kp nk"/></div></div></a></div><div class="nh ni gp gr nj nk"><a rel="noopener  ugc nofollow" target="_blank" href="/interviewer-can-x-x-return-true-in-javascript-7e1d1fa7b5cd"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">面试官:可以“x！== x "在JavaScript中返回True？</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">你可能不知道的五个神奇的JavaScript知识点！</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="nt l"><div class="oa l nv nw nx nt ny kp nk"/></div></div></a></div><div class="nh ni gp gr nj nk"><a rel="noopener  ugc nofollow" target="_blank" href="/its-2022-don-t-abuse-the-arrow-function-anymore-905862a9c668"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">现在是2022年，不要再滥用箭头功能了</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">不应该使用箭头函数的4种情况。</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="nt l"><div class="ob l nv nw nx nt ny kp nk"/></div></div></a></div></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><p id="880a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="oc">更多内容看</em> <a class="ae od" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="oc">说白了。报名参加我们的</em> <a class="ae od" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="oc">免费周报</em> </strong> </a> <em class="oc">。关注我们关于</em> <a class="ae od" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="oc">推特</em> </strong> </a>，<a class="ae od" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="oc">LinkedIn</em></strong></a><em class="oc">，</em><a class="ae od" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="oc">YouTube</em></strong></a><em class="oc">，以及</em> <a class="ae od" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="oc">不和</em> </strong> </a> <em class="oc">。对增长黑客感兴趣？检查</em> <a class="ae od" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="oc">电路</em> </strong> </a> <em class="oc">。</em></strong></a></p></div></div>    
</body>
</html>