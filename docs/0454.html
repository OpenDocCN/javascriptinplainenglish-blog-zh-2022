<html>
<head>
<title>Deploy a Strapi V4 App on Heroku also Connected into Google Cloud SQL (PostgreSQL)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Heroku上部署一个Strapi V4应用程序，同时连接到Google Cloud SQL (PostgreSQL)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/deploy-a-strapi-v4-app-on-heroku-also-connected-into-google-cloud-sql-postgresql-f4c4ad8f2fa5?source=collection_archive---------6-----------------------#2022-01-26">https://javascript.plainenglish.io/deploy-a-strapi-v4-app-on-heroku-also-connected-into-google-cloud-sql-postgresql-f4c4ad8f2fa5?source=collection_archive---------6-----------------------#2022-01-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/937479981e8b7bb5b01429c325e677fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fsPkSvcMmlm5MGIW"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Photo by <a class="ae ja" href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Sigmund</a> on <a class="ae ja" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="0932" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">嗨，伙计们，欢迎来到我的博客。我是潘杜，我是一名软件工程师。</p><p id="cc5a" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">之前我写过一篇文章《如何在Heroku上部署NestJS App，接入Google Cloud SQL》。现在，我又在用Strapi v4写几乎一样的东西，可部署到Heroku和Cloud SQL。</p><h1 id="5d9f" class="ky kz jd bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">斯特拉皮</h1><p id="aaf5" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">Strapi v4是去年发布的。我认为它仍然需要调整以变得更加成熟。但是当我知道Strapi向公众公布了一个新版本时(巧合的是，我的CMS需要开发，这需要时间)，我决定使用它。我用的是新版本，第4版。</p><p id="d55e" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当你用Strapi开发时，用最少的代码真的很快很容易。它与我的项目兼容。最后我很开心。之前进入部署，我没那么开心，更多的是恐慌。啊哈。我真的很难在Heroku中部署同步到云SQL，因为在文档中，你不能找到如何在v4中部署。你应该加入不和谐的斯特拉皮小组，并询问它。</p><p id="5059" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">简而言之，我成功地将我的Strapi v4应用程序部署到了云中。</p><figure class="mc md me mf gt ip gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/9929b38948a0104ca9483b1793902a70.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*0wkIpTu-sgpp4LXX8yNqNA.png"/></div></figure><p id="d3e0" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你可以在官方网站上查看详情。<a class="ae ja" href="https://strapi.io/" rel="noopener ugc nofollow" target="_blank">https://strapi.io/</a></p><h2 id="0e3b" class="mg kz jd bd la mh mi dn le mj mk dp li kl ml mm lm kp mn mo lq kt mp mq lu mr bi translated">云SQL</h2><figure class="mc md me mf gt ip gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/203c806967f20f5867821edce23695b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/format:webp/1*4hTw1cu0JRULtXcxdy-Ppg.png"/></div></figure><p id="40fe" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Cloud SQL是Google的产品，以原生格式为您提供云服务。您不需要先创建一个虚拟机来使用您正在使用的数据库。在云SQL中，有MySQL、PostgreSQL和SQL Server。你可以在官方网站上查看详情。<a class="ae ja" href="https://cloud.google.com/sql/?utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=japac-ID-all-en-dr-skws-all-super-trial-e-dr-1009882&amp;utm_content=text-ad-none-none-DEV_c-CRE_505011853132-ADGP_Hybrid%20%7C%20SKWS%20-%20EXA%20%7C%20Txt%20~%20Databases%20~%20Cloud%20SQL_SQL-cloud%20sql-KWID_43700028140250606-aud-970366092687%3Akwd-297124208290&amp;userloc_9072594-network_g&amp;utm_term=KW_cloud%20sql&amp;gclid=CjwKCAiA_omPBhBBEiwAcg7smaKIE4HOSOEj2sbJ6ayFrQ7hsCaNwhUEIRut6bj3PAlncUwRNyI1fxoC_o0QAvD_BwE&amp;gclsrc=aw.ds" rel="noopener ugc nofollow" target="_blank">云SQL站点</a></p><h2 id="13ed" class="mg kz jd bd la mh mi dn le mj mk dp li kl ml mm lm kp mn mo lq kt mp mq lu mr bi translated">赫罗库</h2><figure class="mc md me mf gt ip gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/9910a750a960065fa8ffa51f99259c67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*CtFBh4T9omkuFLVTijZz5Q.png"/></div></figure><h2 id="deea" class="mg kz jd bd la mh mi dn le mj mk dp li kl ml mm lm kp mn mo lq kt mp mq lu mr bi translated">Heroku平台</h2><blockquote class="mu"><p id="1e47" class="mv mw jd bd mx my mz na nb nc nd kx dk translated">Heroku是一个基于托管容器系统的平台即服务，具有<a class="ae ja" href="https://www.heroku.com/managed-data-services" rel="noopener ugc nofollow" target="_blank">集成数据服务</a>和强大的生态系统，用于部署和运行现代应用。Heroku开发者体验是一种以应用为中心的软件交付方式，集成了当今最流行的开发工具和工作流。</p></blockquote><p id="201e" class="pw-post-body-paragraph ka kb jd kc b kd ne kf kg kh nf kj kk kl ng kn ko kp nh kr ks kt ni kv kw kx ig bi translated">如果你懒得设置和构建VM，我推荐你使用这个工具。</p><p id="f8c9" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们进入正题。</p><p id="bdb7" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">第一步，绝对你要有一个Strapi app。运行此命令。</p><pre class="mc md me mf gt nj nk nl nm aw nn bi"><span id="88b0" class="mg kz jd nk b gy no np l nq nr">npx create-strapi-app@latest my-project</span></pre><p id="bcc7" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">向上移动到您的项目目录。</p><pre class="mc md me mf gt nj nk nl nm aw nn bi"><span id="aab1" class="mg kz jd nk b gy no np l nq nr">cd my-project</span></pre><p id="39f9" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">详情可以看文档。</p><p id="26e0" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建一个目录和文件，就像这样。</p><figure class="mc md me mf gt ip gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/ce38e3692acbd30fde8448e6cea56270.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/format:webp/1*ak-sDe8SiHOpHrLzzZ9O9w.png"/></div></figure><p id="8c77" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您的数据库使用SSL，请将认证添加到该文件夹中。</p><p id="f02a" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">并且，在<code class="fe nt nu nv nk b">config/env/production/database.js</code>中创建文件。复制并粘贴此脚本。</p><pre class="mc md me mf gt nj nk nl nm aw nn bi"><span id="1eaa" class="mg kz jd nk b gy no np l nq nr">const fs = require("fs");<br/>module.exports = ({ env }) =&gt; ({<br/>    connection: {<br/>        client: 'postgres',<br/>        connection: {<br/>            host: process.env.DATABASE_HOST,<br/>            port: process.env.DATABASE_PORT || 5432,<br/>            database: process.env.DATABASE_NAME || 'postgres',<br/>            user: process.env.DATABASE_USERNAME || 'postgres',<br/>            password: process.env.DATABASE_PASSWORD || '123456789',<br/>            // ssl: env.bool('DATABASE_SSL', false),<br/>            ssl: {<br/>                ca: fs.readFileSync('./config/env/production/server-ca.pem').toString(),<br/>                cert: fs.readFileSync('./config/env/production/client-cert.pem').toString(),<br/>                key: fs.readFileSync('./config/env/production/client-key.pem').toString(),<br/>                rejectUnauthorized: false,<br/>            },<br/>        },<br/>        debug: false<br/>    },</span><span id="b1bb" class="mg kz jd nk b gy nw np l nq nr">});</span></pre><p id="1a2f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，<strong class="kc je">在云SQL </strong>中设置实例一。<strong class="kc je">转到谷歌控制台</strong>。我假设您已经在那里创建了项目。</p><figure class="mc md me mf gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nx"><img src="../Images/187ce0afaebdd98963f4eb47b490a04a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xSUy_su0UB5z9L71JA_cFA.png"/></div></div></figure><p id="aa7c" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，转到SQL菜单。</p><figure class="mc md me mf gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nx"><img src="../Images/63d1dd1a50ec0eab3cb5dbd671101add.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*885Wo4Suux3IsVa6mk0bOA.png"/></div></div></figure><figure class="mc md me mf gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nx"><img src="../Images/ee260fc51fbe1bbdc3e3f64888090f5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N8dadF9czKAxFTqAAZIiQQ.png"/></div></div></figure><p id="7117" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">点击<code class="fe nt nu nv nk b">Create instance</code>。</p><figure class="mc md me mf gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nx"><img src="../Images/2743e833f7651a6ce55f1d762bac91cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TwdJhYOD6h7YeE6L988Anw.png"/></div></div></figure><p id="b844" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">选择一个所需的数据库。我选PostgreSQL。</p><figure class="mc md me mf gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nx"><img src="../Images/774e97c5e85bfa57b0de001c17cd2ebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_U0G9lNPZIU4tz3qpl_69w.png"/></div></div></figure><p id="7b3b" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注意:如果你还没有打开计算引擎API，请在进入主设置之前先点击。从这里，我直接进入我现有的数据库。</p><p id="a9db" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，进入<code class="fe nt nu nv nk b">Connection</code>菜单，点击<code class="fe nt nu nv nk b">Networking</code>选项卡。Intermezzo，因为云SQL将与Heroku连接，所以这就是为什么他们有公共IP。因此，请仅在您的云SQL实例中单击公共IP。</p><figure class="mc md me mf gt ip gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/09f02bf4bebf571db1afd6828ca13e05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*WOQudEzPIX_YPRRfVbWb_A.png"/></div></figure><p id="cd4b" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如上图所示，选择<code class="fe nt nu nv nk b">0.0.0.0/0</code>进入授权网络部分。(如果您将用于生产模式，则不建议使用)。</p><p id="4af8" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">是的，你已经完成了在云SQL中的配置。</p><p id="816a" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在控制台中运行，以确保它是否工作。</p><pre class="mc md me mf gt nj nk nl nm aw nn bi"><span id="8230" class="mg kz jd nk b gy no np l nq nr">npm run build &amp;&amp; npm run start:dev</span></pre></div><div class="ab cl nz oa hr ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ig ih ii ij ik"><p id="4861" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好了，如果您的连接成功，现在让我们在Heroku中创建应用程序。</p><ol class=""><li id="d5cc" class="og oh jd kc b kd ke kh ki kl oi kp oj kt ok kx ol om on oo bi translated">在Heroku中创建新应用程序</li><li id="f1e7" class="og oh jd kc b kd op kh oq kl or kp os kt ot kx ol om on oo bi translated">通过GitHub连接您的Strapi v4应用程序，您必须将GitHub帐户授权给Heroku平台。</li><li id="993e" class="og oh jd kc b kd op kh oq kl or kp os kt ot kx ol om on oo bi translated">然后将您的代码部署到Heroku。</li></ol><p id="4964" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于其他问题，您可以参考堆栈溢出上的“我的问题”。</p><div class="im in gp gr io ou"><a href="https://stackoverflow.com/questions/70690879/how-to-integrate-heroku-with-google-cloud-sql-native-gcp-in-nestjs-typeorm" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd je gy z fp oz fr fs pa fu fw jc bi translated">如何在Nestjs/Typeorm中集成Heroku和Google Cloud SQL(原生— GCP)？</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">我目前真的很沮丧，因为无法将我的应用程序部署到Heroku，也无法将我的数据库连接到Google Cloud SQL。我是什么…</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">stackoverflow.com</p></div></div><div class="pd l"><div class="pe l pf pg ph pd pi iu ou"/></div></div></a></div><p id="dc4e" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">是的，您已经成功地将您的应用程序部署到Heroku并连接到云SQL。</p><p id="b4c3" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">附加说明:这真的不建议用于生产模式。如果您想应用此方法，请通过Heroku CLI将Cloud SQL Auth Proxy添加到您的<code class="fe nt nu nv nk b">dyno</code>中。</p><p id="a0c2" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好的，祝你好运，编码愉快！</p><h1 id="d37e" class="ky kz jd bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">警惕！</h1><p id="a492" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">如果你们来自印度尼西亚，想要支持我越来越多的写作，希望你们能从钱包里拿出一点来。你可以通过一些方式分享你的天赋，</p><h2 id="b9c6" class="mg kz jd bd la mh mi dn le mj mk dp li kl ml mm lm kp mn mo lq kt mp mq lu mr bi translated">萨韦里亚</h2><p id="a572" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated"><a class="ae ja" href="https://saweria.co/pandhuwibowo" rel="noopener ugc nofollow" target="_blank">https://saweria.co/pandhuwibowo</a></p><figure class="mc md me mf gt ip gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/0089e6c52b43886c90f7f853a7b8a73b.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*xFmG4J1rW-MHyEqO_mzIaw.png"/></div></figure><h2 id="b9fb" class="mg kz jd bd la mh mi dn le mj mk dp li kl ml mm lm kp mn mo lq kt mp mq lu mr bi translated">特拉克特尔</h2><p id="c63d" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated"><a class="ae ja" href="https://trakteer.id/goodpeopletogivemoney" rel="noopener ugc nofollow" target="_blank">https://trakteer.id/goodpeopletogivemoney</a></p><figure class="mc md me mf gt ip gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/d26e4901a3c5106b7c99a3c8a99d74a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:536/format:webp/1*Q-ZYOzqJ6R3ijDlVlM5JMw.jpeg"/></div></figure><p id="1477" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="pl">更多内容请看</em><a class="ae ja" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc je"><em class="pl">plain English . io</em></strong></a><em class="pl">。报名参加我们的</em> <a class="ae ja" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc je"> <em class="pl">免费周报</em> </strong> </a> <em class="pl">。在我们的</em> <a class="ae ja" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kc je"> <em class="pl">社区</em> </strong> </a> <em class="pl">获得独家获得写作机会和建议。</em></p></div></div>    
</body>
</html>