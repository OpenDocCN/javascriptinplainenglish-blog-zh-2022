<html>
<head>
<title>JavaScript Promises: Understanding Promise.allSettled()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript Promises:了解Promise.allSettled()</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-promises-understanding-promise-allsettled-8d9635540697?source=collection_archive---------2-----------------------#2022-03-12">https://javascript.plainenglish.io/javascript-promises-understanding-promise-allsettled-8d9635540697?source=collection_archive---------2-----------------------#2022-03-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="1c99" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何使用<code class="fe kc kd ke kf b">Promise.allSettled()</code>方法执行多个异步调用？</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/82bf36a5bd54b240729af34748e17847.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5eH6F2QnQhdvyksX"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Photo by <a class="ae kw" href="https://unsplash.com/@sapegin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Artem Sapegin</a> on <a class="ae kw" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="323d" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">ECMAScript 2021是最新的JavaScript版本，它为JavaScript语言引入了多个新特性。</p><p id="3b25" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">在本文中，我们将学习如何使用<code class="fe kc kd ke kf b">Promise.allSettled()</code>方法来执行多个异步调用。</p><h1 id="38dd" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">Promise.allSettled()方法</h1><p id="b33e" class="pw-post-body-paragraph kx ky in kz b la ml jo lc ld mm jr lf lg mn li lj lk mo lm ln lo mp lq lr ls ig bi translated">ES2020引入了<code class="fe kc kd ke kf b">promise.allSettled()</code>方法，该方法接受一个承诺列表，并返回一个新的承诺，该承诺在所有输入都已解决(解决或拒绝)后解决。不管是解决还是拒绝，<code class="fe kc kd ke kf b">promise.allSettled() </code>都会等结果。</p><p id="a9b7" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">语法:-</p><pre class="kh ki kj kk gt mq kf mr ms aw mt bi"><span id="3d76" class="mu lu in kf b gy mv mw l mx my">const data = Promise.allSettled([promise1,…]) // iterable object</span></pre><p id="5e19" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">您可以使用<strong class="kz io">提取承诺解析值。然后</strong>语法:-</p><pre class="kh ki kj kk gt mq kf mr ms aw mt bi"><span id="4dd8" class="mu lu in kf b gy mv mw l mx my">data.then((values) =&gt; {<br/>  values; // [resultOfPromise1, resultOfPromise2, ...]<br/>}).catch(error =&gt; {<br/>  console.log(error)<br/>}</span></pre><p id="59ff" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">或者<strong class="kz io">异步/等待</strong>:</p><pre class="kh ki kj kk gt mq kf mr ms aw mt bi"><span id="0d71" class="mu lu in kf b gy mv mw l mx my">try{<br/> const result = await data;<br/> console.log(Result); //[resultPromise1, resultPromise2, ...]<br/>} catch (error =&gt; {<br/> console.log(error);<br/>}</span></pre><p id="0301" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">请注意，结果数组的顺序与其源承诺中的顺序相同。</p><p id="bce2" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">关于<code class="fe kc kd ke kf b"> promise.allSettled() </code>有趣的事情是:-</p><ul class=""><li id="09d2" class="mz na in kz b la lb ld le lg nb lk nc lo nd ls ne nf ng nh bi translated"><code class="fe kc kd ke kf b">Promise.allSettled() </code>不管结果如何，等待所有承诺的达成。</li><li id="8632" class="mz na in kz b la ni ld nj lg nk lk nl lo nm ls ne nf ng nh bi translated">得到的数组有:- <br/> - <code class="fe kc kd ke kf b">{status:"fulfilled", value:result}</code>表示成功响应，<br/> - <code class="fe kc kd ke kf b">{status:"rejected", reason:error}</code>表示错误。</li></ul><p id="8729" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">结果是一个对象数组，由一个<code class="fe kc kd ke kf b"><strong class="kz io">status</strong></code>字符串组成，对于成功响应为<code class="fe kc kd ke kf b"><strong class="kz io">fulfilled</strong></code>，对于错误为<code class="fe kc kd ke kf b"><strong class="kz io">rejected</strong></code>。对于成功的响应，我们将得到错误的<code class="fe kc kd ke kf b">value</code>和<code class="fe kc kd ke kf b"><strong class="kz io">reason</strong></code>。</p><p id="8ec9" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">为了更好地理解上述观点，我将向您展示一个示例:</p><h1 id="b49b" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">例1:所有承诺都兑现了</h1><p id="a233" class="pw-post-body-paragraph kx ky in kz b la ml jo lc ld mm jr lf lg mn li lj lk mo lm ln lo mp lq lr ls ig bi translated">以下示例演示了所有承诺都已兑现的<code class="fe kc kd ke kf b">Promise.allSettled()</code>方法:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nn"><img src="../Images/37092d0d49f1a7ff6020ad68b8bc1a61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*baTiPeZuJbOqiWz8lBzrPA.png"/></div></div></figure><p id="bcef" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">正如你所看到的，承诺的结果和它的源承诺顺序相同。尽管第一个承诺比第二个承诺需要更多的时间来解决，但它仍然是一系列结果中的第一个。</p><h1 id="fce0" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">示例2:一个承诺被拒绝</h1><p id="9c73" class="pw-post-body-paragraph kx ky in kz b la ml jo lc ld mm jr lf lg mn li lj lk mo lm ln lo mp lq lr ls ig bi translated">以下示例演示了一个承诺被拒绝的<code class="fe kc kd ke kf b">Promise.allSettled()</code>方法:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi no"><img src="../Images/86c572a16271a36abf58081dc406b512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*huC399mtfhbt4Qe__0bZNg.png"/></div></div></figure><p id="c677" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">在上面的例子中可以看到，第二个承诺被拒绝，而不是立即拒绝整个，就像promise.all()一样，它等待所有承诺完成，并给我们一个对象数组的结果。</p><h1 id="7359" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">示例3:拒绝所有承诺</h1><p id="4acd" class="pw-post-body-paragraph kx ky in kz b la ml jo lc ld mm jr lf lg mn li lj lk mo lm ln lo mp lq lr ls ig bi translated">以下示例演示了拒绝所有承诺的<code class="fe kc kd ke kf b">Promise.allSettled()</code>方法:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi no"><img src="../Images/9716e01c6cc55c8d2baa1aad77c77afa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BUG0ykAQSiiFu0TLVaeu3g.png"/></div></div></figure><p id="f5e9" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">在这个例子中，所有的承诺都因为一个错误而被拒绝。因此，<code class="fe kc kd ke kf b">promise.allSettled()</code>方法将返回一个包含状态<strong class="kz io">拒绝</strong>字符串和<strong class="kz io">原因</strong>属性的对象数组。</p><h1 id="9a2f" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">是什么让Promise.allSettled()不同于Promise.all()</h1><ul class=""><li id="d55b" class="mz na in kz b la ml ld mm lg np lk nq lo nr ls ne nf ng nh bi translated">当我们有多个彼此不依赖的异步任务要成功完成时，或者我们总是想知道每个承诺的结果时，我们必须使用<code class="fe kc kd ke kf b">Promise.allSettled()</code>。</li><li id="0377" class="mz na in kz b la ni ld nj lg nk lk nl lo nm ls ne nf ng nh bi translated"><code class="fe kc kd ke kf b">Promise.all()</code>更适用于承诺相互依存的情况。</li><li id="b373" class="mz na in kz b la ni ld nj lg nk lk nl lo nm ls ne nf ng nh bi translated"><code class="fe kc kd ke kf b">Promise.all()</code>如果任何一个承诺被拒绝，则作为一个整体被拒绝；如果所有承诺都被解决，则该承诺将被履行。</li><li id="02fa" class="mz na in kz b la ni ld nj lg nk lk nl lo nm ls ne nf ng nh bi translated"><code class="fe kc kd ke kf b">Promise.allSettled()</code>不管结果如何，只是等待所有的许诺都兑现。永远不会被拒绝。</li></ul><h2 id="e2bf" class="mu lu in bd lv ns nt dn lz nu nv dp md lg nw nx mf lk ny nz mh lo oa ob mj oc bi translated"><strong class="ak">结论:- </strong></h2><p id="bcb8" class="pw-post-body-paragraph kx ky in kz b la ml jo lc ld mm jr lf lg mn li lj lk mo lm ln lo mp lq lr ls ig bi translated"><code class="fe kc kd ke kf b">Promise.allSettled()</code>是一个有用的函数，用于并行执行多个独立的异步操作，如果被拒绝，则返回一个包含一个<strong class="kz io">状态</strong>字符串和一个<strong class="kz io">值</strong>属性或一个<strong class="kz io">原因</strong>属性的对象数组。</p><p id="f162" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">它接受一个<strong class="kz io">可迭代对象</strong>，比如一个承诺数组作为输入。</p><ul class=""><li id="d649" class="mz na in kz b la lb ld le lg nb lk nc lo nd ls ne nf ng nh bi translated">如果所有的承诺都兑现了，我会得到结果。</li><li id="062b" class="mz na in kz b la ni ld nj lg nk lk nl lo nm ls ne nf ng nh bi translated">如果任何承诺被拒绝，我将得到结果。</li><li id="086a" class="mz na in kz b la ni ld nj lg nk lk nl lo nm ls ne nf ng nh bi translated">如果所有的承诺都被拒绝，我会得到结果</li></ul><h2 id="ae28" class="mu lu in bd lv ns nt dn lz nu nv dp md lg nw nx mf lk ny nz mh lo oa ob mj oc bi translated"><a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled#browser_compatibility" rel="noopener ugc nofollow" target="_blank">浏览器兼容性</a></h2><p id="a181" class="pw-post-body-paragraph kx ky in kz b la ml jo lc ld mm jr lf lg mn li lj lk mo lm ln lo mp lq lr ls ig bi translated">请注意<code class="fe kc kd ke kf b">promise.allSettled()</code>在除了internet explorer之外的所有现代浏览器中都完全支持。</p><p id="cb25" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">这将是一系列文章，在下一篇文章中，我们将讨论<strong class="kz io"> promise.race() </strong>。敬请期待！</p><p id="81a9" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">看看我以前的文章，在<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/javascript-promises-understanding-promise-any-d8640d4c6ae5"> Promise.any() </a>或者<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/javascript-promises-understanding-promise-all-c6a126d02e86"> Promise.all() </a>上。</p><p id="a2b6" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">请在评论区分享你的观点，欢迎反馈。<br/>希望你会喜欢并分享这篇文章，以便更好地传播<br/>查看我在上的其他文章</p><div class="oe of gp gr og oh"><a href="https://medium.com/@aayushtibra1997" rel="noopener follow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd io gy z fp om fr fs on fu fw im bi translated">Ayush Tibra -中等</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">阅读媒体上的阿尤什·蒂布拉的作品。前端开发者| ReactJS。每天，阿尤什·提布拉和成千上万的其他人…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">medium.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov kq oh"/></div></div></a></div><p id="13a2" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated"><strong class="kz io"> <em class="od">感谢阅读:)</em> </strong></p><p id="ff14" class="pw-post-body-paragraph kx ky in kz b la lb jo lc ld le jr lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated"><em class="od">更多内容请看</em><a class="ae kw" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kz io"><em class="od">plain English . io</em></strong></a><em class="od">。报名参加我们的</em> <a class="ae kw" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz io"> <em class="od">免费周报</em> </strong> </a> <em class="od">。关注我们关于</em><a class="ae kw" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kz io"><em class="od">Twitter</em></strong></a><em class="od">和</em><a class="ae kw" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kz io"><em class="od">LinkedIn</em></strong></a><em class="od">。加入我们的</em> <a class="ae kw" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kz io"> <em class="od">社区不和谐</em> </strong> </a> <em class="od">。</em></p></div></div>    
</body>
</html>