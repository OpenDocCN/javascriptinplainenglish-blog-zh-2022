<html>
<head>
<title>How to Detect Idle Time in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在JavaScript中检测空闲时间</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-detect-idle-time-in-javascript-9b517f3881ff?source=collection_archive---------6-----------------------#2022-10-18">https://javascript.plainenglish.io/how-to-detect-idle-time-in-javascript-9b517f3881ff?source=collection_archive---------6-----------------------#2022-10-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/8b0daf20312acadb167de781fed456ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C3hbrjTtsiyaaT9juktGiQ.jpeg"/></div></div></figure><p id="47da" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">空闲时间是用户不与网站交互的时间。这种交互可以是移动鼠标、点击页面或使用键盘。可以检测到这个时间来执行可能在某一段不活动时间之后发生的某些事件。</p><p id="1ad9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">经过一番研究，我得到了一个用于跟踪angular中空闲时间的包。</p><h2 id="f47c" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">Ng空闲内核</h2><p id="bc4d" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">Angular应用程序中响应空闲用户的模块。这是对<a class="ae lr" href="https://github.com/moribvndvs/ng-idle" rel="noopener ugc nofollow" target="_blank"> ng-idle模块</a>的重写；但是，如果使用Angular 1，则必须使用该模块。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="8464" class="kt ku in lx b gy mb mc l md me">npm install --save @ng-idle/core</span></pre><h2 id="ea07" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">Ng空闲保持活动</h2><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="d335" class="kt ku in lx b gy mb mc l md me">npm install --save @ng-idle/keepalive</span></pre><p id="2d6f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在您的模块中</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/c51f93bef88f08b0e23863d6e5ede09b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tymLhaglOtkjzhXgYgllxQ.png"/></div></div></figure><p id="b6bd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在你的角度分量中</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mg"><img src="../Images/417f86ec878218476aec7c83fa93f5d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h0PeDEcpcN6u5zEMw2ZcsQ.png"/></div></div></figure><p id="fb30" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，它跟踪应用程序的不活动状态。经过一段时间的不活动浏览器打开一个警告框，注销应用程序。</p><p id="b044" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mh mi mj lx b">@ng-idle</code>通过<a class="ae lr" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>发货。对于最新支持的Angular版本，您可以使用以下命令安装该软件包:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="51ce" class="kt ku in lx b gy mb mc l md me">npm install --save @ng-idle/core</span></pre><p id="b963" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将包集成和配置到您的应用程序中还需要几个步骤。请访问<a class="ae lr" href="https://github.com/moribvndvs/ng2-idle-example.git" rel="noopener ugc nofollow" target="_blank"> @ng-idle-example </a>获取源代码和如何开始的说明。</p><h2 id="16ce" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">设计考虑</h2><p id="44fd" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">该模块的主要应用是检测用户何时空闲。它还可以用来警告用户即将超时，然后让他们超时。这个模块的核心是<code class="fe mh mi mj lx b">Idle</code>服务，它根据您的配置尽力检测用户是活动的还是空闲的，并将信息传递给您的应用程序，以便它能够做出适当的响应。</p><h2 id="fac9" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">模块化</h2><p id="33fa" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">核心功能可以通过<a class="ae lr" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>在<code class="fe mh mi mj lx b">@ng-idle/core</code>包中找到。</p><p id="6248" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">扩展功能的附加模块:</p><ul class=""><li id="29af" class="mk ml in jx b jy jz kc kd kg mm kk mn ko mo ks mp mq mr ms bi translated"><code class="fe mh mi mj lx b">@ng-idle/keepalive</code>(见下文)</li></ul><h2 id="f1f3" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">可扩展保活集成</h2><p id="98ea" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">在用于会话管理的常见用例中，您可能需要定期向服务器发送信号，告知用户仍处于登录和活动状态。如果您需要该功能，<code class="fe mh mi mj lx b">@ng-idle</code>可以选择将<strong class="jx io">与<code class="fe mh mi mj lx b">@ng-idle/keepalive</code>集成。<code class="fe mh mi mj lx b">@ng-idle</code>会指示<code class="fe mh mi mj lx b">@ng-idle/keepalive</code>在用户活动时ping，一旦用户空闲或超时就停止。当用户恢复活动或空闲状态被重置时，它将立即ping，然后恢复ping。<strong class="jx io">请注意</strong>keepalive集成是可选的，您必须单独安装和配置<code class="fe mh mi mj lx b">@ng-idle/keepalive</code>才能获得此功能。您可以通过扩展<code class="fe mh mi mj lx b">KeepaliveSvc</code>并将其配置为应用程序中<code class="fe mh mi mj lx b">KeepaliveSvc</code>类的提供者来实现您自己的。</strong></p><h2 id="3e9f" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">可扩展中断</h2><p id="bbe4" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">中断是任何输入源(通常来自用户，但也可能是其他标签或事件),可用于向<code class="fe mh mi mj lx b">Idle</code>发送信号，指示空闲手表应被中断或重置。不像<code class="fe mh mi mj lx b">ng-idle</code>，这些源码不是硬编码的；您可以扩展<code class="fe mh mi mj lx b">InterruptSource</code>或任何内置的源代码来满足您的需求。该特性对于处理可能困扰您的特定用例的输入噪声也很有用。它还可以用于定位页面上的特定元素，而不是整个文档或窗口。该软件包内置了以下资源:</p><ul class=""><li id="2b5d" class="mk ml in jx b jy jz kc kd kg mm kk mn ko mo ks mp mq mr ms bi translated"><code class="fe mh mi mj lx b">InterruptSource</code>(摘要):一个你可以实现自己的源码的基类。</li><li id="4a90" class="mk ml in jx b jy mt kc mu kg mv kk mw ko mx ks mp mq mr ms bi translated"><code class="fe mh mi mj lx b">EventTargetInterruptSource</code>:任何实现<code class="fe mh mi mj lx b">EventTarget</code>的对象，如<code class="fe mh mi mj lx b">HTMLElement</code>或<code class="fe mh mi mj lx b">Window</code>。接受作为源的对象和一个空格分隔的字符串，该字符串包含导致中断的事件。</li><li id="3d86" class="mk ml in jx b jy mt kc mu kg mv kk mw ko mx ks mp mq mr ms bi translated"><code class="fe mh mi mj lx b">DocumentInterruptSource</code>:查找冒泡到<code class="fe mh mi mj lx b">document.documentElement</code> ( <code class="fe mh mi mj lx b">html</code>节点)的事件(在空格分隔的字符串中)。</li><li id="567d" class="mk ml in jx b jy mt kc mu kg mv kk mw ko mx ks mp mq mr ms bi translated"><code class="fe mh mi mj lx b">WindowInterruptSource</code>:查找冒泡到<code class="fe mh mi mj lx b">Window</code>的事件(在空格分隔的字符串中)。</li><li id="db05" class="mk ml in jx b jy mt kc mu kg mv kk mw ko mx ks mp mq mr ms bi translated"><code class="fe mh mi mj lx b">StorageInterruptSource</code>:只查找<code class="fe mh mi mj lx b">Window</code>对象的<code class="fe mh mi mj lx b">Storage</code>事件。<code class="fe mh mi mj lx b">LocalStorageExpiry</code>必备。</li></ul><p id="91a3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">注意</strong>:初始化应用程序时，您必须自己配置源代码。默认情况下，不会配置中断。您可以通过导入<code class="fe mh mi mj lx b">DEFAULT_INTERRUPTSOURCES</code>并将该引用传递给<code class="fe mh mi mj lx b">Idle.setInterrupts(DEFAULT_INTERRUPTSOURCES);</code>来使用类似于默认<code class="fe mh mi mj lx b">ng-idle</code>的配置。</p><h2 id="57e6" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">可延期到期</h2><p id="984e" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">从<code class="fe mh mi mj lx b">ng-idle</code>移植的另一个特性是能够在一些存储中存储到期值，运行相同应用程序的多个标签或窗口可以写入。一般来说，这家店是<code class="fe mh mi mj lx b">localStorage</code>，但也可能是饼干或任何你想要的东西。此到期和到期存储的目的有两个:第一，防止窗口在休眠或暂停时间超过配置的超时时间时不超时。第二，可以使用它来防止同一应用程序中的其他标签或窗口超时。</p><p id="68cc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">默认情况下，提供了一个<code class="fe mh mi mj lx b">LocalStorageExpiry</code>类型，它只跟踪本地存储中的到期时间。它将实现上述所有目的。如果不想支持多个标签页或窗口，可以使用<code class="fe mh mi mj lx b">SimpleExpiry</code>。换句话说，<code class="fe mh mi mj lx b">SimpleExpiry</code>不协调选项卡或窗口之间的最后活动。如果您想将到期值存储在另一个存储中，如cookies，您需要使用或创建一个支持它的实现。您可以通过扩展<code class="fe mh mi mj lx b">IdleExpiry</code>或<code class="fe mh mi mj lx b">SimpleExpiry</code>并将其配置为<code class="fe mh mi mj lx b">IdleExpiry</code>类的提供者来创建自己的。</p><h2 id="3814" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">多空闲实例支持</h2><p id="ef7b" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">Angular中的依赖注入器支持分层注入策略。这允许您在任何需要的范围内创建一个<code class="fe mh mi mj lx b">Idle</code>的实例，并且可以有多个实例。这允许你两个有两个单独的手表，例如，在页面上的两个不同的元素。<br/>如果您使用默认到期日(<code class="fe mh mi mj lx b">LocalStorageExpiry</code>)，您将需要使用<code class="fe mh mi mj lx b">Idle.setIdleName('yourIdleName')</code>为每个空闲定义一个名称，否则，相同的密钥将被用于本地存储，该功能将无法按预期工作。</p><h2 id="f9b8" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">示例使用案例</h2><p id="b109" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">例如，考虑电子邮件应用程序。为了提高安全性，应用程序可能希望确定用户何时处于非活动状态，并注销他们，如果他们仍然在计算机前，只是分心了，则给他们一个延长会话的机会。此外，为了获得更好的安全性，服务器可能会向用户的会话颁发一个安全令牌，该令牌会在用户处于非活动状态5分钟后过期。用户可能要花更多的时间来打出并发送他们的电子邮件。当你正在使用软件的时候，发现自己被注销了，这是一件令人沮丧的事情！</p><p id="ab46" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mh mi mj lx b">@ng-idle/core</code>可以检测到用户正在点击、打字、触摸、滚动等。并且知道用户仍然是活跃的。它可以与<code class="fe mh mi mj lx b">@ng-idle/keepalive</code>合作，每隔几分钟ping一次服务器，以保持他们登录。在这种情况下，只要用户在做什么，他们就保持登录状态。如果他们离开电脑，我们可以显示一个警告对话框，然后在倒计时后，让他们退出。<a class="ae lr" href="https://www.npmjs.com/package/@ng-idle/core" rel="noopener ugc nofollow" target="_blank">求更</a></p><p id="5f54" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="my">更多内容看</em> <a class="ae lr" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="my">说白了就是</em> </strong> </a> <em class="my">。报名参加我们的</em> <a class="ae lr" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="my">免费周报</em> </strong> </a> <em class="my">。关注我们关于</em> <a class="ae lr" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="my">推特</em> </strong> </a>，<a class="ae lr" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="my">领英</em> </strong> </a> <strong class="jx io"> <em class="my">，</em></strong><a class="ae lr" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="my">YouTube</em></strong></a><strong class="jx io"><em class="my">，以及</em></strong><em class="my"/><a class="ae lr" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="my">不和</em> </strong> </a>  <em class="my">对成长黑客感兴趣？检查出</em> <a class="ae lr" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="my">电路</em> </strong> </a> <strong class="jx io"> <em class="my">。</em>T71】</strong></p></div></div>    
</body>
</html>