<html>
<head>
<title>How to Create a Waterfall Chart in React With visx</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用visx创建瀑布图</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-a-waterfall-chart-in-react-with-visx-51ed1721dc77?source=collection_archive---------5-----------------------#2022-08-31">https://javascript.plainenglish.io/how-to-create-a-waterfall-chart-in-react-with-visx-51ed1721dc77?source=collection_archive---------5-----------------------#2022-08-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="e08f" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">关于如何使用Airbnb的visx库为React web应用程序创建瀑布图的教程。</h2></div><h1 id="2c8f" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">介绍</h1><p id="4bda" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">在本教程中，我们将了解如何为React web应用程序创建瀑布图。首先，我们来了解一下什么是瀑布图。</p><h1 id="ec24" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">什么是瀑布图？</h1><p id="9926" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">瀑布图类似于条形图，除了它的累积性质。它显示了一系列的步骤，因此在每一步当前值被增加或减少，显示了累积的结果。图表的最后一条代表总值。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lq"><img src="../Images/f9a30da6ea8d2651cf910ffcb528f23d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yzW7uFUtJlENRGCsdHK1LQ.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">A waterfall chart we are going to build</figcaption></figure><h1 id="2bd1" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">技术</h1><p id="04af" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">我们将使用Airbnb构建的visx库。Visx是一组底层的可视化原语，它使用d3进行数学运算，使用React进行高效的DOM管理。与eCharts、Recharts和类似的库不同，它不提供一组现成的图表。即使它们提供了高质量的可定制图表，也不可能构建与这些库所提供的完全不同的全新可视化类型。另一方面，visx提供了一组方便的构建块来创建任何定制的可视化。</p><h1 id="af2e" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">项目设置</h1><h2 id="5425" class="mg kd in bd ke mh mi dn ki mj mk dp km ld ml mm ko lh mn mo kq ll mp mq ks mr bi translated">1.创建新的React项目</h2><p id="a923" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">使用create-react-app CLI初始化React + TypeScript项目。</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="9b2c" class="mg kd in mt b gy mx my l mz na">yarn create react-app waterfall-chart --template typescript</span></pre><h2 id="3cd7" class="mg kd in bd ke mh mi dn ki mj mk dp km ld ml mm ko lh mn mo kq ll mp mq ks mr bi translated">2.安装依赖项</h2><p id="76e5" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">安装所需的visx和d3阵列依赖项。</p><pre class="lr ls lt lu gt ms mt mu mv aw mw bi"><span id="604b" class="mg kd in mt b gy mx my l mz na">yarn add <a class="ae nb" href="http://twitter.com/visx/axis" rel="noopener ugc nofollow" target="_blank">@visx/axis</a> <a class="ae nb" href="http://twitter.com/visx/grid" rel="noopener ugc nofollow" target="_blank">@visx/grid</a> <a class="ae nb" href="http://twitter.com/visx/group" rel="noopener ugc nofollow" target="_blank">@visx/group</a> <a class="ae nb" href="http://twitter.com/visx/scale" rel="noopener ugc nofollow" target="_blank">@visx/scale</a> <a class="ae nb" href="http://twitter.com/visx/shape" rel="noopener ugc nofollow" target="_blank">@visx/shape</a> <a class="ae nb" href="http://twitter.com/visx/text" rel="noopener ugc nofollow" target="_blank">@visx/text</a> <a class="ae nb" href="http://twitter.com/visx/responsive" rel="noopener ugc nofollow" target="_blank">@visx/responsive</a> d3-array</span><span id="ce6c" class="mg kd in mt b gy nc my l mz na">yarn add --dev <a class="ae nb" href="http://twitter.com/types/d3-array" rel="noopener ugc nofollow" target="_blank">@types/d3-array</a></span></pre><h2 id="69f8" class="mg kd in bd ke mh mi dn ki mj mk dp km ld ml mm ko lh mn mo kq ll mp mq ks mr bi translated">3.创建项目框架</h2><p id="9362" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">我们将从创建瀑布图的基础开始。在src文件夹下创建以下文件:</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Project boilerplate</figcaption></figure><p id="7781" class="pw-post-body-paragraph ku kv in kw b kx nf jo kz la ng jr lc ld nh lf lg lh ni lj lk ll nj ln lo lp ig bi translated">该代码使用来自<code class="fe nk nl nm mt b">@visx/responsive</code>包的<code class="fe nk nl nm mt b">ParentSize</code> <strong class="kw io"> </strong>组件，其目的是测量其父元素的尺寸，并将它们提供给子<code class="fe nk nl nm mt b">WaterfallChart</code>组件。</p><h1 id="a814" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">构建瀑布图</h1><p id="ec2e" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">在接下来的步骤中，我们将设计组件API，并从轴和网格开始逐步构建图表，最后呈现数据标签。</p><h2 id="637c" class="mg kd in bd ke mh mi dn ki mj mk dp km ld ml mm ko lh mn mo kq ll mp mq ks mr bi translated">1.定义组件API</h2><p id="b780" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">我们的图表应该支持可视化任意数据集。为了用类型安全支持它，让我们用描述数据形状的<code class="fe nk nl nm mt b">TDatum</code>类型参数使组件通用化。我们还需要指定访问器函数来从单个数据点中检索X和Y值。</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">WatercallChart component API</figcaption></figure><h2 id="e07d" class="mg kd in bd ke mh mi dn ki mj mk dp km ld ml mm ko lh mn mo kq ll mp mq ks mr bi translated">2.计算瀑布条形图</h2><p id="6d41" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">下一步是从原始数据计算瀑布步骤。这可以通过使用累积值跟踪对数据进行顺序枚举来实现。在每一步，前一个累积值表示列的起点，终点通过加上或减去当前数据点值来表示。</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Calculating waterfall steps from raw data</figcaption></figure><h2 id="91bd" class="mg kd in bd ke mh mi dn ki mj mk dp km ld ml mm ko lh mn mo kq ll mp mq ks mr bi translated">3.构建图表刻度</h2><p id="8fd6" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">现在，当我们有实际值要呈现时，我们可以计算图表比例。<strong class="kw io"> Scale </strong>是一个将数据集值映射成可视值的函数，在我们的例子中是坐标。</p><p id="2f30" class="pw-post-body-paragraph ku kv in kw b kx nf jo kz la ng jr lc ld nh lf lg lh ni lj lk ll nj ln lo lp ig bi translated">对于<code class="fe nk nl nm mt b">xScale</code>，我们的域是一组瀑布步骤，它们将映射到<code class="fe nk nl nm mt b">[0, innerWidth]</code>的坐标范围内。<code class="fe nk nl nm mt b">padding</code>参数定义条间距。</p><p id="0db5" class="pw-post-body-paragraph ku kv in kw b kx nf jo kz la ng jr lc ld nh lf lg lh ni lj lk ll nj ln lo lp ig bi translated">另一方面，为了计算Y轴域，我们需要遍历起始值和结束值，找到它们之间的最小值和最大值。然后我们将它映射到<code class="fe nk nl nm mt b">[innerHeight, 0]</code>的坐标范围内。<code class="fe nk nl nm mt b">nice</code>参数扩大了域间隔，以使用舍入值来更好地理解图形。</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Creating chart scale functions</figcaption></figure><h2 id="ecf2" class="mg kd in bd ke mh mi dn ki mj mk dp km ld ml mm ko lh mn mo kq ll mp mq ks mr bi translated">4.呈现图表轴</h2><p id="05fe" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">使用scale函数，我们能够呈现图表轴和背景网格。visx库为我们将要使用的组件提供了现成的可配置组件。</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nn"><img src="../Images/3dc3817fa0b7e74deb7750736f464091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_e4J6qI2bjUJ55pTEJ9U1Q.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Chart axes and a background grid</figcaption></figure><h2 id="1532" class="mg kd in bd ke mh mi dn ki mj mk dp km ld ml mm ko lh mn mo kq ll mp mq ks mr bi translated">5.渲染瀑布台阶</h2><p id="e0e2" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">使用图表刻度和先前计算的步骤，我们可以计算图表条的坐标及其高度，如下所示。</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Rendering waterfall steps</figcaption></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi no"><img src="../Images/5d0b38de37eec2ac0ed7a0ba4e6aa713.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tP8pWEBFnEHecp6ZMafPSg.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Almost ready waterfall chart</figcaption></figure><h2 id="aace" class="mg kd in bd ke mh mi dn ki mj mk dp km ld ml mm ko lh mn mo kq ll mp mq ks mr bi translated">6.添加标签和步骤连接</h2><p id="d377" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">添加数据标签可以提高图表的可读性。下面的代码在条形的上方呈现正值，下方呈现负值。作为点睛之笔，让我们用虚线连接酒吧。</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Render bars with data labels</figcaption></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi np"><img src="../Images/6e57ddefd64101bade53ea748f1968ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UrO1R0OmV8MsAKbLFB1ftA.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">The final result</figcaption></figure><h1 id="b588" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">结论</h1><p id="7c39" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">在本指南中，我们了解了什么是瀑布图，以及如何使用visx的低级原语来帮助React应用程序创建瀑布图。我希望你觉得这个指南有用。感谢您的阅读。</p><p id="c362" class="pw-post-body-paragraph ku kv in kw b kx nf jo kz la ng jr lc ld nh lf lg lh ni lj lk ll nj ln lo lp ig bi translated">完整的源代码可以在我的GitHub上找到:<a class="ae nb" href="https://github.com/alxnddr/waterfall-chart-example" rel="noopener ugc nofollow" target="_blank">https://github.com/alxnddr/waterfall-chart-example</a></p></div><div class="ab cl nq nr hr ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ig ih ii ij ik"><p id="eab5" class="pw-post-body-paragraph ku kv in kw b kx nf jo kz la ng jr lc ld nh lf lg lh ni lj lk ll nj ln lo lp ig bi translated"><em class="nx">更多内容看</em> <a class="ae nb" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw io"> <em class="nx">说白了。报名参加我们的</em> <a class="ae nb" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw io"> <em class="nx">免费周报</em> </strong> </a> <em class="nx">。关注我们关于</em> <a class="ae nb" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kw io"> <em class="nx">推特</em> </strong> </a>，<a class="ae nb" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kw io"><em class="nx">LinkedIn</em></strong></a><em class="nx">，</em><a class="ae nb" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kw io"><em class="nx">YouTube</em></strong></a><em class="nx">，</em> <a class="ae nb" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kw io"> <em class="nx">不和</em> </strong> </a> <em class="nx">。</em></strong></a></p></div></div>    
</body>
</html>