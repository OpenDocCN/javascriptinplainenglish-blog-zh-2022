<html>
<head>
<title>Implement Relay Cursor Connections Specification in NestJS with GraphQL Relay</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用GraphQL中继实现NestJS中的中继游标连接规范</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/implement-relay-cursor-connections-specification-in-nestjs-with-graphql-relay-9ba96c4bca79?source=collection_archive---------5-----------------------#2022-07-25">https://javascript.plainenglish.io/implement-relay-cursor-connections-specification-in-nestjs-with-graphql-relay-9ba96c4bca79?source=collection_archive---------5-----------------------#2022-07-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4d4e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在NestJS中实现基于GraphQL中继光标的分页的简单步骤。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2885b0c1b485d712640a3254da27d105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*P1oLICYMm9trbCRj"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@dtopkin1?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Dayne Topkin</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a6d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">GraphQL中的分页是一项非常艰巨的任务。没有好的架构，它会变得相当混乱和令人沮丧。</p><p id="ec48" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文将构建一个简单的接口来实现relay风格的GraphQL分页，您可以在任何NestJS GraphQL项目中使用它。这个接口的目的是保持你的代码整洁、简单和有组织。</p><p id="c230" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，没有进一步的行动，让我们进入正题。</p><h2 id="84ff" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">什么是中继光标连接规范</h2><p id="eee4" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">如果你们中的任何人对什么是中继光标连接规范以及为什么我们应该在实现GraphQL分页时使用它有疑问，我在几个月前已经写了一篇文章解释了原因。下面附上文章:</p><div class="mq mr gp gr ms mt"><a rel="noopener  ugc nofollow" target="_blank" href="/best-practices-to-work-with-graphql-pagination-8f0d1f9937c2"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd ir gy z fp my fr fs mz fu fw ip bi translated">使用GraphQL分页的最佳实践</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">再也不用担心使用GraphQL分页了</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh kp mt"/></div></div></a></div><p id="dbc5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ni">总之，Relay Cursor Connections Specification，简称Cursor Connections Specification，旨在为GraphQL客户端提供处理分页最佳实践的选项，并通过GraphQL服务器支持相关元数据。</em></p><p id="1cf5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">GraphQL分页同时维护游标连接规范的一个示例是:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="9b55" class="ls lt iq nk b gy no np l nq nr">{<br/>  user {<br/>    id<br/>    name<br/>    friends(first: 10, after: "opaqueCursor") {<br/>      edges {<br/>        cursor<br/>        node {<br/>          id<br/>          name<br/>        }<br/>      }<br/>      pageInfo {<br/>        <!-- -->startCursor<br/>        endCursor<br/>        hasPreviousPage<br/>        hasNextPage<br/>      }<br/>    }<br/>  }<br/>}</span></pre><h2 id="e6fe" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">履行</h2><p id="0c71" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated"><strong class="ky ir">步骤1: </strong>我们需要做的第一步是在我们的NestJS应用程序中安装<code class="fe ns nt nu nk b">graphql-relay</code>。我们可以通过在终端中运行以下命令来安装这个软件包:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="ecc5" class="ls lt iq nk b gy no np l nq nr">npm install graphql-relay</span></pre><p id="a742" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">步骤2: 在一个公共文件夹中创建一个名为<code class="fe ns nt nu nk b">relay.types.ts</code>的新文件，最好是在一个共享的DTO中。然后，将下面的代码粘贴到<code class="fe ns nt nu nk b">relay.types.ts</code>中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="0b43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">步骤3: </strong>现在，在同一个目录下创建另一个名为<code class="fe ns nt nu nk b">connection.args.ts</code>的文件，并粘贴以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="8446" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们已经成功地设置了主接口，以后可以在我们的NestJS项目中使用它来实现基于游标连接规范的分页。</p><h2 id="61d6" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">如何使用它</h2><p id="d45d" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">因为我们实现了主接口，所以是时候使用它了。让我们首先创建一个资源，我们将使用它进行分页。</p><p id="b1ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">步骤4: </strong>在NestJS中，我们可以通过键入以下命令轻松创建资源:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="da55" class="ls lt iq nk b gy no np l nq nr">nest g resource teams</span></pre><p id="a9c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当它问你“你用什么传输层？”，输入如下的第二个:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/8e80f83fe255a24ef7e9b67a69860c1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*p14Q2C2MpbL2XQM6XYZmmg.png"/></div></figure><p id="9ab4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，它会问你，“你想生成CRUD入口点吗？(是/否)”。输入<code class="fe ns nt nu nk b">Y</code>。</p><p id="94c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">步骤5: </strong>现在让我们定义资源的实体。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="fc68" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，我使用Mongoose，因为我在我的项目中使用MongoDB，但是它可以与任何ORM和数据库配置一起工作。</p><p id="b6cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">第六步:</strong>让我们在<code class="fe ns nt nu nk b">teams</code>模块的DTO文件夹中创建另一个名为<code class="fe ns nt nu nk b">team.response.ts</code>的文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="5f53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">第7步:</strong>让我们更改用于实现GraphQL分页的<code class="fe ns nt nu nk b">teams.resolver.ts</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="bc35" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">第八步:</strong>最后，我们来修改一下<code class="fe ns nt nu nk b">teams.service.ts</code>文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><h2 id="400b" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">决赛成绩</h2><p id="f270" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">成功修改所有更改后，我们可以看到下面的输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/a6c62f4c668741bc6e40e728a0f88ed5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IVN5mcLdbF8Jj_uilXX1dg.png"/></div></div></figure><h2 id="365f" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">结论</h2><p id="e657" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">从上面的实现中，我们可以看到我们的解析器和服务更加干净和简单。然而，我们可以在应用程序中获得接力式分页的强大功能。</p><p id="2365" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种方法效率更高。无论我们的应用程序变得多么庞大，分页的实现都会更加简单，但也更加强大。</p><h2 id="761e" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">参考</h2><ol class=""><li id="bdae" class="nz oa iq ky b kz ml lc mm lf ob lj oc ln od lr oe of og oh bi translated"><a class="ae kv" href="https://codesandbox.io/s/q4cto" rel="noopener ugc nofollow" target="_blank">https://codesandbox.io/s/q4cto</a></li><li id="58f3" class="nz oa iq ky b kz oi lc oj lf ok lj ol ln om lr oe of og oh bi translated"><a class="ae kv" href="https://relay.dev/graphql/connections.htm" rel="noopener ugc nofollow" target="_blank">https://relay.dev/graphql/connections.htm</a></li></ol><p id="b592" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ni">通过</em><a class="ae kv" href="https://www.linkedin.com/in/ludehsar/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ni">Linkedin</em></strong></a><em class="ni">或</em> <a class="ae kv" href="https://rashedul-alam.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ni">与我联系我的网站</em> </strong> </a> <em class="ni">。</em></p></div><div class="ab cl on oo hu op" role="separator"><span class="oq bw bk or os ot"/><span class="oq bw bk or os ot"/><span class="oq bw bk or os"/></div><div class="ij ik il im in"><p id="e7f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ni">更多内容请看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ni">plain English . io</em></strong></a><em class="ni">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ni">免费每周简讯</em> </strong> </a> <em class="ni">。关注我们关于</em><a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ni">Twitter</em></strong></a><em class="ni">和</em><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ni">LinkedIn</em></strong></a><em class="ni">。查看我们的</em> <a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ni">社区不和谐</em> </strong> </a> <em class="ni">加入我们的</em> <a class="ae kv" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="ni">人才集体</em> </strong> </a> <em class="ni">。</em></p></div></div>    
</body>
</html>