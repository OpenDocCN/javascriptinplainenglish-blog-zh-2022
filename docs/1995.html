<html>
<head>
<title>How to Create Multi-Page Forms Using Remix &amp; Redis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Remix &amp; Redis创建多页表单</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/multi-page-forms-using-remix-and-redis-24d5817301c3?source=collection_archive---------5-----------------------#2022-05-05">https://javascript.plainenglish.io/multi-page-forms-using-remix-and-redis-24d5817301c3?source=collection_archive---------5-----------------------#2022-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a1c0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Remix和Redis创建多页表单的指南。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/7550a065df8421934c5122734024b092.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cIvx2R4-F2VWadmvWL_L_w.png"/></div></div></figure><p id="3a38" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最近，我开始使用Remix创建一个多页表单。我决定使用Redis来存储可以在页面之间使用的表单数据的临时版本。这是一个测试项目，展示了许多相同的用例及实现。</p><p id="aa41" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该项目的代码可以在GitHub上找到:</p><div class="ln lo gp gr lp lq"><a href="https://github.com/jnoahjohnson/remix-redis-form" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab fo"><div class="ls ab lt cl cj lu"><h2 class="bd ir gy z fp lv fr fs lw fu fw ip bi translated">GitHub-jnoahjohnson/remix-redis-form:使用Remix和Redis的多页表单。</h2><div class="lx l"><h3 class="bd b gy z fp lv fr fs lw fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ly l"><p class="bd b dl z fp lv fr fs lw fu fw dk translated">github.com</p></div></div><div class="lz l"><div class="ma l mb mc md lz me kp lq"/></div></div></a></div><p id="8d15" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">发布在诺亚·约翰逊开发网站上的原始文章:</p><div class="ln lo gp gr lp lq"><a href="https://blog.noahjohnson.dev/remix-redis-form" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab fo"><div class="ls ab lt cl cj lu"><h2 class="bd ir gy z fp lv fr fs lw fu fw ip bi translated">使用Remix和Redis的多页表单</h2><div class="lx l"><h3 class="bd b gy z fp lv fr fs lw fu fw dk translated">最近，我开始使用Remix创建一个多页表单。我决定使用Redis来存储一个临时版本的…</h3></div><div class="ly l"><p class="bd b dl z fp lv fr fs lw fu fw dk translated">blog.noahjohnson.dev</p></div></div><div class="lz l"><div class="mf l mb mc md lz me kp lq"/></div></div></a></div><h1 id="8b6a" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">设置</h1><p id="7c95" class="pw-post-body-paragraph kr ks iq kt b ku my jr kw kx mz ju kz la na lc ld le nb lg lh li nc lk ll lm ij bi translated">创建一个新的混音项目，或使用现有的项目。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="8bed" class="ni mh iq ne b gy nj nk l nl nm">npx create-remix@latest</span></pre><p id="3582" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这适用于任何选项。我选择了Remix应用服务器，因为我将在Fly.io上部署和运行它。</p><h2 id="da07" class="ni mh iq bd mi nn no dn mm np nq dp mq la nr ns ms le nt nu mu li nv nw mw nx bi translated">安装依赖项</h2><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="ad46" class="ni mh iq ne b gy nj nk l nl nm">npm install redis</span></pre><p id="be6c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于这个基本的演示，我们只需要安装Redis。我还打算安装顺风stying。你可以在<a class="ae ny" href="https://remix.run/docs/en/v1/guides/styling#tailwind-css" rel="noopener ugc nofollow" target="_blank"> Remix文档</a>中找到关于在你的项目中安装tailwind的说明</p><h2 id="9654" class="ni mh iq bd mi nn no dn mm np nq dp mq la nr ns ms le nt nu mu li nv nw mw nx bi translated">在本地设置Redis</h2><p id="6bff" class="pw-post-body-paragraph kr ks iq kt b ku my jr kw kx mz ju kz la na lc ld le nb lg lh li nc lk ll lm ij bi translated">让Redis在本地运行的一个简单方法是通过Docker。确保安装Docker(这里的<a class="ae ny" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">是Docker上的文档)。将文件名<code class="fe nz oa ob ne b">docker-compose.yml</code>添加到项目的根目录，然后将以下代码添加到该文件中:</a></p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="784e" class="ni mh iq ne b gy nj nk l nl nm">version: "3.7"<br/>services:<br/>  redis:<br/>    image: redis:3.0.6<br/>    ports:<br/>      - "6379:6379"<br/>    volumes:<br/>      - ./data/redis:/data</span></pre><p id="d1f6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="oc">注意:如果您在本地运行Redis，您需要更改端口，这样它就不会与您的本地reds实例冲突。</em></p><p id="2d8c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，在package.json中添加一个新脚本，您可以运行该脚本来运行Redis实例:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="21e5" class="ni mh iq ne b gy nj nk l nl nm">{<br/>	"scripts": {<br/>		/* Rest of Scripts */<br/>		"docker": "docker-compose up -d",<br/>	},<br/>}</span></pre><p id="908f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，您可以通过运行以下命令启动Redis实例:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="aa6b" class="ni mh iq ne b gy nj nk l nl nm">npm run docker</span></pre><p id="d2ca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="oc">注意:docker脚本上的-d标志意味着它将以分离模式运行。只要确保你的控制台没有错误，并且它在后台运行。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl od"><img src="../Images/4c4f8aff635d67595e30dbee4fa73499.png" data-original-src="https://miro.medium.com/v2/format:webp/1*VzF4RDOI5Rl1bh6Zsf_6SA.jpeg"/></div></figure><h2 id="f9d8" class="ni mh iq bd mi nn no dn mm np nq dp mq la nr ns ms le nt nu mu li nv nw mw nx bi translated">设置环境变量</h2><p id="512c" class="pw-post-body-paragraph kr ks iq kt b ku my jr kw kx mz ju kz la na lc ld le nb lg lh li nc lk ll lm ij bi translated">设置的最后一步是设置Redis URL环境变量。创建一个名为<code class="fe nz oa ob ne b">.env</code>的文件，并添加一行如下内容:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="5a4c" class="ni mh iq ne b gy nj nk l nl nm">REDIS_URL="redis://localhost:6379"</span></pre><p id="ed68" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这将用于创建与本地Redis实例的连接。然后可以在应用程序的已部署版本中设置一个环境密码，以连接到远程Redis实例。</p><h1 id="5b4d" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">开始</h1><p id="b654" class="pw-post-body-paragraph kr ks iq kt b ku my jr kw kx mz ju kz la na lc ld le nb lg lh li nc lk ll lm ij bi translated">基本设置完成后，让我们开始创建多页表单吧！</p><p id="dcce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将修改<code class="fe nz oa ob ne b">index.tsx</code>路线，使其链接到我们将创建的表单嵌套路线:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="aad2" class="ni mh iq ne b gy nj nk l nl nm">// index.tsx<br/><br/>import { Link } from "@remix-run/react";<br/><br/>export default function Index() {<br/>  return (<br/>    &lt;main className="w-full py-4 text-center"&gt;<br/>      &lt;Link<br/>        to="/form"<br/>        className="rounded bg-blue-600 px-4 py-2 text-white shadow hover:bg-blue-800"<br/>      &gt;<br/>        Go to Form<br/>      &lt;/Link&gt;<br/>    &lt;/main&gt;<br/>  );<br/>}</span></pre><p id="f7db" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，在routes文件夹中创建一个名为<code class="fe nz oa ob ne b">form.tsx</code>的新文件，然后，让我们为表单周围的元素创建基本结构:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="760b" class="ni mh iq ne b gy nj nk l nl nm">// form.tsx<br/><br/>import { Outlet } from "@remix-run/react";<br/><br/>export default function FormRoot() {<br/>  return (<br/>    &lt;main className="mx-auto h-full w-full max-w-2xl py-4"&gt;<br/>      &lt;header&gt;<br/>        &lt;h1 className="text-3xl font-bold"&gt;Remix Redis Form&lt;/h1&gt;<br/>      &lt;/header&gt;<br/>      &lt;Outlet /&gt;<br/>    &lt;/main&gt;<br/>  );<br/>}</span></pre><p id="80a8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="oc">注意:如果您不熟悉Remix中的路由，Outlet组件将在其位置呈现任何嵌套的路由。这意味着我们在文件夹</em> <code class="fe nz oa ob ne b"><em class="oc">/routes/form/</em></code> <em class="oc">中创建的下一个组件将代替插座进行渲染。</em></p><p id="23ca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将创建的下一个文件是routes中表单文件夹内的索引文件。所以创建一个名为<code class="fe nz oa ob ne b">form</code>的新文件夹，然后在里面创建一个名为<code class="fe nz oa ob ne b">index.tsx</code>的新文件。然后，我们将在该文件中创建表单的第一页:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="ba67" class="ni mh iq ne b gy nj nk l nl nm">// form/index.tsx<br/><br/>import { Form } from "@remix-run/react";<br/><br/>export default function FormIndex() {<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;h2 className="text-lg text-gray-600"&gt;Basic Info&lt;/h2&gt;<br/>      &lt;Form method="post"&gt;<br/>        &lt;label className="mb-1"&gt;<br/>          Name<br/>          &lt;input<br/>            type="text"<br/>            name="name"<br/>            placeholder="Name"<br/>            className="mb-2 w-full p-2 text-lg shadow-md"<br/>          /&gt;<br/>        &lt;/label&gt;<br/>        &lt;label className="mb-1"&gt;<br/>          Phone<br/>          &lt;input<br/>            type="tel"<br/>            name="phone"<br/>            placeholder="(123) 456-7890"<br/>            className="mb-2 w-full p-2 text-lg shadow-md"<br/>          /&gt;<br/>        &lt;/label&gt;<br/>        &lt;label className="mb-1"&gt;<br/>          Email<br/>          &lt;input<br/>            type="email"<br/>            name="email"<br/>            placeholder="test@example.com"<br/>            className="mb-2 w-full p-2 text-lg shadow-md"<br/>          /&gt;<br/>        &lt;/label&gt;<br/>        &lt;button className="mx-auto mt-2 block w-1/2 rounded bg-blue-600 py-2 text-white hover:bg-blue-700"&gt;<br/>          Continue<br/>        &lt;/button&gt;<br/>      &lt;/Form&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="ebb9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有了基本表单后，我们可以设置第一个ActionFunction来接收表单数据，将对象保存在Redis中，然后使用关键字作为搜索参数导航到下一个页面。让我们从ActionFunction开始:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="b27e" class="ni mh iq ne b gy nj nk l nl nm">// form/index.tsx<br/><br/>/* Other imports */<br/>import type { ActionFunction } from "@remix-run/node";<br/>import { redirect } from "@remix-run/node";<br/>import { saveToRedis } from "~/services/redis.server";<br/>import type { CustomFormData } from "~/types/form";<br/>import { generateCode } from "../utils/helpers.server";<br/><br/>export const action: ActionFunction = async ({ request }) =&gt; {<br/>  // Get the form data from the request.<br/>  const formData = await request.formData();<br/><br/>  // Get each form element<br/>  const name = formData.get("name");<br/>  const phone = formData.get("phone");<br/>  const email = formData.get("email");<br/><br/>  // Check if the form data is valid<br/>  if (<br/>    typeof name !== "string" ||<br/>    typeof phone !== "string" ||<br/>    typeof email !== "string"<br/>  ) {<br/>    throw Error("Form data is invalid"); // This error could be handled differently, but we will keep it for now<br/>  }<br/><br/>  // Create an ID for the form data<br/>  const id = generateCode(6); // Should generate a random, unique ID<br/><br/>  // Create a new object of type CustomFormData<br/>  const formDataObject: CustomFormData = {<br/>    id,<br/>    name,<br/>    phone,<br/>    email,<br/>    // There are other optional fields that will be added in later<br/>  };<br/><br/>  // Save the form data to Redis with a helper in the services folder<br/>  await saveToRedis(formDataObject);<br/><br/>  return redirect(`/form/more?id=${formDataObject.id}`);<br/>};<br/><br/>/* FormIndex Component /*</span></pre><p id="4fb7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了让这个动作函数工作，我们将编写几个函数和一个自定义类型。首先，我们使用一个基本函数为ID生成一个代码。这可以用多种方式来完成，但这里是我正在使用的放在文件<code class="fe nz oa ob ne b">/utils/helpers.server.ts</code>中的函数。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="8a37" class="ni mh iq ne b gy nj nk l nl nm">export const generateCode = (length: number): string =&gt; {<br/>  var result = "";<br/>  var characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";<br/>  var charactersLength = characters.length;<br/>  for (var i = 0; i &lt; length; i++) {<br/>    result += characters.charAt(Math.floor(Math.random() * charactersLength));<br/>  }<br/>  return result;<br/>};</span></pre><p id="b755" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将该类型放在一个名为<code class="fe nz oa ob ne b">types</code>的文件夹中，这样它可以被助手函数以及不同的路径使用。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="d87f" class="ni mh iq ne b gy nj nk l nl nm">export type CustomFormData = {<br/>  id: string;<br/>  name: string;<br/>  phone: string;<br/>  email: string;<br/>  bio?: string;<br/>  birthday?: Date;<br/>  age?: number;<br/>};</span></pre><p id="87fe" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，我创建了一个函数来将数据保存到Redis，并将其放在一个新文件中的<code class="fe nz oa ob ne b">services</code>文件夹中。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="8080" class="ni mh iq ne b gy nj nk l nl nm">// services/redis.server.ts<br/><br/>import * as redis from "redis";<br/>import type { CustomFormData } from "~/types/form";<br/><br/>const client = redis.createClient({<br/>  url: process.env.REDIS_URL,<br/>});<br/><br/>client.on("error", (err) =&gt; console.log("Redis client error", err));<br/><br/>// If you update the data type, update the key version so you are not left with invalid states<br/>const KEY_VERSION = "1";<br/><br/>export const saveToRedis = async (data: CustomFormData) =&gt; {<br/>  await client.connect();<br/>  await client.set(`f-${KEY_VERSION}-${data.id}`, JSON.stringify(data));<br/>  await client.quit();<br/>};</span></pre><h2 id="9b04" class="ni mh iq bd mi nn no dn mm np nq dp mq la nr ns ms le nt nu mu li nv nw mw nx bi translated">另一个表单页面</h2><p id="3506" class="pw-post-body-paragraph kr ks iq kt b ku my jr kw kx mz ju kz la na lc ld le nb lg lh li nc lk ll lm ij bi translated">接下来，我们将创建另一个表单页面，该页面将检查Redis中是否有具有给定ID的数据，如果有，则呈现该页面。ID应该被传递到页面中，以便在下一个动作函数中使用。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="8df3" class="ni mh iq ne b gy nj nk l nl nm">import type { LoaderFunction } from "@remix-run/node";<br/>import { Form, useLoaderData } from "@remix-run/react";<br/>import { requireFormData } from "~/services/redis.server";<br/><br/>export const loader: LoaderFunction = async ({ request }) =&gt; {<br/>  // Function in redis.server.ts that is reusable for each page of the form<br/>  const id = await requireFormData(request);<br/><br/>  return id;<br/>};<br/><br/>export default function MoreForm() {<br/>  const { id } = useLoaderData&lt;{ id: string }&gt;();<br/><br/>  return (<br/>    &lt;div&gt;<br/>      &lt;h2 className="text-lg text-gray-600"&gt;Basic Info&lt;/h2&gt;<br/>      &lt;Form method="post"&gt;<br/>        &lt;input type="hidden" name="id" value={id} /&gt;<br/>        &lt;label className="mb-1"&gt;<br/>          Bio<br/>          &lt;input<br/>            type="text"<br/>            name="bio"<br/>            placeholder="Bio"<br/>            className="mb-2 w-full p-2 text-lg shadow-md"<br/>          /&gt;<br/>        &lt;/label&gt;<br/>        &lt;label className="mb-1"&gt;<br/>          Birthday<br/>          &lt;input<br/>            type="date"<br/>            name="birthday"<br/>            className="mb-2 w-full p-2 text-lg shadow-md"<br/>          /&gt;<br/>        &lt;/label&gt;<br/>        &lt;label className="mb-1"&gt;<br/>          Age<br/>          &lt;input<br/>            type="number"<br/>            name="age"<br/>            placeholder="0"<br/>            className="mb-2 w-full p-2 text-lg shadow-md"<br/>          /&gt;<br/>        &lt;/label&gt;<br/>        &lt;button className="mx-auto mt-2 block w-1/2 rounded bg-blue-600 py-2 text-white hover:bg-blue-700"&gt;<br/>          Continue<br/>        &lt;/button&gt;<br/>      &lt;/Form&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="ab00" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在为了实现<code class="fe nz oa ob ne b">requireFormData</code>函数，我们将在<code class="fe nz oa ob ne b">redis.server.ts</code>中创建两个新函数。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="d252" class="ni mh iq ne b gy nj nk l nl nm">export const getDataFromRedis = async (<br/>  id: string<br/>): Promise&lt;CustomFormData | null&gt; =&gt; {<br/>  // Get data from redis<br/>  await client.connect();<br/>  const data = await client.get(`f-${KEY_VERSION}-${id}`);<br/>  await client.quit();<br/><br/>  if (!data) {<br/>    return null;<br/>  }<br/><br/>  const formData = JSON.parse(data) as CustomFormData;<br/><br/>  return formData;<br/>};<br/><br/>export const requireFormData = async (<br/>  request: Request<br/>): Promise&lt;CustomFormData&gt; =&gt; {<br/>  // Get ID from search params<br/>  const url = new URL(request.url);<br/>  const id = url.searchParams.get("id");<br/><br/>  if (typeof id !== "string" || !id) {<br/>    throw Error("Issue getting id");<br/>  }<br/><br/>  // Get cached form data from Redis<br/>  const formData = await getDataFromRedis(id);<br/><br/>  if (!formData) {<br/>    throw Error("No Data Found");<br/>  }<br/><br/>  return formData;<br/>};</span></pre><p id="1f13" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，让我们添加ActionFunction，它将处理表单数据并再次保存到Redis:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="dcc3" class="ni mh iq ne b gy nj nk l nl nm">import type { ActionFunction, LoaderFunction } from "@remix-run/node";<br/>import { redirect } from "@remix-run/node";<br/>import { Form, useLoaderData } from "@remix-run/react";<br/>import {<br/>  getDataFromRedis,<br/>  requireFormData,<br/>  saveToRedis,<br/>} from "~/services/redis.server";<br/><br/>export const action: ActionFunction = async ({ request }) =&gt; {<br/>  const formData = await request.formData();<br/><br/>  const id = formData.get("id");<br/>  const bio = formData.get("bio");<br/>  const birthday = formData.get("birthday");<br/>  const age = formData.get("age");<br/><br/>  if (<br/>    typeof id !== "string" ||<br/>    typeof bio !== "string" ||<br/>    typeof birthday !== "string" ||<br/>    typeof age !== "string"<br/>  ) {<br/>    throw Error("Form data is invalid");<br/>  }<br/><br/>  const customFormData = await getDataFromRedis(id);<br/><br/>  if (!customFormData) {<br/>    throw Error("Form data is not found");<br/>  }<br/><br/>  customFormData.bio = bio;<br/>  customFormData.birthday = new Date(birthday);<br/>  customFormData.age = parseInt(age);<br/><br/>  await saveToRedis(customFormData);<br/><br/>  return redirect(`/form/confirm?id=${customFormData.id}`);<br/>};</span></pre><h2 id="c320" class="ni mh iq bd mi nn no dn mm np nq dp mq la nr ns ms le nt nu mu li nv nw mw nx bi translated">最后一页</h2><p id="b666" class="pw-post-body-paragraph kr ks iq kt b ku my jr kw kx mz ju kz la na lc ld le nb lg lh li nc lk ll lm ij bi translated">我们在最后一页！我们将创建一个确认页面，然后可以提交数据。很多概念都是一样的。然后，我们将看看如何添加编辑功能来返回到前面的页面并修改表单数据。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="bcf8" class="ni mh iq ne b gy nj nk l nl nm">// form/confirm.tsx<br/><br/>import type { ActionFunction, LoaderFunction } from "@remix-run/node";<br/>import { redirect } from "@remix-run/node";<br/>import { Form, Link, useLoaderData } from "@remix-run/react";<br/>import {<br/>  deleteFormData,<br/>  getDataFromRedis,<br/>  requireFormData,<br/>} from "~/services/redis.server";<br/>import type { CustomFormData } from "~/types/form";<br/><br/>export const action: ActionFunction = async ({ request }) =&gt; {<br/>  const formData = await request.formData();<br/><br/>  const id = formData.get("id");<br/><br/>  if (typeof id !== "string") {<br/>    throw Error("Form data is invalid");<br/>  }<br/><br/>  const customFormData = await getDataFromRedis(id);<br/><br/>  if (!customFormData) {<br/>    throw Error("Form data is not found");<br/>  }<br/><br/>  /*<br/>    Here you can use the custom form data however you want, <br/>    for example adding it to a database<br/>  */<br/><br/>  console.log(customFormData);<br/><br/>  // Can cleanup the form data from Redis<br/>  await deleteFormData(id);<br/><br/>  return redirect(`/`);<br/>};<br/><br/>export const loader: LoaderFunction = async ({ request }) =&gt; {<br/>  // Function in redis.server.ts that is reusable for each page of the form<br/>  const formData = await requireFormData(request);<br/>  return formData;<br/>};<br/><br/>export default function MoreForm() {<br/>  const data = useLoaderData&lt;CustomFormData&gt;();<br/><br/>  return (<br/>    &lt;div&gt;<br/>      &lt;div className="mb-4"&gt;<br/>        &lt;h2 className="text-lg text-gray-600"&gt;Basic Info&lt;/h2&gt;<br/>        &lt;p&gt;Name: {data.name}&lt;/p&gt;<br/>        &lt;p&gt;Phone: {data.phone}&lt;/p&gt;<br/>        &lt;p&gt;Email: {data.email}&lt;/p&gt;<br/>        &lt;Link<br/>          to={`/form?id=${data.id}`}<br/>          className="text-blue-700 hover:underline"<br/>        &gt;<br/>          Edit<br/>        &lt;/Link&gt;<br/>      &lt;/div&gt;<br/><br/>      &lt;div className="mb-4"&gt;<br/>        &lt;h2 className="text-lg text-gray-600"&gt;More Info&lt;/h2&gt;<br/>        &lt;p&gt;Bio: {data.bio ?? ""}&lt;/p&gt;<br/>        &lt;p&gt;Birthday: {data.birthday ?? ""}&lt;/p&gt;<br/>        &lt;p&gt;Age: {data.age ?? ""}&lt;/p&gt;<br/>        &lt;Link<br/>          to={`/form/more?id=${data.id}`}<br/>          className="text-blue-700 hover:underline"<br/>        &gt;<br/>          Edit<br/>        &lt;/Link&gt;<br/>      &lt;/div&gt;<br/><br/>      &lt;Form method="post"&gt;<br/>        &lt;input type="hidden" name="id" value={data.id} /&gt;<br/>        &lt;button className="mx-auto mt-2 block w-1/2 rounded bg-blue-600 py-2 text-white hover:bg-blue-700"&gt;<br/>          Submit<br/>        &lt;/button&gt;<br/>      &lt;/Form&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="ffda" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让这段代码工作所需的唯一附加函数是<code class="fe nz oa ob ne b">deleteFormData</code>函数，我们将把它与其他Redis服务器代码放在一起。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="355b" class="ni mh iq ne b gy nj nk l nl nm">export const deleteFormData = async (id: string) =&gt; {<br/>  await client.connect();<br/>  await client.del(`f-${KEY_VERSION}-${id}`);<br/>  await client.quit();<br/>};</span></pre><h2 id="9e56" class="ni mh iq bd mi nn no dn mm np nq dp mq la nr ns ms le nt nu mu li nv nw mw nx bi translated">编辑功能</h2><p id="b4ad" class="pw-post-body-paragraph kr ks iq kt b ku my jr kw kx mz ju kz la na lc ld le nb lg lh li nc lk ll lm ij bi translated">让我们做一点重构，为之前创建的页面添加编辑功能。从表单索引页面开始，我们在每个区域都需要做一些修改。</p><p id="078f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，LoaderFunction将返回null或CustomFormData。</p><p id="5d74" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">其次，页面将通过useLoaderData函数接受该请求，并设置表单的默认值。它还必须在表单中设置一个ID。</p><p id="1298" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，action函数需要检查是否有ID，如果有，它将提取并更新数据，这样就不会清除其他页面中的数据。</p><p id="b415" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这部分是一个有些复杂的领域，但我认为这种权衡是值得的。简化这个逻辑还可以进一步探讨。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="253c" class="ni mh iq ne b gy nj nk l nl nm">// form/index.tsx<br/><br/>import type { ActionFunction, LoaderFunction } from "@remix-run/node";<br/>import { redirect } from "@remix-run/node";<br/>import { Form, useLoaderData } from "@remix-run/react";<br/>import { getDataFromRedis, saveToRedis } from "~/services/redis.server";<br/>import type { CustomFormData } from "~/types/form";<br/>import { generateCode } from "../utils/helpers.server";<br/><br/>export const action: ActionFunction = async ({ request }) =&gt; {<br/>  // Get the form data from the request.<br/>  const formData = await request.formData();<br/><br/>  // Get each form element<br/>  const name = formData.get("name");<br/>  const phone = formData.get("phone");<br/>  const email = formData.get("email");<br/><br/>  // Check if the form data is valid<br/>  if (<br/>    typeof name !== "string" ||<br/>    typeof phone !== "string" ||<br/>    typeof email !== "string"<br/>  ) {<br/>    throw Error("Form data is invalid"); // This error could be handled differently, but we will keep it for now<br/>  }<br/><br/>  // Check if there is already an ID<br/>  const formId = formData.get("id");<br/>  let id = "";<br/><br/>  // No need to generate a new code if you already have one<br/>  // Also, if you already have one a generate a new code, then you will lose the old data<br/>  if (typeof formId === "string" &amp;&amp; formId !== "") {<br/>    console.log(formId);<br/>    id = formId;<br/><br/>    const formDataObject = await getDataFromRedis(id);<br/><br/>    if (!formDataObject) {<br/>      throw Error("Form data is not found");<br/>    }<br/><br/>    formDataObject.name = name;<br/>    formDataObject.phone = phone;<br/>    formDataObject.email = email;<br/><br/>    await saveToRedis(formDataObject);<br/>  } else {<br/>    id = generateCode(6);<br/><br/>    // Create a new object of type CustomFormData<br/>    const formDataObject: CustomFormData = {<br/>      id,<br/>      name,<br/>      phone,<br/>      email,<br/>      // There are other optional fields that will be added in later<br/>    };<br/><br/>    // Save the form data to Redis with a helper in the services folder<br/>    await saveToRedis(formDataObject);<br/>  }<br/><br/>  return redirect(`/form/more?id=${id}`);<br/>};<br/><br/>export const loader: LoaderFunction = async ({ request }) =&gt; {<br/>  // This page could possibly not have an ID and that is okay since it is the first page<br/>  const url = new URL(request.url);<br/>  const id = url.searchParams.get("id");<br/><br/>  if (typeof id !== "string" || !id) {<br/>    return null;<br/>  }<br/><br/>  // Get cached form data from Redis<br/>  const formData = await getDataFromRedis(id);<br/><br/>  if (!formData) {<br/>    return null;<br/>  }<br/><br/>  return formData;<br/>};<br/><br/>export default function FormIndex() {<br/>  const data = useLoaderData&lt;CustomFormData | null&gt;();<br/><br/>  return (<br/>    &lt;div&gt;<br/>      &lt;h2 className="text-lg text-gray-600"&gt;Basic Info&lt;/h2&gt;<br/>      &lt;Form method="post"&gt;<br/>        &lt;input type="hidden" name="id" value={data?.id} /&gt;<br/>        &lt;label className="mb-1"&gt;<br/>          Name<br/>          &lt;input<br/>            type="text"<br/>            name="name"<br/>            placeholder="Name"<br/>            defaultValue={data?.name}<br/>            className="mb-2 w-full p-2 text-lg shadow-md"<br/>          /&gt;<br/>        &lt;/label&gt;<br/>        &lt;label className="mb-1"&gt;<br/>          Phone<br/>          &lt;input<br/>            type="tel"<br/>            name="phone"<br/>            placeholder="(123) 456-7890"<br/>            defaultValue={data?.phone}<br/>            className="mb-2 w-full p-2 text-lg shadow-md"<br/>          /&gt;<br/>        &lt;/label&gt;<br/>        &lt;label className="mb-1"&gt;<br/>          Email<br/>          &lt;input<br/>            type="email"<br/>            name="email"<br/>            defaultValue={data?.email}<br/>            placeholder="test@example.com"<br/>            className="mb-2 w-full p-2 text-lg shadow-md"<br/>          /&gt;<br/>        &lt;/label&gt;<br/>        &lt;button className="mx-auto mt-2 block w-1/2 rounded bg-blue-600 py-2 text-white hover:bg-blue-700"&gt;<br/>          Continue<br/>        &lt;/button&gt;<br/>      &lt;/Form&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="6b12" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">更多页面更简单，因为路由总是需要来自Redis的数据。只需要改变LoaderFunction传入整个formData对象，并且页面上的表单设置默认值。此外，我们将使用一个简单的函数来获取字符串化的日期并返回。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="b4a5" class="ni mh iq ne b gy nj nk l nl nm">// form/more.tsx<br/><br/>export const loader: LoaderFunction = async ({ request }) =&gt; {<br/>  // Function in redis.server.ts that is reusable for each page of the form<br/>  const formData = await requireFormData(request);<br/><br/>  return formData;<br/>};<br/><br/>export default function MoreForm() {<br/>  const formData = useLoaderData&lt;CustomFormData&gt;();<br/><br/>  return (<br/>    &lt;div&gt;<br/>      &lt;h2 className="text-lg text-gray-600"&gt;More Info&lt;/h2&gt;<br/>      &lt;Form method="post"&gt;<br/>        &lt;input type="hidden" name="id" value={formData.id} /&gt;<br/>        &lt;label className="mb-1"&gt;<br/>          Bio<br/>          &lt;input<br/>            type="text"<br/>            name="bio"<br/>            placeholder="Bio"<br/>            defaultValue={formData.bio}<br/>            className="mb-2 w-full p-2 text-lg shadow-md"<br/>          /&gt;<br/>        &lt;/label&gt;<br/>        &lt;label className="mb-1"&gt;<br/>          Birthday<br/>          &lt;input<br/>            type="date"<br/>            name="birthday"<br/>            defaultValue={String(formData.birthday).split("T")[0] || ""}<br/>            className="mb-2 w-full p-2 text-lg shadow-md"<br/>          /&gt;<br/>        &lt;/label&gt;<br/>        &lt;label className="mb-1"&gt;<br/>          Age<br/>          &lt;input<br/>            type="number"<br/>            name="age"<br/>            placeholder="0"<br/>            defaultValue={formData.age?.toString()}<br/>            className="mb-2 w-full p-2 text-lg shadow-md"<br/>          /&gt;<br/>        &lt;/label&gt;<br/>        &lt;button className="mx-auto mt-2 block w-1/2 rounded bg-blue-600 py-2 text-white hover:bg-blue-700"&gt;<br/>          Continue<br/>        &lt;/button&gt;<br/>      &lt;/Form&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="3865" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就像这样，我们在表单的每一页之间都有编辑功能！</p><h2 id="7b23" class="ni mh iq bd mi nn no dn mm np nq dp mq la nr ns ms le nt nu mu li nv nw mw nx bi translated">包扎</h2><p id="6c5a" class="pw-post-body-paragraph kr ks iq kt b ku my jr kw kx mz ju kz la na lc ld le nb lg lh li nc lk ll lm ij bi translated">虽然这看起来有点复杂，但是使用Remix和Redis的多页面表单的好处是惊人的。每条路由除了将数据保存到Redis之外，还可以执行其他任务。您可以进行支付处理、数据验证或更多工作。</p><p id="5c0f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我正在处理的一个用例中，表单的第一页使用Remix的useFetcher来确保获得有效的预订日期，然后接下来的页面只是收集更多的信息，直到付款被接受。它有助于区分不同的功能，同时还提供了良好的用户体验。</p><p id="c11f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在接下来的几天里，我将推出另一个指南，展示如何在Fly.io上部署这个应用程序和一个Redis实例，请密切关注。如果您有任何问题或建议，请告诉我！</p><p id="4ee2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="oc">更多内容请看</em><a class="ae ny" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="oc">plain English . io</em></strong></a><em class="oc">。报名参加我们的</em> <a class="ae ny" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="oc">免费周报</em> </strong> </a> <em class="oc">。关注我们关于</em><a class="ae ny" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="oc">Twitter</em></strong></a><em class="oc">和</em><a class="ae ny" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="oc">LinkedIn</em></strong></a><em class="oc">。加入我们的</em> <a class="ae ny" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="oc">社区不和谐</em> </strong> </a> <em class="oc">。</em></p></div></div>    
</body>
</html>