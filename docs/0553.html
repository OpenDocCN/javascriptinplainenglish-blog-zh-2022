<html>
<head>
<title>Track Your Friends On Google Maps With Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Angular在谷歌地图上追踪您的朋友</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/track-your-friends-on-google-map-with-angular-9e8dd9f17f1b?source=collection_archive---------8-----------------------#2022-01-31">https://javascript.plainenglish.io/track-your-friends-on-google-map-with-angular-9e8dd9f17f1b?source=collection_archive---------8-----------------------#2022-01-31</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><p id="eaa4" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><em class="km">使用谷歌的JavaScript map SDK在谷歌地图上显示朋友的地理位置，无需任何第三方包装库。</em></p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gi gj kn"><img src="../Images/9a545607705c931c3dcd286c5b15760f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SbbYTwPJxnHdW1CCqmDQMg.png"/></div></div></figure><p id="b8b1" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">Angular社区提供了几个谷歌地图和开放的街道地图包装器，其中一个来自Angular的内部团队。然而，在本文中，我将演示如何使用Google提供的原始库，即<a class="ae kz" href="https://developers.google.com/maps/documentation/javascript/examples" rel="noopener ugc nofollow" target="_blank"> Maps Javascript API </a>。所以，让我们开始吧！</p></div><div class="ab cl la lb hv lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ik il im in io"><h1 id="1964" class="lh li ir bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">假后端</h1><p id="bab7" class="pw-post-body-paragraph jo jp ir jq b jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh mj kj kk kl ik bi translated">为了获得朋友的地理位置，我们将利用一个使用Express构建的假后端。当然，如果你有一个合适的地理定位源，你可以在任何时候用你的真实数据切换后端。</p><h2 id="8d99" class="mk li ir bd lj ml mm dn ln mn mo dp lr jz mp mq lv kd mr ms lz kh mt mu md mv bi translated">后端:步骤1</h2><p id="ae41" class="pw-post-body-paragraph jo jp ir jq b jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh mj kj kk kl ik bi translated">初始化Express server项目。您可以简单地从<code class="fe mw mx my mz b">npm init -y</code>开始，它将创建节点项目。接下来，安装所需的依赖项:</p><pre class="ko kp kq kr gu na mz nb nc aw nd bi"><span id="007d" class="mk li ir mz b gz ne nf l ng nh">npm i express @ngneat/falso cors</span></pre><p id="8ea8" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">修改<code class="fe mw mx my mz b">package.json</code>的脚本部分。这个命令将启动我们的服务器。</p><pre class="ko kp kq kr gu na mz nb nc aw nd bi"><span id="3484" class="mk li ir mz b gz ne nf l ng nh">"scripts": {<br/>  "start": "node server.js"<br/>}</span></pre><h2 id="b2ab" class="mk li ir bd lj ml mm dn ln mn mo dp lr jz mp mq lv kd mr ms lz kh mt mu md mv bi translated">后端:步骤2</h2><p id="497f" class="pw-post-body-paragraph jo jp ir jq b jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh mj kj kk kl ik bi translated">现在在项目根目录下创建一个空的<code class="fe mw mx my mz b">server.js</code>文件，并编写逻辑来制作假数据:</p><figure class="ko kp kq kr gu ks"><div class="bz fq l di"><div class="ni nj l"/></div></figure><p id="0f6e" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">因为为了简单起见，我们不使用任何数据库，所以我们的后端生成一些<code class="fe mw mx my mz b">friend</code>对象，并将它们写入一个JSON文件。之后，一个区间函数遍历这些<code class="fe mw mx my mz b">friend</code>对象，每隔5秒稍微改变位置属性，以模拟朋友在地图上的移动。后端也有非常简单的搜索和分页功能。</p><p id="9a7b" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">为了测试API，使用<code class="fe mw mx my mz b">npm start</code>启动服务器，并使用浏览器或postman客户端向<code class="fe mw mx my mz b">http://localhost:3000/friends</code>发送请求。如果你收到如下的回复，那么一切都解决了！</p><pre class="ko kp kq kr gu na mz nb nc aw nd bi"><span id="688a" class="mk li ir mz b gz ne nf l ng nh">HTTP/1.1 200 OK<br/>X-Powered-By: Express<br/>Access-Control-Allow-Origin: *<br/>Content-Type: application/json; charset=utf-8<br/>Content-Length: 2192<br/>ETag: W/"890-/evxYHyMzivStHl52PNaAaZTmX4"<br/>Date: Sun, 30 Jan 2022 04:25:47 GMT<br/>Connection: close</span><span id="3a4a" class="mk li ir mz b gz nk nf l ng nh">[<br/>  {<br/>    "firstName": "Abdul",<br/>    "lastName": "Andreev",<br/>    "city": "West Lucy",<br/>    "phone": "+49(877)22 72",<br/>    "gender": "male",<br/>    "jobTitle": "Corporate Analyst",<br/>    "company": "Jenkins - Turcotte",<br/>    "location": {<br/>      "lat": 14.857,<br/>      "lng": -180.431<br/>    }<br/>  },<br/>// ... more entries <br/>]</span></pre></div><div class="ab cl la lb hv lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ik il im in io"><h1 id="fdc8" class="lh li ir bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">前端</h1><p id="40ea" class="pw-post-body-paragraph jo jp ir jq b jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh mj kj kk kl ik bi translated">既然我们的后端已经完成，让我们把重点放在前端。为此，我们使用Angular v13.2.0和TailwindCSS。我假设你对Angular有一些了解，所以我将跳过一些常见的任务，比如如何创建项目、组件、服务等等。如果你是Angular的新手，请事先遵循官方的入门指南。</p><h2 id="6321" class="mk li ir bd lj ml mm dn ln mn mo dp lr jz mp mq lv kd mr ms lz kh mt mu md mv bi translated">前端:步骤1(设置)</h2><p id="399d" class="pw-post-body-paragraph jo jp ir jq b jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh mj kj kk kl ik bi translated">使用您喜欢的方法生成角度项目；通常通过ng CLI命令<code class="fe mw mx my mz b">ng new &lt;project-name&gt;</code>。搭建完成后，安装更多必需的依赖项:</p><pre class="ko kp kq kr gu na mz nb nc aw nd bi"><span id="b20d" class="mk li ir mz b gz ne nf l ng nh">npm i <a class="ae kz" href="http://twitter.com/googlemaps/js-api-loader" rel="noopener ugc nofollow" target="_blank">@googlemaps/js-api-loader</a> <a class="ae kz" href="http://twitter.com/googlemaps/markerclusterer" rel="noopener ugc nofollow" target="_blank">@googlemaps/markerclusterer</a> tailwindcss</span></pre><p id="4f80" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">和开发依赖关系:</p><pre class="ko kp kq kr gu na mz nb nc aw nd bi"><span id="fb53" class="mk li ir mz b gz ne nf l ng nh">npm i -D <a class="ae kz" href="http://twitter.com/types/google" rel="noopener ugc nofollow" target="_blank">@types/google</a>.maps <a class="ae kz" href="http://twitter.com/types/supercluster" rel="noopener ugc nofollow" target="_blank">@types/supercluster</a></span></pre><p id="3c3b" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">为了消除一些编译错误，需要修改<code class="fe mw mx my mz b">tsconfig.ts</code> &amp; <code class="fe mw mx my mz b">tsconfig.app.ts</code>文件，如下所示:</p><pre class="ko kp kq kr gu na mz nb nc aw nd bi"><span id="a20a" class="mk li ir mz b gz ne nf l ng nh">// tsconfig.ts<br/>"compilerOptions": {<br/>  ...<br/>  "allowSyntheticDefaultImports": true<br/>}</span><span id="ca36" class="mk li ir mz b gz nk nf l ng nh">// tsconfig.app.ts<br/>"compilerOptions": {<br/>  ...<br/>  "types": ["google.maps"]<br/>}</span></pre><p id="571a" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">另外，在<a class="ae kz" href="https://tailwindcss.com/docs/guides/angular" rel="noopener ugc nofollow" target="_blank">正式文档</a>之后添加一个<code class="fe mw mx my mz b">tailwind.config.js</code>文件和tailwind指令到全局样式。</p><h2 id="758f" class="mk li ir bd lj ml mm dn ln mn mo dp lr jz mp mq lv kd mr ms lz kh mt mu md mv bi translated">前端:步骤2(模型和服务)</h2><p id="ba47" class="pw-post-body-paragraph jo jp ir jq b jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh mj kj kk kl ik bi translated">添加<code class="fe mw mx my mz b">Friend</code>接口。<em class="km">(提醒:我跳过了有棱角的建筑的东西，你可以随意构造)</em>。</p><pre class="ko kp kq kr gu na mz nb nc aw nd bi"><span id="a2b9" class="mk li ir mz b gz ne nf l ng nh">export interface <strong class="mz is">Friend</strong> {<br/>  firstName: string;<br/>  lastName: string;<br/>  city: string;<br/>  phone: string;<br/>  gender: 'male' | 'female';<br/>  jobTitle: string;<br/>  company: string;<br/>  location: { <br/>    lat: number; <br/>    lng: number <br/>  };<br/>}</span></pre><p id="8ba7" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">要从后端接收朋友对象，请创建一个API服务:</p><figure class="ko kp kq kr gu ks"><div class="bz fq l di"><div class="ni nj l"/></div></figure><h2 id="7b6d" class="mk li ir bd lj ml mm dn ln mn mo dp lr jz mp mq lv kd mr ms lz kh mt mu md mv bi translated">前端:步骤3(组件)</h2><p id="23d4" class="pw-post-body-paragraph jo jp ir jq b jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh mj kj kk kl ik bi translated">是时候创建页面组件了。我将自己限制在本文的范围之内，不打算深入讨论创建每个子组件的细节。从命名方案来看，这些应该是不言自明的。但是你可以从我附在文章末尾的<a class="ae kz" href="https://github.com/touhidrahman/friends-tracker" rel="noopener ugc nofollow" target="_blank"> Github库</a>中找到参考。</p><figure class="ko kp kq kr gu ks"><div class="bz fq l di"><div class="ni nj l"/></div></figure><p id="29f3" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">注意我们在控制器中使用了<code class="fe mw mx my mz b">BehaviorSubject</code>模式。这给了我们更多的灵活性和反应能力。</p><blockquote class="nl nm nn"><p id="be7d" class="jo jp km jq b jr js jt ju jv jw jx jy no ka kb kc np ke kf kg nq ki kj kk kl ik bi translated">在接下来的教程中，我将对此进行解释和补充👆模式，并将向您展示编写组件和状态的另一种方式，将您的角度应用提升到下一个级别。😉敬请期待！</p></blockquote><p id="43b3" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">当我们第一次加载组件时，我们检查是否有任何针对<code class="fe mw mx my mz b">{ search, page }</code>的查询参数。如果是，我们把它传递给各自的主体，这样状态就可以改变。您可以看到，<code class="fe mw mx my mz b">init()</code>方法中的流监视着<code class="fe mw mx my mz b">search</code> &amp; <code class="fe mw mx my mz b">page</code>主题，每当其中一个有新值时，它就切换映射以从API中检索朋友。</p><pre class="ko kp kq kr gu na mz nb nc aw nd bi"><span id="0a81" class="mk li ir mz b gz ne nf l ng nh">// simplified<br/>combineLatest({<br/>  search: this.search.asObservable(),<br/>  page:   this.page.asObservable(),<br/>}).pipe(<br/>  switchMap(({page, search}) =&gt; getFriends(page, search))<br/>).subscribe((friends) =&gt; this.friends.next(friends))</span></pre><p id="0a20" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">需要注意的重要事情是<code class="fe mw mx my mz b">poll()</code>方法。如果我们选择继续轮询(意味着——<code class="fe mw mx my mz b">polling</code>主题包含<code class="fe mw mx my mz b">true</code>值),那么end-stream返回一个RxJS <code class="fe mw mx my mz b">interval</code>流，每5秒钟滴答一次。如果我们不想轮询，它只是发送一个空流。</p><pre class="ko kp kq kr gu na mz nb nc aw nd bi"><span id="e21f" class="mk li ir mz b gz ne nf l ng nh">const interval$ = this.polling.asObservable()<br/>  .pipe(switchMap(<br/>    (isPolling) =&gt; isPolling ? interval(5000) : EMPTY<br/>  ));</span></pre><p id="9380" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">把这个流作为一个源，我们现在可以使用<code class="fe mw mx my mz b">switchMap</code>操作符不断地获取朋友:</p><pre class="ko kp kq kr gu na mz nb nc aw nd bi"><span id="2f5c" class="mk li ir mz b gz ne nf l ng nh">// simplified<br/>interval$.pipe(<br/>  switchMap(() =&gt;<br/>    this.api.getFriends(this.search.value, this.page.value)<br/>  )<br/>).subscribe((friends) =&gt; this.friends.next(friends));</span></pre><h2 id="be3c" class="mk li ir bd lj ml mm dn ln mn mo dp lr jz mp mq lv kd mr ms lz kh mt mu md mv bi translated">前端:步骤4(谷歌地图组件)</h2><p id="8bfb" class="pw-post-body-paragraph jo jp ir jq b jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh mj kj kk kl ik bi translated">卡片、搜索、导航条和跟踪状态组件都很简单，你可以从它们的名字中猜到。也可以在回购看一下<a class="ae kz" href="https://github.com/touhidrahman/friends-tracker" rel="noopener ugc nofollow" target="_blank">。然而，朋友地图组件是一个需要解释的组件。</a></p><figure class="ko kp kq kr gu ks"><div class="bz fq l di"><div class="ni nj l"/></div></figure><p id="26af" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我们需要一些构建模块来显示地图:</p><ul class=""><li id="794b" class="nr ns ir jq b jr js jv jw jz nt kd nu kh nv kl nw nx ny nz bi translated">来自<code class="fe mw mx my mz b">@googlemaps/js-api-loader</code>库的地图加载器功能。这个加载器函数需要<code class="fe mw mx my mz b">GoogleApiKey</code>来实例化。</li><li id="6ce2" class="nr ns ir jq b jr oa jv ob jz oc kd od kh oe kl nw nx ny nz bi translated">模板中的一个<code class="fe mw mx my mz b">div</code> HTML元素将被地图加载器提供的iframe替换。在控制器中，我们使用<code class="fe mw mx my mz b">document.getElementById('mapDivId').</code>来获取元素</li><li id="e5d1" class="nr ns ir jq b jr oa jv ob jz oc kd od kh oe kl nw nx ny nz bi translated">我们使用loader函数和<code class="fe mw mx my mz b">mapDivElement</code>创建的一个<code class="fe mw mx my mz b">google.maps.Map</code>对象实例。</li><li id="f15c" class="nr ns ir jq b jr oa jv ob jz oc kd od kh oe kl nw nx ny nz bi translated">包含对朋友标记的引用的数组。类型来自包<code class="fe mw mx my mz b">google.maps.Marker[]</code>。我们需要将每个标记指向<code class="fe mw mx my mz b">map</code>实例，以便它们实际上是可见的。是用<code class="fe mw mx my mz b">marker.setMap(map)</code>方法做的。如果没有设置地图，它们将保持不可见。</li><li id="fe7c" class="nr ns ir jq b jr oa jv ob jz oc kd od kh oe kl nw nx ny nz bi translated">从<code class="fe mw mx my mz b">@googlemaps/markerclusterer</code>包加载的MarkerClusterer类引用，当两个或更多的朋友在同一区域时显示分组标记。</li></ul><p id="b525" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">每当<code class="fe mw mx my mz b">friends</code>输入改变时，我们移除现有标记，清除标记聚类，并从新接收的朋友列表生成新的标记/聚类。</p><h1 id="adf6" class="lh li ir bd lj lk of lm ln lo og lq lr ls oh lu lv lw oi ly lz ma oj mc md me bi translated">运行应用程序</h1><p id="a8e8" class="pw-post-body-paragraph jo jp ir jq b jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh mj kj kk kl ik bi translated">使用<code class="fe mw mx my mz b">node server.js</code>命令启动后端服务器。在另一个CLI窗口中，用<code class="fe mw mx my mz b">ng serve</code>启动angular项目。前往网址为<code class="fe mw mx my mz b">http://localhost:4200</code>的浏览器，你会在下面看到一张地图和朋友列表。</p><figure class="ko kp kq kr gu ks"><div class="bz fq l di"><div class="ok nj l"/></div></figure><h1 id="b0f1" class="lh li ir bd lj lk of lm ln lo og lq lr ls oh lu lv lw oi ly lz ma oj mc md me bi translated">结论</h1><p id="adb5" class="pw-post-body-paragraph jo jp ir jq b jr mf jt ju jv mg jx jy jz mh kb kc kd mi kf kg kh mj kj kk kl ik bi translated">我希望您喜欢将典型的javascript库集成到angular应用程序中。请随时评论改进和您的意见。</p><p id="12a5" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">示例代码的Github存储库:</p><div class="ol om gq gs on oo"><a href="https://github.com/touhidrahman/friends-tracker" rel="noopener  ugc nofollow" target="_blank"><div class="op ab fp"><div class="oq ab or cl cj os"><h2 class="bd is gz z fq ot fs ft ou fv fx iq bi translated">GitHub-touhidrahman/朋友-跟踪器</h2><div class="ov l"><h3 class="bd b gz z fq ot fs ft ou fv fx dk translated">这个项目演示了在Angular应用程序中使用Google Maps Javascript API。</h3></div><div class="ow l"><p class="bd b dl z fq ot fs ft ou fv fx dk translated">github.com</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc kx oo"/></div></div></a></div><p id="6b0c" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><em class="km">更多内容看</em> <a class="ae kz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jq is"> <em class="km">说白了就是</em> </strong> </a> <em class="km">。报名参加我们的</em> <a class="ae kz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jq is"> <em class="km">免费周报</em> </strong> </a> <em class="km">。在我们的</em> <a class="ae kz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jq is"> <em class="km">社区不和谐</em> </strong> </a> <em class="km">获得独家获取写作机会和建议。</em></p></div></div>    
</body>
</html>