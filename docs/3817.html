<html>
<head>
<title>Build a Multi-step Form With React Hook Form</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React钩子子程构建多步窗体</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-a-multistep-form-with-react-hook-form-24f9398dc049?source=collection_archive---------1-----------------------#2022-09-29">https://javascript.plainenglish.io/build-a-multistep-form-with-react-hook-form-24f9398dc049?source=collection_archive---------1-----------------------#2022-09-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4321" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何使用React Hook Form构建多步窗体的教程。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/2faaa43b0d7af65b1af2cc5d8c9d5a0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*4bpCiFR9ZRyXfPE8N8G_uw.jpeg"/></div></figure><p id="1ab2" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">多步窗体也称为向导或漏斗窗体，用途广泛。当将不同类型的信息收集到一个数据结构中时，它们是最常见的，但是对于将非常大的表单分解成对用户来说不太可怕的多步骤过程也很有用。多步骤表单的一些最流行的例子是结帐和用户注册表单。</p><p id="6fad" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在这篇文章中，我们将构建一个基本的多步注册表单，它收集用户的信息，然后在确认视图中显示，在提交之前可以查看和编辑。需要注意的是，表单被大大简化了，在实际应用中可能会有更多的字段，但是，为了更容易理解，我们将保持它的简单性。此外，重点是JS部分，适当的表单样式超出了本教程的范围。最终的表单看起来是这样的(也有<a class="ae lj" href="https://codesandbox.io/s/hopeful-goldwasser-kmfb01" rel="noopener ugc nofollow" target="_blank"> CodeSandbox </a>可用):</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lk"><img src="../Images/a04e19a8fd888320ea4228b71cde3969.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SiQPI2wirQFV4PEX.png"/></div></div></figure><h1 id="ffbc" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">选择表单结构</h1><p id="6d98" class="pw-post-body-paragraph kn ko iq kp b kq mh jr ks kt mi ju kv kw mj ky kz la mk lc ld le ml lg lh li ij bi translated">使用多步表单时，最困难也是最重要的事情之一是决定它们的结构。最终的选择取决于项目需求和表单应该做什么。第一种选择通常是使用一个表单组件，在其中呈现一个活动步骤。在本教程中，我们将使用不同的方法——每个步骤组件将是一个单独的表单，从其字段中收集数据并在提交时将其发送到中央存储。通过这种方式，我们实现了关注点的良好分离，从而更容易适应未来的需求变化。对于表单逻辑，我们将使用<a class="ae lj" href="https://react-hook-form.com/" rel="noopener ugc nofollow" target="_blank"> React Hook Form </a>，这使得处理表单更加容易。对于中央存储，我们将使用<a class="ae lj" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank"> React context </a>，尽管对于更复杂的情况，单独的状态管理库(例如<a class="ae lj" href="https://github.com/reduxjs/redux" rel="noopener ugc nofollow" target="_blank"> Redux </a>)可能更合适。最后，每个表单步骤都有自己的路径，为此我们将使用<a class="ae lj" href="https://reactrouter.com/en/main" rel="noopener ugc nofollow" target="_blank"> React Router </a>。</p><p id="4fc8" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">总结一下，应用程序流程如下:</p><ul class=""><li id="c96c" class="mm mn iq kp b kq kr kt ku kw mo la mp le mq li mr ms mt mu bi translated">每个步骤都是一个单独的表单，有自己的处理程序和本地状态。</li><li id="2b12" class="mm mn iq kp b kq mv kt mw kw mx la my le mz li mr ms mt mu bi translated">按下<code class="fe na nb nc nd b">Next</code>将当前步骤的数据提交到集中存储，并重定向到下一步的路由。</li><li id="969b" class="mm mn iq kp b kq mv kt mw kw mx la my le mz li mr ms mt mu bi translated">在最后一步，所有的数据都会显示出来，用户可以在提交之前编辑任何步骤。</li></ul><h1 id="a941" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">安装</h1><p id="7646" class="pw-post-body-paragraph kn ko iq kp b kq mh jr ks kt mi ju kv kw mj ky kz la mk lc ld le ml lg lh li ij bi translated">如前所述，我们使用上下文来保持步骤之间的状态，稍后在提交之前在预览中显示表单数据。为了更容易使用，我们将上下文提供者和消费者抽象到一个单独的文件中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="c096" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这里我们创建一个<code class="fe na nb nc nd b">AppProvider</code>，它处理应用程序状态和相关逻辑，以及一个定制钩子<code class="fe na nb nc nd b">useAppState</code>。有了这个抽象，我们不需要将<code class="fe na nb nc nd b">AppStateContext</code>导入到每个组件中。此外，我们可以验证调用这个钩子的组件是在<code class="fe na nb nc nd b">AppProvider</code>内部使用的。</p><p id="42d3" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">接下来，我们将路线添加到应用程序中，并为表单步骤创建组件，将所有这些包装到<code class="fe na nb nc nd b">AppProvider</code>中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="67ef" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">之后，让我们为每一步设置组件。因为它们都是表单组件，所以每个组件的代码都非常相似。为了抽象一些重复的功能，我们创建了一个单独的<code class="fe na nb nc nd b">Field</code>组件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="f343" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">该组件还处理错误消息，并额外设置标签的<code class="fe na nb nc nd b">htmlFor</code>属性以匹配子输入的id，从而使输入可以正确访问。我们只需要确保输入有一个id。我们还将抽象出<code class="fe na nb nc nd b">Form</code>、<code class="fe na nb nc nd b">Input</code>和<code class="fe na nb nc nd b">Button</code>组件的逻辑，尽管它们只是应用了定制样式的原生HTML元素的包装器。</p><p id="f12c" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在我们可以开始为每一步创建实际的组件。他们故意简单，否则，很容易迷失在所有的细节和边缘案例中。该表格有4个步骤:</p><ol class=""><li id="169e" class="mm mn iq kp b kq kr kt ku kw mo la mp le mq li ng ms mt mu bi translated">联系人—获取基本用户信息—姓名、电子邮件和密码</li><li id="acdb" class="mm mn iq kp b kq mv kt mw kw mx la my le mz li ng ms mt mu bi translated">教育——假设我们的表单被用于某种教育或职业网站，我们想知道用户的教育详细信息。</li><li id="99fe" class="mm mn iq kp b kq mv kt mw kw mx la my le mz li ng ms mt mu bi translated">关于—带有自由文本字段的步骤，供用户提供关于他们自己的更详细信息。</li><li id="aee9" class="mm mn iq kp b kq mv kt mw kw mx la my le mz li ng ms mt mu bi translated">确认—此步骤不用于输入详细信息，而是用于预览和编辑(如有必要)。</li></ol><p id="243a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">此外，第一步中的所有字段都是必需的，并且有一个基本的验证，以显示在React Hook表单中通常是如何完成的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="ee7b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">React Hook Form在内部处理表单状态，所以我们需要做的就是在它被验证后将其保存到我们的应用程序状态。</p><p id="3530" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">最后一步Confirm略有不同，因为我们需要显示用户输入的数据。我们将添加几个section组件，然后组合它们来构建数据表示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="63c1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们可以更进一步进行抽象，将显示的数据收集到一个单独的结构中，然后对其进行迭代和呈现。然而，当我们得到新的需求时，代码变得如此枯燥可能会有问题，因为代码不够健壮来适应新的需求。要记住的一条重要规则是，干燥代码比不干燥代码要容易得多。</p><h1 id="bb4f" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">添加步骤指示器</h1><p id="1e0a" class="pw-post-body-paragraph kn ko iq kp b kq mh jr ks kt mi ju kv kw mj ky kz la mk lc ld le ml lg lh li ij bi translated">该表单虽然样式不多，但功能强大，我们可以通过填写所有细节并提交来确认这一点。目前的情况是，用户不清楚总共有多少步骤，以及他们目前在流程中的位置。这不是一个好的UX，它让多步式比实际情况更吓人。我们将通过添加一个步进指示器来解决这个问题。<code class="fe na nb nc nd b">Stepper</code>组件基本上是表单的导航，但是链接被禁用:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="27e5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在，我们可以将此组件添加到应用程序中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="e262" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">有了这个改变，我们就有了一个带进度指示器的完整的多步骤表单。</p><h1 id="e37d" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">改进的途径</h1><p id="2a58" class="pw-post-body-paragraph kn ko iq kp b kq mh jr ks kt mi ju kv kw mj ky kz la mk lc ld le ml lg lh li ij bi translated">本教程中的表单示例非常简单明了。这里可以做几个不同的改进，其中一些将在以后的教程中讨论。几个最明显的改进例子是:</p><ul class=""><li id="7d0c" class="mm mn iq kp b kq kr kt ku kw mo la mp le mq li mr ms mt mu bi translated">步骤指示器大大改进了UX，然而，一旦用户返回到一个步骤进行编辑，他们需要点击<code class="fe na nb nc nd b">Next</code>直到到达最后一步。这很烦人，尤其是在进行第一步的时候。为了帮助这一点，我们可以通过步进器启用导航。</li><li id="1f1d" class="mm mn iq kp b kq mv kt mw kw mx la my le mz li mr ms mt mu bi translated">如果我们通过步进器启用导航，我们还需要在通过步进器导航时保存表单状态，以确保不会绕过字段验证。</li><li id="988d" class="mm mn iq kp b kq mv kt mw kw mx la my le mz li mr ms mt mu bi translated">或者，我们可以对必需的表单字段禁用验证，并在stepper中显示每个步骤的状态(如果缺少任何必需的数据)。当我们允许将部分数据保存为草稿时，这很有帮助。</li><li id="19d4" class="mm mn iq kp b kq mv kt mw kw mx la my le mz li mr ms mt mu bi translated">目前，如果用户输入一些数据并决定离开表单，他们会丢失所有的进度。当这种导航被错误地完成时，这就成为一个问题。在这种情况下，我们可以添加一个提示，要求用户确认他们是否想要移动到另一个页面并丢失他们所有的进度。</li></ul><p id="0321" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">前两个改进及其实现将在<a class="ae lj" rel="noopener ugc nofollow" target="_blank" href="/build-a-multistep-form-with-react-hook-form-24f9398dc049">的下一篇文章</a>中讨论。</p><h1 id="43a4" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">测试表单</h1><p id="844a" class="pw-post-body-paragraph kn ko iq kp b kq mh jr ks kt mi ju kv kw mj ky kz la mk lc ld le ml lg lh li ij bi translated">尽管多步表单似乎比通常的单页表单更复杂，但是这里的测试方法是相同的。我的首选方法是用基本用户流分别测试每个步骤组件——填写字段，测试它们是否经过验证，并验证提交时发送了正确的数据。从用户的角度考虑测试会使它变得更容易。我以前写过关于表单测试的文章，其中大部分也适用于这里。</p></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><p id="dc8d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">【https://claritydev.net】最初发表于<a class="ae lj" href="https://claritydev.net/blog/build-a-multistep-form-with-react-hook-form/" rel="noopener ugc nofollow" target="_blank"><em class="no"/></a><em class="no">。</em></p></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><p id="fb18" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="no">更多内容看</em> <a class="ae lj" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kp ir"> <em class="no">说白了。报名参加我们的</em> <a class="ae lj" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kp ir"> <em class="no">免费周报</em> </strong> </a> <em class="no">。关注我们关于</em><a class="ae lj" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kp ir"><em class="no">Twitter</em></strong></a>，<a class="ae lj" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kp ir"><em class="no">LinkedIn</em></strong></a><em class="no">，</em><a class="ae lj" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kp ir"><em class="no">YouTube</em></strong></a><em class="no">，以及</em> <a class="ae lj" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kp ir"> <em class="no">不和</em> </strong> </a> <em class="no">。对增长黑客感兴趣？检查出</em> <a class="ae lj" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kp ir"> <em class="no">电路</em> </strong> </a> <em class="no">。</em></strong></a></p></div></div>    
</body>
</html>