<html>
<head>
<title>No More Confusion About TypeScript’s ‘any’ and ‘unknown’</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不再混淆TypeScript的“任何”和“未知”</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/no-more-confusion-about-typescripts-any-and-unknown-98c4b53f8924?source=collection_archive---------1-----------------------#2022-08-29">https://javascript.plainenglish.io/no-more-confusion-about-typescripts-any-and-unknown-98c4b53f8924?source=collection_archive---------1-----------------------#2022-08-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ac46" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">掌握任意类型和未知类型之间的异同，避免将TypeScript当成任意脚本来学习。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d6699a9592120ee378f45edaf163fc45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*evY9FgxDDYbPGcOm79ELEQ.jpeg"/></div></div></figure><p id="6f10" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">欢迎来到<strong class="kt ir">掌握打字稿</strong>系列。本系列将以动画的形式介绍TypeScript的核心知识和技术。让我们一起学习吧！以前的文章如下:</p><ul class=""><li id="1de8" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><a class="ae lw" href="https://medium.com/frontend-canteen/what-are-k-t-and-v-in-typescript-generics-9fabe1d0f0f3" rel="noopener"><strong class="kt ir">TypeScript泛型中的K、T、V是什么？</strong> </a></li><li id="456b" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated"><a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/using-typescript-mapped-types-like-a-pro-be10aef5511a"> <strong class="kt ir">使用TypeScript像Pro一样映射类型</strong> </a></li><li id="3b5a" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated"><a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/use-typescript-conditional-types-like-a-pro-7baea0ad05c5"> <strong class="kt ir">使用TypeScript条件类型像亲</strong> </a></li><li id="e841" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated"><a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/using-typescript-intersection-types-like-a-pro-a55da6a6a5f7"> <strong class="kt ir">使用TypeScript交集类型像亲</strong> </a></li><li id="6434" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated"><a class="ae lw" href="https://levelup.gitconnected.com/using-typescript-infer-like-a-pro-f30ab8ab41c7" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">使用打字稿推断像亲</strong> </a></li><li id="4d4a" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated"><a class="ae lw" href="https://medium.com/javascript-in-plain-english/how-to-use-typescript-template-literal-types-like-a-pro-2e02a7db0bac" rel="noopener"> <strong class="kt ir">使用TypeScript模板字面类型像亲</strong> </a></li><li id="f23a" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated"><a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/15-utility-types-that-every-typescript-developer-should-know-6cf121d4047c"> <strong class="kt ir">可视化打字稿:15种最常用的实用类型</strong> </a></li></ul><p id="6a97" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你刚开始TypeScript的时候，有没有遇到过很多你最终用<code class="fe mc md me mf b">any</code> trick解决的疯狂问题？如果你以后不花时间学习TypeScript的类型系统，你可能会发现你把<strong class="kt ir"> TypeScript </strong>学成了<strong class="kt ir"> AnyScript </strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mg"><img src="../Images/9f9c4697cde15cb498ecc90169a5c098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*DcuwwYCQM2E4ufeoVXjkmw.gif"/></div></div></figure><p id="7f4f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在TypeScript中，<code class="fe mc md me mf b">any</code>类型被称为顶级类型。所谓顶级类型，可以理解为泛型父类型，即可以包含所有值的类型。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d5e458bc5c4f19f86d93146b7c7eb77b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7EcOS41UYWEYCjnWiOzLKg.jpeg"/></div></div></figure><p id="9bbb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在TypeScript 3.0中，引入了一种新的顶级类型— <code class="fe mc md me mf b">unknown</code>类型。同样，您可以将任何值赋给未知类型的变量。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/35f6f43bd9ac1c75cd72b2e97e42bf2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xTOZH18ebzkkG76rUsetYQ.jpeg"/></div></div></figure><p id="6cdb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">那么现在问题来了，<code class="fe mc md me mf b">any</code>型和<code class="fe mc md me mf b">unknown</code>型有什么区别？任何类型都可以理解为我不在乎它的类型，未知类型可以理解为我不知道它的类型。</p><p id="3d39" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">事实上，任何类型本质上都是类型系统的一个出口，<strong class="kt ir"> TypeScript允许我们对任何类型的值执行任何操作，而无需执行任何类型的事先检查</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/318bdda56d10902a7e9275839a58c473.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ln_2Py-2XJlh0E1eK6CW4g.jpeg"/></div></div></figure><p id="f18a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这有什么问题？让我们举个例子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/dc8b31bb9ce99a69dac988c7999a08e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mynXeUYaUUQ5URy7iWsCYQ.jpeg"/></div></div></figure><p id="e85d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于上面的TypeScript代码，编译时不会提示错误，但运行时会抛出运行时错误。作为开发人员，<code class="fe mc md me mf b">any</code> type给了我们很多自由，但也带来了一些陷阱。为了解决<code class="fe mc md me mf b">any</code>类型的安全隐患，TypeScript团队在3.0中引入了<code class="fe mc md me mf b">unknown</code>类型，你可以理解为类型安全的<code class="fe mc md me mf b">any</code>类型。</p><p id="79c7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">那么未知类型在哪里体现了类型安全呢？这里我们将<code class="fe mc md me mf b">callWithErrorHandling</code>函数参数的类型改为<code class="fe mc md me mf b">unknown</code>类型，然后TypeScript编译器会提示相应的错误信息:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e03548ea35bdd685335b591e4ffcb57b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZaYmjq9pAdJPhw-aMngCpA.jpeg"/></div></div></figure><p id="182f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">与<code class="fe mc md me mf b">any</code>类型相比，TypeScript对类型<code class="fe mc md me mf b">unknown</code>的参数执行类型检查，以避免fn参数不是函数类型。为了解决上述问题，我们需要缩小fn参数的类型，也就是说，我们可以使用<code class="fe mc md me mf b">typeof</code>运算符来确保fn参数是一个函数类型的对象:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b72ac03615f36355dfb0d009c0db5a08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*obNVZoiyI2RcnAxT62A-UA.jpeg"/></div></div></figure><p id="8118" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">实际上，您还可以通过instanceof或用户定义的类型保护来缩小参数的类型:</p><pre class="kg kh ki kj gt mh mf mi mj aw mk bi"><span id="ff50" class="ml mm iq mf b gy mn mo l mp mq">declare function isFunction(x: unknown): x is Function;<br/>​<br/>function fn(x: unknown) {<br/>    if (x instanceof Error) {<br/>        x;  // Error<br/>    }<br/>    if (isFunction(x)) {<br/>        x;  // Function<br/>    }<br/>}</span></pre><p id="5883" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">与<code class="fe mc md me mf b">any</code>类型不同，因为TypeScript对<code class="fe mc md me mf b">unknown</code>类型的变量进行类型检查，所以当我们将前面代码中value变量的类型改为<code class="fe mc md me mf b">unknown</code>类型时，所有使用value变量的语句都将失败。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b3a7e123e3e66d4620e898931ae45682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gati-wKYiFwg1cjtHqCSzg.jpeg"/></div></div></figure><p id="adba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">另外，需要注意的是<strong class="kt ir">未知类型的变量只能赋给任意类型和未知类型本身</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e00124217d534b5a724ebaee69be01ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bA6B_03TnD4wF-aqWE9_QA.jpeg"/></div></div></figure><p id="83f8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们已经在以前的文章中介绍了运算符的<a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/master-the-typescript-keyof-type-operator-bf7f18865a8b">键和</a><a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/using-typescript-mapped-types-like-a-pro-be10aef5511a">映射类型</a>。<code class="fe mc md me mf b">any</code>型和<code class="fe mc md me mf b">unknown</code>型在这些情况下表现不同:</p><pre class="kg kh ki kj gt mh mf mi mj aw mk bi"><span id="6a79" class="ml mm iq mf b gy mn mo l mp mq">type A0 = keyof any;  // string | number | symbol<br/>type U1 = keyof unknown;  // never<br/>​<br/>type M2&lt;T&gt; = { [P in keyof T]: number };<br/>type M21 = M2&lt;any&gt;;  // { [x: string]: number }<br/>type M22 = M2&lt;unknown&gt;;  // {}</span></pre><p id="5b52" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在上面的代码中，<strong class="kt ir"> M2 </strong>类型被称为映射类型。在映射过程中，如果key类型是<code class="fe mc md me mf b">never</code>类型，则当前key会被过滤掉，所以M <strong class="kt ir"> 22 </strong>类型是空对象类型。</p><p id="0c11" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在工作中，为了保证类型安全，我们应该尽量使用<code class="fe mc md me mf b">unknown</code>类型。最后，让我们看看不同类型的<code class="fe mc md me mf b">unknown</code>类型上的类型操作的结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fd881417965243f0749669832054ccef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nW_1EVhAhdjUa9DodReGlA.jpeg"/></div></div></figure><p id="f29e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mc md me mf b">any</code>型比较特殊。当这个类型被构造或与任何类型组合时，将返回<code class="fe mc md me mf b">any</code>类型。看完这篇文章，相信你已经明白了<code class="fe mc md me mf b">any</code>型和<code class="fe mc md me mf b">unknown</code>型的区别。<br/>知道怎么检测<code class="fe mc md me mf b">any</code>型和<code class="fe mc md me mf b">unknown</code>型吗？如果你知道，可以在评论区提交你的答案。</p><p id="7f19" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你想学习TypeScript，那么就不要错过<strong class="kt ir">掌握TypeScript </strong>系列。在<a class="ae lw" href="https://medium.com/@bytefer" rel="noopener"> Medium </a>或<a class="ae lw" href="https://twitter.com/Tbytefer" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我，阅读更多关于TS和JS的内容！</p><h1 id="69ab" class="mr mm iq bd ms mt mu mv mw mx my mz na jw nb jx nc jz nd ka ne kc nf kd ng nh bi translated"><strong class="ak">资源</strong></h1><div class="ni nj gp gr nk"><div role="button" tabindex="0" class="ab bv gv cb fp nl nm bn nn kp ex"><div class="no l"><div class="ab q"><div class="l di"><img alt="Bytefer" class="l de bw np nq fe" src="../Images/238cf2afd3c689b50719951ba2fd880d.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*krjVh9VFhDEcMUif4Ewt-A.png"/><div class="fb bw l np nq fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@bytefer?source=post_page-----98c4b53f8924--------------------------------" rel="noopener follow" target="_top">字节优先</a></p></div></div><div class="nt nu gw l"><h2 class="bd ir tx ln fp ty fr fs os fu fw ip bi translated">掌握打字稿系列</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi tz au ua ub uc qj ud an eh ei ue uf ug el em eo de bk ep" href="https://medium.com/@bytefer/list/mastering-typescript-series-688ee7c12807?source=post_page-----98c4b53f8924--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="uh l fo"><span class="bd b dl z dk">47 stories</span></div></div></div><div class="og dh oh fp ab oi fo di"><div class="di ny bv nz oa"><div class="dh l"><img alt="" class="dh" src="../Images/8fba4cad7ae795f6abed5234e33e0356.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*l87u8lL_MzD5n4z_"/></div></div><div class="di ny bv ob oc od"><div class="dh l"><img alt="" class="dh" src="../Images/373c978fed504a3c38f0fdb5b617fedb.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*94uN4q2Of_fg3WaQ"/></div></div><div class="di bv oe of od"><div class="dh l"><img alt="" class="dh" src="../Images/a8ea3e3ecad1c2d2697107f3ce466e42.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*tGza_iE2o--HjQwD"/></div></div></div></div></div><div class="ni nj gp gr nk om"><a href="https://github.com/Microsoft/TypeScript/pull/24439" rel="noopener  ugc nofollow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd ir gy z fp or fr fs os fu fw ip bi translated">ahejlsberg Pull请求的新“未知”顶级类型#24439 microsoft/TypeScript</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">这个PR添加了一个新的顶级类型unknown，它是any的类型安全对应类型。任何事情都可以分配给未知，但是…</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">github.com</p></div></div><div class="ov l"><div class="ow l ox oy oz ov pa kp om"/></div></div></a></div></div><div class="ab cl pb pc hu pd" role="separator"><span class="pe bw bk pf pg ph"/><span class="pe bw bk pf pg ph"/><span class="pe bw bk pf pg"/></div><div class="ij ik il im in"><p id="81ab" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="pi">更多内容看</em> <a class="ae lw" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="pi">说白了就是</em> </strong> </a> <em class="pi">。报名参加我们的</em> <a class="ae lw" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="pi">免费每周简讯</em> </strong> </a> <em class="pi">。关注我们</em> <a class="ae lw" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="pi">推特</em> </strong> </a>，<a class="ae lw" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="pi">LinkedIn</em></strong></a><em class="pi">，</em><a class="ae lw" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="pi">YouTube</em></strong></a><em class="pi">，</em> <a class="ae lw" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="pi">不和</em> </strong> </a> <em class="pi">。</em></p></div></div>    
</body>
</html>