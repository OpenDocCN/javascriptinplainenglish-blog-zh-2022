<html>
<head>
<title>Make AJAX Requests with the Fetch API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Fetch API发出AJAX请求</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/make-ajax-requests-with-the-fetch-api-9c8add20ba64?source=collection_archive---------7-----------------------#2022-04-18">https://javascript.plainenglish.io/make-ajax-requests-with-the-fetch-api-9c8add20ba64?source=collection_archive---------7-----------------------#2022-04-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f5aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大多数web应用程序、应用程序和网站都是基于一些协会提供的API和服务，或者是为特定目的而开发的。这些服务非常有用，如果没有它们，大多数资源都不会存在。</p><p id="66b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，在本文中，我们将探索如何通过Fetch API调用所有API，这样您就可以检索您需要放在网站上的所有信息。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/09db9552347bec887b341fff4c2d7dda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wnPD1CvlZ66vuiboOr7rqA.jpeg"/></div></div></figure><h1 id="c477" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">介绍</h1><p id="aa02" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">首先你要知道用Fetch做调用和通过<code class="fe ma mb mc md b">jQuery.ajax()</code>做调用是不一样的，即使结果是一样的。</p><p id="eee3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不同之处在于:</p><ul class=""><li id="0bcb" class="me mf iq jp b jq jr ju jv jy mg kc mh kg mi kk mj mk ml mm bi translated">使用Fetch API，返回的承诺不会被拒绝，即使有类似404的响应代码。它的工作方式是一样的，在状态中添加OK或false。</li><li id="8b47" class="me mf iq jp b jq mn ju mo jy mp kc mq kg mr kk mj mk ml mm bi translated">如果没有明确请求，Fetch不会发送跨来源cookies。</li></ul><p id="9cbf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于它如何工作的一般概述，我们可以说Fetch使用HTTP协议，因此它处理请求和响应。如果您需要更多关于HTTP的信息，请阅读这篇文章:</p><div class="ms mt gp gr mu mv"><a rel="noopener  ugc nofollow" target="_blank" href="/http-protocol-everything-you-need-to-know-d313b5544c93"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd ir gy z fp na fr fs nb fu fw ip bi translated">HTTP协议:您需要知道的一切</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">如果你曾经在浏览器上搜索过网页，你肯定至少曾经使用过这种特殊的协议…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj kv mv"/></div></div></a></div><p id="ac88" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">了解协议的所有细节并不是强制性的，但这很有用。尤其是涉及到状态码的时候。</p><p id="f018" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Fetch是一个异步函数，它返回一个承诺，该承诺被解析为对您之前设置的请求的响应。</p><h1 id="58f3" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">接口</h1><p id="0fc4" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">此API有一些接口，如下所示:</p><pre class="km kn ko kp gt nk md nl nm aw nn bi"><span id="712e" class="no ky iq md b gy np nq l nr ns">fetch()<br/>Headers<br/>Request<br/>Response</span></pre><p id="60d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Fetch是用来获取资源的方法，我们将在后面看到。在HTTP协议中，头是响应/请求的头。请求包含请求信息和响应信息。</p><h1 id="9ca7" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">和睦相处</h1><p id="e8a7" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">Fetch API与几乎所有现代浏览器都兼容。只有IE浏览器不能正常处理这个API，但是现在IE几乎已经消失了。</p><p id="3f94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，如果你需要调用一个API，这是最好的选择，也是根据可用的设备和浏览器。</p><h1 id="17a3" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">如何发出GET请求</h1><p id="dea0" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">现在，我们可以深入了解如何使用fetch API从互联网和全球各地的服务中检索信息。HTTP的第一个方法将是最著名和最常用的:GET方法。</p><p id="2411" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据动态数据库的发展，当有人想要接收数据以显示在UI中时，就使用GET。</p><p id="39cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Fetch API中，GET是默认方法，因此这是最简单的操作。您只需要指定到API端点的链接。</p><p id="01da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个代码示例，用于执行对随机API URL的调用，您可以根据自己的脚本进行调整:</p><pre class="km kn ko kp gt nk md nl nm aw nn bi"><span id="1b81" class="no ky iq md b gy np nq l nr ns">fetch('http://www.apiwebsiterandom/getinformations')<br/>    .then(response =&gt; response.json())<br/>    .then(data =&gt; console.log(data)</span></pre><p id="d3cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个例子中，它调用一个随机的API(这是假的)到一个给定的路由。它创建一个异步工作的承诺，并在解析后返回一个字符串。</p><p id="796a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此时，您创建了一个新的承诺，它将字符串异步转换为JSON。JSON是获取API使用的基本格式，但是它是可以改变的。</p><p id="3de3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，结果是您可以使用对象作为响应来动态生成您的数据。</p><h1 id="9089" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">如何提出发布请求</h1><p id="36ab" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">第二个最重要的方法是POST，它允许用户将信息放入API，最终放入数据库。</p><p id="a930" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个特殊的方法，因为你可以添加一个主体来放置几乎对所有人都隐藏的所有信息。</p><p id="0494" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这不是API的默认方法，所以我们必须在函数体中指定它。</p><p id="f9fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以在这个函数中设置很多值，稍后我们会看到。现在，我们将只看到方法和主体。它们允许我们设置使用什么HTTP方法，以及主体的内容。</p><p id="7fb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是POST请求的语法:</p><pre class="km kn ko kp gt nk md nl nm aw nn bi"><span id="d4fa" class="no ky iq md b gy np nq l nr ns">fetch('http://www.apiwebsiterandom/postnews', {</span><span id="c50f" class="no ky iq md b gy nt nq l nr ns">     method: 'POST',</span><span id="b5a9" class="no ky iq md b gy nt nq l nr ns">     headers: {</span><span id="f75b" class="no ky iq md b gy nt nq l nr ns">          'Accept': 'application/json',</span><span id="d807" class="no ky iq md b gy nt nq l nr ns">          'Content-Type': 'application/json'</span><span id="0d5b" class="no ky iq md b gy nt nq l nr ns">     },</span><span id="69c1" class="no ky iq md b gy nt nq l nr ns">     body: JSON.stringify({ </span><span id="32a2" class="no ky iq md b gy nt nq l nr ns">          username: username,</span><span id="260e" class="no ky iq md b gy nt nq l nr ns">          password: password})</span><span id="27fb" class="no ky iq md b gy nt nq l nr ns">})<br/>    .then(response =&gt; response.json())<br/>    .then(data =&gt; console.log(data)</span></pre><p id="5700" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，还使用了heather方法，它表示JSON是默认的响应格式。</p><p id="23a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为一种方法，我们使用POST，但是你可以使用所有大写的HTTP方法。在正文中，您需要放入一个字符串化的JSON，其中包含您想要发送的最终数据。</p><h1 id="7956" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">发出普遍呼吁</h1><p id="560f" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">也许你想对API进行一般性调用。这里有一个方案，几乎所有的东西，你可以修改和个性化，并附有简要说明。</p><p id="bc73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了这个方案，您将能够以最好的方式管理对API的所有调用。</p><pre class="km kn ko kp gt nk md nl nm aw nn bi"><span id="5745" class="no ky iq md b gy np nq l nr ns">fetch(url, {<br/>    method: 'POST', // GET, POST, PUT, DELETE, HEADER .....<br/>    mode: 'cors', // no-cors, *cors, same-origin<br/>    cache: 'no-cache', // *default, no-cache, reload,... for cached information on the call<br/>    credentials: 'same-origin', // include, *same-origin, omit<br/>    headers: {<br/>      'Content-Type': 'application/json' // type of content <br/>    },<br/>    redirect: 'follow', // manual, *follow, error... if you need a redirection <br/>    referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin... reffers to the policy <br/>    body: JSON.stringify(data) // same type of headers one<br/>})<br/>    <!-- -->.then(response =&gt; response.json())<br/>    .then(data =&gt; console.log(data)</span></pre><p id="32d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您只需要定制这些信息，就可以调用每一个可能的API并检索您正在搜索的有用数据。</p><h1 id="f50b" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论和正式文件</h1><p id="b02c" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">通过这篇文章，您已经掌握了关于Fetch API的所有最重要的信息。您的站点或应用程序现在可以拥有它需要的动态数据。</p><p id="e333" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您需要更深入的文档，请查看以下链接中的文档:</p><div class="ms mt gp gr mu mv"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd ir gy z fp na fr fs nb fu fw ip bi translated">使用获取API-Web API | MDN</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">Fetch API提供了一个JavaScript接口，用于访问和操作HTTP管道的各个部分，例如…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">developer.mozilla.org</p></div></div><div class="ne l"><div class="nu l ng nh ni ne nj kv mv"/></div></div></a></div><p id="ed00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nv">更多内容请看</em><a class="ae nw" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="nv">plain English . io</em></strong></a><em class="nv">。报名参加我们的</em> <a class="ae nw" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="nv">免费周报</em> </strong> </a> <em class="nv">。关注我们关于</em><a class="ae nw" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="nv">Twitter</em></strong></a><em class="nv">和</em><a class="ae nw" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="nv">LinkedIn</em></strong></a><em class="nv">。加入我们的</em> <a class="ae nw" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="nv">社区不和谐</em> </strong> </a> <em class="nv">。</em></p></div></div>    
</body>
</html>