<html>
<head>
<title>Registration and Activation with Node.js &amp; Google OAuth 2.0 Playground</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js和Google OAuth 2.0 Playground的注册和激活</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/registration-and-activation-with-node-js-google-oauth-2-0-playground-3d734b33736d?source=collection_archive---------11-----------------------#2022-05-25">https://javascript.plainenglish.io/registration-and-activation-with-node-js-google-oauth-2-0-playground-3d734b33736d?source=collection_archive---------11-----------------------#2022-05-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="01e8" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">关于用Node.js、Express和TypeScript创建的后端应用程序的身份验证部分的教程。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/80ee8b40ce794817d58f861be2e3d089.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WutAOg3FmqTzieJxefXJiQ.png"/></div></div></figure><p id="be49" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">今天我想告诉你用Node.js、Express和TypeScript创建的后端应用程序的认证部分。我用PostgreSQL做数据库，用prismaOrm管理数据库。</p><p id="caa5" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我跳过了安装部分，现在开始主要部分。但是如果你想用TypeScript和Prisma实例化你的应用程序，你需要安装心爱的包。</p><p id="e23a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="lk"> typescript，ts-node，express，nodemailer，google-auth-library，@prisma/client，prisma，pg，jsonwebtoken，bcrypt，@types/jsonwebtoken，@types/node，@ types/node mailler @ types/express，@typesbcrypy。</em></p><p id="b204" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">安装完软件包后，我们需要启动Prisma。你可以在这里找到更多关于如何启动Prisma的信息，在<a class="ae ll" href="https://www.prisma.io/docs/getting-started/setup-prisma/start-from-scratch/relational-databases-typescript-postgres" rel="noopener ugc nofollow" target="_blank"> Prisma网站</a>。</p><p id="dbed" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe lm ln lo lp b">npx prisma &amp;&amp; npx prisma init</code></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lq"><img src="../Images/d0a69cd9bf635e7123ae9351ace4e60f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WrS52r5CbpHLw32kE8F40Q.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">My Prisma Schema</figcaption></figure><p id="5399" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在首先让我们在JWT的帮助下创建激活令牌。我们需要一个激活令牌来检查用户的信息，以完成用户的注册。JSON Web Token代替我们处理这个问题。首先，我们需要用sign方法创建一个令牌。它通常接受一个对象，该对象包含我们要签名的信息、要签名的私钥和过期时间。创建令牌后，我们将借助JWT验证方法，用我们的私钥验证该令牌。您需要将您的私钥保存到。环境文件。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lv"><img src="../Images/ba553118fa57f8f84fdfcb1c55266be6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w020-4mh8mNdExwgGIHvCQ.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">generating Activation token</figcaption></figure><p id="2bf4" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在让我们编写邮件发送函数，这样我们就可以在注册后向用户发送一封激活邮件。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lw"><img src="../Images/f89645e9fca6d8fae28e4b185a931e51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*03xyV4j46SCNRHZf13qhng.png"/></div></div></figure><p id="49b3" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在编写函数之前，我们需要导入nodeMailer和OAuth2Client。我们将从谷歌控制台获取凭据。首先，进入<a class="ae ll" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌控制台</a>。然后，如果你还没有一个应用程序<a class="ae ll" href="https://console.cloud.google.com/projectcreate?previousPage=%2Fapis%2Fcredentials%2Foauthclient%2F547727143953-kf47baif2ufmfr3iuk6rcjqdnr3l5vsu.apps.googleusercontent.com%3Fproject%3Dsouresachen&amp;organizationId=0" rel="noopener ugc nofollow" target="_blank">，创建你的第一个应用程序。</a>你可以在图片的右边部分看到下图中的凭证。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lx"><img src="../Images/1ba5458444b5f3527a75324533461fae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*twnXpP9xjpeRJ_o9nihzng.png"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ly"><img src="../Images/59134397071643ad5fc30145905dfd0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X2u7CPco5b6jOV-l_y8OVA.png"/></div></div></figure><p id="e528" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在你去谷歌认证之前。请确保您已经将<a class="ae ll" href="https://developers.google.com/oauthplayground/" rel="noopener ugc nofollow" target="_blank">开发者的Google </a>链接添加到您的应用程序中。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lz"><img src="../Images/e4fcc98cb22afcea7fcb3dd043bac01f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mei7wPSasYfOhI6SVAY0lA.png"/></div></div></figure><p id="d8b4" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在我们来看看<a class="ae ll" href="https://developers.google.com/oauthplayground/" rel="noopener ugc nofollow" target="_blank">谷歌开发者</a>。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ma"><img src="../Images/6a215fab24e089010224767a2ec5b403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BmyN_HOHEbZxd9p6ex2t7Q.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Type your own user credentials from google consele</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mb"><img src="../Images/08ec3890c829ff920c4f8922158efba0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QuWBe9T6oMhhfMR89wxO2Q.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Please write the <a class="ae ll" href="http://mail.google.com" rel="noopener ugc nofollow" target="_blank">http://mail.google.com</a> and authorize APIs</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mc"><img src="../Images/37c5558873fbb2de669be7d2a474f866.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e2MyZ0eeZaP4S8EvOSM5Ug.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Press Excange auth code for tokens and Take your refresh token from here</figcaption></figure><p id="f742" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在，将您的用户凭证和刷新令牌保存到。在发送邮件函数中使用的env文件。请查看下面GitHub链接中详细介绍的功能:</p><div class="md me gp gr mf mg"><a href="https://github.com/emrekrt1655/soureSachen/blob/main/config/sendMail.ts" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd io gy z fp ml fr fs mm fu fw im bi translated">soures achen/sendmail . ts at main em rekrt 1655/soures achen</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">此文件包含双向Unicode文本，其解释或编译可能与下面显示的不同…</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">github.com</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu km mg"/></div></div></a></div><p id="766a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在我们可以编写注册处理程序了。首先，我们需要检查我们的数据库给定的电子邮件是否存在。如果退出，我们需要返回一个消息，否则我们可以继续。然后，我们需要从用户那里获取所需的信息，如用户名、电子邮件和密码。我们需要加密给定的密码，因为将密码直接保存到数据库是不安全的。然后我们需要用给定的信息创建一个用户，这样我们就可以创建一个激活令牌。有了这个激活令牌，我们需要创建一个URL，这样我们就可以发送请求来激活电子邮件。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/ac9a550ffc132d58ceb216e4506dc006.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*CeMkJev8E2gZG_e_Uj6YtQ.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Valid Email function</figcaption></figure><p id="e04a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">然后我们可以检查给定的电子邮件是否有效。如果有效，我们可以调用sendMail函数并给出电子邮件、URL和消息参数。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/1ba316f510f9ac77a411fb2db3ab8640.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*IoNK-Q4QWzcqC3pQi7FJwQ.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Register handler</figcaption></figure><p id="70f6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了激活，我们需要req.body中的active_token，然后我们需要在。env文件，使用JWT的验证方法。在检查时，我们创建一个类似decoded的新对象，这样我们就可以从这个对象中拉出用户。然后，我们可以使用prismaOrm create方法保存用户，并向用户发送消息。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/d90f7240cda2710c59c01148d169fd76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*V0IofFzrk26N3D6n5ZxxVw.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Active account handler</figcaption></figure><p id="0998" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">您可以通过下面的链接查看详细的代码:</p><div class="md me gp gr mf mg"><a href="https://github.com/emrekrt1655/soureSachen/blob/main/controllers/authCtrl.ts" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd io gy z fp ml fr fs mm fu fw im bi translated">soures achen/auth ctrl . ts at main em rekrt 1655/soures achen</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">此文件包含双向Unicode文本，其解释或编译可能与下面显示的不同…</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">github.com</p></div></div><div class="mp l"><div class="mx l mr ms mt mp mu km mg"/></div></div></a></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi my"><img src="../Images/9ddeeaf6b3fda0ae30fbff1ac04678f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*GJIvV4OPQg_N1jlEu3YFkA.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">the routes for registering and activating account</figcaption></figure><p id="c5b3" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在注册请求之后，注册处理程序返回一个激活令牌。您在注册处理程序中看到上面的一个URL，(const URL = ` ＄{ CLIENT _ URL }/active/＄{ active token } `；)当我们向api/active/token_active发送请求时，我们将激活电子邮件。</p><p id="bd7d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">您可以从下面的GitHub链接调用身份验证部分:</p><div class="md me gp gr mf mg"><a href="https://github.com/emrekrt1655/soureSachen" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd io gy z fp ml fr fs mm fu fw im bi translated">GitHub - emrekrt1655/soureSachen</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">github.com</p></div></div><div class="mp l"><div class="mz l mr ms mt mp mu km mg"/></div></div></a></div><p id="6562" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="lk">更多内容请看</em><a class="ae ll" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="lk">plain English . io</em></strong></a><em class="lk">。报名参加我们的</em> <a class="ae ll" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lk">免费周报</em> </strong> </a> <em class="lk">。关注我们关于</em><a class="ae ll" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="lk">Twitter</em></strong></a><em class="lk">和</em><a class="ae ll" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="lk">LinkedIn</em></strong></a><em class="lk">。查看我们的</em> <a class="ae ll" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lk">社区不和谐</em> </strong> </a> <em class="lk">加入我们的</em> <a class="ae ll" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lk">人才集体</em> </strong> </a> <em class="lk">。</em></p></div></div>    
</body>
</html>