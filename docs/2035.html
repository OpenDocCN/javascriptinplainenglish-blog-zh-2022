<html>
<head>
<title>Custom Directives in Vue 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue 3中的自定义指令</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/custom-directives-in-vue-3-8ca51e7ba9d7?source=collection_archive---------4-----------------------#2022-05-09">https://javascript.plainenglish.io/custom-directives-in-vue-3-8ca51e7ba9d7?source=collection_archive---------4-----------------------#2022-05-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="9c1c" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">自定义Vue.js指令世界简介</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/2f728ca4a9422189dbf2af5e88d6b780.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qlDQzZ4gq-mgQ_9M"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@cdr6934?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Chris Ried</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4c5e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">与React相比，我真正喜欢Vue.js的一个不同之处是能够创建自己的自定义指令。另外，我能够在应用程序级别或组件范围内注册它们。</p><p id="4123" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lp">*注:如果你对Vue.js生命周期挂钩有基本的了解就好了</em></p><p id="e80b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">这些指令是什么？</strong> <br/>简单来说，它们是Vue.js提供的自定义标记，在附加到DOM元素时以某种方式做事情。该标记看起来更像HMTL属性，但以“v-”为前缀。<br/>有的是<em class="lp"> v-if，v-else，v-show，v-for，还有</em> <a class="ae ks" href="https://vuejs.org/api/built-in-directives.html" rel="noopener ugc nofollow" target="_blank"> <em class="lp">更有</em> </a> <em class="lp">。</em></p><h2 id="1924" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">创建我们自己的自定义指令</h2><p id="4797" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">它们是如何工作的？<br/> 在定义中，指令就是指令，我们可以使用生命周期挂钩来定义它们。传递给这些挂钩的参数可用于操作元素和添加所需的功能。<br/>我们不能访问所有的挂钩，但是那些覆盖用例的挂钩，如官方<a class="ae ks" href="https://vuejs.org/guide/reusability/custom-directives.html#directive-hooks" rel="noopener ugc nofollow" target="_blank">文档</a>中所定义的:</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="b589" class="lq lr in mp b gy mt mu l mv mw">const myDirective = {<br/>  <em class="lp">// called before bound element's attributes<br/>  // or event listeners are applied</em><br/>  created(el, binding, vnode, prevVnode) {<br/>    <em class="lp">// see below for details on arguments</em><br/>  },<br/>  <em class="lp">// called right before the element is inserted into the DOM.</em><br/>  beforeMount() {},<br/>  <em class="lp">// called when the bound element's parent component</em><br/>  <em class="lp">// and all its children are mounted.</em><br/>  mounted() {},<br/>  <em class="lp">// called before the parent component is updated</em><br/>  beforeUpdate() {},<br/>  <em class="lp">// called after the parent component and</em><br/>  <em class="lp">// all of its children have updated</em><br/>  updated() {},<br/>  <em class="lp">// called before the parent component is unmounted</em><br/>  beforeUnmount() {},<br/>  <em class="lp">// called when the parent component is unmounted</em><br/>  unmounted() {}<br/>}</span></pre><p id="a22b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们将使用的主要论据是:</p><ol class=""><li id="4426" class="mx my in kv b kw kx kz la lc mz lg na lk nb lo nc nd ne nf bi translated">el :添加指令的元素。</li><li id="3df4" class="mx my in kv b kw ng kz nh lc ni lg nj lk nk lo nc nd ne nf bi translated"><strong class="kv io"> binding </strong>:包含<em class="lp"> value </em>(赋值给指令)、<em class="lp"> oldValue </em>(仅在<strong class="kv io"> <em class="lp"> beforeUpdate </em> </strong>和<strong class="kv io"> <em class="lp"> Updated </em> </strong> hook)、<em class="lp"> arg、</em>或随指令传递的参数(v-dir:arg-name)的对象。还有更多，但我们不会关注他们。请检查<a class="ae ks" href="https://vuejs.org/guide/reusability/custom-directives.html#hook-arguments" rel="noopener ugc nofollow" target="_blank">正式文件</a>。</li><li id="d13b" class="mx my in kv b kw ng kz nh lc ni lg nj lk nk lo nc nd ne nf bi translated"><strong class="kv io"> vNode </strong>:代表绑定元素的底层vNode。</li><li id="edef" class="mx my in kv b kw ng kz nh lc ni lg nj lk nk lo nc nd ne nf bi translated"><strong class="kv io"> prevNode </strong>:表示上一次渲染绑定元素的vNode(仅在<strong class="kv io"> <em class="lp">更新前</em> </strong>和<strong class="kv io"> <em class="lp">更新后</em> </strong>钩子中可用)。</li></ol></div><div class="ab cl nl nm hr nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ig ih ii ij ik"><p id="c45d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在我们知道了它们是如何工作的，让我们构建两个来更好地理解它们。<br/>仅供参考，对于组件范围的指令，我们在<em class="lp">脚本设置</em>和<em class="lp"> SFC </em>中创建指令的方式是不同的。</p><h2 id="ea41" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">垂直聚焦</h2><p id="1599" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">这是一个基本的指令(组件范围的)，它提供了一个基本的用例，当一个元素挂载到DOM时，它关注于这个元素。</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="b440" class="lq lr in mp b gy mt mu l mv mw">&lt;template&gt;<br/> &lt;span&gt; input &lt;/span&gt;<br/> &lt;input v-focus v-model="value" /&gt;<br/>&lt;/template&gt;<br/>&lt;script &gt;<br/>import { ref } from "vue";</span><span id="0ce3" class="lq lr in mp b gy ns mu l mv mw">export default {<br/> setup() {<br/>  const value = ref("");<br/>  return { value };<br/> },<br/> directives: {<br/>  focus: {<br/>   mounted: (el) =&gt; {<br/>   // initiate focus for the element <br/>   el.focus();<br/>  },<br/> },<br/>}};<br/>&lt;/script&gt;</span><span id="42ac" class="lq lr in mp b gy ns mu l mv mw">&lt;---------setup script---------&gt;<br/>&lt;script setup&gt;<br/>import { ref } from "vue";</span><span id="269d" class="lq lr in mp b gy ns mu l mv mw">const value = ref("");<br/>const vFocus = {<br/>  mounted: (el) =&gt; el.focus()<br/>}<br/>&lt;/script&gt;<br/>&lt;template&gt;<br/>  &lt;input v-focus /&gt;<br/>&lt;/template&gt;</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/820d3542811a745fbe74caedbd83c60a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*JZsdboN9jmZuIP4vrNAFwg.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">focus on mounted</figcaption></figure><h2 id="2dfb" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated"><strong class="ak">V-禁用</strong></h2><p id="4888" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">让我们创建一个稍微复杂一点的例子。指令的预期行为是:</p><ul class=""><li id="78f8" class="mx my in kv b kw kx kz la lc mz lg na lk nb lo nu nd ne nf bi translated">首先，应该在全球一级对其进行定义。</li><li id="7850" class="mx my in kv b kw ng kz nh lc ni lg nj lk nk lo nu nd ne nf bi translated">其次，如果v-disable为true，则元素的disabled属性应该设置为true。</li><li id="bd89" class="mx my in kv b kw ng kz nh lc ni lg nj lk nk lo nu nd ne nf bi translated">第三，根据传递的参数(字符串或数字)执行检查，如果发现条件为真，则禁用该元素。</li></ul><p id="cdb9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">步骤1，向应用实例添加指令定义，并添加您认为有帮助的挂钩:</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="e09a" class="lq lr in mp b gy mt mu l mv mw">const app = createApp(App);</span><span id="3b7a" class="lq lr in mp b gy ns mu l mv mw"><strong class="mp io">app</strong>.directive("<strong class="mp io">disable</strong>", {<br/>// to check if v-disabled is set to true from start<br/>mounted(el, bindings){},<br/>// to check argument value<br/>updated(el,bindings)<br/>});</span></pre><p id="33f9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在让我们将定义添加到挂钩中:</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="2700" class="lq lr in mp b gy mt mu l mv mw">app.directive("disable", {<br/> mounted(el, bindings) {<br/>  const { value } = bindings;<br/>  if (value === true) el.disabled = true;<br/> },<br/> updated(el, bindings) {<br/> const { arg } = bindings;<br/> switch (arg) {<br/>  case "string":<br/>   if (el.value.length &gt; 6) el.disabled = true;<br/>   break;<br/>  case "number":<br/>   if (bindings.value &gt; 6) el.disabled = true;<br/>   break;<br/>  default:<br/>   break;<br/> }<br/>}});</span></pre><p id="3083" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">使用模板中的指令:</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="e40c" class="lq lr in mp b gy mt mu l mv mw">&lt;input v-disable="true" v-model="value" /&gt;<br/>&lt;input v-disable:string v-model="value" /&gt;<br/>&lt;-- binding the variable to custom directive--&gt;<br/>&lt;input type="number" v-disable:number="num" v-model="num" /&gt;</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nv"><img src="../Images/b10610297303d18c8939b03ec302129d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1aIG4IzoI6YMUBsMBh1Biw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">output</figcaption></figure></div><div class="ab cl nl nm hr nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ig ih ii ij ik"><p id="45a2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">自定义指令为我们提供了一种新的方式来模块化我们的代码，并在应用程序范围内创建可重用的逻辑，帮助我们减少导入并编写更干净的代码。我希望这能让您更好地理解自定义指令是如何工作的，以及如何在您的工作流程中使用它们。</p><p id="dca0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你可以在这里找到例子<a class="ae ks" href="https://codesandbox.io/s/vue3-custom-directives-h19zec?file=/src/App.vue:70-222" rel="noopener ugc nofollow" target="_blank">的代码。</a></p><p id="fa55" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lp">更多内容尽在</em> <a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lp">说白了. io </em> </strong> </a> <em class="lp">。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lp">免费周报</em> </strong> </a> <em class="lp">。关注我们关于</em> <a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lp">推特</em> </strong> </a> <em class="lp">和</em><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="lp">LinkedIn</em></strong></a><em class="lp">。加入我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lp">社区</em> </strong> </a> <em class="lp">。</em></p></div></div>    
</body>
</html>