<html>
<head>
<title>Transform and Validate Query Parameters in NestJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在NestJS中转换和验证查询参数</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/validate-and-transform-query-in-nestjs-4d04465fb004?source=collection_archive---------1-----------------------#2022-03-10">https://javascript.plainenglish.io/validate-and-transform-query-in-nestjs-4d04465fb004?source=collection_archive---------1-----------------------#2022-03-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2822" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">分步指南:如何转换和验证查询参数</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5d9e1cbdeb85442989e1698f085b7d63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZZUHaFbT5oo2DDx37b9dVg.png"/></div></div></figure><p id="ada9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在今天的文章中，我想向您展示如何在NestJS中转换和验证HTTP请求查询参数。您可能知道，查询参数是网站URL的一部分，所以这意味着它总是一个字符串。</p><p id="e7c6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在NestJS和ExpressJS中，它是一个包含字符串作为值的对象。但有时，我们希望将这些字符串类型转换为其他类型，如数字、日期，或者将它们转换为一个经过修整的字符串，等等。我想你明白了。在本分步指南中，我想告诉您我们将如何对此进行归档。</p><p id="4a59" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们用它的CLI初始化一个新的NestJS项目。这可能需要一分钟。CLI脚本将询问您想要使用哪个软件包管理器。对于这个例子，我选择NPM。</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="dc50" class="ls lt iq lo b gy lu lv l lw lx">$ nest new nest-transform-query -p npm</span></pre><p id="0698" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">完成该命令后，您可以在代码编辑器中打开您的项目。由于我使用Visual Studio代码，我将通过键入以下命令打开项目:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="a54b" class="ls lt iq lo b gy lu lv l lw lx">$ cd nest-transform-query<br/>$ code .</span></pre><p id="3373" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我的项目在VSCode (Visual Studio代码)中是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ly"><img src="../Images/f96aff05eafe39477d226bcbe1b6c733.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lg4-E8cPGAkXcyEC74zqXQ.png"/></div></div></figure><p id="5898" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通常，我会提交初始安装，所以我会键入:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="3939" class="ls lt iq lo b gy lu lv l lw lx">$ git add .<br/>$ git commit -m "chore(): init nest.js"</span></pre><p id="9f25" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们安装一些我们需要的依赖项。</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="a8d0" class="ls lt iq lo b gy lu lv l lw lx">$ npm i class-validator class-transformer class-sanitizer</span></pre><p id="63bb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，让我们开始编码。为了有一个干净的项目结构，我们将创建一些文件夹和文件，不要担心，我们保持简单。</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="fc09" class="ls lt iq lo b gy lu lv l lw lx">$ mkdir src/common &amp;&amp; mkdir src/common/helper<br/>$ touch src/common/helper/cast.helper.ts<br/>$ touch src/app.dto.ts</span></pre><p id="8fe1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们的项目树应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lz"><img src="../Images/3dd93df1f169bb2e78420b4b7d4daedc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U0xZQ9_IO7oOWomUlw8GOQ.png"/></div></div></figure><h2 id="1619" class="ls lt iq bd ma mb mc dn md me mf dp mg la mh mi mj le mk ml mm li mn mo mp mq bi translated">助手</h2><p id="78e7" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">现在是时候开始编码了。首先，我们需要在我们的<code class="fe mw mx my lo b">src/common/helper/cast.helper.ts</code>文件中创建一些助手函数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk">src/common/helper/cast.helper.ts</figcaption></figure><p id="98d2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如你所见，除了<code class="fe mw mx my lo b">toNumber</code>，大多数都非常简化。如您所见，您甚至可以创建复杂的帮助函数来处理某些参数。</p><h2 id="ee9e" class="ls lt iq bd ma mb mc dn md me mf dp mg la mh mi mj le mk ml mm li mn mo mp mq bi translated">确认</h2><p id="8730" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">现在，让我们创建DTO(数据传输对象)来验证我们的查询。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk">src/app.dto.ts</figcaption></figure><h2 id="d57d" class="ls lt iq bd ma mb mc dn md me mf dp mg la mh mi mj le mk ml mm li mn mo mp mq bi translated">控制器</h2><p id="b10b" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">我们差不多完成了，只剩下两步了。让我们将DTO类添加到文件<code class="fe mw mx my lo b">src/app.controller.ts</code>的端点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk">src/app.controller.ts</figcaption></figure><h2 id="978d" class="ls lt iq bd ma mb mc dn md me mf dp mg la mh mi mj le mk ml mm li mn mo mp mq bi translated">配置</h2><p id="8d65" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">最后但同样重要的是，我们需要添加一个全局管道来转换传入的请求数据，比如查询、主体和参数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk">main.ts</figcaption></figure><ul class=""><li id="83ff" class="nf ng iq kt b ku kv kx ky la nh le ni li nj lm nk nl nm nn bi translated"><code class="fe mw mx my lo b">whitelist</code> —删除不属于DTO的查询、主体和参数的任何属性</li><li id="32b9" class="nf ng iq kt b ku no kx np la nq le nr li ns lm nk nl nm nn bi translated"><code class="fe mw mx my lo b">transform</code> —支持我们传入请求的转换</li></ul><h2 id="15da" class="ls lt iq bd ma mb mc dn md me mf dp mg la mh mi mj le mk ml mm li mn mo mp mq bi translated">测试</h2><p id="7087" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">我们完了！很简单，对吧？现在让我们运行我们的NestJS应用程序。</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="a6fc" class="ls lt iq lo b gy lu lv l lw lx">$ npm run start:dev</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/d5479051305ccc38e0edcae1e1050495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vr319k7wbJu7-zQTL7Fe9w.png"/></div></div></figure><p id="b9e6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们的应用程序运行在端口3000上，所以让我们访问:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="6a33" class="ls lt iq lo b gy lu lv l lw lx"><a class="ae nu" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a> </span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/d8cc54899f9622837dbfc1a14b40194b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xpo-2jGGpN2gB9fYCAImTQ.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk"><a class="ae nu" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></figcaption></figure><p id="452c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">看起来不错吧？在我们的DTO类中，我们向页面和foo属性添加了默认值。但到目前为止，我们没有改变任何东西。</p><p id="ce3e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们来看看:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="f56c" class="ls lt iq lo b gy lu lv l lw lx"><a class="ae nu" href="http://localhost:3000/?page=-1&amp;foo=1&amp;bar=%20bar&amp;elon=Elon&amp;musk=50&amp;date=2022-01-01T12:00:00" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/?page=-1&amp;foo=1&amp;bar=%20bar&amp;elon=Elon&amp;musk=50&amp;date=2022-01-01T12:00:00</a></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/4f86fe137de3673a4861ab532cca2e33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_kJzKpAlEX_sefY4U8pCCg.png"/></div></div></figure><p id="759b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">正如你所看到的，每一个属性都在以某种方式同时被转换和验证。</p><p id="90fc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就是这样！感谢您阅读我关于如何在NestJS中转换和验证查询参数的简短指南。我希望，你能学到新的东西。</p><p id="d7dd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我已经在<a class="ae nu" href="https://github.com/hellokvn/nestjs-transform-query-medium" rel="noopener ugc nofollow" target="_blank"> Github </a>上传了这个项目。看看这个。</p><p id="d1d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">干杯</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="322f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我希望你喜欢读这篇文章。如果你愿意支持我成为一名作家，可以考虑注册<a class="ae nu" href="https://medium.com/@hellokevinvogel/membership" rel="noopener">成为</a>的媒体成员。每月只需5美元，你就可以无限制地使用Medium。</p><p id="b68b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">想支持我？<a class="ae nu" href="https://www.buymeacoffee.com/hellokevinvogel" rel="noopener ugc nofollow" target="_blank">给我买杯咖啡。</a></p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="c80f" class="od lt iq bd ma oe of og md oh oi oj mg jw ok jx mj jz ol ka mm kc om kd mp on bi translated">了解更多关于NestJS的信息</h1><div class="oo op gp gr oq or"><a href="https://betterprogramming.pub/nest-js-project-with-typeorm-and-postgres-ce6b5afac3be" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">用TypeORM和Postgres构建一个NestJS应用程序(2022)</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">使用Nest.js &amp; TypeORM创建可扩展的应用程序</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">better编程. pub</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf kp or"/></div></div></a></div><div class="oo op gp gr oq or"><a href="https://blog.bitsrc.io/how-to-update-nest-js-ecd0e9466165" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">如何更新NestJS (2022)</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">如何用您需要安装的两个包更新NestJS？</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">blog.bitsrc.io</p></div></div><div class="pa l"><div class="pg l pc pd pe pa pf kp or"/></div></div></a></div><div class="oo op gp gr oq or"><a rel="noopener  ugc nofollow" target="_blank" href="/a-simple-way-to-use-path-aliases-in-nestjs-ab0db1be1545"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">在NestJS中使用路径别名的简单方法</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">使用NestJS的路径别名(2022)</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="pa l"><div class="ph l pc pd pe pa pf kp or"/></div></div></a></div><p id="b4e7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="pi">更多内容看</em> <a class="ae nu" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="pi">说白了就是io </em> </strong> </a> <em class="pi">。报名参加我们的</em> <a class="ae nu" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="pi">免费周报</em> </strong> </a> <em class="pi">。关注我们关于</em><a class="ae nu" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="pi">Twitter</em></strong></a><em class="pi">和</em><a class="ae nu" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="pi">LinkedIn</em></strong></a><em class="pi">。加入我们的</em> <a class="ae nu" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="pi">社区</em> </strong> </a> <em class="pi">。</em></p></div></div>    
</body>
</html>