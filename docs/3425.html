<html>
<head>
<title>The Hidden Danger of user?.name?.first</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用户的隐患？。名字？。第一</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-hidden-danger-of-user-name-first-15ca00ba85cb?source=collection_archive---------4-----------------------#2022-08-26">https://javascript.plainenglish.io/the-hidden-danger-of-user-name-first-15ca00ba85cb?source=collection_archive---------4-----------------------#2022-08-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/68240be73752f6dcb2d88bb17ae655d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*otvfUypNcEHK8LPu"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@ksudu94?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kyle Sudu</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c7e0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是关于3.7版中引入的TypeScript特性:</p><p id="85da" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://devblogs.microsoft.com/typescript/announcing-typescript-3-7-beta/" rel="noopener ugc nofollow" target="_blank">https://dev blogs . Microsoft . com/typescript/announcing-typescript-3-7-beta/</a>:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="47ab" class="lh li in ld b gy lj lk l ll lm">let x = foo?.bar.baz();</span></pre><p id="f295" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在过去，当<code class="fe ln lo lp ld b">foo</code>不是包含<code class="fe ln lo lp ld b">bar</code>的有效对象时，我们需要添加一些额外的代码来保护逻辑，因为否则，我们根本无法将<code class="fe ln lo lp ld b">foo</code>与<code class="fe ln lo lp ld b">undefined</code>或<code class="fe ln lo lp ld b">null</code>赋值。能够在空对象和填充对象之间切换对我们来说非常有用。举个例子，</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="b093" class="lh li in ld b gy lj lk l ll lm">let user = undefined;<br/>setTimeout(() =&gt; {<br/>  user = { name: "Fang" }<br/>}, 5000);</span><span id="8ef6" class="lh li in ld b gy lq lk l ll lm">// Could be problematic depends on <br/>// when you invoke the following<br/>user.name</span></pre><p id="bce1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们需要在用户5秒钟后登录时填充用户，上面的测试代码很好地展示了这一点。如果没有新的可选链接，我们将需要显式添加一个<code class="fe ln lo lp ld b">if</code>语句:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="b69f" class="lh li in ld b gy lj lk l ll lm">if (user) { <br/>  // access user properties<br/>}</span></pre><p id="fdb7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用可选的链接，您可以避免编写<code class="fe ln lo lp ld b">if</code>语句，或者至少隐藏该语句，稍后您将会看到:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="241b" class="lh li in ld b gy lj lk l ll lm">const name = user?.name</span></pre><h2 id="1c7e" class="lh li in bd ls lt lu dn lv lw lx dp ly kl lz ma mb kp mc md me kt mf mg mh mi bi translated">惊人的功能？</h2><p id="5eb9" class="pw-post-body-paragraph ka kb in kc b kd mj kf kg kh mk kj kk kl ml kn ko kp mm kr ks kt mn kv kw kx ig bi translated">任何节省开发人员时间的特性都是令人惊奇的特性，只要它能节省您的时间。因此，让我们看看该行做了什么，根据文档，它直接翻译为:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="bddf" class="lh li in ld b gy lj lk l ll lm">const name = (user === null || user === undefined) ? <br/>      undefined : <br/>      user.name</span></pre><p id="897d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">令人惊奇的是，比较有和没有可选链接的版本，我们将投票支持新语法。谁他妈的想一直写<code class="fe ln lo lp ld b">user === undefined</code>？</p><p id="cec3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在开发人员发现这个新功能非常容易使用，他们开始为之疯狂。他们指责我们使用了<code class="fe ln lo lp ld b">&amp;&amp;</code>，但他们倾向于写下如下内容:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="321d" class="lh li in ld b gy lj lk l ll lm">const firstName = user?.name?.firstName;</span></pre><p id="ac58" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面的行基本上转化为下面的函数:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="208d" class="lh li in ld b gy lj lk l ll lm">function getFirstName(user) {<br/>  if (!user) return undefined<br/>  if (!user.name) return undefined<br/>  return user.name.firstName<br/>}</span></pre><p id="7ad7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">哇，这不是很酷吗？你可能会说，“是的，这么少的代码做了这么多。”太神奇了，如果所有的编码都可以这样做，我们都可以退休了。</p><h2 id="ce92" class="lh li in bd ls lt lu dn lv lw lx dp ly kl lz ma mb kp mc md me kt mf mg mh mi bi translated">怎么了?</h2><p id="ce93" class="pw-post-body-paragraph ka kb in kc b kd mj kf kg kh mk kj kk kl ml kn ko kp mm kr ks kt mn kv kw kx ig bi translated">当然，我听起来不同意大众的观点。上面简单的代码会出什么问题呢？问题是你用<code class="fe ln lo lp ld b">user?.name?.</code>代替了两个<code class="fe ln lo lp ld b">if</code>语句。如果只有一个<code class="fe ln lo lp ld b">if</code>语句，我们就会确切地知道是哪个<code class="fe ln lo lp ld b">if</code>做出了返回<code class="fe ln lo lp ld b">undefined</code>的决定。但是有了两个<code class="fe ln lo lp ld b">if</code>，我们就不能再那样做了。但是你为什么想知道是哪个<code class="fe ln lo lp ld b">if</code>做的决定？这是一个价值百万的问题。</p><p id="1345" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">也许这里使用可选链接的假设是，<strong class="kc io">你不应该想知道哪个</strong> <code class="fe ln lo lp ld b"><strong class="kc io">if</strong></code> <strong class="kc io">或者哪个空对象最后给了你空对象。不管出于什么原因，你想知道，你应该避免使用可选的链接。让我们来看一个例子，看看为什么:</strong></p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="cb90" class="lh li in ld b gy lj lk l ll lm">function Logo(user) {<br/>  if (!user?.human) return 'Alien'</span><span id="e7b9" class="lh li in ld b gy lq lk l ll lm">  return user?.name?.first<br/>}</span></pre><p id="4f26" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好的，你必须想象在我的代码深处我有一个组件<code class="fe ln lo lp ld b">Logo</code>，它使用<code class="fe ln lo lp ld b">user</code>对象，当然通常这个对象会作为<em class="lr">全局</em>类对象传递到这个组件中，但是为了这个对话，我们将把<code class="fe ln lo lp ld b">user</code>直接传递给它。</p><p id="57f8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ln lo lp ld b">user?.human</code>的用法与<code class="fe ln lo lp ld b">user?.name?.first</code>类似，因为我们想将<code class="fe ln lo lp ld b">human</code>作为一个布尔值来做其他事情，例如返回一个<code class="fe ln lo lp ld b">Alien</code>字符串。因此，在<code class="fe ln lo lp ld b">user</code>对象之后有两个条件分支，<code class="fe ln lo lp ld b">human</code>和<code class="fe ln lo lp ld b">name</code>。在<code class="fe ln lo lp ld b">name</code>之后，我们还有<code class="fe ln lo lp ld b">first</code>。因此，如果你显式地编写上述组件，你可以说我们至少有四个<code class="fe ln lo lp ld b">if</code>语句。好了，这个组件有什么问题？</p><p id="b445" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们必须假设<code class="fe ln lo lp ld b">user</code>对象总是可用的。什么？我认为使用可选链接是为了避免知道这一点。例如，<code class="fe ln lo lp ld b">user?.name?.</code>是总是获取<code class="fe ln lo lp ld b">name</code>的完美用法(如果可用的话)。</p><p id="77d7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">是的，这是教科书上的原因。但事实并非如此，因为由于使用了上述语句中的<code class="fe ln lo lp ld b">user?.human</code>,您仍然面临着空的和填充的两种选择。但是为什么另一个语句会破坏这种用法的语法呢？</p><p id="b689" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们运行它，如果<code class="fe ln lo lp ld b">user</code>不可用，<code class="fe ln lo lp ld b">user?.human</code>就是<code class="fe ln lo lp ld b">undefined</code>，因此它将返回<code class="fe ln lo lp ld b">Alien</code>。是的，如果不是用户，他可以是一个<code class="fe ln lo lp ld b">Alien</code>对不对？当然可以！问题不在于你是否幸运，而是你是否打算在那里做出这样的逻辑？你确定你不是在那里检查<code class="fe ln lo lp ld b">user.human</code>(没有<code class="fe ln lo lp ld b">?.</code>)吗？是吗？我的头在旋转，你有任何意义吗？</p><p id="b785" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你有信心故意写下这句话，是的，我会让你通过。但如果没有，你的未来就注定了。问题是在写的时候你没有区分出<code class="fe ln lo lp ld b">!user</code>和<code class="fe ln lo lp ld b">!user.human</code>之间的区别。空用户和<code class="fe ln lo lp ld b">human</code>设置为<code class="fe ln lo lp ld b">false</code>的有效用户之间肯定有一些区别。你没发现问题吗？</p><p id="e12e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我觉得我没必要太深入这个困境。因为我真的不认为这是值得解决的，因为几乎没有什么比意识到正确的陈述更能让你变得正确！你只需要确定你写的是你想要的，就这样。</p><p id="361d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我想说的是，太多的<strong class="kc io">(<em class="lr">)隐藏的</em></strong><code class="fe ln lo lp ld b"><strong class="kc io">if</strong></code><strong class="kc io">语句对你没有帮助，除非隐藏的版本在语义上100%可翻译成精确的人类逻辑</strong>。否则多一个隐藏的<code class="fe ln lo lp ld b">if</code>只会让你的开发预算多一个零。</p><h1 id="25c7" class="mo li in bd ls mp mq mr lv ms mt mu ly mv mw mx mb my mz na me nb nc nd mh ne bi translated">摘要</h1><p id="cf81" class="pw-post-body-paragraph ka kb in kc b kd mj kf kg kh mk kj kk kl ml kn ko kp mm kr ks kt mn kv kw kx ig bi translated">作为开发者工具，发明就是发明。不应该气馁。然而对于一个被锁住的隐藏<code class="fe ln lo lp ld b">if</code>，我采取不同的态度。在函数式语言中，一个简化的隐藏的<code class="fe ln lo lp ld b">if</code>不应该达到一个<code class="fe ln lo lp ld b">Maybe</code>对象的高度。坚持那样做只会成为失败的圣经。因为<code class="fe ln lo lp ld b">if</code>的数字，只会在你的代码深处的深层状态中，最后爆炸到任何人类都无法领悟的地步。</p><h2 id="1312" class="lh li in bd ls lt lu dn lv lw lx dp ly kl lz ma mb kp mc md me kt mf mg mh mi bi translated">注意</h2><p id="de38" class="pw-post-body-paragraph ka kb in kc b kd mj kf kg kh mk kj kk kl ml kn ko kp mm kr ks kt mn kv kw kx ig bi translated">您可能想知道编写上述代码的正确方法是什么:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="a4e7" class="lh li in ld b gy lj lk l ll lm">function Logo(user) { <br/>  if (!user) return 'N/A'</span><span id="a5d6" class="lh li in ld b gy lq lk l ll lm">  if (!user.human) return 'Alien'</span><span id="06f5" class="lh li in ld b gy lq lk l ll lm">  return user.name.first<br/>}</span></pre><p id="2c73" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面的修正是有争议的，但是我采用了一个<em class="lr">极端的</em>方法，用一个显式的<code class="fe ln lo lp ld b">if</code>语句替换所有的<code class="fe ln lo lp ld b">?.</code>。你可能会称之为老学校，但这是防弹的，它在任何情况下都做我想做的事情。</p><p id="b89a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当然，如果还没有解决，<code class="fe ln lo lp ld b">user</code>可能不会出现在这个组件中，因此这将消除第一个<code class="fe ln lo lp ld b">if</code>。是的，那会更正确。由于这需要一些架构上的改变，我将不再讨论它。</p><h2 id="49f0" class="lh li in bd ls lt lu dn lv lw lx dp ly kl lz ma mb kp mc md me kt mf mg mh mi bi translated">注2</h2><p id="e732" class="pw-post-body-paragraph ka kb in kc b kd mj kf kg kh mk kj kk kl ml kn ko kp mm kr ks kt mn kv kw kx ig bi translated">在这一点上，我有点确信可选链接的重要性堪比<code class="fe ln lo lp ld b">&amp;&amp;</code>。我会随便用它作为一个技巧来回避局部的问题，而不是依赖它作为一个架构目的的全局策略。</p><p id="e7e6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="lr">更多内容请看</em><a class="ae jz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="lr">plain English . io</em></strong></a><em class="lr">。报名参加我们的</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="lr">免费周报</em> </strong> </a> <em class="lr">。关注我们关于</em><a class="ae jz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="lr">Twitter</em></strong></a><a class="ae jz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="lr">LinkedIn</em></strong></a><em class="lr"/><a class="ae jz" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="lr">YouTube</em></strong></a><em class="lr"/><a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="lr">不和</em> </strong> </a> <em class="lr">。</em></p></div></div>    
</body>
</html>