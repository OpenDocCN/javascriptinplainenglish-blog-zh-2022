<html>
<head>
<title>How to Refactor the Global Variables in JavaScript?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何重构JavaScript中的全局变量？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-refactor-the-global-variables-in-javascript-9dc2d3fa7e6c?source=collection_archive---------18-----------------------#2022-03-21">https://javascript.plainenglish.io/how-to-refactor-the-global-variables-in-javascript-9dc2d3fa7e6c?source=collection_archive---------18-----------------------#2022-03-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="4742" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">更深入地研究名称空间模式以重构全局变量。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/bc7b0ec4a40ae97344b3a58749db8e6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mLoTD0jouaTknya3h8Sq9g.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Javascript by Unsplash</figcaption></figure><p id="e088" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们都听说过或读过全球化是不好的实践。用多个全局变量污染代码空间会导致代码不可管理和不可预测。</p><p id="98cd" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这是明智的，始终保持在检查全局，并尽可能减少它。</p><p id="aac8" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在这一部分，我们将讨论一种方法，这种方法可以很容易地减少全局变量。</p><p id="6382" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">假设您的代码库中存在以下全局变量:</p><pre class="kd ke kf kg gt lo lp lq lr aw ls bi"><span id="ea12" class="lt lu in lp b gy lv lw l lx ly">// Constructors<br/>function X() {}<br/>function Y() {}</span><span id="1250" class="lt lu in lp b gy lz lw l lx ly">// global vars<br/>var res = 1;</span><span id="507f" class="lt lu in lp b gy lz lw l lx ly">// global objects<br/>var module1 = {<br/>   a: 1,<br/>   b: 2<br/>};</span><span id="e9dd" class="lt lu in lp b gy lz lw l lx ly">var module2 = {};<br/>module2.a = 10;<br/>module2.b = 20;</span><span id="d6e8" class="lt lu in lp b gy lz lw l lx ly">var module3 = {};</span></pre><p id="e16d" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在上面的块中，我们有<strong class="ku io"> <em class="ma"> 6个全局变量</em> </strong>。现在，我们可以将这段代码重构为只有一个全局对象，所有的构造函数、变量和对象都将是它的一部分。</p><p id="c902" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">理想情况下，所有代码库都应该有一个全局变量。拥有多个全局变量是不好的，原因有很多，例如</p><ol class=""><li id="2c30" class="mb mc in ku b kv kw ky kz lb md lf me lj mf ln mg mh mi mj bi translated">它们可能会被意外修改，并且容易出错。</li><li id="de22" class="mb mc in ku b kv mk ky ml lb mm lf mn lj mo ln mg mh mi mj bi translated">此外，它可能会导致与您的代码或第三方库的名称冲突</li></ol><h1 id="964e" class="mp lu in bd mq mr ms mt mu mv mw mx my jt mz ju na jw nb jx nc jz nd ka ne nf bi translated">解决办法</h1><p id="9a90" class="pw-post-body-paragraph ks kt in ku b kv ng jo kx ky nh jr la lb ni ld le lf nj lh li lj nk ll lm ln ig bi translated">重构代码:</p><pre class="kd ke kf kg gt lo lp lq lr aw ls bi"><span id="90c6" class="lt lu in lp b gy lv lw l lx ly">// Global object<br/>var APP = APP || {};</span><span id="80de" class="lt lu in lp b gy lz lw l lx ly">// Constructors<br/>APP.X = function () {};<br/>APP.Y = function () {};</span><span id="d153" class="lt lu in lp b gy lz lw l lx ly">// variables<br/>APP.res = 1;</span><span id="2c03" class="lt lu in lp b gy lz lw l lx ly">// objects<br/>APP.modules.module1 = {a: 1, b: 2};</span><span id="3c64" class="lt lu in lp b gy lz lw l lx ly">APP.modules.module2 = {};<br/>APP.modules.module2.a = 10;<br/>APP.modules.module2.b = 20;</span><span id="53c2" class="lt lu in lp b gy lz lw l lx ly">APP.modules.module3 = {};</span></pre><p id="33e3" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">代码有问题，例如，如果您想使用以下代码:</p><pre class="kd ke kf kg gt lo lp lq lr aw ls bi"><span id="9862" class="lt lu in lp b gy lv lw l lx ly">var module1 = APP.modules.module1;</span></pre><p id="b480" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">您必须进行如下3项检查:</p><pre class="kd ke kf kg gt lo lp lq lr aw ls bi"><span id="4639" class="lt lu in lp b gy lv lw l lx ly">var module1 = APP &amp;&amp; APP.modules &amp;&amp; APP.modules.module1;</span></pre><p id="16a4" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这有点让人恼火。</p><p id="74bf" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">为了解决这个问题，我们需要一个方便的函数来处理命名空间部分。让我们称这个函数为“namespace()”，并像这样使用它:</p><pre class="kd ke kf kg gt lo lp lq lr aw ls bi"><span id="4fe7" class="lt lu in lp b gy lv lw l lx ly">APP.namespace(‘APP.modules.module1’) </span></pre><p id="e85c" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这相当于:</p><pre class="kd ke kf kg gt lo lp lq lr aw ls bi"><span id="79a9" class="lt lu in lp b gy lv lw l lx ly">var APP = {<br/>   modules: {<br/>      module1: {<br/>      }<br/>   }<br/>};</span></pre><h1 id="b6c8" class="mp lu in bd mq mr ms mt mu mv mw mx my jt mz ju na jw nb jx nc jz nd ka ne nf bi translated">namespace()函数的实现</h1><pre class="kd ke kf kg gt lo lp lq lr aw ls bi"><span id="8a45" class="lt lu in lp b gy lv lw l lx ly">var APP = APP || {};</span><span id="34a3" class="lt lu in lp b gy lz lw l lx ly">APP.namespace = function (str) {<br/>  var parts = str.split('.'),<br/>      parent = APP;</span><span id="64a3" class="lt lu in lp b gy lz lw l lx ly">  // remove the redundant global<br/>  if (parts[0] === 'APP') {<br/>      parts = parts.slice(1);<br/>  }</span><span id="91cd" class="lt lu in lp b gy lz lw l lx ly">  for (var i = 0; i &lt; parts.length; i++) {<br/>      if (typeof parent[parts[i]] === 'undefined') {<br/>          parent[parts[i]] = {};<br/>      }<br/>      parent = parent[parts[i]]; <br/>  }</span><span id="16f9" class="lt lu in lp b gy lz lw l lx ly">  return parent;<br/>}</span></pre><p id="8456" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">让我们测试一下上面的内容:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nl"><img src="../Images/84f069f2ece95cb9bf916d6363918420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a41KfRgIk3SIz98Ua26n0A.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">creating nested objects with namespace pattern</figcaption></figure><p id="e7f7" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们可以看到:</p><pre class="kd ke kf kg gt lo lp lq lr aw ls bi"><span id="1231" class="lt lu in lp b gy lv lw l lx ly">APP.namespace(‘APP.modules.module1’)</span></pre><p id="01ac" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">上面的代码给出了期望的结果，传递APP(名称空间中的顶级全局对象)也是多余的。我们可以通过传递<code class="fe nm nn no lp b">modules.module1</code>来达到同样的目的</p><pre class="kd ke kf kg gt lo lp lq lr aw ls bi"><span id="3892" class="lt lu in lp b gy lv lw l lx ly">APP.namespace(‘modules.module1’)</span></pre></div><div class="ab cl np nq hr nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ig ih ii ij ik"><p id="e203" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">如果您喜欢名称空间模式，请告诉我。如果你喜欢我的文章，请关注我。感谢你阅读这篇文章，回头见！</p><p id="740a" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><em class="ma">更多内容请看</em><strong class="ku io"><em class="ma"/></strong><a class="ae nw" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ku io"><em class="ma">说白了。报名参加我们的</em> <a class="ae nw" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ku io"> <em class="ma">免费周报</em> </strong> </a> <em class="ma">。关注我们</em> <a class="ae nw" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ku io"> <em class="ma">推特</em> </strong> </a> <em class="ma">和</em><a class="ae nw" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ku io"><em class="ma">LinkedIn</em></strong></a><em class="ma">。加入我们的</em> <a class="ae nw" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ku io"> <em class="ma">社区</em> </strong> </a> <em class="ma">。</em></strong></a></p></div></div>    
</body>
</html>