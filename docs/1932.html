<html>
<head>
<title>Send Web App Notifications with Firebase Cloud Messaging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Firebase云消息发送Web应用通知</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/firebase-cloud-messaging-on-web-5621dc2d3a26?source=collection_archive---------1-----------------------#2022-05-01">https://javascript.plainenglish.io/firebase-cloud-messaging-on-web-5621dc2d3a26?source=collection_archive---------1-----------------------#2022-05-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="a210" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">关于如何使用Firebase Cloud Messaging向web应用程序用户发送通知的教程。</h2></div><p id="0572" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你是用<a class="ae ky" href="https://www.amazon.in/" rel="noopener ugc nofollow" target="_blank">亚马逊</a>、<a class="ae ky" href="https://www.tokopedia.com/" rel="noopener ugc nofollow" target="_blank"> Tokopedia </a>还是<a class="ae ky" href="https://www.flipkart.com/" rel="noopener ugc nofollow" target="_blank"> Flipkart </a>？那你一定在浏览器上收到了一些通知。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="le lf l"/></div></figure><p id="6a2f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">嗯，所有这些消息和通知都是通过Firebase发送到您的手机、台式机等设备的，今天我将分享我们如何使用Firebase云消息向我们的应用程序用户发送通知。</p><h1 id="237d" class="lg lh in bd li lj lk ll lm ln lo lp lq jt lr ju ls jw lt jx lu jz lv ka lw lx bi translated">什么是Firebase云消息传递？</h1><p id="36cd" class="pw-post-body-paragraph kc kd in ke b kf ly jo kh ki lz jr kk kl ma kn ko kp mb kr ks kt mc kv kw kx ig bi translated">FCM是一个消息传递解决方案，可以让您实时发送和接收消息。使用FCM，您可以向客户端设备发送通知和消息。它是独立于平台的，你也可以将消息推送到网络或本地应用。</p><p id="fd48" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">FCM提供了各种分发方法，您可以向单个设备或多个设备发送消息和通知。<br/>有关FCM工作原理的更多详细信息，您可以在这里找到:</p><div class="md me gp gr mf mg"><a href="https://firebase.google.com/docs/cloud-messaging" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd io gy z fp ml fr fs mm fu fw im bi translated">Firebase云消息| Firebase文档</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">Firebase云消息传递(FCM)是一个跨平台的消息传递解决方案，让您能够可靠地免费发送消息…</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">firebase.google.com</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu mv mg"/></div></div></a></div><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="mw lf l"/></div></figure><h1 id="7c1d" class="lg lh in bd li lj lk ll lm ln lo lp lq jt lr ju ls jw lt jx lu jz lv ka lw lx bi translated">集成Firebase云消息传递</h1><p id="3d90" class="pw-post-body-paragraph kc kd in ke b kf ly jo kh ki lz jr kk kl ma kn ko kp mb kr ks kt mc kv kw kx ig bi translated">FCM可以和各种前端平台一起工作，比如ios，android。但是在这篇文章中，我们将关注如何在网络上使用FCM，如果你是一个Android用户🤖或者iOS🍏开发商。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="mx lf l"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Bye Bye</figcaption></figure><p id="f464" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nc">哦，你是web开发人员？恭喜你！你选择了正确的职业🤪。<br/> </em> <br/>好的，我们知道Firebase是由Google支持的，所以我们需要满足一些要求:</p><ul class=""><li id="a399" class="nd ne in ke b kf kg ki kj kl nf kp ng kt nh kx ni nj nk nl bi translated">创建一个谷歌账户(<em class="nc">如果你还没有的话😳</em>)。</li><li id="a813" class="nd ne in ke b kf nm ki nn kl no kp np kt nq kx ni nj nk nl bi translated">在<a class="ae ky" href="https://console.firebase.google.com/?pli=1" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>创建一个Firebase项目。</li><li id="1dc5" class="nd ne in ke b kf nm ki nn kl no kp np kt nq kx ni nj nk nl bi translated">创建应用程序后，您将登陆Firebase控制台仪表板。</li><li id="9b61" class="nd ne in ke b kf nm ki nn kl no kp np kt nq kx ni nj nk nl bi translated">导航至Engage下的云消息传递。</li><li id="6ea5" class="nd ne in ke b kf nm ki nn kl no kp np kt nq kx ni nj nk nl bi translated">将Firebase添加到web应用程序并注册。</li></ul><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="ns nt di nu bf nv"><div class="gh gi nr"><img src="../Images/5fa5454507753de93814e16a5fe5cba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dj3-Qe4uxOY0ljEAsg_LhQ.png"/></div></div></figure><h2 id="f12c" class="nx lh in bd li ny nz dn lm oa ob dp lq kl oc od ls kp oe of lu kt og oh lw oi bi translated">使用npm安装Firebase</h2><p id="7658" class="pw-post-body-paragraph kc kd in ke b kf ly jo kh ki lz jr kk kl ma kn ko kp mb kr ks kt mc kv kw kx ig bi translated">现在让我们把手弄脏。<br/>运行下面的命令在你的项目中安装Firebase。</p><pre class="kz la lb lc gt oj ok ol om aw on bi"><span id="4911" class="nx lh in ok b gy oo op l oq or">npm install firebase --save</span></pre><p id="2549" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在你的应用中初始化Firebase。</p><pre class="kz la lb lc gt oj ok ol om aw on bi"><span id="8e69" class="nx lh in ok b gy oo op l oq or">import { initializeApp } from "firebase/app";<br/>import { getAnalytics } from "firebase/analytics";<br/><br/>const firebaseConfig = {<br/>  apiKey: &lt;your-api-key&gt;,<br/>  authDomain: "medium-project-9adf6.firebaseapp.com",<br/>  projectId: "medium-project-9adf6",<br/>  storageBucket: "medium-project-9adf6.appspot.com",<br/>  messagingSenderId: "&lt;your-messaging-id&gt;",<br/>  appId: &lt;your-app-id&gt;,<br/>  measurementId: &lt;your-measurement-id&gt; // should start with G<br/>};</span><span id="ce79" class="nx lh in ok b gy os op l oq or">// Initialize Firebase<br/>const app = initializeApp(firebaseConfig);<br/>const analytics = getAnalytics(app);<br/>Note: The below steps are shown to set up FCM version 9.</span></pre><p id="b061" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">只需复制上面共享的片段并粘贴到您的index.html。<br/>如果你正在使用Next.js或任何React框架，你可以将其粘贴到你的应用中的任何条目文件，可以是app.js或index.js等。</p><h1 id="cf75" class="lg lh in bd li lj lk ll lm ln lo lp lq jt lr ju ls jw lt jx lu jz lv ka lw lx bi translated">使用FCM配置Web凭据</h1><p id="c5db" class="pw-post-body-paragraph kc kd in ke b kf ly jo kh ki lz jr kk kl ma kn ko kp mb kr ks kt mc kv kw kx ig bi translated">初始化之后，我们将配置凭证。<br/> FCM使用称为VAPID密钥的授权密钥来授权发送请求。<br/>要订阅我们的应用程序来推送通知，我们需要将一对键映射到我们的Firebase项目。我们可以通过如下所示的设置生成新的密钥对:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="ns nt di nu bf nv"><div class="gh gi ot"><img src="../Images/81580e8312ce83f37f661d1d5c331e49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jLXNgwDWC2RtLczRGUeiug.png"/></div></div></figure><ul class=""><li id="221e" class="nd ne in ke b kf kg ki kj kl nf kp ng kt nh kx ni nj nk nl bi translated">转到项目设置</li><li id="a765" class="nd ne in ke b kf nm ki nn kl no kp np kt nq kx ni nj nk nl bi translated">导航至云消息选项卡</li><li id="c1e4" class="nd ne in ke b kf nm ki nn kl no kp np kt nq kx ni nj nk nl bi translated">生成并复制密钥</li></ul><p id="1189" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们有VAPID密钥可用，我们将在我们的项目中使用它。我们将首先创建一个名为<code class="fe ou ov ow ok b">firebase-messaging-sw.js</code>的文件，并将其放在我们的域的根目录下。<br/>我说的root是指我们可以很容易地以<code class="fe ou ov ow ok b">www.mysite.com/firebase-messaging-sw.js</code>的身份访问这个文件，如果你使用的是nextJs place，你可以把它放在public文件夹中。当浏览器不在焦点上或在后台时，需要这个文件来设置后台通知处理程序。</p><h2 id="2c5b" class="nx lh in bd li ny nz dn lm oa ob dp lq kl oc od ls kp oe of lu kt og oh lw oi bi translated">访问FCM令牌</h2><p id="47a9" class="pw-post-body-paragraph kc kd in ke b kf ly jo kh ki lz jr kk kl ma kn ko kp mb kr ks kt mc kv kw kx ig bi translated">在应用程序初始化之后，我们需要一个在向不同的推送服务发送消息请求时所需的令牌。对于每个应用程序实例，令牌都是唯一的。FCM令牌可以在重新安装或删除应用程序时更改。</p><p id="9241" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们可以通过<code class="fe ou ov ow ok b">getToken()</code>方法获得FCM令牌。分享完整的片段:</p><pre class="kz la lb lc gt oj ok ol om aw on bi"><span id="7cf1" class="nx lh in ok b gy oo op l oq or">import { getMessaging, getToken } from "firebase/messaging";<br/><br/>const messaging = getMessaging();<br/>getToken(messaging, { vapidKey: '<strong class="ok io">&lt;YOUR_PUBLIC_VAPID_KEY_HERE&gt;</strong>' }).then((currentToken) =&gt; {<br/>  if (currentToken) {<br/>    // Send the token to your server and update the UI if necessary<br/>    // ...<br/>  } else {<br/>    // Show permission request UI<br/>    console.log('No registration token available. Request permission to generate one.');<br/>    // ...<br/>  }<br/>}).catch((err) =&gt; {<br/>  console.log('An error occurred while retrieving token. ', err);<br/>  // ...<br/>});</span></pre><p id="890d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从客户端获得令牌后，我们可以将它发送到我们的应用服务器，并使用一些API或广播接口存储它。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="ox lf l"/></div></figure><h1 id="fff3" class="lg lh in bd li lj lk ll lm ln lo lp lq jt lr ju ls jw lt jx lu jz lv ka lw lx bi translated">接收消息</h1><p id="102e" class="pw-post-body-paragraph kc kd in ke b kf ly jo kh ki lz jr kk kl ma kn ko kp mb kr ks kt mc kv kw kx ig bi translated">有了以上所有的设置，我们就可以向用户发送或推送消息了。在深入之前，我们应该知道有两种类型的消息可以发送给用户，它可以是前台和后台消息。</p><p id="44f3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">两种重要的方法在后台运行以接收数据:</p><ul class=""><li id="c3ab" class="nd ne in ke b kf kg ki kj kl nf kp ng kt nh kx ni nj nk nl bi translated">onMessage</li><li id="17d3" class="nd ne in ke b kf nm ki nn kl no kp np kt nq kx ni nj nk nl bi translated">onBackgroundMessage</li></ul><h2 id="f394" class="nx lh in bd li ny nz dn lm oa ob dp lq kl oc od ls kp oe of lu kt og oh lw oi bi translated">履行</h2><p id="f0d0" class="pw-post-body-paragraph kc kd in ke b kf ly jo kh ki lz jr kk kl ma kn ko kp mb kr ks kt mc kv kw kx ig bi translated">首先，我们需要注册一名服务人员。</p><p id="f77b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你不知道什么是服务人员，请阅读以下内容:</p><div class="md me gp gr mf mg"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd io gy z fp ml fr fs mm fu fw im bi translated">服务工作者API-Web API | MDN</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">服务人员本质上充当代理服务器，位于web应用程序、浏览器和网络之间(当…</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">developer.mozilla.org</p></div></div><div class="mp l"><div class="oy l mr ms mt mp mu mv mg"/></div></div></a></div><p id="3d6f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您的应用程序不使用服务人员，您可以使用以下代码片段注册服务人员:</p><pre class="kz la lb lc gt oj ok ol om aw on bi"><span id="f9a4" class="nx lh in ok b gy oo op l oq or">const ua = navigator.userAgent;</span><span id="b5a7" class="nx lh in ok b gy os op l oq or">navigator.serviceWorker<br/>   .register(`service-worker.js`).then((registration) =&gt; {<br/>     console.log('Registration successful, scope is:',registration.scope);</span></pre><p id="1836" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">共享接收前台和后台消息的完整实现:</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="mx lf l"/></div></figure><p id="d2e6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面的代码不言自明。如果有任何疑问，让我们从第10行开始，这里我们注册了一个服务人员，从第14-22行开始，我们用可用的密钥初始化firebase。<br/>我们还使用两种方法<code class="fe ou ov ow ok b">onMessage</code>和<code class="fe ou ov ow ok b">onBackgroundMessage</code>来接收消息，如第26行和第31行所示。您可以在<code class="fe ou ov ow ok b">onMessage</code>回调中更新react组件或进行DOM操作。<br/>如果窗口不在焦点上，我们使用<code class="fe ou ov ow ok b">showNotification</code>函数弹出通知。</p><p id="d467" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，一切都设置好了。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="oz lf l"/></div></figure><h2 id="33e7" class="nx lh in bd li ny nz dn lm oa ob dp lq kl oc od ls kp oe of lu kt og oh lw oi bi translated">发送您的第一条消息</h2><p id="06d0" class="pw-post-body-paragraph kc kd in ke b kf ly jo kh ki lz jr kk kl ma kn ko kp mb kr ks kt mc kv kw kx ig bi translated">我们如何测试我们的通知？让我们回到Firebase仪表板。Firebase dashboard使我们能够在投入生产之前向我们的设备发送测试消息，您可以在云消息传递菜单下找到相同的内容。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="ns nt di nu bf nv"><div class="gh gi pa"><img src="../Images/49a7d456cc11f56f3906d997745f25bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oqR6b5JkVpX2sCSqr4Fpjw.png"/></div></div></figure><p id="471a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如您在共享的插图中看到的，我们需要为我们的消息添加标题和文本，因为它们是必填字段。此外，我们应该有一个我们需要发送通知或消息的应用程序或设备的FCM令牌。</p><p id="8483" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以从<code class="fe ou ov ow ok b">getToken()</code>方法获得FCM令牌。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="oz lf l"/></div></figure><p id="ca82" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">只需点击测试按钮，看看神奇。您将在设备上收到通知。</p><p id="09fa" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们走吧。这就是我们如何将Firebase云消息集成到web应用程序中。感谢您的阅读。如果你学到了新东西，就鼓掌。</p><p id="555c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在推特上关注我<a class="ae ky" href="https://twitter.com/aatifbandey" rel="noopener ugc nofollow" target="_blank"> @aatifbandey </a></p><p id="f744" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nc">更多内容尽在</em> <a class="ae ky" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nc">说白了. io </em> </strong> </a> <em class="nc">。报名参加我们的</em> <a class="ae ky" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nc">免费周报</em> </strong> </a> <em class="nc">。关注我们关于</em> <a class="ae ky" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nc">推特</em> </strong> </a> <em class="nc">和</em><a class="ae ky" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="nc">LinkedIn</em></strong></a><em class="nc">。加入我们的</em> <a class="ae ky" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nc">社区</em> </strong> </a> <em class="nc">。</em></p></div></div>    
</body>
</html>