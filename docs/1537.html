<html>
<head>
<title>JavaScript Promises: Understanding Promise.race()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript Promises:理解Promise.race()</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-promises-understanding-promise-race-72ec28461d27?source=collection_archive---------5-----------------------#2022-03-31">https://javascript.plainenglish.io/javascript-promises-understanding-promise-race-72ec28461d27?source=collection_archive---------5-----------------------#2022-03-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/5e8a068c59e77d9aea9d4970a58412ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*onjS1ufbzXYqkzqm"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@sapegin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Artem Sapegin</a> on <a class="ae jz" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3570" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ECMAScript 2021是最新的JavaScript版本，它为JavaScript语言引入了多个新特性。但是promise.race()是在ECMAScript 2015(ES6)中引入的，可用7年。</p><p id="b5bc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文中，我们将学习如何使用<code class="fe ky kz la lb b">Promise.race()</code>方法来执行多个异步调用。</p><h2 id="9659" class="lc ld in bd le lf lg dn lh li lj dp lk kl ll lm ln kp lo lp lq kt lr ls lt lu bi translated">Promise.race()方法</h2><p id="d77d" class="pw-post-body-paragraph ka kb in kc b kd lv kf kg kh lw kj kk kl lx kn ko kp ly kr ks kt lz kv kw kx ig bi translated">根据MDN <a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/race" rel="noopener ugc nofollow" target="_blank">文件</a>，</p><blockquote class="ma mb mc"><p id="b7aa" class="ka kb md kc b kd ke kf kg kh ki kj kk me km kn ko mf kq kr ks mg ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">Promise.race()</code>将一个可迭代对象(如承诺数组)作为输入，并返回一个在可迭代的<strong class="kc io">中尽快解决的承诺(未实现)。一个约定的承诺可以被解决，也可以被拒绝。</strong></p><p id="e6a5" class="ka kb md kc b kd ke kf kg kh ki kj kk me km kn ko mf kq kr ks mg ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">race</code>函数返回一个<code class="fe ky kz la lb b">Promise</code>，其处理方式与作为参数传递的iterable承诺中的第一个承诺相同(取相同的值)。</p><p id="596d" class="ka kb md kc b kd ke kf kg kh ki kj kk me km kn ko mf kq kr ks mg ku kv kw kx ig bi translated">如果传递的iterable为空，则返回的承诺将永远挂起。</p><p id="9aa8" class="ka kb md kc b kd ke kf kg kh ki kj kk me km kn ko mf kq kr ks mg ku kv kw kx ig bi translated">如果iterable包含一个或多个非承诺值和/或一个已经确定的承诺，那么<code class="fe ky kz la lb b">Promise.race</code>将解析到iterable中的第一个值。</p></blockquote><pre class="mh mi mj mk gt ml lb mm mn aw mo bi"><span id="e6f9" class="lc ld in lb b gy mp mq l mr ms">const data = Promise.race([promise1,...]) // iterable object</span></pre><p id="889d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以使用<strong class="kc io">提取承诺解析值。然后</strong>语法:-</p><pre class="mh mi mj mk gt ml lb mm mn aw mo bi"><span id="8632" class="lc ld in lb b gy mp mq l mr ms">data.then((values) =&gt; {<br/>  values; // [resultOfPromise1, resultOfPromise2, ...]<br/>}).catch(error =&gt; {<br/>  console.log(error)<br/>}</span></pre><p id="8931" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">或者<strong class="kc io">异步/等待</strong>:</p><pre class="mh mi mj mk gt ml lb mm mn aw mo bi"><span id="ab0a" class="lc ld in lb b gy mp mq l mr ms">try{<br/> const result = await data;<br/> console.log(result); //[resultPromise1, resultPromise2, ...]<br/>} catch (error =&gt; {<br/> console.log(error);<br/>}</span></pre><p id="1480" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">关于<code class="fe ky kz la lb b">promise.race()</code>需要记住的几点</p><ul class=""><li id="0216" class="mt mu in kc b kd ke kh ki kl mv kp mw kt mx kx my mz na nb bi translated">如果所有的承诺都实现了，那么无论哪个承诺实现得更快都将是结果。承诺是解决了还是拒绝了并不重要。无论哪个承诺执行得更快，它都会返回</li></ul><p id="8fd2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了更好地理解上述观点，我举一个例子:</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nc"><img src="../Images/f72bb886d21cf71daa25e570e7af2eb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bM7OTJiB936eGSF5D4jT6A.png"/></div></div></figure><p id="17c4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在上面的例子中可以看到，第二个承诺被拒绝，而不是立即拒绝整个承诺，就像<code class="fe ky kz la lb b">promise.all()</code>一样，或者说<code class="fe ky kz la lb b">promise.race() </code>不是忽略被拒绝的承诺，而是返回执行最快的承诺。</p><h2 id="85b9" class="lc ld in bd le lf lg dn lh li lj dp lk kl ll lm ln kp lo lp lq kt lr ls lt lu bi translated">是什么让Promise.race()不同于Promise.any()</h2><p id="92ac" class="pw-post-body-paragraph ka kb in kc b kd lv kf kg kh lw kj kk kl lx kn ko kp ly kr ks kt lz kv kw kx ig bi translated"><code class="fe ky kz la lb b">Promise.race</code>和<code class="fe ky kz la lb b">Promise.any</code>做不同的事情:</p><ul class=""><li id="4aa0" class="mt mu in kc b kd ke kh ki kl mv kp mw kt mx kx my mz na nb bi translated"><code class="fe ky kz la lb b">Promise.any() </code>也返回最快的承诺，但它返回最快的<strong class="kc io">履行的</strong>承诺。如果所有都被拒绝，则返回一个聚合错误。</li><li id="0515" class="mt mu in kc b kd nd kh ne kl nf kp ng kt nh kx my mz na nb bi translated">虽然<code class="fe ky kz la lb b">Promise.race()</code>返回最快的<strong class="kc io">确定的</strong>承诺，但是这些承诺是被拒绝还是被确定并不重要。如果所有的承诺都被拒绝，它仍然会返回最快的被拒绝的承诺。</li></ul><h2 id="f176" class="lc ld in bd le lf lg dn lh li lj dp lk kl ll lm ln kp lo lp lq kt lr ls lt lu bi translated">示例:-</h2><p id="0c09" class="pw-post-body-paragraph ka kb in kc b kd lv kf kg kh lw kj kk kl lx kn ko kp ly kr ks kt lz kv kw kx ig bi translated">如果你给他们两个两个承诺，其中一个被拒绝，然后另一个被履行，来自<code class="fe ky kz la lb b">Promise.race</code>的承诺将被拒绝(因为第一个解决的承诺被拒绝),来自<code class="fe ky kz la lb b">Promise.any</code>的承诺将被履行(因为虽然第一个承诺被拒绝，第二个被履行)。</p><h2 id="1b20" class="lc ld in bd le lf lg dn lh li lj dp lk kl ll lm ln kp lo lp lq kt lr ls lt lu bi translated">结论:-</h2><p id="8e64" class="pw-post-body-paragraph ka kb in kc b kd lv kf kg kh lw kj kk kl lx kn ko kp ly kr ks kt lz kv kw kx ig bi translated"><code class="fe ky kz la lb b">Promise.race()</code>有助于以竞争方式并行执行独立的异步操作，以获取任何第一个成功结算的承诺的值。</p><p id="6909" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它接受一个<strong class="kc io">可迭代对象</strong>，比如一个承诺数组作为输入。</p><ul class=""><li id="32da" class="mt mu in kc b kd ke kh ki kl mv kp mw kt mx kx my mz na nb bi translated">使用JavaScript <code class="fe ky kz la lb b">Promise.race()</code>方法获取一个承诺列表，并返回一个先解决的承诺。</li></ul><h2 id="a371" class="lc ld in bd le lf lg dn lh li lj dp lk kl ll lm ln kp lo lp lq kt lr ls lt lu bi translated"><a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/race#browser_compatibility" rel="noopener ugc nofollow" target="_blank">浏览器兼容性</a></h2><p id="5e36" class="pw-post-body-paragraph ka kb in kc b kd lv kf kg kh lw kj kk kl lx kn ko kp ly kr ks kt lz kv kw kx ig bi translated">请注意，<code class="fe ky kz la lb b">promise.race()</code>在除了internet explorer之外的所有现代浏览器中都得到完全支持。</p><p id="f43b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这将是关于承诺的系列文章的结束，如果你想查看请查看我以前的文章，关于<a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/javascript-promises-understanding-promise-any-d8640d4c6ae5"> Promise.any() </a>，<a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/javascript-promises-understanding-promise-all-c6a126d02e86"> Promise.all() </a>和<a class="ae jz" href="https://medium.com/@aayushtibra1997/javascript-promises-understanding-promise-allsettled-8d9635540697" rel="noopener"> Promise.allSettled()。</a></p><blockquote class="ma mb mc"><p id="2a83" class="ka kb md kc b kd ke kf kg kh ki kj kk me km kn ko mf kq kr ks mg ku kv kw kx ig bi translated">请在评论区分享你的观点，是的，欢迎反馈。<br/>希望你会喜欢并分享这篇文章，以便更好地阅读<br/>查看我的其他文章，网址为—<a class="ae jz" href="https://medium.com/@aayushtibra1997" rel="noopener"><strong class="kc io">https://medium.com/@aayushtibra1997</strong></a><strong class="kc io">T22】感谢阅读:)</strong></p></blockquote><p id="bc67" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="md">更多内容请看</em><a class="ae jz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="md">plain English . io</em></strong></a><em class="md">。报名参加我们的</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="md">免费周报</em> </strong> </a> <em class="md">。关注我们关于</em><a class="ae jz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="md">Twitter</em></strong></a><em class="md">和</em><a class="ae jz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="md">LinkedIn</em></strong></a><em class="md">。加入我们的</em> <a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="md">社区不和谐</em> </strong> </a> <em class="md">。</em></p></div></div>    
</body>
</html>