<html>
<head>
<title>Good Practices if You’re Using Multiple External Services in Your Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如果您在项目中使用多个外部服务，这是很好的实践</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/using-multiple-external-services-in-your-project-af21d1463414?source=collection_archive---------7-----------------------#2022-12-10">https://javascript.plainenglish.io/using-multiple-external-services-in-your-project-af21d1463414?source=collection_archive---------7-----------------------#2022-12-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="5b5d" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">管理多个外部服务，以处理任何企业项目中的关键操作</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/a460c536767e30fa7f9ed2cc30c0805c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UB3lJJD0iiUMJhL_"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/fr/@nordwood?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">NordWood Themes</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="0eb8" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">在项目中使用多个外部服务</h1><p id="f22e" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">您将需要管理多个外部服务来处理任何企业项目中的关键操作。例如，使用Auth0管理身份验证，使用脸书图形API进行社交管理，或者使用Odoo进行CRM管理</p><p id="a1d0" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">人们一直在他们的控制器中使用直接代码，并在同一个地方进行管理，我认为这不是一个好的做法。当代码库增加时，管理这些外部端点总是很困难</p><h2 id="bb69" class="mm ku in bd kv mn mo dn kz mp mq dp ld lu mr ms lf ly mt mu lh mc mv mw lj mx bi translated">外部服务的示例</h2><p id="575e" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">Instagram Graph API，微软Graph API，Odoo服务API，预订API。任何提供某种服务的端点</p><h2 id="364c" class="mm ku in bd kv mn mo dn kz mp mq dp ld lu mr ms lf ly mt mu lh mc mv mw lj mx bi translated">我们应该遵循哪些做法？</h2><ul class=""><li id="2fd8" class="my mz in ln b lo lp lr ls lu na ly nb mc nc mg nd ne nf ng bi translated">设计模式——遵循设计模式总是会让你的生活变得轻松。它可以是任何单一或工厂或任何其他设计模式</li><li id="e4ab" class="my mz in ln b lo nh lr ni lu nj ly nk mc nl mg nd ne nf ng bi translated">使用Oops原则——服务是可以在应用程序的后端或前端或任何级别使用的公共基础</li><li id="6574" class="my mz in ln b lo nh lr ni lu nj ly nk mc nl mg nd ne nf ng bi translated">服务版本化——因为服务可以在外部修改，所以维护服务版本很容易改变方法</li></ul><h2 id="3ad5" class="mm ku in bd kv mn mo dn kz mp mq dp ld lu mr ms lf ly mt mu lh mc mv mw lj mx bi translated">实践中见</h2><p id="ed27" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">假设我们必须使用WhatsApp graph APIs来动态或以编程方式发送消息，另一个约束是我们使用的是他们的graph API版本13。我们将创建一个名为<code class="fe nm nn no np b">WhatsAppGraph13</code>的类来确认图形的版本，还将在该类中存储Axios属性，以便进行端点调用，从而存储Axios的默认值。为了使用<code class="fe nm nn no np b">/messages</code>API，我们需要将在图形仪表板上生成的<code class="fe nm nn no np b">phoneNumberId</code></p><pre class="kd ke kf kg gt nq np nr bn ns nt bi"><span id="3c69" class="nu ku in np b be nv nw l nx ny">import Axios, { AxiosInstance } from 'axios'<br/><br/>class WhatsAppGraph13 {<br/>  axios: AxiosInstance;<br/>  phoneNumberId: string | undefined;<br/><br/>  constructor(token: string, phoneNumberId: string) {<br/>    this.axios = Axios.create({<br/>      baseURL: `https://graph.facebook.com/v13.0`,<br/>      headers: {<br/>        Authorization: `Bearer ${token}`,<br/>      },<br/>    });<br/>    this.phoneNumberId = phoneNumberId;<br/>  }<br/>}<br/><br/>export default WhatsAppGraph13;</span></pre><p id="0241" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">现在，让我们创建一个方法<code class="fe nm nn no np b">sendMessageToOnePerson</code>来发送消息并使用我们刚刚创建的属性</p><pre class="kd ke kf kg gt nq np nr bn ns nt bi"><span id="a320" class="nu ku in np b be nv nw l nx ny">  sendMessageToOnePerson(<br/>    recipientPhoneNumber: string,<br/>    body: string<br/>  ) {<br/>    const commonPayload = {<br/>      messaging_product: "whatsapp",<br/>      recipient_type: "individual",<br/>      to: recipientPhoneNumber,<br/>      type: "text",<br/>      text: {<br/>        preview_url: false,<br/>        body: body,<br/>      },<br/>    };<br/>    return this.axios.post(`/${this.phoneNumberId}/messages`, commonPayload);<br/>  }</span></pre><p id="e916" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">在本例中，我们使用了我们创建的Axios实例，对于路由，我们将使用我们使用的另一个属性</p><p id="c178" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">以下程序的用法如下所示</p><pre class="kd ke kf kg gt nq np nr bn ns nt bi"><span id="a6ef" class="nu ku in np b be nv nw l nx ny">  sendMessage(user: User){<br/>    const body = LandingTemplate<br/>    const service = new WhatsAppGraph13(process.env.token, process.env.number)<br/>    service.sendMessageToOnePerson(user.phone, body)<br/>  }</span></pre><p id="b853" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">但是除此之外，我们还可以使用服务来管理实例。所以让我们创建一个名为<code class="fe nm nn no np b">fromEnv</code>的静态方法</p><p id="ced8" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">因此，让我们创建一个<code class="fe nm nn no np b">env.ts</code>，并为环境添加一些结构</p><pre class="kd ke kf kg gt nq np nr bn ns nt bi"><span id="ec8e" class="nu ku in np b be nv nw l nx ny">const Env = {<br/>  WhatsApp: {<br/>    AccessToken: process.env.NEXT_PUBLIC_ACCESS_TOKEN ?? '',<br/>    PhoneNumberId: process.env.NEXT_PUBLIC_PHONE_NUMBER_ID ?? '',<br/>    WebhookVerifyToken: process.env.NEXT_PUBLIC_WHATSAPP_CLOUD_API_VERIFY ?? '',<br/>  },<br/>  Google: {<br/>    AnalyticId: process.env.NEXT_PUBLIC_GOOGLE_ANALYTICS_ID<br/>  }<br/>}<br/><br/>export default Env</span></pre><p id="120c" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">现在，我们已经准备好了一个环境，我们可以编写另一个静态方法作为参考，该方法将创建一个实例，而无需将环境暴露给控制器</p><pre class="kd ke kf kg gt nq np nr bn ns nt bi"><span id="cc68" class="nu ku in np b be nv nw l nx ny"> static fromEnv(){<br/>    const token = Env.WhatsApp.AccessToken<br/>    const phoneNumberId = Env.WhatsApp.PhoneNumberId<br/>    return new WhatsAppGraph13(token, phoneNumberId)<br/>  }</span></pre><p id="c227" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">该方法的用法如下所示</p><pre class="kd ke kf kg gt nq np nr bn ns nt bi"><span id="546c" class="nu ku in np b be nv nw l nx ny">export const processWebhook = async (req: NextApiRequest) =&gt; {<br/>  const { entry, object } = req.body as IWhatsappWebhookRequestPayload;<br/>  const [event] = entry;<br/>  const [primaryChange] = event.changes;<br/>  // process webhook based on event<br/>  if(primaryChange.field === 'messages' &amp;&amp; primaryChange.value.messages){<br/>    const whatsappService = WhatsAppGraph13.fromEnv()<br/>    const from = primaryChange.value.messages.from<br/>    await whatsappService.sendMessageToOnePerson(from, 'Hello world!')<br/>  }<br/>  return new CustomResponse(200, { event, object });<br/>};</span></pre><p id="f8d9" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">服务的整个源文件将如下所示</p><pre class="kd ke kf kg gt nq np nr bn ns nt bi"><span id="b2f1" class="nu ku in np b be nv nw l nx ny">import Axios, { AxiosInstance } from "axios";<br/>import Env from "../constant/env";<br/><br/>class WhatsAppGraph13 {<br/>  axios: AxiosInstance;<br/>  phoneNumberId: string | undefined;<br/><br/>  constructor(token: string, phoneNumberId: string) {<br/>    this.axios = Axios.create({<br/>      baseURL: `https://graph.facebook.com/v13.0`,<br/>      headers: {<br/>        Authorization: `Bearer ${token}`,<br/>      },<br/>    });<br/>    this.phoneNumberId = phoneNumberId;<br/>  }<br/><br/>  sendMessageToOnePerson(<br/>    recipientPhoneNumber: string,<br/>    body: string<br/>  ) {<br/>    const commonPayload = {<br/>      messaging_product: "whatsapp",<br/>      recipient_type: "individual",<br/>      to: recipientPhoneNumber,<br/>      type: "text",<br/>      text: {<br/>        preview_url: false,<br/>        body: body,<br/>      },<br/>    };<br/>    return this.axios.post(`/${this.phoneNumberId}/messages`, commonPayload);<br/>  }<br/><br/>  static fromEnv(){<br/>    const token = Env.WhatsApp.AccessToken<br/>    const phoneNumberId = Env.WhatsApp.PhoneNumberId<br/>    return new WhatsAppGraph13(token, phoneNumberId)<br/>  }<br/>}<br/><br/>export default WhatsAppGraph13;</span></pre><h2 id="fac6" class="mm ku in bd kv mn mo dn kz mp mq dp ld lu mr ms lf ly mt mu lh mc mv mw lj mx bi translated">结论</h2><p id="1810" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">创建服务还有其他方法，但这将有助于您更好地组织服务文件。</p><p id="8f50" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">感谢阅读！</p><p id="bd69" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated"><em class="nz">更多内容请看</em><a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ln io"><em class="nz">plain English . io</em></strong></a><em class="nz">。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ln io"> <em class="nz">免费周报</em> </strong> </a> <em class="nz">。关注我们关于</em><a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ln io"><em class="nz">Twitter</em></strong></a><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ln io"><em class="nz">LinkedIn</em></strong></a><em class="nz"/><a class="ae ks" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ln io"><em class="nz">YouTube</em></strong></a><em class="nz"/><a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="ln io"><em class="nz">不和</em> </strong> </a> <strong class="ln io"> <em class="nz">。</em>T49】</strong></p><p id="8dbc" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated"><strong class="ln io"> <em class="nz">对缩放您的软件启动感兴趣</em> </strong> <em class="nz">？检查</em> <a class="ae ks" href="https://circuit.ooo?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="ln io"> <em class="nz">电路</em> </strong> </a> <em class="nz">。</em></p></div></div>    
</body>
</html>