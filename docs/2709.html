<html>
<head>
<title>What is Express Middleware?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是Express中间件？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/what-is-express-middleware-8961482c2c8c?source=collection_archive---------7-----------------------#2022-06-28">https://javascript.plainenglish.io/what-is-express-middleware-8961482c2c8c?source=collection_archive---------7-----------------------#2022-06-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d26b236b25d8d724b2c160596ef2424f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*73hTJPi2e_d1C4XY"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@max_duz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Max Duzij</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="dfa6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你是一个网页开发者，那么你一定听说过Express。Express是Node.js的一个web框架，它使得创建web应用程序变得很容易。Express最酷的特性之一是它对中间件的支持。在这篇博文中，我们将解释什么是中间件，以及如何使用它来改进开发过程。</p><h2 id="45c1" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">中间件简介</h2><p id="8121" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">那么，什么是中间件呢？中间件本质上是一段代码，在收到请求和返回响应之间执行。这允许您在应用程序逻辑运行之前修改传入的请求或执行某种操作。此外，中间件还可以用于在将输出响应发送回客户端之前对其进行修改。</p><h2 id="1a4a" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">为什么要使用中间件？</h2><p id="46e9" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">中间件提供了一种很好的方式来模块化您的代码，使其更具可重用性。此外，中间件可以用来执行不特定于任何一个路由或应用的任务。例如，您可以使用中间件来压缩响应体，然后再将其发送回客户端。这是提高应用程序性能的一个好方法。</p><p id="e7fe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用中间件的另一个优点是，它可以用来为您的应用程序提供安全特性。例如，在允许用户访问敏感信息之前，您可以使用中间件来验证用户是否通过了身份验证。</p><h2 id="1565" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">如何使用中间件？</h2><p id="9ff8" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">现在我们知道了什么是中间件以及为什么应该使用它，让我们来看看如何使用它。可以使用<code class="fe lz ma mb mc b">use </code>功能添加Express中间件。这个函数有两个参数:路径和中间件函数。path参数指定将为其执行中间件功能的URL。中间件函数是一个回调函数，它有三个参数:请求对象、响应对象和下一个函数。</p><p id="c60a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是一个简单的例子，说明如何创建一个记录每个请求的URL的中间件:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="8a7a" class="lb lc iq mc b gy ml mm l mn mo">function logURL(req, res, next) {</span><span id="2189" class="lb lc iq mc b gy mp mm l mn mo">  console.log(req.url);</span><span id="3ebd" class="lb lc iq mc b gy mp mm l mn mo">  next();</span><span id="efb7" class="lb lc iq mc b gy mp mm l mn mo">}</span><span id="c54e" class="lb lc iq mc b gy mp mm l mn mo">app.use(‘/’, logURL);</span></pre><p id="c4ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个例子中，我们使用<code class="fe lz ma mb mc b">use</code>函数将我们的中间件函数添加到与<code class="fe lz ma mb mc b">‘/’</code>匹配的URL的应用程序中。中间件函数只是将URL记录到控制台，然后调用<code class="fe lz ma mb mc b">next</code>函数。这一点很重要，因为它告诉Express中间件功能已经完成，可以继续下一个中间件或应用程序逻辑了。</p><p id="828c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您希望您的中间件功能对所有URL都执行，那么您可以简单地省略path参数:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="4a84" class="lb lc iq mc b gy ml mm l mn mo">app.use(logURL);</span></pre><p id="2f3b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将导致对所有请求执行中间件功能。虽然这段代码将对所有的URL执行，但重要的是要注意中间件的顺序在您的代码中很重要。</p><figure class="md me mf mg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mq"><img src="../Images/c7ad2d2a4cd962c29f0e3a915a28d2ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9ZUOkHgPOpEJa8nQ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@craftedbygc?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Green Chameleon</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="ba2a" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">中间件的顺序</h2><p id="85e9" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">值得注意的是，向应用程序添加中间件的顺序可能很重要。这是因为中间件的每一部分都是自顶向下执行的。例如，考虑以下代码:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="e5e3" class="lb lc iq mc b gy ml mm l mn mo">app.use(logURL);</span><span id="95f3" class="lb lc iq mc b gy mp mm l mn mo">app.use(‘/admin’, verifyUser);</span></pre><p id="54a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这段代码中，将为所有请求执行<code class="fe lz ma mb mc b">logURL</code>中间件函数。然而，如果我们将我们的<code class="fe lz ma mb mc b">app.use(logURL)</code>移到代码的最后一行，那么它将只为不匹配'/admin '的请求执行。这是因为<code class="fe lz ma mb mc b">verifyUser</code>中间件函数会拦截所有对<code class="fe lz ma mb mc b">/admin</code>的请求，并阻止<code class="fe lz ma mb mc b">logURL</code>函数被调用。</p><h2 id="e3ec" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">错误处理中间件</h2><p id="4f91" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">一种特殊类型的中间件是错误处理中间件。这种类型的中间件用于处理应用程序中出现的错误。错误处理中间件有四个参数:错误对象、请求对象、响应对象和下一个函数。</p><p id="fcea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是一个如何创建错误处理中间件功能的简单示例:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="b1a1" class="lb lc iq mc b gy ml mm l mn mo">function errorHandler(err, req, res, next) {</span><span id="d058" class="lb lc iq mc b gy mp mm l mn mo">  console.error(err);</span><span id="d5a3" class="lb lc iq mc b gy mp mm l mn mo">  res.status(500).send(‘Something went wrong!’);</span><span id="769e" class="lb lc iq mc b gy mp mm l mn mo">}</span><span id="edca" class="lb lc iq mc b gy mp mm l mn mo">app.use(errorHandler);</span></pre><p id="e6b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个例子中，我们使用“use”函数将我们的错误处理中间件函数添加到应用程序中。如果我们的代码中出现错误，错误处理中间件功能将“捕捉”错误，并相应地处理它。这个中间件函数只是将错误记录到控制台，然后将响应的状态代码设置为500，然后发回一条消息说“出错了！”。</p><h2 id="4406" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">学习Express中间件的其他资源</h2><p id="e802" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">我们在本文中讨论的只是Express中间件的介绍。中间件非常强大，但是看起来很复杂。从本文中，您了解了关于Express中间件的基本概念。这通常有助于将这些概念可视化，因此我将链接一些帮助我学习Express中间件的视频。</p><ul class=""><li id="4415" class="mr ms iq kf b kg kh kk kl ko mt ks mu kw mv la mw mx my mz bi translated"><a class="ae kc" href="https://www.youtube.com/watch?v=lY6icfhap2o&amp;t=680s" rel="noopener ugc nofollow" target="_blank">14分钟学会Express中间件</a></li><li id="e504" class="mr ms iq kf b kg na kk nb ko nc ks nd kw ne la mw mx my mz bi translated"><a class="ae kc" href="https://www.youtube.com/watch?v=MIr1oxQ3pao" rel="noopener ugc nofollow" target="_blank">中间件到底是什么东西</a></li></ul><p id="77e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些视频将有助于加深您对中间件的了解，并帮助您直观地了解中间件在生产中是如何使用的。</p><p id="bf89" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">希望这篇文章教会你一些东西！祝你的编码项目好运！</p><p id="760c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">更多内容请看</em><a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="nf">plain English . io</em></strong></a><em class="nf">。报名参加我们的</em> <a class="ae kc" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="nf">免费周报</em> </strong> </a> <em class="nf">。关注我们关于</em><a class="ae kc" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="nf">Twitter</em></strong></a><em class="nf">和</em><a class="ae kc" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="nf">LinkedIn</em></strong></a><em class="nf">。查看我们的</em> <a class="ae kc" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="nf">社区不和谐</em> </strong> </a> <em class="nf">加入我们的</em> <a class="ae kc" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="nf">人才集体</em> </strong> </a> <em class="nf">。</em></p></div></div>    
</body>
</html>