<html>
<head>
<title>How to Add a React App to WordPress Pages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何向WordPress页面添加React应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-add-a-react-app-to-wordpress-pages-61aee723d607?source=collection_archive---------2-----------------------#2022-01-18">https://javascript.plainenglish.io/how-to-add-a-react-app-to-wordpress-pages-61aee723d607?source=collection_archive---------2-----------------------#2022-01-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b8462b00e19650a9a063eb449fde227b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uDSGfpZcPZ80e5qTaT8NgQ.jpeg"/></div></div></figure><p id="632e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有时，在WordPress页面中嵌入一个React应用程序可能是有用的(多步调查、天气应用程序、预订系统、外部数据源，例子数不胜数)。这是完全可行的，但是由于WordPress中的React实现，这可能会比较棘手。</p><p id="bce2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从版本5(古腾堡的出现)开始，WordPress包含了React，并允许开发者通过抽象层访问它(<em class="kw"> wp.element </em>细节及其存在的理由可以在<a class="ae kx" href="https://github.com/WordPress/gutenberg/tree/trunk/packages/element" rel="noopener ugc nofollow" target="_blank">这里</a>找到)，当你在WordPress内部开发React应用程序时，你需要引用那个包装器来让它平稳运行。</p><p id="c9e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将尝试指导你如何在WordPress站点中包含一个React页面，将它添加到模板中，或者使用插件/短代码方法。</p><h2 id="3182" class="ky kz iq bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">先决条件</h2><p id="1726" class="pw-post-body-paragraph jy jz iq ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">要跟进，您至少需要:</p><ul class=""><li id="da86" class="lw lx iq ka b kb kc kf kg kj ly kn lz kr ma kv mb mc md me bi translated">本地WordPress安装</li><li id="f1a8" class="lw lx iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">对自定义模板、插件开发、主题定制等WordPress概念有基本到中等的理解</li><li id="8da4" class="lw lx iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">React和JS的基础知识</li><li id="549e" class="lw lx iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">节点包管理、脚本、网络包的基本知识</li></ul><h2 id="0c87" class="ky kz iq bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">基础知识</h2><p id="b84f" class="pw-post-body-paragraph jy jz iq ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">如前所述，WordPress提供了一个我们可以使用的React抽象层和一个允许我们简单直接集成的包(<a class="ae kx" href="https://developer.wordpress.org/block-editor/reference-guides/packages/packages-scripts/" rel="noopener ugc nofollow" target="_blank"> @wordpress/scripts </a>)。</p><p id="3a47" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">抽象层已经包含了<code class="fe mk ml mm mn b">React, ReactDom, useEffect…</code>等等，所以如果你正确地使用了<em class="kw"> wp.element </em>，你就不需要在你的应用中导入它们</p><p id="a5c1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，节点包将包含以WordPress将正确使用的方式构建应用程序所需的所有脚本(例如在一个文件中)。</p><h2 id="f8d8" class="ky kz iq bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">方法</h2><p id="cc20" class="pw-post-body-paragraph jy jz iq ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">在WordPress页面中包含React应用程序有很多方法，我将详细介绍我目前使用的两种方法:</p><ul class=""><li id="30d4" class="lw lx iq ka b kb kc kf kg kj ly kn lz kr ma kv mb mc md me bi translated">基于模板:我们将在我们的主题中包含我们的react应用程序，我们将使用<code class="fe mk ml mm mn b">function.php</code>添加它。如果你需要你的应用在站点范围内运行(例如在页眉或页脚)，或者如果你在一个定制的页面模板内运行它，这种方法是有用的。</li><li id="1245" class="lw lx iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">Plugin/shortcode:我们将构建一个(基本)插件，该插件公开一个将呈现React应用程序的shortcode。如果你需要你的应用程序在更多的页面或帖子上运行，并且你需要更多的灵活性(例如定位)，可以使用这种方法</li></ul><h2 id="4cc1" class="ky kz iq bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">模板方法</h2><p id="f90e" class="pw-post-body-paragraph jy jz iq ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">首先，你需要移动到你的主模板文件夹，使用下面的命令设置一个<code class="fe mk ml mm mn b">package.json</code> fille:</p><pre class="mo mp mq mr gt ms mn mt mu aw mv bi"><span id="cacf" class="ky kz iq mn b gy mw mx l my mz">npm init</span></pre><p id="4fd1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完成后，您可以使用以下命令安装WP脚本:</p><pre class="mo mp mq mr gt ms mn mt mu aw mv bi"><span id="193f" class="ky kz iq mn b gy mw mx l my mz">npm install @wordpress/scripts --save-dev</span></pre><p id="adfe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当模块安装好后，我们可以将构建/编译脚本添加到<code class="fe mk ml mm mn b">package.json</code>文件中。<br/>打开package.json并将以下内容添加到脚本部分(稍后我们将看到如何使用这些脚本:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="e451" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你需要的最后一件事，仍然在你的主题文件夹中，是添加一个WordPress兼容的webpack配置文件<code class="fe mk ml mm mn b">webpack.config.js</code>:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="6245" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在准备开始编写React应用程序，在你的主题目录中创建一个<code class="fe mk ml mm mn b">src</code>文件夹，并添加<code class="fe mk ml mm mn b">App.js</code>和<code class="fe mk ml mm mn b">index.js</code>文件</p><p id="4058" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在index.js中，我们使用不是从ReactDom导入的render方法，但是我们从<em class="kw"> wp.element </em>中获得它，剩下的是基本的React，我们导入应用程序，并在id为‘my-React-App’的元素中呈现它</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="b701" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在App.js中，我们编写我们的主要React应用程序，不要忘记，如果您需要React或ReactDOM中的某些内容，您不需要导入它，但是它可以从<em class="kw"> wp.element、</em>中获得，例如，如果您需要<code class="fe mk ml mm mn b">useEffect</code>或<code class="fe mk ml mm mn b">useState</code>，您只需使用:</p><pre class="mo mp mq mr gt ms mn mt mu aw mv bi"><span id="16d7" class="ky kz iq mn b gy mw mx l my mz">const {useState, useEffect} wp.element</span></pre><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="5ba1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在准备在WordPress页面上显示我们的最小应用程序。<br/>我们现在将使用以下命令编译它:</p><pre class="mo mp mq mr gt ms mn mt mu aw mv bi"><span id="ad3e" class="ky kz iq mn b gy mw mx l my mz">npm run build</span></pre><p id="3833" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将在一个index.js文件中构建我们的应用程序，该文件将放在<code class="fe mk ml mm mn b">build</code>文件夹中，这样我们就可以通过以下方式将其从<code class="fe mk ml mm mn b">function.php</code>中排队:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="79dc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不要忘记['wp-element']部分，它是一个Javascript依赖项，表示您将需要为前端做出反应。</p><p id="45f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后一点是修改页面(或帖子，或页眉，或页脚)模板，以包含以下代码:</p><pre class="mo mp mq mr gt ms mn mt mu aw mv bi"><span id="7fb3" class="ky kz iq mn b gy mw mx l my mz">&lt;div id="my-react-app"&gt;&lt;/div&gt;</span></pre><p id="4f1c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您希望React应用程序显示的位置。</p><p id="f5b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">开发而不重建<br/> </strong>在开发期间，为每次更改重建应用程序可能会很繁琐，因此您将使用以下脚本:</p><pre class="mo mp mq mr gt ms mn mt mu aw mv bi"><span id="4228" class="ky kz iq mn b gy mw mx l my mz">npm run start</span></pre><p id="a702" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它会不断检查您的<code class="fe mk ml mm mn b">src</code>文件夹中的更改，并根据保存的更改重建应用程序，这样您就不需要不断地重建应用程序。</p><h2 id="7508" class="ky kz iq bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">插件/短代码方法</h2><p id="4caf" class="pw-post-body-paragraph jy jz iq ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">使用这种方法，我们将构建一个暴露短代码的基本插件，React应用程序将在找到短代码的地方呈现。<br/>首先，你需要创建并激活一个框架插件:<br/>移动到你的插件文件夹并创建一个目录(例如<code class="fe mk ml mm mn b">reactplug</code>)，在该目录下，创建一个文件<code class="fe mk ml mm mn b">reactplug.php</code>并填充插件的基本信息:</p><pre class="mo mp mq mr gt ms mn mt mu aw mv bi"><span id="d61e" class="ky kz iq mn b gy mw mx l my mz">&lt;?php</span><span id="72aa" class="ky kz iq mn b gy nc mx l my mz">/**<br/>* Plugin.<br/>*<br/>* @package reactplug<br/>* @wordpress-plugin<br/>*<br/>* Plugin Name:     React in WP<br/>* Description:     Add React app via shortcode<br/>* Author:          popeating<br/>* Author URL:      <a class="ae kx" href="https://mikhailroot.ru" rel="noopener ugc nofollow" target="_blank">https://</a>popland.it<br/>* Version:         1.0<br/>*/<br/>/**</span></pre><p id="73cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后像在模板部分那样设置环境，这次在你的插件文件夹init <code class="fe mk ml mm mn b">package.json</code>上工作，安装WP脚本，添加脚本部分，创建<code class="fe mk ml mm mn b">webpack.config.js</code>文件，在新创建的<code class="fe mk ml mm mn b">src</code>文件夹中添加App.js和index.js文件，用<code class="fe mk ml mm mn b">npm run build</code>构建脚本</p><p id="a30f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，回到你的插件文件，添加一些基本的功能，为WordPress添加一个短代码，并让脚本入队:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="48bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">像以前一样，我们将脚本(及其wp-element依赖项)入队，并注册一个新的短代码，它将呈现<code class="fe mk ml mm mn b">&lt;div id="my-react-app"&gt;&lt;/div&gt;</code>，这是我们React应用程序的入口点。</p><p id="c70d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您可以在希望React应用程序呈现的页面(或帖子)上使用短代码。</p><p id="8b0b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如前所述，在开发期间，您可以使用</p><pre class="mo mp mq mr gt ms mn mt mu aw mv bi"><span id="6680" class="ky kz iq mn b gy mw mx l my mz">npm run start</span></pre><p id="28c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据变化自动构建应用程序。</p><h2 id="b7b5" class="ky kz iq bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">下一步是什么</h2><p id="5a31" class="pw-post-body-paragraph jy jz iq ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">这里有很多可以改进的地方，例如，脚本可以有条件地加载(只在特定的文章类型上加载，或者如果一个页面有特定的名称或模板)。您可以通过短代码将数据传递给React应用程序。同样使用这种模式，您可以将短代码转换成可以在侧栏或页脚中使用的小部件。</p><p id="3e45" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">更多内容看</em> <a class="ae kx" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="kw">说白了就是io </em> </strong> </a> <em class="kw">。报名参加我们的</em> <a class="ae kx" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="kw">免费周报</em> </strong> </a> <em class="kw">。在我们的</em> <a class="ae kx" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="kw">社区不和谐</em> </strong> </a> <em class="kw">获得独家获取写作机会和建议。</em></p></div></div>    
</body>
</html>