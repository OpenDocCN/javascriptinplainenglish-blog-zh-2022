<html>
<head>
<title>The Basics of E2E Testing and Integrating Cypress with Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">E2E测试和集成Cypress与Next.js的基础</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-basics-of-e2e-testing-and-integrating-cypress-with-next-js-4010160b6c9e?source=collection_archive---------10-----------------------#2022-02-28">https://javascript.plainenglish.io/the-basics-of-e2e-testing-and-integrating-cypress-with-next-js-4010160b6c9e?source=collection_archive---------10-----------------------#2022-02-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/81ccd8f0ddd748d030b881bbd064a58e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OI_G96VOxX949Aohti2unw.png"/></div></div></figure><p id="0b1c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">👋你们好，伙计们！已经有一段时间没发文章了。</p><figure class="kt ku kv kw gt jo"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="ad3c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">作为开发者，我们总是想把最好的产品交付给用户。测试是这个过程中至关重要的一部分。一种常用的测试技术是E2E测试。</p><h1 id="9828" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">💡E2E测试—基础知识</h1><p id="6378" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg lz ki kj kk ma km kn ko mb kq kr ks ig bi translated">端到端测试(或简称为E2E测试)是一种从头到尾测试整个软件产品的技术，以确保应用程序流的行为符合预期。</p><p id="95fa" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">E2E测试的主要目的是模拟真实的用户场景，并根据最终用户的体验进行测试。</p><h2 id="6453" class="mc la in bd lb md me dn lf mf mg dp lj kg mh mi ln kk mj mk lr ko ml mm lv mn bi translated">📃E2E测试的优势</h2><ul class=""><li id="805f" class="mo mp in jx b jy lx kc ly kg mq kk mr ko ms ks mt mu mv mw bi translated">降低风险</li><li id="3596" class="mo mp in jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">增强信心</li><li id="37ef" class="mo mp in jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">降低的价格</li></ul><h1 id="952d" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">⚡ E2E测试方法</h1><h2 id="7f48" class="mc la in bd lb md me dn lf mf mg dp lj kg mh mi ln kk mj mk lr ko ml mm lv mn bi translated">水平E2E测试</h2><p id="7fca" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg lz ki kj kk ma km kn ko mb kq kr ks ig bi translated">水平测试是从最终用户的角度进行的。它评估用户是否能够导航软件并正确使用其功能。它还有助于检测可能阻止用户使用某些软件功能的错误。</p><h2 id="4330" class="mc la in bd lb md me dn lf mf mg dp lj kg mh mi ln kk mj mk lr ko ml mm lv mn bi translated">垂直E2E测试</h2><p id="39da" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg lz ki kj kk ma km kn ko mb kq kr ks ig bi translated">这种方法指的是分层测试，也就是说测试是以连续的、层次化的顺序进行的。系统的每个子组件从头到尾都经过测试，以确保质量。</p><p id="a113" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当系统没有用户界面或者用户界面有很高的技术性并且用于测试关键组件时，通常会这样做。</p><h1 id="5ef6" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">❓如何进行E2E测试？</h1><ul class=""><li id="786e" class="mo mp in jx b jy lx kc ly kg mq kk mr ko ms ks mt mu mv mw bi translated">分析所有需求。对应用程序应该做什么有一个清晰的想法。</li><li id="f1e4" class="mo mp in jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">根据要求设置测试环境。</li><li id="0c77" class="mo mp in jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">列出测试这些反应所需的所有测试方法。</li><li id="c6af" class="mo mp in jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">设计测试用例。</li><li id="629a" class="mo mp in jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">运行测试并记录结果。</li></ul><h1 id="0eca" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">⚡ E2E测试框架</h1><p id="4bbf" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg lz ki kj kk ma km kn ko mb kq kr ks ig bi translated">E2E测试框架用于确保应用程序中的所有活动部分都配置正确。</p><p id="3965" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以下是一些最受欢迎的:</p><ul class=""><li id="d3f8" class="mo mp in jx b jy jz kc kd kg nc kk nd ko ne ks mt mu mv mw bi translated">硒</li><li id="7624" class="mo mp in jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">柏树</li><li id="a1e4" class="mo mp in jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">黄瓜</li><li id="37d0" class="mo mp in jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">Testim</li></ul><p id="caa6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在您已经熟悉了E2E测试的基本概念，让我们看看如何在Next.js中使用Cypress集成E2E测试..</p><h1 id="b2d2" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">👨‍💻集成Cypress和Next.js进行E2E测试</h1><p id="30c0" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg lz ki kj kk ma km kn ko mb kq kr ks ig bi translated">现在您已经熟悉了E2E测试的基础，让我们看看如何在Next.js中开始使用Cypress</p><p id="097f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> Next.js </strong></p><p id="4e51" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您不熟悉Next.js，它是一个React框架，包含一些额外的功能来帮助开发人员和客户。</p><p id="bca4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">柏树</strong></p><p id="dc0f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">赛普拉斯是E2E网络测试的测试员。</p><h2 id="1ac3" class="mc la in bd lb md me dn lf mf mg dp lj kg mh mi ln kk mj mk lr ko ml mm lv mn bi translated">设置项目</h2><p id="604b" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg lz ki kj kk ma km kn ko mb kq kr ks ig bi translated">你可以用“创建下一个应用”和“cypress”例子来快速开始。</p><pre class="kt ku kv kw gt nf ng nh ni aw nj bi"><span id="b773" class="mc la in ng b gy nk nl l nm nn">npx create-next-app@latest — example with-cypress with-cypress-app </span></pre><p id="c9bf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于现有的项目，您可以从安装“cypress”包开始。</p><pre class="kt ku kv kw gt nf ng nh ni aw nj bi"><span id="2451" class="mc la in ng b gy nk nl l nm nn">npm install — save-dev cypress</span></pre><p id="b5d0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，将Cypress添加到“package.json”文件的“scripts”部分。</p><pre class="kt ku kv kw gt nf ng nh ni aw nj bi"><span id="0ba5" class="mc la in ng b gy nk nl l nm nn">// package.json<br/>“scripts”: {<br/> “dev”: “next dev”,<br/> “build”: “next build”,<br/> “start”: “next start”,<br/> “cypress”: “cypress open”,<br/>}</span></pre><p id="726a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，运行Cypress来生成使用推荐的文件夹结构的例子。</p><pre class="kt ku kv kw gt nf ng nh ni aw nj bi"><span id="7e56" class="mc la in ng b gy nk nl l nm nn">npm run cypress</span></pre><h2 id="4a53" class="mc la in bd lb md me dn lf mf mg dp lj kg mh mi ln kk mj mk lr ko ml mm lv mn bi translated">创建您的第一个Cypress集成测试</h2><p id="eaa1" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg lz ki kj kk ma km kn ko mb kq kr ks ig bi translated">假设您有两页:</p><pre class="kt ku kv kw gt nf ng nh ni aw nj bi"><span id="0cb2" class="mc la in ng b gy nk nl l nm nn">// pages/index.js</span><span id="39ef" class="mc la in ng b gy no nl l nm nn">import Link from ‘next/link’</span><span id="248a" class="mc la in ng b gy no nl l nm nn">export default function Home() {<br/> return (<br/> &lt;nav&gt;<br/> &lt;Link href=”/about”&gt;<br/> &lt;a&gt;About&lt;/a&gt;<br/> &lt;/Link&gt;<br/> &lt;/nav&gt;<br/> )<br/>}<br/>```</span><span id="cfbf" class="mc la in ng b gy no nl l nm nn">```jsx<br/>// pages/about.js<br/>export default function About() {<br/> return (<br/> &lt;div&gt;<br/> &lt;h1&gt;About Page&lt;/h1&gt;<br/> &lt;/div&gt;<br/> )<br/>}<br/>```</span></pre><p id="03d8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，为了测试您的导航是否正常工作:</p><pre class="kt ku kv kw gt nf ng nh ni aw nj bi"><span id="7b66" class="mc la in ng b gy nk nl l nm nn">// cypress/integration/app.spec.js</span><span id="8e33" class="mc la in ng b gy no nl l nm nn">describe(‘Navigation’, () =&gt; {<br/> it(‘should navigate to the about page’, () =&gt; {<br/> // Start from the index page<br/> cy.visit(‘<a class="ae np" href="http://localhost:3000/'" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/'</a>)</span><span id="b70a" class="mc la in ng b gy no nl l nm nn">// Find a link with an href attribute containing “about” and click it<br/> cy.get(‘a[href*=”about”]’).click()</span><span id="f7fb" class="mc la in ng b gy no nl l nm nn">// The new url should include “/about”<br/> cy.url().should(‘include’, ‘/about’)</span><span id="ebb9" class="mc la in ng b gy no nl l nm nn">// The new page should contain an h1 with “About page”<br/> cy.get(‘h1’).contains(‘About Page’)<br/> })<br/>})</span></pre><p id="9505" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">提示</strong>:不用做<strong class="jx io"><em class="nq">` cy . visit(</em></strong><a class="ae np" href="http://localhost:3000/')`" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="nq">http://localhost:3000/')`</em></strong></a>，只要把<strong class="jx io"> <em class="nq"> `baseUrl` </em> </strong>设为<strong class="jx io"> <em class="nq"> ` </em> </strong>就可以了</p><pre class="kt ku kv kw gt nf ng nh ni aw nj bi"><span id="d529" class="mc la in ng b gy nk nl l nm nn">// cypress.json </span><span id="718f" class="mc la in ng b gy no nl l nm nn">{<br/> “baseUrl”: “<a class="ae np" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a>"<br/>}</span></pre><p id="ef89" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">至此，您将拥有一个简单的测试设置。因为cypress正在测试一个真正的Next.js应用程序，所以它要求在启动Cypress之前运行Next.js服务器。</p><p id="393b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先运行<code class="fe nr ns nt ng b">npm run build</code>和<code class="fe nr ns nt ng b">npm run start</code>；然后，在另一个终端窗口运行<code class="fe nr ns nt ng b">npm run cypress</code>来启动Cypress。</p><p id="d79b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，cypress将启动，您可以查看结果。</p><h2 id="cada" class="mc la in bd lb md me dn lf mf mg dp lj kg mh mi ln kk mj mk lr ko ml mm lv mn bi translated">持续集成(CI)的进一步步骤</h2><p id="3014" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg lz ki kj kk ma km kn ko mb kq kr ks ig bi translated">此时，您可能已经注意到，到目前为止运行Cypress已经打开了一个交互式浏览器，这对于CI环境来说并不理想。</p><p id="1625" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以使用<code class="fe nr ns nt ng b">cypress run</code>命令运行Cypress。</p><p id="3564" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在<strong class="jx io"><em class="nq">` package . JSON `</em></strong>文件中:</p><pre class="kt ku kv kw gt nf ng nh ni aw nj bi"><span id="4e70" class="mc la in ng b gy nk nl l nm nn">// package.json</span><span id="94ac" class="mc la in ng b gy no nl l nm nn">“scripts”: {<br/> // …<br/> “cypress”: “cypress open”,<br/> “cypress:headless”: “cypress run”<br/>}</span></pre><p id="dfba" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本文到此为止！你可以在这里放下一些反应来表示你的支持！</p><p id="a906" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">关于作者</strong></p><ul class=""><li id="7a1b" class="mo mp in jx b jy jz kc kd kg nc kk nd ko ne ks mt mu mv mw bi translated"><a class="ae np" href="https://anurag.tech" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">投资组合</strong> </a></li><li id="bbc4" class="mo mp in jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated"><a class="ae np" href="https://blog.anurag.tech" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">博客</strong> </a></li></ul><p id="1469" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nq">更多内容请看</em><a class="ae np" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="nq">plain English . io</em></strong></a><em class="nq">。报名参加我们的</em> <a class="ae np" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="nq">免费周报</em> </strong> </a> <em class="nq">。关注我们关于</em><a class="ae np" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="nq">Twitter</em></strong></a><em class="nq">和</em><a class="ae np" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="nq">LinkedIn</em></strong></a><em class="nq">。加入我们的</em> <a class="ae np" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="nq">社区不和谐</em> </strong> </a> <em class="nq">。</em></p></div></div>    
</body>
</html>