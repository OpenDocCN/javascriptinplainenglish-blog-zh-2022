<html>
<head>
<title>How to Convert JSON to CSV in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用JavaScript将JSON转换成CSV</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-convert-json-to-csv-312e7503ce5d?source=collection_archive---------7-----------------------#2022-09-01">https://javascript.plainenglish.io/javascript-convert-json-to-csv-312e7503ce5d?source=collection_archive---------7-----------------------#2022-09-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/6587a8de65396b2533e0d7d450cfc6fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a16q9AzDzsrZdrxjY-lH8g.png"/></div></div></figure><p id="6d11" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是我们如何用JavaScript轻松地将JSON转换成CSV:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="223d" class="lc ld in ky b gy le lf l lg lh">function jsonToCsv(items) {<br/>  const header = Object.keys(items[0]);</span><span id="1c19" class="lc ld in ky b gy li lf l lg lh">  const headerString = header.join(',');</span><span id="98bf" class="lc ld in ky b gy li lf l lg lh">  // handle null or undefined values here<br/>  const replacer = (key, value) =&gt; value ?? '';</span><span id="8ac3" class="lc ld in ky b gy li lf l lg lh">  const rowItems = items.map((row) =&gt;<br/>    header<br/>      .map((fieldName) =&gt; JSON.stringify(row[fieldName], replacer))<br/>      .join(',')<br/>  );</span><span id="b4c2" class="lc ld in ky b gy li lf l lg lh">  // join header and body, and break into separate lines<br/>  const csv = [headerString, ...rowItems].join('\r\n');</span><span id="a5f9" class="lc ld in ky b gy li lf l lg lh">  return csv;<br/>}</span><span id="f787" class="lc ld in ky b gy li lf l lg lh">const obj = [<br/>  { color: 'red', maxSpeed: 120, age: 2 },<br/>  { color: 'blue', maxSpeed: 100, age: 3 },<br/>  { color: 'green', maxSpeed: 130, age: 2 },<br/>];</span><span id="4e62" class="lc ld in ky b gy li lf l lg lh">const csv = jsonToCsv(obj);</span><span id="c120" class="lc ld in ky b gy li lf l lg lh">console.log(csv);</span></pre><p id="a3b4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这将是CSV输出:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="d153" class="lc ld in ky b gy le lf l lg lh">color,maxSpeed,age<br/>"red",120,2<br/>"blue",100,3<br/>"green",130,2</span></pre><h1 id="625e" class="lj ld in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">了解步骤</h1><p id="ef07" class="pw-post-body-paragraph jv jw in jx b jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko mk kq kr ks ig bi translated">我们创建了一个可重用的<code class="fe ml mm mn ky b">jsonToCsv()</code>函数，让我们将多个JSON字符串转换成CSV。它接受一个包含对象的数组。每个对象将在CSV输出中占据一行。</p><p id="a6c6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们在这个函数中做的第一件事是获取将用于CSV头的所有键。我们希望数组中的所有对象都有相同的键，所以我们使用<a class="ae mo" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys" rel="noopener ugc nofollow" target="_blank"> Object.keys() </a>方法将第一个对象项中的键提取到一个数组中。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="d392" class="lc ld in ky b gy le lf l lg lh">const obj = [<br/>  { color: 'red', maxSpeed: 120, age: 2 },<br/>  { color: 'blue', maxSpeed: 100, age: 3 },<br/>  { color: 'green', maxSpeed: 130, age: 2 },<br/>];</span><span id="6ce2" class="lc ld in ky b gy li lf l lg lh">// { color: 'red', maxSpeed: 120, age: 2 }<br/>console.log(obj[0]);</span><span id="26a0" class="lc ld in ky b gy li lf l lg lh">// [ 'color', 'maxSpeed', 'age' ]<br/>console.log(Object.keys(obj[0]));</span></pre><p id="4fb6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">得到键后，我们调用数组上的<a class="ae mo" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join" rel="noopener ugc nofollow" target="_blank"> join() </a>方法将所有元素连接成一个CSV头字符串。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="d89e" class="lc ld in ky b gy le lf l lg lh">const header = ['color', 'maxSpeed', 'age'];</span><span id="1f9e" class="lc ld in ky b gy li lf l lg lh">const headerString = arr.join(',');</span><span id="4c8c" class="lc ld in ky b gy li lf l lg lh">console.log(headerString); // color,maxSpeed,age</span></pre><p id="8922" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我们创建一个函数，它将作为回调传递给<a class="ae mo" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify" rel="noopener ugc nofollow" target="_blank"> JSON.stringify() </a>函数的<a class="ae mo" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#the_replacer_parameter" rel="noopener ugc nofollow" target="_blank"> replacer </a>参数。这个函数将处理JSON数组中对象的<code class="fe ml mm mn ky b">undefined</code>或<code class="fe ml mm mn ky b">null</code>属性值。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="f420" class="lc ld in ky b gy le lf l lg lh">const obj = { prop1: 'Earth', prop2: undefined };</span><span id="43af" class="lc ld in ky b gy li lf l lg lh">// replace undefined property values with empty string ('')<br/>const replacer = (key, value) =&gt; value ?? '';</span><span id="86a5" class="lc ld in ky b gy li lf l lg lh">const str = JSON.stringify(obj, replacer);</span><span id="2c60" class="lc ld in ky b gy li lf l lg lh">// {"prop1":"Earth","prop2":""}<br/>console.log(str);</span></pre><p id="e8ab" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后我们使用<a class="ae mo" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map" rel="noopener ugc nofollow" target="_blank"> Array map() </a>方法从每个对象中获取属性值。<code class="fe ml mm mn ky b">map()</code>采用在每个数组元素上调用的回调函数来返回转换。</p><p id="104a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个回调使用<code class="fe ml mm mn ky b">header</code>数组来获取每个对象的所有键。通过对<code class="fe ml mm mn ky b">map()</code>的另一个调用，它遍历每个键，获取该键在对象中的对应值，并使用<a class="ae mo" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify" rel="noopener ugc nofollow" target="_blank"> JSON.stringify() </a>将其转换为字符串。</p><p id="b399" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个对<code class="fe ml mm mn ky b">map()</code>的内部调用最终产生一个数组，其中包含当前对象的所有字符串化属性值。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="a663" class="lc ld in ky b gy le lf l lg lh">const header = ['color', 'maxSpeed', 'age'];</span><span id="fe10" class="lc ld in ky b gy li lf l lg lh">const row = { color: 'red', maxSpeed: 120, age: 2 };</span><span id="8baf" class="lc ld in ky b gy li lf l lg lh">const replacer = (key, value) =&gt; value ?? '';</span><span id="4766" class="lc ld in ky b gy li lf l lg lh">const rowItem = header.map((fieldName) =&gt;<br/>  JSON.stringify(row[fieldName], replacer)<br/>);</span><span id="3318" class="lc ld in ky b gy li lf l lg lh">// array of stringified property values<br/>console.log(rowItem); // [ '"red"', '120', '2' ]</span></pre><p id="d916" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将对象转换成属性值数组后，使用<a class="ae mo" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join" rel="noopener ugc nofollow" target="_blank"> join() </a>将数组转换成CSV行。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="5874" class="lc ld in ky b gy le lf l lg lh">['"red"', '120', '2'].join(',') // -&gt; "red",120,2</span></pre><p id="5454" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，JSON数组中的每个对象都会发生这种转换，从而生成一个CSV行列表，存储在我们最初示例中的<code class="fe ml mm mn ky b">rowItems</code>变量中。</p><p id="2a4f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了生成最终的CSV输出，我们利用<a class="ae mo" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax" rel="noopener ugc nofollow" target="_blank">扩展语法</a> ( <code class="fe ml mm mn ky b">...</code>)将<code class="fe ml mm mn ky b">headerString</code>和<code class="fe ml mm mn ky b">rowItems</code>组合成一个数组。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="f896" class="lc ld in ky b gy le lf l lg lh">const headerString = ['color', 'maxSpeed', 'age'];</span><span id="f4f9" class="lc ld in ky b gy li lf l lg lh">const rowItems = ['"red",120,2', '"blue",100,3', '"green",130,2'];</span><span id="ebee" class="lc ld in ky b gy li lf l lg lh">[headerString, ...rowItems];<br/>/*<br/>Output -&gt;<br/>[<br/>  [ 'color', 'maxSpeed', 'age' ],<br/>  '"red",120,2',<br/>  '"blue",100,3',<br/>  '"green",130,2'<br/>]<br/> */</span></pre><p id="0f75" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后我们在这个数组上调用<a class="ae mo" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join" rel="noopener ugc nofollow" target="_blank"> join() </a>，用<code class="fe ml mm mn ky b">'\r\n'</code>字符串作为分隔符，创建一个字符串，CSV标题和每个CSV行在单独的一行中。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="391c" class="lc ld in ky b gy le lf l lg lh">const headerString = ['color', 'maxSpeed', 'age'];</span><span id="ad60" class="lc ld in ky b gy li lf l lg lh">const rowItems = ['"red",120,2', '"blue",100,3', '"green",130,2'];</span><span id="b2d0" class="lc ld in ky b gy li lf l lg lh">console.log([headerString, ...rowItems].join('\r\n'));<br/>/*<br/>color,maxSpeed,age<br/>"red",120,2<br/>"blue",100,3<br/>"green",130,2<br/> */</span></pre></div><div class="ab cl mp mq hr mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ig ih ii ij ik"><p id="0e09" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mw">原载于</em><a class="ae mo" href="https://cbdev.link/89c712" rel="noopener ugc nofollow" target="_blank"><em class="mw">codingbeautydev.com</em></a></p><h1 id="8122" class="lj ld in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">JavaScript做的每一件疯狂的事情</h1><p id="e18c" class="pw-post-body-paragraph jv jw in jx b jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko mk kq kr ks ig bi translated">一本关于JavaScript微妙的警告和鲜为人知的部分的迷人指南。</p><figure class="kt ku kv kw gt jo gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/143ee152ba78025ea8643ba5b9726a20.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*YS5Oub8REWy8vnOEqBnsyQ.png"/></div></figure><p id="7d6e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae mo" href="https://cbdev.link/d3c4eb" rel="noopener ugc nofollow" target="_blank">报名</a>立即免费领取一份。</p></div></div>    
</body>
</html>