# 为什么不应该使用带输入的角形管道

> 原文：<https://javascript.plainenglish.io/why-you-shouldnt-use-angular-pipes-with-inputs-8dc1d0e9039d?source=collection_archive---------0----------------------->

## 用户输入时设置输入格式的正确方法。

![](img/4e1180726672ccf610942cfe68d2f517.png)

# 问题是

问题很简单:我有一个输入用户电话号码的表单。我想在用户键入时设置电话号码的格式。管道显然是首选。毕竟，文件上说:

> 使用[管道](https://angular.io/guide/glossary#pipe)来转换字符串、货币金额、日期和其他显示数据。

所以我用一些正则表达式创建了一个简单的管道，并将其插入到我的输入中。我的管道的转换函数看起来像这样:

我的 HTML 看起来像这样:

```
<input *type=*"tel" *[(ngModel)]=*"value | phoneInput">
```

但是，此方法会导致错误:“动作表达式中不能有管道。”因为我在 ngModel 上使用双向数据绑定，所以我基本上是在尝试格式化输入而不是输出。

很公平。接下来，我尝试拆分 ngModel，以便我可以只在输出上使用管道，如下所示:

```
<input *type=*"tel" *[ngModel]=*"value | phoneInput (ngModelChange)="value = $event">
```

现在，反射的“值”应该由 phoneInput 管道格式化显示，同时仍然通过`ngModelChange`绑定。

成功了。差不多了。电话号码的格式应该正确，键入“999”将得到“(999)”，键入“1234567890”将得到“(123)456–7890”，依此类推。但是，如果你试图在正常的 10 位数之后继续输入，问题就来了。

即使我的管道代码用`substr()`函数将输入调整到 10 位数，输出也不会反映出来。键入“1234567890000”将得到“(123)456–7890000”，而不会像预期的那样对其进行修整。但是为什么呢？

经过一番调查，我找到了答案。Angular 有一个精确的顺序来执行管道转换、变化检测等。因为“1234567890”和“1234567890000”的输入都被调整为完全相同的输出，所以没有检测到要显示到输入的更改，因此输入的值不会更改以反映正确的值。

进一步的研究表明，有两种方法可以正确实现我们想要的电话输入屏蔽:**使用角形表单**创建自定义表单组件，或者**通过使用指令**坚持模板驱动模型。由于我正在开发的应用程序并不围绕着形体，我看不出有什么理由要深入到有棱角的形体世界中去。

# 解决方案

模板驱动设计的解决方案非常简单。我们将管道正在执行的功能转换成一个指令，并将该指令附加到输入中。

我的指令是这样的:

转换函数与上面的管道示例完全相同。该指令还有一个 HostListener 来捕获输入上的按键，并相应地更新显示的值。

我的指令肯定有改进的空间，但它完成了工作。更重要的是，它提供了关于管道如何工作以及何时使用指令的有价值的见解。

现在，输入会随着用户的键入而格式化，并且还可以防止超出最大位数的键入。

有燃角问题？给我发一封电子邮件，我可能会写下来。

## **延伸阅读:**

 [## 有角的

### Angular 是一个构建移动和桌面 web 应用程序的平台。加入数百万开发者的社区…

angular.io](https://angular.io/guide/pipes)  [## 有角的

### Angular 是一个构建移动和桌面 web 应用程序的平台。加入数百万开发者的社区…

angular.io](https://angular.io/guide/forms-overview) 

*更多内容看* [***说白了。报名参加我们的***](http://plainenglish.io/) **[***免费周报***](http://newsletter.plainenglish.io/) *。在我们的* [***社区获得独家访问写作机会和建议***](https://discord.gg/GtDtUAvyhW) *。***