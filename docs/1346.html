<html>
<head>
<title>How to Build REST API with Node.js, Express, and PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Node.js、Express和PostgreSQL构建REST API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/building-rest-api-with-node-express-and-postgresql-28d8cfe30d?source=collection_archive---------0-----------------------#2022-03-18">https://javascript.plainenglish.io/building-rest-api-with-node-express-and-postgresql-28d8cfe30d?source=collection_archive---------0-----------------------#2022-03-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="1924" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用Node.js、Express和PostgreSQL数据库(带TS)为todo应用程序构建REST APIs的简单分步指南。</h2></div><p id="455e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是很长一段时间以来，我第一次切换到关系数据库，比如我们将在这里使用的PostgreSQL，以将其用于我的任何API或项目。自从我开始使用MongoDB以来，我从未真正回顾过使用关系数据库，直到现在。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/cce881561b902fe5ea84a0cd19f36f76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nWIdUcT_H8UnN9zbVzSXKw.png"/></div></div></figure><h1 id="16d7" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">飞行前检查😅</h1><p id="ecd5" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">在我们写任何代码之前，有几件事我想问你，关于我们将要做的这个迷你项目。</p><ol class=""><li id="73b8" class="mh mi in ke b kf kg ki kj kl mj kp mk kt ml kx mm mn mo mp bi translated">你熟悉TypeScript吗，也就是说，你现在正在使用它，或者过去曾经使用过它？</li><li id="5f5a" class="mh mi in ke b kf mq ki mr kl ms kp mt kt mu kx mm mn mo mp bi translated">您是否已经在您的机器上安装了PostgreSQL，并且有一个正在运行的数据库实例，为工作做好了准备？</li><li id="760d" class="mh mi in ke b kf mq ki mr kl ms kp mt kt mu kx mm mn mo mp bi translated">你熟悉SQL数据库吗？</li></ol><p id="9b07" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你对所有问题的回答都是肯定的，或者甚至是两个问题，或者，也许你已经开始着手做了，但是你对所有三个问题的回答都是否定的，没关系，让我们开始吧🚀。</p><h1 id="b016" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">我们的目标是什么？</h1><p id="66e4" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">想法是——制作一个简单的todo应用程序，让用户创建、编辑、删除和查看他们的任务。为了实现所有这些功能，我们的应用程序将通过REST APIs与后端进行通信。后端将是一个Node.js/Express应用程序，与PostgreSQL数据库。</p></div><div class="ab cl mv mw hr mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ig ih ii ij ik"><p id="3f1f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们已经了解了我们正在构建什么，让我们开始吧，一步一步来。一如既往，本文的最终代码将在我的GitHub上提供。</p><div class="nc nd gp gr ne nf"><a href="https://github.com/the-devdesigner/pern-todo-app.git" rel="noopener  ugc nofollow" target="_blank"><div class="ng ab fo"><div class="nh ab ni cl cj nj"><h2 class="bd io gy z fp nk fr fs nl fu fw im bi translated">GitHub-the-dev designer/pern-todo-app:我的文章在Medium上的支持库。环👇</h2><div class="nm l"><h3 class="bd b gy z fp nk fr fs nl fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nn l"><p class="bd b dl z fp nk fr fs nl fu fw dk translated">github.com</p></div></div><div class="no l"><div class="np l nq nr ns no nt li nf"/></div></div></a></div><h1 id="7595" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">目录结构</h1><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nu"><img src="../Images/add53b22cd9e3d7c487592c16d1f6f7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YkDJrhI_R9pYQ1quOBwgbA.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk">The directory structure for the project</figcaption></figure><p id="05e6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如我之前提到的，这个应用程序的UI不是本文的一部分，但是你在上面看到的<code class="fe nz oa ob oc b">client</code>文件夹是我如何将服务器端和客户端代码分开的。</p><h1 id="f83b" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">初始化一切</h1><ul class=""><li id="3722" class="mh mi in ke b kf mc ki md kl od kp oe kt of kx og mn mo mp bi translated">就在每个节点项目开始的时候，运行<code class="fe nz oa ob oc b">npm init -y</code>生成package.json文件，</li><li id="6232" class="mh mi in ke b kf mq ki mr kl ms kp mt kt mu kx og mn mo mp bi translated">一旦完成，我们就可以获得所有需要的依赖项。因为我们在这里使用了TypeScript，所以我们还需要所有依赖项的<code class="fe nz oa ob oc b">@types</code>。</li></ul><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi oh"><img src="../Images/2f59d88ecbace7290dd21a12f21304ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SqpI11-ypu8UuaqiX7EX0Q.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk">Installing dependencies with npm</figcaption></figure><ul class=""><li id="a4d2" class="mh mi in ke b kf kg ki kj kl mj kp mk kt ml kx og mn mo mp bi translated">继续在<code class="fe nz oa ob oc b">package.json</code>中添加下面的脚本，让我们的生活变得简单一点。</li></ul><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi oi"><img src="../Images/68d962b719c409f30044aaabd73e4159.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wnX4-WBhnVnYgweGLZmVsg.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk">npm scripts, mainly just for development</figcaption></figure><ul class=""><li id="0026" class="mh mi in ke b kf kg ki kj kl mj kp mk kt ml kx og mn mo mp bi translated">运行<code class="fe nz oa ob oc b">tsc --init</code>初始化并生成一个<code class="fe nz oa ob oc b">tsconfig.json</code>文件。我把我的保持成这样，但是你总是能以你想要的方式定制它。</li></ul><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nu"><img src="../Images/e488421f482dcfa476db9c831ce5cf75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NW8yVNDYlTAmChig1XOB4A.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk">tsconfig.json</figcaption></figure><h1 id="61f6" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">引入Postgres🐘</h1><p id="8c96" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">在构建这些API时，确保Postgres的本地实例保持运行。还记得我们把<code class="fe nz oa ob oc b">pg</code>作为依赖项安装的吗？是时候用了。我们将创建一个名为<code class="fe nz oa ob oc b">pool</code>的新对象——您可以随意称呼它——并提供本地数据库的详细信息和要使用的表。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nu"><img src="../Images/48b1ac2a01133197b3f9f2a3d56dd574.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7jXtr5h3KIfwJfqBhj0_lw.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk">database.ts — Creating a pool object to connect local postgres instance with Node/Express server</figcaption></figure><p id="6181" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">需要记住的一点是，这个<code class="fe nz oa ob oc b">pool</code>对象将只能使用一个已存在的数据库，这里我们称之为<code class="fe nz oa ob oc b">perntodo</code>，不像mongoose和MongoDB，它可以被动态创建。如果您还没有创建您的数据库和表格，这些将是我们在整个项目中需要的查询—</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi oj"><img src="../Images/3152c1d2eefe32883d94b393158cd89f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jzP-aD5WahFqQIgj1Rc0OA.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk">List of queries that will be needed to build this API</figcaption></figure><h1 id="ad23" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">回到Express</h1><p id="0475" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">我们需要一个运行的服务器，对吗？现在你当然知道该怎么做了，导入所有与express和cors相关的东西，创建并使用express和cors中间件，并通过监听你选择的一些<code class="fe nz oa ob oc b">PORT</code>来启动服务器——我总是选择<code class="fe nz oa ob oc b">4000</code>作为服务器。你会看到<code class="fe nz oa ob oc b">ToDoRouter</code>被进口和使用；我们一会儿就会讲到那个部分。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ok"><img src="../Images/4e3af1fbc35a872220b0b166328fd707.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GJW5-oZ_gCD2JeQx_wmsgA.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk">server.ts file with all express app setup</figcaption></figure><h2 id="d095" class="ol ll in bd lm om on dn lq oo op dp lu kl oq or lw kp os ot ly kt ou ov ma ow bi translated">每个操作的路线</h2><p id="5426" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">如果您还记得，我们需要实现GET、POST、PUT和DELETE方法，为此我们需要以下路径—</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ok"><img src="../Images/833aed2e435c32f57408b61d350d7d1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*llbF26J4G5z-lqdbCk2Klg.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk">Routes / API endpoints with their corresponding controller functions</figcaption></figure><h2 id="9e1e" class="ol ll in bd lm om on dn lq oo op dp lu kl oq or lw kp os ot ly kt ou ov ma ow bi translated">每条路线的控制器</h2><p id="5be0" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">当用户向任何一个路由发送HTTP请求时，它将使用相应的控制器函数来执行该操作。现在，为了访问我们的Postgres DB，我们最终使用了<code class="fe nz oa ob oc b">pool</code>对象。最终，我们将运行我们之前列出的查询来获得/做我们想要的。我们执行查询的方式是使用<code class="fe nz oa ob oc b">.query()</code>方法— <code class="fe nz oa ob oc b">pool.query("query goes here", [variables go here as array])</code></p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ok"><img src="../Images/454793c2af67b2b79043a42f5a2f5944.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Ac2VFpg_atAtXo_DgLK9Q.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk">Controllers for each operation</figcaption></figure><ol class=""><li id="5e7d" class="mh mi in ke b kf kg ki kj kl mj kp mk kt ml kx mm mn mo mp bi translated">查询<code class="fe nz oa ob oc b">onGetAllTodos</code> — <code class="fe nz oa ob oc b">SELECT * FROM todos</code></li><li id="75d7" class="mh mi in ke b kf mq ki mr kl ms kp mt kt mu kx mm mn mo mp bi translated">查询<code class="fe nz oa ob oc b">onCreateNewTodo</code> — <code class="fe nz oa ob oc b">INSERT INTO todos (description) VALUES($1) RETURNING *</code></li><li id="73b1" class="mh mi in ke b kf mq ki mr kl ms kp mt kt mu kx mm mn mo mp bi translated">查询<code class="fe nz oa ob oc b">onGetTodoById</code> — <code class="fe nz oa ob oc b">SELECT * FROM todos WHERE _id = $1", [id]</code></li><li id="f48d" class="mh mi in ke b kf mq ki mr kl ms kp mt kt mu kx mm mn mo mp bi translated">查询<code class="fe nz oa ob oc b">onUpdateTodoById</code> — <code class="fe nz oa ob oc b"> UPDATE todos SET description = $1 WHERE _id = $2", [desc, id]</code></li><li id="6275" class="mh mi in ke b kf mq ki mr kl ms kp mt kt mu kx mm mn mo mp bi translated">查询<code class="fe nz oa ob oc b">onDeleteTodoById</code> — <code class="fe nz oa ob oc b">DELETE FROM todos WHERE _id = $1", [id]</code></li></ol><h1 id="a956" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">斗牛中的最后一剑🤞</h1><p id="6318" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">一旦我们有了<code class="fe nz oa ob oc b">controllers</code>，每个控制器都附加了一个特定的<code class="fe nz oa ob oc b">route</code>，并且路径被导入并在<code class="fe nz oa ob oc b">server.ts</code>文件中使用，我们就可以开始使用这个API了。为了测试这些端点，你可以使用Postman，或者像我一样，使用一个<code class="fe nz oa ob oc b">.rest</code>文件。</p><h1 id="88b7" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">包扎</h1><p id="c180" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">就这样，我们有了可以由前端使用的API端点——由Node、Express和PostgreSQL DB构成。至此，我们完成了服务器构建——包括整个PERN堆栈，只是还没有反应过来。</p><p id="7a6e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢阅读。我希望你觉得它有用，简单易懂，而且有趣。如果有，一定要看看我的其他文章，我在这些文章中讨论了React、Node.js和TypeScript等主题。</p><p id="b3fc" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">干杯！✌️</p><p id="98f8" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ox">更多内容请看</em><a class="ae oy" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="ox">plain English . io</em></strong></a><em class="ox">。报名参加我们的</em> <a class="ae oy" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="ox">免费周报</em> </strong> </a> <em class="ox">。关注我们关于</em><a class="ae oy" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="ox">Twitter</em></strong></a><em class="ox">和</em><a class="ae oy" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="ox">LinkedIn</em></strong></a><em class="ox">。加入我们的</em> <a class="ae oy" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="ox">社区不和谐</em> </strong> </a> <em class="ox">。</em></p></div></div>    
</body>
</html>