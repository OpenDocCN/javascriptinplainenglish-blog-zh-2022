<html>
<head>
<title>A Detailed Introduction to JWT Authentication and Authorization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JWT认证和授权的详细介绍</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/introduction-and-detail-about-the-jwt-authentication-and-authorization-5a812e6d154c?source=collection_archive---------1-----------------------#2022-06-26">https://javascript.plainenglish.io/introduction-and-detail-about-the-jwt-authentication-and-authorization-5a812e6d154c?source=collection_archive---------1-----------------------#2022-06-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/c63d0fc6de8c20b4aecd778a5fad82a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*B1Us0XUqxNmtg45h"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@ikukevk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kevin Ku</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="372c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将讨论使用JWT令牌和不同的加密算法和技术的认证和授权。因此，我们将一个接一个地看下面的事情。</p><ul class=""><li id="5408" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">JWT Token简介</li><li id="b2d3" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">为什么是JWT·托肯</li><li id="b015" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">JWT令牌的结构</li><li id="579a" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">使用JWT令牌的客户端-服务器场景</li><li id="eb4d" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">使用JWT刷新令牌的客户端-服务器场景</li></ul><p id="2ef6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们从基础和实时场景开始。</p><p id="b21c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">基本上，JWT用于不同用户的认证和授权。</p><p id="381b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">认证</strong></p><ul class=""><li id="aa60" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">在这个过程中，我们将用户名和密码发送到认证服务器。</li><li id="42d9" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">认证服务器将验证这些凭证，并将它们存储在浏览器会话和Cookies中的某个位置，并将ID发送给最终用户。</li></ul><p id="d312" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">授权</strong></p><ul class=""><li id="8d2f" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">在中，授权我们检查用户在身份验证过程中输入的任何凭据，该用户将使用我们在身份验证过程中存储的凭据授予对资源的访问权限，然后授权该特定用户。</li></ul><p id="3cf2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以，这通常都是关于认证和授权的。</p><p id="233d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">JWT令牌介绍</strong></p><ul class=""><li id="4823" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">JSON Web Token是开放标准(RFC 7519)的自包含方式，它将作为JSON对象在不同的环境中安全地传输数据。</li><li id="7d80" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">RFC(征求意见稿)是远程函数调用的简称，也是互联网工程任务组的正式文档。RFC 7519 JSON Web Token(JWT)2015年5月版权声明版权所有2015 IETF Trust和文档作者。保留所有权利。</li><li id="62a2" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">JWT是可信的身份验证方式，因为它使用HMAC算法进行数字签名和保密，或者有时使用RSA的公钥/私钥。</li><li id="c87d" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">基本上，HMAC代表基于哈希的消息认证码，它使用一些伟大的加密哈希技术，为我们提供了很大的安全性。</li><li id="bd48" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">此外，JWT是OAuth和OpenID等强大的身份验证和授权框架的一部分，这些框架将提供安全传输数据的强大机制。</li></ul><p id="d860" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">为什么JWT令牌</strong></p><ul class=""><li id="f0cd" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">用户将使用JWT令牌进行身份验证，它是一个带有密钥的数字签名，密钥由颁发者颁发。因此，它将用于安全地对用户进行身份验证，并管理索赔，等等。</li><li id="c8ce" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">而不是将用户凭证信息存储在服务器上的某个地方，这样攻击者就可以通过互联网轻松获取这些信息。因此，我们使用JWT，利用它我们用不同的加密算法维护用户秘密，并对其进行编码以认证用户。</li><li id="15c4" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">这就是为什么许多web应用程序使用JWT来安全地认证用户</li></ul><p id="748f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">JWT令牌的结构</strong></p><p id="3006" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">基本上，JSON Web令牌由三部分组成，这三部分用于在令牌中存储用户信息，用点(.)</p><p id="bf4a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">例如–</p><figure class="ln lo lp lq gt jo gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/e1607896eeca03819ed5ed9c31b5cc61.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/0*mzchYOCYnkhj-uuk.png"/></div></figure><figure class="ln lo lp lq gt jo gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/6460c4c68d98cc6839dd65c66c0189fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/0*mSAA4X-aVq5LnJPd.png"/></div></figure><p id="f2cc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如你在上面的图表中看到的，它是用Base64Url编码的，它把用户的秘密和信息分成三个部分。</p><p id="9011" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> 1。标题</strong></p><p id="0508" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">报头存储了关于JWT令牌的信息，比如令牌的类型以及我们在创建JWT令牌时使用的算法。</p><p id="293c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">例如–</p><pre class="ln lo lp lq gt ls lt lu lv aw lw bi"><span id="8e12" class="lx ly in lt b gy lz ma l mb mc">{<br/>  "alg": "HS256",<br/>  "typ": "JWT"<br/>}</span></pre><p id="a5ac" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> 2。有效载荷</strong></p><p id="c4e7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">有效负载是JWT令牌的第二部分，用于存储关于用户的信息，如声明、角色、主题和一些与用户相关的附加信息。</p><p id="e460" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">比如说-</p><pre class="ln lo lp lq gt ls lt lu lv aw lw bi"><span id="db16" class="lx ly in lt b gy lz ma l mb mc">{<br/>  "sub": "1234567890",<br/>  "name": "Jaydeep Patil",<br/>  "admin": "true"<br/>}</span></pre><p id="76be" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> 3。签名</strong></p><p id="679d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">签名用于检查标头和有效负载中的用户信息，并使用密钥和数据验证Base64Url编码字符串中的内容。基本上，密钥存在于服务器中，我们在创建令牌时使用它。该密钥防止用户被外部攻击者破解令牌。所以，在这个过程中，Base64Url编码的字符串被创建用来进行认证和授权。</p><pre class="ln lo lp lq gt ls lt lu lv aw lw bi"><span id="f08b" class="lx ly in lt b gy lz ma l mb mc">HMACSHA256(<br/>  base64UrlEncode(header) + "." +<br/>  base64UrlEncode(payload),</span><span id="3dec" class="lx ly in lt b gy md ma l mb mc">//This is the Secret Key which is store at server side and use in signature<br/>your-256-bit-secret</span><span id="9de8" class="lx ly in lt b gy md ma l mb mc">)</span></pre><p id="a4bc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，这是Base64Url字符串中存在的令牌的三个部分，由点分隔，存储用户的秘密信息以验证用户。</p><p id="7070" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">使用JWT令牌的客户端-服务器场景</strong></p><ul class=""><li id="bd87" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">在下图中，您可以看到当用户想要从后端服务器访问资源时，身份验证过程是如何工作的。</li></ul><figure class="ln lo lp lq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi me"><img src="../Images/c2cced319ce8db358efae7929b0ea86e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jl9RbAWNxN9406x-.png"/></div></div></figure><ul class=""><li id="d8c1" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">首先，用户用用户名和密码等凭证向身份验证服务器发送请求。</li><li id="3667" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">然后，认证服务器将验证该信息以及用户提供的任何正确信息，并成功认证，然后认证服务器将向用户发放JWT有效访问令牌。</li><li id="ab2e" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">接下来，用户使用有效的JWT访问令牌向后端服务器发送第一个请求，服务器将向用户提供所请求的资源。</li><li id="7b47" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">稍后，如果用户想要从后端服务器访问另一个服务，那么他将向服务器发送第二个请求。</li><li id="38b7" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">现在，如图所示，当用户向服务器发送第二个请求以访问受保护的资源时，但此时令牌已过期，因此服务器响应终端用户。</li><li id="e770" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">最后，正如您在图的最后部分看到的，用户需要再次登录，并将用户凭证发送到身份验证服务器，以获得新的JWT有效访问令牌，并将其存储在客户端的本地存储中，类似于Base64Url编码的Url。</li><li id="6a96" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">因此，这样正常的认证过程将会工作。</li></ul><p id="8c84" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">使用JWT刷新令牌的客户端-服务器场景</strong></p><ul class=""><li id="9783" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">您可以在下图中看到JWT刷新令牌是如何逐步工作的。</li><li id="340f" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">首先，用户将使用用户名和密码等凭证向身份验证服务器发送请求。</li><li id="d4b9" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">接下来，认证服务器验证用户信息和凭证是否正确，然后服务器将提供JWT有效访问令牌和刷新令牌。然后，用户将根据需要和要求，将该令牌存储在客户端本地存储中的某个位置。</li><li id="be63" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">随后，用户向后端服务器发送第一个请求，以使用报头中的JWT有效访问令牌来访问受保护的资源。</li><li id="d578" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">接下来，后端服务器检查用户的角色和权限，如登录用户被授权获得受保护的资源，这将是有效和适当的，然后后端服务器向最终用户提供所请求的受保护的资源。</li></ul><figure class="ln lo lp lq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi me"><img src="../Images/327d3b8a246fca8dad6048f52a890da8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LIT78GGq2aoPym5v.png"/></div></div></figure><ul class=""><li id="7fa8" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">同时，用户向后端服务器发送第二个请求以访问另一个服务，如果同时JWT有效访问令牌过期，那么服务器将响应最终用户，如上图所示。</li><li id="2e17" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">在这种情况下，当JWT有效访问令牌过期时，用户使用刷新令牌向身份验证服务器发送身份验证请求，以获得新的JWT访问令牌。</li><li id="c4a1" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">接下来，服务器将验证用户信息，并向终端用户提供带有刷新令牌的新的访问令牌，并且刷新令牌比简单的JWT有效访问令牌具有更长的寿命</li><li id="f90b" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">因此，在浏览web应用程序和通过互联网访问新的服务和资源时，上述所有步骤都会连续执行。</li></ul><p id="680c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是JWT令牌以及身份验证和授权过程中的工作原理。</p><p id="62fc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我希望你了解所有与JWT有关的事情，现在对它有一个基本的概念。</p><p id="fb6d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">编码快乐！</p><p id="572b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mf">更多内容请看</em><a class="ae jz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="mf">plain English . io</em></strong></a><em class="mf">。报名参加我们的</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="mf">免费周报</em> </strong> </a> <em class="mf">。关注我们关于</em><a class="ae jz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="mf">Twitter</em></strong></a><em class="mf">和</em><a class="ae jz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="mf">LinkedIn</em></strong></a><em class="mf">。查看我们的</em> <a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="mf">社区不和谐</em> </strong> </a> <em class="mf">加入我们的</em> <a class="ae jz" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="mf">人才集体</em> </strong> </a> <em class="mf">。</em></p></div></div>    
</body>
</html>