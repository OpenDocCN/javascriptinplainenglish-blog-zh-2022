<html>
<head>
<title>The Ultimate Guide to Google Analytics (UA &amp; GA4) on React (Or Anything Else)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React(或其他任何东西)上的谷歌分析终极指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-ultimate-guide-to-google-analytics-ua-ga4-on-react-or-anything-else-ec9dc84c0211?source=collection_archive---------2-----------------------#2022-08-18">https://javascript.plainenglish.io/the-ultimate-guide-to-google-analytics-ua-ga4-on-react-or-anything-else-ec9dc84c0211?source=collection_archive---------2-----------------------#2022-08-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/7796e0d89534070fc585dd07b8972a75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vqJD0Ug7gTJVyf8KVleDAg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture from <a class="ae jz" href="https://medium.com/@jakejrichards" rel="noopener">https://medium.com/@jakejrichards</a></figcaption></figure><p id="a04b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">有许多文章声称提供了设置Google Analytics的正确代码片段。他们错了。使用它们，你会遇到双页或缺页跟踪。没有灵丹妙药，没有完美的代码片段。设置将取决于您的具体用例:您正在使用的框架和路由。</p><p id="07a3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这里，我将提供一些工具，以便您可以为您的特定用例找出正确的设置。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="e69b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，有两种类型的Google Analytics属性:Universal Analytics(` ua-xxxxxxxxx-x `)和Google Analytics 4属性(` g-xxxxxxxxxxx ` ` ),前者随着2023.07.01 的停产而不再使用。</p><p id="9e95" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这引起了一些骚动，因为React的go-to UA解决方案(<a class="ae jz" href="https://github.com/react-ga/react-ga" rel="noopener ugc nofollow" target="_blank"> `react-ga` </a> ) <a class="ae jz" href="https://github.com/react-ga/react-ga/issues/460#issuecomment-820369771" rel="noopener ugc nofollow" target="_blank">不打算支持GA </a>(相关问题:<a class="ae jz" href="https://github.com/react-ga/react-ga/issues/460" rel="noopener ugc nofollow" target="_blank"> 1 </a>，<a class="ae jz" href="https://github.com/react-ga/react-ga/issues/493" rel="noopener ugc nofollow" target="_blank"> 2 </a>，<a class="ae jz" href="https://github.com/react-ga/react-ga/issues/520" rel="noopener ugc nofollow" target="_blank"> 3 </a>)。<a class="ae jz" href="https://github.com/PriceRunner/react-ga4" rel="noopener ugc nofollow" target="_blank"> `react-ga4` </a>和<a class="ae jz" href="https://github.com/unrealmanu/ga-4-react" rel="noopener ugc nofollow" target="_blank"> `ga-4-react` </a>作为替换物出现，但是因为它们是相似的包装器，所以你只能由维护者来实现和支持所有的功能。</p><p id="163e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本指南使用Google推荐的适用于UA和GA4的原生设置。它甚至有类型脚本支持！</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="6699" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://developers.google.com/tag-platform/gtagjs/install" rel="noopener ugc nofollow" target="_blank">推荐的</a>设置GA的方式是通过脚本标签，<a class="ae jz" href="https://developers.google.com/analytics/devguides/collection/analyticsjs#alternative_async_tag" rel="noopener ugc nofollow" target="_blank">加载异步</a>。</p><figure class="lf lg lh li gt jo"><div class="bz fp l di"><div class="lj lk l"/></div></figure><p id="e053" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这将在任何框架中工作。有些人可能会建议进一步优化。例如，对于Next.js <a class="ae jz" href="https://nextjs.org/docs/messages/next-script-for-ga" rel="noopener ugc nofollow" target="_blank">你应该使用</a>自己的<a class="ae jz" href="https://nextjs.org/docs/basic-features/script" rel="noopener ugc nofollow" target="_blank"> &lt;脚本&gt; </a>标签。</p><p id="2944" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以使用<code class="fe ll lm ln lo b">windows.gtag</code>通过<code class="fe ll lm ln lo b">@types/gtag.js</code>触发带有TypeScript支持的定制事件。</p><p id="fba4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://developers.google.com/analytics/devguides/collection/gtagjs/pages" rel="noopener ugc nofollow" target="_blank">自定义参数和默认值</a>也可在此配置，但在评估时请记住。对于SPA，添加到<code class="fe ll lm ln lo b">index.html</code>的参数将在第一页加载时评估一次，并且总是发送相同的值。在这种情况下，脚本标签(或参数)应该被移动到动态组件中。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="8829" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">更多的麻烦来自内置的自动页面浏览跟踪。GA4声称<a class="ae jz" href="https://support.google.com/analytics/answer/11403294?hl=en" rel="noopener ugc nofollow" target="_blank">虚拟页面浏览量</a>也使用<a class="ae jz" href="https://support.google.com/analytics/answer/9216061" rel="noopener ugc nofollow" target="_blank">增强测量</a>进行跟踪。也就是说，在不重新加载页面的SPA上导航。</p><p id="1d47" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但是，URL的某些部分(如<code class="fe ll lm ln lo b">hash</code>和<code class="fe ll lm ln lo b">search</code>)是<a class="ae jz" href="https://stackoverflow.com/a/73362255/2771889" rel="noopener ugc nofollow" target="_blank">不跟踪</a>的，默认<a class="ae jz" href="https://developers.google.com/analytics/devguides/collection/gtagjs/pages" rel="noopener ugc nofollow" target="_blank">不是</a> <code class="fe ll lm ln lo b"><a class="ae jz" href="https://developers.google.com/analytics/devguides/collection/gtagjs/pages" rel="noopener ugc nofollow" target="_blank">page_path</a></code> <a class="ae jz" href="https://developers.google.com/analytics/devguides/collection/gtagjs/pages" rel="noopener ugc nofollow" target="_blank">参数的一部分</a>。这会导致以下问题:</p><ul class=""><li id="32c0" class="lp lq in kc b kd ke kh ki kl lr kp ls kt lt kx lu lv lw lx bi translated">未跟踪页面视图上的锚定链接</li><li id="b6c5" class="lp lq in kc b kd ly kh lz kl ma kp mb kt mc kx lu lv lw lx bi translated">当React Router使用<code class="fe ll lm ln lo b">HashRouter</code>时，初始页面加载将被跟踪，但SPA内的导航不会被跟踪</li></ul><p id="58cb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用<a class="ae jz" href="https://chrome.google.com/webstore/detail/google-analytics-debugger/jnkmfdileelhofjcijamephohjechhna?hl=en" rel="noopener ugc nofollow" target="_blank">谷歌分析调试器</a>来发现发送了哪些事件和数据。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="8fc1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要完全控制页面视图跟踪，首先，将<code class="fe ll lm ln lo b">gtag</code>配置编辑为<a class="ae jz" href="https://developers.google.com/analytics/devguides/collection/gtagjs/pages#disable_pageview_measurement" rel="noopener ugc nofollow" target="_blank">禁用自动跟踪</a>:</p><p id="9285" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ll lm ln lo b">gtag('config', 'G-xxxxxxxxxx', { send_page_view: false })</code></p><p id="99f7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">并使用您的路由器实现它。以下是React路由器的一个示例:</p><figure class="lf lg lh li gt jo"><div class="bz fp l di"><div class="lj lk l"/></div></figure></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="61c1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在你有了它:没有什么被跟踪的困惑，现在一切都在你的手中。</p><p id="386c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在实践中，你可以在<a class="ae jz" href="https://github.com/thisismydesign/cra-typescript-starter" rel="noopener ugc nofollow" target="_blank"> cra-typescript-starter </a>看到React，在<a class="ae jz" href="https://github.com/thisismydesign/nestjs-starter" rel="noopener ugc nofollow" target="_blank"> nestjs-starter </a>看到Next.js。</p><p id="ec13" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="md">更多内容看</em> <a class="ae jz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="md">说白了就是</em> </strong> </a> <em class="md">。报名参加我们的</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="md">免费周报</em> </strong> </a> <em class="md">。关注我们关于</em> <a class="ae jz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="md">推特</em> </strong> </a>，<a class="ae jz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="md">领英</em> </strong> </a> <em class="md">，</em><a class="ae jz" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="md">YouTube</em></strong></a><em class="md">，以及</em> <a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="md">不和</em> </strong> </a> <em class="md">。</em></p></div></div>    
</body>
</html>