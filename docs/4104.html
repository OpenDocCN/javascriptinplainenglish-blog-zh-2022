<html>
<head>
<title>Inversion of Control: Service Locator in Typescript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">控制反转:Typescript中的服务定位器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/inversion-of-control-service-locator-in-typescript-50d2d18a94a6?source=collection_archive---------8-----------------------#2022-10-25">https://javascript.plainenglish.io/inversion-of-control-service-locator-in-typescript-50d2d18a94a6?source=collection_archive---------8-----------------------#2022-10-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/d8b6af07482922bf95562d28a106b0c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QVmmzRIn7Fvybja3ehHIPA.jpeg"/></div></div></figure><p id="b35b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我已经在Angular工作了一段时间(超过2年)，自从我换到另一个工作场所，我就(大部分)转向了Stencil。</p><p id="d888" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Stencil是一个非常好的生成web组件的Typescript编译器。如果我来放置它，它将是Angular和React之间的混合物。它像Angular一样使用<a class="ae kt" href="https://stenciljs.com/docs/api" rel="noopener ugc nofollow" target="_blank">装饰器</a>(让编译器收集元数据并基于此生成输出代码)，像React一样使用<a class="ae kt" href="https://stenciljs.com/docs/templating-jsx" rel="noopener ugc nofollow" target="_blank"> jsx/tsx </a>和<a class="ae kt" href="https://stenciljs.com/docs/component-lifecycle" rel="noopener ugc nofollow" target="_blank">生命周期</a>。这是一个非常强大的工具来生成<a class="ae kt" href="https://stenciljs.com/docs/design-systems" rel="noopener ugc nofollow" target="_blank">设计系统</a>。</p><p id="f697" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我一直从事的这个设计系统中，有一个如何存储全局状态的问题。我想有一个类似于反转控制的版本(因为我真的很喜欢它在<a class="ae kt" href="https://angular.io/guide/dependency-injection" rel="noopener ugc nofollow" target="_blank"> Angular </a>)。使用IoC系统的最大好处是，您可以在测试中轻松地模拟服务，而不需要开玩笑地覆盖实际的导入(覆盖是好的，但是在复杂的设置中，您希望在迭代之间有不同的配置，这将变得混乱，因为如果在模拟之前有对模块的任何引用，模拟将不会工作)。</p><p id="a407" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以我想出了一个简单的全球可注射服务的解决方案，它不关心实际的实现。</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><p id="849d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">第一步是考虑你想写的服务能做什么。基于此，您可以用服务的所有公共方法声明一个接口。让我们考虑一个设置和获取用户信息的简单服务。</p><figure class="lb lc ld le gt jo"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk">The interface model for the user service</figcaption></figure><p id="1423" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后我们需要声明一个<code class="fe ll lm ln lo b">UserServiceInstanceResolver</code>静态类，它将接收这个接口的类实现的实例，并存储它以便能够访问它。</p><figure class="lb lc ld le gt jo"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk">Instance resolver for UserService</figcaption></figure><p id="b029" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后但同样重要的是，我们可以实现实际的服务</p><figure class="lb lc ld le gt jo"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk">Actual implementation of UserService</figcaption></figure><p id="9ac7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，当你想实例化单件服务时，你可以这样做:</p><figure class="lb lc ld le gt jo"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="5105" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">实际的好处是，每当你想测试任何使用这个实例的其他组件时，你可以很容易地在<code class="fe ll lm ln lo b">UserServiceInstanceResolver.Instantiate</code>方法上实例化一个应用的模拟。</p><figure class="lb lc ld le gt jo"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="1f21" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这就是我真正需要的(只是一个根级别的全局实例)。但是这段代码也可以扩展为支持每个组件实例(或层次结构实例),并获得更接近Angular的DI的体验。</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><p id="77f3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感谢您阅读我的文章。如果你喜欢，请点击下面的按钮，让其他人也能看到。</p><p id="e01a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="lp">更多内容请看</em><a class="ae kt" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="lp">plain English . io</em></strong></a><em class="lp">。报名参加我们的</em> <a class="ae kt" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="lp">免费周报</em> </strong> </a> <em class="lp">。关注我们关于</em><a class="ae kt" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="lp">Twitter</em></strong></a><a class="ae kt" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="lp">LinkedIn</em></strong></a><strong class="jx io"><em class="lp"/></strong><a class="ae kt" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="lp">YouTube</em></strong></a><strong class="jx io"><em class="lp">，以及</em></strong><em class="lp"/><a class="ae kt" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="lp">不和</em> </strong> </a>T55】</p></div></div>    
</body>
</html>