<html>
<head>
<title>Read Files via JavaScript in the Browser: Choose Files to Read</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在浏览器中通过JavaScript读取文件:选择要读取的文件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/reading-files-via-javascript-in-the-browser-part-1-choosing-files-to-read-af34a6daa63f?source=collection_archive---------12-----------------------#2022-01-25">https://javascript.plainenglish.io/reading-files-via-javascript-in-the-browser-part-1-choosing-files-to-read-af34a6daa63f?source=collection_archive---------12-----------------------#2022-01-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="476d" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">第1部分:选择要读取的文件</h2></div><p id="f238" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文是关于在浏览器中通过JavaScript读取文件的系列文章的第一部分。这个系列必须从某个地方开始。最好的起点是展示如何让<em class="kz">选择</em>一个要读取的文件。你可以想象像“<em class="kz">Expenses”</em>这样的应用程序会从让用户选择一张或多张收据中受益。另外，JavaScript的文件管理API需要用户发起的事件来读取文件。</p><p id="c506" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">出于隐私和安全原因，JavaScript依赖用户发起的事件来获取文件。如果你退一步想想，这很有意义。你会希望一个网站在你访问它的时候抓取你电脑上的文件吗？当然不是！这将是对隐私的大规模侵犯，也是对安全的侵犯。令人欣慰的是，浏览器提供了护栏，让用户坐在驾驶座上。同时，应用程序和服务通常需要用户提供文件。从工程的角度来看，我们如何在需要的时候从用户的电脑中获取文件？</p><p id="f01a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从用户处获取文件有两种方式:</p><ol class=""><li id="70b2" class="la lb in ke b kf kg ki kj kl lc kp ld kt le kx lf lg lh li bi translated">通过具有文件类型的输入元素</li><li id="74dc" class="la lb in ke b kf lj ki lk kl ll kp lm kt ln kx lf lg lh li bi translated">通过拖放</li></ol><p id="8b80" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这两种用户发起的方法将在本文中讨论。第一部分将讨论如何通过输入元素选择文件。接下来的部分将介绍拖放文件。我们开始吧。</p></div><div class="ab cl lo lp hr lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ig ih ii ij ik"><h1 id="920b" class="lv lw in bd lx ly lz ma mb mc md me mf jt mg ju mh jw mi jx mj jz mk ka ml mm bi translated">通过输入控件选择文件</h1><p id="e055" class="pw-post-body-paragraph kc kd in ke b kf mn jo kh ki mo jr kk kl mp kn ko kp mq kr ks kt mr kv kw kx ig bi translated">获取文件最简单的方法是添加一个HTML输入元素。默认情况下，输入标签具有文本类型。这种类型允许输入标记接受单行字符。可以将type属性更改为file，以便将input元素转换为文件选择器。一旦完成，一个“浏览”按钮将被添加。这将看起来像这样:</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/d5b3e4cbae5bf9313c0614f8f3a54d6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:426/0*BtayIuznn_V3yLXV"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">image 1.1</figcaption></figure><p id="61e0" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">图1.1显示了文件输入元素在编写时的默认外观。实际的默认外观因浏览器而异。如果你使用的是CSS框架，它看起来也会有所不同。尽管如此，这个图像是使用与本系列文章相关的<a class="ae ky" href="https://github.com/ecofic/article-reading-files-via-javascript" rel="noopener ugc nofollow" target="_blank">源存储库</a>中的第一个样本呈现的。该示例包含如下所示的代码:</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="ne nf l"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">sample 1.1</figcaption></figure><p id="1c8a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个输入元素将让用户选择<em class="kz">一个</em>文件。文件输入元素还支持以下功能:</p><ul class=""><li id="f192" class="la lb in ke b kf kg ki kj kl lc kp ld kt le kx ng lg lh li bi translated">选择多个文件</li><li id="d07d" class="la lb in ke b kf lj ki lk kl ll kp lm kt ln kx ng lg lh li bi translated">推荐一种特定的文件</li><li id="660d" class="la lb in ke b kf lj ki lk kl ll kp lm kt ln kx ng lg lh li bi translated">设置占位符</li></ul><p id="2d3a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这些能力可以增强像"<em class="kz"> Expenses </em>"这样的应用或者你的应用。本节的以下部分涵盖了这些能力。</p><h1 id="92f9" class="lv lw in bd lx ly nh ma mb mc ni me mf jt nj ju mh jw nk jx mj jz nl ka ml mm bi translated">通过文件输入元素选择多个文件</h1><p id="7371" class="pw-post-body-paragraph kc kd in ke b kf mn jo kh ki mo jr kk kl mp kn ko kp mq kr ks kt mr kv kw kx ig bi translated">假设你正在处理<em class="kz">费用</em>。如果您添加了一个基本的文件输入元素，用户<em class="kz">可以</em>一次添加一个收据。您可以更进一步，让用户同时选择多个收据👍。通过让用户一次选择多个收据，你可以改善应用程序的体验。使用“multiple”属性可以做到这一点。</p><p id="a004" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">“多个”属性允许用户从一个打开的对话框中同时选择几个文件。此布尔属性可应用于输入元素，如下所示:</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="ne nf l"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">sample 1.2</figcaption></figure><p id="2a17" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">具有“多重”属性的输入元素最初将呈现为与没有“多重”属性的的<em class="kz">相同。‘multiple’属性只是改变了用户如何与打开的对话框交互。用户将能够选择几个文件，而不是限制用户选择单个文件。如果选择了多个文件，所选文件的数量将替换输入元素的标签。下图显示了选择三个文件后的文件输入元素。</em></p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/832a501ed44f614d7efedd30063f39fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:426/0*iLYvWzEsMcr1xrPy"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">image 1.2</figcaption></figure><p id="c32e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是“多重”属性的全部内容。如果您希望允许用户一次选择多个文件，请添加“multiple”属性。如果您想推荐一种特定的文件，请查看accept属性。</p><h1 id="94d9" class="lv lw in bd lx ly nh ma mb mc ni me mf jt nj ju mh jw nk jx mj jz nl ka ml mm bi translated">推荐特定种类的文件</h1><p id="f4df" class="pw-post-body-paragraph kc kd in ke b kf mn jo kh ki mo jr kk kl mp kn ko kp mq kr ks kt mr kv kw kx ig bi translated">“接受”属性让你<em class="kz">推荐</em>用户可以在打开的对话框中选择的文件类型。应用时，<em class="kz">与</em>不匹配该属性值的文件将被禁用或隐藏。例如，“<em class="kz">费用</em>”应用将受益于建议<em class="kz">图像</em>作为潜在收据。macOS上的一个建议图像的示例打开对话框如下所示:</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nm"><img src="../Images/623e799585f4c3609ec491cea16113fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QEczZQJdm86e-C8v"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">image 1.3</figcaption></figure><p id="7c31" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">该对话框区分与accept属性值匹配的文件和不匹配的文件。在这一点上，您可能想知道我用来建议图像的接受值。在这个特定的示例中，文件输入元素如下所示:</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="ne nf l"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">sample 1.3</figcaption></figure><p id="af01" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此代码片段使用“accept”属性来建议图像。这是一个<em class="kz">类别</em>的文件。“接受”属性还允许您推荐带有特定扩展名的文件。这两个选项都包含在以下部分中。</p><h1 id="6487" class="lv lw in bd lx ly nh ma mb mc ni me mf jt nj ju mh jw nk jx mj jz nl ka ml mm bi translated">建议文件类别</h1><p id="41b2" class="pw-post-body-paragraph kc kd in ke b kf mn jo kh ki mo jr kk kl mp kn ko kp mq kr ks kt mr kv kw kx ig bi translated">“accept”属性识别三类文件。下表显示了这些类别是音频、图片和视频文件。</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nr"><img src="../Images/891301da6a5f5b1e3750e2efc34e16ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LdrrA_vee98bU8kGOOysTQ.png"/></div></div></figure><p id="da71" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这三个选项是“accept”最常用的值。如果你的场景不符合上面列出的任何一个类别，我会推荐你访问<a class="ae ky" href="https://www.iana.org/assignments/media-types/media-types.xhtml" rel="noopener ugc nofollow" target="_blank"> IANA媒体类型列表</a>。这个注册表相当长。但是，如果您需要推荐带有特定扩展名的文件，它会很有用。</p><h1 id="6a48" class="lv lw in bd lx ly nh ma mb mc ni me mf jt nj ju mh jw nk jx mj jz nl ka ml mm bi translated">推荐带有特定扩展名的文件</h1><p id="95d0" class="pw-post-body-paragraph kc kd in ke b kf mn jo kh ki mo jr kk kl mp kn ko kp mq kr ks kt mr kv kw kx ig bi translated">“接受”属性允许您推荐具有特定扩展名的文件。可以为“accept”属性分配文件扩展名。文件扩展名不区分大小写。但是，如下例所示，提前期是<em class="kz">要求的</em>。</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="ne nf l"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">sample 1.4</figcaption></figure><p id="17c5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此示例将呈现一个文件输入，建议用户在打开对话框中选择PDF文件。然而，建议同时使用<em class="kz">多种</em>文件是很有用的。幸运的是,“accept”属性通过提供一个逗号分隔的列表让您做到这一点，如下所示:</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="ne nf l"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">sample 1.5</figcaption></figure><p id="18ba" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当打开对话框显示时，这个文件输入元素将建议PDF和TXT文件。我相信你可以想象，推荐带有特定扩展名或适合某个类别的文件会有多大帮助。然而，重要的是要认识到这些只是建议。“接受”属性将<em class="kz">而不是</em>阻止用户选择带有其他扩展名的文件。因此，您应该<em class="kz">而不是</em>依赖accept属性来执行任何类型的验证。相反，您应该在服务器端验证该文件。虽然这超出了本系列的范围，但我想将焦点转移回输入元素本身，并讨论设置默认文本。</p><h1 id="35ac" class="lv lw in bd lx ly nh ma mb mc ni me mf jt nj ju mh jw nk jx mj jz nl ka ml mm bi translated">设置文件输入元素的占位符</h1><p id="f983" class="pw-post-body-paragraph kc kd in ke b kf mn jo kh ki mo jr kk kl mp kn ko kp mq kr ks kt mr kv kw kx ig bi translated">默认情况下，文件输入元素将显示一个带有“未选择文件”字样的占位符。虽然这个短语是准确的，但它相当模糊。更详细的短语将改善应用程序的体验。例如，如果这个占位符说“请选择您的收据……”，那么“<em class="kz">费用</em>”将会受益。乍一看，您可能会想到尝试以下内容:</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="ne nf l"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">sample 1.6</figcaption></figure><p id="8996" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个样本可能看起来是正确的。毕竟，占位符<em class="kz">是</em>输入元素的有效属性。然而，您可能会惊讶地发现，占位符属性对文件输入没有任何作用。至少，在撰写本文时，这种说法是真实的。不过先别着急！您可以解决这种行为以达到您的目标。仔细想想，实际上有两种场景需要考虑:1)在没有选择文件时标记输入元素，2)在选择了一个或多个文件时标记输入元素。</p><h1 id="3256" class="lv lw in bd lx ly nh ma mb mc ni me mf jt nj ju mh jw nk jx mj jz nl ka ml mm bi translated">未选择文件时标记</h1><p id="903b" class="pw-post-body-paragraph kc kd in ke b kf mn jo kh ki mo jr kk kl mp kn ko kp mq kr ks kt mr kv kw kx ig bi translated">HTML文件输入元素没有一个好的方法来描述<em class="kz">本身</em>。但是，HTML输入元素通常与另一个名为label的元素成对出现。该元素是将描述链接到输入元素的一种方式。例如，可以通过添加标签来描述“<em class="kz"> Expenses </em>”中的输入元素，如下所示:</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="ne nf l"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">sample 1.7</figcaption></figure><p id="08b5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此示例通过以下方式关联描述:a)向input元素添加id，b)通过label元素的for属性将id用作引用。如果你运行这个，你会看到这样的东西:</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/7b8b992abd11082df48f0b59819a2a74.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/0*JqaFAv__XbEGZSAg"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">image 1.4</figcaption></figure><p id="6185" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">哎呀！这看起来不太好，也不符合我们的目标。和我呆在一起，因为它将变得有趣。首先，我们要像这样隐藏文件输入元素:</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="ne nf l"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">sample 1.8</figcaption></figure><p id="5a13" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，它看起来像我们想要的。但是，有人<em class="kz">会如何选择</em>他们的收据呢？好吧，事实是:标签元素将像按钮一样工作！没错。即使文件输入元素被<em class="kz">隐藏</em>，标签元素也会像按钮一样工作。只要for属性与文件输入元素的id相关联，该按钮就会启动打开对话框。然后，用户可以选择他们的文件。不过，这只能让我们实现目标的一半。如果您在<a class="ae ky" href="https://github.com/ecofic/article-reading-files-via-javascript" rel="noopener ugc nofollow" target="_blank">源代码库</a>中运行sample 1.8，您会注意到另一个问题:当选择一个文件时，标签不会改变。与输入元素相关联的标签不会自我更新。</p><h1 id="24ad" class="lv lw in bd lx ly nh ma mb mc ni me mf jt nj ju mh jw nk jx mj jz nl ka ml mm bi translated">选择一个或多个文件时标记</h1><p id="d681" class="pw-post-body-paragraph kc kd in ke b kf mn jo kh ki mo jr kk kl mp kn ko kp mq kr ks kt mr kv kw kx ig bi translated">要在选择一个或多个文件后正确应用标签，需要一些JavaScript。您可以通过侦听change事件对用户选择文件做出反应。您可以向文件输入元素添加一个事件处理程序，如下所示:</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nt"><img src="../Images/d81218087783ef1461cde32e65b4478e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OUoWMtf9g_EfZuL81GQ-zw.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">sample 1.9</figcaption></figure><p id="5db4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下一步是定义onReceiptsSelected函数。该函数在以下示例中定义:</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nu"><img src="../Images/1df863cd65e73e47f6868363099f33fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ihiFqitk-xGuSHALdQvgsw.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">sample 1.10</figcaption></figure><p id="89fc" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个功能就是“神奇”发生的地方。第2行获取描述已经选择了多少文件的label元素。第4行检索用户一直与之交互的文件输入元素。这个元素很重要，因为如第6行所示，这是我们获取用户选择的文件的方式。这些文件可以通过方便命名的files属性获得。第7行使用JavaScript的字符串插值用友好的描述更新标签的文本。😅</p><p id="b5f6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">恭喜你！现在，您知道了如何为文件输入元素设置占位符。在本节中，您还了解了如何推荐特定类型的文件。您还看到了如何允许用户同时选择几个文件。所有这些都是在文件输入元素的上下文中完成的。然而，这只是让用户选择阅读文件的一种方式。您也可以通过拖放从用户那里获取文件。</p></div><div class="ab cl lo lp hr lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ig ih ii ij ik"><h1 id="fd93" class="lv lw in bd lx ly lz ma mb mc md me mf jt mg ju mh jw mi jx mj jz mk ka ml mm bi translated">通过拖放获取文件</h1><p id="115c" class="pw-post-body-paragraph kc kd in ke b kf mn jo kh ki mo jr kk kl mp kn ko kp mq kr ks kt mr kv kw kx ig bi translated">从用户处获取文件的另一种方法是实现拖放支持。这种方法比文件输入元素方法更灵活、更具交互性。实现起来也更复杂。为了演示，假设您想让某人将收据拖放到“<em class="kz">费用</em>”中。当收据被丢弃时，您将阅读该收据(即文件)。本系列的下一篇文章将向您展示如何<em class="kz">阅读</em>像收据这样的文件。因此，我鼓励你<a class="ae ky" href="https://docs.google.com/document/d/1WoqliHHFM7Z22FZtotLn3E1FBZszwKXLd0MF7dUSH5g/edit#" rel="noopener ugc nofollow" target="_blank">现在就跟我来</a>，这样你就知道那篇文章什么时候发表了。不过现在，让我们讨论通过拖放获取文件。</p><p id="b6d4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接受文件的拖放过程有两个步骤:</p><ol class=""><li id="f8de" class="la lb in ke b kf kg ki kj kl lc kp ld kt le kx lf lg lh li bi translated">定义拖放表面</li><li id="5b03" class="la lb in ke b kf lj ki lk kl ll kp lm kt ln kx lf lg lh li bi translated">对拖放事件做出反应</li></ol><p id="c11e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这两个步骤都将在本节中详细介绍。我们走吧！</p><h1 id="dd66" class="lv lw in bd lx ly nh ma mb mc ni me mf jt nj ju mh jw nk jx mj jz nl ka ml mm bi translated">定义拖放表面</h1><p id="0784" class="pw-post-body-paragraph kc kd in ke b kf mn jo kh ki mo jr kk kl mp kn ko kp mq kr ks kt mr kv kw kx ig bi translated">拖放表面表示可以放置文件的目标区域。为了演示，让我们想象"<em class="kz">费用</em>"如下所示:</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nv"><img src="../Images/823dfad89955c4f2894c3f7ef100beed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*p6xjrKZBlfXqPrQY"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">image 1.5</figcaption></figure><p id="de5b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此图中重要的细节是有五个<em class="kz">下降表面:每个工作日一个。虽然拖放支持可以添加到任何HTML元素中，但是在上面的场景中，div可能是一个合适的选择。出于这个原因，也为了便于讨论，我将使用以下内容:</em></p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="ne nf l"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">sample 1.11</figcaption></figure><p id="e6cc" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">就是这样。你可能认为我忘记了一些事情。然而，我没有。正如我在这个<a class="ae ky" href="https://medium.com/@chad.campbell/reading-files-via-javascript-in-the-browser-introduction-ad40af01a1dd" rel="noopener">系列的介绍</a>中提到的，文件管理主要发生在幕后。对于实现拖放来说也是如此。在拖放环境中，我们的主要职责是对拖放事件做出反应。</p><h1 id="b7c0" class="lv lw in bd lx ly nh ma mb mc ni me mf jt nj ju mh jw nk jx mj jz nl ka ml mm bi translated">对拖放事件做出反应</h1><p id="5eff" class="pw-post-body-paragraph kc kd in ke b kf mn jo kh ki mo jr kk kl mp kn ko kp mq kr ks kt mr kv kw kx ig bi translated">HTML元素有七个<em class="kz">拖放事件可用。对于拖放表面，只有四个事件是相关的。这四个事件是:拖动输入、拖动结束、拖动离开和放下。出于讨论目的，我想介绍这四个事件:</em></p><ul class=""><li id="ed28" class="la lb in ke b kf kg ki kj kl lc kp ld kt le kx ng lg lh li bi translated">dragenter:当用户将文件拖动到目标图面的边界时，将触发该事件。</li><li id="ae4f" class="la lb in ke b kf lj ki lk kl ll kp lm kt ln kx ng lg lh li bi translated">dragover:当文件在目标表面的边界内拖动时，该事件将重复触发。此事件在浏览器确定的时间间隔内触发。</li><li id="8fd8" class="la lb in ke b kf lj ki lk kl ll kp lm kt ln kx ng lg lh li bi translated">dragleave:如果用户在输入文件后将文件拖出目标表面的边界，将触发该事件。</li><li id="19ca" class="la lb in ke b kf lj ki lk kl ll kp lm kt ln kx ng lg lh li bi translated">drop:如果用户在目标图面的边界内释放文件，将触发此事件。</li></ul><p id="63f3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我发现将这四个事件相互联系起来很有帮助。为此，我想到了下面的流程图:</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nw"><img src="../Images/80425cc394b4c92e04a669928ffdc410.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZmqZZMC7c9j6uhD6"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">flowchart 1.1</figcaption></figure><p id="237e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我相信这个流程图有助于理解拖放表面(即目标)上的事件流。像其他HTML DOM事件一样，您没有<em class="kz">来对它们中的任何一个做出反应。事实上，对于拖放场景，您可能只在高级样式需要时才使用dragenter和dragleave事件。例如，如果您想在有人拖动文件时更改div的边框外观。要实现拖放支持，您只需要两个事件:dragover和drop。</em></p><h1 id="7544" class="lv lw in bd lx ly nh ma mb mc ni me mf jt nj ju mh jw nk jx mj jz nl ka ml mm bi translated">对dragover事件的反应</h1><p id="35b9" class="pw-post-body-paragraph kc kd in ke b kf mn jo kh ki mo jr kk kl mp kn ko kp mq kr ks kt mr kv kw kx ig bi translated">dragover事件为您提供了一种观察文件在拖放表面被拖动的方式。我们在本文中讨论的“<em class="kz">费用</em>”场景不需要这种能力。然而，dragover事件仍然必须解决。原因是因为下降事件本身是不够的。</p><p id="8f79" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您首先实现drop事件，您将体验到一些有趣的事情。浏览器将尝试在新标签中打开该文件。如果这是你想要的，太好了！您可以跳过这一部分。然而，我想不出有哪一次这是我想要的行为。要覆盖此行为，您需要包括dragover事件，如下所示:</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nx"><img src="../Images/91587407a262d3c3e29d12a65f5538fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tTF1M71unVck5kWuK7ipSw.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">sample 1.12</figcaption></figure><p id="d803" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此示例的第一行连接到dragover事件处理程序。该事件在第6–8行中定义。“神奇”发生在第7行。这一行使用preventDefault方法来停止标准行为。如果您从<a class="ae ky" href="https://github.com/ecofic/article-reading-files-via-javascript" rel="noopener ugc nofollow" target="_blank">源代码库</a>运行这个示例，您会注意到浏览器仍然会尝试在新的标签页中打开文件。原因是因为您仍然需要对drop事件做出反应。</p><h1 id="15db" class="lv lw in bd lx ly nh ma mb mc ni me mf jt nj ju mh jw nk jx mj jz nl ka ml mm bi translated">对放下事件作出反应</h1><p id="259b" class="pw-post-body-paragraph kc kd in ke b kf mn jo kh ki mo jr kk kl mp kn ko kp mq kr ks kt mr kv kw kx ig bi translated">drop事件使您能够响应用户将文件放到表面上。以下示例基于示例1.12中的代码，并添加了drop事件处理程序。</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi ny"><img src="../Images/cba7d839040abba13ac6866c8f817a70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lv7zwpu1IW2knMlQ_vavHg.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">sample 1.13</figcaption></figure><p id="be83" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">第2行引用了drop事件处理程序。这个事件处理程序在第11–13行定义，反映了dragover事件处理程序。就像dragover事件处理程序一样，这个事件处理程序也使用preventDefault方法来阻止浏览器试图在新选项卡中打开文件。如果您运行这个示例，您将亲自看到这种体验。您可能会惊讶地发现，该文件实际上什么也没有发生。那是因为要靠<em class="kz">你</em>去得到。</p><p id="1783" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">dataTransfer属性公开一个名为files的属性。该属性是一个文件列表，它提供两个信息:1)拖放操作中文件的数量；2)拖放操作中文件的元数据。读取文件时会使用元数据。这是本系列下一篇文章的主题。</p><p id="658c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文中，您了解了如何从用户那里读取文件。如果这篇文章是有帮助的，请鼓掌👏，或者拍手，在下面。这会让我知道你觉得它很有用。由于这是通过JavaScript阅读文件系列的第一篇文章，我鼓励你现在就<a class="ae ky" href="https://docs.google.com/document/d/1WoqliHHFM7Z22FZtotLn3E1FBZszwKXLd0MF7dUSH5g/edit#" rel="noopener ugc nofollow" target="_blank">关注我</a>。这样，当下一篇文章可用时，您就会知道了。感谢您的阅读。</p><p id="db00" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="kz">更多内容看</em> <a class="ae ky" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="kz">说白了。报名参加我们的</em> <a class="ae ky" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="kz">免费周报</em> </strong> </a> <em class="kz">。在我们的</em> <a class="ae ky" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="kz">社区获得独家访问写作机会和建议</em> </strong> </a> <em class="kz">。</em></strong></a></p></div></div>    
</body>
</html>