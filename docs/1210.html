<html>
<head>
<title>WeakMap in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中的WeakMap</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/weakmap-in-javascript-1c8f6e6412b9?source=collection_archive---------11-----------------------#2022-03-09">https://javascript.plainenglish.io/weakmap-in-javascript-1c8f6e6412b9?source=collection_archive---------11-----------------------#2022-03-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="5afb" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">JavaScript中的WeakMap是什么？它是如何工作的，WeakMap与Map有何不同？</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/d81b28e1d5e12355fd51ed5ddeedd919.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tha8clUHuC9dyLmL"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@afgprogrammer?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Mohammad Rahmani</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1d89" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在本文中，我们将研究JavaScript的一种更高级的数据结构，即WeakMap。</p><p id="2f94" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我假设你在深入WeakMap之前对地图有一些基本的了解。如果没有，你可以浏览我解释过<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/an-introduction-to-map-in-javascript-for-beginners-347a97da936a">地图</a>的文章。</p><p id="dd9f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">综上所述——<strong class="kv io"><em class="lp">地图是一种特殊类型的对象，可以有原始数据类型，也可以有对象作为关键字</em> </strong>。</p><p id="3848" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在WeakMap中，不允许将原始数据类型作为键。相反，只允许对象作为键。</p><p id="88ef" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但你一定想知道，如果这是Map和WeakMap之间的唯一区别，为什么要使用另一种数据结构？我们将很快达到这一部分。</p><p id="cb97" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们通过一个例子来理解它——</p><pre class="kd ke kf kg gt lq lr ls lt aw lu bi"><span id="c728" class="lv lw in lr b gy lx ly l lz ma">let map = new Map();</span><span id="d946" class="lv lw in lr b gy mb ly l lz ma">let obj1 = {</span><span id="6ce0" class="lv lw in lr b gy mb ly l lz ma">topic: 'Map',</span><span id="7c2d" class="lv lw in lr b gy mb ly l lz ma">};</span><span id="25ae" class="lv lw in lr b gy mb ly l lz ma">map.set(obj1, 'This is a map tutorial');</span><span id="7f9c" class="lv lw in lr b gy mb ly l lz ma">console.log(map); // Map { { topic: 'Map' } =&gt; 'This is a map tutorial' }</span><span id="bc61" class="lv lw in lr b gy mb ly l lz ma">obj1 = null;</span><span id="b49a" class="lv lw in lr b gy mb ly l lz ma">console.log(map);  // Map { { topic: 'Map' } =&gt; 'This is a map tutorial' }</span></pre><p id="bce1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">正如您在上面的示例中看到的，即使我们将键(obj1)设置为空，map中仍然存在该特定键的条目。</p><p id="5732" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在，我们将使用WeakMap尝试相同的示例。</p><pre class="kd ke kf kg gt lq lr ls lt aw lu bi"><span id="d9da" class="lv lw in lr b gy lx ly l lz ma">let weakMap = new WeakMap();</span><span id="ded3" class="lv lw in lr b gy mb ly l lz ma">let obj1 = {</span><span id="dfb4" class="lv lw in lr b gy mb ly l lz ma">topic: 'Weak Map',</span><span id="68e2" class="lv lw in lr b gy mb ly l lz ma">};</span><span id="79fb" class="lv lw in lr b gy mb ly l lz ma">weakMap.set(obj1, 'This is a weak map tutorial');</span><span id="fe3a" class="lv lw in lr b gy mb ly l lz ma">console.log(weakMap); // Map { { topic: 'Map' } =&gt; 'This is a weak map tutorial' }</span><span id="a6b3" class="lv lw in lr b gy mb ly l lz ma">obj1 = null;</span><span id="bba3" class="lv lw in lr b gy mb ly l lz ma">setTimeout(() =&gt; {</span><span id="623f" class="lv lw in lr b gy mb ly l lz ma">console.log(weakMap); // WeakMap {}</span><span id="71f4" class="lv lw in lr b gy mb ly l lz ma">},100000)</span></pre><p id="0b97" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这里，观察我们什么时候使WeakMap的键为空。一旦我们这样做了，相应的条目也会从WeakMap中删除。为什么这样</p><p id="b36d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">因为WeakMap中的键引用与对象的链接很弱，即如果对象从内存中移除(我们在这里通过将obj1设为null来完成)，则相应的WeakMap条目也将被移除。</strong></p><p id="bc70" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您尝试运行上面的WeakMap代码，它可能不会给出预期的输出。</p><p id="44ee" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">主要原因是这个obj1仍然在内存中，还没有被垃圾收集器收集。</p><p id="f0a8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这就是为什么我们使用setTimeout来可视化用例。在正常使用中，您可以使用WeakMap而没有任何超时，垃圾收集器将负责从内存中删除对象。</p><p id="3c84" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">weak Map优于Map- </strong></p><p id="101a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">WeakMap相对于Map的最大优势之一是<strong class="kv io"> <em class="lp">防止内存泄漏</em> </strong>。</p><p id="f563" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在Map的情况下，键是紧密链接的。因此，即使我们从内存中删除对象的引用，在Map的情况下，对象也不会被垃圾收集，因为作为Map的键，它具有很强的链接性。</p><p id="bb2a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">与此相反，WeakMap中的键是弱链接的，即只要对象的引用为空，其对应的条目就会从WeakMap中删除，从而该对象被垃圾收集器收集。</p><p id="5a31" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">与地图不同，WeakMap仅支持少数属性。</p><ol class=""><li id="492a" class="mc md in kv b kw kx kz la lc me lg mf lk mg lo mh mi mj mk bi translated">set方法用于在弱映射中设置值，其中第一个参数是key，它应该始终是object类型。</li></ol><pre class="kd ke kf kg gt lq lr ls lt aw lu bi"><span id="0ff2" class="lv lw in lr b gy lx ly l lz ma">weakMap.set(obj1, 'This is a weak map tutorial');</span></pre><p id="1bff" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">2.get方法用于获取作为参数传入的特定键值。</p><pre class="kd ke kf kg gt lq lr ls lt aw lu bi"><span id="dd74" class="lv lw in lr b gy lx ly l lz ma">console.log(weakMap.get(obj1)); // This is a weak map tutorial</span></pre><p id="90e7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">3.has方法基于作为参数传入的属性返回一个布尔值，该参数是否作为键存在。</p><pre class="kd ke kf kg gt lq lr ls lt aw lu bi"><span id="2152" class="lv lw in lr b gy lx ly l lz ma">console.log(weakMap.has(obj1));  // true</span></pre><p id="456b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">4.delete方法用于从弱映射中删除一个属性，如果该属性存在于弱映射中并被成功删除，则该方法返回布尔值。</p><pre class="kd ke kf kg gt lq lr ls lt aw lu bi"><span id="d359" class="lv lw in lr b gy lx ly l lz ma">console.log(weakMap.delete(obj1));  // true</span></pre><p id="da97" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">简而言之，这就是WeakMap。</p><p id="1fa4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">希望你现在对WeakMap有了更好的了解。如果您有任何疑问或反馈，请在回复中告诉我。</p><p id="3f6d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了更清楚地图和WeakMap之间的区别，请参考下面的快照。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ml"><img src="../Images/c849be2fea2ca444e013ee9518cf33b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*erEGRSqU_mNGI8ZliIKezg.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Difference between Map and Weak Map</figcaption></figure></div><div class="ab cl mm mn hr mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ig ih ii ij ik"><p id="67b0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你可以在这里阅读我的其他文章<a class="ae ks" href="https://medium.com/@avinash.dev21987" rel="noopener">，另外，你可以订阅我的时事通讯，获取我发表的最新文章。</a></p><p id="c48f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lp">更多内容看</em> <a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lp">说白了。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lp">免费周报</em> </strong> </a> <em class="lp">。关注我们关于</em><a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="lp">Twitter</em></strong></a><em class="lp">和</em><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="lp">LinkedIn</em></strong></a><em class="lp">。加入我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lp">社区</em> </strong> </a> <em class="lp">。</em></strong></a></p></div></div>    
</body>
</html>