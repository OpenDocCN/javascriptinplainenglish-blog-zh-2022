<html>
<head>
<title>Boost Your React Components State With UseReducer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用UseReducer提升您的React组件状态</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/boost-your-react-components-state-with-usereducer-4d8109f6bb8a?source=collection_archive---------8-----------------------#2022-12-12">https://javascript.plainenglish.io/boost-your-react-components-state-with-usereducer-4d8109f6bb8a?source=collection_archive---------8-----------------------#2022-12-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="e940" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">管理React组件中的本地状态需要花费时间。有许多好的实践，但是通常归结为到处使用useState。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/aa5de1029a7a71b257e73f992cbc41ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0BI1JFV3gX1NVWdErH47wQ.jpeg"/></div></div></figure><h1 id="85c1" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">为什么useReducer这么好用？</h1><p id="5289" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">因为它很灵活，所以不要忘记useState是在useReducer之上创建的。就像几乎所有的抽象概念一样，因为方便，我们失去了力量。</p><p id="21fd" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">让我们探索一个处理和验证一些字段的基本例子。我们都爱形式。:D</p><p id="f11d" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">我们需要至少3或4个属性附加到每个字段来处理一些变化。</p><pre class="kd ke kf kg gt mh mi mj bn mk ml bi"><span id="1139" class="mm kp in mi b be mn mo l mp mq">export type FieldState = {<br/>  value: string;<br/>  minLength: number;<br/>  maxLength: number;<br/>  touched: boolean;<br/>  valid: boolean;<br/>  error: string|null;<br/>};<br/><br/>export const fieldDefaultState: FieldState = {<br/>  minLength: 3,<br/>  maxLength: 10,<br/>  touched: false,<br/>  valid: false,<br/>  value: '',<br/>  error: null,<br/>};<br/><br/>export type FieldReducer = (<br/>  s: FieldState,<br/>  value: string<br/>) =&gt; FieldState;<br/><br/>export const fieldReducer: RulebookNameReducer = (s, value) =&gt; {<br/>  if (value.length &lt; s.minLength) {<br/>    return { ...s, valid: false, touched: true, value, error: `Must be longer than ${s.minLength}` };<br/>  }<br/><br/>if (value.length &gt;s.minLength) {<br/>    return { ...s, valid: false, touched: true, value, error: `Must be shorter than ${s.maxLength}` };<br/>  }<br/><br/>  return { ...s, valid: true, touched: true, value, error: null };<br/>};<br/><br/></span></pre><p id="6e39" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">简单。</p><h1 id="5741" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">单元测试</h1><pre class="kd ke kf kg gt mh mi mj bn mk ml bi"><span id="1bd5" class="mm kp in mi b be mn mo l mp mq">describe('fieldReducer', () =&gt; {<br/>  it('returns the state with valid false when value is shorter than minLength', () =&gt; {<br/>    const state = { ...fieldDefaultState, minLength: 10 };<br/>    const value = 'test';<br/>    const result = fieldReducer(state, value);<br/><br/>    expect(result).toEqual({<br/>      ...state,<br/>      valid: false,<br/>      touched: true,<br/>      value,<br/>      error: `Must be longer than ${state.minLength}`<br/>    });<br/>  });<br/><br/>  it('returns the state with valid false when value is longer than maxLength', () =&gt; {<br/>    const state = { ...fieldDefaultState, maxLength: 3 };<br/>    const value = 'test';<br/>    const result = fieldReducer(state, value);<br/><br/>    expect(result).toEqual({<br/>      ...state,<br/>      valid: false,<br/>      touched: true,<br/>      value,<br/>      error: `Must be shorter than ${state.maxLength}`<br/>    });<br/>  });<br/><br/>  it('returns the state with valid true when value is within minLength and maxLength', () =&gt; {<br/>    const state = { ...fieldDefaultState };<br/>    const value = 'test';<br/>    const result = fieldReducer(state, value);<br/><br/>    expect(result).toEqual({<br/>      ...state,<br/>      valid: true,<br/>      touched: true,<br/>      value,<br/>      error: null<br/>    });<br/>  });<br/>});</span></pre><p id="2c64" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">简单。</p><p id="a88e" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">现在，这可以用于任何领域(在州类型的区别工会的帮助下，没有限制)</p><h1 id="d37d" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">使用</h1><p id="93fd" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">让我们创建一个小助手来解包React事件</p><pre class="kd ke kf kg gt mh mi mj bn mk ml bi"><span id="9470" class="mm kp in mi b be mn mo l mp mq">import { ChangeEvent } from 'react';<br/><br/>type E = ChangeEvent&lt;<br/>  HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement<br/>&gt;;<br/>export const unpackE = (e: E): string =&gt; {<br/>  return e.target.value;<br/>};<br/><br/>export const onChange = (handler: (v: string) =&gt; void) =&gt; (e: E) =&gt;<br/>  handler(unpackE(e));</span></pre><pre class="mr mh mi mj bn mk ml bi"><span id="987a" class="mm kp in mi b be mn mo l mp mq">import { fieldReducer, fieldDefaultState } from './state.ts';<br/>// Just an example<br/>import { Input } from '../somewhere/shared/Input' //<br/>import { useReducer } from 'react';<br/><br/>export const Example = () =&gt; {<br/>  const [name, changeName] = useReducer(fieldReducer, fieldDefaultState);<br/>  <br/>   ...<br/>  <br/>   // Just an example<br/>   const createNew = useCallback(() =&gt; {<br/>    if (name.valid)<br/>      dispatch(<br/>        save({<br/>          name: name.value,<br/>        })<br/>      );<br/>  }, [name]);<br/><br/><br/>  return (<br/>    &lt;div&gt;<br/>      ...<br/>      &lt;Input<br/>        onChange={onChange(changeName)}<br/>        value={name.value}<br/>        error={name.error}<br/>      /&gt;<br/>      ...<br/>    &lt;/div&gt;<br/>  )<br/>}<br/><br/></span></pre><p id="39e9" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">，就是这样。相当整洁。</p><h1 id="dc51" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">结论</h1><p id="2186" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">在用户界面之外有一个状态总是一件好事。更容易进行单元测试或推理。</p><h1 id="4275" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">最后的话</h1><p id="e65a" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">我目前正在做的事情的例子</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ms"><img src="../Images/ca97f26875df14bc341dce1a58ab18f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5NpcvzkqP2PtDt15VYe7-g.png"/></div></div></figure><p id="ae69" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">这让我可以做一些很酷的事情，比如</p><pre class="kd ke kf kg gt mh mi mj bn mk ml bi"><span id="7f39" class="mm kp in mi b be mn mo l mp mq">  const [state, changeState] = useReducer(editorReducer, defaultEditorState);</span></pre><p id="3e7c" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">这让我现在可以</p><pre class="kd ke kf kg gt mh mi mj bn mk ml bi"><span id="b1e0" class="mm kp in mi b be mn mo l mp mq">changeState({<br/>  action: EditorAction.SetRules,<br/>  rules: rulebook.rules,<br/>});<br/><br/>OR <br/><br/>changeState({<br/>  action: EditorAction.SetRulebook,<br/>  name: rulebook.name,<br/>  identity: rulebook.identity,<br/>});<br/><br/>...</span></pre><p id="02ae" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">我喜欢！</p><p id="94b7" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated"><em class="mt">更多内容请看</em><a class="ae mu" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="li io"><em class="mt">plain English . io</em></strong></a><em class="mt">。</em></p><p id="0697" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated"><em class="mt">报名参加我们的</em> <a class="ae mu" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="li io"> <em class="mt">免费每周简讯</em> </strong> </a> <em class="mt">。关注我们关于</em><a class="ae mu" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="li io"><em class="mt">Twitter</em></strong></a><a class="ae mu" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="li io"><em class="mt">LinkedIn</em></strong></a><strong class="li io"><em class="mt"/></strong><a class="ae mu" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="li io"><em class="mt">YouTube</em></strong></a><strong class="li io"><em class="mt">，以及</em></strong><em class="mt"/><a class="ae mu" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="li io"><em class="mt">不和</em> </strong> </a>T57】</p><p id="d506" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated"><strong class="li io"> <em class="mt">用</em> </strong> <a class="ae mu" href="https://circuit.ooo/?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="li io"> <em class="mt">电路</em> </strong> </a> <em class="mt">为你的科技创业建立认知和采用。</em></p></div></div>    
</body>
</html>