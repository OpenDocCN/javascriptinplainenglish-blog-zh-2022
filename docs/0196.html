<html>
<head>
<title>Set Up Jest and React Testing Library for Unit Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为单元测试建立Jest和React测试库</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/setup-jest-and-react-testing-library-for-unit-testing-9be43df32fd5?source=collection_archive---------3-----------------------#2022-01-12">https://javascript.plainenglish.io/setup-jest-and-react-testing-library-for-unit-testing-9be43df32fd5?source=collection_archive---------3-----------------------#2022-01-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/33e421b018545ac3bc226780f18a9c3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lTmimHv_uuvdRWCnxzrCMA.png"/></div></div></figure><p id="5354" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">自从<code class="fe kt ku kv kw b">create-react-app</code>成为一个流行的工具，许多关于React的教程都把它作为入门。但是我决定自己建立环境来学习<code class="fe kt ku kv kw b">create-react-app</code>为我们做了什么，并确保我们也可以建立测试环境而不依赖于工具。</p><p id="b516" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我观察了流行的starter项目，并获取了我需要的代码，以确保我以最佳实践编写这些设置。因此，你会看到一些来自<code class="fe kt ku kv kw b">create-react-app</code>的代码。</p><h1 id="0d33" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">演示</strong>储存库</h1><p id="35c5" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">如果你想看一个完整的例子，我创建了一个样板用于演示:<a class="ae ma" href="https://github.com/tabsteveyang/react-jest-rtl-boilerplate" rel="noopener ugc nofollow" target="_blank">https://github.com/tabsteveyang/react-jest-rtl-boilerplate</a></p><h1 id="cb7f" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">设置配置</strong></h1><h2 id="39a7" class="mb ky in bd kz mc md dn ld me mf dp lh kg mg mh ll kk mi mj lp ko mk ml lt mm bi translated"><strong class="ak">依赖关系</strong></h2><p id="7ed6" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">这些是你需要的包裹。您可以单独安装它，或者将下面的代码添加到package.json文件的devDependencies块中，然后一起安装它们:</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="784c" class="mb ky in kw b gy mv mw l mx my">"babel-preset-react-app": "^10.0.0",<br/>"react-app-polyfill": "^2.0.0",<br/>"react-test-renderer": "^17.0.2",   // (optional) for snapshot test<br/>"redux-mock-store": "^1.5.4",       // (optional) for mocking redux<br/>"babel-jest": "^26.6.0",<br/>"@testing-library/jest-dom": "^5.14.1",<br/>"@testing-library/react": "^11.2.7",<br/>"@testing-library/user-event": "^12.8.3",<br/>"jest": "26.6.0",<br/>"jest-circus": "26.6.0",<br/>"jest-resolve": "26.6.0",<br/>"jest-watch-typeahead": "0.6.1"</span></pre><h2 id="083b" class="mb ky in bd kz mc md dn ld me mf dp lh kg mg mh ll kk mi mj lp ko mk ml lt mm bi translated"><strong class="ak">入口点</strong></h2><h2 id="ad45" class="mb ky in bd kz mc md dn ld me mf dp lh kg mg mh ll kk mi mj lp ko mk ml lt mm bi translated"><strong class="ak"> 1。入口点的文件</strong></h2><p id="fa98" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">这是JS文件，用于设置env变量，从命令中接收参数，并要求Jest开始运行测试</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="4408" class="mb ky in kw b gy mv mw l mx my">// jest/scripts/test.js</span><span id="8cd7" class="mb ky in kw b gy mz mw l mx my">process.env.BABEL_ENV = 'test'<br/>process.env.NODE_ENV = 'test'<br/>process.env.PUBLIC_URL = ''</span><span id="b39b" class="mb ky in kw b gy mz mw l mx my">const jest = require('jest')<br/>const argv = process.argv.slice(2)<br/>jest.run(argv)</span></pre><h2 id="e428" class="mb ky in bd kz mc md dn ld me mf dp lh kg mg mh ll kk mi mj lp ko mk ml lt mm bi translated">2.更新脚本</h2><p id="ed49" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">更新package.json文件中脚本块的test属性，这样我们就可以简单地运行`【T3 ]'来开始测试:</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="7924" class="mb ky in kw b gy mv mw l mx my">"scripts": {<br/>  "test": "node jest/scripts/test.js",<br/>}</span></pre><h2 id="fcae" class="mb ky in bd kz mc md dn ld me mf dp lh kg mg mh ll kk mi mj lp ko mk ml lt mm bi translated"><strong class="ak"> 3。用于转换的JS文件</strong></h2><p id="2f9b" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">这些是将特定扩展名的文件转换成Jest可以使用的格式的JS文件:</p><ul class=""><li id="75ce" class="na nb in jx b jy jz kc kd kg nc kk nd ko ne ks nf ng nh ni bi translated">babelTransform.js</li></ul><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="479a" class="mb ky in kw b gy mv mw l mx my">'use strict'</span><span id="5a78" class="mb ky in kw b gy mz mw l mx my">const babelJest = require('babel-jest')<br/>const hasJsxRuntime = (() =&gt; {<br/>  if (process.env.DISABLE_NEW_JSX_TRANSFORM === 'true') {<br/>    return false<br/>  }</span><span id="7a16" class="mb ky in kw b gy mz mw l mx my">  try {<br/>    require.resolve('react/jsx-runtime')<br/>    return true<br/>  } catch (e) {<br/>    return false<br/>  }<br/>})()</span><span id="c798" class="mb ky in kw b gy mz mw l mx my">module.exports = babelJest.createTransformer({<br/>  presets: [<br/>    [<br/>      require.resolve('babel-preset-react-app'),<br/>      {<br/>        runtime: hasJsxRuntime ? 'automatic' : 'classic'<br/>      }<br/>    ]<br/>  ],<br/>  babelrc: false,<br/>  configFile: false<br/>})</span></pre><ul class=""><li id="5b67" class="na nb in jx b jy jz kc kd kg nc kk nd ko ne ks nf ng nh ni bi translated">cssTransform.js</li></ul><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="4adc" class="mb ky in kw b gy mv mw l mx my">'use strict'</span><span id="c11d" class="mb ky in kw b gy mz mw l mx my">// This is a custom Jest transformer turning style imports into empty objects.<br/>// <a class="ae ma" href="http://facebook.github.io/jest/docs/en/webpack.html" rel="noopener ugc nofollow" target="_blank">http://facebook.github.io/jest/docs/en/webpack.html</a></span><span id="eb6b" class="mb ky in kw b gy mz mw l mx my">module.exports = {<br/>  process() {<br/>    return 'module.exports = {};'<br/>  },<br/>  getCacheKey() {<br/>    // The output is always the same.<br/>    return 'cssTransform'<br/>  }<br/>}</span></pre><ul class=""><li id="8b87" class="na nb in jx b jy jz kc kd kg nc kk nd ko ne ks nf ng nh ni bi translated">文件转换. js</li></ul><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="b541" class="mb ky in kw b gy mv mw l mx my">'use strict'</span><span id="a7bf" class="mb ky in kw b gy mz mw l mx my">const path = require('path')<br/>const camelcase = require('camelcase')</span><span id="dd23" class="mb ky in kw b gy mz mw l mx my">// This is a custom Jest transformer turning file imports into filenames.<br/>// <a class="ae ma" href="http://facebook.github.io/jest/docs/en/webpack.html" rel="noopener ugc nofollow" target="_blank">http://facebook.github.io/jest/docs/en/webpack.html</a></span><span id="911f" class="mb ky in kw b gy mz mw l mx my">module.exports = {<br/>  process(src, filename) {<br/>    const assetFilename = JSON.stringify(path.basename(filename))</span><span id="b9db" class="mb ky in kw b gy mz mw l mx my">if (filename.match(/\.svg$/)) {<br/>      // Based on how SVGR generates a component name:<br/>      // <a class="ae ma" href="https://github.com/smooth-code/svgr/blob/01b194cf967347d43d4cbe6b434404731b87cf27/packages/core/src/state.js#L6" rel="noopener ugc nofollow" target="_blank">https://github.com/smooth-code/svgr/blob/01b194cf967347d43d4cbe6b434404731b87cf27/packages/core/src/state.js#L6</a><br/>      const pascalCaseFilename = camelcase(path.parse(filename).name, {<br/>        pascalCase: true<br/>      })<br/>      const componentName = `Svg${pascalCaseFilename}`<br/>      return `const React = require('react');<br/>      module.exports = {<br/>        __esModule: true,<br/>        default: ${assetFilename},<br/>        ReactComponent: React.forwardRef(function ${componentName}(props, ref) {<br/>          return {<br/>            $$typeof: Symbol.for('react.element'),<br/>            type: 'svg',<br/>            ref: ref,<br/>            key: null,<br/>            props: Object.assign({}, props, {<br/>              children: ${assetFilename}<br/>            })<br/>          };<br/>        }),<br/>      };`<br/>    }</span><span id="5d49" class="mb ky in kw b gy mz mw l mx my">return `module.exports = ${assetFilename};`<br/>  }<br/>}</span></pre><h2 id="e3f9" class="mb ky in bd kz mc md dn ld me mf dp lh kg mg mh ll kk mi mj lp ko mk ml lt mm bi translated"><strong class="ak"> 4。在运行任何测试之前运行的JS文件</strong></h2><p id="f8be" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">创建一个文件来存放在运行测试之前应该运行的所有逻辑。它通常被称为setupTests.js，文件中的代码应该是这样的:</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="8474" class="mb ky in kw b gy mv mw l mx my">// import the modules that most tests will need<br/>import '<a class="ae ma" href="http://twitter.com/testing" rel="noopener ugc nofollow" target="_blank">@testing</a>-library/jest-dom'<br/>import React from 'react'<br/>import ReactDom from 'react-dom'<br/>import PropTypes from 'prop-types'</span><span id="1b12" class="mb ky in kw b gy mz mw l mx my">// if there are some settings like below in your webpack.config.js, you can mock it in this way:<br/>// new webpack.ProvidePlugin({<br/>//   React: 'react',<br/>//   ReactDom: 'react-dom',<br/>//   PropTypes: 'prop-types'<br/>// })<br/>global.React = React<br/>global.ReactDom = ReactDom<br/>global.PropTypes = PropTypes</span></pre><h2 id="4698" class="mb ky in bd kz mc md dn ld me mf dp lh kg mg mh ll kk mi mj lp ko mk ml lt mm bi translated"><strong class="ak"> 5。笑话配置</strong></h2><p id="c23f" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">完成上述步骤后，我们终于可以编写Jest的配置并将所有这些设置链接在一起了！</p><p id="7441" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">根据文档，您可以将Jest的配置放在package.json文件或jest.config.js文件中。我决定将设置放在jest.config.js文件中，以防我需要在配置中使用一些变量，并保持package.json文件整洁。</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="0f1e" class="mb ky in kw b gy mv mw l mx my">module.exports = {<br/>  roots: [<br/>    '&lt;rootDir&gt;/src'<br/>  ],<br/>  collectCoverageFrom: [<br/>    'src/**/*.{js,jsx,ts,tsx}',<br/>    '!src/**/*.d.ts'<br/>  ],<br/>  setupFiles: [<br/>    'react-app-polyfill/jsdom'<br/>  ],<br/>  setupFilesAfterEnv: [<br/>    '&lt;rootDir&gt;/jest/scripts/setupTests.js'<br/>  ],<br/>  testMatch: [<br/>    '&lt;rootDir&gt;/src/**/__tests__/**/*.{js,jsx,ts,tsx}',<br/>    '&lt;rootDir&gt;/src/**/*.{spec,test}.{js,jsx,ts,tsx}'<br/>  ],<br/>  testEnvironment: 'jsdom',<br/>  transform: {<br/>    '^.+\\.(js|jsx|mjs|cjs|ts|tsx)$': '&lt;rootDir&gt;/jest/transforms/babelTransform.js',<br/>    '^.+\\.css$': '&lt;rootDir&gt;/jest/transforms/cssTransform.js',<br/>    '^(?!.*\\.(js|jsx|mjs|cjs|ts|tsx|css|json)$)': '&lt;rootDir&gt;/jest/transforms/fileTransform.js'<br/>  },<br/>  transformIgnorePatterns: [<br/>    '[/\\\\]node_modules[/\\\\].+\\.(js|jsx|mjs|cjs|ts|tsx)$',<br/>    '^.+\\.module\\.(css|sass|scss)$'<br/>  ],<br/>  modulePaths: [],<br/>  moduleFileExtensions: [<br/>    'web.js',<br/>    'js',<br/>    'web.ts',<br/>    'ts',<br/>    'web.tsx',<br/>    'tsx',<br/>    'json',<br/>    'web.jsx',<br/>    'jsx',<br/>    'node'<br/>  ],<br/>  watchPlugins: [<br/>    'jest-watch-typeahead/filename',<br/>    'jest-watch-typeahead/testname'<br/>  ],<br/>  resetMocks: true<br/>}</span></pre><p id="7a6b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">假设您在webpack.config.js文件中声明了某个别名。在这种情况下，您可能还需要添加moduleNameMapper的设置，以使别名在运行测试时起作用:</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="fe0d" class="mb ky in kw b gy mv mw l mx my">moduleNameMapper: {<br/>  '^<a class="ae ma" href="http://twitter.com/js" rel="noopener ugc nofollow" target="_blank">@js</a>(.*)$': '&lt;rootDir&gt;/src/js$1',<br/>  '^<a class="ae ma" href="http://twitter.com/scss" rel="noopener ugc nofollow" target="_blank">@scss</a>(.*)$': '&lt;rootDir&gt;/src/scss$1',<br/>  '^<a class="ae ma" href="http://twitter.com/img" rel="noopener ugc nofollow" target="_blank">@img</a>(.*)$': '&lt;rootDir&gt;/img$1'<br/>},</span></pre><h1 id="f13f" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">用于</strong>检查设置的第一个测试文件</h1><p id="19b6" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">最后，在完成所有设置后，我们现在可以创建一个简单的测试文件来确保它按预期工作。</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="8019" class="mb ky in kw b gy mv mw l mx my">// src/js/components/_tests_/TestPage.test.jsx,<br/>// for testing: src/js/components/TestPage.jsx file.</span><span id="88ca" class="mb ky in kw b gy mz mw l mx my">import { render, screen } from '<a class="ae ma" href="http://twitter.com/testing" rel="noopener ugc nofollow" target="_blank">@testing</a>-library/react'<br/>import TestPage from '../TestPage'</span><span id="b3f7" class="mb ky in kw b gy mz mw l mx my">test('renders Hello World', () =&gt; {<br/>  render(&lt;TestPage /&gt;)<br/>  const linkElement = screen.getByText(/Hello World/i)<br/>  expect(linkElement).toBeInTheDocument()<br/>})</span></pre><p id="346c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">并在命令行中运行命令开始测试:</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="8764" class="mb ky in kw b gy mv mw l mx my">cd &lt;project_path&gt;<br/>npm run test</span></pre><p id="4b33" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要与Jest交互，您可以运行以下代码:</p><p id="642d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">测试后该过程不会终止；它将等待您的命令，直到您关闭它。</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="1098" class="mb ky in kw b gy mv mw l mx my">node run test -- --watch</span><span id="e038" class="mb ky in kw b gy mz mw l mx my">or</span><span id="4535" class="mb ky in kw b gy mz mw l mx my">node jest/scripts/test.js --watch</span></pre><p id="c9f3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您得到下面的回复，一切都准备好了！</p><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/c424d6f416e3db5f98186c36d869105d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*OR4QkIXxLm_xyaZwUT5iGQ.png"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk">PASS!</figcaption></figure><h1 id="0f8d" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">结束</strong></h1><p id="faa9" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">为React组件的单元测试建立环境不是一件简单的任务，所以当我最终想出如何让它工作时，我决定写下步骤。</p><p id="19ae" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">不幸的是，编写测试也很棘手。尽管试着弄清楚如何处理它很有趣，但我仍然希望我能得到更多的例子来说明我实际上可以为测试特定场景做些什么。因此，我将写另一篇文章来分享我在与它斗争中获得的经验😆</p><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/6674fbbfbedea5c565ba186b2b1a763b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oghIk3TOpT328ONz82lzfw.png"/></div></div></figure><p id="c174" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="np">更内容于</em> <a class="ae ma" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="np">通俗地说就是</em> </strong> </a> <em class="np">。报名参加我们的</em> <a class="ae ma" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="np">免费周报</em> </strong> </a> <em class="np">。在我们的</em> <a class="ae ma" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="np">社区纠纷</em> </strong> </a> <em class="np">中获得独家写作机会和建议。</em></p></div></div>    
</body>
</html>