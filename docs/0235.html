<html>
<head>
<title>Why You Shouldn’t Use Angular Pipes With Inputs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么不应该使用带输入的角形管道</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/why-you-shouldnt-use-angular-pipes-with-inputs-8dc1d0e9039d?source=collection_archive---------0-----------------------#2022-01-14">https://javascript.plainenglish.io/why-you-shouldnt-use-angular-pipes-with-inputs-8dc1d0e9039d?source=collection_archive---------0-----------------------#2022-01-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e292" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用户输入时设置输入格式的正确方法。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4e1180726672ccf610942cfe68d2f517.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wdvrgfH1aCbOMXwt5o4kUw.png"/></div></div></figure><h1 id="fdcd" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">问题是</h1><p id="0077" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">问题很简单:我有一个输入用户电话号码的表单。我想在用户键入时设置电话号码的格式。管道显然是首选。毕竟，文件上说:</p><blockquote class="mf mg mh"><p id="a139" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">使用<a class="ae mr" href="https://angular.io/guide/glossary#pipe" rel="noopener ugc nofollow" target="_blank">管道</a>来转换字符串、货币金额、日期和其他显示数据。</p></blockquote><p id="2217" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">所以我用一些正则表达式创建了一个简单的管道，并将其插入到我的输入中。我的管道的转换函数看起来像这样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="ca91" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">我的HTML看起来像这样:</p><pre class="kg kh ki kj gt mu mv mw mx aw my bi"><span id="5142" class="mz ks iq mv b gy na nb l nc nd">&lt;input <em class="mi">type=</em>"tel" <em class="mi">[(ngModel)]=</em>"value | phoneInput"&gt;</span></pre><p id="4557" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">但是，此方法会导致错误:“动作表达式中不能有管道。”因为我在ngModel上使用双向数据绑定，所以我基本上是在尝试格式化输入而不是输出。</p><p id="880c" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">很公平。接下来，我尝试拆分ngModel，以便我可以只在输出上使用管道，如下所示:</p><pre class="kg kh ki kj gt mu mv mw mx aw my bi"><span id="9afd" class="mz ks iq mv b gy na nb l nc nd">&lt;input <em class="mi">type=</em>"tel" <em class="mi">[ngModel]=</em>"value | phoneInput (ngModelChange)="value = $event"&gt;</span></pre><p id="5b19" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">现在，反射的“值”应该由phoneInput管道格式化显示，同时仍然通过<code class="fe ne nf ng mv b">ngModelChange</code>绑定。</p><p id="5e46" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">成功了。差不多了。电话号码的格式应该正确，键入“999”将得到“(999)”，键入“1234567890”将得到“(123)456–7890”，依此类推。但是，如果你试图在正常的10位数之后继续输入，问题就来了。</p><p id="abd4" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">即使我的管道代码用<code class="fe ne nf ng mv b">substr()</code>函数将输入调整到10位数，输出也不会反映出来。键入“1234567890000”将得到“(123)456–7890000”，而不会像预期的那样对其进行修整。但是为什么呢？</p><p id="a79f" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">经过一番调查，我找到了答案。Angular有一个精确的顺序来执行管道转换、变化检测等。因为“1234567890”和“1234567890000”的输入都被调整为完全相同的输出，所以没有检测到要显示到输入的更改，因此输入的值不会更改以反映正确的值。</p><p id="a58a" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">进一步的研究表明，有两种方法可以正确实现我们想要的电话输入屏蔽:<strong class="ll ir">使用角形表单</strong>创建自定义表单组件，或者<strong class="ll ir">通过使用指令</strong>坚持模板驱动模型。由于我正在开发的应用程序并不围绕着形体，我看不出有什么理由要深入到有棱角的形体世界中去。</p><h1 id="9061" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">解决方案</h1><p id="ab4e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">模板驱动设计的解决方案非常简单。我们将管道正在执行的功能转换成一个指令，并将该指令附加到输入中。</p><p id="df7d" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">我的指令是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="a447" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">转换函数与上面的管道示例完全相同。该指令还有一个HostListener来捕获输入上的按键，并相应地更新显示的值。</p><p id="3ac9" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">我的指令肯定有改进的空间，但它完成了工作。更重要的是，它提供了关于管道如何工作以及何时使用指令的有价值的见解。</p><p id="b603" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">现在，输入会随着用户的键入而格式化，并且还可以防止超出最大位数的键入。</p></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><p id="6af5" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">有燃角问题？给我发一封电子邮件，我可能会写下来。</p><h2 id="4656" class="mz ks iq bd kt no np dn kx nq nr dp lb ls ns nt ld lw nu nv lf ma nw nx lh ny bi translated"><strong class="ak">延伸阅读:</strong></h2><div class="nz oa gp gr ob oc"><a href="https://angular.io/guide/pipes" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">有角的</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">Angular是一个构建移动和桌面web应用程序的平台。加入数百万开发者的社区…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">angular.io</p></div></div></div></a></div><div class="nz oa gp gr ob oc"><a href="https://angular.io/guide/forms-overview" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">有角的</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">Angular是一个构建移动和桌面web应用程序的平台。加入数百万开发者的社区…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">angular.io</p></div></div></div></a></div><p id="8389" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated"><em class="mi">更多内容看</em> <a class="ae mr" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir"> <em class="mi">说白了。报名参加我们的</em> <a class="ae mr" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir"> <em class="mi">免费周报</em> </strong> </a> <em class="mi">。在我们的</em> <a class="ae mr" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir"> <em class="mi">社区获得独家访问写作机会和建议</em> </strong> </a> <em class="mi">。</em></strong></a></p></div></div>    
</body>
</html>