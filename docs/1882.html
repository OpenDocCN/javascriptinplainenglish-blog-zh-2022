<html>
<head>
<title>Mock Your Hooks to Make Testing Simpler</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模仿你的钩子来简化测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/mock-your-hooks-to-make-testing-simpler-d405ed4cf30b?source=collection_archive---------0-----------------------#2022-04-27">https://javascript.plainenglish.io/mock-your-hooks-to-make-testing-simpler-d405ed4cf30b?source=collection_archive---------0-----------------------#2022-04-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5344" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用笑话来嘲讽会有一个奇怪的学习曲线。让我们看看如何嘲笑那些钩子。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6dbc992117bca6549ad9d928cd59cf69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p5UT-PsHc6zkbg3x4hZi_A.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by Steve Johnson: <a class="ae kv" href="https://www.pexels.com/photo/selective-focus-of-stainless-steel-hook-1256916/" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/photo/selective-focus-of-stainless-steel-hook-1256916/</a></figcaption></figure><p id="8eed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将对<strong class="ky ir">模仿我们的钩子</strong>感兴趣，以使我们的react组件的<strong class="ky ir">测试更容易</strong>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="8cfd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">React中单元测试的目标是能够测试特定文件<strong class="ky ir">中的所有内容，而不受另一个模块</strong>的任何干扰。</p><blockquote class="lz"><p id="da74" class="ma mb iq bd mc md me mf mg mh mi lr dk translated">嘲讽允许我们通过忽略其他模块的逻辑并强制它们返回一个特定的值来保持其他模块的结果不变。</p></blockquote><p id="3282" class="pw-post-body-paragraph kw kx iq ky b kz mj jr lb lc mk ju le lf ml lh li lj mm ll lm ln mn lp lq lr ij bi translated">所以让我们开始吧！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="a1db" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">做好准备</h1><blockquote class="ng nh ni"><p id="8d41" class="kw kx nj ky b kz la jr lb lc ld ju le nk lg lh li nl lk ll lm nm lo lp lq lr ij bi translated">出于本文的考虑，我将假设您有一个用Jest和React测试库设置的React环境。如果没有，网上有很多教程可以帮助你快速设置！</p></blockquote><p id="2263" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在开始我们的教程之前，我们将准备一些文件。</p><p id="3404" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们需要一个钩子来模仿:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="5a04" class="ns mp iq no b gy nt nu l nv nw">// useNumber.js<br/>const useNumber = () =&gt; {<br/>    return 4;<br/>}<br/>export default useNumber;</span></pre><p id="cece" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里我们想保持简单，只是一个简单的名为<code class="fe nx ny nz no b">useNumber</code>并返回数字4的“钩子”。我们不需要更多的复杂性！</p><p id="5ee3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后我们需要一个使用这个钩子的React组件:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="8f2a" class="ns mp iq no b gy nt nu l nv nw">// App.js<br/>import useNumber from './useNumber';<br/><br/>function App() {<br/>  const number = useNumber();<br/>  return (<br/>    &lt;div&gt;<br/>      {number}<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="131d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里再一次，非常简单的组件，我们不需要更多的东西！</p><p id="c319" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们正在编写测试。正如我们在嘲讽钩子一样，我们的最终目标是我们的钩子不要返回4:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="e320" class="ns mp iq no b gy nt nu l nv nw">// App.test.js<br/>import {render} from '@testing-library/react';<br/>import App from './App';<br/><br/>describe('App', () =&gt; {<br/>    it('The hook should be mocked', () =&gt; {<br/>        const {queryByText} = render(&lt;App /&gt;);<br/>        expect(queryByText('3')).not.toBeNull();<br/>        expect(queryByText('4')).toBeNull();<br/>    })<br/>})</span></pre><p id="752b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们准备开始了！</p><h1 id="1cf1" class="mo mp iq bd mq mr oa mt mu mv ob mx my jw oc jx na jz od ka nc kc oe kd ne nf bi translated">方法1:在顶层嘲讽</h1><p id="ad49" class="pw-post-body-paragraph kw kx iq ky b kz of jr lb lc og ju le lf oh lh li lj oi ll lm ln oj lp lq lr ij bi translated">在这篇文章中，我们将以两种不同的方式嘲笑我们的钩子。 <em class="nj">(我会在文末说挑哪个。敬请期待！)</em></p><p id="70f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一种方法是<strong class="ky ir">在测试的顶层模仿我们的钩子</strong>。这样做将使这个文件中的所有测试都能够进行模拟。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="3355" class="ns mp iq no b gy nt nu l nv nw"><strong class="no ir"><em class="nj">jest</em></strong>.mock('./useNumber', () =&gt; {<br/>    return () =&gt; 3;<br/>});<br/><br/>describe('App', () =&gt; {<br/>    it('The hook should be mocked', () =&gt; {<br/>        const {queryByText} = render(&lt;App /&gt;);<br/>        expect(queryByText('3')).not.toBeNull();<br/>        expect(queryByText('4')).toBeNull();<br/>    })<br/>})</span></pre><p id="570b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们使用<code class="fe nx ny nz no b">jest.mock</code>来模仿。作为第一个参数，它获取要模拟的文件的路径。</p><blockquote class="ng nh ni"><p id="07a0" class="kw kx nj ky b kz la jr lb lc ld ju le nk lg lh li nl lk ll lm nm lo lp lq lr ij bi translated">请记住，如果您的测试文件与要模拟的文件不在同一级别，那么路径将会不同。相对路径总是相对于测试文件，而不是被测试的组件。</p></blockquote><p id="230c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nx ny nz no b">jest.mock</code>采用的第二个参数是新模块(模拟模块)的实现。它的结构总是这样:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="f638" class="ns mp iq no b gy nt nu l nv nw">() =&gt; &lt;implementation&gt;</span></pre><p id="abd1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一个箭头函数称为<code class="fe nx ny nz no b">factory</code>，需要返回新的实现。执行以下操作无效:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="81bc" class="ns mp iq no b gy nt nu l nv nw"><strong class="no ir"><em class="nj">jest</em></strong>.mock('./useNumber', {<br/>    return () =&gt; 3;<br/>});</span></pre><p id="1132" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在回到我们的新实现，我们正在返回一个新函数(钩子是一个函数！)也就是返回3。</p><p id="8fab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始了。我们的钩子现在被嘲笑了！试一试吧，你的考试会通过的！</p><h1 id="d00d" class="mo mp iq bd mq mr oa mt mu mv ob mx my jw oc jx na jz od ka nc kc oe kd ne nf bi translated">方法2:模拟每个测试</h1><p id="9878" class="pw-post-body-paragraph kw kx iq ky b kz of jr lb lc og ju le lf oh lh li lj oi ll lm ln oj lp lq lr ij bi translated">还有另一种方法来模仿你的钩子，那就是在<strong class="ky ir">测试级别</strong>。这种模拟将是每个测试都有的，并且允许你根据你的测试得到不同的返回值。</p><p id="ce4c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们需要对我们的<code class="fe nx ny nz no b">jest.mock</code>调用做一个小小的改变:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="bb1b" class="ns mp iq no b gy nt nu l nv nw"><strong class="no ir"><em class="nj">jest</em></strong>.mock('./useNumber');</span></pre><p id="59dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如您所见，我<strong class="ky ir">删除了第二个参数</strong>，因为我们将在测试中直接模拟实现。</p><blockquote class="ng nh ni"><p id="3c01" class="kw kx nj ky b kz la jr lb lc ld ju le nk lg lh li nl lk ll lm nm lo lp lq lr ij bi translated">注意，删除默认值<strong class="ky ir">不会将原始钩子设置为默认值</strong>。取而代之的是，钩子会被自动嘲笑，不会返回任何值。我会在文章的<strong class="ky ir">结尾做更多解释。</strong></p></blockquote><p id="50b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们需要在测试中直接模拟钩子的返回值:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="f370" class="ns mp iq no b gy nt nu l nv nw">import useNumber from './useNumber'<br/>...<br/>it('The hook should be mocked', () =&gt; {<br/>    useNumber.mockReturnValue(3);<br/>    const {queryByText} = render(&lt;App /&gt;);<br/>    expect(queryByText('3')).not.toBeNull();<br/>    expect(queryByText('4')).toBeNull();<br/>})</span></pre><p id="cf17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始了。现在，我们模拟了钩子的返回值，对于这个特定的测试，它将返回3。</p><p id="1587" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你喜欢，也可以用<code class="fe nx ny nz no b">mockImplementation</code>代替<code class="fe nx ny nz no b">mockReturnValue</code>:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="635c" class="ns mp iq no b gy nt nu l nv nw">useNumber.mockImplementation(() =&gt; 3);</span></pre><blockquote class="ng nh ni"><p id="fad6" class="kw kx nj ky b kz la jr lb lc ld ju le nk lg lh li nl lk ll lm nm lo lp lq lr ij bi translated">请注意我是如何在我们的文件中导入<code class="fe nx ny nz no b">useNumber</code>的。这是因为我需要按照<code class="fe nx ny nz no b">jest.mock</code>所做的模拟来指定一个合适的返回值。</p></blockquote><h1 id="e6d7" class="mo mp iq bd mq mr oa mt mu mv ob mx my jw oc jx na jz od ka nc kc oe kd ne nf bi translated">哪种方法比较好？</h1><p id="aef5" class="pw-post-body-paragraph kw kx iq ky b kz of jr lb lc og ju le lf oh lh li lj oi ll lm ln oj lp lq lr ij bi translated">简单的答案是<strong class="ky ir">没有。</strong></p><p id="98dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不足为奇的是，在软件编程中，<strong class="ky ir">很少有一个问题的答案</strong>。这通常取决于你需要什么。</p><h2 id="5eb0" class="ns mp iq bd mq ok ol dn mu om on dp my lf oo op na lj oq or nc ln os ot ne ou bi translated">第一种方法:静态的、全局的方法</h2><p id="17f2" class="pw-post-body-paragraph kw kx iq ky b kz of jr lb lc og ju le lf oh lh li lj oi ll lm ln oj lp lq lr ij bi translated">第一种方法是<strong class="ky ir">最好的，如果你只想把钩子固定在一个特定的值</strong>上，然后在剩下的测试中忘掉它。它将保持静态，在你的文件的顶部，并将完美地完成这项工作。</p><h2 id="9501" class="ns mp iq bd mq ok ol dn mu om on dp my lf oo op na lj oq or nc ln os ot ne ou bi translated">第二种方法:更灵活，但有代价</h2><p id="fcd7" class="pw-post-body-paragraph kw kx iq ky b kz of jr lb lc og ju le lf oh lh li lj oi ll lm ln oj lp lq lr ij bi translated">如果你想用钩子的返回值来触发组件中不同的行为，第二种方法通常是最好的。对于boolean类型，您可能希望钩子根据测试返回false和true，以确保您的组件适应它。</p><p id="ddec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，这种方法有一个小缺点:你需要确定你为所有的测试定义了返回值 e。在你不这样做的情况下，jest仍然会返回<code class="fe nx ny nz no b">jest.fn</code>，但是它可能会在你的结果中产生一些误报。所以要小心！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="8c87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这篇小文章能帮助你更好地理解这一点！嘲讽有时会有点棘手，因为如果你忘记了某处的箭头功能，Jest可能会向你抛出一些未来错误。但是你从哪里弄来的，其实挺简单的！</p><p id="7125" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望你喜欢这篇文章。如果你看到了，不要犹豫，跟我来或者留下一些掌声，因为它们很有帮助！</p><p id="ef25" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">祝你度过愉快的一天(或一夜，取决于时区)！</p><p id="59c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nj">更多内容请看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="nj">plain English . io</em></strong></a><em class="nj">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nj">免费周报</em> </strong> </a> <em class="nj">。关注我们关于</em><a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="nj">Twitter</em></strong></a><em class="nj">和</em><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="nj">LinkedIn</em></strong></a><em class="nj">。加入我们的</em> <a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nj">社区不和谐</em> </strong> </a> <em class="nj">。</em></p></div></div>    
</body>
</html>