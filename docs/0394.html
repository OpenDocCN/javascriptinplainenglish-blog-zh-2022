<html>
<head>
<title>Develop a Custom useTimer Hook in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中开发一个自定义的useTimer钩子</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/developing-a-custom-usetimer-hook-in-react-18585ea3d24?source=collection_archive---------3-----------------------#2022-01-23">https://javascript.plainenglish.io/developing-a-custom-usetimer-hook-in-react-18585ea3d24?source=collection_archive---------3-----------------------#2022-01-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="cd7a" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">一个小例子，为React应用程序创建一个自定义的useTimer钩子，负责任地绕过恶意的setInterval函数。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/a250b6bf8072a8b00222350d87750658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cN3bcQe15qNX0XW5j3r25w.png"/></div></div></figure><p id="bd19" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">计时器是一些应用程序的基本元素，比如生产力应用程序、游戏、任务管理应用程序等等。我举了一个小例子来为React应用程序创建一个定制的<code class="fe lk ll lm ln b">useTimer</code>钩子，以负责任地绕过JavaScript中恶意的setInterval/setTimeout函数。</p><p id="71e1" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">让我们从样板任务开始:</p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="c192" class="ls lt in ln b gy lu lv l lw lx">npx create-react-app usetimer-hook<br/>cd usetimer-hook</span><span id="20d6" class="ls lt in ln b gy ly lv l lw lx">// Using VSCode for development<br/>code . &amp;&amp; exit</span><span id="4f14" class="ls lt in ln b gy ly lv l lw lx">// Bash in VSCode<br/>npm start</span></pre><p id="1773" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在这里，我使用CRA建立了一个标准的React应用程序，并在退出bash窗口时在VSCode中打开它。接下来，使用VSCode中内置的Bash，我已经开始了我的项目，这将打开浏览器到localhost:3000，我们的React应用程序正在那里运行。我将清除App.js文件中的样板文件。</p><p id="9efc" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">接下来，在src目录中创建一个useTimer.js文件。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/8b7830989b445f688f5817cb210f3536.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*acZPRyTMSfrPffuuIKGnxA.png"/></div></div></figure><p id="7773" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">下面是我们钩子的详细解释:</p><p id="772b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io">第1-10行</strong></p><p id="ce90" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们在这里使用一个内置的<code class="fe lk ll lm ln b">useState</code>钩子用于多种目的。</p><ul class=""><li id="999b" class="lz ma in kq b kr ks ku kv kx mb lb mc lf md lj me mf mg mh bi translated">id:这将是一个状态参数，用于记忆当前运行区间的ID。</li><li id="4cc0" class="lz ma in kq b kr mi ku mj kx mk lb ml lf mm lj me mf mg mh bi translated">状态:这是一个指示变量，用于检查定时器当前是开还是关。</li><li id="2113" class="lz ma in kq b kr mi ku mj kx mk lb ml lf mm lj me mf mg mh bi translated">倒计时(小时，分钟，秒):一个对象，每秒更新一次计时器，以指示剩余时间。</li></ul><p id="083f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io">第14–45行(启动功能)</strong></p><p id="6fdd" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">启动功能将做到这一点，即启动我们的计时器。它接受一个参数，即以秒为单位的总持续时间。或者，您可以提供其他单位的持续时间，并对其调用自定义转换函数。</p><p id="d5f6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">对于第一个if块，它检查是否有其他计时器正在运行。如果是，它会抛出一个错误，说明同样的情况。在下一个if块中，它检查是否提供了持续时间，或者持续时间是否为0，并相应地抛出一个错误。</p><p id="4d5f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="mn">在试块内</em></p><p id="0c4e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们定义了一个局部变量，该变量的值来自我们的duration参数。您可以向参数添加检查，以检查它是否为整数。接下来，我们最后使用JavaScript中内置的<code class="fe lk ll lm ln b">setInterval</code>函数调用一个区间。现在，<code class="fe lk ll lm ln b">setInterval</code>函数返回一个id来惟一地标识它。该id属于数字类型。由于setInterval函数本质上是异步的，所以在调用它之后，我们直接进入下面的语句。我们将id状态设置为计时器id，并将计时器状态设置为“开”。我们返回一个“ok”标志来验证计时器是否成功启动。</p><p id="c9e1" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在，在setInterval函数中，我们通过将interval duration参数设置为1000毫秒(或1秒)来更新每秒后的倒计时状态。我们对计时器变量进行计算，以获得剩余的小时、分钟和秒，并将这些值更新为倒计时状态。</p><p id="f0ef" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在第34行，我们首先将定时器变量减1，然后检查它是否小于0。如果它小于0，我们调用clear函数来清除计时器。</p><p id="f391" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io">第47–58行</strong></p><p id="788e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在clear函数中，我们首先检查是否有定时器在运行，如果没有，我们就返回。</p><p id="31f0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">接下来，使用JavaScript中内置的<code class="fe lk ll lm ln b">clearInterval</code>函数，并使用我们存储的计时器id，我们清除运行间隔，然后刷新我们的状态变量。最后，我们再次返回一个“ok”标志。</p><p id="523b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">然后，我们继续返回这些如此定义的函数和状态。</p><h1 id="3a72" class="mo lt in bd mp mq mr ms mt mu mv mw mx jt my ju mz jw na jx nb jz nc ka nd ne bi translated">使用钩子</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/a250b6bf8072a8b00222350d87750658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cN3bcQe15qNX0XW5j3r25w.png"/></div></div></figure><p id="a57b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">使用钩子非常简单。简单地从我们的<code class="fe lk ll lm ln b">useTimer</code>钩子中提取开始、清除函数和倒计时状态，使用析构。</p><p id="15ff" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在上图中，我们调用了60秒的计时器，即1分钟。</p><p id="5d65" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="mn">希望这是有帮助的！:)<br/>对任何bug，或者缺点做评论。</em></p><p id="1a09" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="mn">更多内容看</em> <a class="ae nf" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="mn">说白了。报名参加我们的</em> <a class="ae nf" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="mn">免费周报</em> </strong> </a> <em class="mn">。在我们的</em> <a class="ae nf" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="mn">社区不和谐</em> </strong> </a> <em class="mn">获得独家获取写作机会和建议。</em></strong></a></p></div></div>    
</body>
</html>