<html>
<head>
<title>How to Download a File Using JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用JavaScript下载文件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-download-a-file-using-javascript-fec4685c0a22?source=collection_archive---------1-----------------------#2022-07-07">https://javascript.plainenglish.io/how-to-download-a-file-using-javascript-fec4685c0a22?source=collection_archive---------1-----------------------#2022-07-07</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="1292" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">使用文件Blob下载文件</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/b4d4914075a48c7b03d7dfee3fb6f8eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ykwEaGZAvVCqVrme.jpg"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Image From <a class="ae kw" href="https://computing.which.co.uk/hc/en-gb/articles/360001287849-How-to-download-software-and-apps-safely" rel="noopener ugc nofollow" target="_blank">Website</a></figcaption></figure><h1 id="774b" class="kx ky ir bd kz la lb lc ld le lf lg lh jx li jy lj ka lk kb ll kd lm ke ln lo bi translated">前言</h1><p id="2f16" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">最近我开发了一个功能，需要在页面上添加一个下载按钮来支持下载CDN上托管的PDF文件。我记得下载一个文件非常简单，基本上和在新标签页打开一个链接一样。但是你想的越简单，在执行过程中遇到的问题就越多。</p><p id="a2ea" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">为了演示下载功能，本文以下载<a class="ae kw" href="https://www.google-analytics.com/analytics.js" rel="noopener ugc nofollow" target="_blank"> Google Analytics JavaScript文件</a>为例。</p><h1 id="be70" class="kx ky ir bd kz la lb lc ld le lf lg lh jx li jy lj ka lk kb ll kd lm ke ln lo bi translated">使用带有下载属性的<a>标签(不起作用)</a></h1><p id="365f" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">下载一个带<code class="fe mq mr ms mt b">&lt;a&gt;</code>标签的文件很简单，只要记得加一个下载属性告诉浏览器下载而不是打开超链接就可以了。</p><pre class="kh ki kj kk gu mu mt mv mw aw mx bi"><span id="530f" class="my ky ir mt b gz mz na l nb nc">&lt;a href="https://www.google-analytics.com/analytics.js" download="file"&gt;download the google analytics javascript file with a tag &lt;/a&gt;</span></pre><p id="f6dc" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">但是它不起作用，因为<code class="fe mq mr ms mt b">download</code>只对<a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="noopener ugc nofollow" target="_blank">同源URL</a>起作用。如果文件不是同一来源，浏览器将打开它，而不是下载它。</p><p id="42e5" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">幸运的是，下载属性支持<code class="fe mq mr ms mt b">blob:</code>方案。</p><h1 id="b0f4" class="kx ky ir bd kz la lb lc ld le lf lg lh jx li jy lj ka lk kb ll kd lm ke ln lo bi translated">使用Blob下载文件</h1><p id="3649" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated"><code class="fe mq mr ms mt b">Blob</code>代表<code class="fe mq mr ms mt b">Binary Large Object</code>，是一种可以存储二进制数据的数据类型。如果我们使用<code class="fe mq mr ms mt b">fetch</code>来请求数据，那么响应可以被转换成blob类型。因此，下载文件的步骤如下:</p><ol class=""><li id="d9aa" class="nd ne ir lr b ls ml lv mm ly nf mc ng mg nh mk ni nj nk nl bi translated">使用<code class="fe mq mr ms mt b">fetch</code> API下载脚本文件。</li><li id="418c" class="nd ne ir lr b ls nm lv nn ly no mc np mg nq mk ni nj nk nl bi translated">将数据转换为blob类型。</li><li id="4ac0" class="nd ne ir lr b ls nm lv nn ly no mc np mg nq mk ni nj nk nl bi translated">使用<code class="fe mq mr ms mt b">URL.createObjectURL()</code>将blob对象转换为字符串。</li><li id="cefa" class="nd ne ir lr b ls nm lv nn ly no mc np mg nq mk ni nj nk nl bi translated">创建一个<code class="fe mq mr ms mt b">&lt;a&gt;</code>元素来下载字符串。</li></ol><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nr ns l"/></div></figure><p id="2d27" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">使用功能下载:</p><pre class="kh ki kj kk gu mu mt mv mw aw mx bi"><span id="d343" class="my ky ir mt b gz mz na l nb nc">downloadFile('<a class="ae kw" href="https://www.google-analytics.com/analytics.js'" rel="noopener ugc nofollow" target="_blank">https://www.google-analytics.com/analytics.js'</a>, 'gooleAnalytics.js')</span></pre><p id="da8d" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">您可以在CodePen上测试:</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nt ns l"/></div></figure><h1 id="c90a" class="kx ky ir bd kz la lb lc ld le lf lg lh jx li jy lj ka lk kb ll kd lm ke ln lo bi translated">结论</h1><p id="80be" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">通过请求下载文件并将其转换为blob形式，可以避免浏览器的跨域限制，但在下载大文件时，可能需要很长时间，需要主动提示用户，以免被认为是bug。</p></div><div class="ab cl nu nv hv nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ik il im in io"><p id="5762" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">还有其他一些下载文件的方法:</p><div class="ob oc gq gs od oe"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-download-files-with-javascript-996b8a025d3f"><div class="of ab fp"><div class="og ab oh cl cj oi"><h2 class="bd is gz z fq oj fs ft ok fv fx iq bi translated">如何用JavaScript下载文件</h2><div class="ol l"><h3 class="bd b gz z fq oj fs ft ok fv fx dk translated">通过JavaScript下载文件的三种方式</h3></div><div class="om l"><p class="bd b dl z fq oj fs ft ok fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="on l"><div class="oo l op oq or on os kq oe"/></div></div></a></div><h1 id="2289" class="kx ky ir bd kz la lb lc ld le lf lg lh jx li jy lj ka lk kb ll kd lm ke ln lo bi translated">参考</h1><ol class=""><li id="46fa" class="nd ne ir lr b ls lt lv lw ly ot mc ou mg ov mk ni nj nk nl bi translated"><a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL" rel="noopener ugc nofollow" target="_blank">URL . createobjecturl()—Web API | MDN(mozilla.org)</a></li><li id="d80d" class="nd ne ir lr b ls nm lv nn ly no mc np mg nq mk ni nj nk nl bi translated"><a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a" rel="noopener ugc nofollow" target="_blank"> &lt; a &gt;:锚元素— HTML:超文本标记语言| MDN(mozilla.org)</a></li><li id="d906" class="nd ne ir lr b ls nm lv nn ly no mc np mg nq mk ni nj nk nl bi translated"><a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="noopener ugc nofollow" target="_blank">同源策略—网络安全| MDN(mozilla.org)</a></li></ol><p id="2101" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated"><em class="ow">更多内容看</em> <a class="ae kw" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lr is"> <em class="ow">说白了。报名参加我们的</em> <a class="ae kw" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lr is"> <em class="ow">免费周报</em> </strong> </a> <em class="ow">。关注我们关于</em> <a class="ae kw" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="lr is"> <em class="ow">推特</em></strong></a><strong class="lr is"><em class="ow"/></strong><em class="ow">和</em><a class="ae kw" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="lr is"><em class="ow">LinkedIn</em></strong></a><em class="ow">。查看我们的</em><strong class="lr is"><em class="ow"/></strong><a class="ae kw" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="lr is"><em class="ow">社区不和谐</em> </strong> </a> <em class="ow">加入我们的</em> <a class="ae kw" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="lr is"> <em class="ow">人才集体</em> </strong> </a> <em class="ow">。</em></strong></a></p></div></div>    
</body>
</html>