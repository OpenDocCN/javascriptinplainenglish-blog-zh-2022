<html>
<head>
<title>Why parseInt(0.0000001) !== 0?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么parseInt(0.0000001)！== 0?</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/why-parseint-0-0000001-0-8fe1aec15d8b?source=collection_archive---------12-----------------------#2022-07-05">https://javascript.plainenglish.io/why-parseint-0-0000001-0-8fe1aec15d8b?source=collection_archive---------12-----------------------#2022-07-05</a></blockquote><div><div class="fc ic id ie if ig"/><div class="ih ii ij ik il"><div class=""/><div class=""><h2 id="0275" class="pw-subtitle-paragraph jl in io bd b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc dk translated">JavaScript隐式类型转换和科学符号。</h2></div><figure class="ke kf kg kh gu ki gi gj paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gi gj kd"><img src="../Images/3d447f0ef751bac014d5c5e8a939811c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JCNWfo5KjCsNFvjzlKiRLg.png"/></div></div></figure><h1 id="a2cc" class="kp kq io bd kr ks kt ku kv kw kx ky kz ju la jv lb jx lc jy ld ka le kb lf lg bi translated">前言</h1><p id="fb70" class="pw-post-body-paragraph lh li io lj b lk ll jp lm ln lo js lp lq lr ls lt lu lv lw lx ly lz ma mb mc ih bi translated">开发项目时出现了一个特殊的错误。后端给出的数据字段由字符串类型改为数字类型。在某些极端情况下，前端显示会出现问题。</p><p id="90ce" class="pw-post-body-paragraph lh li io lj b lk md jp lm ln me js lp lq mf ls lt lu mg lw lx ly mh ma mb mc ih bi translated">前面的数据是<code class="fe mi mj mk ml b">‘0.0000001’</code>，我们用<code class="fe mi mj mk ml b">parseInt</code>来取整数。</p><pre class="ke kf kg kh gu mm ml mn mo aw mp bi"><span id="c70b" class="mq kq io ml b gz mr ms l mt mu">parseInt('0.0000001') // equal 0, right.</span></pre><p id="5bfa" class="pw-post-body-paragraph lh li io lj b lk md jp lm ln me js lp lq mf ls lt lu mg lw lx ly mh ma mb mc ih bi translated">当字段类型改变时，我们得到<code class="fe mi mj mk ml b">0.0000001</code>，有问题:</p><pre class="ke kf kg kh gu mm ml mn mo aw mp bi"><span id="663f" class="mq kq io ml b gz mr ms l mt mu">parseInt(0.0000001) // expect 0, but equal 1</span></pre><h1 id="d9a2" class="kp kq io bd kr ks kt ku kv kw kx ky kz ju la jv lb jx lc jy ld ka le kb lf lg bi translated">为什么parseInt(0.0000001) === 1？</h1><p id="5f62" class="pw-post-body-paragraph lh li io lj b lk ll jp lm ln lo js lp lq lr ls lt lu lv lw lx ly lz ma mb mc ih bi translated">为了解决这个问题，我们首先需要了解<a class="ae mv" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/parseInt" rel="noopener ugc nofollow" target="_blank"> parseInt </a>的用法。parseInt的语法:</p><pre class="ke kf kg kh gu mm ml mn mo aw mp bi"><span id="ccfd" class="mq kq io ml b gz mr ms l mt mu">parseInt(string)<br/>parseInt(string, radix)</span></pre><p id="fbb2" class="pw-post-body-paragraph lh li io lj b lk md jp lm ln me js lp lq mf ls lt lu mg lw lx ly mh ma mb mc ih bi translated"><code class="fe mi mj mk ml b">parseInt</code>接受字符串参数，如果参数不是字符串，将使用toString将其转换为字符串。</p><p id="e32f" class="pw-post-body-paragraph lh li io lj b lk md jp lm ln me js lp lq mf ls lt lu mg lw lx ly mh ma mb mc ih bi translated">所以当使用parseInt解析一个数字时，它首先把数字转换成字符串，然后再解析成数字。</p><pre class="ke kf kg kh gu mm ml mn mo aw mp bi"><span id="d5ba" class="mq kq io ml b gz mr ms l mt mu">parseInt(number) === parseInt(number.toString());</span></pre><p id="d357" class="pw-post-body-paragraph lh li io lj b lk md jp lm ln me js lp lq mf ls lt lu mg lw lx ly mh ma mb mc ih bi translated"><code class="fe mi mj mk ml b">parseInt(0.0000001)</code>的脚步:</p><ol class=""><li id="d86e" class="mw mx io lj b lk md ln me lq my lu mz ly na mc nb nc nd ne bi translated">使用Number.prototype.toString将<code class="fe mi mj mk ml b">0.0000001</code>转换成一个字符串</li><li id="3979" class="mw mx io lj b lk nf ln ng lq nh lu ni ly nj mc nb nc nd ne bi translated">将字符串解析为数字</li></ol><figure class="ke kf kg kh gu ki gi gj paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gi gj nk"><img src="../Images/c80e00c36e74b453e2744d9ee631a387.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JScmxmalmKa7JcbeIWZDcA.png"/></div></div><figcaption class="nl nm gk gi gj nn no bd b be z dk">The steps of <code class="fe mi mj mk ml b">parseInt(0.0000001)</code></figcaption></figure><p id="dcbc" class="pw-post-body-paragraph lh li io lj b lk md jp lm ln me js lp lq mf ls lt lu mg lw lx ly mh ma mb mc ih bi translated">问题好像比较复杂，<code class="fe mi mj mk ml b">(0.0000001).toString()</code>不是<code class="fe mi mj mk ml b">'0.0000001'</code>？</p><h1 id="6638" class="kp kq io bd kr ks kt ku kv kw kx ky kz ju la jv lb jx lc jy ld ka le kb lf lg bi translated">为什么<code class="fe mi mj mk ml b">(0.0000001).toString()</code> === '1e-7 '？</h1><p id="8c77" class="pw-post-body-paragraph lh li io lj b lk ll jp lm ln lo js lp lq lr ls lt lu lv lw lx ly lz ma mb mc ih bi translated"><code class="fe mi mj mk ml b">1e-7</code>是数字的一种<a class="ae mv" href="https://en.wikipedia.org/wiki/Scientific_notation" rel="noopener ugc nofollow" target="_blank">科学符号</a>。默认情况下，JavaScript会将任何至少有六个尾随零的浮点值转换为注释。</p><pre class="ke kf kg kh gu mm ml mn mo aw mp bi"><span id="14c6" class="mq kq io ml b gz mr ms l mt mu">// six trailing zero or more<br/>console.log(<!-- -->0.0000001<!-- -->) // 1e-7<br/>console.log(<!-- -->0.00000000001<!-- -->) // 1e-11</span><span id="495b" class="mq kq io ml b gz np ms l mt mu">// less then six trailing zero<br/>console.log(<!-- -->0.000001<!-- -->) // <!-- -->0.000001 </span></pre><p id="eb5b" class="pw-post-body-paragraph lh li io lj b lk md jp lm ln me js lp lq mf ls lt lu mg lw lx ly mh ma mb mc ih bi translated">如果你想得到一个数字的科学符号，你可以使用<a class="ae mv" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toExponential" rel="noopener ugc nofollow" target="_blank">来表示</a>:</p><pre class="ke kf kg kh gu mm ml mn mo aw mp bi"><span id="5468" class="mq kq io ml b gz mr ms l mt mu">(<!-- -->0.000001<!-- -->).toExponential() // 1e-6</span></pre><h1 id="1933" class="kp kq io bd kr ks kt ku kv kw kx ky kz ju la jv lb jx lc jy ld ka le kb lf lg bi translated">如何使parseInt(0.0000001) === 0</h1><p id="5759" class="pw-post-body-paragraph lh li io lj b lk ll jp lm ln lo js lp lq lr ls lt lu lv lw lx ly lz ma mb mc ih bi translated">我们知道，在JavaScript中，至少有六个尾随零的浮点值被转换为科学记数法。使得parseInt的行为不符合预期，如何才能得到正确的答案？</p><p id="db11" class="pw-post-body-paragraph lh li io lj b lk md jp lm ln me js lp lq mf ls lt lu mg lw lx ly mh ma mb mc ih bi translated">幸运的是，JavaScript提供了<a class="ae mv" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toFixed" rel="noopener ugc nofollow" target="_blank"> toFixed </a> API来获取一串数字，默认情况下不会将数字转换成科学符号。</p><pre class="ke kf kg kh gu mm ml mn mo aw mp bi"><span id="7bfa" class="mq kq io ml b gz mr ms l mt mu">(0.0000001).toFixed(7) // <!-- -->'0.0000001'</span></pre><p id="8e35" class="pw-post-body-paragraph lh li io lj b lk md jp lm ln me js lp lq mf ls lt lu mg lw lx ly mh ma mb mc ih bi translated">但是我们必须在小数点后提供一个参数<code class="fe mi mj mk ml b">digits</code>。为了得到正确的<code class="fe mi mj mk ml b">digits</code>，我们可以通过黑客攻击来使用toExponential。</p><pre class="ke kf kg kh gu mm ml mn mo aw mp bi"><span id="0665" class="mq kq io ml b gz mr ms l mt mu">function getStringOfFloat(number) {<br/>    const notation = number.toExponential();<br/>    const [ base, exp] = notation.split('e-');<br/>    return number.toFixed(Math.max(base.length - 1, exp));<br/>}</span><span id="d9f5" class="mq kq io ml b gz np ms l mt mu">// test it <br/>getStringOfFloat(<!-- -->0.0000001<!-- -->) // '0.0000001'<br/>getStringOfFloat(0.000000000001) // '0.000000000001'<br/>getStringOfFloat(0.100000000001) // '0.100000000001'</span></pre><p id="3b8e" class="pw-post-body-paragraph lh li io lj b lk md jp lm ln me js lp lq mf ls lt lu mg lw lx ly mh ma mb mc ih bi translated">如果parseInt的参数是一个数字，我们可以用下面的方法得到正确的答案:</p><pre class="ke kf kg kh gu mm ml mn mo aw mp bi"><span id="d944" class="mq kq io ml b gz mr ms l mt mu">parseInt(getStringOfFloat(<!-- -->0.0000001<!-- -->)) // 0</span></pre><h1 id="b1fa" class="kp kq io bd kr ks kt ku kv kw kx ky kz ju la jv lb jx lc jy ld ka le kb lf lg bi translated">最后</h1><p id="0143" class="pw-post-body-paragraph lh li io lj b lk ll jp lm ln lo js lp lq lr ls lt lu lv lw lx ly lz ma mb mc ih bi translated">感谢阅读，希望对你有所帮助。我希望你跟着我，我会提供更多有用的提示。</p><p id="f1d7" class="pw-post-body-paragraph lh li io lj b lk md jp lm ln me js lp lq mf ls lt lu mg lw lx ly mh ma mb mc ih bi translated"><em class="nq">更多内容请看</em><a class="ae mv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lj ip"><em class="nq">plain English . io</em></strong></a><em class="nq">。报名参加我们的</em> <a class="ae mv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lj ip"> <em class="nq">免费周报</em> </strong> </a> <em class="nq">。关注我们关于</em><a class="ae mv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="lj ip"><em class="nq">Twitter</em></strong></a><strong class="lj ip"><em class="nq"/></strong><em class="nq">和</em><a class="ae mv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="lj ip"><em class="nq">LinkedIn</em></strong></a><em class="nq">。查看我们的</em> <a class="ae mv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="lj ip"> <em class="nq">社区不和谐</em> </strong> </a> <em class="nq">加入我们的</em> <a class="ae mv" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="lj ip"> <em class="nq">人才集体</em> </strong> </a> <em class="nq">。</em></p></div></div>    
</body>
</html>