<html>
<head>
<title>The Simplest Guide to Using Async/Await with forEach() in JavaScript (with Examples)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在JavaScript中使用Async/Await和forEach()的最简单指南(带示例)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/async-await-foreach-81d4859f2b8c?source=collection_archive---------1-----------------------#2022-01-05">https://javascript.plainenglish.io/async-await-foreach-81d4859f2b8c?source=collection_archive---------1-----------------------#2022-01-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="4da3" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">对forEach()使用async/await并不一定是一场噩梦！这里有4个解决你问题的方法。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/1b6eb89fbbc9a4e71f9cc18983f495b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PAcXkyfHpseFxr1UmIHxIw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Why is my async/await not working? (Source: <a class="ae ks" href="https://www.pexels.com/photo/young-ethnic-male-with-laptop-screaming-3799830/" rel="noopener ugc nofollow" target="_blank">Andrea Piacquadio on pexels.com</a>)</figcaption></figure><p id="7965" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">问问任何一个JavaScript开发人员，他们都会同意:</p><blockquote class="lp lq lr"><p id="3863" class="kt ku ls kv b kw kx jo ky kz la jr lb lt ld le lf lu lh li lj lv ll lm ln lo ig bi translated">简直是疯了！有那么好。</p><p id="12d6" class="kt ku ls kv b kw kx jo ky kz la jr lb lt ld le lf lu lh li lj lv ll lm ln lo ig bi translated">除非你决定在一个<code class="fe lw lx ly lz b"><em class="in">forEach()</em></code>里面使用它。然后它会变得非常丑陋非常快。</p></blockquote><p id="884b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在JavaScript中使用<code class="fe lw lx ly lz b">async/await</code>和<code class="fe lw lx ly lz b">forEach()</code>搜索任何查询，第一个结果会是一个StackOverflow问题。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/fea2f2d80ecea4509304e1274c8209e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*lsmW8ehmSPa0-Aa61fVxYg.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Source Search query: <a class="ae ks" href="https://www.google.com/search?q=using+Async%2FAwait+with+forEach%28%29+in+JavaScript" rel="noopener ugc nofollow" target="_blank">https://www.google.com/search?q=using+Async%2FAwait+with+forEach%28%29+in+JavaScript</a></figcaption></figure><p id="c593" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">有无数的开发者已经成为这头野兽的猎物，并努力清理这个烂摊子。这正是本指南将帮助你克服的。</p><p id="b4f6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一旦你完成了这个指南，你就再也不需要碰到类似这样的谷歌搜索结果了:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/a31f95895b0cba77314c9f0804fc7e5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*E1yXvmKxiHUPhl9bYsoSpQ.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Source: <a class="ae ks" href="https://www.youtube.com/watch?v=4lqJBBEpjRE" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=4lqJBBEpjRE</a></figcaption></figure><p id="8d20" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以，不再拖延，让我们冲一杯新鲜的咖啡，然后开始吧！</p></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><h1 id="9c27" class="mj mk in bd ml mm mn mo mp mq mr ms mt jt mu ju mv jw mw jx mx jz my ka mz na bi translated">在使用forEach()的JavaScript代码中，async/await会引起什么问题</h1><h2 id="0883" class="nb mk in bd ml nc nd dn mp ne nf dp mt lc ng nh mv lg ni nj mx lk nk nl mz nm bi translated">问题？</h2><p id="28bc" class="pw-post-body-paragraph kt ku in kv b kw nn jo ky kz no jr lb lc np le lf lg nq li lj lk nr lm ln lo ig bi translated">让我们看一些代码来理解这个问题:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="2c57" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">代码的意图相当简单明了:</p><ol class=""><li id="fedb" class="nu nv in kv b kw kx kz la lc nw lg nx lk ny lo nz oa ob oc bi translated"><code class="fe lw lx ly lz b">subscribedUsers</code>等待从昨天获取我的新订户的函数的结果。</li><li id="2044" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo nz oa ob oc bi translated">对于<code class="fe lw lx ly lz b">subscribedUsers</code>数组中的每个<code class="fe lw lx ly lz b">user</code>，我将发送一个我产品的促销代码。</li><li id="cc53" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo nz oa ob oc bi translated">一旦每个用户都收到了促销代码，系统就会给我发一封邮件，通知我活动已经<strong class="kv io">成功</strong>完成。</li></ol><p id="cb33" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是您希望这个代码块做的事情。</p><blockquote class="lp lq lr"><p id="e33b" class="kt ku ls kv b kw kx jo ky kz la jr lb lt ld le lf lu lh li lj lv ll lm ln lo ig bi translated">这也是一个相当常见的用例。你会用这样的代码来表示一堆不同的期望结果。所以，很有可能，你在更早的时候就已经遇到了这样的问题。</p></blockquote><p id="c65c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是这段代码有很多问题，这是幕后实际发生的情况:</p><ul class=""><li id="a6be" class="nu nv in kv b kw kx kz la lc nw lg nx lk ny lo oi oa ob oc bi translated">促销代码发送流程没有错误处理。因此，如果其中一个迭代抛出了一个错误，这个错误就不会被捕获。<em class="ls">不好！</em>(但是，我们暂时忽略错误处理— <em class="ls">一次一个问题，我的朋友。一次解决一个问题。</em>)</li><li id="c85c" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo oi oa ob oc bi translated">添加一个带有<code class="fe lw lx ly lz b">currentTime</code>指令的console.log，您会发现每次迭代都是并行进行的。但是，从代码编写的方式来看，你会期望它们一个接一个地发生。</li><li id="19df" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo oi oa ob oc bi translated">在发送任何促销代码电子邮件之前，循环完成迭代。是的，发送电子邮件的过程已经开始，但是代码没有等待过程解决就继续。这不是你想要的代码流程。</li><li id="cae5" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo oi oa ob oc bi translated">即使尚未发送任何促销代码，管理员也会收到确认电子邮件。也许他们中的一些人会失败，也许他们都会失败。管理员永远不会知道，因为他被发送的邮件独立于承诺如何解决自己。</li></ul><h2 id="9d47" class="nb mk in bd ml nc nd dn mp ne nf dp mt lc ng nh mv lg ni nj mx lk nk nl mz nm bi translated">这个问题背后的原因:</h2><p id="c8e4" class="pw-post-body-paragraph kt ku in kv b kw nn jo ky kz no jr lb lc np le lf lg nq li lj lk nr lm ln lo ig bi translated">简单地说，<code class="fe lw lx ly lz b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach" rel="noopener ugc nofollow" target="_blank">Array.prototype.forEach</a></code>从来就不是为异步代码设计的。</p><p id="987d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">它不适合承诺，即使在你周围看到的所有代码中都有<code class="fe lw lx ly lz b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/then" rel="noopener ugc nofollow" target="_blank">Promise.then()</a></code>。而现在，在<code class="fe lw lx ly lz b">async/await</code>的世界里，依然不适合<code class="fe lw lx ly lz b">async/await</code>。</p><p id="b2b6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">那么，我们如何解决呢？</strong></p><p id="74e5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">有几种不同的方法可以解决这个问题。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/5ec14014791577e75f0cd2eec18b0c5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/1*1I6UVouj-XDnBIPr2wc33Q.gif"/></div></figure><p id="cf39" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最基本和最简单的答案是不要在async/await中使用<code class="fe lw lx ly lz b">forEach()</code>。</p><p id="a744" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">毕竟，如果<code class="fe lw lx ly lz b">forEach()</code>不是为异步操作设计的，为什么要期待它做一些它不应该做的事情。</p><p id="a0d0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe lw lx ly lz b">For….of</code>将完美地适用于您想要使用<code class="fe lw lx ly lz b">forEach</code>的任何用例。</p><p id="8e89" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是，如果您更喜欢<code class="fe lw lx ly lz b">forEach</code>方法呢？好吧，挑剔先生！我们也会有一个解决方案。但是，公平的警告——你可能更适合其他方法！</p><p id="43b4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然而，让我们离题一点。解决让async/await在forEach循环中完美工作的问题(使用两种方法— <code class="fe lw lx ly lz b">for…of</code>和<code class="fe lw lx ly lz b">forEach</code>)。</p><p id="65da" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们花点时间了解一下我们的基本知识，并简要理解:</p><ul class=""><li id="e4df" class="nu nv in kv b kw kx kz la lc nw lg nx lk ny lo oi oa ob oc bi translated">JavaScript中的Async/Await到底是什么？</li><li id="f1e1" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo oi oa ob oc bi translated">为什么JavaScript开发人员熟悉async/await很重要？</li><li id="8212" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo oi oa ob oc bi translated">如何在JavaScript代码中使用async/await？</li><li id="d3c8" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo oi oa ob oc bi translated">你应该在代码中使用async/await over Promises吗？哪个更好？</li></ul><p id="8c08" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">那我们继续吧！</p></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><h1 id="f43a" class="mj mk in bd ml mm mn mo mp mq mr ms mt jt mu ju mv jw mw jx mx jz my ka mz na bi translated">JavaScript中的Async/Await是什么，为什么要关注它？</h1><h2 id="47b5" class="nb mk in bd ml nc nd dn mp ne nf dp mt lc ng nh mv lg ni nj mx lk nk nl mz nm bi translated">什么是异步/等待？</h2><p id="df3e" class="pw-post-body-paragraph kt ku in kv b kw nn jo ky kz no jr lb lc np le lf lg nq li lj lk nr lm ln lo ig bi translated">Async/await允许异步JavaScript代码在不阻塞主线程的情况下执行。</p><p id="62c5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">async关键字将函数指定为异步操作。这确保了函数将总是返回一个承诺。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ok"><img src="../Images/ca73e69604e4b1f24215441f9250cbfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lvh4LkP8yFDAy5XzS6QhqQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Source: <a class="ae ks" href="https://javascript.info/async-await" rel="noopener ugc nofollow" target="_blank">https://javascript.info/async-await</a></figcaption></figure><p id="4bcf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在该功能中，<code class="fe lw lx ly lz b">return 1</code>与return <code class="fe lw lx ly lz b">Promise.resolve(1)</code>基本相同</p><p id="b65b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">await关键字指定应该等待哪个函数。请注意:await关键字只在异步函数内部起作用(<em class="ls">或者可以用</em>)。</p><blockquote class="lp lq lr"><p id="1fd2" class="kt ku ls kv b kw kx jo ky kz la jr lb lt ld le lf lu lh li lj lv ll lm ln lo ig bi translated">请注意:随着最新的更新，如果你在一个模块中工作，大多数现代浏览器将允许你使用顶层等待。但是现在，让我们把事情简单化。</p></blockquote><p id="c31f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">await关键字所做的只是暂停代码的执行，直到它所使用的承诺被解决。</p><p id="3431" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这段来自javascript.info的代码块将澄清一些事情:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ol"><img src="../Images/d19518fe328f96dd4025a7280671b76e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t9cE9mHO1s9vzHg2Yj76Hw.png"/></div></div></figure><p id="85f7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因此，在await行之后出现的任何代码片段都会等待轮到它，并且只有在承诺被解析后才会被执行。</p><p id="e906" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我重申一下。关键字<code class="fe lw lx ly lz b">await</code>将实际上暂停函数的任何进一步执行，直到承诺被解决。就在那时(<em class="ls">，只有在那时</em>，功能恢复，当它恢复时，它以我们从承诺中得到的结果恢复。</p><h2 id="a7f8" class="nb mk in bd ml nc nd dn mp ne nf dp mt lc ng nh mv lg ni nj mx lk nk nl mz nm bi translated">你为什么要在乎？</h2><ul class=""><li id="fb3d" class="nu nv in kv b kw nn kz no lc om lg on lk oo lo oi oa ob oc bi translated">这是一种更优雅的代码编写方式。</li><li id="1df1" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo oi oa ob oc bi translated">这样效率更高。</li><li id="5fde" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo oi oa ob oc bi translated">它不太耗费资源。由于函数的执行已经被挂起，JavaScript引擎没有为这些特定的函数使用任何CPU资源，同时可以自由地执行其他任务。</li></ul><p id="2547" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您的代码受益于遵循比<code class="fe lw lx ly lz b">promise.then()</code>更优雅的代码语法来从承诺中获得结果，并且您(<em class="ls">作为一名程序员</em>)得到的是一种更易于阅读和编写的语法。</p><h1 id="ddf3" class="mj mk in bd ml mm op mo mp mq oq ms mt jt or ju mv jw os jx mx jz ot ka mz na bi translated">如何在JavaScript中使用Async/Await</h1><p id="d312" class="pw-post-body-paragraph kt ku in kv b kw nn jo ky kz no jr lb lc np le lf lg nq li lj lk nr lm ln lo ig bi translated">关于如何在javaScript代码/项目中使用async/await，有很多很好的参考资料。</p><p id="f757" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><a class="ae ks" href="https://catalins.tech/how-to-use-asyncawait-in-javascript" rel="noopener ugc nofollow" target="_blank">这里有一张</a>由<a class="ou ov ep" href="https://medium.com/u/e345593e211e?source=post_page-----81d4859f2b8c--------------------------------" rel="noopener" target="_blank"> Catalin的Tech </a>制作，我认为它完美地抓住了本质。</p><p id="b1ba" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><a class="ae ks" href="https://dev.to/somedood/best-practices-for-es2017-asynchronous-functions-async-await-39ji" rel="noopener ugc nofollow" target="_blank">这里有一张</a>由<a class="ae ks" href="https://twitter.com/BastiDood" rel="noopener ugc nofollow" target="_blank">巴斯蒂·奥提兹</a>创作。</p><blockquote class="lp lq lr"><p id="9c5c" class="kt ku ls kv b kw kx jo ky kz la jr lb lt ld le lf lu lh li lj lv ll lm ln lo ig bi translated">这两种资源都在故事的结尾“建议的资源”下进行了链接。</p></blockquote><p id="88ce" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">由于我是fireship教程的超级粉丝，他们能够以初学者友好的方式解释复杂的主题，这里有一个来自<a class="ou ov ep" href="https://medium.com/u/be68cb994bb8?source=post_page-----81d4859f2b8c--------------------------------" rel="noopener" target="_blank"> Jeff Delaney </a>的短片(12分钟)。</p><blockquote class="lp lq lr"><p id="4d73" class="kt ku ls kv b kw kx jo ky kz la jr lb lt ld le lf lu lh li lj lv ll lm ln lo ig bi translated">相比之下，你会在YouTube上找到的其他async/await视频的长度在40分钟到1.5小时之间。</p></blockquote><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ow nt l"/></div></figure><p id="8612" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为什么我在其他例子中加入了fireship教程视频？看看评论就知道了:</p><div class="kd ke kf kg gt ab cb"><figure class="ox kh oy oz pa pb pc paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/678c01f4ab30d0bf5e5f29f897f2388e.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*B3lstuimlIrdIGf7RmLysA.png"/></div></figure><figure class="ox kh pd oz pa pb pc paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/df3b127000c84550550dde2991ce8d87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*o26GSGeXS8H0YjjFE0Im5g.png"/></div></figure></div></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><h1 id="49dd" class="mj mk in bd ml mm mn mo mp mq mr ms mt jt mu ju mv jw mw jx mx jz my ka mz na bi translated">你应该选择异步/等待而不是承诺吗？</h1><p id="aa3b" class="pw-post-body-paragraph kt ku in kv b kw nn jo ky kz no jr lb lc np le lf lg nq li lj lk nr lm ln lo ig bi translated">这是一个高度个人化的选择，这里两边都有人。</p><p id="2f5c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">有些人坚信async/await为您的代码增加了惊人的价值，而不是简单的承诺。还有人认为async/await是在地狱之火中诞生的。</p><p id="059b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下面是许多开发人员反对使用async/await的一个理由:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi pe"><img src="../Images/995ef81dbac6a5bee07c185f48572b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rk6e329WQujzcCmbZ7j0zw.png"/></div></div></figure><p id="7f21" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">他们是对还是错？您必须根据具体情况做出判断，这取决于您对代码做了什么。</p><p id="24c9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是，从个人经验来说，我对我使用的是async/await还是<code class="fe lw lx ly lz b">Promise.then()</code>非常无所谓。我在我的代码中使用了这两种方法，我发现它们都很容易使用。</p><p id="c8c5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是，有我更喜欢异步/等待的场景吗？是的。当我掉进了一个充满了面试和复试的兔子洞。我发现在这种情况下，async/await是一个更干净的解决方案。</p><p id="ff9f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当你在几个星期后回到你的代码时，或者当你有另一个开发人员在同样的代码库工作时，更干净、更整洁和更短的代码确实有它的优势。</p><p id="0ee2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">底线呢？如果干净整洁的代码对您很重要，请选择async/await。你的代码看起来不同，更干净，更整洁，更短。并且提高了错误处理的简单性。</p><p id="9a4c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是，如果您因为一些主要的性能增强而考虑选择async/await而不是Promise.then()，您会发现自己很失望。</p><p id="b4b3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Async/Await本质上与您的<code class="fe lw lx ly lz b">Promise.then()</code>代码块做同样的事情。</p><p id="2623" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因此，是的，您的代码看起来会有所不同，但是逻辑流程和功能将保持不变。</p></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><p id="3b0b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">那好吧。既然我们已经简要介绍了关于async/await的所有知识，那么让我们回到手头的问题，并尝试解决我们之前在forEach()中使用async/await时遇到的问题。</p><h1 id="b3b8" class="mj mk in bd ml mm op mo mp mq oq ms mt jt or ju mv jw os jx mx jz ot ka mz na bi translated">如何在JavaScript中用forEach()修复async/await用法？</h1><p id="4e36" class="pw-post-body-paragraph kt ku in kv b kw nn jo ky kz no jr lb lc np le lf lg nq li lj lk nr lm ln lo ig bi translated">好吧。</p><p id="501c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们之前看到的促销代码发送循环。让我们现在就解决这个问题。</p><h2 id="35df" class="nb mk in bd ml nc nd dn mp ne nf dp mt lc ng nh mv lg ni nj mx lk nk nl mz nm bi translated">#1.解决方案的for……</h2><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="bd16" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这个循环将在继续下一个迭代之前等待发送一封促销代码电子邮件。</p><blockquote class="lp lq lr"><p id="778f" class="kt ku ls kv b kw kx jo ky kz la jr lb lt ld le lf lu lh li lj lv ll lm ln lo ig bi translated">PS:Airbnb的牛人发布了一个<a class="ae ks" href="https://airbnb.io/javascript/react/" rel="noopener ugc nofollow" target="_blank"> JavaScript风格指南</a>。它遵循并推荐了他们所谓的“最合理的JavaScript方法”。github 上也有<a class="ae ks" href="https://github.com/airbnb/javascript" rel="noopener ugc nofollow" target="_blank">风格指南。它非常受欢迎，被全世界成千上万的JavaScript开发者所追随。</a></p><p id="e97b" class="kt ku ls kv b kw kx jo ky kz la jr lb lt ld le lf lu lh li lj lv ll lm ln lo ig bi translated">如果你还不知道，我强烈建议你看一看。</p><p id="5d49" class="kt ku ls kv b kw kx jo ky kz la jr lb lt ld le lf lu lh li lj lv ll lm ln lo ig bi translated">无论如何，我提出Airbnb风格指南的原因很简单，它建议不要在网络应用中使用<code class="fe lw lx ly lz b"><em class="in">for…of</em></code>,因为它需要一个大的多填充。</p><p id="a462" class="kt ku ls kv b kw kx jo ky kz la jr lb lt ld le lf lu lh li lj lv ll lm ln lo ig bi translated">如果您愿意，也可以使用<code class="fe lw lx ly lz b"><em class="in">Array.reduce()</em></code>来达到同样的效果。</p></blockquote><h2 id="d5f5" class="nb mk in bd ml nc nd dn mp ne nf dp mt lc ng nh mv lg ni nj mx lk nk nl mz nm bi translated">#2.Array.reduce()解决方案</h2><p id="7936" class="pw-post-body-paragraph kt ku in kv b kw nn jo ky kz no jr lb lc np le lf lg nq li lj lk nr lm ln lo ig bi translated">愿Airbnb的神对这个解决方案满意！</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="6a8f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们习惯于使用第二个参数作为前面代码执行的输出— <em class="ls">对事情进展的总结，如果可以的话</em>。但是，在这种特殊的情况下，事情有点不同。</p><p id="f33e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们使用参数— <em class="ls"> referencePoint </em> —只是作为一种将承诺从上一次迭代的回调传递到下一次迭代的手段。</p><p id="3d64" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这有助于我们的代码在开始处理下一个迭代之前等待上一个迭代完成。</p><p id="79cb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我不太喜欢这种方法。</p><p id="696b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">虽然它没有任何问题，并且它的行为几乎与我们在解决方案#1中看到的<code class="fe lw lx ly lz b">for…of</code>示例完全相同，但我发现这个解决方案是:</p><ul class=""><li id="4464" class="nu nv in kv b kw kx kz la lc nw lg nx lk ny lo oi oa ob oc bi translated">沉闷的</li><li id="90a3" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo oi oa ob oc bi translated">难以阅读</li><li id="8489" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo oi oa ob oc bi translated">有点困惑— <em class="ls">特别是对于初学者</em></li></ul><p id="eef6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是，这是Airbnb JavaScript风格指南推荐的方法。可能是因为它不会像<code class="fe lw lx ly lz b">for…of</code>那样使用迭代，所以会减少你的浏览器包大小。</p><p id="fb67" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当你的代码有迭代器时，一些浏览器确实需要一个polyfill，polyfill确实很有效。话虽如此，如果我必须在包大小和我的便利性之间做出选择，你好便利性！😜</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/fac6f264c3bad389d22e3a5ac93a71cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*j9u8PqfPa-lksanpY3ZRJQ.gif"/></div></figure></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><p id="7fc9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">传统的<code class="fe lw lx ly lz b">for</code>方法，以及我们刚刚看到的<code class="fe lw lx ly lz b">Array.reduce()</code>方法，串行处理您的代码。它发送一封促销邮件，等待承诺得到解决，然后转向下一个用户。</p><p id="84e8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是在很多情况下(例如，这个例子本身就是)，循环迭代的顺序并不重要。</p><p id="b242" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你只是想让每个用户独立地收到一个促销代码。</p><p id="50b9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因此，与其串行处理，不如并行循环所有新订户更快。这让我们想到了列表中的下一个解决方案。</p></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><h2 id="eb9d" class="nb mk in bd ml nc nd dn mp ne nf dp mt lc ng nh mv lg ni nj mx lk nk nl mz nm bi translated">#3.<code class="fe lw lx ly lz b">Array.map()</code>解决方案</h2><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="c232" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这种解决方案是优雅的，因为它启动了同时向所有用户发送促销代码的过程。但是，它会等待它们中的每一个完成执行，然后再将电子邮件发送给管理员。</p></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><p id="3361" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在，让我们最终进入今晚的重头戏。</p><p id="6b87" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">对forEach()使用async/await</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/71bc7d7da5c58b78e32e3bbdee2a7237.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/1*NEgss09uhWKulM2VcwcdzQ.gif"/></div></figure></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><h2 id="5094" class="nb mk in bd ml nc nd dn mp ne nf dp mt lc ng nh mv lg ni nj mx lk nk nl mz nm bi translated">#4.async/await，使用forEach()…以正确的方式完成</h2><p id="a3e3" class="pw-post-body-paragraph kt ku in kv b kw nn jo ky kz no jr lb lc np le lf lg nq li lj lk nr lm ln lo ig bi translated">剧透警告:太恐怖了！只需使用#1或#3。我不是#2的超级粉丝(抱歉，Airbnb的主人)，这个是…只是…的…<em class="ls">最差！</em></p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="b959" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">太恶心了！</p><p id="0cfa" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这可能有用，但这并没有减少它的恶心程度。</p></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><h1 id="f250" class="mj mk in bd ml mm mn mo mp mq mr ms mt jt mu ju mv jw mw jx mx jz my ka mz na bi translated">结论</h1><p id="b1df" class="pw-post-body-paragraph kt ku in kv b kw nn jo ky kz no jr lb lc np le lf lg nq li lj lk nr lm ln lo ig bi translated">不要试图让某事做它不应该做的事。</p><p id="fe60" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">forEach()从来不是为异步代码设计的。因此，如果你试图让它这样做，你将需要做一些额外的跑腿工作只是为了让它发生。</p><p id="987a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当你有更好、更简单、更容易的方法来达到同样的产出时，做这些又有什么意义呢？</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/f164a5ef6eed84ea55af76b00f415e3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/1*lHzct3l2iZvQRqfvSng13A.gif"/></div></figure><p id="018c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在交给你了。</p><ul class=""><li id="1add" class="nu nv in kv b kw kx kz la lc nw lg nx lk ny lo oi oa ob oc bi translated">你是否遇到过async/await的问题，因为你没有意识到你在forEach()中使用了它？</li><li id="8a9b" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo oi oa ob oc bi translated">在这段时间里，当你试图解决问题时，你打破了什么？</li></ul></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><p id="ef1a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你还想让我在这里报道什么？如何在可迭代场景中使用async/await？请在评论中告诉我！</p></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><h1 id="b731" class="mj mk in bd ml mm mn mo mp mq mr ms mt jt mu ju mv jw mw jx mx jz my ka mz na bi translated">建议的资源:</h1><ul class=""><li id="dd92" class="nu nv in kv b kw nn kz no lc om lg on lk oo lo oi oa ob oc bi translated"><a class="ae ks" href="https://catalins.tech/how-to-use-asyncawait-in-javascript" rel="noopener ugc nofollow" target="_blank">https://catalins.tech/how-to-use-asyncawait-in-javascript</a></li><li id="8487" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo oi oa ob oc bi translated"><a class="ae ks" href="https://dev.to/somedood/best-practices-for-es2017-asynchronous-functions-async-await-39ji" rel="noopener ugc nofollow" target="_blank">https://dev . to/some dood/best-practices-for-es 2017-async-functions-async-await-39ji</a></li></ul><p id="6bc4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="ls">更多内容看</em> <a class="ae ks" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="ls">说白了。报名参加我们的</em> </a><a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="ls">免费周报</em> </a> <em class="ls">。在我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <em class="ls">社区</em> </a> <em class="ls">获得独家写作机会和建议。</em></p></div></div>    
</body>
</html>