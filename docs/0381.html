<html>
<head>
<title>Add a Map With a Point to Your Website</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将带有点的地图添加到您的网站</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/add-a-map-with-a-point-to-your-website-677bfc3bbd59?source=collection_archive---------26-----------------------#2022-01-21">https://javascript.plainenglish.io/add-a-map-with-a-point-to-your-website-677bfc3bbd59?source=collection_archive---------26-----------------------#2022-01-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="b1ea" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">关于如何将带有点的地图添加到您的网站的指南。</h2></div><p id="df39" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因为谷歌让它变得如此简单，许多网站都包含只有一个点的地图。然而，失败之处包括需要一个API密钥，以及一旦进行了指定次数的调用就要付费。不过，好消息是——因为你已经运行了一个web应用程序，你可以自己完成这项工作，而不会增加成本。</p><p id="5427" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">幸运的是，除了免费之外，将带有点的地图添加到您的网站相当简单，无论您是想要HTML的基本插件，还是想要在React中构建自己的插件。</p><h1 id="9ecb" class="ky kz in bd la lb lc ld le lf lg lh li jt lj ju lk jw ll jx lm jz ln ka lo lp bi translated">基本顺便访问</h1><p id="cf29" class="pw-post-body-paragraph kc kd in ke b kf lq jo kh ki lr jr kk kl ls kn ko kp lt kr ks kt lu kv kw kx ig bi translated">这种相对简单的解决方案适用于诸如<a class="ae lv" href="https://wordpress.com/" rel="noopener ugc nofollow" target="_blank"> WordPress </a>、单页应用程序(例如Angular、Vue.js和React)和基本的HTML页面。首先将这个<code class="fe lw lx ly lz b">iframe</code>粘贴到HTML源代码中。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="340f" class="mi kz in lz b gy mj mk l ml mm">&lt;iframe src="<a class="ae lv" href="https://one-point-map.herokuapp.com/?lat=0&amp;long=0" rel="noopener ugc nofollow" target="_blank">https://one-point-map.herokuapp.com/?lat=0&amp;long=0</a>" width="800px" height="800px" /&gt;</span></pre><p id="da0a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">更改<code class="fe lw lx ly lz b">src</code> URL中的值会改变地图小部件的位置和外观。要自定义URL中包含的查询参数，请尝试以下选项:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="7863" class="mi kz in lz b gy mj mk l ml mm">|  Param Name   |       Description        | Default |<br/>|---------------|--------------------------|---------|<br/>| lat*          | Latitude of point        |         |<br/>| long/lon*     | Longitude of point       |         |<br/>| zoom          | Desired zoom level       | 14      |<br/>| icon_url      | URL of icon              |         |<br/>| icon_scale    | Scale factor of icon     | 1       |<br/>| show_popup    | Shows/hides popup        | true    |<br/>| show_controls | Shows/hides controls     | true    |<br/>| show_context  | Shows/hides right click  | true    |<br/>| show_basemap  | Shows/hides map switcher | true    |<br/>| title         | Text displayed in popup  |         |</span><span id="bee1" class="mi kz in lz b gy mn mk l ml mm">* required query params</span></pre><figure class="ma mb mc md gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mo"><img src="../Images/0b6ab36d1a1516e63abc5075b2edf56d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4MEm7zspPxpZ-SLNgo5FQg.png"/></div></div></figure><p id="e126" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">自定义图标、缩放和比例的示例:<code class="fe lw lx ly lz b"><a class="ae lv" href="https://one-point-map.herokuapp.com/?view=38.477783,-99.728264,7.00,0.00&amp;lat=38.477783&amp;long=-99.728264&amp;zoom=7&amp;icon_url=https://openlayers.org/assets/theme/img/logo70.png&amp;icon_scale=5" rel="noopener ugc nofollow" target="_blank">https://one-point-map.herokuapp.com/?lat=38.477783&amp;long=-99.728264&amp;zoom=7&amp;icon_url=https://openlayers.org/assets/theme/img/logo70.png&amp;icon_scale=5</a></code></p><h1 id="d533" class="ky kz in bd la lb lc ld le lf lg lh li jt lj ju lk jw ll jx lm jz ln ka lo lp bi translated">自定义反应构建</h1><p id="d1f8" class="pw-post-body-paragraph kc kd in ke b kf lq jo kh ki lr jr kk kl ls kn ko kp lt kr ks kt lu kv kw kx ig bi translated">对于自定义React构建，请查看<a class="ae lv" href="https://ol-kit.com/" rel="noopener ugc nofollow" target="_blank"> ol-kit </a>，这是一个包装了<a class="ae lv" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>和<a class="ae lv" href="https://openlayers.org/" rel="noopener ugc nofollow" target="_blank"> OpenLayers </a>的库。</p><p id="ed3b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要创建一个空白的React项目(一旦安装了节点)，请使用<code class="fe lw lx ly lz b">react-scripts</code>的<code class="fe lw lx ly lz b">4.0.3</code>版本，因为ol-kit不提供自己的webpack v5 polyfills。将此粘贴到您的终端中:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="bf00" class="mi kz in lz b gy mj mk l ml mm">npx create-react-app@4.0.3 point-map<br/>cd point-map<br/>npm install --save --save-exact react-scripts@4.0.3</span></pre><p id="5560" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，运行以下命令来安装ol-kit及其对等依赖项:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="732d" class="mi kz in lz b gy mj mk l ml mm">npm i @bayer/ol-kit ol react react-dom styled-components @material-ui/core @material-ui/icons @material-ui/styles --save</span></pre><p id="d36c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">用以下文件替换<code class="fe lw lx ly lz b">App.js</code>的内容。它包括使用查询字符串数据在地图上渲染一个点所需的一切。</p><figure class="ma mb mc md gt mp"><div class="bz fp l di"><div class="mw mx l"/></div></figure><figure class="ma mb mc md gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mo"><img src="../Images/7466a312c2e7517b48e6fcf18c287af2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7g7WsLTF-Vwru1eRwPCu4g.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Note the lack of child UI components when a console error is thrown.</figcaption></figure><p id="a588" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个大纲用最基本的代码展示了默认的地图样式。参数化前需要回答的几个基本问题是:</p><ol class=""><li id="4f9d" class="nc nd in ke b kf kg ki kj kl ne kp nf kt ng kx nh ni nj nk bi translated"><strong class="ke io">什么时候</strong> <code class="fe lw lx ly lz b"><strong class="ke io">onMapInit</strong></code> <strong class="ke io">被调用？<br/></strong>OpenLayers贴图初始化后。因为map实例是向下传递的，所以可以对其进行修改，并对其调用方法，比如添加一个点。这种初始化地图的简化是ol-kit最有价值的特性。</li><li id="2078" class="nc nd in ke b kf nl ki nm kl nn kp no kt np kx nh ni nj nk bi translated"><strong class="ke io">地图上的点怎么样？OpenLayers框架将所有特征(在这种情况下，是一个点)放到地图的图层上(因此，名为Open <strong class="ke io">图层</strong>)。层次结构是这样工作的:<code class="fe lw lx ly lz b">map</code>拥有一个或多个<code class="fe lw lx ly lz b">layers</code>，每个<code class="fe lw lx ly lz b">layer</code>只拥有一个<code class="fe lw lx ly lz b">source</code>，而后者又可以拥有多个<code class="fe lw lx ly lz b">features</code>(点)。如果你想要一个更完整的图片，查看这些<a class="ae lv" href="https://openlayers.org/en/latest/apidoc/module-ol_source_Source-Source.html" rel="noopener ugc nofollow" target="_blank"> OpenLayers文档</a>上的子类。</strong></li><li id="e999" class="nc nd in ke b kf nl ki nm kl nn kp no kt np kx nh ni nj nk bi translated"><strong class="ke io"/><code class="fe lw lx ly lz b"><strong class="ke io">map.getView()</strong></code><strong class="ke io">是做什么的？<br/> </strong>默认情况下，ol-kit将美国48个相邻州的地图居中。如果您将一个点添加到世界上的任何其他地方，您可能希望地图重新以该点所在的位置为中心。<code class="fe lw lx ly lz b">Null</code> Island(一个气象浮标，不是一个真实的岛屿)是测试这个的好地方，因为它的值<code class="fe lw lx ly lz b">lat = 0, long = 0</code>非常容易记住。</li></ol><h1 id="b296" class="ky kz in bd la lb lc ld le lf lg lh li jt lj ju lk jw ll jx lm jz ln ka lo lp bi translated">编辑地图子组件</h1><p id="4012" class="pw-post-body-paragraph kc kd in ke b kf lq jo kh ki lr jr kk kl ls kn ko kp lt kr ks kt lu kv kw kx ig bi translated">这段代码结合了<a class="ae lv" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank"> ReactHooks </a> <code class="fe lw lx ly lz b">useState</code>和<code class="fe lw lx ly lz b">useEffect</code>来控制React子组件的可见性。以下是对上述代码片段的一般修改:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="4512" class="mi kz in lz b gy mj mk l ml mm">const [showBasemapContainer, setShowBasemapContainer] = useState(true)<br/>const [showContextMenu, setShowContextMenu] = useState(true)<br/>const [showControls, setShowControls] = useState(true)<br/>const [showPopup, setShowPopup] = useState(true)</span></pre><p id="3115" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe lw lx ly lz b">...</code></p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="d8a7" class="mi kz in lz b gy mj mk l ml mm">useEffect(() =&gt; {<br/>  const queryParams = window.location.search.split(/([?&amp;])/g).filter(e =&gt; e.length &gt; 1).reduce((acc, str) =&gt; {<br/>    const stringSplit = str.split('=')<br/>    acc[stringSplit[0]] = stringSplit[1]<br/>    return acc<br/>  }, {})<br/>  if (queryParams.show_basemap &amp;&amp; queryParams.show_basemap === 'false') {<br/>    setShowBasemapContainer(false)<br/>  }<br/>  if (queryParams.show_popup &amp;&amp; queryParams.show_popup === 'false') {<br/>    setShowPopup(false)<br/>  }<br/>  if (queryParams.show_context &amp;&amp; queryParams.show_context === 'false') {<br/>    setShowContextMenu(false)<br/>  }<br/>  if (queryParams.show_controls &amp;&amp; queryParams.show_controls === 'false') {<br/>    setShowControls(false)<br/>  }<br/>}, []) // [] it will run on mount, but at no other time; URL params won't change without a refresh</span></pre><p id="3b25" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe lw lx ly lz b">...</code></p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="8f5b" class="mi kz in lz b gy mj mk l ml mm">&lt;Map onMapInit={onMapInit} fullScreen&gt;<br/>  {showBasemapContainer &amp;&amp; &lt;BasemapContainer /&gt;}<br/>  {showContextMenu &amp;&amp; &lt;ContextMenu /&gt;}<br/>  {showControls &amp;&amp; &lt;Controls /&gt;}<br/>  {showPopup &amp;&amp; &lt;Popup /&gt;}<br/>&lt;/Map&gt;</span></pre><p id="9827" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">添加对一些其他查询参数的支持会产生以下React组件。图标及其大小、缩放级别和弹出窗口中显示的标题都是可定制的；覆盖地图的每个组件都可以用查询参数隐藏。</p><figure class="ma mb mc md gt mp"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="e4ab" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一些需要注意的事项:</p><ul class=""><li id="87ff" class="nc nd in ke b kf kg ki kj kl ne kp nf kt ng kx nq ni nj nk bi translated"><code class="fe lw lx ly lz b"><strong class="ke io">point.setStyle()</strong></code> <strong class="ke io">改变点的外观:</strong> <br/>调用<code class="fe lw lx ly lz b">setStyle</code>允许无限数量的样式应用于点；这个例子仅仅演示了如何将默认的点样式改变为图标/图像。有关OpenLayers中样式特性的更多信息，<a class="ae lv" href="https://openlayers.org/en/latest/apidoc/module-ol_style_Style.html" rel="noopener ugc nofollow" target="_blank">请查看本文档</a>。</li><li id="5cab" class="nc nd in ke b kf nl ki nm kl nn kp no kt np kx nq ni nj nk bi translated"><code class="fe lw lx ly lz b"><strong class="ke io">olFeature({ ... })</strong></code> <strong class="ke io">接受任何自定义属性:</strong> <br/>向弹出窗口添加数据非常简单——某种类型的<code class="fe lw lx ly lz b">geometry</code>(如点或线串)定义所有特征，然后可以应用其他值。尽管ol-kit预先配置为在弹出窗口中突出显示<code class="fe lw lx ly lz b">title</code>属性，但不同的配置会修改弹出窗口的行为。</li></ul><p id="21f8" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">大多数需要地图的项目可能不会使用URL查询参数来控制数据或组件的可见性，但这应该是一个很好的起点。</p><p id="244e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">停止为谷歌的API付费；托管自己的软件，保持敏捷，有任何问题都可以随时联系我们。</p><p id="0ecc" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢您的阅读😃</p><p id="785f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nr">更多内容请看</em> <a class="ae lv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nr">说白了。报名参加我们的</em> <a class="ae lv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nr">免费周报</em> </strong> </a> <em class="nr">。在我们的</em> <a class="ae lv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="nr">社区不和谐</em> </strong> </a> <em class="nr">获得独家获取写作机会和建议。</em></strong></a></p></div></div>    
</body>
</html>