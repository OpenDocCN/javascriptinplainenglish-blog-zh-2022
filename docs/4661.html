<html>
<head>
<title>Simplify Authentication in SvelteKit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简化SvelteKit中的身份验证</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-authjs-in-sveltekit-eab6aa18a2ca?source=collection_archive---------1-----------------------#2022-12-22">https://javascript.plainenglish.io/how-to-use-authjs-in-sveltekit-eab6aa18a2ca?source=collection_archive---------1-----------------------#2022-12-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c6d3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何将SvelteKit与AuthJS一起使用</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1bd783232d998ff5e6e7b846fe15f832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1Gkq1cvw4W-dyiI9"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/es/@franckinjapan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Franck</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="161a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">NextAuth的团队一直在努力从NextAuth中剥离认证逻辑，并创建新的AuthJS核心库。AuthJS核心是框架不可知的，该团队已经发布了第一个适配器，目标是SvelteKit。下面我们就来看看如何在实践中使用。</p><h1 id="a7f0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">设置</strong></h1><p id="ebec" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">创建一个新的SvelteKit项目，选择骨架模板并使用TypeScript:</p><pre class="kg kh ki kj gt mp mq mr bn ms mt bi"><span id="38b7" class="mu lt iq mq b be mv mw l mx my">npm init svelte@next svelteauth-demo<br/>cd svelteauth-demo</span></pre><p id="6726" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为AuthJS安装SvelteKit适配器和核心:</p><pre class="kg kh ki kj gt mp mq mr bn ms mt bi"><span id="8a82" class="mu lt iq mq b be mv mw l mx my">npm install @auth/core @auth/sveltekit</span></pre><h1 id="d8ae" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">认证提供者</strong></h1><p id="4a8c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">接下来，我们需要配置我们想要使用的身份验证提供者。对于这个演示，我们将使用GitHub。在<code class="fe mz na nb mq b">src</code>目录中创建一个名为<code class="fe mz na nb mq b">hooks.server.ts</code>的新文件，并添加以下代码:</p><pre class="kg kh ki kj gt mp mq mr bn ms mt bi"><span id="88cf" class="mu lt iq mq b be mv mw l mx my">import { SvelteKitAuth } from "@auth/sveltekit"<br/>import GitHub from '@auth/core/providers/github';<br/>import { GITHUB_ID, GITHUB_SECRET } from "$env/static/private"<br/><br/>export const handle = SvelteKitAuth({<br/>  providers: [<br/>    GitHub({<br/>      clientId: GITHUB_ID,<br/>      clientSecret: GITHUB_SECRET<br/>    })<br/>  ]<br/>});</span></pre><p id="6528" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">导出的<code class="fe mz na nb mq b"><a class="ae kv" href="https://kit.svelte.dev/docs/hooks#server-hooks-handle" rel="noopener ugc nofollow" target="_blank">handle</a></code>函数能够拦截对服务器的请求并处理认证。<code class="fe mz na nb mq b">clientId</code>和<code class="fe mz na nb mq b">clientSecret</code>作为环境变量传入。我们接下来将设置这些。</p><h1 id="2d59" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak"> GitHub OAuth </strong></h1><p id="da46" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">去<a class="ae kv" href="https://github.com/settings/developers" rel="noopener ugc nofollow" target="_blank"> GitHub的开发者设置</a>创建一个新的OAuth应用。将回拨URL设置为<code class="fe mz na nb mq b">http://localhost:5173/auth/callback/github</code>。<code class="fe mz na nb mq b">http://localhost:5173</code>部分是SvelteKit的默认URL。如果您正在使用不同的端口，或者正在部署您的应用程序，您需要对此进行更改。您还需要将“主页URL”设置为<code class="fe mz na nb mq b">http://localhost:5173</code>。为下一步保存客户端ID和客户端密码。</p><h1 id="6f78" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">配置环境变量</strong></h1><p id="0bf6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">接下来，我们需要配置环境变量。在项目的根目录下创建一个名为<code class="fe mz na nb mq b">.env</code>的新文件，并添加以下内容，用您自己的值替换占位符。<code class="fe mz na nb mq b">AUTH_SECRET</code>必须是32个字符的随机字符串。文档建议在Linux上使用<code class="fe mz na nb mq b">openssl rand -hex 32</code>生成一个，或者可以导航到<a class="ae kv" href="https://generate-secret.vercel.app/32" rel="noopener ugc nofollow" target="_blank">generate-secret . vercel . app</a>在浏览器中生成一个。</p><pre class="kg kh ki kj gt mp mq mr bn ms mt bi"><span id="b0fc" class="mu lt iq mq b be mv mw l nc my">GITHUB_ID=&lt;your-github-id&gt;<br/>GITHUB_SECRET=&lt;your-github-secret&gt;<br/>AUTH_SECRET=&lt;auth-secret&gt;</span></pre><h1 id="3b55" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">获取会话</strong></h1><p id="d529" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在我们需要获取会话数据。在<code class="fe mz na nb mq b">src/routes</code>目录中创建一个名为<code class="fe mz na nb mq b">+page.server.ts</code>的新文件，并导出一个返回会话数据的<code class="fe mz na nb mq b">load</code>函数:</p><pre class="kg kh ki kj gt mp mq mr bn ms mt bi"><span id="9e00" class="mu lt iq mq b be mv mw l mx my">import type { PageServerLoad } from "./$types"<br/><br/>export const load: PageServerLoad = async (event) =&gt; {<br/>  return {<br/>    session: await event.locals.getSession(),<br/>  }<br/>}</span></pre><h1 id="f334" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">添加登录动作</strong></h1><p id="e9ad" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在，我们需要向应用程序添加一些操作。导航到<code class="fe mz na nb mq b">src/routes/+page.svelte</code>并添加以下代码:</p><pre class="kg kh ki kj gt mp mq mr bn ms mt bi"><span id="c9f3" class="mu lt iq mq b be mv mw l mx my">&lt;script&gt;<br/> import { signIn, signOut } from '@auth/sveltekit/client';<br/> import { page } from '$app/stores';<br/>&lt;/script&gt;<br/><br/>&lt;p&gt;<br/> {#if Object.keys($page.data.session || {}).length}<br/><br/>    {#if $page.data.session?.user?.image}<br/>      &lt;img<br/>        src={$page.data.session?.user?.image}<br/>        alt={$page.data.session?.user?.name}<br/>        style="width: 64px; height: 64px;" /&gt;<br/>      &lt;br/&gt;<br/>  {/if}<br/>  &lt;span&gt;<br/>   &lt;strong&gt;{$page.data.session?.user?.email || $page.data.session?.user?.name}&lt;/strong&gt;<br/>  &lt;/span&gt;<br/>    &lt;br/&gt;<br/>    &lt;span&gt;Session expires: {new Date($page.data.session?.expires ?? 0).toUTCString()}&lt;/span&gt;<br/>    &lt;br/&gt;<br/>  &lt;button on:click={() =&gt; signOut()} class="button"&gt;Sign out&lt;/button&gt;<br/><br/>  {:else}<br/>  &lt;span&gt;You are not signed in&lt;/span&gt;&lt;br/&gt;<br/>  &lt;button on:click={() =&gt; signIn('github')}&gt;Sign In with GitHub&lt;/button&gt;<br/> {/if}<br/>&lt;/p&gt;</span></pre><p id="bc2f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe mz na nb mq b">npm run dev</code>运行应用程序，导航到<code class="fe mz na nb mq b">http://localhost:5173</code>并试用它！</p><h1 id="5a45" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">结论</strong></h1><p id="d35c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">AuthJS是一个了不起的库，它简化了许多不同帐户提供商的身份验证。从GitHub到Twitter，甚至只是普通的旧电子邮件和密码，或者神奇的链接，AuthJS都能帮你搞定。我已经开始迁移我自己的项目来使用这个库，因为它很容易使用，甚至可以处理会话数据。我希望你喜欢这个教程，我也希望你能给AuthJS一个尝试！</p><p id="0f2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，AuthJS SvelteKit集成仍在开发中，文档还没有完成，但是经过一点尝试和错误，以及现有的NextAuth文档，不需要很长时间就可以找出任何缺失的部分。一定要给团队一些爱，在<a class="ae kv" href="https://github.com/nextauthjs/next-auth" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上启动项目。</p><div class="nd ne gp gr nf ng"><a href="https://differ.plainenglish.io/p/stylify-css-code-your-sveltekit-website-faster-with-csslike-utilities-ly2ujg9f" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">风格化CSS:用类似CSS的工具更快地编写你的SvelteKit网站</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">Stylify + SvelteKit。使用Stylify更快地设计您的SvelteKit网站。不要研究选择器和语法。使用纯CSS…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">different . plain English . io</p></div></div><div class="np l"><div class="nq l nr ns nt np nu kp ng"/></div></div></a></div><p id="aa6e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nv">更多内容看</em> <a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nv">说白了。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nv">免费周报</em> </strong> </a> <em class="nv">。关注我们关于</em> <a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nv">推特</em> </strong> </a>，<a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="nv">LinkedIn</em></strong></a><em class="nv">，</em><a class="ae kv" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="nv">YouTube</em></strong></a><em class="nv">，以及</em> <a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nv">不和</em> </strong> </a> <strong class="ky ir"> <em class="nv">。</em> </strong></strong></a></p><p id="136f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="nv">有兴趣缩放你的软件启动</em> </strong> <em class="nv">？检查出</em> <a class="ae kv" href="https://circuit.ooo?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nv">电路</em> </strong> </a> <em class="nv">。</em></p></div></div>    
</body>
</html>