<html>
<head>
<title>Create a Basic useFetch Hook in Vue.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Vue.js中创建一个基本的useFetch钩子</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-a-basic-usefetch-hook-in-vue-b3ff113872d7?source=collection_archive---------4-----------------------#2022-03-02">https://javascript.plainenglish.io/create-a-basic-usefetch-hook-in-vue-b3ff113872d7?source=collection_archive---------4-----------------------#2022-03-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="d266" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">胜利的Vue合成API！</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/0bf27926880c79d4c135422e0fad0ff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pb2gKzMSOZs4TAcGmjIn_g.jpeg"/></div></div></figure><p id="e252" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">今天我们将看看如何在Vue.js中创建一个自定义挂钩。为此，我们将创建一个简单的useFetch挂钩，我们可以在我们的组件中重用它。Vue 3中的composition API很吸引我。特别是现在脚本设置允许我们使用你定义的一切，这是有意义的。</p><p id="3948" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我与Vue.js的这一新发展一起工作，并对其做出反应，这确实为我创造了公平的竞争环境。</p><p id="0613" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我想一步一步地告诉你，我们开始吧:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lk"><img src="../Images/2d75fa78df117c55f9b3e8f4a70fa162.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0j64bn8FBCUS8lIy5l0KIw.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk">Start useFetch hook. Create a function with the state we want to export.</figcaption></figure><p id="9d69" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们首先创建我们的<em class="lp"> useFetch </em>函数，因为它是一个钩子，我们将按照惯例以‘<em class="lp">use</em>开始我们的函数名。接下来，我们决定在调用useFetch挂钩时要检索的数据，并将其存储在一个状态对象中。当我们调用函数时，我们希望知道它是否正在加载，是否抛出了错误，如果是，我们希望收到错误消息。最后，我们需要调用返回的数据。</p><p id="a8ee" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们让我们的状态对象是反应性的，因为我们将在获取时改变这些值，并且我们希望我们的状态监听这些改变。我们也可以为我们的每个反应状态项创建单个refs，但是因为它都很好地组合在一起，我认为一个反应对象更合适，可读性更好。</p><p id="e58c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在我们的useFetch钩子的末尾，我们用spread操作符和<a class="ae lq" href="https://vuejs.org/api/reactivity-utilities.html#torefs" rel="noopener ugc nofollow" target="_blank"> <em class="lp"> toRefs </em> </a>函数返回我们的状态。函数允许我们在不失去反应性的情况下破坏我们的状态属性。在我们继续之前，让我们正确地键入我们的状态:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lk"><img src="../Images/7c9b7420cab507c95c863383f55e0059.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FzSlqcBCLE5AOmRy7FGqZw.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk">Add types to our useFetch state.</figcaption></figure><p id="0ca7" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在继续之前，我们向状态添加类型。由于每次调用我们返回的数据不同，我们使用一个<a class="ae lq" href="https://www.typescriptlang.org/docs/handbook/2/generics.html" rel="noopener ugc nofollow" target="_blank">泛型</a>来解决这个问题。现在，当我们调用useFetch钩子时，我们可以传递数据的返回类型。让我们继续:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lk"><img src="../Images/94f83dc33e27b47a89bd6b464416ed2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bo36hynV_YpamZMKi0yfsw.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk">Create a function to fetch data to our useFetch hook</figcaption></figure><p id="5c34" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">接下来，我们将添加一个<em class="lp">异步</em>函数来获取我们的数据。我们做的第一件事是将我们的<em class="lp"> isLoading </em>状态设置为真，这个过程开始了。然后，在我们的try块中，我们设置一个名为<em class="lp">响应</em>的常量，并等待获取带有<em class="lp"> url </em>和(可选)<em class="lp">选项</em>的数据。注意，我们添加了<em class="lp"> url </em>和<em class="lp">选项</em>作为<em class="lp"> useFetch </em>钩子的参数。我们检查response.ok，因为默认情况下，只有当fetch无法发出请求时，才会到达catch处理程序。通过response.ok检查，我们强制将其他错误也转移到catch处理程序。如果没有错误，我们用response.json()填充状态数据。如果有错误，我们将我们的<em class="lp"> hasError </em>状态设置为true，并将错误消息添加到我们的<em class="lp"> errorMessage </em>状态。最后，我们将我们的<em class="lp"> isLoading </em>状态设置回false。让我们完成我们的钩子:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lk"><img src="../Images/2ac5fee22e1ea4a35dd525c061e19146.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*INvGhsclxUgP7Y_uo09hJA.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk">Our finished useFetch hook</figcaption></figure><p id="3cc1" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们要做的最后一件事是调用我们的<em class="lp"> fetchData </em>函数，我们等待结果，所以我们的<em class="lp"> useFetch </em>函数需要是<em class="lp"> async </em>。这样，我们的useFetch钩子就可以使用了。🎉</p><p id="78b0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">你可以很容易地在一个(异步)函数中使用我们的新钩子。当您想直接在组件中获取和使用数据时，有更多的实现选项。这是因为脚本设置中的<a class="ae lq" href="https://vuejs.org/api/sfc-script-setup.html#top-level-await" rel="noopener ugc nofollow" target="_blank">顶层await </a>必须和悬疑结合使用，这还是一个实验性的特性。为了避免实验性的特性，我们可以使用<em class="lp"> onBeforeMount </em>生命周期钩子，创建一个异步函数并立即调用它或者利用。然后在那里设置数据。在未来，我相信我们会有一个最优的解决方案。</p><p id="650b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在，我想向您展示一个(精简的)选项来实现我们的useFetch挂钩，并立即在组件中显示数据。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lk"><img src="../Images/8808c5898b2b7bba7cf560e8312f5190.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VJ8oSC040eqG0hxydAkgBA.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk">a way to use our useFetch hook</figcaption></figure><p id="3d02" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们可以在useFetch钩子上添加缓存或者取消请求的功能，但是我希望这篇文章已经为你提供了创建你自己的定制Vue钩子所需的所有信息。最后，我希望这能让你迷上钩子。</p><p id="a446" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="lp">更多内容请看</em><a class="ae lq" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="lp">plain English . io</em></strong></a><em class="lp">。报名参加我们的</em> <a class="ae lq" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lp">免费周报</em> </strong> </a> <em class="lp">。关注我们关于</em><a class="ae lq" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="lp">Twitter</em></strong></a><em class="lp">和</em><a class="ae lq" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="lp">LinkedIn</em></strong></a><em class="lp">。加入我们的</em> <a class="ae lq" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lp">社区不和谐</em> </strong> </a> <em class="lp">。</em></p></div></div>    
</body>
</html>