<html>
<head>
<title>How to Build a Dell Server For Home Use</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建家用戴尔服务器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-build-a-dell-server-for-home-use-cbf293b9614e?source=collection_archive---------4-----------------------#2022-06-28">https://javascript.plainenglish.io/how-to-build-a-dell-server-for-home-use-cbf293b9614e?source=collection_archive---------4-----------------------#2022-06-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="92ee" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用ZFS、RAID、Docker和Ubuntu构建戴尔R720XD</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/d4621d512efdbcaa15be659567c50972.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*q59sc9QjGGVzooXk"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk"><em class="kr">Image by </em><a class="ae ks" href="https://pixabay.com/users/bru-no-1161770/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1574533" rel="noopener ugc nofollow" target="_blank"><em class="kr">Bruno /Germany</em></a><em class="kr"> from </em><a class="ae ks" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1574533" rel="noopener ugc nofollow" target="_blank"><em class="kr">Pixabay</em></a></figcaption></figure><p id="dd76" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我的职业是软件工程师，但在专业上是该领域所有行业的佼佼者。这包括担任系统管理员、网络架构师、VOIP和通用数字通信工程师以及其他工作。</p><p id="c463" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">多年来，我一直在家里使用一台24/7运行的旧台式电脑，随着时间的推移，我对它进行了更新，以实现许多目标。它运行得很好:</p><ul class=""><li id="d2ec" class="lp lq iq kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">存储我们的照片和视频备份的文件服务器</li><li id="c76b" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">当我在家建立网站时，一个网络服务器来托管它们</li><li id="6ac2" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">能够从任何地方访问我们的数字电影和电视节目的复杂媒体流</li><li id="1ec5" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">一个mythbuntu电视主持人和dvr来管理我们的无线电视</li><li id="476d" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">用于编译和测试代码以及工作部署的项目框</li><li id="419a" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">以及这些年来的许多其他事情…</li></ul><p id="5cbf" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">这台台式计算机服务器有一个4磁盘RAID 5卷，在固态硬盘上运行操作系统(每周备份到RAID)，并使用16GB内存。这个系统虽然达到了目的，但是慢慢的就变成了一堆乱七八糟的配置。所以对我来说，这意味着是时候重建和升级了。</p><p id="dab8" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">在一些朋友的帮助下，Reddit的<a class="ae ks" href="https://www.reddit.com/r/homelab/" rel="noopener ugc nofollow" target="_blank"> /r/homelab </a>，一位非常有帮助的<a class="ae ks" href="https://www.youtube.com/channel/UCKHE9DEep52XlmwLbZUKvyw" rel="noopener ugc nofollow" target="_blank">服务器艺术的权威人士</a>，以及很多谷歌的帮助下，我深入研究了用于家庭使用的二手企业服务器的世界。电脑本身并不贵，最大的一部分成本是硬盘，无论如何，我都必须购买硬盘来扩展我的存储空间。</p><p id="7f86" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">和许多事情一样，我带着一些基本的需求和学习的愿望进入了这个领域。在这篇文章中，我将带你了解我做对了什么，做错了什么。请记住，这更像是一次发现之旅，而不是homelab转换专家给出的建议。我收集了一些在精选的IT专业人员的世界之外相对新颖的东西(尽管在<a class="ae ks" href="https://www.reddit.com/r/homelab/" rel="noopener ugc nofollow" target="_blank"> /r/homelab </a>中相当常见)，我希望它将继续成为学习和扩展我的知识的一个伟大平台。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/31d94dd9577f812df43dba3a7008f745.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WQKJEI3IreL7v0BY"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk"><em class="kr">Photo by Author … Where I started</em></figcaption></figure><h1 id="7d81" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">多少盒？多大？</h1><p id="0d6f" class="pw-post-body-paragraph kt ku iq kv b kw nh jr ky kz ni ju lb lc nj le lf lg nk li lj lk nl lm ln lo ij bi translated">我在两个主要设置之间进行了辩论…要么让两个服务器分离出我的设置的网络连接存储(<a class="ae ks" href="https://en.wikipedia.org/wiki/Network-attached_storage" rel="noopener ugc nofollow" target="_blank"> NAS </a>是一种让您在网络上的许多计算机之间托管和共享文件的服务)组件，要么让一个服务器做所有事情。分离的好处是每台服务器中的升级和配置不会影响到另一台，如果数据在一台机器上，而其他服务在另一台机器上，那么更容易保证你的<em class="nm">数据</em>的安全。缺点是更高的功耗、噪音和成本。</p><p id="b22b" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我这次的计划是将所有不同的项目分离到它们自己的Docker容器中。这将让我保持每个项目的配置非常孤立，并给我一个非常简单的管理项目的方法。这也让我有可能连接大量的个人媒体和备份存储。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h2 id="0570" class="nn mq iq bd mr no np dn mv nq nr dp mz lc ns nt nb lg nu nv nd lk nw nx nf ny bi translated"><em class="kr">备份侧边栏:</em></h2><p id="25ed" class="pw-post-body-paragraph kt ku iq kv b kw nh jr ky kz ni ju lb lc nj le lf lg nk li lj lk nl lm ln lo ij bi translated">家庭服务器本身并不是备份“解决方案”,但它可以是朝着正确方向迈出的一大步。通过使用正确的 <a class="ae ks" href="https://en.wikipedia.org/wiki/ZFS" rel="noopener ugc nofollow" target="_blank"> <em class="nm"> ZFS </em> </a> <em class="nm">或</em><a class="ae ks" href="https://en.wikipedia.org/wiki/RAID" rel="noopener ugc nofollow" target="_blank"><em class="nm">RAID</em></a><em class="nm">设置，服务器上的存储介质将内置冗余，这有助于防止任何单个磁盘出现故障。如果您还在其他计算机上备份了介质，那么您已经很好地分散了风险。但是，如果您试图保存非常重要的数据，您应该始终对这些数据进行离线和/或异地备份。</em></p><p id="7182" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">对于我们家中其他计算机的快照备份，对于我们可以根据需要重新创建的媒体文件的快照备份(例如，从原始DVD复制回文件系统)，甚至对于我们也存储在云中的照片的快照备份，它都是整个备份解决方案的重要组成部分。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><p id="cba3" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我开始调查服务器和成本，对我来说最划算的是戴尔“20”代(420、520、620、720等)。这些足够新，我可以运行稍微更现代的CPU和RAM，但不是太新，以至于它们要花费数千美元。我可以花几百美元买下大多数的服务器。这些服务器配备了超过12个计算机内核、数百千兆字节的内存、数十兆兆字节的存储以及跨多个网卡的高速网络。对我来说过分了？当然，但也应该持续很长时间，并且不会比我现有的解决方案花费更多。</p><p id="38cd" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我开始考虑如何将存储构建到系统中。不久前，我被介绍到ZFS，但当时没有办法转换，所以我从来没有尝试过。这是一个机会，我对ZFS了解得越多，就越想利用它。然而，就像软件raid设置一样，Ubuntu(和其他操作系统)有时会在直接安装到软件磁盘卷和从软件磁盘卷引导时出现问题。他们正在变得越来越好，但我想要一个解决方案，如果出现了改变规则的重大更新，我不必“再次计算”。我真的想为操作系统设置一个硬件RAID，为存储驱动器设置ZFS，这很棘手，因为你不能设置一个RAID控制器卡来同时做这两件事。您需要两张卡和两个位置来连接磁盘。不幸的是，在大多数这种盒子上，你也不能把驱动器分开…它们都连接到一个控制器上。</p><p id="b105" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">这让我只有几个选择。要么我在操作系统和引导驱动器上不使用RAID，我对所有驱动器使用RAID而不是ZFS，要么我有多个RAID控制器卡和独立的驱动器“平面”…这是许多服务器所不具备的。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="ab1a" class="mp mq iq bd mr ms nz mu mv mw oa my mz jw ob jx nb jz oc ka nd kc od kd nf ng bi translated">戴尔R720XD</h1><p id="2cdf" class="pw-post-body-paragraph kt ku iq kv b kw nh jr ky kz ni ju lb lc nj le lf lg nk li lj lk nl lm ln lo ij bi translated">输入戴尔R720XD。那个“XD”？额外磁盘。它有一个后面板，您可以在其中放置两个以上的2.5英寸驱动器，虽然这不是一个“官方支持”的配置，但您可以将后面板与前驱动器面板断开，并通过第二个磁盘控制器来控制它们。</p><p id="52fb" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">该服务器可以在前端安装12个3.5英寸驱动器(或24个2.5英寸驱动器)，在后端安装两个2.5英寸驱动器，这对于家庭服务器来说是一个巨大的存储容量。老实说，对于家庭服务器来说有点荒谬，但这既有学习新事物的空间，也有增长的空间。它还拥有戴尔R720的所有功能，这是我考虑的重型服务器之一。</p><p id="91d9" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我意识到，凭借R720XD的存储容量<em class="nm">和</em>能力，它既有大量可用的硬盘托架，又是一个巨大的计算资源。它足够强大，可以做我想做的任何事情，而且只把它用作NAS有点浪费，所以我只把它作为单个服务器解决方案，而不是尝试构建两个服务器。</p><p id="79d1" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我一只眼睛盯着价格，另一只眼睛盯着功耗。我的希望是尽可能提高热效率，这样坐在地下室楼梯井(或我的办公室)也没问题，不需要风扇一直全速运转。</p><p id="3df9" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">对我来说是这样的配置:</p><ul class=""><li id="f8bf" class="lp lq iq kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">大型前置驱动器(12个3.5英寸驱动器)</li><li id="b954" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">2枚英特尔至强E5–2650 v2:每枚8核，2.6GHz，95瓦</li><li id="f2ed" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">8x16GB PC3L-12800 (256GB)</li><li id="1401" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">适用于ZFS的PERC H310 Mono Mini闪存至IT模式</li><li id="6976" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">用于操作系统RAID 1的H310 PCIe</li><li id="49a8" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">后部灵活托架，带两个600GB 10k 2.5英寸SAS驱动器</li><li id="102a" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">英特尔X540-T2，双10GB，双1GB网卡</li><li id="41c6" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">iDRAC 7 Express</li><li id="bc72" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">双1100瓦白金冗余PSU</li><li id="b41f" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">还有表圈，因为它很漂亮</li></ul><p id="31e8" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">H310是经过大量的谷歌搜索、服务器艺术的一些视频以及在易趣商店订购零件时直接与服务器艺术先生交谈后挑选的。为了使用ZFS，我需要一个JBOD(只是一堆磁盘)模式的PERC卡，这通常需要将卡闪入IT模式…这是一个有点冒险的过程，但购买预闪是便宜的。对于RAID系统，我可以使用几乎任何质量的磁盘控制器。对于我的磁盘速度目标，H310非常适合这两种使用情形，既节省了时间和能源，又不牺牲磁盘的性能。</p><p id="4a96" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">RAM和CPU的选择也是为了平衡功耗、性能和成本。我选择了3.5英寸驱动器，以便能够在任何大型商店买到它们。我得到了7200 rpm的驱动器，虽然我怀疑5400 rpm的ZFS会很好。如果您想要速度，请务必选择2.5英寸SAS硬盘。我不相信我需要那个。总而言之，它仍然是一个非常强大的系统。对于大多数家庭使用来说绰绰有余，我希望它在正常使用时不会太热，风扇会一直响。</p><p id="2f06" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我还得对<a class="ae ks" href="https://www.orangecomputers.com/node/" rel="noopener ugc nofollow" target="_blank">桔子电脑</a>大呼一声。我从他们那里订购了大部分零件和一些二手硬盘。他们在寻找组件方面做得很好，讨论了哪些可以涵盖，哪些不可以涵盖，当我后来遇到问题时，<em class="nm">确实涵盖了一些用过的磁盘的退货和更换(更换已经进行了几个月)。我觉得从一家有良好声誉和良好保修的公司订购要舒服得多，即使这比从易贝拼凑东西要贵一点。</em></p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="b89e" class="mp mq iq bd mr ms nz mu mv mw oa my mz jw ob jx nb jz oc ka nd kc od kd nf ng bi translated">初始设置:物理配置和BIOS</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/7cb576a1c860f179bcaf216db23e8b02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*69qYsrxWa5x4DNWQ"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk"><em class="kr">Photo by Author … the pieces</em></figcaption></figure><p id="c83c" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">计划已经就绪。集合时间到了！对于企业服务器来说，这一步非常容易。我当然鼓励你阅读说明书(注意说明书也可以在外壳内看到)，但是几乎电脑中的所有东西都可以通过一些夹子或拉杆轻松连接或拆卸。对于我正在做的事情，我甚至不记得我是否必须使用螺丝刀。</p><p id="3e27" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">说明书上说，首先打开电源大约15分钟，以便电源可以自行配置。我设置它没有硬盘和额外的RAID卡，所以我只是打开它，看看它会做什么。果然，用了15分钟左右，循环了几个测试，大部分时间都像飞机起飞一样尖叫。几分钟后我真的离开了房间并关上门。</p><p id="4812" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">声音太大了。肯定让我紧张，我做了一个糟糕的决定。但那时我别无选择，只能继续下去，看看它会走向何方。</p><blockquote class="oe"><p id="120b" class="of og iq bd oh oi oj ok ol om on lo dk translated">“如果你正在经历地狱，那就继续前进。”</p><p id="936f" class="of og iq bd oh oi oj ok ol om on lo dk translated">―温斯顿·丘吉尔</p></blockquote><p id="f60c" class="pw-post-body-paragraph kt ku iq kv b kw oo jr ky kz op ju lb lc oq le lf lg or li lj lk os lm ln lo ij bi translated">接下来是安装PCIe卡和SAS驱动器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/c0abe53cdd6169fad5713278b8cb2aea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CTpt0deX5rLQY_HM"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk"><em class="kr">Photo by Author … PCIe RAID card in upper left over the rear backplane</em></figcaption></figure><p id="c66d" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">这是我找到的最好的卡槽。只需要一根短电缆(在这种情况下，是SFF-8087到SFF-8087微型SAS电缆)并将其连接到后背板。我在网上看到了一些关于断开背板传感器电缆的讨论，但要么已经为我做了，也许是通过与<a class="ae ks" href="https://www.orangecomputers.com/node/" rel="noopener ugc nofollow" target="_blank"> Orange Computers </a>的讨论，要么我不需要为了让我所有的blinky灯都有正确的颜色而这样做。</p><p id="d57b" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">安装了后面的SAS驱动器和安装在后面背板上的PCIe RAID控制器后，我再次启动并为RAID1配置了后面的托架。在设备设置中，这些显示为“Slot6 DELL PERC H310”。设置这部分非常简单。</p><p id="23da" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">接下来，我关闭电源并安装了IT模式Mini Mono H310和12个3.5英寸驱动器。当我再次启动时，我没有看到任何驱动器，尽管它认为H310是一个集成的LSI SAS2 MPT控制器。我尝试调整一些东西，但最终它关闭了集成raid控制器(在BIOS集成设备设置中)，重新启动，重新启用，并再次重新启动，让我看到所有12个磁盘显示在启动序列和卡的细节下。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="a293" class="mp mq iq bd mr ms nz mu mv mw oa my mz jw ob jx nb jz oc ka nd kc od kd nf ng bi translated">请安静！使R720XD在听觉上可以忍受</h1><p id="73ee" class="pw-post-body-paragraph kt ku iq kv b kw nh jr ky kz ni ju lb lc nj le lf lg nk li lj lk nl lm ln lo ij bi translated">R720XD默认为<em class="nm">大声</em>。我知道这将需要一些修改，使它更安静。如果没有其他工作，我准备修改风扇或更换为低转速“静音”模式。即使对我来说，这也有点奇怪，因为这将有效地禁用服务器上的几个散热功能，虽然你通常不需要这些，但当你需要时，你<em class="nm">真的</em>需要它们。</p><p id="d163" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我在unraid论坛上发现了一篇很棒的文章:</p><div class="ot ou gp gr ov ow"><a href="https://forums.unraid.net/topic/51733-taming-a-12th-gen-dell-poweredge/" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd ir gy z fp pb fr fs pc fu fw ip bi translated">驯服第12代戴尔PowerEdge</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">不得不喜欢退役的服务器...无论如何，这些东西开始进入二手市场，而且越来越便宜。的…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">forums.unraid.net</p></div></div><div class="pf l"><div class="pg l ph pi pj pf pk kl ow"/></div></div></a></div><p id="1af0" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我首先经历了在盒子上更新固件的过程。通过BIOS很容易做到这一点，我想如果我发现这是正确的答案，我可以随时尝试将它降级到特定的版本。然而，出于许多原因，最新的固件通常是一件好事。</p><p id="876c" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我采取的下一步措施是:</p><ul class=""><li id="db51" class="lp lq iq kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">转到IDRAC thermal并设置为性能功耗比和50摄氏度(没有更低的选项)。注:将以太网连接插入右后插头，这是IDRAC端口。</li><li id="b158" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">在“power”下，将电源设置为冗余，启用热备盘并启用功率因数校正，以便一次只使用一个PSU。这确实使它安静了一点。</li><li id="13b7" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">我禁用了生命周期控制器在每次重启时收集信息。更换单个磁盘可能会让它闲置20分钟或更长时间，这是我不喜欢(或不需要)的。它加快了重新启动的时间，我不希望戴尔对这款机型进行任何新的固件更新，所以我现在就让它这样。</li></ul><p id="1f32" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">在这一点上，它似乎仍然令人失望地大声。在IDRAC中，风扇似乎以大约50%的速度旋转，但当我重新启动Ubuntu 20.04的USB引导时，因为我已经启动系统几个小时了，还没有测试操作系统，风扇明显安静下来了！可能只有我以前的台式服务器的两倍大。成功！</p><p id="675f" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">在这种模式下，它的运行功率为266瓦(空闲)，PSU2的功耗为0安培，CPU1和2的温度分别为61摄氏度(142华氏度)和49摄氏度(120华氏度)，排气温度为37摄氏度(98华氏度)，而这并不是在一个超级寒冷的房间里，在这个夏天，入口温度为25摄氏度(77华氏度)，服务器整个上午都在向里面吹热风。</p><p id="afee" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">有很多帖子提供了让这些机器安静下来的“解决方案”。它们的范围从相当简单(转到支持低速风扇的固件版本)，到稍微更极端(用更安静、运行更慢的风扇替换所有风扇)，到非常极端(入侵温度传感器本身)。它们都有潜在的缺点，我宁愿尽可能保持最新和标准的东西。就目前情况来看，我很少看到粉丝超过我工作量的30%,通常他们保持在22%左右。我手机上的廉价分贝仪告诉我，十英尺外是35分贝，一英尺外是45分贝。一点也不差。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="e81a" class="mp mq iq bd mr ms nz mu mv mw oa my mz jw ob jx nb jz oc ka nd kc od kd nf ng bi translated">安装Ubuntu服务器并减少重启时间</h1><p id="80f1" class="pw-post-body-paragraph kt ku iq kv b kw nh jr ky kz ni ju lb lc nj le lf lg nk li lj lk nl lm ln lo ij bi translated">你会问，为什么是Ubuntu服务器？为什么不呢？它是最受支持和使用的linux发行版之一，与ZFS配合得很好，有定期更新，并且相对来说占用空间最小。</p><p id="4729" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">在后面的RAID驱动器上安装Ubuntu Server很容易。制作一个可启动的USB驱动器并将其插入(我使用前面板USB只是为了尝试一下，它工作得很好)。在引导期间进入引导菜单(F11)，使用UEFI菜单，选择可移动驱动器，然后选择安装Ubuntu。它将检查大量的硬件，这似乎比在普通桌面上花费的时间要长一些。确保安装到RAID卷，而不是前面板驱动器。在安装过程中，我的系统排气温度保持在40摄氏度左右，远远低于风扇试图保持的50C。风扇始终在22%到27%的速度之间徘徊。</p><p id="50bc" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">一个注意:安装似乎卡在“安装柯廷钩”。这将保持安装轮永远旋转。但是如果你按下Tab键，转到“查看完整日志”，当它完成时，你会看到“所有升级已安装”，然后可以通过点击“查看完整日志”下的“立即重启”来重启。确保你在BIOS启动设置中设置为从UEFI启动，而不是从BIOS启动，这样你就可以启动并运行了！</p><p id="8313" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我也喜欢有一个可用的图形环境(主要用于gparted紧急情况，虽然有时也可以缓慢地挂载外部驱动器)，所以我添加了xubuntu，同时我还按照我喜欢的方式设置了我的vimrc和bashrc。不得不经历几次重启让我想到了我的下一个好奇的“问题”…重启需要大约12分钟。戴尔花了很多时间研究硬件，但Ubuntu花了几分钟时间在“等待网络配置”或“等待网络配置”。</p><p id="df2e" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">这里的解决方案似乎是设置三个(！)我没有使用的以太网设备是可选的。进入/etc/net plan/00-installer-config . YAML，为除第一个以太网端口之外的所有端口添加“optional: yes”。</p><p id="238b" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">这个最终的修复让我的重启时间(从发出重启命令到我可以再次使用操作系统的时间)减少到了大约6分钟。以台式机的标准来看还是不快，但比我之前看到的12到15分钟的启动时间要快得多。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="6b0a" class="mp mq iq bd mr ms nz mu mv mw oa my mz jw ob jx nb jz oc ka nd kc od kd nf ng bi translated">ZFS:设置、失败的驱动器更换和报告</h1><p id="823c" class="pw-post-body-paragraph kt ku iq kv b kw nh jr ky kz ni ju lb lc nj le lf lg nk li lj lk nl lm ln lo ij bi translated">开始安装ZFS。该软件以软件包的形式提供，这很好，因为这意味着它会随着操作系统的变化而保持最新。</p><pre class="kg kh ki kj gt pl pm pn po aw pp bi"><span id="17d8" class="nn mq iq pm b gy pq pr l ps pt">sudo apt install zfsutils-linux</span></pre><p id="ab37" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">之后，找出我有哪些磁盘:</p><pre class="kg kh ki kj gt pl pm pn po aw pp bi"><span id="6f91" class="nn mq iq pm b gy pq pr l ps pt">fdisk -l</span><span id="f133" class="nn mq iq pm b gy pu pr l ps pt">smartctl -a /dev/sdX</span></pre><p id="f545" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我记下了来自smartctl和fdisk的序列号、托架和磁盘标识符的映射。这将允许我基于驱动器的ID而不是设备名称来构建池，设备名称在添加其他项目时会在启动时发生变化。对于此机箱，您可以一次添加一个驱动器，而无需重新启动(热插拔！)，检查fdisk -l的磁盘ID和设备名(每次应该是字母表中的下一个字母)，然后使用smartctl获取序列号。或者，您可以只记下每个驱动器的序列号，并检查您添加的每个驱动器的fdisk以使它们匹配。</p><p id="673b" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我制作了一个bay表，这样当我遇到错误时，我可以很容易地找到有问题的驱动器并将其拔出，而不需要太多的额外检查。例如:</p><p id="b3cb" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi">0 1 2 3</p><p id="30ae" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi">4 5 6 7</p><p id="75c9" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi">8 9 10 11</p><p id="327b" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我一次添加一个驱动器，然后填写每个驱动器的信息(例如):</p><pre class="kg kh ki kj gt pl pm pn po aw pp bi"><span id="e325" class="nn mq iq pm b gy pq pr l ps pt">Bay 6: 4TB</span><span id="281b" class="nn mq iq pm b gy pu pr l ps pt">/dev/disk/by-id/scsi-SATA_ST4000NM0033–9ZM_S1Z2BN8J</span><span id="325f" class="nn mq iq pm b gy pu pr l ps pt">Disk identifier: FACF252C-D595-C745-A990–730AE390BD6A</span><span id="2f07" class="nn mq iq pm b gy pu pr l ps pt">Model Family: Seagate Constellation ES.3</span><span id="680a" class="nn mq iq pm b gy pu pr l ps pt">Serial Number: S1Z2BN8J</span></pre><p id="f2c7" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">你大部分的信息是从哪里得到的</p><pre class="kg kh ki kj gt pl pm pn po aw pp bi"><span id="4427" class="nn mq iq pm b gy pq pr l ps pt">sudo smartctl -a /dev/sd&lt;a-z&gt;</span></pre><p id="94fd" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">要获取磁盘标识符，您可以运行:</p><pre class="kg kh ki kj gt pl pm pn po aw pp bi"><span id="1a2b" class="nn mq iq pm b gy pq pr l ps pt">ls /dev/disk/by-id/ | grep &lt;serialnumber&gt;</span></pre><p id="95f4" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">这些驱动器需要一个分区表，这也很容易从命令行添加。</p><pre class="kg kh ki kj gt pl pm pn po aw pp bi"><span id="3ca9" class="nn mq iq pm b gy pq pr l ps pt">parted /dev/sdd</span><span id="f50d" class="nn mq iq pm b gy pu pr l ps pt">$ mklabel GPT</span><span id="9887" class="nn mq iq pm b gy pu pr l ps pt">$ quit</span></pre><p id="8e9d" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">清除zfs的任何现有分区</p><pre class="kg kh ki kj gt pl pm pn po aw pp bi"><span id="93c1" class="nn mq iq pm b gy pq pr l ps pt">sfdisk — delete /dev/sdd</span></pre><p id="fb50" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">一旦GPT被添加到每个磁盘，并且没有分区，就该创建zfs了。为了好玩，我坚持使用普通的“坦克”名称，并开始尝试。我有一些剩余的3TB驱动器和来自3个不同批次和供应商的12个4TB服务器驱动器…这是一种“安全”措施，这样您就不会因为所有驱动器都完全相同而在同一时间用完它们。我想测试扩展vdev的能力，所以我加载了3、3、4、4、4和4、4、4、4、4、4 TB驱动器的vdev。</p><pre class="kg kh ki kj gt pl pm pn po aw pp bi"><span id="7161" class="nn mq iq pm b gy pq pr l ps pt">zpool create tank raidz2 /dev/disk/by-id/[id0] /dev/disk/by-id/[id1] &lt;etc&gt; -f</span><span id="6c11" class="nn mq iq pm b gy pu pr l ps pt">zpool add tank raidz2 /dev/disk/by-id/[id6] /dev/disk/by-id/[id7] &lt;etc&gt; -f</span></pre><p id="3ecb" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">接下来，我根据看的几篇文章，盲调了一点。这里有一个很好的记录:</p><div class="ot ou gp gr ov ow"><a href="https://www.admin-magazine.com/mobile/HPC/Articles/Tuning-ZFS-for-Speed-on-Linux" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd ir gy z fp pb fr fs pc fu fw ip bi translated">高性能计算的ZFS调优</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">如果您管理存储服务器，您可能已经知道ZFS及其一些特性和功能…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">www.admin-magazine.com</p></div></div><div class="pf l"><div class="pv l ph pi pj pf pk kl ow"/></div></div></a></div><ul class=""><li id="0e4e" class="lp lq iq kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><code class="fe pw px py pm b">zfs set mountpoint=/data tank</code></li><li id="88dd" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><code class="fe pw px py pm b">zfs set xattr=sa tank</code></li><li id="267a" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><code class="fe pw px py pm b">zfs set acltype=posixacl tank</code></li><li id="6a4c" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><code class="fe pw px py pm b">zfs set atime=off tank</code></li><li id="7c68" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><code class="fe pw px py pm b">zfs set relatime=off tank</code></li><li id="bed9" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><code class="fe pw px py pm b">zfs set compression=lz4 tank</code></li><li id="3d0f" class="lp lq iq kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><code class="fe pw px py pm b">zpool set autoexpand=on tank</code></li></ul><p id="1eb2" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">首先，我测试了ZFS在重启时是否被正确地重新挂载了，这对于我来说是自动的。不过，这是配置中的一个常见问题，所以如果您有问题，请查看:</p><div class="ot ou gp gr ov ow"><a href="https://askubuntu.com/questions/1294944/zfs-pool-not-auto-mounting-after-upgrade-to-20-04" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd ir gy z fp pb fr fs pc fu fw ip bi translated">升级到20.04后，ZFS池不会自动装载</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">在Ubuntu 18.10更新到20.04时，zfs池在启动时自动导入，池不再在启动时导入-我看不到…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">askubuntu.com</p></div></div><div class="pf l"><div class="pz l ph pi pj pf pk kl ow"/></div></div></a></div><p id="4164" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">检查尺寸:</p><pre class="kg kh ki kj gt pl pm pn po aw pp bi"><span id="a9e9" class="nn mq iq pm b gy pq pr l ps pt">zfs list</span><span id="bb37" class="nn mq iq pm b gy pu pr l ps pt">NAME USED AVAIL REFER MOUNTPOINT</span><span id="e041" class="nn mq iq pm b gy pu pr l ps pt">tank 21.9G 24.6T 21.9G /data</span><span id="b523" class="nn mq iq pm b gy pu pr l ps pt">zpool list</span><span id="2167" class="nn mq iq pm b gy pu pr l ps pt">NAME SIZE ALLOC FREE</span><span id="28d4" class="nn mq iq pm b gy pu pr l ps pt">tank 38.2T 32.9G 38.2T</span></pre><p id="0c45" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">命令“zfs list”显示可用空间量。这包含了我的两个奇怪大小的游泳池。4*3.65TB + 4*2.75TB加上一些开销。奇数而不是4TB和3TB是因为硬盘制造商通常使用兆字节(1000的倍数)和操作系统报告兆字节(1024的倍数)。</p><p id="a5b7" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">命令“zpool list”显示总可用空间为6*2.75TB + 6*3.65TB，外加少量开销。</p><p id="ef3d" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">很多时候，我们会关心“zfs列表”。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="12a5" class="mp mq iq bd mr ms nz mu mv mw oa my mz jw ob jx nb jz oc ka nd kc od kd nf ng bi translated">测试读/写速度</h1><p id="b878" class="pw-post-body-paragraph kt ku iq kv b kw nh jr ky kz ni ju lb lc nj le lf lg nk li lj lk nl lm ln lo ij bi translated">首先，作为一个快速的“真实世界”测试，我将一个7.7GB的文件从zfs池复制到raid阵列，耗时10.2秒。我把它从raid阵列复制到zfs池，用了8.9秒。这相当快，演示了同时从/向两个设备读/写。太好了，但是是时候隔离和测试了！</p><div class="ot ou gp gr ov ow"><a href="https://arstechnica.com/gadgets/2020/02/how-fast-are-your-disks-find-out-the-open-source-way-with-fio/" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd ir gy z fp pb fr fs pc fu fw ip bi translated">你的磁盘有多快？用fio找出开源的方法</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">查看更多故事存储性能指标评测——与Wi-Fi性能指标评测非常相似——是一项被广泛误解的黑色艺术。管理员和…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">arstechnica.com</p></div></div><div class="pf l"><div class="qa l ph pi pj pf pk kl ow"/></div></div></a></div><p id="de2a" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我使用dd和fio进行了测试，以获得单次访问和多次访问的读/写速度。</p><p id="e584" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我的zfs阵列报告的写入速度高达1.4GB/s，其中单次访问写入的数据大小为中到大(64k到1M的批处理)，对于非常小的批处理大小(1k到4k)，速度相当慢，约为50MB/s，但当多达16个线程同时写入文件时，速度高达550MB/s到670MB/s，而不管批处理大小如何(1k到1M)。</p><p id="319f" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">对于读取速度，我得到的最慢速度是280MB/s的小批量(1k到4k)单次访问读取。但是对于较大的批量或多线程读取，我得到的速度在2.1GB/s到5GB/s之间！</p><p id="3339" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">这些数字对我有用。</p><p id="2c6d" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">在此期间，粉丝数量一直保持在25%左右，只是偶尔会达到30%的水平。总体来说还是相当安静的。</p><p id="79df" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">接下来，我用一台在ssd上存储数据并使用ftp和sftp的linux笔记本电脑进行了测试。我得到了100.4兆字节/秒和98.8兆字节/秒的传输速度(双向)。与我的1Gbps交换机相比，每个方向大约800Mbps(每个字节为8位)，加上tcp和ftp/sftp的开销，我确实觉得我已经接近最大传输速度了。太棒了。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="f986" class="mp mq iq bd mr ms nz mu mv mw oa my mz jw ob jx nb jz oc ka nd kc od kd nf ng bi translated">使VDEV降级</h1><p id="f226" class="pw-post-body-paragraph kt ku iq kv b kw nh jr ky kz ni ju lb lc nj le lf lg nk li lj lk nl lm ln lo ij bi translated">现在是时候测试降级我的vdev和将我的vdev增长到最大容量了。我想在获取所有数据之前尝试一下这些东西，以确保一切都设置正确。如果五年后我发现我犯了一个简单的错误，无法轻松扩展我的vdevs，或者我设法使更换损坏的驱动器变得困难，那将是一场灾难！</p><p id="325b" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">首先，我用以下方法检查一切是否正常:</p><pre class="kg kh ki kj gt pl pm pn po aw pp bi"><span id="8157" class="nn mq iq pm b gy pq pr l ps pt">zpool status</span></pre><p id="447c" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">它告诉我一切都在线，没有报告错误。</p><p id="1604" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我将从raid z2–0驱动器Z1F2P2TB开始。我从我的笔记中了解到，我在0号机架中安装了所有的驱动器。这被标记为/dev/sdb，但是再次使用驱动器ID来唯一地标识它们。</p><pre class="kg kh ki kj gt pl pm pn po aw pp bi"><span id="35d9" class="nn mq iq pm b gy pq pr l ps pt">zpool offline tank scsi-SATA_ST3000DM001–1CH1_Z1F2P2TB</span></pre><p id="d1ca" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">然后，我再次检查状态，发现tank和raidz 2–0都处于降级状态(raidz 2–1列为联机)。它很高兴地告诉我，该池继续在降级状态下运行。完美。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="6c40" class="mp mq iq bd mr ms nz mu mv mw oa my mz jw ob jx nb jz oc ka nd kc od kd nf ng bi translated">发展VDEV</h1><p id="4412" class="pw-post-body-paragraph kt ku iq kv b kw nh jr ky kz ni ju lb lc nj le lf lg nk li lj lk nl lm ln lo ij bi translated">现在我需要找到新的磁盘。我可以将序列号读取为Z1Z78C3E，因此我将检查fdisk和smartctl的/dev/sdb(当我交换它时)和/dev/disk/by-id/否则。找到后，我只需更新我的笔记，说明哪个驱动器在bay 0和raidz 2–0中。我还将再次使用parted来删除分区和/或创建一个gpt分区表，这样我将有一个带有磁盘标识符的干净磁盘来加载到vdev中。</p><p id="b0eb" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">在物理交换驱动器后，检查我的zpool状态，我仍然看到旧磁盘列为脱机，没有提到新磁盘。是时候更换了！</p><pre class="kg kh ki kj gt pl pm pn po aw pp bi"><span id="4661" class="nn mq iq pm b gy pq pr l ps pt">zpool replace tank scsi-SATA_ST3000DM001–1CH1_Z1F2P2TB /dev/disk/by-id/scsi-SATA_ST4000NM0033–9ZM_Z1Z78C3E</span></pre><p id="e853" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">现在，当检查状态时，它仍然处于降级状态，但表示它正在等待重新镜像驱动器。就我而言，几秒钟之内，我就看到状态更新为在线。</p><p id="d713" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">在这种情况下，它只需要重新配置2.21GB。这大约是目前存储在zpool中的总数据的1/10，因为我刚刚启动时驱动器上几乎没有数据。相比之下，raid阵列的重新镜像(无论有多少数据放在磁盘上，通常都必须重新镜像整个磁盘大小)，您会开始看到ZFS的一些好处。</p><p id="96ce" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我更换了另一个3TB驱动器，因此所有驱动器都是4TB，并遵循相同的过程。几秒钟之内，磁盘再次被还原。</p><p id="4ec0" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">现在让我们看看自动扩展是否发挥了它的魔力:</p><pre class="kg kh ki kj gt pl pm pn po aw pp bi"><span id="242a" class="nn mq iq pm b gy pq pr l ps pt">zfs list</span><span id="ab12" class="nn mq iq pm b gy pu pr l ps pt">NAME USED AVAIL REFER MOUNTPOINT</span><span id="5618" class="nn mq iq pm b gy pu pr l ps pt">tank 21.9G 28.1T 21.9G /data</span><span id="e991" class="nn mq iq pm b gy pu pr l ps pt">zpool list</span><span id="bac2" class="nn mq iq pm b gy pu pr l ps pt">NAME SIZE ALLOC FREE CKPOINT EXPANDSZ FRAG CAP DEDUP HEALTH ALTROOT</span><span id="b269" class="nn mq iq pm b gy pu pr l ps pt">tank 43.7T 32.9G 43.6T — — 0% 0% 1.00x ONLINE -</span></pre><p id="292f" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">是啊！我有高达43.6TB的总空间(大约3.65*12)和28.1TB的可用空间(大约3.65*8加上一些开销)。自动扩展成功了！</p><p id="3628" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我不得不第二次更换多个磁盘…在加载了12TB的数据之后…因为我从亚马逊订购的四个磁盘中的三个出现了故障，我从orange computers订购的八个磁盘中的一个也出现了故障。谢天谢地，第一次vdev只有一个磁盘完全失效，所以还好。第二个vdev有两个磁盘出现故障，其中一个进入降级模式。这很可怕，促使我设置了电子邮件警告，这样以后任何时候磁盘出现问题，我都会得到通知。没有什么能让他们回来。幸运的是，在一个磁盘降级、两个磁盘出现故障的情况下，我的数据仍然完好无损，因此我不必从备份中重新开始。</p><p id="7e4c" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">旧驱动器的说明。我买了这些二手硬盘，知道有风险。亚马逊卖家没有保修，但考虑到容错能力，我希望在运营的头几个月到一年里节省一些钱。咬了我一口。orange computers出故障的磁盘得到了保修，他们为我更换了它。</p><p id="6435" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我只更换了第二个vdev上的一个磁盘，并让它重新镜像，这花了大约3个小时(12.5TB)。然后，我一次替换一个进程(执行replace命令会启动resilver，而不是同时将多个进程联机，我认为应该让每个进程完成后再执行下一个进程)。</p><p id="0b3f" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">热插拔硬盘太棒了。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="204b" class="mp mq iq bd mr ms nz mu mv mw oa my mz jw ob jx nb jz oc ka nd kc od kd nf ng bi translated">设置ZED (ZFS事件守护进程)只发送重要警告</h1><p id="ecb0" class="pw-post-body-paragraph kt ku iq kv b kw nh jr ky kz ni ju lb lc nj le lf lg nk li lj lk nl lm ln lo ij bi translated">由于这种恐惧，我知道我需要设置扫描和电子邮件警告。这被证明是相对容易的，只有几个陷阱可以借鉴。</p><p id="eeb2" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我的ZFS阵列中的JBOD磁盘需要一行配置:</p><pre class="kg kh ki kj gt pl pm pn po aw pp bi"><span id="b2a5" class="nn mq iq pm b gy pq pr l ps pt">DEVICESCAN -H -l error -l selftest -f -s (S/../../6/03) -m &lt;myemail&gt; -M exec /usr/share/smartmontools/smartd-runner</span></pre><p id="fdf7" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">这是为了监视磁盘的SMART问题，并每周运行一次短扫描。最后，它执行我的smartd-runner脚本(稍后我会讲到)。</p><p id="3889" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">raid磁盘花了我很长时间才弄明白。在Ubuntu中，你可以使用megaraid来设置智能测试，如下所示:</p><pre class="kg kh ki kj gt pl pm pn po aw pp bi"><span id="44da" class="nn mq iq pm b gy pq pr l ps pt">/dev/sda -d megaraid,0 -H -l error -l selftest -f -s (S/../../6/03) -m &lt;myemail&gt; -M exec /usr/share/smartmontools/smartd-runner</span><span id="0809" class="nn mq iq pm b gy pu pr l ps pt">/dev/sda -d megaraid,1 -H -l error -l selftest -f -s (S/../../6/03) -m &lt;myemail&gt; -M exec /usr/share/smartmontools/smartd-runner</span></pre><p id="591a" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">Devicescan扫描所有zfs驱动器，megaraid扫描raid驱动器。现在，smartctl正在扫描并向我发送电子邮件，zfs正在清理并向我发送电子邮件……所有这些都有利于通知，我可以让sas驱动器出现故障，6个磁盘池中的任何两个驱动器出现故障，或者让raid驱动器出现故障，我将收到一封电子邮件。</p><p id="b510" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">在过去的几个月里，这已经过测试，测试对象既有拉取驱动器，也有出现从失败到简单的SMART错误等问题的驱动器。</p><p id="4016" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">事实上，我得到的一些错误意味着一个驱动器正在慢慢地失败，但还没有失败。鉴于我的容错能力(以及我的数据的非关键性)，只要只有一个驱动器出现故障，在我更换它们之前，我希望让它们一直出现故障。但是我不需要每天在同一个硬盘上收到邮件。在就单个驱动器的SMART问题发送消息两周之后，我添加了smartd-runner脚本，该脚本仅在消息与上次发送的消息不同时才发送消息。我在这里加入了这个脚本:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="qb qc l"/></div></figure></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="b10b" class="mp mq iq bd mr ms nz mu mv mw oa my mz jw ob jx nb jz oc ka nd kc od kd nf ng bi translated">结局是尽人皆知的</h1><p id="3d3a" class="pw-post-body-paragraph kt ku iq kv b kw nh jr ky kz ni ju lb lc nj le lf lg nk li lj lk nl lm ln lo ij bi translated">之后，我设置了Docker，NGINX，并开始构建我想运行的所有服务的容器，所有这些都设置在NGINX端口转发的后面。太棒了。每个服务和项目都是独立的，升级任何一个项目或项目的依赖项都不会对其他项目产生影响。</p><p id="2ccd" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">我有大量的容错存储，并继续使用ZFS、容器和web服务。当我在编程、处理数据或编译时，这个机器足够强大，可以处理一些重要的代码行。</p><p id="85d0" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">剩下唯一要做的事情是完成我的地下室，这样我就可以把盒子从我的办公室搬到一个专用的“网络”壁橱里(在楼梯下面)！</p><p id="e3fd" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated">期待各位媒体博主在评论中对本文的反馈，特别是:<a class="qd qe ep" href="https://medium.com/u/62fbee41aad2?source=post_page-----cbf293b9614e--------------------------------" rel="noopener" target="_blank">内文·卡茨</a>、<a class="qd qe ep" href="https://medium.com/u/a262a804b78f?source=post_page-----cbf293b9614e--------------------------------" rel="noopener" target="_blank">冈田新一</a>、<a class="qd qe ep" href="https://medium.com/u/8ae6a5b70ece?source=post_page-----cbf293b9614e--------------------------------" rel="noopener" target="_blank">何塞·格兰哈</a>、<a class="qd qe ep" href="https://medium.com/u/a8a3c73c563?source=post_page-----cbf293b9614e--------------------------------" rel="noopener" target="_blank">布莱恩·迪克伊岑</a>、&amp; <a class="qd qe ep" href="https://medium.com/u/1e2ea32699c9?source=post_page-----cbf293b9614e--------------------------------" rel="noopener" target="_blank">埃里克·克莱本</a>。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><p id="bc9e" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated"><a class="ae ks" href="https://medium.com/@citizenupgrade" rel="noopener"> <em class="nm">公民升级</em> </a> <em class="nm">是一个涵盖技术、社会、个人发展的专家社区。请访问我们的</em> <a class="ae ks" href="https://citizenupgrade.com/" rel="noopener ugc nofollow" target="_blank"> <em class="nm">网站</em> </a> <em class="nm">，访问</em> <a class="ae ks" href="https://www.facebook.com/citizenupgrade" rel="noopener ugc nofollow" target="_blank"> <em class="nm">脸书</em> </a> <em class="nm">，或访问</em> <a class="ae ks" href="https://twitter.com/CitizenUpgrade" rel="noopener ugc nofollow" target="_blank"> <em class="nm">推特</em> </a> <em class="nm">。加入我们的</em> <a class="ae ks" href="http://www.citizenupgrade.com/join" rel="noopener ugc nofollow" target="_blank"> <em class="nm">邮件列表</em> </a> <em class="nm">，获取更多精彩内容和其他有用资源。</em></p><div class="ot ou gp gr ov ow"><a href="https://citizenupgrade.medium.com/membership" rel="noopener follow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd ir gy z fp pb fr fs pc fu fw ip bi translated">通过我的推荐链接加入Medium公民升级</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">citizenupgrade.medium.com</p></div></div><div class="pf l"><div class="qf l ph pi pj pf pk kl ow"/></div></div></a></div><div class="ot ou gp gr ov ow"><a href="https://codeburst.io/quickstart-guide-to-oculus-quest-2-and-unreal-engine-4-506ca8c27a05" rel="noopener follow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd ir gy z fp pb fr fs pc fu fw ip bi translated">Oculus Quest 2和虚幻引擎4快速入门指南</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">虚拟现实入门</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">codeburst.io</p></div></div><div class="pf l"><div class="qg l ph pi pj pf pk kl ow"/></div></div></a></div><div class="ot ou gp gr ov ow"><a href="https://codeburst.io/creating-local-python-packages-with-init-py-aa19f1e9e80f" rel="noopener follow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd ir gy z fp pb fr fs pc fu fw ip bi translated">使用__init__创建本地Python包。巴拉圭</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">用于代码重用和分发的包</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">codeburst.io</p></div></div><div class="pf l"><div class="qh l ph pi pj pf pk kl ow"/></div></div></a></div><div class="ot ou gp gr ov ow"><a href="https://levelup.gitconnected.com/networking-your-home-ethernet-1dc94cdf6c1e" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd ir gy z fp pb fr fs pc fu fw ip bi translated">将您的家庭联网:以太网</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">在家中安装以太网，实现高速家庭网络</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="pf l"><div class="qi l ph pi pj pf pk kl ow"/></div></div></a></div><div class="ot ou gp gr ov ow"><a href="https://levelup.gitconnected.com/networking-your-home-network-equipment-b864c9ecf596" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd ir gy z fp pb fr fs pc fu fw ip bi translated">为您的家庭建立网络:网络设备</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">运行家庭网络所需的硬件</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="pf l"><div class="qj l ph pi pj pf pk kl ow"/></div></div></a></div><p id="9b8b" class="pw-post-body-paragraph kt ku iq kv b kw kx jr ky kz la ju lb lc ld le lf lg lh li lj lk ll lm ln lo ij bi translated"><em class="nm">更内容于</em> <a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv ir"> <em class="nm">普通英语</em> </strong> </a> <em class="nm">。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv ir"> <em class="nm">免费周报</em> </strong> </a> <em class="nm">。</em> <a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kv ir"> <em class="nm">推特</em> </strong> </a> <em class="nm">和</em><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv ir"><em class="nm">LinkedIn</em></strong></a><em class="nm">追随我们。查看我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kv ir"> <em class="nm">社区不和</em> </strong> </a> <em class="nm">并加入我们的</em> <a class="ae ks" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kv ir"> <em class="nm">人才集体</em> </strong> </a> <em class="nm">。</em></p></div></div>    
</body>
</html>