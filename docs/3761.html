<html>
<head>
<title>Secure Client-Side Storage Data with Web Crypto (React + TypeScript)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Web Crypto保护客户端存储数据(React + TypeScript)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/secure-client-side-storage-data-using-with-web-crypto-react-js-typescript-f43944fad7b3?source=collection_archive---------4-----------------------#2022-09-23">https://javascript.plainenglish.io/secure-client-side-storage-data-using-with-web-crypto-react-js-typescript-f43944fad7b3?source=collection_archive---------4-----------------------#2022-09-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="8e88" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用React和TypeScript web应用程序中的Web Crypto保护客户端存储数据的指南。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/41f9b53353df20e6d404f9d54c6bd8f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kcDNUujyBS1YrT4df5hUHA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Secure Client-Side Storage</figcaption></figure><h1 id="9200" class="ks kt in bd ku kv kw kx ky kz la lb lc jt ld ju le jw lf jx lg jz lh ka li lj bi translated">介绍</h1><p id="351c" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls lt lu lv lw lx ly lz ma mb mc md me mf ig bi translated">我正在处理一个需求，客户希望我创建一个可以长时间脱机工作的web应用程序。所以在本地存储/会话存储中存储这些敏感数据会让我的客户端面临风险，所以我决定使用Web Crypto API。众所周知，浏览器存储多少才算安全？当然，在本地存储中存储数据有优点也有缺点，但是满足客户机的要求是很重要的。</p><p id="08d2" class="pw-post-body-paragraph lk ll in lm b ln mg jo lp lq mh jr ls lt mi lv lw lx mj lz ma mb mk md me mf ig bi translated">如果您正在寻找客户端存储的介绍，请参见下面的文章。</p><div class="ml mm gp gr mn mo"><a rel="noopener  ugc nofollow" target="_blank" href="/introduction-to-client-side-storage-31b103909fb9"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd io gy z fp mt fr fs mu fu fw im bi translated">面向初学者的客户端存储介绍</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">什么是客户端存储？客户端存储允许用户在客户端存储数据，并在需要时检索数据</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="mx l"><div class="my l mz na nb mx nc km mo"/></div></div></a></div><h2 id="7865" class="nd kt in bd ku ne nf dn ky ng nh dp lc lt ni nj le lx nk nl lg mb nm nn li no bi translated">什么是Web加密API？</h2><p id="6239" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls lt lu lv lw lx ly lz ma mb mc md me mf ig bi translated">该规范概述了一个JavaScript API，用于在web应用程序中执行基本的加密操作，如散列、签名生成、验证、加密和解密。</p><p id="8944" class="pw-post-body-paragraph lk ll in lm b ln mg jo lp lq mh jr ls lt mi lv lw lx mj lz ma mb mk md me mf ig bi translated">它还描述了应用程序生成和/或管理执行这些操作所需的密钥数据的API。</p><p id="e265" class="pw-post-body-paragraph lk ll in lm b ln mg jo lp lq mh jr ls lt mi lv lw lx mj lz ma mb mk md me mf ig bi translated"><a class="ae np" href="https://www.w3.org/TR/WebCryptoAPI/" rel="noopener ugc nofollow" target="_blank">这个API </a>可以用于各种目的，包括用户或服务认证、文档或代码签名，以及通信的机密性和完整性。</p><h2 id="a046" class="nd kt in bd ku ne nf dn ky ng nh dp lc lt ni nj le lx nk nl lg mb nm nn li no bi translated"><strong class="ak">这个实现将如何工作？</strong></h2><p id="8a70" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls lt lu lv lw lx ly lz ma mb mc md me mf ig bi translated">请参见附图，了解我们实现该功能的计划方法的可视化表示，并查看我已经编写的代码，请访问下面的GitHub库。</p><div class="ml mm gp gr mn mo"><a href="https://github.com/santoshshinde2012/react-redux-typescript-boilerplate" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd io gy z fp mt fr fs mu fu fw im bi translated">GitHub-Santosh shinde 2012/React-Redux-typescript-boilerplate:React &amp; Redux应用程序的框架…</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">用TypeScript编写的React &amp; Redux应用程序的框架(集成了SASS、ESLint、Prettier和Husky) - GitHub …</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">github.com</p></div></div><div class="mx l"><div class="nq l mz na nb mx nc km mo"/></div></div></a></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nr"><img src="../Images/37b11ef02e64fc6d9f9199d258170c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*20p69P9lC5l1vM0t2Zo16w.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Secure Client-Side Storage Workflow</figcaption></figure><h2 id="6c12" class="nd kt in bd ku ne nf dn ky ng nh dp lc lt ni nj le lx nk nl lg mb nm nn li no bi translated">加密步骤</h2><blockquote class="ns nt nu"><p id="9b23" class="lk ll nv lm b ln mg jo lp lq mh jr ls nw mi lv lw nx mj lz ma ny mk md me mf ig bi translated"><a class="ae np" href="https://www.cloudflare.com/learning/ssl/what-is-encryption/" rel="noopener ugc nofollow" target="_blank">什么是加密？</a> <br/>加密是一种扰乱数据的方式，只有授权方才能理解信息。</p></blockquote><ol class=""><li id="057d" class="nz oa in lm b ln mg lq mh lt ob lx oc mb od mf oe of og oh bi translated">创造静脉注射和盐</li><li id="c403" class="nz oa in lm b ln oi lq oj lt ok lx ol mb om mf oe of og oh bi translated">使用PBKDF2创建基于密码的密钥</li><li id="ce6d" class="nz oa in lm b ln oi lq oj lt ok lx ol mb om mf oe of og oh bi translated">使用PBKDF2密钥和随机salt值创建AES-GCM密钥</li><li id="2d04" class="nz oa in lm b ln oi lq oj lt ok lx ol mb om mf oe of og oh bi translated">使用AES-GCM密钥和随机初始化向量(iv)加密输入数据。</li><li id="f039" class="nz oa in lm b ln oi lq oj lt ok lx ol mb om mf oe of og oh bi translated">将加密字符串转换为缓冲区</li><li id="8262" class="nz oa in lm b ln oi lq oj lt ok lx ol mb om mf oe of og oh bi translated">将随机salt、随机化初始化向量(iv)和加密的字符串缓冲区连接起来</li><li id="037d" class="nz oa in lm b ln oi lq oj lt ok lx ol mb om mf oe of og oh bi translated">对合并的缓冲区进行编码</li></ol><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi on"><img src="../Images/084de7071e19ceea24881c623a5db6c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Un9iMyc_jrFS00nTkMtvpg.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Steps To Encrypt</figcaption></figure><h2 id="f496" class="nd kt in bd ku ne nf dn ky ng nh dp lc lt ni nj le lx nk nl lg mb nm nn li no bi translated">解密的步骤</h2><blockquote class="ns nt nu"><p id="0433" class="lk ll nv lm b ln mg jo lp lq mh jr ls nw mi lv lw nx mj lz ma ny mk md me mf ig bi translated">什么是解密？加密是一种扰乱数据的方法，只有被允许的人才能理解它。</p></blockquote><ol class=""><li id="aa12" class="nz oa in lm b ln mg lq mh lt ob lx oc mb od mf oe of og oh bi translated">将输入密文转换到缓冲区</li><li id="755d" class="nz oa in lm b ln oi lq oj lt ok lx ol mb om mf oe of og oh bi translated">从转换后的密文缓冲区中提取IV、salt和加密的缓冲区</li><li id="11ca" class="nz oa in lm b ln oi lq oj lt ok lx ol mb om mf oe of og oh bi translated">使用PBKDF2创建基于密码的密钥</li><li id="fac4" class="nz oa in lm b ln oi lq oj lt ok lx ol mb om mf oe of og oh bi translated">使用PBKDF2密钥和随机salt值创建AES-GCM密钥</li><li id="1d50" class="nz oa in lm b ln oi lq oj lt ok lx ol mb om mf oe of og oh bi translated">使用AES-GCM密钥和ArrayBuffer中的iv对输入数据进行解密。</li><li id="d262" class="nz oa in lm b ln oi lq oj lt ok lx ol mb om mf oe of og oh bi translated">使用文本解码器解码解密的响应</li></ol><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi on"><img src="../Images/e8f4c176d5f9fbd3c4187e7fc4d59639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*triVQA8dDHX5KhjysEiNiw.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Steps To Decrypt</figcaption></figure><h2 id="9027" class="nd kt in bd ku ne nf dn ky ng nh dp lc lt ni nj le lx nk nl lg mb nm nn li no bi translated">实时场景</h2><p id="6d11" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls lt lu lv lw lx ly lz ma mb mc md me mf ig bi translated">如果您浏览我们的<a class="ae np" href="https://github.com/santoshshinde2012/react-redux-typescript-boilerplate" rel="noopener ugc nofollow" target="_blank">样板库</a>，您会看到我们有多种环境处理能力，允许我们在适当的环境文件中包含基于环境的配置。</p><p id="de48" class="pw-post-body-paragraph lk ll in lm b ln mg jo lp lq mh jr ls lt mi lv lw lx mj lz ma mb mk md me mf ig bi translated">对我们来说，我们需要下面的变量在我们的<code class="fe oo op oq or b"><a class="ae np" href="https://www.npmjs.com/package/braintree" rel="noopener ugc nofollow" target="_blank">.</a>env </code>文件中</p><ul class=""><li id="9053" class="nz oa in lm b ln mg lq mh lt ob lx oc mb od mf os of og oh bi translated"><code class="fe oo op oq or b">REACT_APP_IS_OFFLINE</code> —我们可以用这个来决定是否需要使用离线存储。</li><li id="4216" class="nz oa in lm b ln oi lq oj lt ok lx ol mb om mf os of og oh bi translated"><code class="fe oo op oq or b">REACT_APP_APPLY_ENCRYPTION</code> —我们可以用这个来决定我们是否需要应用加密。</li><li id="544c" class="nz oa in lm b ln oi lq oj lt ok lx ol mb om mf os of og oh bi translated"><code class="fe oo op oq or b">REACT_APP_APPLY_SECRETE_KEY</code> —考虑加密和解密时，需要一个秘密密钥来生成基于密码的密钥派生密钥(PBKDF2)。</li></ul><p id="8205" class="pw-post-body-paragraph lk ll in lm b ln mg jo lp lq mh jr ls lt mi lv lw lx mj lz ma mb mk md me mf ig bi translated"><strong class="lm io">场景1 </strong></p><p id="f239" class="pw-post-body-paragraph lk ll in lm b ln mg jo lp lq mh jr ls lt mi lv lw lx mj lz ma mb mk md me mf ig bi translated">让我们假设我们不想使用加密，但仍然希望将数据存储在本地。在这种情况下，数据将以键和值的格式存储，值以纯文本格式存储。</p><p id="56a5" class="pw-post-body-paragraph lk ll in lm b ln mg jo lp lq mh jr ls lt mi lv lw lx mj lz ma mb mk md me mf ig bi translated">你可以在下图中清楚地看到这个场景，它可能会使我们的web应用程序变得脆弱。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ot"><img src="../Images/d8ff6aa68b84034baa4a025ea03d268d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HylaAewWvZfID24ph4MMSg.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk"><strong class="bd ou">Scenario 1</strong></figcaption></figure><p id="eabf" class="pw-post-body-paragraph lk ll in lm b ln mg jo lp lq mh jr ls lt mi lv lw lx mj lz ma mb mk md me mf ig bi translated"><strong class="lm io">场景2 </strong></p><p id="cfb5" class="pw-post-body-paragraph lk ll in lm b ln mg jo lp lq mh jr ls lt mi lv lw lx mj lz ma mb mk md me mf ig bi translated">为了避免上述情况，让我们假设我们将使用web crypto来加密和解密数据。这将使我们能够以密钥和值的格式存储数据，并以加密的格式存储值。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ov"><img src="../Images/2aa797bd799ead8690a597311a93276b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p57EYKmD8078MLbjT50Jlw.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk"><strong class="bd ou">Scenario 2</strong></figcaption></figure><h2 id="5c07" class="nd kt in bd ku ne nf dn ky ng nh dp lc lt ni nj le lx nk nl lg mb nm nn li no bi translated">源代码</h2><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ow ox l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Source Code</figcaption></figure><p id="7d52" class="pw-post-body-paragraph lk ll in lm b ln mg jo lp lq mh jr ls lt mi lv lw lx mj lz ma mb mk md me mf ig bi translated">感谢阅读，请分享你的评论，如果这个博客增加了你的学习价值，请鼓掌。</p><p id="bbc9" class="pw-post-body-paragraph lk ll in lm b ln mg jo lp lq mh jr ls lt mi lv lw lx mj lz ma mb mk md me mf ig bi translated"><em class="nv">关注我上</em><a class="ae np" href="https://twitter.com/shindesan2012" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="nv">Twitter</em></strong></a><em class="nv">和</em><a class="ae np" href="https://www.linkedin.com/in/shindesantosh/" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="nv">LinkedIn</em></strong></a><em class="nv">。</em></p></div><div class="ab cl oy oz hr pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="ig ih ii ij ik"><p id="b2a1" class="pw-post-body-paragraph lk ll in lm b ln mg jo lp lq mh jr ls lt mi lv lw lx mj lz ma mb mk md me mf ig bi translated"><em class="nv">更多内容请看</em><a class="ae np" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="nv">plain English . io</em></strong></a><em class="nv">。报名参加我们的</em> <a class="ae np" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lm io"> <em class="nv">免费周报</em> </strong> </a> <em class="nv">。关注我们关于</em><a class="ae np" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="nv">Twitter</em></strong></a><a class="ae np" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="nv">LinkedIn</em></strong></a><em class="nv"/><a class="ae np" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="nv">YouTube</em></strong></a><em class="nv"/><a class="ae np" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="nv">不和</em> </strong> </a> <em class="nv">。对增长黑客感兴趣？检查</em> <a class="ae np" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="lm io"> <em class="nv">电路</em> </strong> </a> <em class="nv">。</em></p></div></div>    
</body>
</html>