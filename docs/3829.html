<html>
<head>
<title>Set Up Scheduled Events (aka CRON Jobs) with Lolo to Send Yourself Updates on Slack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Lolo设置预定事件(又名CRON Jobs ),向自己发送空闲时间的更新</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/set-up-scheduled-events-aka-cron-jobs-with-serverless-to-send-yourself-weather-updates-to-slack-11f54b4ef12e?source=collection_archive---------13-----------------------#2022-09-29">https://javascript.plainenglish.io/set-up-scheduled-events-aka-cron-jobs-with-serverless-to-send-yourself-weather-updates-to-slack-11f54b4ef12e?source=collection_archive---------13-----------------------#2022-09-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="9927" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">…每天早上8点，CEST使用松弛的网钩。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/ced78d975300b419f82f6e16da054feb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YBgBKzutn_BmtzWU"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@hostreviews?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Stephen Phillips - Hostreviews.co.uk</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="11ad" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在本指南中，我们将演示如何通过使用任务调度器<a class="ae ks" href="https://www.npmjs.com/package/node-cron" rel="noopener ugc nofollow" target="_blank"> node-cron </a>来生成您自己的无服务器事件，该任务调度器将在每天早上运行，并将本地天气作为私有消息发送给您Slack。</p><p id="99d3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">虽然，我们可以为这个创建一个库函数，这将允许你学习如何自己产生事件。</p><p id="11dc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">见下面这个演示的Lolo图。节点中有自定义的Node.js代码，但是通过使用几个节点，我们可以更好地可视化它在做什么。我们的事件是触发Get Weather节点的CRON作业，Get Weather节点又触发Slack消息节点。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ca"><img src="../Images/0a76c61abed5ea4a135c4b5005f50a62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WYQOFY925seQ27InutIRfQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Our Lolo workflow. All of the nodes are custom Node.js code and we’re routing data from one node to the other when the event happens.</figcaption></figure><p id="5bff" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">赞美诗您需要对Slack工作区的管理员访问权限来设置您的Slack应用程序。关于如何设置Slack应用程序的更多信息，请参阅本文后面的内容。</p><h1 id="2617" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">创建自定义触发器</h1><p id="402c" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">在<a class="ae ks" href="https://developer.lolo.company/" rel="noopener ugc nofollow" target="_blank"> Lolo </a>中创建一个新的应用程序。如果你没有账户，<a class="ae ks" href="https://developer.lolo.company/" rel="noopener ugc nofollow" target="_blank">注册</a>，这很简单。</p><p id="67f2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您可以访问图形左上角的库函数(即预构建的触发器和函数),但这里我们将创建一个自定义触发器，因此在图形右下角添加一个新函数。您可以重命名它，并删除输入端口。这将是一个触发器，因此不会有任何数据流入其中。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mm"><img src="../Images/7077844a6d077bad487acf88076b90ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*iUjljYKwydAbfFVdJSSrYg.gif"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Create a new function in the bottom right corner of the graph, double click it to configure it. Remove the input port and rename it.</figcaption></figure><p id="c860" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们需要为此编写一些代码，所以请继续，看看下面的代码。这是使用<a class="ae ks" href="https://www.npmjs.com/package/node-cron" rel="noopener ugc nofollow" target="_blank"> node-cron </a>按时间表创建事件。我们的cron时间表设置为每一分钟，但是一旦您完成了对事件的测试，您可能想要更改它。复制这段代码并将其插入其处理程序。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="9354" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这段代码根据我们的CRON时间表设置事件并运行它们，这个时间表是为每一分钟设置的。为了解释为什么我们在“恢复”和“暂停”中使用引擎生命周期事件，我们需要确保在引擎请求时停止任务。否则，结果可能是更慢的重新部署时间，因为K8s需要在超时后强制杀死pod。这不是必须的，但这是很好的练习。然后，我们通过exports.handler将事件路由到下一个节点。</p><p id="31c9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">记得将<a class="ae ks" href="https://www.npmjs.com/package/node-cron" rel="noopener ugc nofollow" target="_blank"> node-cron </a>添加到Lolo应用中的<strong class="kv io">模块</strong>中，这样它就会被安装。转到应用程序的<strong class="kv io">设置</strong>，然后导航到<strong class="kv io">模块。</strong></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mm"><img src="../Images/0c06efbe44813c7723943aa1bc7d1d70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mUo_D9rhc7-6z9SaB-GvYw.gif"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">How to add dependencies to your Lolo App. Simply add them via your Modules and have them installed for you when you Save and Run your Lolo app.</figcaption></figure><h1 id="4596" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">测试事件</h1><p id="523b" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">既然我们已经设置了事件节点，我们需要确保对它做一些事情。</p><p id="daa5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">再次在图形的右下角创建一个<strong class="kv io">新函数</strong>。我们将通过在日志中记录一些东西来测试事件(例如，你的Lolo控制台)。为此，将下面的代码添加到新函数的处理程序中。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="fcfe" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了在节点之间路由数据，我们将它们连接起来。当事件发生时，它将触发另一个节点/函数中的export.handler内的代码(如果它们是连接的)。你也可以<strong class="kv io">保存</strong>和<strong class="kv io">运行</strong>应用程序。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mm"><img src="../Images/f4c56645303b482f33b897831fd355ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*VRDNgjWzMuHLTBPKGzb9tw.gif"/></div></div></figure><p id="93ac" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">添加依赖项可能会降低部署时间，因此这可能需要一分钟。如果成功，您将在日志中看到确认信息，其中<strong class="kv io">监听端口4000 </strong>。等着看这个吧。</p><p id="94c1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">部署控制台后，需要一分钟才能开始看到记录到控制台的事件，因为我们已经为每分钟设置了cron时间表。所以继续查看你的日志，直到你看到这个。一旦你看到它们慢慢流入，如果你不想每分钟都有连续的“事件发生”日志流，你可以停止应用程序。</p><p id="378b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">至此，您已经学会了如何在Lolo中创建自己的事件触发器。如果您希望在事件发生时看到天气数据消息，请继续。</p><h1 id="7a82" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">添加天气数据</h1><p id="97a3" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">我们将获取斯德哥尔摩的当前天气数据，然后将其添加到event对象中，这样我们就可以在另一个节点中使用这些信息。</p><p id="326c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，你需要一个来自<strong class="kv io"> Open Weather </strong>的API密匙，只需<a class="ae ks" href="https://home.openweathermap.org/users/sign_up" rel="noopener ugc nofollow" target="_blank">注册</a>就能轻松获得。我已经将它添加到应用程序设置中的<strong class="kv io">变量</strong>中。把你的<strong class="kv io">变量</strong>想象成你的。环境文件。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mm"><img src="../Images/6a2f70bf49885c02eb46b98111b02fd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*_GIrrhboEy9xs8J50wpClw.gif"/></div></div></figure><p id="caea" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">打开您创建的新函数来测试事件，并将其重命名为获取天气数据。保留输入端口和输出端口。但是从下面的代码片段中完全修改其处理程序中的代码。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="df68" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您想要另一个城市的天气数据，请获取这些坐标，并将其交换为您在此代码中看到的坐标。这些坐标会给你斯德哥尔摩的天气数据。</p><p id="b123" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">至于解释代码做什么，我们通过发出GET请求从开放天气API获取json对象。然后我们将天气数组和主对象添加到我们的<strong class="kv io">事件(ev)对象中。</strong>这允许我们访问另一个节点中的数据，因为我们通过route()将该对象重新路由到下一个函数，方法是将其设置为<strong class="kv io"> route(ev)。</strong></p><p id="ef4d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">记住，你还需要像使用node-cron一样，将</strong><a class="ae ks" href="https://www.npmjs.com/package/node-fetch" rel="noopener ugc nofollow" target="_blank"><strong class="kv io">node-fetch @ 2.0</strong></a><strong class="kv io">添加到应用程序设置中的模块中。</strong>我们在这段代码中使用了旧版本的节点获取，因此使用了@2.0。</p><p id="cc1a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了测试这是否有效，创建另一个第三函数，然后做同样的事情，将事件从另一个节点记录到控制台。这将记录你从API获得的天气数据。请记住保存并再次部署，以便在日志中查看您的事件。</p><h1 id="57b8" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">向时差发送消息</h1><p id="5755" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">这最后一部分，每当事件发生时，您将向您的时差发送一条消息。</p><p id="9810" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要做到这一点，你必须在Slack中创建一个新的应用程序，启用Webhooks，然后在你希望显示消息的地方添加一个新的Webhook。您可以决定将其添加到频道或作为私人消息。我已经将Slack应用程序集成到我自己的私人消息中。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mm"><img src="../Images/ba594fa30f62df1285c4430c23220da7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*N9NkBp35_F6-inKD7GCsbw.gif"/></div></div></figure><p id="e394" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">完成后，复制Webhook URL，因为我们将使用它。</p><p id="3d83" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">回到你的Lolo应用程序，然后打开你的第三个函数，将代码交换到它的处理程序中。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="5ef5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们只是在这里用node-fetch发送一个POST请求。主体是用<a class="ae ks" href="https://app.slack.com/block-kit-builder" rel="noopener ugc nofollow" target="_blank"> Slack Block Kit Builder </a>构建的，我们使用的是Slack提供给我们的Webhook URL。</p><p id="3cea" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您也可以将该功能重命名为<strong class="kv io"> Slack Message </strong>并移除输出。我们的工作流将在这里结束，因此我们不再进一步重新路由事件数据。</p><p id="45e7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">完成后，您可以返回图表。<strong class="kv io">保存</strong>并<strong class="kv io">运行</strong>您的应用程序。你可能也要在这里等一会儿。回到你的空闲时间，然后等待你的消息开始出现。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mm"><img src="../Images/bd4106c9659a9cc8a88e626a1774bbf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*4Vdtm5pjO1_HN6fQ8xnoxw.gif"/></div></div></figure><p id="22a0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请记住停止应用程序，然后将cron计划重置为特定时间，这样您就不会在空闲时每分钟都收到一条消息。我把它设置为“0 6 * * *”，我想是斯德哥尔摩时间早上8点。</p><h1 id="c04e" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">Youtube视频教程</h1><p id="eeb7" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">如果你想看完整的教程，查看下面的视频。我也为这个加入了<a class="ae ks" href="https://www.npmjs.com/package/inspirational-quotes" rel="noopener ugc nofollow" target="_blank">励志名言</a>来增加趣味。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mp mo l"/></div></figure><p id="4d21" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">祝你好运！在这里可以看到用户在Lolo <a class="ae ks" href="https://www.youtube.com/playlist?list=PLhy3hWyiPUE_au4-z_WKV5NOiWbIqCVYv" rel="noopener ugc nofollow" target="_blank">中内置的其他东西。</a></p><p id="6c65" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">❤️·洛洛</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="4c17" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="mq">更多内容请看</em><a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mq">plain English . io</em></strong></a><em class="mq">。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="mq">免费周报</em> </strong> </a> <em class="mq">。关注我们关于</em><a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mq">Twitter</em></strong></a><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mq">LinkedIn</em></strong></a><strong class="kv io"><em class="mq"/></strong><a class="ae ks" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mq">YouTube</em></strong></a><strong class="kv io"><em class="mq">，以及</em></strong><em class="mq"/><a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mq">不和</em> </strong> </a>  <em class="mq">对成长黑客感兴趣？检查</em> <a class="ae ks" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="mq">电路</em> </strong> </a> <strong class="kv io"> <em class="mq">。</em> </strong></p></div></div>    
</body>
</html>