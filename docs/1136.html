<html>
<head>
<title>DangerouslySetInnerHTML in React JS Explained</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解释了反应中的危险</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/dangerouslysetinnerhtml-in-react-js-explained-4dfc3b80be82?source=collection_archive---------0-----------------------#2022-03-05">https://javascript.plainenglish.io/dangerouslysetinnerhtml-in-react-js-explained-4dfc3b80be82?source=collection_archive---------0-----------------------#2022-03-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/a0484e504310e92aa5ce2843e9b32bd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E_YRBNWSokQyFnITNtJiYg.png"/></div></div></figure><p id="b774" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> dangerouslySetInnerHTML </strong>是React中DOM元素下的一个属性。<br/>根据<a class="ae kt" href="https://reactjs.org/docs/dom-elements.html#dangerouslysetinnerhtml" rel="noopener ugc nofollow" target="_blank">官方文档</a>，dangerouslySetInnerHTML是React的替代品，用于在浏览器DOM中使用InnerHTML以编程方式或从外部源设置HTML。</p><h1 id="f370" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">语法和需要使用dangerouslySetInnerHTML</h1><p id="16bc" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">在简单的普通JS中，我们使用innerHTML属性将HTML插入网页，如下所示。</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="f4f0" class="mg kv in mc b gy mh mi l mj mk">&lt;div innerHTML=&lt;p&gt;A sample paragraph&lt;/p&gt;&lt;/div&gt;</span><span id="7be7" class="mg kv in mc b gy ml mi l mj mk">or</span><span id="b64a" class="mg kv in mc b gy ml mi l mj mk">document.querySelector(".testClass")= '&lt;p&gt;A sample paragraph&lt;/p&gt;';</span></pre><p id="4669" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是如果我们试图在React中做同样的事情。我们将得到如下所示的错误:</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/48462a7824866e2d7403919dea83aee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*-mlSCRamu7N6Q6pHcACevA.png"/></div></figure><p id="2c87" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用dangerouslySetInnerHTML的语法非常简单。代替innerHTML，你必须键入dangerouslySetInnerHTML并传递一个带有__html键的对象。例如:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="4be7" class="mg kv in mc b gy mh mi l mj mk">&lt;div dangerouslySetInnerHTML={{__html: '&lt;p&gt;lorem ipsum&lt;/p&gt;'}}&gt;&lt;/div&gt;</span></pre><p id="2b61" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是为什么叫<strong class="jx io"><em class="mn">dangerouslysettinnerhtml呢？</em> </strong>那是因为<strong class="jx io"> <em class="mn"> </em> </strong>这个属性是<strong class="jx io">危险的</strong>，一不小心就可能在你的应用中制造XSS漏洞。我们简单了解一下。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/2b58902872fc8253722a28fd2da41661.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/1*k59fb9I0L99NxuYo46Ezpw.gif"/></div></figure><h1 id="b9da" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">为什么叫dangerouslySetInnerHTML？</h1><p id="2b2c" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">名字<strong class="jx io"><em class="mn">dangerouslySetInnerHTML</em></strong>是故意选来吓人的。这不是命名错误。</p><p id="0f89" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一般来说，从代码中设置HTML是有风险的，因为它可能会将你的用户暴露给一个<a class="ae kt" href="https://en.wikipedia.org/wiki/Cross-site_scripting" rel="noopener ugc nofollow" target="_blank">跨站脚本(XSS) </a>攻击。你可以直接从React设置HTML，但是你必须键入<code class="fe mp mq mr mc b">dangerouslySetInnerHTML</code>并传递一个带有<code class="fe mp mq mr mc b">__html</code>键的对象，以提醒你自己这是危险的。</p><p id="0e44" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你允许用户直接在你的网页中插入HTML，他们可以在技术上嵌入脚本和恶意代码，当你在react应用程序中显示HTML时，这些脚本可能会执行。下面是一个例子。</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="fd5c" class="mg kv in mc b gy mh mi l mj mk">import React from "react";<br/>import './App.css';</span><span id="d25e" class="mg kv in mc b gy ml mi l mj mk">const App = () =&gt; {</span><span id="e40c" class="mg kv in mc b gy ml mi l mj mk">const data = `<br/>  &lt;h3&gt;Welcome to this page&lt;/h3&gt;<br/>  &lt;p&gt;May the code be with you&lt;/p&gt;<br/>  &lt;img src=??? onerror="alert('XSS')" /&gt;<br/>  `;</span><span id="e5ff" class="mg kv in mc b gy ml mi l mj mk">return (<br/>    &lt;div className="App"&gt;<br/>      &lt;h2&gt;Understanding dangerouslySetInnerHTML&lt;/h2&gt;<br/>      &lt;div<br/>        style={{ padding: "10px", fontSize: '17px', textAlign: 'center' }}<br/>        dangerouslySetInnerHTML={{ __html: data }}<br/>      &gt;&lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="d59a" class="mg kv in mc b gy ml mi l mj mk">export default App;</span></pre><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ms"><img src="../Images/35e028d124762007735ab1118dfafd26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yNoSkhmebLAWWYiR0pYkaQ.png"/></div></div></figure><p id="433d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这就是为什么你需要确保你的HTML在插入到你的react应用之前已经被清理了。您可以使用像<a class="ae kt" href="https://www.npmjs.com/package/dompurify" rel="noopener ugc nofollow" target="_blank"> dompurify </a>这样的库来实现。</p><p id="3353" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如何使用dompurify净化您的代码的例子如下所示:</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="5a21" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">表演</h1><p id="9650" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">当你使用dangerouslySetInnerHTML时，在幕后，我们知道组件内部的HTML不是它关心的东西，因为它来自另一个来源。</p><p id="bed7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因为React使用虚拟DOM，所以当它与真实DOM进行比较时，它可以简单地跳过与虚拟DOM的比较，以获得一些额外的性能。</p><p id="4aa2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果只是使用innerHTML，React无法知道DOM节点已经被修改。</p><h1 id="6a93" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h1><p id="7430" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">总之，<code class="fe mp mq mr mc b">dangerouslySetInnerHTML</code>不过是React中<code class="fe mp mq mr mc b">innerHTML</code>的替代品，应该小心使用。名称<strong class="jx io"><em class="mn">dangerouslySetInnerHTML</em></strong>是有意选择的，以提醒你这是危险的，可能会导致XSS漏洞，以便你确保在将HTML插入react应用程序之前对其进行清理。</p><h1 id="c751" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">视频解释:</h1><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="mv mu l"/></div></figure><p id="0bcf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mn">更多内容看</em> <a class="ae kt" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="mn">说白了就是io </em> </strong> </a> <em class="mn">。报名参加我们的</em> <a class="ae kt" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="mn">免费周报</em> </strong> </a> <em class="mn">。关注我们关于</em><a class="ae kt" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="mn">Twitter</em></strong></a><em class="mn">和</em><a class="ae kt" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="mn">LinkedIn</em></strong></a><em class="mn">。加入我们的</em> <a class="ae kt" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="mn">社区</em> </strong> </a> <em class="mn">。</em></p></div></div>    
</body>
</html>