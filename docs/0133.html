<html>
<head>
<title>Testing MongoDB integration in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Node.js中测试MongoDB集成</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-test-with-mongodb-with-node-js-b05f94aa17a?source=collection_archive---------5-----------------------#2022-01-09">https://javascript.plainenglish.io/how-to-test-with-mongodb-with-node-js-b05f94aa17a?source=collection_archive---------5-----------------------#2022-01-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="3bb7" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何在真实的MongoDB实例中测试代码的简单分步指南。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/a8b14f0f1c743645cc2e3dcfa29129b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JXrTcNFeYo7mKVDu"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@clark_fransa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Arnold Francisca</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="45ca" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">MongoDB通常与Node.js一起用于数据存储，像MERN或MEAN这样的堆栈也广泛用于创建web应用程序。记住这一点，知道如何用MongoDB测试您的代码对于确保正确的行为和良好的软件质量非常重要。在这里，我将展示如何使用项目中包含的真实MongoDB数据库来测试您的代码。</p><p id="7776" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这种情况下，我们将使用的工具和库是node v16、<a class="ae ks" href="https://github.com/nodkz/mongodb-memory-server" rel="noopener ugc nofollow" target="_blank"> mongodb-memory-server </a>和<a class="ae ks" href="https://jestjs.io/es-ES/" rel="noopener ugc nofollow" target="_blank"> Jest </a>。</p><p id="7754" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这个案例的关键是<a class="ae ks" href="https://github.com/nodkz/mongodb-memory-server" rel="noopener ugc nofollow" target="_blank"> mongodb-memory-server </a>。它允许我们选择一个MongoDB版本在我们的测试环境中运行。最好的一点是，我们可以确保用我们在生产环境中运行的相同版本来测试我们的代码。让我们看看这有多简单。</p><p id="9c82" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们首先需要知道的是，我们有三个选项来选择我们想要运行的版本:由环境变量设置的版本，在我们使用参数启动服务器时设置版本，或者让模块下载默认版本(编写时为<code class="fe lp lq lr ls b">5.03</code>)。在这个例子中，我们将选择在初始化时设置版本的那个(下面你会看到一个这样的例子)。</p><p id="ae15" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们添加所需的依赖项:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lt"><img src="../Images/e4794f94c1b78b157b15cd86b4bef92f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v3WAkh4K5IEuHadffmSnKw.png"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lu"><img src="../Images/8198f3a8bfad0abddce66f7cf8d90932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-HORZZY0W9ezKtmV9y9Fgw.png"/></div></div></figure><p id="5613" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在，让我们在<code class="fe lp lq lr ls b">package.json</code>文件中添加一个基本的jest配置:</p><pre class="kd ke kf kg gt lv ls lw lx aw ly bi"><span id="9b1f" class="lz ma in ls b gy mb mc l md me">"jest": {<br/>    "bail": true,<br/>    "testEnvironment": "&lt;rootDir&gt;/test/mongo-test-environment"<br/>    "coverageReporters": [<br/>      "json",<br/>      "text-summary",<br/>      "lcov",<br/>      "clover"<br/>    ],<br/>    "collectCoverage": true,<br/>    "collectCoverageFrom": [<br/>      "src/**"<br/>    ],<br/>    "coveragePathIgnorePatterns": [<br/>      "test/*"<br/>    ],<br/>    "testRunner": "jest-circus/runner"<br/>  }</span></pre><p id="8a70" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了启动数据库，我们将使用Jest功能，该功能允许我们在开始运行测试用例之前运行代码(<code class="fe lp lq lr ls b">"testEnvironment": "&lt;rootDir&gt;/test/mongo-test-environment"</code>)。下面是该文件的内容:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mf"><img src="../Images/0c845781fea6425adafba8594a245962.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kwU4VUsgacfez7MmfcQVbw.png"/></div></div></figure><p id="0500" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">它使用一个助手文件来创建MongoDB实例，并且还将在测试用例中用来连接和断开数据库。代码如下:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mg"><img src="../Images/87292b6febc35ef7efcbf53bfd762154.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nessxaQWs9f--1XrvfewiA.png"/></div></div></figure><p id="32c6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这只是做这件事的一种方法，还有几种方法可以做到这一点。请注意，我已经指定了我想要的MongoDB版本(4.2.0)，<a class="ae ks" href="https://github.com/nodkz/mongodb-memory-server#available-options-for-mongomemoryserver" rel="noopener ugc nofollow" target="_blank">这里</a>您可以看到所有可以用来初始化MongoDB实例的选项。</p><p id="1990" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在，当我们开始运行我们的测试用例时，一个内存中的MongoDB实例将会运行，我们可以连接、插入、查找、删除等等。在我们的每一个测试案例中。让我们看一个示例测试文件:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mh"><img src="../Images/a3bf79a1a600d8a5cf364f17ea35de95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*turiQC6BAf4ALH9EiBPKBA.png"/></div></div></figure><p id="8487" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这很简单，只需在运行任何测试用例之前连接，并确保在所有测试用例结束时断开连接。我还喜欢删除测试用例中创建的任何数据(我在“saveUser”测试用例的<code class="fe lp lq lr ls b">afterAll</code>方法中这样做。</p><p id="64b6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">通过这些简单的步骤，我们可以在一个真实的MongoDB实例中测试我们的代码。我希望这能帮助你提高代码的质量。<a class="ae ks" href="https://github.com/amcereijo/mongo-testing-demo" rel="noopener ugc nofollow" target="_blank">这里</a>你可以看到这个例子的完整代码。</p><p id="5e4b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="mi">更多内容看</em> <a class="ae ks" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="mi">说白了。报名参加我们的</em> </a><a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="mi">免费每周简讯</em> </a> <em class="mi">。在我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <em class="mi">社区</em> </a> <em class="mi">获得独家写作机会和建议。</em></p></div></div>    
</body>
</html>