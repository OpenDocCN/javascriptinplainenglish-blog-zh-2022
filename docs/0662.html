<html>
<head>
<title>Build a Simple Countdown Timer with React and Recoil</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建立一个简单的反应和反冲倒计时定时器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-a-simple-countdown-timer-with-react-and-recoil-de513a09515a?source=collection_archive---------6-----------------------#2022-02-05">https://javascript.plainenglish.io/build-a-simple-countdown-timer-with-react-and-recoil-de513a09515a?source=collection_archive---------6-----------------------#2022-02-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="4ea7" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">跨React组件共享反冲应用状态的概念验证</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/81b4e51004649a3a3be972cf24104e73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZrCHhE_LxwOyL9f2bZMK9Q.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">(author)</figcaption></figure></div><div class="ab cl ks kt hr ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ig ih ii ij ik"><h1 id="dd04" class="kz la in bd lb lc ld le lf lg lh li lj jt lk ju ll jw lm jx ln jz lo ka lp lq bi translated"><strong class="ak">背景</strong></h1><p id="67f1" class="pw-post-body-paragraph lr ls in lt b lu lv jo lw lx ly jr lz ma mb mc md me mf mg mh mi mj mk ml mm ig bi translated"><a class="ae mn" href="https://recoiljs.org/" rel="noopener ugc nofollow" target="_blank">反冲</a>为前端开发者提供了一个快速学习、易于实现的应用状态管理API。</p><p id="c774" class="pw-post-body-paragraph lr ls in lt b lu mo jo lw lx mp jr lz ma mq mc md me mr mg mh mi ms mk ml mm ig bi translated">关于是否选择这个库而不是其他库作为应用程序状态管理解决方案，已经有了很多写得很好的讨论，但是很难否认设置和使用反冲在不同的React组件之间共享状态的简单性。</p><p id="7d47" class="pw-post-body-paragraph lr ls in lt b lu mo jo lw lx mp jr lz ma mq mc md me mr mg mh mi ms mk ml mm ig bi translated">作为<a class="ae mn" href="https://network.demandstar.com/" rel="noopener ugc nofollow" target="_blank"> DemandStar </a>工程团队的一员，我在过去的一年里一直在使用反冲，并且已经看到了我们的代码库在可维护性、可测试性和功能开发的整体速度方面的实质性好处。</p><p id="737d" class="pw-post-body-paragraph lr ls in lt b lu mo jo lw lx mp jr lz ma mq mc md me mr mg mh mi ms mk ml mm ig bi translated">在本帖中，我们将通过…展示使用反冲的简易性和有效性</p><ul class=""><li id="5857" class="mt mu in lt b lu mo lx mp ma mv me mw mi mx mm my mz na nb bi translated">构建一个基本的React倒计时定时器组件</li><li id="74b8" class="mt mu in lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">用反冲管理它的状态</li><li id="b6ff" class="mt mu in lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">在几个独立的组件之间共享我们的定时器状态</li></ul></div><div class="ab cl ks kt hr ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ig ih ii ij ik"><h1 id="b9c7" class="kz la in bd lb lc ld le lf lg lh li lj jt lk ju ll jw lm jx ln jz lo ka lp lq bi translated">跳到代码</h1><p id="6add" class="pw-post-body-paragraph lr ls in lt b lu lv jo lw lx ly jr lz ma mb mc md me mf mg mh mi mj mk ml mm ig bi translated">我发现像<a class="ae mn" href="https://codesandbox.io" rel="noopener ugc nofollow" target="_blank"> codesandbox.io </a>这样的在线ide非常方便地在像<a class="ae mn" href="https://create-react-app.dev/" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>这样的环境中剔除组件，引入外部库，甚至将项目附加到源代码控制库或通过免费的测试部署服务实时部署它。</p><p id="1a5b" class="pw-post-body-paragraph lr ls in lt b lu mo jo lw lx mp jr lz ma mq mc md me mr mg mh mi ms mk ml mm ig bi translated">这里是这篇文章完整的<a class="ae mn" href="https://codesandbox.io/s/recoil-simple-timer-p2gjr" rel="noopener ugc nofollow" target="_blank">沙箱</a>和<a class="ae mn" href="https://github.com/fauteuil/react-recoil-typescript-simple-timer/" rel="noopener ugc nofollow" target="_blank"> github库</a>。</p><h1 id="f01d" class="kz la in bd lb lc nh le lf lg ni li lj jt nj ju ll jw nk jx ln jz nl ka lp lq bi translated">布局用户界面</h1><p id="c815" class="pw-post-body-paragraph lr ls in lt b lu lv jo lw lx ly jr lz ma mb mc md me mf mg mh mi mj mk ml mm ig bi translated">首先，让我们设置视图组件。<code class="fe nm nn no np b">rrtst-App.tsx</code>脚本使用<a class="ae mn" href="https://styled-components.com/" rel="noopener ugc nofollow" target="_blank">样式组件</a>和<a class="ae mn" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank">类型脚本</a>布局基本视图。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="bc1c" class="pw-post-body-paragraph lr ls in lt b lu mo jo lw lx mp jr lz ma mq mc md me mr mg mh mi ms mk ml mm ig bi translated">接下来，计时器组件本身驻留在<code class="fe nm nn no np b">rrtst-OrangeTime.tsx</code>中，在这里发生与状态的交互。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="1e94" class="pw-post-body-paragraph lr ls in lt b lu mo jo lw lx mp jr lz ma mq mc md me mr mg mh mi ms mk ml mm ig bi translated">这是一个基本的倒计时定时器组件，使用反冲来消耗和保持整个应用程序的状态，并使用<code class="fe nm nn no np b">React.useRef</code>钩子来引用持久定时器对象，使用<code class="fe nm nn no np b">React.useEffect</code>钩子来执行其内部定时器逻辑。</p><p id="0e1a" class="pw-post-body-paragraph lr ls in lt b lu mo jo lw lx mp jr lz ma mq mc md me mr mg mh mi ms mk ml mm ig bi translated">最后，我们包括一个点击处理器来重置反冲状态。</p><p id="4da4" class="pw-post-body-paragraph lr ls in lt b lu mo jo lw lx mp jr lz ma mq mc md me mr mg mh mi ms mk ml mm ig bi translated">作为一个优化，如果我们想在其他地方重用相同的反冲钩子和定时器逻辑，这在一个<a class="ae mn" href="https://reactjs.org/docs/hooks-custom.html" rel="noopener ugc nofollow" target="_blank"> React定制钩子</a>中会更加整洁和可组合。</p><p id="59bb" class="pw-post-body-paragraph lr ls in lt b lu mo jo lw lx mp jr lz ma mq mc md me mr mg mh mi ms mk ml mm ig bi translated">第30–42行在<code class="fe nm nn no np b">useEffect</code>钩子内部有核心逻辑:</p><ul class=""><li id="bcb3" class="mt mu in lt b lu mo lx mp ma mv me mw mi mx mm my mz na nb bi translated">我们通过一个<code class="fe nm nn no np b">setInterval()</code>调用来分配我们的<code class="fe nm nn no np b">timerRef.current</code>值。React将跨渲染生命周期持久保存返回的时间间隔ID，直到我们清除<code class="fe nm nn no np b">useEffect</code>钩子的返回函数中的时间间隔，该函数在组件被卸载时被触发。</li><li id="c7e7" class="mt mu in lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">随着时间间隔每秒重复一次，<code class="fe nm nn no np b">orangeTimerState</code>反冲原子的值会随着递减的值而更新。</li></ul><p id="a104" class="pw-post-body-paragraph lr ls in lt b lu mo jo lw lx mp jr lz ma mq mc md me mr mg mh mi ms mk ml mm ig bi translated">这里是<code class="fe nm nn no np b">orangeTimerState</code>原子:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="999c" class="pw-post-body-paragraph lr ls in lt b lu mo jo lw lx mp jr lz ma mq mc md me mr mg mh mi ms mk ml mm ig bi translated">为了在应用程序中的任何地方方便地使用反冲状态，我们有一个简单的只读组件<code class="fe nm nn no np b">rrtst-ReadOnlyTimer.tsx</code>来显示对<code class="fe nm nn no np b">orangeTimerState</code>值的更新。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="c0b8" class="pw-post-body-paragraph lr ls in lt b lu mo jo lw lx mp jr lz ma mq mc md me mr mg mh mi ms mk ml mm ig bi translated">这个只是订阅了同一个atom，这导致它在每次更新到倒计时时间间隔时重新呈现。它使用随机颜色值进行样式化，并被放置在主应用程序组件的几个地方，以展示几个组件之间的状态同步性。</p><p id="51b0" class="pw-post-body-paragraph lr ls in lt b lu mo jo lw lx mp jr lz ma mq mc md me mr mg mh mi ms mk ml mm ig bi translated">所有这些代码都位于我们目录结构的同一层，然而，在现实世界的应用程序中，这一概念使得共享的应用程序状态非常具有性能和可组合性，因为订阅相同反冲原子的子组件可以分布在层次结构的任何一层。</p></div><div class="ab cl ks kt hr ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ig ih ii ij ik"><h1 id="235e" class="kz la in bd lb lc ld le lf lg lh li lj jt lk ju ll jw lm jx ln jz lo ka lp lq bi translated">结论</h1><p id="e0e8" class="pw-post-body-paragraph lr ls in lt b lu lv jo lw lx ly jr lz ma mb mc md me mf mg mh mi mj mk ml mm ig bi translated">很简单，就是这样。感谢阅读！</p><p id="6b7b" class="pw-post-body-paragraph lr ls in lt b lu mo jo lw lx mp jr lz ma mq mc md me mr mg mh mi ms mk ml mm ig bi translated"><em class="ns">更多内容看</em> <a class="ae mn" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt io"> <em class="ns">说白了。报名参加我们的</em> <a class="ae mn" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt io"> <em class="ns">免费周报</em> </strong> </a> <em class="ns">。在我们的</em> <a class="ae mn" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="lt io"> <em class="ns">社区不和谐</em> </strong> </a> <em class="ns">获得独家获取写作机会和建议。</em></strong></a></p></div></div>    
</body>
</html>