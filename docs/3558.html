<html>
<head>
<title>How to Make Real-Time Multiplayer WebXR Experiences — part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何打造实时多人WebXR体验——第3部分</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-make-real-time-multiplayer-webxr-experiences-part-3-3f843f7a3a13?source=collection_archive---------8-----------------------#2022-09-07">https://javascript.plainenglish.io/how-to-make-real-time-multiplayer-webxr-experiences-part-3-3f843f7a3a13?source=collection_archive---------8-----------------------#2022-09-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="92bc" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用Websockets、React Three Fiber和DynamoDB允许多个用户在WebXR中与3D模型进行交互。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/d771908d1ec465f98573e480557a4006.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HTCcpCKjd1McPJk_FLYujw.jpeg"/></div></div></figure><h1 id="dfe6" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">介绍</h1><p id="1207" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">这是第三篇详细介绍如何制作实时多人WebXR体验的博文。</p><p id="9497" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">已经涵盖了如何工作的概念方面和如何实现用户位置数据的实践方面，这篇博文将阐明如何实现与3D模型的交互，以便用户可以实时地与他们的环境交互。</p><p id="295a" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">如果你还没有，请阅读上面提到的另外两篇文章，并愉快地阅读下面的:D</p></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><h1 id="c584" class="ko kp in bd kq kr mp kt ku kv mq kx ky jt mr ju la jw ms jx lc jz mt ka le lf bi translated">代码示例</h1><p id="b04b" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">在<a class="ae mh" href="https://jamesmiller.blog/how-to-make-real-time-multiplayer-webxr-experiences-part-2/" rel="noopener ugc nofollow" target="_blank">之前的博文</a>中，我谈到了在索引目录中声明的XRScene高阶组件(HOC)。</p><p id="71c9" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">我们将从这里开始，并扩展到:</p><ol class=""><li id="45c6" class="mu mv in li b lj mc lm md lp mw lt mx lx my mb mz na nb nc bi translated">如何声明一个3D模型</li><li id="7f91" class="mu mv in li b lj nd lm ne lp nf lt ng lx nh mb mz na nb nc bi translated">如何让这些3D模型互动</li><li id="58c5" class="mu mv in li b lj nd lm ne lp nf lt ng lx nh mb mz na nb nc bi translated">如何将Websockets与3D模型集成</li></ol><p id="7b52" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">我们走吧，:D</p><h2 id="bdeb" class="ni kp in bd kq nj nk dn ku nl nm dp ky lp nn no la lt np nq lc lx nr ns le nt bi translated">如何声明3D模型</h2><p id="fd37" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">为了使用Websockets发出和检索3D模型的位置数据，您需要首先实例化Websockets(如本系列教程的第2部分所述),然后声明一个用于利用这些Websockets的3D模型组件。</p><p id="9fb7" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">让我们先看看index.js文件，看看我是如何设置它们的。</p><p id="2320" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated"><strong class="li io">index . js文件</strong></p><p id="4c48" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">请参见第8行和第20–24行，它们显示了3D模型的加载位置。</p><p id="99ae" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">您可以看到，我们正在将名称、位置和旋转属性传递给这个组件——让我们更仔细地看看Shiba.js组件，以了解它们是如何被使用的。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="24e5" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated"><strong class="li io">三维模型组件(Shiba.js) </strong></p><p id="d621" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">该组件负责渲染GLTF 3D模型，允许它与XR控制器交互，并将其连接到Websockets。</p><p id="9f41" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">为了进一步细分:</p><ul class=""><li id="e7d1" class="mu mv in li b lj mc lm md lp mw lt mx lx my mb nw na nb nc bi translated"><strong class="li io">渲染GLTF模型</strong>:第16–32行之间是由<a class="ae mh" href="https://github.com/pmndrs/gltfjsx" rel="noopener ugc nofollow" target="_blank">开源库自动生成的逻辑，该库将gltf转换成React-Three-Fiber组件</a>。</li><li id="969c" class="mu mv in li b lj nd lm ne lp nf lt ng lx nh mb nw na nb nc bi translated"><strong class="li io">为模型启用XR交互性</strong>:在第12行和第39行，带有XrInteractivity.js的高阶组件(HOC)用于为Shiba.js提供XR交互性。</li><li id="f53c" class="mu mv in li b lj nd lm ne lp nf lt ng lx nh mb nw na nb nc bi translated"><strong class="li io">为模型启用web sockets:</strong>在第11行和第40行，HOC withCollaboration.js用于为Shiba.js提供。</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="d0cf" class="ni kp in bd kq nj nk dn ku nl nm dp ky lp nn no la lt np nq lc lx nr ns le nt bi translated">如何让这些模型互动</h2><p id="4f5b" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">为了能够使用你的XR控制器(例如Oculus Quest 2控制器或HoloLens 2手动跟踪控制器等)，你需要实现一个名为react-three/xr的库。</p><p id="70ea" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">在本例中，我已经在一个名为withXrInteractivity.js的特设中实现了这一点，让我们更深入地了解一下！</p><p id="762c" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated"><strong class="li io">高阶组件— withXrInteractivity.js </strong></p><p id="6320" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">该特设委员会负责:</p><ul class=""><li id="9ef3" class="mu mv in li b lj mc lm md lp mw lt mx lx my mb nw na nb nc bi translated"><strong class="li io">使xr控制器能够“抓取”对象:</strong>第40–46行我们使用react-three/xr提供的RayGrab HOC，用于能够进行XR交互的设备。</li><li id="d0c5" class="mu mv in li b lj nd lm ne lp nf lt ng lx nh mb nw na nb nc bi translated"><strong class="li io">跟踪被移动的模型的位置值:</strong>第18–26行我们使用react-three/xr中的useXREvent函数来跟踪物体移动的位置。</li><li id="a5ba" class="mu mv in li b lj nd lm ne lp nf lt ng lx nh mb nw na nb nc bi translated"><strong class="li io">使用已移动对象的名称和位置更新全局应用程序状态:</strong>最后，在第28–36行之间，我们计算出附加了此HOC的哪些对象已被移动，然后使用该对象的名称和位置值更新应用程序的全局状态。</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="62c6" class="ni kp in bd kq nj nk dn ku nl nm dp ky lp nn no la lt np nq lc lx nr ns le nt bi translated">如何将Websockets与3D模型集成</h2><p id="885b" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">一旦我们使模型与XR控制器交互，我们就需要集成WebSockets的使用，以允许其他用户看到您移动的模型的新位置。</p><p id="fd9d" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">这需要理解两个方面，第一个是负责前端实际Websocket集成的<strong class="li io"> withCollaboration.js </strong> HOC，第二个是DynamoDB中数据的实际样子。</p><p id="f6a3" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated"><strong class="li io">高阶组件— withCollaboration.js </strong></p><p id="218d" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">从前端开始，withCollaboration.js执行以下操作:</p><ul class=""><li id="8fe9" class="mu mv in li b lj mc lm md lp mw lt mx lx my mb nw na nb nc bi translated"><strong class="li io">将您刚刚使用XR控制器移动的对象的位置提交给Websocket </strong>:第19–25行检查您的设备是否能够进行XR交互，如果能够，它将使用正在移动的模型的名称、移动的模型的位置以及移动它的用户的名称来更新Websocket</li><li id="5650" class="mu mv in li b lj nd lm ne lp nf lt ng lx nh mb nw na nb nc bi translated"><strong class="li io">监听Websocket的任何更新，并更新移动模型的位置</strong>:第28–32行监听Websocket上的更新，然后检查提交它的用户是否与提交它的用户不同，如果是，那么模型的新位置被应用到场景。</li></ul><p id="c675" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">在最后一点的基础上，它需要检查提交运动的用户是否与在web应用程序上接收位置数据的用户不同的原因是为了防止最初提交模型新位置的用户的位置值反弹。</p><p id="89aa" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">例如，如果您向Websocket提交位置值，Websocket会立即检测到您移动了模型，并尝试更新您刚刚移动的模型的位置——这可能会在三个位置处造成混淆。JS层，并导致模型的位置移动不稳定，并成为错误。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="fd82" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">【WebSocket位置数据的数据库</p><p id="2a6e" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">将模型的新位置值提交给Websocket后，通过本系列教程第2部分中概述的相同过程，将该值传递给DynamoDB。</p><p id="2420" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">我在下面附上了DynamoDB表的截图，其中显示了两种类型的条目:<strong class="li io">对象</strong>和<strong class="li io">用户</strong>。</p><p id="0f9f" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated"><strong class="li io">用户</strong>指已经登录并四处移动的人，他们的位置值存储在那里(见本教程系列的第2部分)。</p><p id="6f4d" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated"><strong class="li io">对象</strong>指的是用户使用他们的XR控制器移动的模型，如本文所述，让我们更深入地了解一下。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/2b24a4c92b072bf0636c7554d2297d8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1mVC-GpuyDtTnkagtPXrSw.png"/></div></div><figcaption class="nx ny gj gh gi nz oa bd b be z dk">Screenshot of the positional data in the DynamoDB Table</figcaption></figure><p id="2880" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">查看存储的模型条目的示例，您可以看到存储了模型的名称(在本例中为“shiba”)以及模型的位置(称为“matrixWorld”)和提交新位置的用户的名称。</p><p id="7856" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">我们将位置存储为“矩阵世界”而不是x/y/z值的原因是，当您使用XR控制器移动模型时，模型的位置会发生复杂的变化。</p><p id="f22b" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">当您使用XR控制器“抓取”一个模型时，该模型将成为控制器的子模型，直到您释放该模型。</p><p id="dc21" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">为了向其他用户提供您将模型移动到的准确位置，我们存储了模型的“matrixWorld”位置，这实际上是它的全局位置，而不是它相对于XR控制器的位置(也就是说，不是它作为XR控制器的子节点的位置)。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><h1 id="1acc" class="ko kp in bd kq kr mp kt ku kv mq kx ky jt mr ju la jw ms jx lc jz mt ka le lf bi translated">结论</h1><p id="fe09" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">这是大量的信息！</p><p id="bb74" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">我真的希望这有助于你使用React-Three-Fiber和Websockets :D进行实时多人WebXR体验</p><p id="6e1e" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">幸运的话，您将能够为您的应用程序改编这些代码——或者更好地使用<a class="ae mh" href="https://github.com/JamesMillerBlog/wrapper.js" rel="noopener ugc nofollow" target="_blank"> Wrapper.js </a>来构建您的WebXR体验！</p><p id="366b" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated">我希望这能有所帮助，同时，祝你在:D玩得开心</p></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="f305" class="pw-post-body-paragraph lg lh in li b lj mc jo ll lm md jr lo lp me lr ls lt mf lv lw lx mg lz ma mb ig bi translated"><em class="ob">更多内容请看</em><a class="ae mh" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="li io"><em class="ob">plain English . io</em></strong></a><em class="ob">。报名参加我们的</em> <a class="ae mh" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="li io"> <em class="ob">免费周报</em> </strong> </a> <em class="ob">。关注我们关于</em><a class="ae mh" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="li io"><em class="ob">Twitter</em></strong></a><a class="ae mh" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="li io"><em class="ob">LinkedIn</em></strong></a><em class="ob"/><a class="ae mh" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="li io"><em class="ob">YouTube</em></strong></a><em class="ob"/><a class="ae mh" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="li io"><em class="ob">不和</em> </strong> </a> <em class="ob">。</em></p></div></div>    
</body>
</html>