<html>
<head>
<title>Handle Error While Testing Your React Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">测试React挂钩时处理错误</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/handle-error-while-testing-your-hooks-e845a08045a4?source=collection_archive---------7-----------------------#2022-08-05">https://javascript.plainenglish.io/handle-error-while-testing-your-hooks-e845a08045a4?source=collection_archive---------7-----------------------#2022-08-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bce1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何在测试React挂钩时处理错误，并针对特定的错误</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5febe67278894df2e950fee9dea368d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*npRjRnvf8xq00vKWKP-iQg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by Karolina Grabowska: <a class="ae kv" href="https://www.pexels.com/photo/four-various-fishing-baits-on-white-background-6478113/" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/photo/four-various-fishing-baits-on-white-background-6478113/</a></figcaption></figure><p id="0c3b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之前，我有幸写了一篇关于<strong class="ky ir">测试你的钩子</strong>的文章。现在我们将更深入，看看如何在测试钩子时处理异常。</p><div class="ls lt gp gr lu lv"><a rel="noopener  ugc nofollow" target="_blank" href="/testing-your-hooks-like-a-pro-e1e0d7106670"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">如何像专业人士一样测试你的反应钩</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">一开始看起来可能很复杂，但是测试React钩子实际上非常简单！</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="me l"><div class="mf l mg mh mi me mj kp lv"/></div></div></a></div></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="cdec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">处理异常是测试的一个完整部分。它涵盖了应用程序周期中的<strong class="ky ir">失败路径</strong>，正确地涵盖它们是至关重要的。</p><p id="c141" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">钩子抛出错误有两种方式。可以是<strong class="ky ir">调用</strong>的时候，也可以是<strong class="ky ir">调用钩子</strong>返回的函数的时候。在本文中，我们将两者都看一看。</p><h2 id="81e6" class="mr ms iq bd mt mu mv dn mw mx my dp mz lf na nb nc lj nd ne nf ln ng nh ni nj bi translated">调用挂钩时处理错误</h2><p id="c4aa" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">让我们开门见山吧，没有合适的方法去做这件事。一个钩子在执行时抛出一个错误而没有在内部处理它(未处理)是<strong class="ky ir">没有正确完成</strong>。</p><p id="997d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看下面的代码:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/c85ac47f049e51b85175edf312823ba4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nQoLLJKTLQZhi6FdVMw0UQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Hook that throws an error</figcaption></figure><p id="5d24" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个钩子是非常危险的，因为它会在执行时使整个应用程序崩溃。原因是它会抛出一个无法处理的异常。</p><p id="6e94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nq">不可能在React组件中使用try/catch，因为它会破坏钩子的规则。</em> </p><p id="cef4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是有一个简单的方法可以解决这个问题:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/aff986fab381740ce211350a021bd82c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F6OKP5zoxVfU6LpjZYJBBQ.png"/></div></div></figure><blockquote class="nr"><p id="bbd4" class="ns nt iq bd nu nv nw nx ny nz oa lr dk translated">请记住，这段代码纯粹是为了示例的目的！</p></blockquote><p id="8eb0" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">那更好！现在，我们的钩子正在处理和管理它的错误！</p><p id="5351" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nq">这样，我们让我们的组件意识到有一个错误，它可以</em> <strong class="ky ir"> <em class="nq">通过显示一个错误的组件来产生后果</em> </strong> <em class="nq">！</em></p><p id="3475" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们要测试这个钩子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/c544507f4fe5271df61b4e5c8f9fa80a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e40D6qVSjtyH6aDPpqvVLA.png"/></div></div></figure><p id="68e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">瞧啊。因为钩子正在管理并返回错误，所以我们可以很容易地在测试中预料到它，并确保它对应于正确的消息。我们还确保该值被设置为undefined，以避免组件使用钩子。</p><h2 id="d3d5" class="mr ms iq bd mt mu mv dn mw mx my dp mz lf na nb nc lj nd ne nf ln ng nh ni nj bi translated">调用钩子返回的函数时处理错误</h2><p id="dc0e" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">这实际上比第一种情况简单得多，我们不必过多考虑异常应该在哪里，因为它很可能是从钩子内部定义的函数中抛出的。</p><p id="b952" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们创建一个新的挂钩:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/c37d0f905d3af9ac006d36358c7734a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-neDec2kEb30YmRsmmLVjQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">The useErrorTrigger hook</figcaption></figure><p id="3960" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个钩子只返回一个失败的<code class="fe oh oi oj ok b">trigger</code>函数。目标是<strong class="ky ir">在我们的测试</strong>中预期这个错误。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/9643e90606a5828859da9c05fbc3d10a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NsdClwwlH5_lBMWgOWj8Lw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Testing our hook</figcaption></figure><p id="0034" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个测试首先执行钩子来获取它返回的值(在这种情况下，是<code class="fe oh oi oj ok b">trigger</code>函数)。</p><p id="c158" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后我们在<code class="fe oh oi oj ok b">expect().toThrow()</code> jest函数中执行这个函数。</p><p id="dd9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样！我们将期待触发器函数抛出一个错误消息<code class="fe oh oi oj ok b">Damn</code>，并使测试成功！</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="237b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总之，小心你设计钩子的方式，因为它们的可测试性可能在很大程度上取决于此。但是一旦你的钩子设计正确并且没有抛出未处理的错误，那么测试它们就变得非常容易了！</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="3e3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nq">更多内容看</em> <a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nq">说白了就是io </em> </strong> </a> <em class="nq">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nq">免费周报</em> </strong> </a> <em class="nq">。关注我们关于</em> <a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nq">推特</em> </strong> </a>，<a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nq">领英</em> </strong> </a>，<strong class="ky ir"> <em class="nq"> </em> </strong> <em class="nq">和</em> <a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nq">不和</em> </strong> </a> <em class="nq">。</em></p></div></div>    
</body>
</html>