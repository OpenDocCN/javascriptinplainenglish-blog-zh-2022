<html>
<head>
<title>How to Make a JavaScript Function Wait Until an Element Exists Before Running it?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何让一个JavaScript函数等到元素存在后再运行？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-make-a-javascript-function-wait-until-an-element-exists-before-running-it-82bf33ce084a?source=collection_archive---------1-----------------------#2022-04-09">https://javascript.plainenglish.io/how-to-make-a-javascript-function-wait-until-an-element-exists-before-running-it-82bf33ce084a?source=collection_archive---------1-----------------------#2022-04-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b8815b34d32760a83b4042ef92715e21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lOiMx0V3cLc8w4me"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@tamara_photography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Tamara Gak</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d71d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时，我们希望等到元素存在后再运行JavaScript函数。</p><p id="fa1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何让JavaScript函数在运行之前等待元素的存在。</p><h1 id="db26" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用MutationObserver监视要添加到DOM中的元素</h1><p id="fc80" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用现代浏览器提供的<code class="fe me mf mg mh b">MutationObserver</code>构造函数来观察元素的出现。</p><p id="342b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有下面的HTML:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ece8" class="mq lc iq mh b gy mr ms l mt mu">&lt;div id='container'&gt;</span><span id="c77a" class="mq lc iq mh b gy mv ms l mt mu">&lt;/div&gt;</span></pre><p id="c142" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以向它添加一个子元素，并通过编写以下内容来观察它的出现:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ec96" class="mq lc iq mh b gy mr ms l mt mu">const container = document.getElementById('container')<br/>setTimeout(() =&gt; {<br/>  const div = document.createElement('div')<br/>  div.textContent = 'hello'<br/>  div.id = 'hello'<br/>  container.appendChild(div)<br/>}, 2000)</span><span id="b375" class="mq lc iq mh b gy mv ms l mt mu">const observer = new MutationObserver((mutations, obs) =&gt; {<br/>  const hello = document.getElementById('hello');<br/>  if (hello) {<br/>    console.log(hello.innerText)<br/>    obs.disconnect();<br/>    return;<br/>  }<br/>});</span><span id="3ee7" class="mq lc iq mh b gy mv ms l mt mu">observer.observe(document, {<br/>  childList: true,<br/>  subtree: true<br/>});</span></pre><p id="8232" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用一个回调函数调用<code class="fe me mf mg mh b">setTimeout</code>，该回调函数追加一个div作为ID为<code class="fe me mf mg mh b">container</code>的div的子div。</p><p id="bd9e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们用一个带有<code class="fe me mf mg mh b">mutation</code>和<code class="fe me mf mg mh b">obs</code>参数的回调函数调用<code class="fe me mf mg mh b">MutationObserver</code>构造函数。</p><p id="456f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">obs</code>是返回的观察者。</p><p id="3d89" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在回调中，我们试图获取ID为<code class="fe me mf mg mh b">hello</code>的元素。</p><p id="5803" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果存在，那么我们得到元素的<code class="fe me mf mg mh b">innerText</code>属性值。</p><p id="0057" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">disconnect</code>停止观察DOM中的变化。</p><p id="c12d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">observer.observe</code>来观察<code class="fe me mf mg mh b">document</code>的变化。</p><p id="9217" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">childList</code>设置为<code class="fe me mf mg mh b">true</code>以观察元素的添加或删除。</p><p id="34c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">subtree</code>也被设置为<code class="fe me mf mg mh b">true</code>以监视子元素的变化。</p><h1 id="4229" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="c44f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">MutationObserver</code>构造函数轻松地观察DOM的变化。</p><p id="dfbe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们可以使用它在运行任何代码之前等待一个元素出现。</p><p id="47db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mw">更多内容请看</em><a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">plain English . io</em></strong></a><em class="mw">。报名参加我们的</em> <a class="ae kc" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="mw">免费周报</em> </strong> </a> <em class="mw">。关注我们关于</em><a class="ae kc" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">Twitter</em></strong></a><em class="mw">和</em><a class="ae kc" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">LinkedIn</em></strong></a><em class="mw">。加入我们的</em> <a class="ae kc" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="mw">社区不和谐</em> </strong> </a> <em class="mw">。</em></p></div></div>    
</body>
</html>