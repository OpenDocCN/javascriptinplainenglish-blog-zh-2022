<html>
<head>
<title>How to Add a Copy Button to Code Snippets on Gatsby</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Gatsby上的代码片段中添加复制按钮</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/adding-a-copy-button-to-code-snippets-on-gatsby-the-lazy-way-e93111e542f8?source=collection_archive---------3-----------------------#2022-05-07">https://javascript.plainenglish.io/adding-a-copy-button-to-code-snippets-on-gatsby-the-lazy-way-e93111e542f8?source=collection_archive---------3-----------------------#2022-05-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="d13d" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">向Gatsby上的代码片段添加复制按钮的懒惰方式。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/508a80cd888accbd89dfdd98e71547d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OnQ_CXzD3KYYVWLD"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@clark_fransa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Arnold Francisca</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="18b6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我经常在我的博客文章中写代码和分享代码片段，复制粘贴代码是软件工程师的一项基本技能，因为选择一个文本然后按下<code class="fe lp lq lr ls b">CTRL + C</code>然后按下<code class="fe lp lq lr ls b">CTRL + V</code>是一项大量的工作，所以我决定在我的所有代码片段中添加一个复制按钮，以方便我所有软件工程师同事的生活。</p><h1 id="e5a7" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">可能的解决方案</h1><p id="11bf" class="pw-post-body-paragraph kt ku in kv b kw ml jo ky kz mm jr lb lc mn le lf lg mo li lj lk mp lm ln lo ig bi translated">正确的方法是创建一个插件来接入Gatsby HTML生成过程，并访问AST数据结构中的代码片段对象。有一个<a class="ae ks" href="https://thundermiracle.medium.com/add-copy-button-to-your-gatsbyjs-blogs-code-block-a2711364a229" rel="noopener">非常好的教程</a>是由<a class="ae ks" href="https://thundermiracle.medium.com/" rel="noopener"> @thundermiracle </a>提供的，关于如何做到这一点。</p><p id="8e9e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当然，我决定用一种糟糕的方式，那就是修改<code class="fe lp lq lr ls b">gatsby-node.js</code>文件中<code class="fe lp lq lr ls b">createPages</code>函数的HTML字符串。</p><h1 id="dc23" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">代码</h1><p id="4caf" class="pw-post-body-paragraph kt ku in kv b kw ml jo ky kz mm jr lb lc mn le lf lg mo li lj lk mp lm ln lo ig bi translated">在创建文章页面的循环中，我在<code class="fe lp lq lr ls b">gatsby-node.js</code>上添加了以下代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="9ef2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">对于<code class="fe lp lq lr ls b">generateAlternativeHtml</code>函数，我将使用<a class="ae ks" href="https://www.npmjs.com/package/jsdom" rel="noopener ugc nofollow" target="_blank"> jsdom </a>包来解析HTML字符串并将其转换为dom对象，然后使用<code class="fe lp lq lr ls b">querySelectorAll</code>方法找到所有代码片段并向它们添加复制按钮。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="2f46" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在所有的代码片段都有一个复制按钮，但是这个按钮不做任何事情。我将添加<code class="fe lp lq lr ls b">onclick</code>事件处理程序到复制按钮，将代码片段复制到剪贴板。这需要在代码的<code class="fe lp lq lr ls b">React</code>部分用<code class="fe lp lq lr ls b">PostTemplate.jsx</code>文件中的<code class="fe lp lq lr ls b">useEffect</code>来完成。</p><p id="a2d4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了将代码片段复制到剪贴板，我将使用<a class="ae ks" href="https://www.npmjs.com/package/clipboard-copy" rel="noopener ugc nofollow" target="_blank"> clipboard-copy </a>包。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="eba8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">搞定了。虽然粗糙，但在很多方面也很美。</p><h1 id="a977" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">结论</h1><p id="445e" class="pw-post-body-paragraph kt ku in kv b kw ml jo ky kz mm jr lb lc mn le lf lg mo li lj lk mp lm ln lo ig bi translated">这种解决方案给静态站点生成器过程和客户端的一些DOM操作增加了一点点开销，但目前这是一个好的解决方案。如果你正在寻找一个快速简单的解决方案，这是正确的选择。</p><p id="4588" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要查看最终结果，请查看我在个人博客上的博文:</p><div class="ms mt gp gr mu mv"><a href="https://pablo.gg/en/blog/categories/coding/" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd io gy z fp na fr fs nb fu fw im bi translated">关于类别编码的帖子</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">又一个开发者个人博客</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">pablo.gg</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj km mv"/></div></div></a></div><p id="2c65" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这个帖子到此为止。我希望你喜欢它。</p></div><div class="ab cl nk nl hr nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ig ih ii ij ik"><p id="2c06" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="nr">最初发布于</em><a class="ae ks" href="https://pablo.gg/en/blog/coding/adding-a-copy-button-to-code-snippets-on-gatsby-the-lazy-way/" rel="noopener ugc nofollow" target="_blank"><em class="nr">https://pablo . gg</em></a><em class="nr">。</em></p><p id="ee10" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="nr">更多内容看</em> <a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nr">说白了。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nr">免费周报</em> </strong> </a> <em class="nr">。关注我们关于</em><a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nr">Twitter</em></strong></a><em class="nr">和</em><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nr">LinkedIn</em></strong></a><em class="nr">。加入我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="nr">社区</em> </strong> </a> <em class="nr">。</em></strong></a></p></div></div>    
</body>
</html>