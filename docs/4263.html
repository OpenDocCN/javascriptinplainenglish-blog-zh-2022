<html>
<head>
<title>What is the “unknown” Type in TypeScript?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TypeScript中的“未知”类型是什么？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/what-is-the-unknown-type-in-typescript-5ef6c5333b81?source=collection_archive---------4-----------------------#2022-11-15">https://javascript.plainenglish.io/what-is-the-unknown-type-in-typescript-5ef6c5333b81?source=collection_archive---------4-----------------------#2022-11-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cb80" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在TypeScript中，任何值都可以赋给“未知”类型，但是如果没有类型断言，“未知”只能赋给它本身</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a0cc9ccec83f8af00eaa8664726f3c75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7p6SYEDBH-1YmOD1x4OwQQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@fakurian?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Milad Fakurian</a> on <a class="ae kv" href="https://unsplash.com/s/photos/abstract?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="ddd5" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="daf2" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">不久前，在3.0版本中，TypeScript在其工具包中引入了一个新的<code class="fe mk ml mm mn b">unknown</code>类型，但是这个类型做什么，更具体地说，我们应该在什么时候使用它？</p><p id="4008" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">本文将研究这种“新”类型，以便更好地理解它的目标。</p><p id="5c7e" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">我们也将始终如一地把它与它的兄弟类型<code class="fe mk ml mm mn b">any</code>进行比较；如果你还不熟悉它，看看这篇的文章，在那里我们已经更详细地讨论过了。</p><h1 id="7a19" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">未知类型是什么？</h1><p id="8bef" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在<a class="ae kv" href="https://www.geeksforgeeks.org/introduction-to-typescript/" rel="noopener ugc nofollow" target="_blank">类型脚本中，</a>任何值都可以赋给<code class="fe mk ml mm mn b">unknown</code>类型，但是没有类型断言，<code class="fe mk ml mm mn b">unknown</code>只能赋给自身和<code class="fe mk ml mm mn b">any</code>类型。类似地，如果不首先声明或限制为更精确的类型，就不允许对类型设置为<code class="fe mk ml mm mn b">unknown</code>的值进行任何操作。</p><p id="eadd" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">我们可以给一个<code class="fe mk ml mm mn b">unknown</code>类型的变量赋值，就像我们给一个<code class="fe mk ml mm mn b">any</code>类型的变量赋值一样。与in的情况不同，我们不能访问<code class="fe mk ml mm mn b">unknown</code>类型变量的属性，也不能调用或构造它们。</p><p id="dc81" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">此外，<code class="fe mk ml mm mn b">unknown</code>值只能分配给<code class="fe mk ml mm mn b">any</code>和<code class="fe mk ml mm mn b">unknown</code>类型的变量。</p><p id="35e5" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">给类型<code class="fe mk ml mm mn b">unknown</code>的变量赋值:</p><pre class="kg kh ki kj gt mt mn mu bn mv mw bi"><span id="7728" class="mx kx iq mn b be my mz l na nb">let val: unknown;<br/><br/>val = true; // Fine<br/>val = 42; // Fine<br/>val = "hey!"; // Fine<br/>val = []; // Fine<br/>val = {}; // Fine<br/>val = Math.random; // Fine<br/>val = null; // Fine<br/>val = undefined; // Fine<br/>val = () =&gt; { console.log('Hey again!'); }; // Fine</span></pre><p id="6043" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">将各种类型的值赋给类型<code class="fe mk ml mm mn b">any</code>的变量:</p><pre class="kg kh ki kj gt mt mn mu bn mv mw bi"><span id="f60d" class="mx kx iq mn b be my mz l na nb">let val: any;<br/><br/>val = true; // Fine<br/>val = 42; // Fine<br/>val = "hey!"; // Fine<br/>val = []; // Fine<br/>val = {}; // Fine<br/>val = Math.random; // Fine<br/>val = null; // Fine<br/>val = undefined; // Fine<br/>val = () =&gt; { console.log('Hey again!'); }; // Fine</span></pre><p id="8fa8" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">将类型<code class="fe mk ml mm mn b">unknown</code>的值赋给其他类型的变量:</p><pre class="kg kh ki kj gt mt mn mu bn mv mw bi"><span id="0d39" class="mx kx iq mn b be my mz l na nb">let val: unknown;<br/><br/>const val1: unknown = val; // Fine<br/>const val2: any = val; // Fine<br/>const val3: boolean = val; // Will throw error<br/>const val4: number = val; // Will throw error<br/>const val5: string = val; // Will throw error<br/>const val6: Record&lt;string, any&gt; = val; // Will throw error<br/>const val7: any[] = val; // Will throw error<br/>const val8: (...args: any[]) =&gt; void = val; // Will throw error</span></pre><h1 id="1106" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">使未知类型更加具体</h1><p id="86c7" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们可以缩小一个<code class="fe mk ml mm mn b">unknown</code>类型值的可能结果。</p><p id="1496" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">让我们看看下面的例子:</p><pre class="kg kh ki kj gt mt mn mu bn mv mw bi"><span id="4466" class="mx kx iq mn b be my mz l na nb">const isNumbersArray = (val: unknown): val is number[] =&gt; (<br/>  Array.isArray(val) &amp;&amp; val.every((element) =&gt; typeof element === 'number')<br/>);</span></pre><pre class="nc mt mn nd ne aw nf bi"><span id="fc56" class="ng kx iq mn b gy nh ni l nj nb">const unknownValue: unknown = [12, 2, 8, 17, 14];</span><span id="188f" class="ng kx iq mn b gy nk ni l nj nb">if (isNumbersArray(unknownValue)) {<br/>  const sum = unknownValue.reduce((accumulator, currentElement) =&gt; (accumulator + currentElement) , 0);</span><span id="413c" class="ng kx iq mn b gy nk ni l nj nb">  console.log(sum);<br/>}</span></pre><p id="b00b" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">之前，的类型是<code class="fe mk ml mm mn b">unknown</code>；然而，在使用<code class="fe mk ml mm mn b">unknownValue</code>作为参数调用<code class="fe mk ml mm mn b">isNumbersArray</code>之后，我们得出结论，<code class="fe mk ml mm mn b">unknownValue</code>的类型实际上是数字的<strong class="lq ir">数组的类型。</strong></p><h1 id="6a5b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">什么时候我们需要使用未知类型？</h1><p id="9467" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们可能想要使用<code class="fe mk ml mm mn b">unknown</code>类型的一个特殊场景是我们需要从本地存储中获取一些东西。</p><p id="1231" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">在存储之前，所有<code class="fe mk ml mm mn b">localStorage</code> API项目都被<strong class="lq ir">序列化。然而，我们的用例包含了在反序列化</strong>之后检索到的条目的<strong class="lq ir">值。</strong></p><p id="0a2a" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">通过利用<code class="fe mk ml mm mn b">unknown</code>类型，我们将能够打出反序列化项目的类型，而不是简单地使用<code class="fe mk ml mm mn b">any</code>注释。</p><pre class="kg kh ki kj gt mt mn mu bn mv mw bi"><span id="bd5c" class="mx kx iq mn b be my mz l na nb">type ResultType =<br/>  | { success: true; value: unknown }<br/>  | { success: false; error: Error };</span></pre><pre class="nc mt mn nd ne aw nf bi"><span id="4594" class="ng kx iq mn b gy nh ni l nj nb">const retrieveItemFromLocalStorage = (key: string): ResultType =&gt; {<br/>  const item = localStorage.getItem(key);</span><span id="0565" class="ng kx iq mn b gy nk ni l nj nb">  if (!item) {<br/>    // The item does not exist, thus return an error<br/>    return {<br/>      success: false,<br/>      error: new Error(`Item with key "${key}" does not exist`),<br/>    };<br/>  }</span><span id="12f5" class="ng kx iq mn b gy nk ni l nj nb">  let value: unknown;</span><span id="b74d" class="ng kx iq mn b gy nk ni l nj nb">  try {<br/>    value = JSON.parse(item);<br/>  } catch (error) {<br/>    // The item is not a valid JSON value, thus return an error<br/>    return {<br/>      success: false,<br/>      error,<br/>    };<br/>  }</span><span id="8461" class="ng kx iq mn b gy nk ni l nj nb">  // Everything's fine, thus return a successful result<br/>  return {<br/>    success: true,<br/>    value,<br/>  };<br/>}</span></pre><p id="14b3" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated"><code class="fe mk ml mm mn b">ResultType</code>是一个<a class="ae kv" href="https://mariusschulz.com/blog/tagged-union-types-in-typescript" rel="noopener ugc nofollow" target="_blank">标记的联合类型</a>(也称为区别联合类型)。你可能会遇到<code class="fe mk ml mm mn b">Maybe</code>、<code class="fe mk ml mm mn b">Option</code>或<code class="fe mk ml mm mn b">Optional</code>，它们在其他语言中是它的对等词。</p><p id="80dc" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">我们使用<code class="fe mk ml mm mn b">ResultType</code>清晰地模拟操作的成功或不成功的结果。</p><p id="cdeb" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">这里有一个我们如何使用<code class="fe mk ml mm mn b">retrieveItemFromLocalStorage</code>函数的例子:</p><pre class="kg kh ki kj gt mt mn mu bn mv mw bi"><span id="8291" class="mx kx iq mn b be my mz l na nb">const result = retrieveItemFromLocalStorage("cached-blogs");<br/><br/>if (result.success) {<br/>  // We've narrowed the `success` property to `true`,<br/>  // so we can access the `value` property<br/>  const cachedBlogs: unknown = result.value;<br/><br/>  if (isArrayOfBlogs(cachedBlogs)) {<br/>    // We've narrowed the `unknown` type to `Array&lt;Blog&gt;`,<br/>    // so we can safely use our cached `cachedBlogs` array as we would<br/>    console.log('Cached blogs:', cachedBlogs);<br/>  }<br/>} else {<br/>  // We've narrowed the `success` property to `false`,<br/>  // so we can access the `error` property<br/>  console.error(result.error);<br/>}</span></pre><h1 id="d9a5" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">摘要</h1><p id="c7dd" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我希望你喜欢这篇文章，并对<code class="fe mk ml mm mn b">unknown</code>类型与<code class="fe mk ml mm mn b">any</code>类型的不同之处有了更多的了解，以及我们通常在实际项目中使用它的时间。</p><p id="cfe3" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">欢迎在下面的评论区留下你的想法。</p><p id="078e" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">干杯！</p><p id="6f8a" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated"><em class="nl">更多内容请看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir"><em class="nl">plain English . io</em></strong></a><em class="nl">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir"> <em class="nl">免费周报</em> </strong> </a> <em class="nl">。关注我们关于</em><a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir"><em class="nl">Twitter</em></strong></a><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir"><em class="nl">LinkedIn</em></strong></a><em class="nl"/><a class="ae kv" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir"><em class="nl">YouTube</em></strong></a><em class="nl"/><a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir"><em class="nl">不和</em> </strong> </a> <em class="nl">。对增长黑客感兴趣？检查</em> <a class="ae kv" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir"> <em class="nl">电路</em> </strong> </a> <em class="nl">。</em></p></div></div>    
</body>
</html>