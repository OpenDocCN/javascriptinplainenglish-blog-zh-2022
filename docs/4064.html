<html>
<head>
<title>How to Manage Web Project Version with Shell Script</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Shell脚本管理Web项目版本</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-manage-web-project-version-with-shell-script-1afe679fee52?source=collection_archive---------9-----------------------#2022-10-21">https://javascript.plainenglish.io/how-to-manage-web-project-version-with-shell-script-1afe679fee52?source=collection_archive---------9-----------------------#2022-10-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8d96" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">是时候使用shell脚本来管理您的应用程序版本了</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a9996d7b67227b4e4a133d6361bd78e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xiAIUH-XX1FA1h8j"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@timwildsmith?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Tim Wildsmith</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="134c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最近，我喜欢用Shell脚本制作脚本。Shell脚本功能强大，非常易于使用。有时，如果您必须运行Git命令或者必须导入<code class="fe ls lt lu lv b">package.json</code>文件，这就方便多了。</p><p id="2412" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我想分享我是如何使用Shell脚本和基本的NPM命令来制作版本管理脚本的。</p><h1 id="a809" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">对论点的理解</h1><p id="d4b8" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">首先要做的是在<code class="fe ls lt lu lv b">package.json</code>中添加一个新的脚本。</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="753b" class="mx lx iq lv b gy my mz l na nb">// package.json</span><span id="1154" class="mx lx iq lv b gy nc mz l na nb">"scripts": {<br/>  "version-check": "&lt;your_directory&gt;/version.sh"<br/>}</span></pre><p id="d277" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在你可以运行命令<code class="fe ls lt lu lv b">npm run version-check</code>或<code class="fe ls lt lu lv b">yarn version-check</code>，随你喜欢。在Shell脚本<code class="fe ls lt lu lv b">version.sh</code>中，我们将从检查参数是否存在开始。</p><h2 id="c67d" class="mx lx iq bd ly nd ne dn mc nf ng dp mg lf nh ni mi lj nj nk mk ln nl nm mm nn bi translated">$1是神奇的关键字。</h2><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="0da5" class="mx lx iq lv b gy my mz l na nb">// version.sh</span><span id="cf84" class="mx lx iq lv b gy nc mz l na nb">if [ -z "$1"]; then<br/>  echo "You have to pass one of the following arguments"<br/>  echo "major | patch | minor | &lt;specific version&gt;"<br/>  exit 0<br/>fi</span></pre><p id="2889" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Shell脚本使用数字1-9的美元符号($)为您提供用户参数。例如，$1指向第一个参数。如果运行命令<code class="fe ls lt lu lv b">npm run version</code>，没有参数传递给<code class="fe ls lt lu lv b">version.sh</code>，If语句将通过。</p><p id="7d48" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在if语句中，<code class="fe ls lt lu lv b">-z "$1"</code>表示，“如果第一个参数长度为零，则返回true。”</p><h1 id="fc07" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">检查分支名称</h1><p id="79b4" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">下一步是检查当前的分支名称，我们运行命令的地方，是我们想要的正确的地方。</p><p id="d862" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设我们只希望这个脚本在<code class="fe ls lt lu lv b">main</code>分支上执行。在Shell脚本中，变量可以按如下方式赋值。</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="fe5a" class="mx lx iq lv b gy my mz l na nb">TARGET_BRANCH="main"</span></pre><p id="4c2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用大写或小写并不重要。但重要的是等号(=)左右两边一定不能有空格。</p><p id="d88b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们要将当前工作的分支与<code class="fe ls lt lu lv b">TARGET_BRANCH</code>进行比较。我们可以用Shell脚本非常容易地得到当前的分支名称。</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="aa31" class="mx lx iq lv b gy my mz l na nb">git rev-parse --abbrev-ref HEAD</span></pre><p id="2f36" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以现在我们可以定义另一个变量来存储当前的分支名称。我们应该用美元符号和括号将Git或NPM命令括起来。</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="fd80" class="mx lx iq lv b gy my mz l na nb">CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)</span></pre><p id="40e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么，多田。分店名称印得很好。</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="81d5" class="mx lx iq lv b gy my mz l na nb">echo $CURRENT_BRANCH <br/>// main (if you are on the main)</span></pre><p id="eafe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以检查当前分支是否是<code class="fe ls lt lu lv b">main</code>，否则，我们将打印错误消息。</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="a4fe" class="mx lx iq lv b gy my mz l na nb">if [ "$TARGET_BRANCH" != "$CURRENT_BRANCH" ]; then<br/>  echo "Cannot update the version. Make sure to checkout to $TARGET_BRANCH."<br/>  exit 0<br/>fi</span></pre><h1 id="1751" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">检查文件更改</h1><p id="e01a" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">最后，我们希望只有在您的工作目录中没有文件更改时才运行这个脚本，因为更改版本通常意味着您的任务已经全部完成，而更新版本是最后要做的事情。</p><p id="916c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要从<code class="fe ls lt lu lv b">package.json</code>中检索当前版本，我们可以这样写。</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="4c8a" class="mx lx iq lv b gy my mz l na nb">OLD_VERSION=$npm_package_version</span></pre><p id="233a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以使用NPM内置命令<code class="fe ls lt lu lv b">npm version</code>来执行</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="b387" class="mx lx iq lv b gy my mz l na nb">NEW_VERSION=$(npm version $1 --no-git-tag-version)</span></pre><h2 id="3e61" class="mx lx iq bd ly nd ne dn mc nf ng dp mg lf nh ni mi lj nj nk mk ln nl nm mm nn bi translated">我想我应该告诉你那个命令是什么意思</h2><p id="c999" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated"><code class="fe ls lt lu lv b">npm version</code>需要版本类型，如<code class="fe ls lt lu lv b">patch</code>、<code class="fe ls lt lu lv b">minor</code>或<code class="fe ls lt lu lv b">major</code>。但是当你运行这个脚本<code class="fe ls lt lu lv b">npm version patch</code>时，它会将<code class="fe ls lt lu lv b">package.json</code>的补丁号从<code class="fe ls lt lu lv b">a.b.p</code>提升到<code class="fe ls lt lu lv b">a.b.p+1</code>。例如，<code class="fe ls lt lu lv b">npm run version</code>将版本从<code class="fe ls lt lu lv b">0.0.1</code>更改为<code class="fe ls lt lu lv b">0.0.2</code>。</p><p id="37e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当该命令改变<code class="fe ls lt lu lv b">package.json</code>中的版本时，由于选项<code class="fe ls lt lu lv b">git-tag-version</code>的原因，它还会创建一个标签并自动提交，默认值为<code class="fe ls lt lu lv b">true</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/3db144bd25f228475ef8e75d5aeb663c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*Ha1Rkda_GG4thBC5dKBLzw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">An automatically created commit</figcaption></figure><p id="8b91" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是我们不喜欢它的样子；太丑了！😤</p><p id="7677" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们不想就这样离开。使用<code class="fe ls lt lu lv b">--no</code>选项可以防止Git进行新的提交。</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="b159" class="mx lx iq lv b gy my mz l na nb">npm version patch --no-git-tag-version</span></pre><p id="8395" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个命令只改变应用程序的版本，所以在diff中将有两个变化。</p><h2 id="3e3a" class="mx lx iq bd ly nd ne dn mc nf ng dp mg lf nh ni mi lj nj nk mk ln nl nm mm nn bi translated">Git命令结果被赋给变量</h2><p id="c5bd" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">右上方的命令结果被分配给<code class="fe ls lt lu lv b">NEW_VERSION</code>。与取<code class="fe ls lt lu lv b">package.json</code>版本的<code class="fe ls lt lu lv b">OLD_VERSION</code>有一点不同，就是<code class="fe ls lt lu lv b">OLD_VERSION</code>数字看起来像<code class="fe ls lt lu lv b">0.1.1</code>或<code class="fe ls lt lu lv b">1.0.3</code>，而<code class="fe ls lt lu lv b">NEW_VERSION</code>看起来像<code class="fe ls lt lu lv b">v0.1.2</code>或<code class="fe ls lt lu lv b">v1.0.4</code>。它带有字母“v”。</p><h1 id="5950" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">最后一步:提交！😎</h1><p id="79de" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">一切准备就绪！现在我们将提交日志！</p><p id="297c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们跑吧</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="3627" class="mx lx iq lv b gy my mz l na nb">git commit -am "Update version from v$OLD_VERSION to $NEW_VERSION"<br/>echo "Your commit has been created succesfully"</span></pre><p id="364a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意“v”只出现在<code class="fe ls lt lu lv b">OLD_VERSION</code>之前。</p><p id="153d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">提交后，信息“您的提交…成功”将打印在终端！</p><h1 id="8fef" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">结论</h1><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="0fee" class="mx lx iq lv b gy my mz l na nb">npm run version-check 0.14.2</span></pre><p id="f00b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用Shell脚本，您可以创建一个非常简单且有用的命令管道。有时，它可能是比Node.js脚本更好的选择。</p><p id="e748" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是包含我在这篇文章中展示的所有内容的要点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><h1 id="72d6" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">参考</h1><ul class=""><li id="34a4" class="nr ns iq ky b kz mo lc mp lf nt lj nu ln nv lr nw nx ny nz bi translated"><a class="ae kv" href="https://tldp.org/LDP/Bash-Beginners-Guide/html/sect_07_01.html" rel="noopener ugc nofollow" target="_blank">外壳脚本if条件列表</a></li><li id="859d" class="nr ns iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated"><a class="ae kv" href="https://stackoverflow.com/questions/6245570/how-do-i-get-the-current-branch-name-in-git" rel="noopener ugc nofollow" target="_blank">如何获取Git分支名称？</a></li></ul></div><div class="ab cl of og hu oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="ij ik il im in"><p id="88d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="om">更多内容请看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="om">plain English . io</em></strong></a><em class="om">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="om">免费周报</em> </strong> </a> <em class="om">。关注我们关于</em><a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="om">Twitter</em></strong></a><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="om">LinkedIn</em></strong></a><em class="om"/><a class="ae kv" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="om">YouTube</em></strong></a><em class="om"/><a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="om">不和</em> </strong> </a> <em class="om">。对增长黑客感兴趣？检查</em> <a class="ae kv" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="om">电路</em> </strong> </a> <em class="om">。</em></p></div></div>    
</body>
</html>