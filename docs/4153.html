<html>
<head>
<title>Batch Updates in React 17 or Earlier Versions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React 17或更早版本中的批量更新</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/batch-updates-in-react-17-or-earlier-versions-5f76d58e3af1?source=collection_archive---------2-----------------------#2022-11-01">https://javascript.plainenglish.io/batch-updates-in-react-17-or-earlier-versions-5f76d58e3af1?source=collection_archive---------2-----------------------#2022-11-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="a338" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">对setTimeout、promises和本机事件处理程序中的多个setState()调用进行批量更新</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/152f0fc638929cef824760263a9274aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LsTaIrI_xyzCd9crD-QExQ.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@julianhochgesang?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Julian Hochgesang</a> on <a class="ae ks" href="https://unsplash.com/s/photos/batch?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9fca" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">TLDR；如果你在React 18上，那么你不需要担心批量更新，因为React 18的批量更新功能是内置的。但是如果你使用React 17或者更早的版本，你可能需要看到这个。</p><p id="f92c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">话虽如此，让我们深入了解批量更新。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="fe98" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">什么是批量更新？</h1><p id="b10b" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">React的一个特性或功能，它将多个状态更新调用批处理到一个更新中，并且只使用更新的数据呈现一次UI。</p><p id="b42d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在合成事件和钩子的情况下，React会为我们做这件事，除非我们不在任何异步函数中调用状态更新。</p><p id="47de" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下面是它的演示:</p><h1 id="74d3" class="lw lx in bd ly lz mt mb mc md mu mf mg jt mv ju mi jw mw jx mk jz mx ka mm mn bi translated">合成事件下的批量更新</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi my"><img src="../Images/2911b21a2f30d7c60fae5aa9d5360145.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xyqd35kCGQe1VBvWxU5D6g.png"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mz"><img src="../Images/cdf2a05d547a154aa19d3a03cb3d01a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gj1okllCpwNg1aJeMUea_Q.gif"/></div></div></figure></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="5457" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">挂钩下的批量更新:</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi na"><img src="../Images/1fe8dd6c9cb0ceb2bd5a5ec4995dc1a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OD1-K8fuCpNM60H6l0-avA.png"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mz"><img src="../Images/b56d035722773ee4e04cd069f55c8413.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*fsYMZjyQ-Hy4uSX4SzkShQ.gif"/></div></div></figure></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="ff60" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">但是，当在任何异步方法或任何本机事件处理程序中进行setState调用时，React不会批量更新</h1><p id="3737" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">本地事件处理程序是指使用<code class="fe nb nc nd ne b">addEventListener</code>方法添加的任何事件。</p><h1 id="f6ee" class="lw lx in bd ly lz mt mb mc md mu mf mg jt mv ju mi jw mw jx mk jz mx ka mm mn bi translated">1.setTimeOut下没有批量更新</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nf"><img src="../Images/338b38ad44e608b7d28a19ae95aeb85b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LRnV-WghD6BVliW1nhZOZg.png"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mz"><img src="../Images/8b11b49166924f6e7e4b0262480f9abb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mging1xZ4GgukwL0x0onmA.gif"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">each setState will render the component</figcaption></figure></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="0ba2" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">2.承诺下没有批量更新</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ng"><img src="../Images/8d1b0dc30eea29005ac65ee62cd082a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ykgt1tz8c44Sc2-Fx13jyA.png"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mz"><img src="../Images/1b63c6eed997ef16098e5909bc0c3ac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*y1UbNDlqVGKPROCANa2GQQ.gif"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">each setState will render the component</figcaption></figure></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="9828" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">3.本机事件处理程序中没有批量更新</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nh"><img src="../Images/8774389733c640d48e95f30973cccecd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lcT9jj6Swvux0ZkB1MWjmQ.png"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mz"><img src="../Images/2b502cecc4b4155b0fcb021086b0b59a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0QJcxeai9WDK53SG9AnpzQ.gif"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">each setState will render the component</figcaption></figure></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="fe86" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">那么，在上述所有情况下，我们如何实现批量更新呢？</h1><p id="f996" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">在这种情况下,<code class="fe nb nc nd ne b">unstable_batchedUpdates</code>会出手相救。这是作为实验特性添加的。但它确实起作用了。</p><p id="254d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> unstable_batchedUpdates </strong>是一个函数，可以从<code class="fe nb nc nd ne b">react-dom</code>导入，并带有一个回调函数。在回调函数中，我们可以调用多个状态更新，这些状态更新在最后被批处理。</p><p id="1dbc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">而在<code class="fe nb nc nd ne b">setTimeout,</code> <code class="fe nb nc nd ne b">promises,</code> <code class="fe nb nc nd ne b">native event handles</code>和<code class="fe nb nc nd ne b">inside hooks</code>里面简单的调用这个函数</p><pre class="kd ke kf kg gt ni ne nj nk aw nl bi"><span id="a291" class="nm lx in ne b gy nn no l np nq">import { unstable_batchedUpdates } from "react-dom";</span><span id="f9a3" class="nm lx in ne b gy nr no l np nq">setTimeout(()=&gt; {</span><span id="890a" class="nm lx in ne b gy nr no l np nq">    unstable_batchedUpdates(<em class="ns">()</em> =&gt; {</span><span id="f682" class="nm lx in ne b gy nr no l np nq">            setCountOne(<em class="ns">(c)</em> =&gt; c + 1);</span><span id="98fb" class="nm lx in ne b gy nr no l np nq">            setCountTwo(<em class="ns">(c)</em> =&gt; c + 1);</span><span id="3452" class="nm lx in ne b gy nr no l np nq">            // All other state updates, which will be clubbed into   one.</span><span id="c322" class="nm lx in ne b gy nr no l np nq">     });<br/>},0)</span></pre></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="ff45" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">在setTimeout内批处理多个设置状态调用</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nt"><img src="../Images/98def1a3c3b18387185bb7123b1bd614.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZW0_ynkf0RsndToOrSWUTg@2x.png"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mz"><img src="../Images/91ac33475ce106235bea3bccedacf0cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*UMh5QM2ZmcIcl_x8BhycmQ.gif"/></div></div></figure></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="8969" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated"><strong class="ak">在承诺内批处理多个setState调用</strong></h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nu"><img src="../Images/5113a27507893582983e14b74fb821a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MnEz0ixFVcpebpgNo6fREg@2x.png"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mz"><img src="../Images/2cb9fe0382fb339856fa3fb82b9987af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Un50WDUZiG0AGejPwL1JEQ.gif"/></div></div></figure></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="6c03" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">在本机事件处理程序中批处理多个设置状态调用</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nv"><img src="../Images/30bc9224a6c3edbbd31507234893ca84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rM0GiDwP5RlEYDMQsxiEzg@2x.png"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mz"><img src="../Images/727136f36914c989713efe82e83ffd77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ciKilOEyK2pskLj6nzt2DQ.gif"/></div></div></figure></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><p id="970c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">明智地使用<code class="fe nb nc nd ne b">unstable_batchedUpdates</code>，因为按照Dan Abramov的说法，这是一个不稳定的API。<br/>但是IMO对于某些情况，我们可以像这样暴露使用一样使用这个，那么我认为不会造成太大的麻烦。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><p id="cdc5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="ns">更多内容请看</em><a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="ns">plain English . io</em></strong></a><em class="ns">。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="ns">免费周报</em> </strong> </a> <em class="ns">。关注我们关于</em><a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="ns">Twitter</em></strong></a><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="ns">LinkedIn</em></strong></a><em class="ns"/><a class="ae ks" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="ns">YouTube</em></strong></a><em class="ns"/><a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="ns">不和</em> </strong> </a> <em class="ns">。对增长黑客感兴趣？检查</em> <a class="ae ks" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="ns">电路</em> </strong> </a> <em class="ns">。</em></p></div></div>    
</body>
</html>