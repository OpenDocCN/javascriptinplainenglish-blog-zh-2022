<html>
<head>
<title>How to Integrate Google ReCaptcha v3 Correctly in 2022?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">2022年如何正确整合Google ReCaptcha v3？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/hahow-to-integrate-google-recaptcha-v3-correctly-in-2022-15a4fd186d7?source=collection_archive---------8-----------------------#2022-04-06">https://javascript.plainenglish.io/hahow-to-integrate-google-recaptcha-v3-correctly-in-2022-15a4fd186d7?source=collection_archive---------8-----------------------#2022-04-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="11d1" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">防止垃圾邮件的解决方案。</h2></div><p id="4e3c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Google Recaptcha是解决垃圾邮件问题的行业标准方法之一。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/913c589af491a26df4b7c07f5fca7bfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zlbymJaj6yKLnUhT"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Google Recaptcha</figcaption></figure><h2 id="532c" class="lo lp in bd lq lr ls dn lt lu lv dp lw kl lx ly lz kp ma mb mc kt md me mf mg bi translated">什么是垃圾邮件？</h2><p id="61f8" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">垃圾邮件又称“垃圾邮件”,是指不请自来的电子邮件，通常发送给大量收件人电子邮件用户。该收件人的电子邮件地址被攻击者窃取或购买，用于金钱盗窃或商业目的，具体取决于攻击者的目的。</p><p id="34c7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这些电子邮件大部分时间都隐藏着不应该打开的恶意软件，如果有人打开他们的邮件并点击链接，就会成为这些攻击者的受害者。</p><p id="d52a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">例如</strong>垃圾邮件的源头——</p><ol class=""><li id="844d" class="mm mn in ke b kf kg ki kj kl mo kp mp kt mq kx mr ms mt mu bi translated">网站上的登录、注册和重置密码表单</li><li id="1222" class="mm mn in ke b kf mv ki mw kl mx kp my kt mz kx mr ms mt mu bi translated">博客中的评论和联系我们部分</li></ol><p id="c6e4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">有四种类型的谷歌ReCaptcha——</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi na"><img src="../Images/15c773bdc26fe46b7d3ebfc368064c48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qNIjUOqlnHTeSnx5"/></div></div></figure><p id="6887" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文中，我们将集成最新的google ReCaptcha v3。</p><p id="fe48" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你已经在使用Google Recaptcha v2，并且想升级到Google Recaptcha v3，你可以阅读Google文档，这非常简单。</p></div><div class="ab cl nb nc hr nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ig ih ii ij ik"><h1 id="4b4f" class="ni lp in bd lq nj nk nl lt nm nn no lw jt np ju lz jw nq jx mc jz nr ka mf ns bi translated">集成Google Recaptcha V3的步骤</h1><h2 id="4280" class="lo lp in bd lq lr ls dn lt lu lv dp lw kl lx ly lz kp ma mb mc kt md me mf mg bi translated">第一步。在ReCaptcha admin上注册您的网站</h2><p id="c33b" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">首先，我们需要在<a class="ae nt" href="https://www.google.com/recaptcha/admin/site/" rel="noopener ugc nofollow" target="_blank"> ReCaptcha管理控制台</a>上注册网站。</p><p id="2225" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">看起来是这样的——</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nu"><img src="../Images/e6db26ae4132f87bdc14621d46c13161.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ipzAMnRMLLB3cjnf"/></div></div></figure></div><div class="ab cl nb nc hr nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ig ih ii ij ik"><h1 id="0a26" class="ni lp in bd lq nj nk nl lt nm nn no lw jt np ju lz jw nq jx mc jz nr ka mf ns bi translated">第二步。客户端集成</h1><p id="84f5" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">在管理控制台上注册网站后，记下reCAPTCHA键。</p><p id="a178" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在上图中，你一定看到了reCaptcha键。</p><p id="9631" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> ReCaptcha给出2个键-</strong></p><p id="3169" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> 1。站点密钥— </strong>这是公共密钥，用于客户端集成。<br/>2<strong class="ke io">2。秘钥— </strong>这是私钥，不能暴露给任何人。这应该安全地存储在您的后端服务器中。</p><p id="b669" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们从客户端集成开始</p><h2 id="a868" class="lo lp in bd lq lr ls dn lt lu lv dp lw kl lx ly lz kp ma mb mc kt md me mf mg bi translated">1.用您的站点密钥加载JavaScript API</h2><pre class="kz la lb lc gt nv nw nx ny aw nz bi"><span id="bb45" class="lo lp in nw b gy oa ob l oc od">&lt;script src="https://www.google.com/recaptcha/api.js?render=&lt;site_key&gt;"&gt;&lt;/script&gt;</span></pre><p id="f7c2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在上面的代码中，您将传递实际的Recaptcha站点密钥来代替<site_key/></p><p id="c426" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">例如，如果Recaptcha站点密钥是<strong class="ke io"> sdfjhjk124jkhk </strong></p><p id="af9f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你就当<strong class="ke io">通过？render=sdfjhjk124jkhk </strong></p><h2 id="8979" class="lo lp in bd lq lr ls dn lt lu lv dp lw kl lx ly lz kp ma mb mc kt md me mf mg bi translated">2.对您希望保护的每个动作调用“grecaptcha.execute”</h2><pre class="kz la lb lc gt nv nw nx ny aw nz bi"><span id="a6af" class="lo lp in nw b gy oa ob l oc od">&lt;script&gt;<br/>    function onClick(e) {<br/>        e.preventDefault();<br/>        grecaptcha.ready(function() {<br/>            grecaptcha.execute('reCAPTCHA_site_key', {action: 'submit'}).then(function(token) {<br/>                // Add your logic to submit to your backend server here.<br/>            });<br/>        });<br/>    }<br/>&lt;/script&gt;</span></pre><p id="d9d7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">无论您希望保护哪个输入框，它可能是您的注册、登录或其他字段，您都需要更新点击处理程序，与上面类似。</p><p id="d7a2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以看到上面的代码，我们将实际的Recaptcha站点密钥和一个回调函数传递给grecaptcha.execute函数。</p><p id="2744" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当回调被执行时，我们得到了其中的令牌。这个令牌需要立即传递给后端服务器来获取用户分数。</p></div><div class="ab cl nb nc hr nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ig ih ii ij ik"><h2 id="427b" class="lo lp in bd lq lr ls dn lt lu lv dp lw kl lx ly lz kp ma mb mc kt md me mf mg bi translated">3.立即向您的后端发送令牌并请求验证</h2><p id="fcb5" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">这将触发服务器端流。</p></div><div class="ab cl nb nc hr nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ig ih ii ij ik"><h1 id="7bfc" class="ni lp in bd lq nj nk nl lt nm nn no lw jt np ju lz jw nq jx mc jz nr ka mf ns bi translated">第二步。服务器端集成</h1><p id="e221" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">利用客户机传递的令牌和已经存储在服务器端的Recaptcha密钥，后端将调用google site-verify api。</p><p id="fe6d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">google site-verify API返回一个介于0.0到1.0之间的分数。我们还设置了一个阈值分数，默认值为0.5，达到该值时，我们将允许用户发出请求。</p><p id="c958" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果分数小于阈值分数，我们可以说用户不是人类，而是机器人。如果分数&gt;阈值分数，则用户是人类，并且允许点击的实际功能。</p></div><div class="ab cl nb nc hr nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ig ih ii ij ik"><h2 id="8980" class="lo lp in bd lq lr ls dn lt lu lv dp lw kl lx ly lz kp ma mb mc kt md me mf mg bi translated">请求端点</h2><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nu"><img src="../Images/467c18976cdd9db700afeb6624cabe34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gQVqZTzBsgerxqd4"/></div></div></figure><h2 id="75a2" class="lo lp in bd lq lr ls dn lt lu lv dp lw kl lx ly lz kp ma mb mc kt md me mf mg bi translated">站点验证响应</h2><p id="8910" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">响应是一个JSON对象。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nu"><img src="../Images/efd669117a79cf0198ec630a215b1829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MOSv-On5sDeosWF2"/></div></div></figure></div><div class="ab cl nb nc hr nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ig ih ii ij ik"><h1 id="bc7e" class="ni lp in bd lq nj nk nl lt nm nn no lw jt np ju lz jw nq jx mc jz nr ka mf ns bi translated">挑战</h1><p id="70b1" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">在StackOverflow上，我在搜索一些关于ReCaptcha的东西，发现大多数人都没有正确地实现它。</p><p id="42b8" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">他们从服务器端获得分数，并在客户端比较分数和阈值，这是完全错误的。</p><p id="7b0e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">例如下面的实现是错误的</strong></p><pre class="kz la lb lc gt nv nw nx ny aw nz bi"><span id="f82c" class="lo lp in nw b gy oa ob l oc od">&lt;script&gt;<br/>    function onClick(e) {<br/>        e.preventDefault();<br/>        grecaptcha.ready(function() {<br/>            grecaptcha.execute('reCAPTCHA_site_key', {action: 'submit'}).then(function(token) {<br/>                var score = fetchScoreFromAPI(token);<br/>                if (score &gt; THRESHOLD_SCORE) {<br/>                    callCommentApi();<br/>                }<br/>            });<br/>        });<br/>    }<br/>&lt;/script&gt;</span></pre><p id="f784" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上述不正确的原因是-</p><ol class=""><li id="8a29" class="mm mn in ke b kf kg ki kj kl mo kp mp kt mq kx mr ms mt mu bi translated">客户端从不进行验证</li><li id="a348" class="mm mn in ke b kf mv ki mw kl mx kp my kt mz kx mr ms mt mu bi translated">攻击者可以轻松地操纵分数，查看comment API端点，并向其发送大量未经请求的电子邮件。</li></ol><p id="353c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">下面是正确的实现——</strong></p><pre class="kz la lb lc gt nv nw nx ny aw nz bi"><span id="e933" class="lo lp in nw b gy oa ob l oc od">&lt;script&gt;<br/>    function onClick(e) {<br/>        e.preventDefault();<br/>        grecaptcha.ready(function() {<br/>            grecaptcha.execute('reCAPTCHA_site_key', {action: 'submit'}).then(function(token) {<br/>                callCommentAPI(token);<br/>            });<br/>        });<br/>    }<br/>&lt;/script&gt;<br/><br/>// At server side<br/>function callCommentAPI(token){<br/>    var score = fetchScoreFromAPI(token);<br/>    if (score &gt; THRESHOLD_SCORE) {<br/>        // execute logic for comment API<br/>    }<br/>}</span></pre><p id="53d3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，我们只是将令牌传递给现有的API，验证在服务器端完成，这是更安全和正确的方式。</p><p id="17a6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此外，您可以注意到，即使comment API URL是公开的，但它不会收到垃圾邮件，因为它首先检查分数。</p></div><div class="ab cl nb nc hr nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ig ih ii ij ik"><h1 id="d1b8" class="ni lp in bd lq nj nk nl lt nm nn no lw jt np ju lz jw nq jx mc jz nr ka mf ns bi translated">摘要</h1><p id="28aa" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">我希望你学到了新的东西。让我知道你是否认为你能以不同的方式解决它，或者这篇文章是否有问题。</p><p id="1b21" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你喜欢这篇文章，请分享这篇文章并<strong class="ke io">关注我</strong>。</p><p id="47cc" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请阅读我的其他受欢迎的文章</p><ol class=""><li id="0999" class="mm mn in ke b kf kg ki kj kl mo kp mp kt mq kx mr ms mt mu bi translated"><a class="ae nt" href="https://weekendtutorial.com/nginx-tutorial/" rel="noopener ugc nofollow" target="_blank"> Nginx教程</a></li><li id="5de9" class="mm mn in ke b kf mv ki mw kl mx kp my kt mz kx mr ms mt mu bi translated"><a class="ae nt" href="https://weekendtutorial.com/browser-storage-in-detail-part-1/" rel="noopener ugc nofollow" target="_blank">浏览器存储</a></li></ol><p id="002a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">就这些了，下次再见吧。</p><p id="7eda" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="oe">更多内容请看</em><a class="ae nt" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="oe">plain English . io</em></strong></a><em class="oe">。报名参加我们的</em> <a class="ae nt" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="oe">免费周报</em> </strong> </a> <em class="oe">。关注我们关于</em><a class="ae nt" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="oe">Twitter</em></strong></a><em class="oe">和</em><a class="ae nt" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="oe">LinkedIn</em></strong></a><em class="oe">。加入我们的</em> <a class="ae nt" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> <em class="oe">社区不和谐</em> </strong> </a> <em class="oe">。</em></p></div></div>    
</body>
</html>