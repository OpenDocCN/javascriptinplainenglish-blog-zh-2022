<html>
<head>
<title>Consume APIs in React the Right Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以正确的方式使用API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/connect-react-application-to-your-api-backend-18fb76172b36?source=collection_archive---------5-----------------------#2022-08-07">https://javascript.plainenglish.io/connect-react-application-to-your-api-backend-18fb76172b36?source=collection_archive---------5-----------------------#2022-08-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="af39" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">在React应用程序中发出API请求的一种可靠且可伸缩的方式是连接到您的(REST) API后端。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/d6c15be2c24a489ad3b101bca582b9db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fns3RfPBwI8deAY7GC35Zg.png"/></div></div></figure><p id="bdd9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在构建React应用程序时，您很可能希望连接到(REST) API后端来获取和更新数据。这可以通过在正确的生命周期方法中调用“fetch()”来轻松实现。但是以可伸缩和易于使用的方式集成API是另一回事。</p><p id="3248" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">例如，在执行身份验证时，经常需要为每个请求传递一个API令牌。不得不手动构造每个请求、设置报头等。，并且传递API令牌，可能是一件很麻烦的事情。此外，您需要一遍又一遍地编写相同的代码。</p><p id="01ea" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这篇文章将教你如何构建连接到API后端的可扩展前端基础设施，包括以集中的方式处理认证和翻译错误(后者将在以后的文章中讨论)。</p><p id="4676" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了让您对我们正在构建的东西有一些直觉，我们将从一个如何使用后端连接的例子开始。下面，我们将构建一个StartPage组件，如果用户通过了身份验证，它将显示一条欢迎消息以及所有用户的博客文章，否则将显示登录页面的链接。博客文章在这里将由一些简单的文本模拟。</p><p id="86a9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">注意:要与代码互动，请阅读我主页上的文章:<a class="ae lk" href="https://schneider-lukas.com/blog/react-connect-rest-api" rel="noopener ugc nofollow" target="_blank">https://schneider-lukas.com/blog/react-connect-rest-api</a>。</p><p id="fc19" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在<a class="ae lk" href="https://schneider-lukas.com/blog/react-connect-rest-api#code-intro.8" rel="noopener ugc nofollow" target="_blank">的第8行</a>中，我们使用自定义的<em class="ll"> useAPI() </em>钩子来访问用户对象和<em class="ll"> fetchPosts() </em>函数。我们可以使用用户对象来检查用户是否被认证(就像在<a class="ae lk" href="https://schneider-lukas.com/blog/react-connect-rest-api#code-intro.11" rel="noopener ugc nofollow" target="_blank">第11行</a>和<a class="ae lk" href="https://schneider-lukas.com/blog/react-connect-rest-api#code-intro.27" rel="noopener ugc nofollow" target="_blank">第27行</a>中所做的那样)。再往下，在<a class="ae lk" href="https://schneider-lukas.com/blog/react-connect-rest-api#code-intro.15" rel="noopener ugc nofollow" target="_blank">行的第15 </a>行，我们使用<em class="ll"> fetchPosts() </em>函数为用户获取文章列表。如果出现错误，只需显示翻译后的错误消息即可。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lm"><img src="../Images/89e9e2e338b11747bec8d6d88c7abab7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-smhUQN4leOFbQrBizwrLA.jpeg"/></div></div></figure><p id="c542" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在，首先，我们将创建一个React上下文对象。上下文允许我们通过组件树传递数据，并在React应用程序中的任何地方访问它。你可以在https://reactjs.org/docs/context.html阅读更多关于React的内容。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lm"><img src="../Images/01277e970375d57f8c0d179050219b7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fRlIl1k4pF94Hu6UWOlYIw.jpeg"/></div></div></figure><p id="2b75" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">接下来，我们将创建一个自定义上下文提供程序。提供者保存所需的应用程序状态，并执行初始化和清理。出于我们的目的，我们存储一个访问令牌来根据API进行身份验证，并存储一个用户对象来保存关于当前已通过身份验证的用户的一些基本信息。访问令牌稍后可以由某个登录组件来设置(这里我们不会构建)。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lm"><img src="../Images/dcfa03b3efaa54b072e1f2afab12b474.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l4-C7jOj4LaYZzR_o-lCsg.jpeg"/></div></div></figure><p id="cbef" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了向API发出请求，我们构建了一个定制的<em class="ll"> makeRequest() </em>函数。该函数处理设置所有正确的请求参数、发出请求以及处理一些基本错误。为了提出请求，我们将使用Axios库，你可以在https://axios-http.com的<a class="ae lk" href="https://axios-http.com" rel="noopener ugc nofollow" target="_blank">了解更多信息。</a></p><p id="8611" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们首先在<a class="ae lk" href="https://schneider-lukas.com/blog/react-connect-rest-api#code-makeRequest.16-18" rel="noopener ugc nofollow" target="_blank">的第16行到第18行</a>中构建请求URI，方法是将路由(例如“/user”)附加到基本URI。这样，我们就有了一个集中的URI基地。然后我们在第20到25行中设置请求头。这包括授权头，我们通过它将访问令牌传递给API。如果您的API中的身份验证工作方式不同，那么您可以在<em class="ll"> makeRequest </em>函数中配置所需的行为。在<a class="ae lk" href="https://schneider-lukas.com/blog/react-connect-rest-api#code-makeRequest.27" rel="noopener ugc nofollow" target="_blank">第27行</a>中，我们构造了要传递给axios的options对象，在<a class="ae lk" href="https://schneider-lukas.com/blog/react-connect-rest-api#code-makeRequest.31" rel="noopener ugc nofollow" target="_blank">第31行</a>中，我们最终发出了API请求。如果API请求失败，我们可以处理第33到39行中的错误。这也是我们稍后将为API错误添加翻译的地方。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ln"><img src="../Images/c1558b24e7c501e5f51e8a9ebb9bb10b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nnrWC4DMP3Rg3Jc0q7aLbg.jpeg"/></div></div></figure><p id="635d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">一旦我们创建了<em class="ll"> makeRequest() </em>函数，我们就可以开始创建查询API端点的函数了。我们从一个针对API进行身份验证的函数开始。这个函数应该向API发送一个用户名和密码，如果它们有效，则返回一个用于进一步请求的访问令牌以及一些关于已验证用户的数据。实现非常简单，更像是对之前定义的<em class="ll"> makeRequest() </em>函数的包装。我们希望为我们的每个API端点创建这样的包装器。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lm"><img src="../Images/56592f4d77c32c49f0e8832a178b26d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zOhjZEnZ-rvjvLuQ4Srs2Q.jpeg"/></div></div></figure><p id="0222" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们还创建了一个函数来获取给定用户的一些帖子。注意我们如何在<a class="ae lk" href="https://schneider-lukas.com/blog/react-connect-rest-api#code-fetchPosts.10" rel="noopener ugc nofollow" target="_blank">第10行</a>中使用<em class="ll">参数</em>而不是<em class="ll">数据</em>。这是因为我们正在发出一个GET请求，并且必须相应地指定要传递的数据。在用于React Native的IOS设备上，这是一个常见的错误来源，因为在GET请求上指定主体是无效的，并且会导致操作系统中止请求。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lm"><img src="../Images/4afc92b908f7bca6f87fb1121bbd0f51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FrK4T7TNQbUJ_Pl1oMzo8Q.jpeg"/></div></div></figure><p id="8523" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">需要的最后一个功能是上下文消费者。这个函数确保所有的请求函数都连接到API上下文，因此可以访问访问令牌、用户以及您想要添加的任何内容。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lm"><img src="../Images/9680cd945301950dd038c73787a5deeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N8_ltKcwnfQ3qgWLVPjAug.jpeg"/></div></div></figure><p id="d340" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">最后，不要忘记将提供者组件添加到组件树中。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lm"><img src="../Images/73f2a840d23dd31689b70f6d4bdfb6f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FNPNG9Oz4zOBg_CXWjuWLQ.jpeg"/></div></div></figure><p id="4908" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">就这样，现在你有了一个到后端的工作连接，你可以使用它，如介绍性示例中的<a class="ae lk" href="https://schneider-lukas.com/blog/react-connect-rest-api#code-intro" rel="noopener ugc nofollow" target="_blank">所示。如果您希望在未来对基础架构进行更改，添加功能或更改端点，这将非常容易，因为所有代码都是集中的。</a></p></div><div class="ab cl lo lp hr lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ig ih ii ij ik"><p id="412e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="ll">最初发表于</em><a class="ae lk" href="https://schneider-lukas.com/blog/react-connect-rest-api" rel="noopener ugc nofollow" target="_blank"><em class="ll">https://schneider-lukas.com</em></a><em class="ll">。</em></p></div><div class="ab cl lo lp hr lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ig ih ii ij ik"><p id="d630" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="ll">更多内容请看</em> <a class="ae lk" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="ll">说白了就是</em> </strong> </a> <em class="ll">。报名参加我们的</em> <a class="ae lk" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="ll">免费每周简讯</em> </strong> </a> <em class="ll">。关注我们关于</em> <a class="ae lk" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="ll">推特</em> </strong> </a>，<a class="ae lk" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="ll">LinkedIn</em></strong></a><em class="ll">，</em><a class="ae lk" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="ll">YouTube</em></strong></a><em class="ll"/><a class="ae lk" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="ll">不和</em> </strong> </a> <em class="ll">。</em></p></div></div>    
</body>
</html>