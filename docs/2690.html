<html>
<head>
<title>iOS Guide to TurboModules in React-Native for Early Adopters</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向早期采用者的React-Native turbo modules iOS指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/ios-guide-to-turbomodules-in-react-native-for-early-adopters-8b2e9ab66852?source=collection_archive---------2-----------------------#2022-06-27">https://javascript.plainenglish.io/ios-guide-to-turbomodules-in-react-native-for-early-adopters-8b2e9ab66852?source=collection_archive---------2-----------------------#2022-06-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="a5e3" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">在React-Native中提前了解涡轮模块和代码</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/dd9b4cab9e3a22bba566d16d44709d14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rM53csaoDwCUUV5xrLznaw.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk"><a class="ae ks" href="https://www.pexels.com/photo/space-gray-iphone-8-818043/" rel="noopener ugc nofollow" target="_blank">Photo by Tuur Tisseghem</a></figcaption></figure><h2 id="03f9" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated"><strong class="ak">简介</strong></h2><p id="d380" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">在上一篇文章中，我们在Android 中实现并启用了<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/android-guide-to-turbomodules-in-react-native-for-early-adopters-b07f3e23fd1c"> TurboModules。如果你还没有完成那个博客，你需要在开始这个博客之前回去完成它。前一篇文章包含了您需要在TypeScript代码中完成的附加说明。本文将讨论如何在iOS中启动和运行。像往常一样，如果你遇到困难，你可以点击这里查看GitHub repo。如果你喜欢视觉学习，你可能想看看我在YouTube上关于这个主题的教程。简要回顾一下上一篇文章，我们正在构建下面的应用程序，它可以使用TurboModule调用原生层并打印一条消息。</a></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/935759573b718867996ed2a328bcf985.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*EBhemgVaWY7JB_8QWx39mQ.gif"/></div></figure><h2 id="837a" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">更新我们的package.json</h2><p id="66cd" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">iOS需要在React端增加一个额外的步骤来启动和运行。iOS不像<code class="fe mj mk ml mm b">gradle</code>那样能够找到文件夹，所以我们需要在<code class="fe mj mk ml mm b">package.json</code>中指定Spec文件的路径。您可以通过在文件末尾添加以下代码来实现这一点:</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="6a5b" class="kt ku in mm b gy mr ms l mt mu">"codegenConfig": {<br/>  "libraries": [{<br/>    "name": "NativeSampleModule",<br/>    "type": "modules",<br/>    "jsSrcsDir": "./js"<br/>  }]<br/>}</span></pre><h2 id="f30f" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">在iOS上启用Codegen</h2><p id="afd6" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">接下来，我们需要在iOS上启用新的架构。你可以在Xcode中打开<code class="fe mj mk ml mm b">ios</code>文件夹，然后进入构建设置。在Apple Clang-Custom Compiler Flags下找到Other C++ Flags一节，添加<code class="fe mj mk ml mm b">-DRCT_NEW_ARCH_ENABLED=1</code>。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mv"><img src="../Images/1a8d5026e6a410258fdbaac60a5e1c33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sAu2PWF4ESZBayJJ5A3RXw.png"/></div></div></figure><p id="9f20" class="pw-post-body-paragraph lp lq in lr b ls mw jo lu lv mx jr lx lc my lz ma lg mz mc md lk na mf mg mh ig bi translated">我们现在必须运行一个特殊的<code class="fe mj mk ml mm b">pod install</code>命令来处理新架构中的所有事情:</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="081e" class="kt ku in mm b gy mr ms l mt mu">RCT_NEW_ARCH_ENABLED=1 pod install</span></pre><p id="ae18" class="pw-post-body-paragraph lp lq in lr b ls mw jo lu lv mx jr lx lc my lz ma lg mz mc md lk na mf mg mh ig bi translated">您应该会看到许多新的架构库正在安装。</p><h2 id="8927" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">将Objective-C连接到React-Native</h2><p id="a036" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">现在一切都已启用，我们可以继续编写我们的本机代码了。我们首先将一个<code class="fe mj mk ml mm b">Podspec</code>文件添加到<code class="fe mj mk ml mm b">js</code>文件夹中。我们这样做是因为Cocoapods用于管理TurboModule生态系统，iOS需要知道您正在安装一个模块。调用文件<code class="fe mj mk ml mm b">NativeSampleModule.podspec</code>，复制粘贴以下内容:</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="2bc5" class="kt ku in mm b gy mr ms l mt mu">folly_version = '2021.06.28.00-v2'</span><span id="be83" class="kt ku in mm b gy nb ms l mt mu">folly_compiler_flags = "-DFOLLY_NO_CONFIG -DFOLLY_MOBILE=1 -DFOLLY_USE_LIBCPP=1 -Wno-shorten-64-to-32"</span><span id="0eb5" class="kt ku in mm b gy nb ms l mt mu">Pod::Spec.new do |s|<br/>  s.name = "NativeSampleModule"<br/>  s.version = "0.0.1"<br/>  s.summary = "NativeSampleModule"<br/>  s.description = "NativeSampleModule"<br/>  s.homepage = ""<br/>  s.license = "MIT"<br/>  s.platforms = { :ios =&gt; "11.0"}<br/>  s.author = ""<br/>  s.source = { :git =&gt; "https://github.com/facebook/react-native.git", :tag =&gt; "#{s.version}"}<br/>  s.source_files = "./**/*.{h,m,mm,swift}"<br/>  s.compiler_flags = folly_compiler_flags<br/>  s.pod_target_xcconfig = {<br/>    "HEADER_SEARCH_PATHS" =&gt; "\"$(PODS_ROOT)/boost\""<br/>  }<br/>  s.dependancy "React"<br/>  s.dependancy "React-RCTFabric"<br/>  s.dependancy "React-Codegen"<br/>  s.dependancy "RCT-Folly", folly_version<br/>  s.dependancy "RCTRequired"<br/>  s.dependancy "RCTTypeSafety"<br/>  s.dependancy "ReactCommon/turbomodule/core"<br/>end</span></pre><p id="3de3" class="pw-post-body-paragraph lp lq in lr b ls mw jo lu lv mx jr lx lc my lz ma lg mz mc md lk na mf mg mh ig bi translated">现在，如果我们再次运行<code class="fe mj mk ml mm b">RCT_NEW_ARCH_ENABLED=1 pod install</code>，我们应该能够为Objective-C生成绑定。如果您看到类似这样的内容，这意味着Codegen成功了:</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="17c1" class="kt ku in mm b gy mr ms l mt mu">[Codegen] &gt;&gt;&gt;&gt;&gt; Processing NativeSampleModule</span><span id="9b64" class="kt ku in mm b gy nb ms l mt mu">[Codegen] Generated schema: /var/folders/70/796_sfnj3xn48tzsx0tzz4g80000gn/T/NativeSampleModuleJbRobp/schema.json</span><span id="67f0" class="kt ku in mm b gy nb ms l mt mu">[Codegen] Generated artifacts: TurboModuleSampleProject/ios/build/generated/ios/NativeSampleModule</span></pre><p id="dab5" class="pw-post-body-paragraph lp lq in lr b ls mw jo lu lv mx jr lx lc my lz ma lg mz mc md lk na mf mg mh ig bi translated">回到Xcode，右键单击项目并选择将文件添加到TurboModuleExampleProject:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/687b4b1fa51e873b9bd0c038f9b2669c.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*Pm05zL0Ap4mOop46_EPkWg.png"/></div></figure><p id="1826" class="pw-post-body-paragraph lp lq in lr b ls mw jo lu lv mx jr lx lc my lz ma lg mz mc md lk na mf mg mh ig bi translated">接下来查找ios &gt;构建&gt;生成&gt; ios &gt; NativeSampleModule。确保选中创建组，然后单击添加:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nd"><img src="../Images/983b03b42a1bb7213d23693a8fbcf420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5RAG9B9_EJldn7BR9KrOsg.png"/></div></div></figure><p id="ff72" class="pw-post-body-paragraph lp lq in lr b ls mw jo lu lv mx jr lx lc my lz ma lg mz mc md lk na mf mg mh ig bi translated">此时，您应该看到TurboModuleSampleProject下的NativeSampleModule包:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/11a5607e6ba6a87c783f9baf6c076fe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*NGcNYT3uWXlpWgLklEJx-A.png"/></div></figure><p id="1ac0" class="pw-post-body-paragraph lp lq in lr b ls mw jo lu lv mx jr lx lc my lz ma lg mz mc md lk na mf mg mh ig bi translated">现在创建一个头文件和一个名为RCTNativeSampleModule的Objective-C++文件。在头文件中，您需要添加以下代码:</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="ec0b" class="kt ku in mm b gy mr ms l mt mu">#ifndef RCTNativeSampleModule_h<br/>#define RCTNativeSampleModule_h</span><span id="f68c" class="kt ku in mm b gy nb ms l mt mu">#include "NativeSampleModule.h"</span><span id="a1fd" class="kt ku in mm b gy nb ms l mt mu"><strong class="mm io">@interface</strong> NativeSampleModule : NSObject&lt;NativeSampleModuleSpec&gt;<br/><strong class="mm io">@end</strong></span><span id="21ee" class="kt ku in mm b gy nb ms l mt mu">#endif /* RCTNativeSampleModule_h */</span></pre><p id="f7f9" class="pw-post-body-paragraph lp lq in lr b ls mw jo lu lv mx jr lx lc my lz ma lg mz mc md lk na mf mg mh ig bi translated">最后，让我们通过在Objective-C++文件中创建方法来结束工作。RCTNativeSampleModule.mm的内容应该如下所示:</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="b7f9" class="kt ku in mm b gy mr ms l mt mu">#import &lt;Foundation/Foundation.h&gt;</span><span id="e2f5" class="kt ku in mm b gy nb ms l mt mu">#include "RCTNativeSampleModule.h"</span><span id="ad93" class="kt ku in mm b gy nb ms l mt mu"><strong class="mm io">@implementation</strong> NativeSampleModule<br/>RCT_EXPORT_MODULE()</span><span id="fcb2" class="kt ku in mm b gy nb ms l mt mu">- (std::shared_ptr&lt;facebook::react::TurboModule&gt;)getTurboModule:(<strong class="mm io">const</strong> facebook::react::ObjCTurboModule::InitParams &amp;)params {<br/>  <strong class="mm io">return</strong> std::make_shared&lt;facebook::react::NativeSampleModuleSpecJSI&gt;(params);<br/>}</span><span id="e6d0" class="kt ku in mm b gy nb ms l mt mu">- (NSString *)getHelloWorld:(NSString *)first second:(NSString *)second {<br/>  <strong class="mm io">return</strong> [NSString stringWithFormat:@"HelloWorld %@ %@", first, second];<br/>}</span><span id="c06a" class="kt ku in mm b gy nb ms l mt mu"><strong class="mm io">@end</strong></span></pre><p id="c850" class="pw-post-body-paragraph lp lq in lr b ls mw jo lu lv mx jr lx lc my lz ma lg mz mc md lk na mf mg mh ig bi translated">现在，如果你用<code class="fe mj mk ml mm b">yarn ios</code>编译，我们应该可以点击按钮，看到警告信息。</p><h2 id="41a2" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">结论</h2><p id="974c" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">这就是React-Native中对涡轮模块的介绍。我很高兴这个架构能够使用这些更好的工具来调用本地代码。下次见，黑客快乐！</p><p id="e687" class="pw-post-body-paragraph lp lq in lr b ls mw jo lu lv mx jr lx lc my lz ma lg mz mc md lk na mf mg mh ig bi translated"><em class="nf">更多内容尽在</em> <a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lr io"> <em class="nf">说白了. io </em> </strong> </a> <em class="nf">。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lr io"> <em class="nf">免费周报</em> </strong> </a> <em class="nf">。关注我们关于</em> <a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="lr io"> <em class="nf">推特</em> </strong> </a> <em class="nf">和</em><a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="lr io"><em class="nf">LinkedIn</em></strong></a><em class="nf">。查看我们的</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="lr io"> <em class="nf">社区不和谐</em> </strong> </a> <em class="nf">加入我们的</em> <a class="ae ks" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="lr io"> <em class="nf">人才集体</em> </strong> </a> <em class="nf">。</em></p></div></div>    
</body>
</html>