<html>
<head>
<title>Understand Google reCAPTCHA with Diagrams and Code Examples</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过图表和代码示例理解Google reCAPTCHA</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/understand-google-recaptcha-with-diagrams-and-code-examples-81fc833643a5?source=collection_archive---------4-----------------------#2022-12-11">https://javascript.plainenglish.io/understand-google-recaptcha-with-diagrams-and-code-examples-81fc833643a5?source=collection_archive---------4-----------------------#2022-12-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="6373" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">代码示例是用React、TypeScript和Node.js编写的</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/199134f3bbca29cd1883a93b37c6dd24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FZy9s2_TH7WHdvIY"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@ekrull?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Eric Krull</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9ca2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">即使在2022年，reCAPTCHA发明以来的十多年里，我发现如果这是第一次看它，理解Google reCAPTCHA如何工作并与web应用程序集成仍然不是非常简单，这要感谢最少的官方文件。</p><p id="313e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在大量的阅读、挖掘和反复试验之后，我想我终于理解了它，但是我也相信对于新手来说应该有一种更容易的方法来掌握它，这种方法应该包含清晰的图表和简单的代码示例。</p><p id="394c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这就是我写这篇文章的原因——为那些想更容易、更快地了解Google reCAPTCHA的人做一个垫脚石。</p><h1 id="76eb" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">基础</h1><p id="5097" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">要讨论Google reCAPTCHA，我们需要从一个更基本的概念开始——<strong class="jm io">CAPTCHA。</strong></p><p id="d6a9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> CAPTCHA </strong>代表<strong class="jm io"/><em class="mc">完全自动化的公共图灵测试，以区分计算机和人类</em>【1】，这是一种常用的方法，用来阻止机器人执行帐户注册等动作。</p><p id="5f1a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如，你可能已经在许多网站上注册或登录时看到过类似下面的东西，它要求你输入从图像中识别的字符。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi md"><img src="../Images/bd473aa1bf0e55b018513d1a712cc4cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*at6hFa8ksK_8iyIOEefWtQ.jpeg"/></div></figure><p id="8a93" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然而，强迫用户阅读和输入字符是一种摩擦和干扰，智能机器人可能能够轻松识别那些扭曲的字母，然后通过测试。</p><p id="34b0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，更先进的测试方法被引入来对抗僵尸程序，而<strong class="jm io"> Google reCAPTCHA </strong>是最受欢迎的解决方案。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi me"><img src="../Images/02e43a27d0a0620f8da2db1128fb7610.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_8b41-5lNTUtLuqgEi3Hgw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><a class="ae ky" href="https://trends.builtwith.com/widgets/captcha" rel="noopener ugc nofollow" target="_blank">https://trends.builtwith.com/widgets/captcha</a></figcaption></figure><h1 id="7591" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">了解不同版本的Google reCAPTCHA</h1><p id="dfe6" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">当步入Google reCAPTCHA的世界时，你将面临一个直接的挑战，那就是从树的可用选项中选择一个选项[2]:</p><ul class=""><li id="d1f3" class="mf mg in jm b jn jo jr js jv mh jz mi kd mj kh mk ml mm mn bi translated">reCAPTCHA v2(“我不是机器人”复选框)</li><li id="8e70" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated">reCAPTCHA v2(隐形reCAPTCHA徽章)</li><li id="3eff" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated">reCAPTCHA v3</li></ul><p id="cbfd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">可惜官方文件只有简介，把深潜的快乐留给了想了解更多的我们。</p><h2 id="fd96" class="mt la in bd lb mu mv dn lf mw mx dp lj jv my mz ln jz na nb lr kd nc nd lv ne bi translated">reCAPTCHA v2(“我不是机器人”复选框)</h2><p id="2035" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">首先，让我们假设我们有一个这样的注册屏幕:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/f2ce8e4a95c49d8f6c4d0ae808eb6701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UU-2iG5jhV2nqDtwwjG7Ew.png"/></div></div></figure><p id="ebdb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们希望流程是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/0ff83075d24c9534dada6e121cd09460.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vb69w9IJON0_jNwqy9e_jA.png"/></div></div></figure><p id="a1af" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">“图像选择挑战”是一个弹出窗口，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/d01df784f8456ae750f016661251f457.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uZ2BXRG8shU6WmQE8f300w.png"/></div></div></figure><p id="88ef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">理解流程“如何”和“为什么”工作的关键是幕后的一个<strong class="jm io">令牌</strong>:</p><ul class=""><li id="bdf5" class="mf mg in jm b jn jo jr js jv mh jz mi kd mj kh mk ml mm mn bi translated">当你点击“我不是一个机器人”，reCaptcha会检查你是否有可能是一个机器人</li><li id="d11e" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated">如果reCAPTCHA认为你不可能是机器人，那么它会给你一个<strong class="jm io">令牌</strong></li><li id="0357" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated">如果reCAPTCHA认为你可能是一个机器人，那么它会弹出一个图像选择测验，你只有在成功回答测验后才能获得<strong class="jm io">令牌</strong></li><li id="9211" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated">当web UI向API服务器发送最终的“注册”请求时，它不仅会在有效载荷中携带“用户名”，还会包含reCAPTCHA发出的“<strong class="jm io">令牌</strong></li><li id="5b8d" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated">当API服务器收到请求时，它将通过与reCAPTCHA服务器对话来验证<strong class="jm io">令牌</strong>，并在<strong class="jm io">令牌</strong>无效时阻止用户注册</li></ul><p id="6e6e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，我们可以用下面的序列图来表示流程:</p><p id="e04e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">无图像挑战时(<a class="ae ky" href="https://sequencediagram.org/index.html#initialData=IYYwLg9gTgBAqgZwKZQFAAdhTASxDzAOzBgHUkAjeASQy13yJIEEAFWzbPA4YmKJAGE2AFUEAJZjDa1UiFAFoAfOSpxqALhggANngDWMAETUA5AFsYhCCWAwKNo6lU1lA4azGTp7LQHMkEkh9JEJUd1EJKRkFZRd1LWDQ1DlkKDjKGi1dA2MBPxwEMBQneOplGS18wuKoAB1CAG1MAE8dCGAAEy0AVzTCYHMkABoYJMIAXVQYpQjPKJ9NGAA3FBwAMxaxiBCwua9o9lilSu3dlbXN-iQEHp0wVAcADxgIVdhT6qKUGD6UFOmRwyaiWX1qMFuIBANwQzky6mO8igVSQBW+sEh0IQsKAA" rel="noopener ugc nofollow" target="_blank">图源</a>):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/f93abd1b3ccfc58b6f2421b87a096832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*fRcY07qmqS_5GRRrEJf4aA.png"/></div></figure><p id="323c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当出现图像挑战(<a class="ae ky" href="https://sequencediagram.org/index.html#initialData=IYYwLg9gTgBAqgZwKZQFAAdhTASxDzAOzBgHUkAjeASQy13yJIEEAFWzbPA4YmKJAGE2AFUEAJZjDa1UiFAFoAfOSpxqALhggANngDWMAETUA5AFsYhCCWAwKNo6lQBzKBACu6GAGJovFyQYQQALYB0dAKCPZFgfAHcQnDAkZ1UaBWV5KC0cc2BAmGQdJHBtMIikQkC5WOV09S1i0pI8gtSG6mUBYVYxSWl2LQA3FBwAMwBPGBiUUwQipBLwHAhCVB7RCSkZTJVKGi1IfSrUKoATZ2z6g8btPRBDIwEXHAQUqCdO5RktF7ePgAdQgAbUwkx0EGA5y0syghGA5iQABoYMcqgBdVC7JSbPrbQaaGCjKATabo9Z4-o7dh7X5oiAnQjEsZTfhIBAeHRgVAOAAeMAgJMJfyQr3eKBmsWc2NpNzURP+EtgnJAIA5CFQ3yysVF4o+RQ8ao1qCAA" rel="noopener ugc nofollow" target="_blank">图源</a>)时:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/e2fb324d9b8e1108a3cfc22cb0634cec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dguUGh76rcotU8DO5i0pwg.png"/></div></div></figure><h2 id="43ea" class="mt la in bd lb mu mv dn lf mw mx dp lj jv my mz ln jz na nb lr kd nc nd lv ne bi translated">示例代码:前端</h2><p id="f54b" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">让我们来看看React组件示例的实现细节。</p><p id="d918" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，该组件将呈现一个带有用户名输入、reCAPTCHA复选框、注册按钮和错误消息的表单。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="aea5" class="np la in nl b be nq nr l ns nt">&lt;form className="Form" data-testid="FormWithCheckbox" data-registration-result={registrationResult}&gt;<br/>  &lt;div&gt;<br/>    &lt;label&gt;<br/>      &lt;span&gt;username: &lt;/span&gt;<br/>      &lt;input type="text" name="username" value={username} onChange={handleUsernameChange} /&gt;<br/>    &lt;/label&gt;<br/>  &lt;/div&gt;<br/><br/>  &lt;ReCAPTCHA sitekey={SITE_KEY} onChange={handleRecaptchaChange} /&gt;<br/><br/>  &lt;button type="button" onClick={handleClickRegister}&gt;<br/>    register<br/>  &lt;/button&gt;<br/><br/>  {errorMessage &amp;&amp; &lt;div className="Error"&gt;{errorMessage}&lt;/div&gt;}<br/>&lt;/form&gt;</span></pre><p id="6e02" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里值得一提的是，我们使用了一个库— <a class="ae ky" href="http://npm i react-google-recaptcha" rel="noopener ugc nofollow" target="_blank"> react-google-recaptcha </a>来方便recaptcha的设置和渲染。</p><p id="5117" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，我们存储用户名和令牌的表单状态，并用回调来更新它们(在JSX使用)。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="4158" class="np la in nl b be nq nr l ns nt">const [username, setUsername] = React.useState("");<br/>const [recaptchaToken, setRecaptchaToken] = React.useState&lt;string | null&gt;(null);<br/><br/>const handleRecaptchaChange = React.useCallback((value: string | null) =&gt; {<br/>  console.log("FormWithCheckbox::handleRecaptchaChange &gt; value: ", value);<br/>  setRecaptchaToken(value);<br/>}, []);<br/><br/>const handleUsernameChange = React.useCallback((event: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt; {<br/>  const value = trim(event.target.value);<br/>  setUsername(value);<br/>}, []);</span></pre><p id="1614" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，当用户点击“注册”时，我们发送带有用户名和令牌的API请求。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="b8a3" class="np la in nl b be nq nr l ns nt">const [registrationResult, setRegistrationResult] = React.useState("");<br/>const [errorMessage, setErrorMessage] = React.useState("");<br/><br/>const handleClickRegister = React.useCallback(async () =&gt; {<br/>  setErrorMessage("");<br/><br/>  if (!recaptchaToken) {<br/>    alert("Please click reCAPTCHA checkbox!");<br/>    return;<br/>  }<br/><br/>  try {<br/>    const response = await axios.post("/api/user/registration", {<br/>      username,<br/>      recaptchaToken,<br/>      recaptchaVersion: "V2_CHECKBOX",<br/>    });<br/>    const { result } = response.data;<br/>    console.log("FormWithCheckbox::handleClickRegister &gt; result: ", result);<br/>    setRegistrationResult(trim(result));<br/>    alert("Register success");<br/>  } catch (e: any) {<br/>    const response = e.response;<br/>    const { result, error } = response.data;<br/>    setRegistrationResult(trim(result));<br/>    setErrorMessage(trim(error));<br/>  }<br/>}, [recaptchaToken, username]);</span></pre><h2 id="e0c8" class="mt la in bd lb mu mv dn lf mw mx dp lj jv my mz ln jz na nb lr kd nc nd lv ne bi translated">示例代码:后端</h2><p id="5720" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">处理API请求的node.js代码非常简单:</p><ul class=""><li id="9c5b" class="mf mg in jm b jn jo jr js jv mh jz mi kd mj kh mk ml mm mn bi translated">验证用户输入</li><li id="7a02" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated">验证reCAPTCHA令牌</li><li id="cc97" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated">执行主要操作(例如，注册)</li><li id="142f" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated">回送结果</li></ul><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="72b6" class="np la in nl b be nq nr l ns nt">app.post("/api/user/registration", async (req, res) =&gt; {<br/>  const recaptchaVersion = _.trim(_.get(req.body, "recaptchaVersion"));<br/>  const username = _.trim(_.get(req.body, "username"));<br/>  const token = _.trim(_.get(req.body, "recaptchaToken"));<br/><br/>  try {<br/>    validateUsername(username);<br/>    const secret = getSecretByRecaptchaVersion(recaptchaVersion);<br/>    await verifyRecaptchaToken({ token, secret });<br/>    // ... Register ...<br/>    res.status(201).json({ result: "SUCCESS", username });<br/>  } catch (e) {<br/>    console.error(e);<br/>    res.status(400).json({<br/>      result: "FAIL",<br/>      error: _.get(e, "message") ? _.get(e, "message") : JSON.stringify(e),<br/>    });<br/>  }<br/>});</span></pre><p id="3a38" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">…下面是验证reCAPTCHA令牌的代码:</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="58e6" class="np la in nl b be nq nr l ns nt">type VerifyRecaptchaTokenArgs = {<br/>  secret: string;<br/>  token: string;<br/>};<br/>const verifyRecaptchaToken = async (args: VerifyRecaptchaTokenArgs) =&gt; {<br/>  const { secret, token } = args;<br/>  if (!token || !secret) {<br/>    throw new Error("reCAPTCHA secret or token is invalid");<br/>  }<br/><br/>  const response = await axios.post(<br/>    "https://www.google.com/recaptcha/api/siteverify",<br/>    undefined,<br/>    {<br/>      params: { secret, response: token },<br/>    }<br/>  );<br/><br/>  console.log("reCAPTCHA siteverify result: ", response.data);<br/><br/>  if (!response.data.success) {<br/>    throw new Error("reCAPTCHA token is invalid");<br/>  }<br/>};</span></pre><p id="f6fe" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">完整代码可以在Github上找到:</p><div class="nu nv gp gr nw nx"><a href="https://github.com/zzdjk6/google-recaptcha-spike" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd io gy z fp oc fr fs od fu fw im bi translated">GitHub-zzdjk 6/Google-recaptcha-spike</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">github.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol ks nx"/></div></div></a></div><h2 id="13a3" class="mt la in bd lb mu mv dn lf mw mx dp lj jv my mz ln jz na nb lr kd nc nd lv ne bi translated">reCAPTCHA v2(隐形reCAPTCHA徽章)</h2><p id="c3fe" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">使用此选项时，整个流程与复选框版本相同，只是用户不需要勾选“我不是机器人”——当用户单击主操作按钮(即“注册”按钮)时，它会被隐式勾选。</p><p id="6908" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，当没有图像挑战时，序列图可以绘制如下(<a class="ae ky" href="https://sequencediagram.org/index.html#initialData=IYYwLg9gTgBAqgZwKZQFAAdhTASxDzAOzBgHUkAjeASQy13yJIEEAFWzbPA4YmKJAGE2AFUEAJZjDa1UqRCgC0APnJU41AFwwQAGzwBrGACIBAcxwIwKY6jU0VA4azGTp7bWaQlIBpIVQnUQkpGUUVew1tX387SgdlGW1zS2soAB1CAG1MAE9dCGAAE20AV2QoQmAAWyQAGhgYwgBdVDDlIJcQ9y0YADcUHAAzXMaIPwDO11D2cMSPMYn+wZH+JARS3TBUCggADxgIAdgktYsrFBhylDk22Yj4qLPUy42QEHWEOPVqOYUoZJIc5pGBvD4IL5AA" rel="noopener ugc nofollow" target="_blank">图源</a>):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/03ab9983071331489b19dd22034da352.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*gkjrB8WoMpa1i0R_AgxUlQ.png"/></div></figure><p id="131a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">…这是有图像选择挑战的时候(<a class="ae ky" href="https://sequencediagram.org/index.html#initialData=IYYwLg9gTgBAqgZwKZQFAAdhTASxDzAOzBgHUkAjeASQy13yJIEEAFWzbPA4YmKJAGE2AFUEAJZjDa1UqRCgC0APnJU41AFwwQAGzwBrGACIBAcxwIwKY6jNQIAV3QwAxNF5mkMQQAtgurqe3o7IsK4A7r441qhqNIoqClDaOAC2wF4wyLpI4Dr+gUiEXvJhKvEa2jl5JOmZSHGUCcoCwqxiktLs2gBuKDgAZgCeMKEoAOQI2Ui54DgQhKhtohJSMomqzVUwkAbFqMUAJk3q1Coy2uaW1lAAOoQA2pjDuhDAR9rjUITAaUgAGl2EH2hAAuqgNq0hKsupcYP0oENRnsDisOmtuucLj1gaCEQMRvwkAhHLowKgKBAAB4wCCIrFXJAWKwoMZhOSQ9ibSpaYks27ZRwgEAkhCnBJJMJMgVs0kisWoIA" rel="noopener ugc nofollow" target="_blank">diagram source</a>):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/4c63ab889969bf053955736fe823c4a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PypfYFA2Ox0kNa5uLmPKyA.png"/></div></div></figure><h2 id="8c07" class="mt la in bd lb mu mv dn lf mw mx dp lj jv my mz ln jz na nb lr kd nc nd lv ne bi translated">示例代码</h2><p id="4370" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">虽然后端代码基本上与前面的checkbox示例相同，但前端略有不同:当用户单击“register”而不是单击checkbox时，我们运行reCAPTCHA检查。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><h2 id="a3d7" class="mt la in bd lb mu mv dn lf mw mx dp lj jv my mz ln jz na nb lr kd nc nd lv ne bi translated">reCAPTCHA v3</h2><p id="9013" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">这个选项与前两个非常不同——它不使用“图像选择”弹出窗口来测试用户是否是机器人。</p><p id="8d63" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">或许我们甚至可以说根本没有验证码:reCAPTCHA v3声称它有能力观察用户与网站的交互，并计算用户操作的分数，然后我们的后端可以使用自定义阈值来决定该操作是否应该被允许或阻止。</p><p id="bbb4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用一张图会更容易理解(<a class="ae ky" href="https://sequencediagram.org/index.html#initialData=IYYwLg9gTgBAqgZwKZQFAAdhTASxDzAOzBgHUkAjeASQy13yJIEEAFWzbPA4YmKJAGE2AFUEAJZjDa1UiFAFoAfOSpxqALhgR0SQjADulGAhxgkqChAAe2gG4oyx9QGJovAOZItOQmZzAADY4AF5I-EKiEsyosfJQyqo0WiDBIADWMABEAh44COZQWahJ6soCwqxiktLsWl4kkOl6qBVRNTIKic6aME0tpdTKMlq5+YUAOoQA2pgAnoEQwAAmWgCuyFCEwAC2SAA0fRDNhAC6qJ1KbVXRtb0OUDgAZnNHJ62RNx3sXUojb3oYA9nq8BAg1oEwJYbPZHDI3FBPN4YCAABZIDIRSrVKRZBAgaBIYpWWwQB53UZIPIFRwbFCxC4-bpqXpjGmwcEgEBIBAIEo9X7xSnUwomNZcnl8oA" rel="noopener ugc nofollow" target="_blank">来源</a>):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/e82263120181b93d26779282b086abcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*d8hsWEdicGmiTSsXA98CZA.png"/></div></figure><p id="3ea0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">理解这一点非常重要，当使用reCAPTCHA v3时，人类用户没有机会证明他/她不是机器人。当API收到reCAPTCHA令牌验证结果时，我们可以允许用户继续操作，也可以根据“分数”给用户一个出错的硬停止。</p><p id="9ead" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此外，值得注意的是，对于不同的用户操作，对“分数”的检查可能是不同的。例如，我们可以为“注册”和“登录”设置不同的阈值。</p><h2 id="f17f" class="mt la in bd lb mu mv dn lf mw mx dp lj jv my mz ln jz na nb lr kd nc nd lv ne bi translated">代码示例</h2><blockquote class="op oq or"><p id="f879" class="jk jl mc jm b jn jo jp jq jr js jt ju os jw jx jy ot ka kb kc ou ke kf kg kh ig bi translated">注意:我们正在使用一个名为“<a class="ae ky" href="https://www.npmjs.com/package/react-google-recaptcha-v3" rel="noopener ugc nofollow" target="_blank">react-Google-recaptcha-v3</a>的库，以便更容易地将reCAPTCHA集成到React应用程序中。</p></blockquote><p id="b918" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，我们需要尽可能早地初始化reCAPTCHA:</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="6590" class="np la in nl b be nq nr l ns nt">root.render(<br/>  &lt;React.StrictMode&gt;<br/>    &lt;GoogleReCaptchaProvider reCaptchaKey={SITE_KEY}&gt;<br/>      &lt;App /&gt;<br/>    &lt;/GoogleReCaptchaProvider&gt;<br/>  &lt;/React.StrictMode&gt;<br/>);</span></pre><p id="5d6d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我们需要获得<strong class="jm io">令牌</strong>，并在用户点击“注册”时发送请求:</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="d1c3" class="np la in nl b be nq nr l ns nt">const App = () =&gt; {<br/>  const { executeRecaptcha } = useGoogleReCaptcha();<br/><br/>  const handleClickRegister = React.useCallback(async () =&gt; {<br/>    if (!executeRecaptcha) {<br/>      console.log("Execute recaptcha not yet available");<br/>      return;<br/>    }<br/><br/>    const recaptchaToken = await executeRecaptcha("register");<br/><br/>    // TODO: send API request and get result<br/>  }, [executeRecaptcha, username]);<br/><br/>  return (<br/>    &lt;div className="App"&gt;<br/>      {/* ... */}<br/>      &lt;button type="button" onClick={handleClickRegister}&gt;<br/>        register<br/>      &lt;/button&gt;<br/>      {/* ... */}<br/>    &lt;/div&gt;<br/>  );<br/>};</span></pre><p id="85b6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可能已经注意到，在获得令牌时，我们还告诉reCAPTCHA,<code class="fe ov ow ox nl b">action</code>是“register”。</p><p id="56fe" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，我们需要在后端用“action”和“score”验证<strong class="jm io">令牌</strong>:</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="c767" class="np la in nl b be nq nr l ns nt">const verifyRecaptchaToken = async (args: VerifyRecaptchaTokenArgs) =&gt; {<br/>  // ... Get token verify result ...<br/><br/>  const score = _.toNumber(_.get(response.data, "score"));<br/>  const action = _.toString(_.get(response.data, "action"));<br/><br/>  if (action === "register" &amp;&amp; score &lt; 0.5) {<br/>    throw new Error("Bot detected!");<br/>  }<br/>};</span></pre><p id="b15a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如上面的代码所示，我们使用<code class="fe ov ow ox nl b">0.5</code>作为“注册”动作的阈值。也就是说，如果分数等于或高于0.5，我们允许用户注册；如果分数低于0.5，我们抛出一个错误，并停止用户注册。</p><h1 id="2dea" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">材料</h1><p id="af67" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">你可以在我的github上的repo中找到所有三个选项(V2复选框、V2不可见和V3)的完整且可运行的代码示例:</p><div class="nu nv gp gr nw nx"><a href="https://github.com/zzdjk6/google-recaptcha-spike" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd io gy z fp oc fr fs od fu fw im bi translated">GitHub-zzdjk 6/Google-recaptcha-spike</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">github.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol ks nx"/></div></div></a></div><blockquote class="op oq or"><p id="d56a" class="jk jl mc jm b jn jo jp jq jr js jt ju os jw jx jy ot ka kb kc ou ke kf kg kh ig bi translated">注意:为了方便起见，reCAPTCHA的键包含在repo中，并且是硬编码的。如果你想探索更多关于reCAPTCHA的知识，我建议你注册自己的账户，并获得自己的钥匙。</p></blockquote><h1 id="e917" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">进一步讨论</h1><p id="5f82" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">虽然reCAPTCHA是最受欢迎的选择，但您可能会对隐私义务有一些担忧，这些担忧是完全正确的。例如，您可能想要查看这篇文章[3]以了解如何在使用reCAPTCHA时使您的应用程序符合GDPR。</p><p id="1c48" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">作为一种替代方案，<a class="ae ky" href="https://www.hcaptcha.com/" rel="noopener ugc nofollow" target="_blank"> hCaptcha </a>声称是谷歌reCAPTCHA的替代产品，但对各种隐私政策更加友好。因此，如果你关心隐私政策和法规，也许值得看一看。</p><h1 id="d0c5" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">参考</h1><ul class=""><li id="2c0d" class="mf mg in jm b jn lx jr ly jv oy jz oz kd pa kh mk ml mm mn bi translated">[1]<a class="ae ky" href="https://en.wikipedia.org/wiki/CAPTCHA#Alternative_CAPTCHAs" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/CAPTCHA</a></li><li id="ec0a" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated">[2]<a class="ae ky" href="https://developers.google.com/recaptcha/docs/versions" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/recaptcha/docs/versions</a></li><li id="5822" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated">[3]<a class="ae ky" href="https://measuredcollective.com/gdpr-recaptcha-how-to-stay-compliant-with-gdpr/" rel="noopener ugc nofollow" target="_blank">https://measured collective . com/gdpr-recaptcha-how-to-stay-compliant-with-gdpr/</a></li></ul><h2 id="3171" class="mt la in bd lb mu mv dn lf mw mx dp lj jv my mz ln jz na nb lr kd nc nd lv ne bi translated">更多内容请访问<a class="ae ky" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> PlainEnglish.io </a>。</h2><p id="0d44" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">报名参加我们的<a class="ae ky" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">免费周报</strong> </a>。关注我们关于<a class="ae ky" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">推特</strong></a><a class="ae ky" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">LinkedIn</strong></a><strong class="jm io"/><a class="ae ky" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">YouTube</strong></a><strong class="jm io"/><a class="ae ky" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">不和</strong> </a> <strong class="jm io">。</strong></p><h2 id="3d1e" class="mt la in bd lb mu mv dn lf mw mx dp lj jv my mz ln jz na nb lr kd nc nd lv ne bi translated">想用内容来扩展你的科技创业吗？检查<a class="ae ky" href="https://circuit.ooo/?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank">电路</a>。</h2><p id="aac5" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">我们提供免费的专家建议和定制解决方案，帮助您建立对您的技术产品或服务的认知和采用。</p></div></div>    
</body>
</html>