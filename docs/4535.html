<html>
<head>
<title>Session Authentication With Node.js, Express, Passport, and MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js、Express、Passport和MongoDB的会话认证</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/session-authentication-with-node-js-express-passport-and-mongodb-ffd1eea4521c?source=collection_archive---------1-----------------------#2022-12-12">https://javascript.plainenglish.io/session-authentication-with-node-js-express-passport-and-mongodb-ffd1eea4521c?source=collection_archive---------1-----------------------#2022-12-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="1219" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">基于会话的认证的简单指南。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/bb69bbf5dfec0feb96d193ce090828ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HdYg2XLQ_HufryAecb3VCw.png"/></div></div></figure><h2 id="3be7" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">快速说明—</h2><p id="0bb7" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated"><em class="md">我最近发表了一篇文章，介绍了jwt的一个认证解决方案。我在帖子的顶部做了一个免责声明，建议人们不要将帖子用于生产软件。相反，我承诺我将完成基于会话的认证，我终于开始着手做了。</em></p><p id="d277" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><em class="md">下面是JWT认证教程的链接:</em> <a class="ae mj" href="https://medium.com/@cambass/jwt-authentication-with-node-express-passport-and-mongodb-445a7fca5893" rel="noopener"> <em class="md"> JWT认证</em> </a></p></div><div class="ab cl mk ml hr mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ig ih ii ij ik"><p id="fccf" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">本会话认证教程演示了在Node.js应用程序中实现基于会话的认证的最少步骤。</p><h2 id="ec2b" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">步骤概述:</h2><p id="923d" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">首先，我们将创建一个app.js文件，其中包含创建会话所需的包。然后，我们将该会话添加到MongoDB存储中(我们在本教程中使用的数据库)。它还将包括passport设置，这对于我们的案例来说非常简单。最后，我们将包括所有特定于项目的路线。我将代码保持得尽可能的少，以便有最好的机会理解并为您的目的构建代码。</p><p id="1983" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">其次，我们将创建一个模型，创建用户并通过mongoose将其保存到MongoDB数据库。这将包括简化用户名和密码验证的“<a class="ae mj" href="https://www.npmjs.com/package/passport-local-mongoose" rel="noopener ugc nofollow" target="_blank">passport-local-mongose</a>”。我建议看看这个软件包是如何工作的，以便更深入地理解Passport。</p><p id="ebc3" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">最后，我们将使用Postman来验证会话配置是否设置正确，以及端点是否按预期工作。这一步将包括一个屏幕截图。</p><p id="ff8d" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">完成所有步骤后，您应该已经为基于会话的身份验证准备好了节点应用程序。</p><h2 id="93d8" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">技术假设:</h2><ol class=""><li id="496d" class="mr ms in lm b ln lo lq lr kx mt lb mu lf mv mc mw mx my mz bi translated">可以连接的正在运行的MongoDB集群。我们将使用<code class="fe na nb nc nd b">mongoose</code> — <code class="fe na nb nc nd b">passport-local-mongoose</code> — <code class="fe na nb nc nd b">connect-mongo</code>作为我们的数据存储。</li><li id="a97d" class="mr ms in lm b ln ne lq nf kx ng lb nh lf ni mc mw mx my mz bi translated">已安装节点和NPM的最新版本</li><li id="e27f" class="mr ms in lm b ln ne lq nf kx ng lb nh lf ni mc mw mx my mz bi translated"><a class="ae mj" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">邮递员</a>已安装</li></ol></div><div class="ab cl mk ml hr mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ig ih ii ij ik"><h1 id="b893" class="nj kp in bd kq nk nl nm kt nn no np kw jt nq ju la jw nr jx le jz ns ka li nt bi translated">步骤1:创建应用程序并添加依赖项</h1><p id="a53f" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">首先，让我们创建一个新的Node.js应用程序，并检查我们将在本教程中使用的包。</p><h2 id="446b" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">创建一个新的项目目录并创建节点应用程序:</h2><pre class="kd ke kf kg gt nu nd nv bn nw nx bi"><span id="1684" class="ny kp in nd b be nz oa l ob oc">&gt; mkdir user-session-tutorial<br/>&gt; cd user-session-tutorial<br/><br/>&gt; npm init</span></pre><p id="4017" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><strong class="lm io"> <em class="md">注意:我把我的入口点设置为</em> </strong> <code class="fe na nb nc nd b"><strong class="lm io"><em class="md">app.js</em></strong></code></p><h2 id="f792" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">现在让我们添加必要的包:</h2><pre class="kd ke kf kg gt nu nd nv bn nw nx bi"><span id="ead1" class="ny kp in nd b be nz oa l ob oc">npm install --save connect-mongo express express-session mongoose passport passport-local passport-local-mongoose</span></pre><h1 id="9549" class="nj kp in bd kq nk od nm kt nn oe np kw jt of ju la jw og jx le jz oh ka li nt bi translated">什么是PassportJS？什么是中间件？</h1><h2 id="17b7" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">护照</h2><p id="b701" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated"><a class="ae mj" href="https://www.passportjs.org/" rel="noopener ugc nofollow" target="_blank"> Passport </a>是<a class="ae mj" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>的认证中间件。极其灵活和模块化，Passport可以不引人注目地放入任何基于<a class="ae mj" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a>的web应用程序中。Passport支持许多不同的身份验证策略，可用于简单的实现。本教程使用“<a class="ae mj" href="https://www.passportjs.org/packages/passport-local/" rel="noopener ugc nofollow" target="_blank"> passport-local </a>”策略进行用户名和密码验证。Passport支持其他策略，如Google OAuth、Twitter、AuthO等等。这里是<a class="ae mj" href="https://www.passportjs.org/packages/" rel="noopener ugc nofollow" target="_blank">完整列表</a>的链接。</p><p id="8d57" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">还值得注意的是，Passport是数据库不可知的，我们在本教程中使用MongoDB，但是任何其他数据库类型都可以轻松使用。</p><h2 id="98c8" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">中间件</h2><p id="4303" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">中间件是一种过滤进入应用程序的请求的方式。中间件组件位于客户机和服务器之间，处理入站请求和出站响应。换句话说，它可以在数据到达客户机或服务器之前处理来自请求和响应的数据。</p><p id="53b9" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">中间件便于身份验证和授权，这就是Passport在基于Express的应用程序中被广泛采用的原因。下面的app.js文件将演示我们如何在Node.js应用程序中实现Passport。</p><h1 id="6d31" class="nj kp in bd kq nk od nm kt nn oe np kw jt of ju la jw og jx le jz oh ka li nt bi translated">第二步:创建一个<em class="oi"> app.js </em>文件</h1><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="1231" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">在为您的目的进行开发时，将这些组件移动到它们自己的文件中是一个好的做法，但是在这里将所有的东西都展开会更容易理解。</p><h1 id="7bb2" class="nj kp in bd kq nk od nm kt nn oe np kw jt of ju la jw og jx le jz oh ka li nt bi translated">步骤3:创建用户模型</h1><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="7b3a" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">同样，这个用户模型利用passport-local-mongose包来消除在我们的应用程序中处理密码散列的需要。</p><p id="a597" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">在这个模型实现之后，所有必要的代码都应该设置好了，我们就可以测试我们的端点了。我们开始吧！</p><h1 id="c408" class="nj kp in bd kq nk od nm kt nn oe np kw jt of ju la jw og jx le jz oh ka li nt bi translated">步骤4:通过邮递员提出请求:</h1><h2 id="0887" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">注册路线:创建用户</h2><p id="431a" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">测试端点的第一步是创建一个用户。让我们使用正确的请求体点击<code class="fe na nb nc nd b">/register</code>路线来完成这个任务。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ol"><img src="../Images/480fbddef0f437cbd36fbf0e72bf8978.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b7uz6FPj8chFjvEsPh-aZg.png"/></div></div></figure><p id="0ba1" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">我们已经成功创建了用户。让我们看一下我们的MongoDB实例，以确保我们已经创建了文档:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi om"><img src="../Images/0631ce1efd805ada8595177577c48a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vxgZCjOXMCzqeVUo7ZvsRQ.png"/></div></div></figure><p id="9264" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">我们的应用程序创建了用户，下一步是登录。</p><h2 id="0996" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">登录路径:创建会话</h2><p id="e51d" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">如果我们想要访问受保护的路由，我们需要创建一个有效的会话来证明我们是我们所说的那个人。让我们现在就开始吧:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi on"><img src="../Images/0297aad2d550f4659cc09d5aabf3ddea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R6cx-ZtLVyqQEqJ9tTzNnw.png"/></div></div></figure><p id="1a69" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">现在让我们检查MongoDB，并检查将用于验证请求的已创建会话。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oo"><img src="../Images/9617a9481c755d5f0d1b7baf95a7937c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4P5k5-C7Y3nhqecnbj9WEQ.png"/></div></div></figure><p id="1cc3" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">就在那里。我们有一个会话可以用来访问受保护的路线。让我们试一试。</p><h2 id="27c0" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">配置文件路由:受保护。只有你能看到这个。</h2><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi op"><img src="../Images/7027b4e68a5fa8c10994e12dec57cc12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w4hHspXqInzNAAuvfS5XyA.png"/></div></div></figure><p id="9316" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">我们已经到达了受保护的路线。</p><h2 id="1aa7" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">配置文件路由:测试失败</h2><p id="80ae" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">我将从我的MongoDB存储中删除该会话，以确保一切配置正确。删除会话后，该请求现在应该会失败。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oq"><img src="../Images/a3fcdc34fb493a6b156fb251bc1291ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0UQMfzAjBmcx_KWY46riug.png"/></div></div></figure><p id="946e" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">删除会话后，我无法再登录和查看受保护的配置文件路由。</p></div><div class="ab cl mk ml hr mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ig ih ii ij ik"><h1 id="d208" class="nj kp in bd kq nk nl nm kt nn no np kw jt nq ju la jw nr jx le jz ns ka li nt bi translated">总结:</h1><p id="f063" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">希望这有助于演示向Node.js应用程序添加基于会话的身份验证所需的最少步骤。编码快乐！</p></div><div class="ab cl mk ml hr mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ig ih ii ij ik"><p id="7d35" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><em class="md">报名参加我们的</em> <a class="ae mj" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lm io"> <em class="md">免费周报</em> </strong> </a> <em class="md">。关注我们关于</em><a class="ae mj" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="md">Twitter</em></strong></a>，<a class="ae mj" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="md">LinkedIn</em></strong></a><em class="md">，</em><a class="ae mj" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="md">YouTube</em></strong></a><em class="md">，以及</em> <a class="ae mj" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="lm io"> <em class="md">不和</em> </strong> </a> <strong class="lm io"> <em class="md">。</em>T41】</strong></p><p id="79a1" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><strong class="lm io"> <em class="md">有兴趣缩放你的软件启动</em> </strong> <em class="md">？检查</em> <a class="ae mj" href="https://circuit.ooo?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="lm io"> <em class="md">电路</em> </strong> </a> <em class="md">。</em></p></div></div>    
</body>
</html>