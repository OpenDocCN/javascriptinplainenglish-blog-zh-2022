<html>
<head>
<title>How to Use FFmpeg with Node.js and Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何结合Node.js和Docker使用FFmpeg</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-ffmpeg-with-node-js-and-docker-c21f56993e14?source=collection_archive---------3-----------------------#2022-07-04">https://javascript.plainenglish.io/how-to-use-ffmpeg-with-node-js-and-docker-c21f56993e14?source=collection_archive---------3-----------------------#2022-07-04</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="0707" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">如何轻松处理Node.js中的音频和视频文件</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/266c32f832bc6a7356cab786cc70fad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nyxNqPgNTvkfwsH1FrhJdQ.jpeg"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Photo by Donald Tong: <a class="ae kw" href="https://www.pexels.com/photo/black-camera-recorder-66134/" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/photo/black-camera-recorder-66134/</a></figcaption></figure><p id="272c" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">今天我们将学习如何在Docker容器中使用FFmpeg和Node.js。</p><h1 id="8f11" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">背景</h1><p id="3b6a" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">通常，当我们运行Node.js应用程序时，该应用程序所需的所有部分都在npm包中，这些包位于<strong class="kz is"> node_modules </strong>文件夹中。</p><p id="6f09" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然而，对于一些特定的用例，我们需要访问操作系统级的应用程序，这就有点复杂了。</p><p id="d8bc" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">一个很好的例子就是FFmpeg，在他们的文档中被描述为<a class="ae kw" href="https://ffmpeg.org/" rel="noopener ugc nofollow" target="_blank">:</a></p><blockquote class="mq"><p id="b61b" class="mr ms ir bd mt mu mv mw mx my mz ls dk translated">一个完整的跨平台解决方案，用于录制、转换和流式传输音频和视频。</p></blockquote><p id="1801" class="pw-post-body-paragraph kx ky ir kz b la na js lc ld nb jv lf lg nc li lj lk nd lm ln lo ne lq lr ls ik bi translated">长话短说，如果你需要与音频和视频转换或修改工作，你会需要这个。</p><h1 id="0288" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">问题是</h1><p id="3bc9" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">问题是<strong class="kz is"> FFmpeg </strong>不是任何你可以安装和使用的npm模块。在<strong class="kz is"> FFmpeg </strong>之上有一些库，比如<code class="fe nf ng nh ni b"><a class="ae kw" href="https://www.npmjs.com/package/ffcreator" rel="noopener ugc nofollow" target="_blank">ffcreator</a></code>和<code class="fe nf ng nh ni b"><a class="ae kw" href="https://www.npmjs.com/package/fluent-ffmpeg" rel="noopener ugc nofollow" target="_blank">fluent-ffmpeg</a></code>，它们在FFmpeg之上创建了一个抽象，但是你仍然需要在操作系统层安装FFmpeg。</p><p id="a931" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">因此，要解决这个问题，一个简单的解决方案是在运行应用程序的服务器上安装FFmpeg。</p><p id="18c5" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">但是在现代，我们几乎不直接使用硬件。因为无论何时你需要一个新的服务器，你都需要重新安装它。</p><p id="dac4" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">哪一个是重复和无聊的？</p><h1 id="ab5b" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">解决方案</h1><p id="a701" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">更简单的方法是将你的应用程序与安装在Docker镜像中的FFmpeg捆绑在一起，这使得它非常容易分发，并且你的应用程序现在是可共享和可复制的！</p><p id="f6c4" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">但是你具体是怎么做的呢？真的很简单。在您的基本映像之上，您将运行安装FFmpeg的命令，就这样！</p><p id="0b30" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">下面是一个工作的does文件。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nj nk l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Dockerfile</figcaption></figure><p id="5bf7" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">因此，中间的3行代码将FFmpeg安装到Node.js Alpine基础映像中。</p><pre class="kh ki kj kk gu nl ni nm nn aw no bi"><span id="f3ee" class="np lu ir ni b gz nq nr l ns nt">RUN apk update</span><span id="dba0" class="np lu ir ni b gz nu nr l ns nt">RUN apk add</span><span id="10fe" class="np lu ir ni b gz nu nr l ns nt">RUN apk add ffmpeg</span></pre><p id="11c1" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">注意:我们使用<code class="fe nf ng nh ni b">apk add</code>是因为在顶部，我们选择了<code class="fe nf ng nh ni b">node:16-alpine</code>版本的node(它的尺寸更小)。</p><p id="0613" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如果你使用的是一个合适的Node.js镜像，比如<code class="fe nf ng nh ni b">node:16</code>，那么安装FFmpeg的命令如下:</p><pre class="kh ki kj kk gu nl ni nm nn aw no bi"><span id="60f1" class="np lu ir ni b gz nq nr l ns nt">RUN apt update</span><span id="3057" class="np lu ir ni b gz nu nr l ns nt">RUN apt install ffmpeg</span></pre><p id="15c4" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这应该能行。</p><h1 id="dac8" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">供选择的</h1><p id="c456" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">上述方法适用于Node.js和Docker图像。但是如果你想使用AWS Lambda或者Google Cloud函数来部署你的Node.js应用，那么就会产生一些问题。</p><p id="1b2e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">为了避免这种情况，还有另一种方法。我们可以使用一个名为<code class="fe nf ng nh ni b"><a class="ae kw" href="https://www.npmjs.com/package/ffmpeg-static" rel="noopener ugc nofollow" target="_blank">ffmpeg-static</a></code>的npm包。</p><p id="ff1c" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在您的项目中:</p><pre class="kh ki kj kk gu nl ni nm nn aw no bi"><span id="288d" class="np lu ir ni b gz nq nr l ns nt">npm install --save ffmpeg-static</span></pre><p id="2bf3" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">它将下载二进制文件，并将它们存储在<code class="fe nf ng nh ni b">node_modules</code>文件夹中。从你的应用程序中，你必须指向二进制文件在<code class="fe nf ng nh ni b">node_modules</code>文件夹中的路径。</p><p id="d473" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">您可以通过以下方式获取路径:</p><pre class="kh ki kj kk gu nl ni nm nn aw no bi"><span id="7918" class="np lu ir ni b gz nq nr l ns nt">var pathToFfmpeg = require('ffmpeg-static');<br/>console.log(pathToFfmpeg);</span></pre><p id="c00e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后，您可以将其导出为路径。</p><pre class="kh ki kj kk gu nl ni nm nn aw no bi"><span id="311a" class="np lu ir ni b gz nq nr l ns nt">ENV PATH="/your/path/to/node_modules/ffmpeg-static/bin/linux/x64:${PATH}"</span></pre><p id="72d9" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这就是你可以实现的方式。这条特殊的线索很有用。</p></div><div class="ab cl nv nw hv nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ik il im in io"><p id="e169" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">今天到此为止。祝您愉快！</p><pre class="kh ki kj kk gu nl ni nm nn aw no bi"><span id="aa66" class="np lu ir ni b gz nq nr l ns nt"><strong class="ni is">Want to Connect?</strong></span><span id="4b8c" class="np lu ir ni b gz nu nr l ns nt">You can reach out to me via <a class="ae kw" href="https://www.linkedin.com/in/56faisal/" rel="noopener ugc nofollow" target="_blank"><strong class="ni is">LinkedIN</strong></a> or my <a class="ae kw" href="https://www.mohammadfaisal.dev/blog" rel="noopener ugc nofollow" target="_blank"><strong class="ni is">Personal Website</strong></a></span></pre><h2 id="b1bf" class="np lu ir bd lv oc od dn lz oe of dp md lg og oh mf lk oi oj mh lo ok ol mj om bi translated">资源:</h2><div class="on oo gq gs op oq"><a href="https://stackoverflow.com/questions/50693091/ffmpeg-install-within-existing-node-js-docker-image" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fp"><div class="os ab ot cl cj ou"><h2 class="bd is gz z fq ov fs ft ow fv fx iq bi translated">在现有Node.js docker映像中安装ffmpeg</h2><div class="ox l"><h3 class="bd b gz z fq ov fs ft ow fv fx dk translated">我需要在docker容器(使用docker-compose创建)中运行的Node.js应用程序中使用ffmpeg。我非常…</h3></div><div class="oy l"><p class="bd b dl z fq ov fs ft ow fv fx dk translated">stackoverflow.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe kq oq"/></div></div></a></div><p id="d398" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><em class="pf">更多内容看</em> <a class="ae kw" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is"> <em class="pf">说白了就是io </em> </strong> </a> <em class="pf">。报名参加我们的</em> <a class="ae kw" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is"> <em class="pf">免费周报</em> </strong> </a> <em class="pf">。关注我们关于</em><a class="ae kw" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kz is"><em class="pf">Twitter</em></strong></a><em class="pf">和</em><a class="ae kw" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kz is"><em class="pf">LinkedIn</em></strong></a><em class="pf">。查看我们的</em> <a class="ae kw" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is"> <em class="pf">社区不和谐</em> </strong> </a> <em class="pf">加入我们的</em> <a class="ae kw" href="https://inplainenglish.pallet.com/talent/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is"> <em class="pf">人才集体</em> </strong> </a> <em class="pf">。</em></p></div></div>    
</body>
</html>