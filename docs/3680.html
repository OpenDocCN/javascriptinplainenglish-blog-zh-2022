<html>
<head>
<title>Let’s Understand Chrome V8: Compiler Workflow: How does V8 Describe Your JavaScript Function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们来了解一下Chrome V8:编译器工作流程:V8是如何描述你的JavaScript函数的</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/lets-understand-chrome-v8-compiler-workflow-how-does-v8-describe-your-javascript-function-20b762270561?source=collection_archive---------8-----------------------#2022-09-16">https://javascript.plainenglish.io/lets-understand-chrome-v8-compiler-workflow-how-does-v8-describe-your-javascript-function-20b762270561?source=collection_archive---------8-----------------------#2022-09-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="6f74" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">第24章:SharedFunction和JSFunction的基础知识</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/2229cb027639f57877eb360bf75cd927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yCFNVeb4ds9hl7WF-NP-kw.png"/></div></div></figure><p id="3e79" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="lk">欢迎阅读</em> <a class="ae ll" href="https://medium.com/@huidou" rel="noopener"> <em class="lk">其他章节让我们来了解一下Chrome V8 </em> </a></p><p id="739b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当我们学习V8时，SharedFunction和JSFunction是两个非常常见和重要的术语，可能会让初学者感到困惑。那么它们是什么呢？两者有什么区别？一般来说，ShardFunction的主要作用是放置字节码的地方，还有其他的东西，比如我以后会谈到的蹦床。“Shared”，你可以大致把SharedFunction想象成一个DLL库，可以在任何地方调用。编译器将JavaScript函数编译成SharedFunction，SharedFunction可以像DLL一样在任何地方使用。这就是它的名字叫共享功能的原因。</p><p id="5916" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">大致来说，JSFunction等于SharedFunction +一个上下文。当V8要调用SharedFunction时，V8需要将一个context绑定到shared function，bind是V8的一个术语，意思是将一个shared function和一个context绑定在一起，即JSFunction。JSFunction是一个可执行实例，可由V8解释器点火执行。</p><h1 id="26fa" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated"><strong class="ak"> 1。共享功能</strong></h1><p id="1dea" class="pw-post-body-paragraph ko kp in kq b kr me jo kt ku mf jr kw kx mg kz la lb mh ld le lf mi lh li lj ig bi translated">以下代码是SharedFucntion类。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="8a5e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">第1–2行注释了SharedFunction可以由多个实例共享。</p><p id="161d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在这里，我给你一些共享函数的重要成员。</p><ul class=""><li id="3a6f" class="ml mm in kq b kr ks ku kv kx mn lb mo lf mp lj mq mr ms mt bi translated">第5行，GetCode()返回代码，我将进一步说明该代码是内置代码，而不是您的JavaScript源代码，内置代码用于构建解释器启动的函数序言。在调用一个函数之前，V8需要构造一个调用栈，获取第一个指令地址，这一切都由内置代码负责；</li><li id="ad81" class="ml mm in kq b kr mu ku mv kx mw lb mx lf my lj mq mr ms mt bi translated">第6行，SetScript()将JavaScript源代码设置到SharedFunction中；</li><li id="14ec" class="ml mm in kq b kr mu ku mv kx mw lb mx lf my lj mq mr ms mt bi translated">第9–11行，它们设置了描述字节码和JavaScript源代码之间对应位置的offset</li><li id="2cf9" class="ml mm in kq b kr mu ku mv kx mw lb mx lf my lj mq mr ms mt bi translated">第12-15行描述了SharedFunction是否是API函数；</li><li id="9f82" class="ml mm in kq b kr mu ku mv kx mw lb mx lf my lj mq mr ms mt bi translated">第16-18行，它们为SharedFunction获取并设置字节码数组；</li><li id="2d37" class="ml mm in kq b kr mu ku mv kx mw lb mx lf my lj mq mr ms mt bi translated">第19行，是以后要讲的InterpreterTrampoline地址；</li><li id="6155" class="ml mm in kq b kr mu ku mv kx mw lb mx lf my lj mq mr ms mt bi translated">第27-35行，它们是涡轮风扇发动机的优化理由。下面列出的是优化原因。</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mj mk l"/></div></figure><ul class=""><li id="83dc" class="ml mm in kq b kr ks ku kv kx mn lb mo lf mp lj mq mr ms mt bi translated">第36–37行，将模式设置为严格或草率；</li><li id="7e92" class="ml mm in kq b kr mu ku mv kx mw lb mx lf my lj mq mr ms mt bi translated">第40–48行，宏DECL _布尔_访问器的定义如下:</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mj mk l"/></div></figure><ul class=""><li id="b6d2" class="ml mm in kq b kr ks ku kv kx mn lb mo lf mp lj mq mr ms mt bi translated">第72行，它定义了SharedFunction的内存布局，下面是源代码，图1显示了内存布局:</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mj mk l"/></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/b812bf82b73cd9bfb29d0232ab2ed781.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*tucLEjE9kzT6eowjnWwg-g.png"/></div></figure><h1 id="9c36" class="lm ln in bd lo lp lq lr ls lt lu lv lw jt lx ju ly jw lz jx ma jz mb ka mc md bi translated"><strong class="ak"> 2。JSFunction </strong></h1><p id="aa41" class="pw-post-body-paragraph ko kp in kq b kr me jo kt ku mf jr kw kx mg kz la lb mh ld le lf mi lh li lj ig bi translated">函数NewFunctionFromSharedFunctionInfo读取SharedFunction并生成相应的JSFunction。以下是源代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="c589" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在上面的代码中，第7行调用了NewFunction()。</p><p id="03ef" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在这里，我给你一些新功能的细节。</p><ul class=""><li id="c2d3" class="ml mm in kq b kr ks ku kv kx mn lb mo lf mp lj mq mr ms mt bi translated">第17-18行描述了一些SharedFunction没有的属性和元素。</li><li id="437e" class="ml mm in kq b kr mu ku mv kx mw lb mx lf my lj mq mr ms mt bi translated">第21行，是我上面提到的绑定上下文。</li><li id="57f3" class="ml mm in kq b kr mu ku mv kx mw lb mx lf my lj mq mr ms mt bi translated">第19–20行，它们设置了相应的SharedFunction并将代码内置到JSFunction中。</li></ul><p id="ac37" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">好的，SharedFunction可以被多个实例共享，JSFunction是一个可执行的实例。</p><p id="6e6d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">好了，这部分就到此为止了。下次再见，保重！</p><p id="2973" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果你有任何问题，请联系我。<strong class="kq io">微信</strong> : qq9123013 <strong class="kq io">邮箱</strong>:<a class="ae ll" href="mailto:v8blink@outlook.com" rel="noopener ugc nofollow" target="_blank">v8blink@outlook.com</a></p></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><p id="74ec" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="lk">更多内容看</em> <a class="ae ll" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lk">说白了。报名参加我们的</em> <a class="ae ll" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lk">免费周报</em> </strong> </a> <em class="lk">。关注我们关于</em> <a class="ae ll" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lk">推特</em> </strong> </a>，<a class="ae ll" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="lk">LinkedIn</em></strong></a><em class="lk">，</em><a class="ae ll" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="lk">YouTube</em></strong></a><em class="lk">，以及</em> <a class="ae ll" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lk">不和</em> </strong> </a> <em class="lk">。对增长黑客感兴趣？检查</em> <a class="ae ll" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="lk">电路</em> </strong> </a> <em class="lk">。</em></strong></a></p></div></div>    
</body>
</html>