<html>
<head>
<title>Build and Package an NPM Component with esbuild, React and TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用esbuild、React和TypeScript构建和打包NPM组件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/develop-and-publish-a-react-component-with-esbuild-and-typescript-3eb756adda6e?source=collection_archive---------4-----------------------#2022-01-03">https://javascript.plainenglish.io/develop-and-publish-a-react-component-with-esbuild-and-typescript-3eb756adda6e?source=collection_archive---------4-----------------------#2022-01-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/ef3c5a645de1deb99258e84ce3550733.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XYEs0ooJcS68pDPIseKXUA.png"/></div></div></figure><p id="fff4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您是否正在为React组件寻找一个简单、直接的开发环境，以便为NPM发行版进行捆绑和打包？这是我们团队使用<a class="ae kt" href="https://esbuild.github.io/" rel="noopener ugc nofollow" target="_blank"> esbuild </a>、<a class="ae kt" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>和<a class="ae kt" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>的方法。</p><h2 id="ccee" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">快速背景</h2><p id="265a" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">最近，我们在西北大学图书馆的开发团队着手创建一个开源的图像、音频和视频查看器组件来显示来自我们数字收藏UI应用的项目。</p><p id="16bd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这些要求是:</p><ul class=""><li id="cc99" class="ls lt in jx b jy jz kc kd kg lu kk lv ko lw ks lx ly lz ma bi translated">在各种应用程序中重复使用组件</li><li id="c34d" class="ls lt in jx b jy mb kc mc kg md kk me ko mf ks lx ly lz ma bi translated">建立一个简单的开发环境(以实时重载、快速捆绑等为特色)，不使用Create React App、Next.js等额外的帮助工具。</li><li id="e9cd" class="ls lt in jx b jy mb kc mc kg md kk me ko mf ks lx ly lz ma bi translated">便于NPM配送的包装</li><li id="8b66" class="ls lt in jx b jy mb kc mc kg md kk me ko mf ks lx ly lz ma bi translated">关于如何在任何IDE中通过类型和智能感知支持使用该组件的公共API(通过TypeScript)</li></ul><p id="de59" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">虽然有许多关于上述技术的不同组合的有用文章，但我们认为应该分享我们的特定用例。</p><p id="6952" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你想直接跳到代码，这里有一个最终代码的例子:<a class="ae kt" href="https://github.com/adamjarling/medium-es-build-article-demo" rel="noopener ugc nofollow" target="_blank">https://github.com/adamjarling/medium-es-build-article-demo</a>。</p><h1 id="40b7" class="mg kv in bd kw mh mi mj kz mk ml mm lc mn mo mp lf mq mr ms li mt mu mv ll mw bi translated">esbuild</h1><p id="aca7" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">由于其简化的API、速度、对TypeScript的本地支持和许多其他优秀特性，esbuild最近获得了很多关注。这似乎是一个更精简的方法，所以我们将使用它作为我们的JavaScript bundler/packager。</p><p id="dbd0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您想调整配置，在通读本文或按照步骤设置项目时，参考<a class="ae kt" href="https://esbuild.github.io/api/#build-api" rel="noopener ugc nofollow" target="_blank"> esbuild的API </a>可能会有所帮助。</p><h1 id="b788" class="mg kv in bd kw mh mi mj kz mk ml mm lc mn mo mp lf mq mr ms li mt mu mv ll mw bi translated">设置项目</h1><p id="c581" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">首先，为您的项目创建一个新目录，并输入项目。接下来，让我们初始化项目中的<code class="fe mx my mz na b">npm</code>和<code class="fe mx my mz na b">git</code>，以获得一个<code class="fe mx my mz na b">package.json</code>文件。现在继续接受所有的命令提示符默认值(您可以随时更新)。</p><pre class="nb nc nd ne gt nf na ng nh aw ni bi"><span id="7b55" class="ku kv in na b gy nj nk l nl nm">// Create your new project directory<br/>mkdir my-awesome-project<br/>cd my-awesome-project</span><span id="e2af" class="ku kv in na b gy nn nk l nl nm">// Initialize npm<br/>npm init</span><span id="14b7" class="ku kv in na b gy nn nk l nl nm">// Initialize git<br/>git init</span></pre><h1 id="b06e" class="mg kv in bd kw mh mi mj kz mk ml mm lc mn mo mp lf mq mr ms li mt mu mv ll mw bi translated">设置开发环境</h1><p id="9c5a" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">让我们建立并运行一个开发环境。首先，我们将安装一些初始开发依赖项:</p><pre class="nb nc nd ne gt nf na ng nh aw ni bi"><span id="f98f" class="ku kv in na b gy nj nk l nl nm">// Install development dependencies<br/>npm install -D esbuild typescript chokidar rimraf live-server</span></pre><p id="a443" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">我们在安装什么？</strong></p><p id="1450" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">用于监视我们代码中的变化，以帮助实时重载。</p><p id="42d8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mx my mz na b">rimraf</code>用来清理我们的输出目录，确保文件新鲜、干净。</p><p id="835a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mx my mz na b">live-server</code>是一个轻量级的本地web服务器，我们将使用它来服务于开发环境，这样你就可以在浏览器中看到你的工作。</p><p id="6649" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我们将安装React及其类型(因此TypeScript知道语法)，这是我们的应用程序需要在浏览器中运行的依赖项。</p><pre class="nb nc nd ne gt nf na ng nh aw ni bi"><span id="f3ae" class="ku kv in na b gy nj nk l nl nm">npm install react react-dom @types/react @types/react-dom</span></pre><h2 id="bce1" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">添加开发环境项目结构</h2><p id="4d69" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">现在让我们在项目中添加一些初始开发环境文件。我们将从两个样板配置文件开始，<code class="fe mx my mz na b">.gitignore</code>和<code class="fe mx my mz na b">tsconfig.json</code>。在项目根目录下创建它们:</p><pre class="nb nc nd ne gt nf na ng nh aw ni bi"><span id="fd2a" class="ku kv in na b gy nj nk l nl nm">touch .gitignore<br/>touch tsconfig.json</span></pre><p id="1831" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，您可以将<a class="ae kt" href="https://github.com/adamjarling/medium-es-build-article-demo/blob/main/.gitignore" rel="noopener ugc nofollow" target="_blank">这个文件</a>的内容复制到<code class="fe mx my mz na b">.gitignore</code>中，并将<a class="ae kt" href="https://github.com/adamjarling/medium-es-build-article-demo/blob/main/tsconfig.json" rel="noopener ugc nofollow" target="_blank">这个文件</a>复制到您的TypeScript配置文件<code class="fe mx my mz na b">tsconfig.json</code>中</p><h2 id="49f6" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">/公共</h2><p id="e42d" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">让我们创建一个名为<code class="fe mx my mz na b">/public</code>的目录，其中包含本地开发服务器将使用的文件。</p><pre class="nb nc nd ne gt nf na ng nh aw ni bi"><span id="735a" class="ku kv in na b gy nj nk l nl nm">// Create dev environment files<br/>mkdir public<br/>cd public<br/>touch index.html</span></pre><p id="7107" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将<a class="ae kt" href="https://github.com/adamjarling/medium-es-build-article-demo/blob/main/public/index.html" rel="noopener ugc nofollow" target="_blank">这个文件</a>的内容复制到你的<code class="fe mx my mz na b">/public/index.html</code>中。</p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="no np l"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">index.html</figcaption></figure><p id="1349" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mx my mz na b">&lt;div id="root" /&gt;</code>是我们的React组件将附加到的HTML元素。而<code class="fe mx my mz na b">&lt;script src="/script.js"&gt;&lt;/script&gt;</code>是我们的捆绑开发代码最终需要在浏览器中呈现的地方。</p><h2 id="8e6e" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">/src</h2><p id="e92b" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">现在让我们模拟一个消费应用程序和我们要导入的组件在我们的开发环境中的样子。让我们创建两个文件，其中一个,<code class="fe mx my mz na b">dev.tsx</code>模拟消费应用程序，另一个,<code class="fe mx my mz na b">index.tsx</code>表示消费应用程序将导入的顶级组件。</p><p id="ccb2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，回到我们项目的根目录，在<code class="fe mx my mz na b">/public</code>旁边创建一个兄弟<code class="fe mx my mz na b">/src</code>目录。</p><pre class="nb nc nd ne gt nf na ng nh aw ni bi"><span id="a607" class="ku kv in na b gy nj nk l nl nm">mkdir src<br/>cd src<br/>touch dev.tsx<br/>touch index.tsx</span></pre><p id="7bb1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您的项目现在应该如下所示:</p><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/e3c4e301c1fbf068a9d1db4a409cff29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*LEPBFO7T1kY4nHoJ0FQbXQ.png"/></div></figure><p id="d58d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在<code class="fe mx my mz na b">/src/dev.tsx</code>中，复制<a class="ae kt" href="https://github.com/adamjarling/medium-es-build-article-demo/blob/main/src/dev.tsx" rel="noopener ugc nofollow" target="_blank">该文件</a>的内容:</p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="no np l"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">dev.tsx</figcaption></figure><p id="8a23" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">并且在<code class="fe mx my mz na b">/src/index.tsx</code>中，复制<a class="ae kt" href="https://github.com/adamjarling/medium-es-build-article-demo/blob/main/src/index.tsx" rel="noopener ugc nofollow" target="_blank">这个文件</a>的内容:</p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="no np l"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">index.tsx</figcaption></figure><h2 id="ad6b" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">捆绑代码并在浏览器中呈现</h2><p id="3f5c" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">现在我们将创建一个文件<code class="fe mx my mz na b">/src/serve.js</code>，它将包含我们的开发环境的配置。这个文件将监视我们代码中的变化，为浏览器捆绑我们的代码，并提供实时的重新加载体验。</p><pre class="nb nc nd ne gt nf na ng nh aw ni bi"><span id="efb0" class="ku kv in na b gy nj nk l nl nm">// /src/serve.js<br/>touch serve.js</span></pre><p id="f933" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将文件中<a class="ae kt" href="https://github.com/adamjarling/medium-es-build-article-demo/blob/main/serve.js" rel="noopener ugc nofollow" target="_blank">的内容复制到<code class="fe mx my mz na b">src/serve.js</code>中</a></p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="no np l"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">serve.js</figcaption></figure><p id="7c2f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里发生了很多事情，但是如果您通读代码，主要的收获是:</p><ul class=""><li id="5cb6" class="ls lt in jx b jy jz kc kd kg lu kk lv ko lw ks lx ly lz ma bi translated">esbuild的<code class="fe mx my mz na b">build</code>方法将我们的代码与一些应用的基本配置捆绑在一起，并创建<code class="fe mx my mz na b">/public/script.js</code>文件作为输出。</li><li id="e2bf" class="ls lt in jx b jy mb kc mc kg md kk me ko mf ks lx ly lz ma bi translated"><code class="fe mx my mz na b">chokidar</code>正在监视对任何TypeScript文件的更改，然后我们告诉esbuild重新构建。</li><li id="f2fd" class="ls lt in jx b jy mb kc mc kg md kk me ko mf ks lx ly lz ma bi translated">正在使用一些基本配置启动本地web服务器。</li></ul><p id="943d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们创建一个脚本，这样我们就可以运行代码并进行测试。</p><h2 id="66c0" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">npm运行开发</h2><p id="47c0" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">我们需要更新我们的<code class="fe mx my mz na b">package.json</code>文件来添加一个<code class="fe mx my mz na b">npm run dev</code>命令，我们可以运行这个命令来验证一切正常。替换我们的<code class="fe mx my mz na b">package.json</code>文件中的<code class="fe mx my mz na b">scripts</code>键，以匹配以下内容:</p><pre class="nb nc nd ne gt nf na ng nh aw ni bi"><span id="34ef" class="ku kv in na b gy nj nk l nl nm">// package.json</span><span id="098e" class="ku kv in na b gy nn nk l nl nm">...<br/>"scripts": {<br/>  "dev": "node serve.js"<br/>},<br/></span></pre><p id="d6c8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在运行:</p><pre class="nb nc nd ne gt nf na ng nh aw ni bi"><span id="ec4a" class="ku kv in na b gy nj nk l nl nm">npm run dev</span></pre><p id="4049" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你会看到一个新的浏览器窗口或标签打开。对你的代码做一些修改，注意实时重载应该也可以工作了。</p><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nv"><img src="../Images/a8462de9ee7ceb8073e8a97dd8864816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LB28o3FT2FHevw0ziwmOQQ.png"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">Screen shot of local app running. Not too exciting but proves the point</figcaption></figure><p id="3ea9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此时，您可以向您的应用程序添加尽可能多的组件，让它变得简单或复杂，但保留<code class="fe mx my mz na b">index.tsx</code>作为导入所有其他子组件的顶级组件。</p><h1 id="b020" class="mg kv in bd kw mh mi mj kz mk ml mm lc mn mo mp lf mq mr ms li mt mu mv ll mw bi translated">设置生产构建环境</h1><p id="2565" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">我们现在有一个最小的开发环境启动并运行。此时，您可能想要添加单元测试、linters和其他项目最佳实践，所以请随意探索和构建您的应用程序。如果有人感兴趣，我们可以在另一篇文章中更详细地介绍我们团队使用的工具。</p><h2 id="fe6b" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">build.js</h2><p id="2a8f" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">让我们添加另一个文件，该文件使用esbuild的<code class="fe mx my mz na b">build</code>方法来捆绑我们的组件，以便导入到其他React项目中，并准备分发到NPM。</p><p id="efca" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在项目根目录下创建一个<code class="fe mx my mz na b">/build.js</code>文件:</p><pre class="nb nc nd ne gt nf na ng nh aw ni bi"><span id="fef7" class="ku kv in na b gy nj nk l nl nm">// build.js<br/>touch build.js</span><span id="e055" class="ku kv in na b gy nn nk l nl nm">// The project structure should look like...<br/>build.js<br/>serve.js<br/>src/<br/>  ...</span></pre><p id="f8da" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将文件中<a class="ae kt" href="https://github.com/adamjarling/medium-es-build-article-demo/blob/main/build.js" rel="noopener ugc nofollow" target="_blank">的内容复制到<code class="fe mx my mz na b">/build.js</code>中。</a></p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="no np l"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">build.js</figcaption></figure><p id="cd36" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这个配置文件中，我们将入口文件<code class="fe mx my mz na b">/src/index.tsx</code>和两种输出文件格式:ESModules和CommonJS定义到项目<code class="fe mx my mz na b">dist</code>文件夹中，作为打包组件代码的最终目的地。</p><p id="c4b9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通常，大多数基于浏览器的应用程序将使用<code class="fe mx my mz na b">esm</code>格式，节点环境应用程序将使用<code class="fe mx my mz na b">cjs</code>格式，但由于我们不确定使用应用程序的捆绑程序将使用哪种类型，我们将同时提供这两种格式。</p><p id="7871" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们跳回到<code class="fe mx my mz na b">package.json</code>文件，并完成接线。</p><p id="6013" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是<a class="ae kt" href="https://github.com/adamjarling/medium-es-build-article-demo/commit/670831d4e1afef215bdfc873f9c6e0d1fbb78fef#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519" rel="noopener ugc nofollow" target="_blank">我们将把</a>添加到<code class="fe mx my mz na b">package.json</code>文件中的差异。最新的文件将如下所示:</p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="no np l"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">package.json</figcaption></figure><p id="a550" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以下是新增内容:</p><ul class=""><li id="23a6" class="ls lt in jx b jy jz kc kd kg lu kk lv ko lw ks lx ly lz ma bi translated"><code class="fe mx my mz na b">main</code>最终捆绑文件的通用JS格式位置。</li><li id="c66a" class="ls lt in jx b jy mb kc mc kg md kk me ko mf ks lx ly lz ma bi translated"><code class="fe mx my mz na b">module</code> ES模块最终捆绑文件的格式位置。</li><li id="3dbc" class="ls lt in jx b jy mb kc mc kg md kk me ko mf ks lx ly lz ma bi translated">这个命令清空了<code class="fe mx my mz na b">/dist</code>目录，然后通过<code class="fe mx my mz na b">build.js</code>文件执行我们的ESBuild。该命令还创建了Typescript类型定义，这些定义将与我们的最终捆绑文件一起导出，因此ide将为我们导出的组件获得IntelliSense和autocomplete。</li><li id="1d85" class="ls lt in jx b jy mb kc mc kg md kk me ko mf ks lx ly lz ma bi translated"><code class="fe mx my mz na b">scripts.clean</code>清理<code class="fe mx my mz na b">dist</code>文件夹中任何残留的碎屑。</li><li id="be11" class="ls lt in jx b jy mb kc mc kg md kk me ko mf ks lx ly lz ma bi translated"><code class="fe mx my mz na b">scripts.prepublishOnly</code>这确保了每次执行<code class="fe mx my mz na b">npm publish</code>时，都会执行<code class="fe mx my mz na b">build.js</code>命令。否则，每次发布之前，您都必须手动构建新的生产文件，这很容易忘记:)</li><li id="4887" class="ls lt in jx b jy mb kc mc kg md kk me ko mf ks lx ly lz ma bi translated">告诉NPM只打包这个项目目录数组中的文件</li></ul><h2 id="f1ee" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">构建包</h2><p id="705b" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">我们现在已经准备好构建包了:</p><pre class="nb nc nd ne gt nf na ng nh aw ni bi"><span id="7966" class="ku kv in na b gy nj nk l nl nm">npm run build</span></pre><p id="9914" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们现在将看到一个新的<code class="fe mx my mz na b">/dist</code>目录已经创建，其内容应该如下所示:</p><figure class="nb nc nd ne gt jo gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/2f1ba551dc097edb1f42313218d9129d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*As6BS0IHj15QrqbwnE_KaA.png"/></div></figure><h1 id="63ee" class="mg kv in bd kw mh mi mj kz mk ml mm lc mn mo mp lf mq mr ms li mt mu mv ll mw bi translated">本地测试</h1><p id="d593" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">为了测试我们的组件实际上成功地导出和导入，在您的本地环境中打开任何React项目，并从本地文件路径直接导入这个组件。这里有一个例子:</p><pre class="nb nc nd ne gt nf na ng nh aw ni bi"><span id="b186" class="ku kv in na b gy nj nk l nl nm">// Install the local package<br/>npm install '../location/of/your/local/project';</span></pre><p id="e1a4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将组件导入本地React应用程序:</p><pre class="nb nc nd ne gt nf na ng nh aw ni bi"><span id="828f" class="ku kv in na b gy nj nk l nl nm">// Some other React app<br/>import MyAwesomeComponent from 'my-awesome-project';</span><span id="cc6c" class="ku kv in na b gy nn nk l nl nm">...</span><span id="6710" class="ku kv in na b gy nn nk l nl nm">&lt;MyAwesomeComponent foo="something goes here" /&gt;</span></pre><h1 id="f6ca" class="mg kv in bd kw mh mi mj kz mk ml mm lc mn mo mp lf mq mr ms li mt mu mv ll mw bi translated">发布到NPM</h1><p id="912a" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">恭喜你，你知道有一个项目准备交付给NPM！有很多关于如何将包发布到NPM的文章，所以请浏览NPM的文档以了解更多细节，但最基本的形式很简单:</p><pre class="nb nc nd ne gt nf na ng nh aw ni bi"><span id="10de" class="ku kv in na b gy nj nk l nl nm">npm publish</span></pre><h1 id="c204" class="mg kv in bd kw mh mi mj kz mk ml mm lc mn mo mp lf mq mr ms li mt mu mv ll mw bi translated">文章/参考文献</h1><p id="9b49" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">感谢下面我们用来构建配置的一些很好的模式和参考:</p><ul class=""><li id="ac7c" class="ls lt in jx b jy jz kc kd kg lu kk lv ko lw ks lx ly lz ma bi translated"><a class="ae kt" href="https://github.com/souporserious/bundling-typescript-with-esbuild-for-npm" rel="noopener ugc nofollow" target="_blank">https://github . com/souporserious/bundling-typescript-with-es build-for-NPM</a></li><li id="e596" class="ls lt in jx b jy mb kc mc kg md kk me ko mf ks lx ly lz ma bi translated">【https://github.com/zaydek/esbuild-hot-reload T4】</li></ul><p id="7d1f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nx">更多内容请看</em><a class="ae kt" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="nx">plain English . io</em></a><em class="nx">。报名参加我们的</em> <a class="ae kt" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="nx">免费周报</em> </a> <em class="nx">。在我们的</em> <a class="ae kt" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <em class="nx">社区获得独家写作机会和建议</em> </a> <em class="nx">。</em></p></div></div>    
</body>
</html>