# JavaScript ä¸­çš„äº¤é›†è§‚å¯Ÿè€…:æ‚¨éœ€è¦çŸ¥é“çš„ä¸€åˆ‡

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/javascript-intersection-observer-cded4e80a377?source=collection_archive---------0----------------------->

## ä½¿ç”¨äº¤å‰ç‚¹è§‚å¯Ÿå™¨ API å®ç°å»¶è¿ŸåŠ è½½ã€æ— é™æ»šåŠ¨ç­‰ã€‚ï¼Œè€Œä¸ä½¿ç”¨å¤æ‚çš„é€»è¾‘æˆ–å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚

![](img/43105dfeff3efb859615b1b606ce369f.png)

äº¤å‰ç‚¹è§‚å¯Ÿå™¨ API ç”¨äºå¼‚æ­¥è§‚å¯Ÿå…ƒç´ ä¸æµè§ˆå™¨è§†çª—çš„äº¤å‰ç‚¹çš„å˜åŒ–ã€‚å®ƒä½¿å¾—æ£€æµ‹ä¸€ä¸ªå…ƒç´ çš„å¯è§æ€§ï¼Œæˆ–è€…ä¸¤ä¸ªå…ƒç´ ç›¸å¯¹äºå½¼æ­¤çš„å¯è§æ€§çš„ä»»åŠ¡å˜å¾—å®¹æ˜“ï¼Œè€Œä¸ä¼šä½¿ç«™ç‚¹å˜å¾—ç¼“æ…¢å’Œé™ä½ç”¨æˆ·ä½“éªŒã€‚æˆ‘ä»¬å°†åœ¨è¿™ç¯‡æ–‡ç« ä¸­äº†è§£è¿™ä¸€åˆ‡ã€‚

# äº¤å‰å£è§‚å¯Ÿå™¨çš„ç”¨é€”

åœ¨æˆ‘ä»¬å¼€å§‹æ¢ç´¢äº¤å‰ç‚¹è§‚å¯Ÿå™¨ API ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹åœ¨æˆ‘ä»¬çš„ web åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒçš„ä¸€äº›å¸¸è§åŸå› :

## æ— é™æ»šåŠ¨

è¿™æ˜¯ä¸€ç§ç½‘é¡µè®¾è®¡æŠ€æœ¯ï¼Œå½“ç”¨æˆ·å‘ä¸‹æ»šåŠ¨æ—¶ï¼Œå†…å®¹è¢«æŒç»­åŠ è½½ã€‚å®ƒæ¶ˆé™¤äº†åˆ†é¡µçš„éœ€è¦ï¼Œå¹¶å¯ä»¥æ”¹å–„ç”¨æˆ·åœç•™æ—¶é—´ã€‚

## æƒ°æ€§è£…è½½

å»¶è¿ŸåŠ è½½æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œåªæœ‰å½“å›¾åƒæˆ–å…¶ä»–å†…å®¹æ»šåŠ¨åˆ°ç”¨æˆ·çš„è§†å›¾ä¸­æ—¶ï¼Œæ‰åŠ è½½å®ƒä»¬ï¼Œä»¥æé«˜æ€§èƒ½å¹¶èŠ‚çœç½‘ç»œèµ„æºã€‚

## åŸºäºæ»šåŠ¨çš„åŠ¨ç”»

è¿™æ„å‘³ç€å½“ç”¨æˆ·ä¸Šä¸‹æ»šåŠ¨é¡µé¢æ—¶åŠ¨ç”»å…ƒç´ ã€‚æœ‰æ—¶ï¼Œå½“åˆ°è¾¾æŸä¸ªæ»šåŠ¨ä½ç½®æ—¶ï¼ŒåŠ¨ç”»ä¼šå®Œå…¨æ’­æ”¾ã€‚å…¶ä»–æ—¶å€™ï¼ŒåŠ¨ç”»ä¸­çš„æ—¶é—´ä¼šéšç€æ»šåŠ¨ä½ç½®çš„å˜åŒ–è€Œå˜åŒ–ã€‚

## å¹¿å‘Šæ”¶å…¥è®¡ç®—

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨äº¤å‰ç‚¹è§‚å¯Ÿå™¨æ¥æ£€æµ‹å¹¿å‘Šä½•æ—¶å¯¹ç”¨æˆ·å¯è§ï¼Œå¹¶è®°å½•å°è±¡ï¼Œä»è€Œå½±å“å¹¿å‘Šæ”¶å…¥ã€‚

# åˆ›å»ºäº¤å‰ç‚¹è§‚å¯Ÿç‚¹

è®©æˆ‘ä»¬æ¥çœ‹çœ‹ JavaScript ä¸­äº¤é›†è§‚å¯Ÿå™¨çš„ä¸€ä¸ªç®€å•ç”¨æ³•ã€‚

`index.js`

```
const observer = new IntersectionObserver((entries) => {
  for (const entry of entries) {
    const intersecting = entry.isIntersecting;
    entry.target.style.backgroundColor = intersecting ? 'blue' : 'orange';
  }
});const box = document.getElementById('box');observer.observe(box);
```

å›è°ƒå‡½æ•°æ¥æ”¶ä¸€ä¸ªåŒ…å«`IntersectionObserverEntry`æ¥å£å¯¹è±¡çš„æ•°ç»„ã€‚æ­¤å¯¹è±¡åŒ…å«è§‚å¯Ÿè€…å½“å‰æ­£åœ¨è§‚å¯Ÿçš„å…ƒç´ çš„äº¤å‰ç‚¹ç›¸å…³ä¿¡æ¯ã€‚

æ¯å½“ç›®æ ‡å…ƒç´ ä¸è§†å£ç›¸äº¤æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨å›è°ƒã€‚å®ƒä¹Ÿè¢«ç§°ä¸ºç¬¬ä¸€æ¬¡è¦æ±‚è§‚å¯Ÿè€…è§‚å¯Ÿå…ƒç´ ã€‚

æˆ‘ä»¬ä½¿ç”¨`for...of`å¾ªç¯æ¥éå†ä¼ é€’ç»™å›è°ƒå‡½æ•°çš„æ¡ç›®ã€‚æˆ‘ä»¬åªè§‚å¯Ÿä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥`entries`æ•°ç»„å°†åªåŒ…å«ä»£è¡¨ç›’å­çš„`IntersectionObserverEntry`å…ƒç´ ï¼Œè€Œ`for...of`å¾ªç¯å°†åªæœ‰ä¸€æ¬¡è¿­ä»£ã€‚

`IntersectionObserverEntry`å…ƒç´ çš„`isIntersecting`å±æ€§è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨æ˜è¯¥å…ƒç´ æ˜¯å¦ä¸è§†å£ç›¸äº¤ã€‚

å½“`isIntersection`ä¸º`true`æ—¶ï¼Œè¡¨ç¤ºå…ƒç´ æ­£åœ¨ä»ä¸ç›¸äº¤å‘ç›¸äº¤è¿‡æ¸¡ã€‚ä½†æ˜¯å½“å®ƒæ˜¯`false`æ—¶ï¼Œå®ƒè¡¨ç¤ºå…ƒç´ æ­£åœ¨ä»ç›¸äº¤è¿‡æ¸¡åˆ°ä¸ç›¸äº¤ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨`isIntersection`å±æ€§å°†å…ƒç´ è¿›å…¥è§†å£æ—¶çš„é¢œè‰²è®¾ç½®ä¸º`blue`ï¼Œå¹¶åœ¨å…ƒç´ ç¦»å¼€æ—¶è¿”å›åˆ°`black`ã€‚

æˆ‘ä»¬åœ¨`IntersectionObserver`å¯¹è±¡ä¸Šè°ƒç”¨`observe()`æ–¹æ³•ï¼Œè®©è§‚å¯Ÿè€…å¼€å§‹è§‚å¯Ÿå…ƒç´ çš„äº¤é›†ã€‚

åœ¨ä¸‹é¢çš„æ¼”ç¤ºä¸­ï¼Œå¸¦æœ‰æ»šåŠ¨æ¡çš„ç™½è‰²åŒºåŸŸä»£è¡¨è§†å£ã€‚ç°è‰²éƒ¨åˆ†è¡¨ç¤ºé¡µé¢ä¸Šä½äºè§†çª—ä¹‹å¤–çš„åŒºåŸŸï¼Œé€šå¸¸åœ¨æµè§ˆå™¨ä¸­ä¸å¯è§ã€‚

è§‚å¯Ÿå½“ä¸€ä¸ªåƒç´ è¿›å…¥è§†å£æ—¶ï¼Œé•¿æ–¹ä½“çš„é¢œè‰²å¦‚ä½•å˜åŒ–:

![](img/82eaaddedc2db416b592709aa5ecd995.png)

The element changes color once a single pixel of it enters the viewport.

# äº¤å‰ç‚¹è§‚å¯Ÿç‚¹é€‰é¡¹

é™¤äº†å›è°ƒå‡½æ•°ä¹‹å¤–ï¼Œ`IntersectionObserver()`æ„é€ å‡½æ•°è¿˜æ¥å—ä¸€ä¸ª`options`å¯¹è±¡ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥å®šåˆ¶å›è°ƒè¢«è°ƒç”¨æ‰€å¿…é¡»æ»¡è¶³çš„æ¡ä»¶ã€‚

## `threshold`

`threshold`å±æ€§æ¥å—ä¸€ä¸ªä»‹äº 0 å’Œ 1 ä¹‹é—´çš„å€¼ï¼Œè¯¥å€¼æŒ‡å®šå…ƒç´ åœ¨è§†å£ä¸­å¿…é¡»å¯è§çš„ç™¾åˆ†æ¯”ï¼Œä»¥ä¾¿è°ƒç”¨å›è°ƒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒçš„å€¼ä¸º`0`ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦å…ƒç´ çš„å•ä¸ªåƒç´ è¿›å…¥è§†å£ï¼Œå›è°ƒå°±ä¼šè¿è¡Œã€‚

è®©æˆ‘ä»¬ä¿®æ”¹å‰é¢çš„ä¾‹å­ï¼Œä½¿ç”¨é˜ˆå€¼`1` (100%):

`index.js`

```
const observer = new IntersectionObserver(
  (entries) => {
    for (const entry of entries) {
      const intersecting = entry.isIntersecting;
      entry.target.style.backgroundColor = intersecting ? 'blue' : 'black';
    }
  },
  // ğŸ‘‡ Threshold is 100%
  { threshold: 1 }
);const box = document.getElementById('box');observer.observe(box);
```

ç°åœ¨ï¼Œåªæœ‰å½“å…ƒç´ çš„æ¯ä¸ªåƒç´ åœ¨è§†å£ä¸­éƒ½å¯è§æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œæ”¹å˜é¢œè‰²çš„å›è°ƒã€‚

![](img/57c8ef8d35a16128206ca3a4d95397bd.png)

The element changes color once every single pixel of it enters the viewport.

`threshold`ä¹Ÿæ¥å—å¤šä¸ªå€¼ï¼Œè¿™ä½¿å¾—æ¯æ¬¡å…ƒç´ é€šè¿‡ä¸€ä¸ªé˜ˆå€¼é›†æ—¶å›è°ƒ getã€‚

ä¾‹å¦‚:

`index.js`

```
const threshold = document.getElementById('threshold');const observer = new IntersectionObserver(
  (entries) => {
    for (const entry of entries) {
      const ratio = entry.intersectionRatio;
      threshold.innerText = `${Math.round(ratio * 100)}%`;
    }
  },
  // ğŸ‘‡ Multiple treshold values
  { threshold: [0, 0.25, 0.5, 0.75, 1] }
);const box = document.getElementById('box');observer.observe(box);
```

æˆ‘ä»¬å°†æ•°ç»„ä¸­çš„ 5 ä¸ªç™¾åˆ†æ¯”å€¼ä¼ é€’ç»™`threshold`å±æ€§ï¼Œå¹¶åœ¨å…ƒç´ åˆ°è¾¾æ—¶æ˜¾ç¤ºæ¯ä¸ªå€¼ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†`intersectionRatio`å±æ€§ï¼Œä¸€ä¸ªä»‹äº 0 å’Œ 1 ä¹‹é—´çš„æ•°å­—è¡¨ç¤ºå…ƒç´ åœ¨è§†å£ä¸­çš„å½“å‰ç™¾åˆ†æ¯”ã€‚

![](img/f10cead1eb5ea62cd5778266efa2ed72.png)

The text is updated each time a percentage of the element in the viewport reaches a certain threshold.

è¯·æ³¨æ„ï¼Œæ˜¾ç¤ºçš„æ–‡æœ¬å¹¶ä¸æ€»æ˜¯ä¸æˆ‘ä»¬çš„é˜ˆå€¼ç›¸åŒ¹é…ï¼Œä¾‹å¦‚ï¼Œåœ¨æ¼”ç¤ºä¸­ï¼Œ`2%`æ˜¯é’ˆå¯¹`0%`é˜ˆå€¼æ˜¾ç¤ºçš„ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºå½“æˆ‘ä»¬å¿«é€Ÿæ»šåŠ¨å¹¶è¾¾åˆ°ä¸€ä¸ªé˜ˆå€¼æ—¶ï¼Œç­‰åˆ°å›è°ƒå¯ä»¥è§¦å‘ä»¥æ›´æ–°æ–‡æœ¬æ—¶ï¼Œæˆ‘ä»¬å·²ç»æ»šåŠ¨äº†è¶…è¿‡é˜ˆå€¼çš„æ›´å¤šå…ƒç´ ã€‚

å¦‚æœæˆ‘ä»¬æ»šåŠ¨å¾—æ›´æ…¢ï¼Œå›è°ƒå°†æœ‰æ—¶é—´åœ¨å…ƒç´ æ»šåŠ¨è¶…è¿‡å½“å‰é˜ˆå€¼ä¹‹å‰æ›´æ–°æ–‡æœ¬ã€‚

`rootMargin`

`rootMargin`å±æ€§åœ¨è§†çª—æˆ–æ ¹å…ƒç´ å‘¨å›´åº”ç”¨è¾¹è·ã€‚å®ƒæ¥å— CSS `margin`å±æ€§å¯ä»¥æ¥å—çš„å€¼ï¼Œä¾‹å¦‚`10px 20px 30px 40px`(ä¸Šã€å³ã€ä¸‹ã€å·¦)ã€‚è¾¹è·å¢å¤§æˆ–ç¼©å°ç›¸äº¤è§‚å¯Ÿè€…è§‚å¯Ÿçš„ä¸ç›®æ ‡å…ƒç´ ç›¸äº¤çš„è§†å£åŒºåŸŸã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨`rootMargin`å±æ€§çš„ä¾‹å­:

`index.js`

```
const observer = new IntersectionObserver(
  (entries) => {
    for (const entry of entries) {
      const intersecting = entry.isIntersecting;
      entry.target.style.backgroundColor = intersecting ? 'blue' : 'black';
    }
  },
  // ğŸ‘‡ Root margin 50px from bottom of viewport
  { rootMargin: '50px' }
);const box = document.getElementById('box');observer.observe(box);
```

åœ¨è®¾ç½®äº†ä¸€ä¸ª`50px`çš„`rootMargin`ä¹‹åï¼Œä¸ºäº†ç›¸äº¤çš„ç›®çš„ï¼Œè§†å£çš„é«˜åº¦è¢«æœ‰æ•ˆåœ°å¢åŠ äº†ï¼Œå½“å…ƒç´ è¿›å…¥è§†å£çš„`50px`æ—¶ï¼Œå›è°ƒå‡½æ•°å°†è¢«è°ƒç”¨ã€‚

æ¼”ç¤ºä¸­çš„çº¢çº¿è¡¨ç¤ºè§‚å¯Ÿè€…è§‚å¯Ÿçš„ä»»ä½•äº¤å‰ç‚¹åŒºåŸŸçš„è¾¹ç•Œã€‚

![](img/de6ce5af2f3f45a1e68737aa4ef1262e.png)

The element changes color when it comes within 50px of the viewport.

æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šè´Ÿè¾¹è·æ¥ç¼©å°ç”¨äºç›¸äº¤çš„è§†å£åŒºåŸŸã€‚

```
const observer = new IntersectionObserver(
  (entries) => {
    for (const entry of entries) {
      const intersecting = entry.isIntersecting;
      entry.target.style.backgroundColor = intersecting ? 'blue' : 'black';
    }
  },
  // ğŸ‘‡ Negative margin
  { rootMargin: '-50px' }
);const box = document.getElementById('box');observer.observe(box);
```

ç°åœ¨ï¼Œå½“å…ƒç´ çš„å•ä¸ªåƒç´ åœ¨è§†å£å†…è¶…è¿‡`50px`æ—¶ï¼Œå°±ä¼šè§¦å‘å›è°ƒã€‚

![](img/7aa4b27b0e9a211607aee414a80b7e1f.png)

The element changes color when a single pixel of the element is more than 50px inside the viewport.

`root`

å±æ€§æ¥å—çš„å…ƒç´ å¿…é¡»æ˜¯è¢«è§‚å¯Ÿå…ƒç´ çš„ç¥–å…ˆã€‚é»˜è®¤ä¸º`null`ï¼Œè¡¨ç¤ºä½¿ç”¨è§†å£ã€‚æ‚¨ä¸éœ€è¦ç»å¸¸ä½¿ç”¨è¯¥å±æ€§ï¼Œä½†æ˜¯å½“æ‚¨çš„é¡µé¢ä¸Šæœ‰ä¸€ä¸ªå¯æ»šåŠ¨çš„å®¹å™¨ï¼Œå¹¶ä¸”æ‚¨å¸Œæœ›æ£€æŸ¥å®ƒä¸å…¶ä¸­ä¸€ä¸ªå­å…ƒç´ çš„äº¤é›†æ—¶ï¼Œè¯¥å±æ€§éå¸¸æ–¹ä¾¿ã€‚

ä¾‹å¦‚ï¼Œä¸ºäº†åˆ›å»ºæœ¬æ–‡ä¸­çš„æ¼”ç¤ºï¼Œæˆ‘å°†`root`å±æ€§è®¾ç½®ä¸ºé¡µé¢ä¸Šçš„ä¸€ä¸ªå¯æ»šåŠ¨å®¹å™¨ï¼Œä»¥ä¾¿äºæ‚¨å¯è§†åŒ–è§†å£åŠå…¶å¤–éƒ¨åŒºåŸŸï¼Œå¹¶æ›´å¥½åœ°ç†è§£äº¤å‰ç‚¹æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

# ç¬¬äºŒä¸ªå›è°ƒå‚æ•°

ä¼ é€’ç»™`IntersectionObserver()`æ„é€ å‡½æ•°çš„å›è°ƒå®é™…ä¸Šæœ‰ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬ä¹‹å‰çœ‹çš„`entries`å‚æ•°ã€‚ç¬¬äºŒä¸ªæ˜¯è§‚å¯Ÿåå­—è·¯å£çš„è§‚å¯Ÿè€…ã€‚

```
const observer = new IntersectionObserver((entries, o) => {
  console.log(o === observer); // true
});
```

æ­¤å‚æ•°å¯¹äºä»å›è°ƒä¸­è®¿é—®è§‚å¯Ÿå™¨å¾ˆæœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å›è°ƒä½äºæ— æ³•è®¿é—®è§‚å¯Ÿå™¨å˜é‡çš„ä½ç½®æ—¶ï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸åŒ…å«è§‚å¯Ÿå™¨å˜é‡çš„æ–‡ä»¶ä¸åŒçš„æ–‡ä»¶ä¸­ã€‚

# é˜²æ­¢å†…å­˜æ³„æ¼

å½“ä¸å†éœ€è¦è§‚å¯Ÿå…ƒç´ æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœæ­¢è§‚å¯Ÿå®ƒä»¬ï¼Œæ¯”å¦‚å½“å®ƒä»¬ä» DOM ä¸­ç§»é™¤æˆ–è€…åœ¨ä¸€æ¬¡åŸºäºæ»šåŠ¨çš„åŠ¨ç”»ä¹‹åï¼Œä»¥é˜²æ­¢å†…å­˜æ³„æ¼æˆ–è€…æ€§èƒ½é—®é¢˜ã€‚

æˆ‘ä»¬å¯ä»¥ç”¨`unobserve()`æ–¹æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚

```
new IntersectionObserver((entries, observer) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      doAnim(entry.target);
      observer.unobserve(entry.target);
    }
  });
});
```

`unobserver()`å°†å•ä¸ªå…ƒç´ ä½œä¸ºå…¶å‚æ•°ï¼Œå¹¶åœæ­¢è§‚å¯Ÿè¯¥å…ƒç´ ã€‚

è¿˜æœ‰ä¸€ç§`disconnect()`æ–¹æ³•ï¼Œè®©è§‚å¯Ÿè€…åœæ­¢è§‚å¯Ÿæ‰€æœ‰å…ƒç´ ã€‚

# ç»“è®º

Intersection Observer æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ JavaScript APIï¼Œç”¨äºè½»æ¾æ£€æµ‹å…ƒç´ ä½•æ—¶ä¸è§†å£æˆ–çˆ¶å…ƒç´ ç›¸äº¤ã€‚å®ƒè®©æˆ‘ä»¬å¯ä»¥å®ç°å»¶è¿ŸåŠ è½½ã€åŸºäºæ»šåŠ¨çš„åŠ¨ç”»ã€æ— é™æ»šåŠ¨ç­‰ç­‰ï¼Œè€Œä¸ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œä¹Ÿä¸å¿…ä½¿ç”¨å¤æ‚çš„é€»è¾‘ã€‚

*åŸè½½äº*[*ã€codingbeautydev.comã€‘*](https://cbdev.link/563df1)

# JavaScript åšçš„æ¯ä¸€ä»¶ç–¯ç‹‚çš„äº‹æƒ…

ä¸€æœ¬å…³äº JavaScript å¾®å¦™çš„è­¦å‘Šå’Œé²œä¸ºäººçŸ¥çš„éƒ¨åˆ†çš„è¿·äººæŒ‡å—ã€‚

![](img/143ee152ba78025ea8643ba5b9726a20.png)

[**æŠ¥å**](https://cbdev.link/d3c4eb) ç«‹å³å…è´¹é¢†å–ä¸€ä»½ã€‚